var O365;(function(n){var t;(function(t){var i=function(){function t(){}return t.InitNav=function(){var r,u,i,f;$('#account-index-maincontent div.tab-content').hide(),$('#account-index-maincontent div.tab-content:eq(0)').show(),$('#account-nav-container ul li:eq(1) a').addClass('selected'),r=function(){$(this).find(".ms-Button-label span").removeClass("ms-fontColor-white")},u=function(){$(this).find(".ms-Button-label span").addClass("ms-fontColor-white")},$('.ms-Button.ms-bgc-ts').hover(r,u).focus(r).blur(u),$('#account-nav-container ul li a').click(function(){var n=$(this).attr('href'),t=$('#account-nav-container ul li a.selected'),i;t&&t.attr('href')!=n&&(i=$(n).is(':visible'),$('#account-index-maincontent div.tab-content').hide(),$('#account-nav-container ul li a').removeClass('selected'),$(this).addClass('selected'),$(n).toggle())}),i=window.location.hash,i!=null&&(i==='#security'&&$('#account-nav-item-security').length===0&&(i='#settings'),t.LoadTab(i)),f=700,$(window).resize(function(){$(this).width()<=f&&t.MinimizeNav()}),$(window).resize(),t.IsRTL()&&$(window).width()>f&&($('#nav-chevron-icon').removeClass(t.ChevronLeft).addClass(t.ChevronRight),$('#install-options-chevron-icon').removeClass(t.ChevronRight).addClass(t.ChevronLeft)),$('#account-nav-item-chevron').click(function(){$('#account-nav-container').hasClass('full-width')?t.MinimizeNav():t.MaximizeNav()}),this.HandleEnterKey($("#account-nav-item-chevron")),$("#account-nav-container a").click(function(){n.Log.WriteLog(410446,n.LogLevel.Info,n.LogArea.Profile,n.LogParameter.Empty,$(this).attr('id'))}),$("#account-nav-item-myinfo").click(function(){n.Account.MyInfo.AddSuiteApiCallback()})},t.MaximizeNav=function(){$('#account-nav-container').removeClass('responsive-width').addClass('full-width'),$('#account-nav-container .account-nav-item .icon-text').css('display','table-cell'),t.IsRTL()?$('#nav-chevron-icon').removeClass(t.ChevronLeft).addClass(t.ChevronRight):$('#nav-chevron-icon').removeClass(t.ChevronRight).addClass(t.ChevronLeft),$('#account-index-maincontent').removeClass('content-responsive-left').addClass('content-left')},t.MinimizeNav=function(){$('#account-nav-container').removeClass('full-width').addClass('responsive-width'),$('#account-nav-container .account-nav-item .icon-text').hide(),t.IsRTL()?$('#nav-chevron-icon').removeClass(t.ChevronRight).addClass(t.ChevronLeft):$('#nav-chevron-icon').removeClass(t.ChevronLeft).addClass(t.ChevronRight),$('#account-index-maincontent').removeClass('content-left').addClass('content-responsive-left')},t.LoadTab=function(n){$('#account-nav-container ul li a[href="'+n+'"]').click()},t.IsRTL=function(){return $("html").attr("dir").toLowerCase()==="rtl"},t.HandleEnterKey=function(n){$(n).keyup(function(t){t.keyCode==13&&$(n).click()})},t.LogButtonClicks=function(){$("#home button").click(function(){n.Log.WriteLog(410450,n.LogLevel.Info,n.LogArea.Profile,n.LogParameter.Empty,$(this).attr('id'))})},t.DetectCloudOS=function(){var r="os-sku",i=["179","178"],t,n;if(window.external&&"getHostEnvironmentValue"in window.external&&(t=window.external.getHostEnvironmentValue(r),t))for(n=0;n<i.length;n++)if(t.match(RegExp(i[n])))return!0;return!1},t.DisableInstallLinkForCloudOS=function(){this.DetectCloudOS()&&($("#account-installs-link-download").hide(),$("#account-installs-link-installOnPage").hide())},t.ChevronLeft="ms-Icon--chevronThinLeft",t.ChevronRight="ms-Icon--chevronThinRight",t}(),r,u,f,e,o;t.Common=i,function(n){n[n.Success=0]="Success",n[n.NoLicense=1]="NoLicense",n[n.InstallDisabled=2]="InstallDisabled",n[n.Error=3]="Error",n[n.InvalidParam=4]="InvalidParam",n[n.InternalServerError=5]="InternalServerError"}(r||(r={})),function(n){n[n.Success=0]="Success",n[n.Error=1]="Error",n[n.Error_InvalidParam=2]="Error_InvalidParam",n[n.Error_InternalServerError=3]="Error_InternalServerError"}(u||(u={})),f=function(){function t(){}return t.ToggleHeaders=function(n){$("#"+n+" .table-header").toggle(),$("#"+n+" .install-date").toggle(),$("#"+n+" .info-icon span").toggleClass("ms-Icon--chevronDown ms-Icon--chevronUp"),$("#"+n+" .machine-name").toggleClass("TruncateWithEllipsis"),$("#"+n+" .machine-os").toggleClass("TruncateWithEllipsis")},t.ToggleInstallDevicesSection=function(n){$("#"+n+"ShowDevicesSwitch").toggleClass("ms-Icon--chevronDown ms-Icon--chevronUp"),$("#"+n+"Install-devices").toggle()},t.ToggleShowCall=function(n){$("#"+n).toggle()},t.GetOfficeInstalls=function(t){var r=this;if(n.Account.Common.DetectCloudOS()){$("#account-installs-link-download").hide(),$('#officeInstallButtonSpinner').hide();return}var i=this.GetPlatform(window.navigator.userAgent),u=window.navigator.language,f=i=="pc"?"x86":"10_10_0";(i=="pc"||i=="mac")&&this.GetLicensedOffices(i,u,f,t).then(function(n){switch(n.Status){case 3:$('#installOfficeButton').attr("href",$("#account-installs-link-download").attr("href")),$('#installOfficeButton').css('display','inline-block'),$('#apps-icons').css('display','inline-block'),$('#officeInstallButtonSpinner').hide();break;case 1:$('#NoLicenseMsg').show(),$('#installOfficeButton').hide(),$('#officeInstallButtonSpinner').hide();break;case 2:$('#AdminDisabledMsg').show(),$('#installOfficeButton').hide(),$('#officeInstallButtonSpinner').hide();break;case 0:if(!n.Apps||!n.Apps.length){$('#installOfficeButton').attr("href",$("#account-installs-link-download").attr("href")),$('#installOfficeButton').css('display','inline-block'),$('#apps-icons').css('display','inline-block'),$('#officeInstallButtonSpinner').hide();return}$('#officeInstallButtonSpinner').show(),r.GetCustomDownloadUrl(n.Apps[0].Id,u,f).then(function(t){var i=r.GetOfficeBrandText(n.Apps[0].Id);n.Apps[0].Id.indexOf("OfficeBusiness")>=0&&$(".officeproplus-icons").hide(),i!==null&&$('#installOfficeButton').text(i),$('#installOfficeButton').attr("href",t),$('#installOfficeButton').css('display','inline-block'),$('#apps-icons').css('display','inline-block'),$('#officeInstallButtonSpinner').hide()}).fail(function(){$('#installOfficeButton').attr("href",n.StaticDownloadUrl),$('#officeInstallButtonSpinner').hide()});break;case 4:case 5:$('#officeInstallButtonSpinner').hide()}}).fail(function(t){n.Log.WriteLog(425362,n.LogLevel.Error,n.LogArea.Profile,n.LogParameter.Empty,t.responseText),$('#officeInstallButtonSpinner').hide()})},t.GetLicensedOffices=function(t,i,r,u){var f=$.Deferred(),e=t=="pc"?"?$filter=(type eq '"+u+"')":"";return $.ajax({type:"GET",url:"/officeapps/v1.0/apps/"+i+"/"+t+"/"+r+e}).then(function(n){f.resolve(n)}).fail(function(t){n.Log.WriteLog(425363,n.LogLevel.Error,n.LogArea.Profile,n.LogParameter.Empty,t.responseText),f.reject(t)}),f.promise()},t.GetCustomDownloadUrl=function(t,i,r){var u=$.Deferred(),f=timer.now();return $.ajax({type:"GET",url:"/officeapps/v1.0/apps/"+t+"/downloadurl/"+i+"/"+r}).then(function(t){t.Status>=1&&(n.Log.WriteLog(425361,n.LogLevel.Error,n.LogArea.Profile,n.LogParameter.Empty),u.reject(t.Status)),t.Status===0&&(n.Log.WriteLog(425360,n.LogLevel.Info,n.LogArea.Profile,n.LogParameter.Empty,timer.now()-f),u.resolve(t.Url))}).fail(function(){u.reject()}),u.promise()},t.GetInstallsCount=function(){var t=timer.now();$.ajax({type:"GET",url:"/api/account/installs/used/",success:function(i){n.Log.WriteLog(412017,n.LogLevel.Info,n.LogArea.Profile,n.LogParameter.Empty,timer.now()-t),$("#installsUsedVal").text(i)},error:function(){$("#installsUsedVal").text("")}})},t.GetOfficeBrandText=function(n){return n.indexOf("2013")!==-1?'Install Office 2013':n.indexOf("2016")!==-1?'Install Office 2016':null},t.ConfirmDeactivation=function(n,i,r){var u='After you deactivate an install, you won\x27t be able to use many of its features.',f=String.format('Deactivating this install does not remove the latest version of \x7b0\x7d from your computer.',i),e=u+"<br /><br />"+f,o='Do you want to deactivate this install\x3f';DialogManager.confirmHtml(2,o,e,function(i){i==DialogManager.positiveConfirmation&&t.DeactivateInstall(n,r)},'Yes','No',!1)},t.DeactivateInstall=function(i,r){var u=timer.now();$.ajax({type:"POST",url:"/api/account/installs/deactivate/?machineKey="+i,headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},success:function(){n.Log.WriteLog(412018,n.LogLevel.Info,n.LogArea.Profile,n.LogParameter.Empty,timer.now()-u),t.GetOfficeInstalls("office"),ajax.ajaxCallForUI('/Account/FetchInstalls',null,$('#installs-content'),t.ShowSuccess(r),null)},error:function(){t.ShowFailure()}})},t.HideAlert=function(){$("#installs-content .success-alert, #installs-content .error-alert").hide()},t.ShowSuccess=function(n){this.HideAlert();var t=String.format('Done\x21 The install on \x7b0\x7d has been deactivated.',n);$("#installs-success-alert-text").text(t),$("#installs-alerts .success-alert").show(0).focus().delay(5e3).fadeOut()},t.ShowFailure=function(){this.HideAlert(),$("#installs-alerts .error-alert").show(0).delay(5e3).fadeOut()},t.GetPlatform=function(n){var t=n.toLowerCase(),r=/(ipad)/.exec(t)||/(iphone)/.exec(t)||/(android)/.exec(t)||/(windows phone)/.exec(t)||/(win)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/i.exec(t)||[],i=r[0]||"";return i=="win"?"pc":i},t}(),t.DesktopInstalls=f,e=function(){function t(){}return t.RegisterEnterKey=function(){i.HandleEnterKey($(".change-photo-container")),i.HandleEnterKey($("#"+this.editLinkPrefix+this.about)),i.HandleEnterKey($("#"+this.editLinkPrefix+this.contact)),i.HandleEnterKey($("#"+this.editLinkPrefix+this.address))},t.AddSuiteApiCallback=function(){window.O365Shell&&!window.O365Shell.SuiteAPI?window.O365Shell.OnSuiteAPILoaded(function(){t.SuiteApiLoadedCallback()}):window.O365Shell&&window.O365Shell.SuiteAPI&&t.SuiteApiLoadedCallback()},t.SuiteApiLoadedCallback=function(){var n=t.HasExoLicense&&t.IsNewPhotoEXPEnabled&&!t.hasExoLanguageAndTZSet&&!t.isOwaCallPending;t.UserPhoto!=null&&t.UpdateUserPhoto(),n&&t.CallGetOwaUserConfig()},t.UpdatePersonaImage=function(n){$("#userProfilePhoto").attr("src",n),t.UserPhoto=null},t.OnChangePhotoFlexPaneSave=function(n){n!=null?t.UpdatePersonaImage("data:image/jpeg;base64,"+n):t.UpdatePersonaImage('https://prod.msocdn.com/16.00.1871.009/en-GB/images/profile/doughboy.png')},t.OpenChangePhotoWindow=function(n,i){t.IsPhotoFlexPaneEnabled?O365Shell_Shim.GlobalSettings.OpenChangePhotoFlexPane(t.OnChangePhotoFlexPaneSave):t.IsNewPhotoEXPEnabled?t.ShowNewPhotoExpOrErrorMessage(n,i):t.ShowPhotoPopUp(n)},t.ClickSettingsPivot=function(){$("#account-nav-item-settings").click()},t.BeingClient=function(n){n.setRequestHeader('AjaxSessionKey',Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey'))},t.ShowAboutEdit=function(){this.ShowCardEdit(this.about)},t.ShowContactEdit=function(){this.ShowCardEdit(this.contact)},t.ShowAddressEdit=function(){this.ShowCardEdit(this.address)},t.CancelAbout=function(){this.CancelForm(this.about)},t.CancelContact=function(){$('#AltEmailTextBoxAssistiveText').removeClass("error-txt"),this.CancelForm(this.contact)},t.CancelAddress=function(){this.CancelForm(this.address)},t.SubmitAbout=function(){this.SubmitForm(this.about)},t.SubmitContact=function(){var t=$('#IsEmailVerifiedTenant').text().toLowerCase(),n=$('#AltEmail').val().toLowerCase(),i=t==="true"||!this.EmailEqualsUPN(n)&&!this.EmailHasAlreadyUsedDomain(n);i===!0?($('#AltEmailTextBoxAssistiveText').removeClass("error-txt"),this.SubmitForm(this.contact)):($('#AltEmail').focus(),$('#AltEmailTextBoxAssistiveText').addClass("error-txt"))},t.EmailEqualsUPN=function(n){var t=$("#email-field > a").text().toLowerCase();return t===n.toLowerCase()},t.EmailHasAlreadyUsedDomain=function(n){var t,r,i,u;if(n&&(t=n.split('@'),r=$('#domainsList').text().split(','),t!=null&&t.length>1))for(t=t[1].toLowerCase(),i=0;i<r.length;i++)if(u=r[i].toLowerCase().replace(/'/g,"").trim(),t===u)return!0;return!1},t.SubmitAddress=function(){this.SubmitForm(this.address)},t.SubmitForm=function(n){$("#"+n+"-edit-form").valid()&&($("#"+this.saveButtonPrefix+n).hide(),$("#"+this.saveButtonPrefix+n+"_disabled").show(),$("#"+this.cancelButtonPrefix+n).hide(),this.ShowProcessingMsg(n),$("#"+n+"-edit-form").submit())},t.CancelForm=function(n){$("#"+n+"-edit-form").trigger("reset"),this.HideCardStatus(n),this.ShowCardData(n)},t.ShowAboutSuccess=function(){$("#firstname-field").text($("#FirstName").val()),$("#lastname-field").text($("#LastName").val()),$("#jobtitle-field").text($("#JobTitle").val()),$("#department-field").text($("#Department").val()),$.ajax({type:"GET",url:"/api/profile/data",success:function(n){if(n!=null){var i=n.Department==null?"":n.Department,t=n.JobTitle==null?"":n.JobTitle;t.length>0&&i.length>0&&(t+=", "),t+=i,$(".fullname").text(n.DisplayName),$(".title-department").text(t)}},error:function(){$(".fullname").text($("#FirstName").val()+" "+$("#LastName").val())}}),this.ShowSuccessMsg(this.about),this.ShowCardData(this.about)},t.ShowContactSuccess=function(){$("#mobilephone-field").text($("#MobilePhoneNumber").val()),$("#phone-field").text($("#PhoneNumber").val()),$("#altemail-field").text($("#AltEmail").val()),this.ShowSuccessMsg(this.contact),this.ShowCardData(this.contact)},t.ShowAddressSuccess=function(){$("#address-field").text($("#Address").val()),$("#city-field").text($("#City").val()),$("#state-field").text($("#State").val()),$("#postalcode-field").text($("#PostalCode").val()),$("#country-field").text($("#CountryOrRegion option:selected").text()),this.ShowSuccessMsg(this.address),this.ShowCardData(this.address)},t.ShowAboutFailure=function(){this.ShowFailureMsg(this.about)},t.ShowContactFailure=function(){this.ShowFailureMsg(this.contact)},t.ShowAddressFailure=function(){this.ShowFailureMsg(this.address)},t.ShowCardEdit=function(n){$("#"+n+"-edit").show(),$("#"+n+"-edit .PropertySheet:first input:first").focus(),$("#"+n+"-display").hide(),$("#"+this.editLinkPrefix+n).hide()},t.ShowCardData=function(n){$("#"+n+"-edit").hide(),$("#"+n+"-display").show(),$("#"+this.editLinkPrefix+n).show()},t.HideCardStatus=function(n){$("."+n+" .card-status").hide(),$("."+n+" .processing").hide(),$("."+n+" .AlertMessage").hide()},t.ShowProcessingMsg=function(n){$("."+n+" .card-status").show(),$("."+n+" .processing").show(),$("."+n+" .AlertMessage").hide()},t.ShowSuccessMsg=function(n){$("#"+this.saveButtonPrefix+n).show(),$("#"+this.saveButtonPrefix+n+"_disabled").hide(),$("#"+this.cancelButtonPrefix+n).show(),$("."+n+" .processing").hide(),$("."+n+" .card-status").show(0).delay(5e3).hide(0),$("."+n+" .success-alert").show(0).delay(5e3).hide(0),$("."+n+" .error-alert").hide()},t.ShowFailureMsg=function(n){$("#"+this.saveButtonPrefix+n).show(),$("#"+this.saveButtonPrefix+n+"_disabled").hide(),$("#"+this.cancelButtonPrefix+n).show(),$("."+n+" .processing").hide(),$("."+n+" .success-alert").hide(),$("."+n+" .error-alert").show(0).delay(5e3).hide(0),$("."+n+" .card-status").show(0).delay(5e3).hide(0)},t.ShowNewPhotoExpOrErrorMessage=function(n,i){!t.HasExoLicense||t.IsNewPhotoEXPEnabled&&t.hasExoLanguageAndTZSet&&!t.isOwaCallPending?t.ShowPhotoPopUp(i):!t.IsNewPhotoEXPEnabled||t.hasExoLanguageAndTZSet||t.isOwaCallPending||t.ShowPhotoPopUp(n)},t.ShowPhotoPopUp=function(t){n.Log.WriteLog(402406,n.LogLevel.Info,n.LogArea.Profile,n.LogParameter.Empty),$("#LangTimeZoneNotSetErrorAlert").hide();var i=window.open(t,"changePhotoPopupWindow","width=600,height=600,scrollbars=no,menubar=no,resizable=yes");i.focus()},t.CallGetOwaUserConfig=function(){var i=window.O365Shell.SuiteAPI;t.isOwaCallPending=!0,$("#account-myinfo-link-changephoto").hide(),$("#LangTimeZoneNotSetErrorAlert").hide(),i.get_Calendar().GetOwaUserConfiguration(function(i){t.hasExoLanguageAndTZSet=!0,t.isOwaCallPending=!1,i.SegmentationSettings.DisplayPhotos&&i.SegmentationSettings.SetPhoto&&($("#account-myinfo-link-changephoto").show(),n.Log.WriteLog(414255,n.LogLevel.Info,n.LogArea.Profile,n.LogParameter.Empty))},function(i){var r=i.message.toLowerCase();n.Log.WriteLog(414256,n.LogLevel.Error,n.LogArea.Profile,n.LogParameter.Empty,r),t.isOwaCallPending=!1,t.hasExoLanguageAndTZSet=!1,$("#account-myinfo-link-changephoto").show(),(r.indexOf("languagenotset")>-1||r.indexOf("owainvaliduserlanguageexception")>-1)&&n.Log.WriteLog(414258,n.LogLevel.Error,n.LogArea.Profile,n.LogParameter.Empty)})},t.UpdateUserPhoto=function(){if(t.UserPhoto!=null){var n=new Image;n.onload=function(){n.width>1&&n.height>1&&($('#userProfilePhoto').attr('src',t.UserPhoto),t.UserPhoto=null)},n.src=t.UserPhoto}},t.editLinkPrefix="account-myinfo-link-edit-",t.saveButtonPrefix="account-myinfo-button-save-",t.cancelButtonPrefix="account-myinfo-button-cancel-",t.about="about",t.contact="contact",t.address="address",t.isOwaCallPending=!1,t.hasExoLanguageAndTZSet=!1,t.IsNewPhotoEXPEnabled=!1,t.IsPhotoFlexPaneEnabled=!1,t.HasExoLicense=!1,t}(),t.MyInfo=e,o=function(){function n(){}return n.GoToSettings=function(){$("#account-nav-item-settings").click()},n.UpdateStartPage=function(t){$.ajax({type:"POST",url:"/api/settings/startpage",headers:{AjaxSessionKey:Microsoft.Online.BOX.JS.Shared.GetSessionCookie('AjaxSessionKey')},data:{LandingPageID:t},success:function(){ajax.ajaxCallForUI('/Account/FetchRecommendations',null,$('#recommendations-content'),n.ShowSuccess(),null)},error:function(){n.ShowFailure()}})},n.HideAlert=function(){$("#recommendations-alerts .success-alert, #recommendations-alerts .error-alert").hide()},n.ShowSuccess=function(){this.HideAlert(),$("#recommendations-alerts .success-alert").show(0).focus().delay(5e3).fadeOut()},n.ShowFailure=function(){this.HideAlert(),$("#recommendations-alerts .error-alert").show(0).delay(5e3).fadeOut()},n}(),t.Recommendations=o})(t=n.Account||(n.Account={}))})(O365||(O365={})),$(document).ready(function(){O365.Account.Common.InitNav(),O365.Account.Common.LogButtonClicks(),O365.Account.MyInfo.RegisterEnterKey(),O365.Account.DesktopInstalls.GetInstallsCount(),O365.Account.MyInfo.AddSuiteApiCallback(),O365.Account.Common.DisableInstallLinkForCloudOS()})