webpackJsonp([4,74,381,386,392,403,404,411,451,455,470,472],{0:function(e,t){e.exports=function(e){if("undefined"!==typeof execScript)execScript(e);else eval.call(null,e)}},1593:function(e,t,i){i(4349);i(4350);i(4351);i(4352);i(4353);i(4354);i(4355);i(4356);i(4357);i(4358);i(4359);i(4360);i(4361);i(4362);i(4363);i(4364);i(4365);i(4366);i(4367);i(4368);i(4369);i(4370);i(4371);i(4372);i(4373);i(4374);i(4375);i(4376);i(4377);i(4378);i(3670);i(4379);i(1625);i(281);i(1626);i(1628);i(4380);i(4381);i(4382);i(4383);i(3682);i(4384);i(1635);i(4385);i(4386);i(4387);i(4388);i(4389);i(3643);i(3692);i(4390);i(4391);i(4392);i(3679);i(4393);i(4394);i(3691);i(4395);i(4396);i(4397);i(280);i(4398);i(4399);i(4400);i(4401);i(4402);i(4403);i(4404);i(4405);i(4406);i(285);i(4407);i(4408);i(4409);i(4410);i(4411);i(3641);i(4412);i(4413);i(4414);i(4415);i(3671);i(3680);i(4416);i(4417);i(4418);i(4419);i(4420);i(4421);i(4422);i(4423);i(4424);i(4425);i(4426);i(4427);i(3665);i(3666);i(4428);e.exports=i(4429)},1625:function(e,t){(function(e){var t,i={get:function(e){return n[t].get.apply(this,[e])},set:function(e,i){var a=parseInt(e),r=parseInt(i),s;if("undefined"===typeof e)a=0;else if(e<0)a=this.val().length+a;if("undefined"===typeof i)s=this.val().length;else if(i>=0)s=a+r;else s=this.val().length+r;n[t].set.apply(this,[a,s]);return this},setcursor:function(e){return this.textrange("set",e,0)},replace:function(e){n[t].replace.apply(this,[String(e)]);return this},insert:function(e){return this.textrange("replace",e)}},n={xul:{get:function(e){var t={position:this[0].selectionStart,start:this[0].selectionStart,end:this[0].selectionEnd,length:this[0].selectionEnd-this[0].selectionStart,text:this.val().substring(this[0].selectionStart,this[0].selectionEnd)};return"undefined"===typeof e?t:t[e]},set:function(e,t){this[0].selectionStart=e;this[0].selectionEnd=t},replace:function(e){var t=this[0].selectionStart;var i=this[0].selectionEnd;var n=this.val();this.val(n.substring(0,t)+e+n.substring(i,n.length));this[0].selectionStart=t;this[0].selectionEnd=t+e.length}},msie:{get:function(e){var t=document.selection.createRange();if("undefined"===typeof t)return{position:0,start:0,end:this[0].val().length,length:this[0].val().length,text:this.val()};var i=this[0].createTextRange();var n=i.duplicate();i.moveToBookmark(t.getBookmark());n.setEndPoint("EndToStart",i);var a={position:n.text.length,start:n.text.length,end:n.text.length+t.text.length,length:t.text.length,text:t.text};return"undefined"===typeof e?a:a[e]},set:function(e,t){var i=this[0].createTextRange();if("undefined"===typeof i)return this;if("undefined"!==typeof e){i.moveStart("character",e);i.collapse()}if("undefined"!==typeof t)i.moveEnd("character",t-e);i.select()},replace:function(e){document.selection.createRange().text=e}}};e.fn.textrange=function(n){if("undefined"===typeof this[0])return this;if("undefined"===typeof t)t="selectionStart"in this[0]?"xul":document.selection?"msie":"unknown";if("unknown"===t)return this;if(document.activeElement!==this[0])this[0].focus();if("undefined"===typeof n||"string"!==typeof n)return i.get.apply(this);else if("function"===typeof i[n])return i[n].apply(this,Array.prototype.slice.call(arguments,1));else e.error("Method "+n+" does not exist in jQuery.textrange")}})(jQuery)},1626:function(e,t,i){i(0)(i(1627))},1627:function(e,t){e.exports="/**\n * Requires JQueryUI,jquery-textrange\n */\n/*jslint regexp: true, todo: true, vars: true, white: true, nomen: true, plusplus: true */\n/*global jQuery, console */\n\n// TODO: This should be abstracted out into a plugin that just does regex based highlighting\n// properly on an input field or text area. Then another one can extend it (or perhaps this\n// one can do it with a certain option flag) to make it take the list of modifiers. That way\n// we can use this plugin to add highlighting to the message input field.\n\n(function($) {\n\n\t\"use strict\";\n\n\tvar UNDERLAY_CLASS = 'underlay';\n\tvar might_be_modifier_regex = /^[^:]+:([^:+]+)?$/i;\n\tvar is_webkit = /webkit/i.test(navigator.userAgent);\n\n\t$.widget('TS.highlighter', {\n\n\t\t// defaults\n\t\toptions: {\n\t\t\tplaceholder_class: 'ghost_text',\n\t\t\tglobal_modifier_highlight_class: 'modifier',\n\t\t\tglobal_modifier_incomplete_highlight_class: 'incomplete',\n\t\t\tglobal_keyword_highlightClass: 'keyword',\n\t\t\t// takes a list of objects in the following format:\n\t\t\t// {\n\t\t\t//   modifier: 'after:',\n\t\t\t//   keyword_testers: [function(str) {return true/false}],\n\t\t\t//   modifierHighlightClass: 'time-mod'\n\t\t\t//   keyword_highlight_class: 'time-mod-keyword'\n\t\t\t// }\n\t\t\tmodifiers: []\n\t\t},\n\n\t\t_ghost_text: '',\n\t\t_ghost_prev_char: '',\n\t\t_$ghost_text: null,\n\t\t_ghost_text_changed_sig: null,\n\n\t\t// init/constructor\n\t\t_create: function() {\n\t\t\tif (!this.element.is('input[type=\"text\"]')) {\n\t\t\t\tthrow this.widgetName + ': Element is not a text input.';\n\t\t\t}\n\n\t\t\tthis._renderUI();\n\n\t\t\t// bind UI\n\t\t\t// keydown for immediacy, keyup to capture pastes and other weirdo things\n\t\t\tthis._on({\n\t\t\t\t'keydown': this._onInputKey,\n\t\t\t\t'keyup': this._onInputKey,\n\t\t\t\t'change': this._onInputChange,\n\t\t\t\t'scroll': this._onScroll,\n\t\t\t\t'focus': this._onFocus,\n\t\t\t\t'blur': this._onBlur,\n\t\t\t\t'mouseenter': this._onMouseEnter,\n\t\t\t\t'mouseleave': this._onMouseLeave\n\t\t\t});\n\n\t\t\tif (_has_scroll_left_bug === null) {\n\t\t\t\t_testHasScrollLeftBug(this.element.parent());\n\t\t\t}\n\n\t\t\tthis._$ghost_text = $('<span>').addClass(this.options.placeholder_class);\n\t\t\tthis._ghost_text_changed_sig = new signals.Signal();\n\t\t\tthis._ghost_text_changed_sig.add(this._onNewGhostText, this);\n\n\t\t\tif (this.element.val().trim()) {\n\t\t\t\tthis._updateUnderlay();\n\t\t\t}\n\t\t},\n\n\t\t_destroy: function() {\n\t\t\t_cancelRAF(this._scroll_raf);\n\t\t\t$(window).unbind('resize.highlighter_resize');\n\t\t\tTS.client.flexpane_display_switched_sig.remove(this._updateSizing);\n\t\t\tthis.element.off('.highlighter_transition');\n\t\t},\n\n\t\t_renderUI: function() {\n\t\t\tvar widget_prefix = this.widgetName + '_';\n\n\t\t\tthis._$underlay = $('<div class=\"' + widget_prefix + UNDERLAY_CLASS + '\"/>');\n\t\t\tthis._$wrapper = this.element.parent();\n\t\t\tthis._$wrapper.append(this._$underlay);\n\t\t\tthis.element.addClass('search_input_highlighted');\n\n\t\t\tthis._updateSizing();\n\n\t\t\t$(window).bind('resize.highlighter_resize', TS.utility.debounce($.proxy(this._updateSizing, this), 500));\n \t\t\tTS.client.flexpane_display_switched_sig.add(this._updateSizing, this);\n \t\t\tvar self = this;\n \t\t\tthis._$underlay.closest('.flex_header').on('transitionend.highlighter_transition webkitTransitionEnd.highlighter_transition MozTransitionEnd.highlighter_transition', function(e) {\n \t\t\t\tself._updateSizing();\n \t\t\t});\t\t\t\n\t\t},\n\n\t\t_onInputKey: function() {\n\t\t\tthis.element.trigger('change');\n\t\t},\n\n\t\t_onInputChange: function() {\n\t\t\t_rAF($.proxy(this._updateUnderlay, this));\n\t\t},\n\n\t\t_onScroll: function() {\n\t\t\t// Unfortunately, only FF & IE trigger scroll events on the input element\n\t\t\t// Keep the underlay at the same scroll position as the element\n\t\t\t_rAF($.proxy(function() {\n\t\t\t\tthis._$underlay.scrollLeft(this.element.scrollLeft());\n\t\t\t}, this));\n\t\t},\n\n\t\t_onFocus: function() {\n\t\t\tthis._has_focus = true;\n\n\t\t\tthis._updateSizing();\n\n\t\t\t// only need this on chrome/safari\n\t\t\tif (is_webkit) {\n\t\t\t\tthis._syncScrollLeft();\n\t\t\t}\n\t\t},\n\n\t\t_onBlur: function() {\n\t\t\tthis._has_focus = false;\n\t\t\tthis._updateSizing();\n\t\t},\n\n\t\t_onMouseEnter: function() {\n\t\t\tthis._mouse_over = true;\n\n\t\t\t// only need this on chrome/safari\n\t\t\tif (is_webkit) {\n\t\t\t\tthis._syncScrollLeft();\n\t\t\t}\n\t\t},\n\n\t\t_onMouseLeave: function() {\n\t\t\tthis._mouse_over = false;\n\t\t},\n\n\t\t_replaceAll: function(txt, regex, newStr) {\n\t\t\tif (regex instanceof RegExp) {\n\t\t\t\treturn txt.replace(regex, newStr);\n\t\t\t}\n\t\t\treturn txt.replace(new RegExp(regex, 'gi'), newStr);\n\t\t},\n\n\n\t\thighlightStr: function(str, allow_breaks) {\n\t\t\tvar words = str.split(' ');\n\n\t\t\t// takes a list of objects in the following format:\n\t\t\t// {\n\t\t\t//   modifier: 'after:',\n\t\t\t//   keyword_testers: [function(str) {return true/false}],\n\t\t\t//   modifierHighlightClass: 'time-mod'\n\t\t\t//   keyword_highlight_class: 'time-mod-keyword'\n\t\t\t// }\n\n\t\t\t// test highlights against each word\n\t\t\twords.forEach(function(word, index) {\n\t\t\t\tif (this._mightBeModifier(word)) {\n\t\t\t\t\tvar colon_index = word.indexOf(':');\n\t\t\t\t\tvar possible_modifier = word.slice(0, colon_index + 1);\n\t\t\t\t\tvar keyword = word.slice(colon_index + 1);\n\t\t\t\t\tvar new_word;\n\n\t\t\t\t\tthis.options.modifiers.some(function(modifierDetails) {\n\t\t\t\t\t\tvar real_modifier = modifierDetails.modifier;\n\t\t\t\t\t\tvar modifier_span;\n\t\t\t\t\t\tvar keyword_span;\n\t\t\t\t\t\tif (possible_modifier.toLowerCase() === real_modifier) {\n\t\t\t\t\t\t\t// Its a valid modifier! Wrap this shiz\n\t\t\t\t\t\t\tvar mod_class = this.options.global_modifier_highlight_class;\n\t\t\t\t\t\t\tvar incomplete_class = this.options.global_modifier_incomplete_highlight_class;\n\t\t\t\t\t\t\tif (modifierDetails.modifierHighlightClass) {\n\t\t\t\t\t\t\t\tmod_class = mod_class + ' ' + modifierDetails.modifierHighlightClass;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnew_word = '';\n\n\t\t\t\t\t\t\t// in the history section of the autocomplete, we allow breaks between the words\n\t\t\t\t\t\t\t// but not between modifiers and keywords\n\t\t\t\t\t\t\t// the wbr is a hint, mainly for firefox, that it should break before the no_wrap span\n\t\t\t\t\t\t\t// otherwise, this happens: https://tinyspeck.slack.com/files/amy/F031PD2EN/qa___tiny_speck_slack.png\n\t\t\t\t\t\t\tif (allow_breaks) new_word += '<wbr/><span class=\"no_wrap\">';\n\n\t\t\t\t\t\t\t// check if keyword is valid\n\t\t\t\t\t\t\tif (keyword) {\n\t\t\t\t\t\t\t\tmodifierDetails.keyword_testers.some(function(format_tester) {\n\t\t\t\t\t\t\t\t\tif (format_tester(keyword)) {\n\t\t\t\t\t\t\t\t\t\tvar keywordClass = this.options.global_keyword_highlightClass;\n\t\t\t\t\t\t\t\t\t\tif (modifierDetails.keyword_highlight_class) {\n\t\t\t\t\t\t\t\t\t\t\tkeywordClass = keywordClass + ' ' + modifierDetails.keyword_highlight_class;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tkeyword_span = '<span class=\"' + keywordClass + '\">' + _htmlEntities(keyword) + '</span>';\n\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (keyword_span) {\n\t\t\t\t\t\t\t\t// complete (green)\n\t\t\t\t\t\t\t\tmodifier_span = '<span class=\"' + mod_class + '\">' + _htmlEntities(possible_modifier) + '</span>';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// incomplete (yellow)\n\t\t\t\t\t\t\t\tmodifier_span = '<span class=\"' + mod_class + ' ' + incomplete_class + '\">' + _htmlEntities(possible_modifier) + '</span>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tnew_word += modifier_span;\n\n\t\t\t\t\t\t\tif (keyword_span) {\n\t\t\t\t\t\t\t\tnew_word += keyword_span;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnew_word += _htmlEntities(keyword);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// close the no_wrap span\n\t\t\t\t\t\t\tif (allow_breaks) new_word += '</span>';\n\n\t\t\t\t\t\t\twords[index] = new_word;\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twords[index] = _htmlEntities(word);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\t\t\t\t} else {\n\t\t\t\t\twords[index] = _htmlEntities(word);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\treturn words.join(' ');\n\t\t},\n\n\t\t_updateUnderlay: function() {\n\t\t\tvar val = this.element.val();\n\t\t\tvar newTxt;\n\t\t\t\n\t\t\tif (this._prevVal === val) return;\n\n\t\t\tnewTxt = this.highlightStr(val);\n\n\t\t\t// Adjust copy to match text area in rendering by working\n\t\t\t// around the way spaces are collapsed in HTML. Maybe a \"pre\"\n\t\t\t// style here could work instead?\n\t\t\tnewTxt = this._replaceAll(newTxt, '\\n', '<br/>');\n\t\t\tnewTxt = this._replaceAll(newTxt, '  ', '  ');\n\n\t\t\t// Might be handy to insert an HTML tag representing the location\n\t\t\t// of the caret here, for use positioning things.\n\t\t\tthis._$underlay.html(newTxt);\n\n\t\t\t// ghost text is the placeholdery text to the right of the cursor\n\t\t\t// it shows you what hitting tab will do\n\t\t\tif (this._ghost_text) {\n\t\t\t\t// the ghost text will be updated on keyUp\n\t\t\t\t// but let's see if we can run ahead of it to reduce flickering\n\t\t\t\tif (this._prevVal && val.length > this._prevVal.length && val.charAt(val.length-1) === this._ghost_text.charAt(0)) {\n\t\t\t\t\t// typed the next letter in the ghost text\n\t\t\t\t\tthis.setGhostText(this._ghost_text.substring(1));\n\n\t\t\t\t} else if (this._prevVal && this._ghost_prev_char && val.length && val.length === (this._prevVal.length - 1) && this._ghost_prev_char === this._prevVal.charAt(this._prevVal.length-1)) {\n\t\t\t\t\t// deleted the last letter, prepend it to the ghost text\n\t\t\t\t\tthis.setGhostText(this._ghost_prev_char + this._ghost_text);\n\n\t\t\t\t} else {\n\t\t\t\t\tthis.setGhostText('');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._$ghost_text.appendTo(this._$underlay);\n\n\t\t\tthis._prevVal = val;\n\n\t\t\t// Note: the scroll left bug is explained in _testHasScrollLeftBug.\n\t\t\t// Additionally, while Safari doesn't have the scrollLeft bug it also\n\t\t\t// doesn't allow us to determine the zoom level from window.devicePixelRatio\n\t\t\t// like EVERY other browser does. This means we cannot reliably\n\t\t\t// position the underlay across all of the zoom levels. \n\t\t\tif (_has_scroll_left_bug || TS.model.is_safari_desktop) {\n\t\t\t\t// see if the text is long enough to cause scrolling\n\t\t\t\tthis._$underlay.scrollLeft(10000);\n\t\t\t\tvar underlay_scroll_left = this._$underlay.scrollLeft();\n\t\t\t\tif (underlay_scroll_left !== 0) {\n\t\t\t\t\t// yep, hide the highlights :(\n\t\t\t\t\tthis._$underlay.scrollLeft(0);\n\t\t\t\t\tthis._$underlay.addClass('hide_highlights');\n\t\t\t\t} else {\n\t\t\t\t\t// still good\n\t\t\t\t\tthis._$underlay.removeClass('hide_highlights');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_mightBeModifier: function(str) {\n\t\t\treturn might_be_modifier_regex.test(str);\n\t\t},\n\n\t\t_syncScrollLeft: function() {\n\t\t\tvar sync = $.proxy(function() {\n\t\t\t\t// Note: as of Safari 10 devicePixelRatio doesn't account for \n\t\t\t\t// the zoom level, so for Safari we just hide the keywords on\n\t\t\t\t// scroll.\n\t\t\t\tvar dprWithZoom = window.devicePixelRatio;\n\t\t\t\tvar dprWithoutZoom = Math.floor(dprWithZoom) > 1 ? 2 : 1;\n\t\t\t\tvar zoomLevel = dprWithZoom / dprWithoutZoom;\n\n\t\t\t\t// Keep the underlay at the same scroll position as the element.\n\t\t\t\t// Need to account for zoom level as scrollLeft will return\n\t\t\t\t// increasingly smaller values when you zoom beyound 100%\n\t\t\t\t// but when setting scroll left the value needs to be set \n\t\t\t\t// according to what it should be at 100%.\t\t\t\n\t\t\t\tvar left = this.element.scrollLeft() * zoomLevel;\n\t\n\t\t\t\tif (left !== this._prev_left) {\n\t\t\t\t\tthis._$underlay.scrollLeft(left);\n\t\t\t\t\t// read it back in case it didn't set\n\t\t\t\t\tthis._prev_left = this._$underlay.scrollLeft();\n\t\t\t\t}\n\n\t\t\t\tif (this._has_focus || this._mouse_over) {\n\t\t\t\t\tthis._scroll_raf = _rAF(sync);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\t_cancelRAF(this._scroll_raf);\n\t\t\tthis._prev_left = null;\n\t\t\tthis._scroll_raf = _rAF(sync);\n\t\t},\n\n\t\t// search box may change width when the window is resized\n\t\t// padding/margin may change if the page is text-only zoomed\n\t\t// this function is debounced in _create\n\t\t_updateSizing: function(e) {\n\t\t\t// Measure the parent's width vs the <input>'s \n\t\t\t// as the parent's width will be a true representation\n\t\t\t// of the available space, whereas the <input>'s \n\t\t\t// width will only be 50% of the available space \n\t\t\t// on account of the <input> and the underlay both\n\t\t\t// being flex children.\n\t\t\tvar width = this.element.parent().outerWidth();\n\n \t\t\tthis._$underlay.width(width);\n\n\t\t\t// Set left margin to align the underlay with the\n\t\t\t// left edge of the search input as it will allow\n\t\t\t// its text to be vertically aligned to the search\n\t\t\t// input at all font sizes.\n \t\t\tthis._$underlay.css('margin-left', '-' + width + 'px');\n\t\t},\t\t\n\n\t\t_onNewGhostText: function() {\n\t\t\tif (this._ghost_text) {\n\t\t\t\tthis._$ghost_text.text(this._ghost_text);\n\t\t\t} else {\n\t\t\t\t// on chrome, safari and ssb you can't scroll the highlighter as far right as the input. it's off by 1-2px\n\t\t\t\t// add some invisible text so we can scroll a bit further\n\t\t\t\tthis._$ghost_text.html('&nbsp;&nbsp;');\n\t\t\t}\n\t\t},\n\n\t\tsetGhostText: function(text, prev_char) {\n\t\t\tthis._ghost_text = text;\n\t\t\tthis._ghost_prev_char = prev_char;\n\t\t\tthis._ghost_text_changed_sig.dispatch(text);\n\t\t}\n\t});\n\n// private\n\nvar _has_scroll_left_bug = null;\n\nvar _rAF = (function() {\n\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\tvar requestAnimationFrame = window.requestAnimationFrame;\n\tvar x;\n\t\n\tfor (x = 0; x < vendors.length && !requestAnimationFrame; x++) {\n\t\trequestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n\t}\n\t\n\tif (!requestAnimationFrame) {\n\t\tvar last_time = 0;\n\t\treturn function(callback) {\n\t\t\tvar curr_time = Date.now();\n\t\t\tvar time_to_call = Math.max(0, 16 - (curr_time - last_time));\n\t\t\tvar id = window.setTimeout(function() { \n\t\t\t\tcallback(curr_time + time_to_call);\n\t\t\t}, time_to_call);\n\t\t\tlast_time = curr_time + time_to_call;\n\t\t\treturn id;\n\t\t};\n\t}\n\n\treturn function(fn) {\n\t\treturn requestAnimationFrame.call(window, fn);\n\t};\n})();\n\nvar _cancelRAF = (function() {\n\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\tvar cancelAnimationFrame = window.cancelAnimationFrame;\n\tvar x;\n\t\n\tfor (x = 0; x < vendors.length && !cancelAnimationFrame; x++) {\n\t\tcancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];;\n\t}\n\t\n\tif (!cancelAnimationFrame) {\n\t\treturn function(id) {\n\t\t\tclearTimeout(id);\n\t\t};\n\t}\n\n\treturn function(id) {\n\t\tcancelAnimationFrame.call(window, id);\n\t};\n})();\n\n// sooooo this is just _.escape, but I don't think this plugin should be calling TS.*.\nvar _htmlEntities = function(str) {\n\tif (!str) return '';\n\t// replace HTML tags in a string with encoded entities\n\treturn String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n// on IE11 and older FFs, you can't get the scrollLeft for an <input type=\"text\">.\n// we need that to keep the highlights in sync as the text gets long.\n// so on browsers with this bug we will hide the highlights when the text gets long enough to scroll.\nvar _testHasScrollLeftBug = function(append_to) {\n\t// white-list some UAs\n\t// chrome, safari, ssb are ok\n\tif (/webkit/i.test(navigator.userAgent)) return;\n\t// IE10 is ok. revisit when IE12 is out\n\tif (/msie/i.test(navigator.userAgent)) return;\n\t// FF24 is bad, FF31+ is good. I haven't tested every version in between.\n\tvar ff_ver = /Firefox\\/(\\d+)\\b/.exec(navigator.userAgent);\n\tif (ff_ver && ff_ver.length === 2) {\n\t\tif (parseInt(ff_ver[1], 10) >= 31) return;\n\t}\n\t// this creates an input, fills it with a lot of text, scrolls it all the way to the \n\t// right and checks if scrollLeft is still 0.\n\tvar $input = $('<input type=\"text\">');\n\t$input.val('MMMMMMMMMMMMMMMMMMMMMMMMMM');\n\t$input.css({position: 'absolute', top: '0', right: '9999px'});\n\t$input.width(50);\n\t$input.appendTo(append_to);\n\t$input.focus().setCursorPosition(10000);\n\t// i hate browsers. on FF you can't get a good reading on this unless you wait for a while.\n\tsetTimeout(function() {\n\t\t$input.focus().setCursorPosition(10000);\n\t\t_has_scroll_left_bug = $input.scrollLeft() === 0;\n\t\t$input.remove();\n\t}, 500);\n}\n\n}(jQuery));\n"},1628:function(e,t,i){i(0)(i(1629))},1629:function(e,t){e.exports="/**\n * Requires JQueryUI widget factory\n */\n/*jslint regexp: true, todo: true, vars: true, white: true, nomen: true, plusplus: true */\n/*global jQuery, console, DATA */\n(function($) {\n\n\t\"use strict\";\n\n\tvar MENU_TYPES = {\n\t\thistory: 'history',\n\t\tmodifier: 'modifier',\n\t\tuser: 'user',\n\t\tgroup: 'group',\n\t\tchannel: 'channel',\n\t\tconversation: 'conversation',\n\t\ttime_range: 'time-range',\n\t\tdate: 'date',\n\t\thas: 'has' // star, pin, link, reaction?\n\t};\n\n\tvar SECTION_RESULT_LIMIT = 5;\n\tvar USER_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar CHANNEL_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar GROUP_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar HISTORY_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar PROFILE_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar LIMIT_DEFAULT = 100;\n\n\tvar REPLACEMENT_ATTR = 'data-replacement';\n\tvar MATCHING_KEYWORD_ATTR = 'data-matching-keyword';\n\n\tvar SELECTED_CLASS = null;\n\t// maybe should add this class programatically instead? Since I depend on it\n\t// for _isModifierItemElement(). No biggie, though.\n\tvar MODIFIERS_LIST_CLASS = 'modifiers';\n\tvar HISTORY_LIST_CLASS = 'history';\n\tvar PROFILE_LIST_CLASS = 'profiles';\n\n\tvar ITEM_WRAPPER_SEL = 'li';\n\tvar ITEM_GROUP_WRAPPER_SEL = 'ol';\n\n\tvar CALENDAR_CLASS = 'autocomplete_calendar';\n\tvar CALENDAR_VISIBLE_CLASS = 'calendar_visible';\n\tvar CALENDAR_FORMAT = 'Y-m-d';\n\n\tvar DEFAULT_CONVERSATION_MODIFIER = null;\n\n\tvar DEFAULT_MENU_HEIGHT = 534;\n\n\tvar _last_key_code = 0;\n\n\tvar has_token_regex = /\\{(.+)\\}/i;\n\tvar might_be_modifier_regex = /^[^:]+:([^:]+)?$/i;\n\n\t$.widget('TS.autocomplete', {\n\n\t\t// defaults\n\t\toptions: {\n\t\t\thidden_class: 'hidden',\n\t\t\tselected_class: 'selected',\n\t\t\tappend_to: 'body',\n\t\t\tdisabled: false,\n\t\t\tdata: null\n\t\t},\n\n\t\t_$popover: null,\n\t\t_$menu: null,\n\t\t_$menu_items: null,\n\t\t_$calendar: null,\n\t\t_$ac_menu: null,\n\t\t_$scrollable: null,\n\n\t\t_menu_index: null,\n\t\t_calendar_modifier: '',\n\t\t_render_data: {},\n\t\t_last_query: null,\n\t\t_recalc_height: true,\n\t\t_open_menu_on_focus: true,\n\t\t_hide_timer: null,\n\t\t_mouse_in_menu: false,\n\t\t_input_has_focus: false,\n\t\t_block_menu: false,\n\t\t_texty_block_menu: false,\n\t\t_caret_position: null,\n\n\t\t_current_history_query: null,\n\t\t_current_history_items: [],\n\n\t\t_search_promises: [],\n\t\t_search_pending: false,\n\n\t\t// init/constructor\n\t\t_create: function() {\n\t\t\tif (!TS.boot_data.feature_texty_search && !this.element.is('input[type=\"text\"]')) {\n\t\t\t\tthrow this.widgetName + ': Element is not a text input.';\n\t\t\t}\n\n\t\t\tthis.options.selected_class = 'highlighted';\n\n\t\t\t// TODO: Warn when changing this after intantiaion\n\t\t\tSELECTED_CLASS = this.options.selected_class;\n\t\t\tDEFAULT_CONVERSATION_MODIFIER = TS.i18n.t('in:', 'search_menu')();\n\n\t\t\tthis._renderUI();\n\n\t\t\tvar input_events = {\n\t\t\t\t'keydown': this._onTextInputKeydown.bind(this),\n\t\t\t\t'keyup': this._onTextInputKeyup.bind(this),\n\t\t\t\t'mousedown': this._onTextInputMouseDown.bind(this),\n\t\t\t\t'mouseup': this._onTextInputMouseUp.bind(this),\n\t\t\t\t'focus': this._onTextInputFocus.bind(this),\n\t\t\t\t'blur': this._onTextInputBlur.bind(this),\n\t\t\t\t'cut': this._onTextInput.bind(this),\n\t\t\t\t'paste': this._onTextInput.bind(this),\n\t\t\t\t'input': this._onTextInput.bind(this),\n\t\t\t\t// Texty\n\t\t\t\t'on-enter': this._handleEnterKey.bind(this),\n\t\t\t\t'on-escape': this._handleEscKey.bind(this),\n\t\t\t\t'on-tab': this._handleTabKey.bind(this),\n\t\t\t};\n\n\t\t\t// bind ui events\n\t\t\tif (TS.boot_data.feature_texty_search) {\n\t\t\t\tif (this.options.registerInputEvents) {\n\t\t\t\t\tthis.options.registerInputEvents(input_events);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._on(this.element, input_events);\n\t\t\t}\n\n\t\t\tthis._on(this._$menu, {\n\t\t\t\t'click li': this._onMenuClick,\n\t\t\t\t'click .delete_history_item_target_area': this._onClickDeleteHistoryItem,\n\t\t\t\t'click .footer_tip_action': this._onClickFooterTipAction,\n\t\t\t\t'mouseenter': this._onMouseEnter,\n\t\t\t\t'mouseleave': this._onMouseLeave,\n\t\t\t\t'mousedown': this._onMouseDownMenu\n\t\t\t});\n\n\t\t\tthis.options.data = this.options.data || window.DATA;\n\n\t\t\t$(window).bind('resize.recalc_autocomplete_height', $.proxy(function() {\n\t\t\t\tthis._recalc_height = true;\n\t\t\t}, this));\n\t\t},\n\n\t\t_destroy: function() {\n\t\t\t$(window).unbind('resize.recalc_autocomplete_height');\n\t\t},\n\n\t\t// TODO: Implement JQuery standard show http://api.jqueryui.com/jquery.widget/#method-_show\n\t\t_show: function() {\n\t\t\tthis._$popover.removeClass(this.options.hidden_class);\n\n\t\t\tif (this._recalc_height) {\n\t\t\t\t// see if we need to limit the height of the menu\n\t\t\t\tthis._recalc_height = false;\n\t\t\t\tvar window_height = $(window).height();\n\t\t\t\tvar menu_top = this._$menu.offset().top;\n\t\t\t\tvar available_space = window_height - menu_top - 25;\n\t\t\t\tvar max_height = Math.min(available_space, DEFAULT_MENU_HEIGHT);\n\t\t\t\tthis._$menu.css('max-height', max_height);\n\t\t\t}\n\n\t\t\t$(window).unbind('mousedown.close_autocomplete').bind('mousedown.close_autocomplete', $.proxy(this._onMouseDownOutsideAutocomplete, this));\n\n\t\t\tTS.ui.utility.updateClosestMonkeyScroller(this._$scrollable);\n\t\t},\n\t\tshow: function() {\n\t\t\tthis._show();\n\t\t},\n\n\t\t// TODO: Implement JQuery standard hide http://api.jqueryui.com/jquery.widget/#method-_hide\n\t\t_hide: function() {\n\t\t\t$(ITEM_WRAPPER_SEL, this._$menu).removeClass(this.options.selected_class);\n\t\t\tthis._$popover.addClass(this.options.hidden_class);\n\t\t\tthis._mouse_in_menu = false;\n\t\t\tthis._resetMenuIndex();\n\t\t\tthis._clearGhostText();\n\t\t\t$(window).unbind('mousedown.close_autocomplete');\n\n\t\t\tTS.kb_nav.end();\n\t\t},\n\t\thide: function() {\n\t\t\tthis._hide();\n\t\t},\n\n\t\t// hide, but allow it to be canceled on re-focus\n\t\t_requestHide: function() {\n\t\t\tthis._cancelHide();\n\t\t\tthis._hide_timer = setTimeout($.proxy(this._hide, this), 0);\n\t\t},\n\n\t\t_cancelHide: function() {\n\t\t\tclearTimeout(this._hide_timer);\n\t\t},\n\n\t\t_resetMenuIndex: function() {\n\t\t\tthis._menu_index = null;\n\t\t},\n\n\t\t_renderUI: function() {\n\t\t\tthis._$popover = $('<div/>').addClass('popover_menu popover_search_menu').attr('id', 'search_autocomplete_popover');\n\t\t\tthis._$popover.append('<span class=\"arrow\"></span><span class=\"arrow_shadow\"></span>');\n\t\t\t// We'll just create a wrapper div and rerender the html inside to show results\n\t\t\tif (this._$menu) {\n\t\t\t\tthis._$menu.empty();\n\t\t\t}\n\t\t\t// things have to be nested a bit to accommodate monkeyScroll\n\t\t\tthis._$ac_menu = $('<div id=\"autocomplete_menu\" class=\"content\"/>').appendTo(this._$popover);\n\t\t\tthis._$scrollable = $('<div class=\"autocomplete_menu_scrollable\"/>').appendTo(this._$ac_menu);\n\t\t\tthis._$menu = $('<div/>').appendTo(this._$scrollable);\n\t\t\tthis._initCalendar();\n\t\t\tthis._hide();\n\t\t\tthis._$scrollable.append(this._$menu);\n\t\t\t$(this.options.append_to).append(this._$popover);\n\n\t\t\tif (!TS.environment.supports_custom_scrollbar) {\n\t\t\t\tthis._$scrollable.monkeyScroll();\n\t\t\t}\n\n\t\t\tthis._$ac_menu.addClass('search_menu');\n\t\t},\n\n\t\t// Rerender this thing's innards according to the latest _render_data\n\t\t_syncUI: function() {\n\t\t\tTS.kb_nav.end();\n\n\t\t\tif (this._render_data.header) {\n\t\t\t\tthis._$popover.addClass('showing_header');\n\t\t\t} else {\n\t\t\t\tthis._$popover.removeClass('showing_header');\n\t\t\t}\n\t\t\tthis._render_data.conversations_html = new Handlebars.SafeString(this._conversationsHTML());\n\n\t\t\tthis._$menu.html(TS.templates.search_menu(this._render_data));\n\n\t\t\tthis._$menu_items = $(ITEM_WRAPPER_SEL, this._$menu);\n\t\t\tif (this._render_data.show_calendar) {\n\t\t\t\tthis._$calendar.removeClass(this.options.hidden_class);\n\t\t\t\tthis._$ac_menu.addClass(CALENDAR_VISIBLE_CLASS);\n\t\t\t\t// unhighlight previous selection\n\t\t\t\tthis._$calendar.find('.pmu-selected').removeClass('pmu-selected');\n\t\t\t} else {\n\t\t\t\tthis._$calendar.addClass(this.options.hidden_class);\n\t\t\t\tthis._$ac_menu.removeClass(CALENDAR_VISIBLE_CLASS);\n\t\t\t}\n\t\t\tif (this._render_data.footer && this._render_data.footer.tips) {\n\t\t\t\tthis._$popover.attr('data-qa', 'search_modifier_tips');\n\t\t\t} else {\n\t\t\t\tthis._$popover.removeAttr('data-qa');\n\t\t\t}\n\t\t\tthis._resetMenuIndex();\n\n\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\tthis._updateGhostText();\n\t\t\t}\n\n\t\t\t// the menu is forced to be thinner while the calendar is visible. this stops monkeyscroll from updating until it's gone.\n\t\t\tthis._$scrollable.data('disable-scroll', !!this._render_data.show_calendar);\n\t\t\tTS.ui.utility.updateClosestMonkeyScroller(this._$scrollable);\n\n\t\t\tTS.kb_nav.start(this._$menu.find('.results'), 'li', '.search_menu', {\n\t\t\t\tonMoveHighlight: _.bind(function() {\n\t\t\t\t\tthis._highlightModifierAndKeywordInSearchField();\n\t\t\t\t}, this),\n\t\t\t});\n\t\t\tTS.kb_nav.setAllowHighlightWithoutBlurringInput(true);\n\t\t},\n\n\t\t// the ordering of the `in:` items varies\n\t\t_conversationsHTML: function() {\n\t\t\tthis._combineChannelsAndGroups();\n\n\t\t\tvar data = this._render_data;\n\n\t\t\tvar channels_html, dms_html, groups_html;\n\n\t\t\tchannels_html = TS.templates.search_menu_channels(data);\n\t\t\tdms_html = TS.templates.search_menu_dms(data);\n\t\t\tgroups_html = TS.templates.search_menu_groups(data);\n\n\t\t\tvar regular_matches = [];\n\t\t\tvar archived_matches = [];\n\n\t\t\t// https://bugs.tinyspeck.com/7432\n\t\t\t// if the only matches in channels are for archived channels\n\t\t\t// but there are matches for non-archived groups\n\t\t\t// put the groups first\n\n\t\t\tif (data.channels && data.channels.length) {\n\t\t\t\tregular_matches.push(channels_html);\n\t\t\t} else {\n\t\t\t\tarchived_matches.push(channels_html);\n\t\t\t}\n\n\t\t\tif (data.dms && data.dms.length) {\n\t\t\t\tregular_matches.push(dms_html);\n\t\t\t} else {\n\t\t\t\tarchived_matches.push(dms_html);\n\t\t\t}\n\n\t\t\tif (data.groups && data.groups.length) {\n\t\t\t\tregular_matches.push(groups_html);\n\t\t\t} else {\n\t\t\t\tarchived_matches.push(groups_html);\n\t\t\t}\n\n\t\t\treturn regular_matches.join('') + archived_matches.join('');\n\t\t},\n\n\t\t_combineChannelsAndGroups: function() {\n\t\t\tvar all_channels = [];\n\t\t\tif ($.isArray(this._render_data.channels)) {\n\t\t\t\tall_channels = this._render_data.channels;\n\t\t\t}\n\t\t\tif ($.isArray(this._render_data.groups)) {\n\t\t\t\tall_channels = all_channels.concat(this._render_data.groups);\n\t\t\t}\n\n\t\t\tvar all_archived = [];\n\t\t\tif ($.isArray(this._render_data.channels_archived)) {\n\t\t\t\tall_archived = this._render_data.channels_archived;\n\t\t\t}\n\t\t\tif ($.isArray(this._render_data.groups_archived)) {\n\t\t\t\tall_archived = all_archived.concat(this._render_data.groups_archived);\n\t\t\t}\n\n\t\t\tall_channels.sort(function(a, b) { return b._score - a._score; });\n\t\t\tall_archived.sort(function(a, b) { return b._score - a._score; });\n\n\t\t\tthis._render_data.channels = all_channels;\n\t\t\tthis._render_data.channels_archived = all_archived;\n\n\t\t\t// if there are only archived channels to display, set `channels` to true\n\t\t\tif (all_archived.length > 0 && all_channels.length === 0) this._render_data.channels = true;\n\n\t\t\tdelete this._render_data.groups;\n\t\t\tdelete this._render_data.groups_archived;\n\t\t},\n\n\t\t// (re-)creates the calendar div and initializes the calendar plugin\n\t\t// need to re-init sometimes because the max date could change\n\t\t_initCalendar: function() {\n\t\t\tif (this._$calendar) this._$calendar.pickmeup('destroy').remove();\n\n\t\t\tthis._$calendar = $('<div/>').addClass(CALENDAR_CLASS).addClass(this.options.hidden_class).prependTo(this._$ac_menu);\n\n\t\t\tthis._$calendar.pickmeup({\n\t\t\t\tflat: true,\n\t\t\t\tfirst_day: window.moment.localeData().firstDayOfWeek() || 0,\n\t\t\t\tformat: CALENDAR_FORMAT,\n\t\t\t\tchange: $.proxy(this._onCalendarChange, this),\n\t\t\t\tmax: Date.now(),\n\t\t\t\tlocale: {\n\t\t\t\t\tdays: window.moment.weekdays(),\n\t\t\t\t\tdaysShort: window.moment.weekdaysShort(),\n\t\t\t\t\tdaysMin: window.moment.weekdaysMin(),\n\t\t\t\t\tmonths: window.moment.months(),\n\t\t\t\t\tmonthsShort: window.moment.monthsShort()\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t_setCalendarModifier: function(modifier) {\n\t\t\tthis._calendar_modifier = modifier;\n\t\t},\n\n\t\t_onTextInputMouseDown: function(e) {\n\t\t\tif (this._input_has_focus) {\n\t\t\t\tif (this._hideMenuIfTextSelected()) return;\n\n\t\t\t\t// this is a proxy for moving the cursor with the mouse\n\t\t\t\tsetTimeout($.proxy(function() {\n\t\t\t\t\tthis._saveCaretPosition();\n\t\t\t\t\tthis._showAutocompleteSuggestions();\n\t\t\t\t}, this), 0);\n\t\t\t}\n\t\t},\n\n\t\t_onTextInputMouseUp: function() {\n\t\t\tthis._saveCaretPosition();\n\t\t\tthis._hideMenuIfTextSelected();\n\t\t},\n\n\t\t_onMenuClick: function(e) {\n\t\t\tvar $clicked_item = $(e.target).closest(ITEM_WRAPPER_SEL);\n\n\t\t\tif (!$clicked_item.length) {\n\t\t\t\treturn this._hide();\n\t\t\t}\n\n\t\t\tvar replacement = $clicked_item.attr(REPLACEMENT_ATTR);\n\n\t\t\tif (this._isProfileItemElement($clicked_item)) {\n\t\t\t\tthis._handleProfileItem($clicked_item);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._isRevealHiddenElement($clicked_item)) {\n\t\t\t\tthis._revealHiddenItems($clicked_item);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._shouldAppendSpaceToItem($clicked_item)) {\n\t\t\t\tif (TS.boot_data.feature_texty_search) {\n\t\t\t\t\t/*\n\t\t\t\t\t * Don't allow the only replacement to be a space. This is helpful\n\t\t\t\t\t * because we'll sometimes choose _not_ to replace text if it's\n\t\t\t\t\t * already in the input\n\t\t\t\t\t *\n\t\t\t\t\t * i.e., relacement is \"me\" and text is \"from:me\"\n\t\t\t\t\t */\n\t\t\t\t\tif (replacement.length) {\n\t\t\t\t\t\treplacement += ' ';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treplacement += ' ';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._open_menu_on_focus = false;\n\t\t\tthis._texty_block_menu = this._shouldUseTextyAutocomplete(replacement);\n\n\t\t\tif (this._isHistoryItemElement($clicked_item)) {\n\t\t\t\tthis._replaceEntireInput(replacement);\n\t\t\t} else {\n\t\t\t\tthis._replaceCurrentWord(replacement);\n\t\t\t}\n\n\t\t\tif (this._texty_block_menu) {\n\t\t\t\tTS.utility.contenteditable.insertTextAtCursor(TS.search.input, '@');\n\t\t\t}\n\n\t\t\tthis._cancelDelayedSearch();\n\n\t\t\tif (this._isModifierItemElement($clicked_item)) {\n\t\t\t\tif (this._isModifierItemElementWithoutKeyword($clicked_item)) {\n\t\t\t\t\tthis._showKeywordAutocompleteMenu();\n\t\t\t\t\tthis._texty_block_menu = false;\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\t// we end up here if the user clicks on one of the modifier:keyword pairs, like 'on:yesterday'\n\t\t\t\t\tif (this.options.data.triggerSearch) this.options.data.triggerSearch();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.options.data.triggerSearch) this.options.data.triggerSearch();\n\t\t\t\tif (!this._isHistoryItemElement($clicked_item)) {\n\t\t\t\t\tthis._showAutocompleteSuggestions();\n\t\t\t\t\tthis._texty_block_menu = false;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._texty_block_menu = false;\n\t\t\tthis._hide();\n\t\t},\n\n\t\t_onClickDeleteHistoryItem: function(e) {\n\t\t\te.stopPropagation();\n\n\t\t\tvar $target = $(e.target).closest('li');\n\t\t\tvar query = $target.attr(REPLACEMENT_ATTR);\n\n\t\t\t// calls search.delete\n\t\t\tif (this.options.data.deleteHistoryItem) this.options.data.deleteHistoryItem(query);\n\n\t\t\t// remove local reference\n\t\t\tthis._current_history_items = this._current_history_items.filter(function(item) {\n\t\t\t\treturn item.text !== query;\n\t\t\t});\n\t\t\tthis._render_data.history = this._current_history_items;\n\n\t\t\t// refresh the menu\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t// this is for clicks on the highlighted suggestions in the footer tip\n\t\t_onClickFooterTipAction: function(e) {\n\t\t\tvar $target = $(e.target).closest('.footer_tip_action');\n\t\t\tvar replacement = $target.data('replacement');\n\t\t\tif (!replacement) return;\n\n\t\t\tthis._replaceCurrentWord(replacement);\n\t\t\tthis._showAutocompleteSuggestions();\n\t\t},\n\n\t\t_onMouseDownOutsideAutocomplete: function(e) {\n\t\t\t// check if the click was on the menu or the input\n\t\t\t// then close the menu\n\t\t\tif (!$.contains(this.element[0], e.target) && !$.contains(this._$popover[0], e.target) && this.element[0] !== e.target && this._$popover[0] !== e.target) {\n\t\t\t\tthis._hide();\n\t\t\t}\n\t\t},\n\n\t\t_onMouseDownMenu: function(e) {\n\t\t\t// prevent blur when clicking on the menu\n\t\t\te.preventDefault();\n\t\t},\n\n\t\t_onMouseEnter: function() {\n\t\t\tthis._mouse_in_menu = true;\n\t\t},\n\n\t\t_onMouseLeave: function() {\n\t\t\tthis._mouse_in_menu = false;\n\t\t},\n\n\t\tpreventMenuOnNextFocus: function() {\n\t\t\tthis._open_menu_on_focus = false;\n\t\t},\n\n\t\t_onTextInputFocus: function() {\n\t\t\tthis._block_menu = false;\n\t\t\tthis._cancelHide();\n\t\t\tsetTimeout($.proxy(function() {\n\t\t\t\tthis._input_has_focus = true;\n\t\t\t\tthis._saveCaretPosition();\n\n\t\t\t\tif (this._open_menu_on_focus) this._showAutocompleteSuggestions(true);\n\n\t\t\t\t// set to false when clicking on menu items and we need to refocus.\n\t\t\t\tthis._open_menu_on_focus = true;\n\t\t\t}, this), 0);\n\t\t},\n\n\t\t_onTextInputBlur: function() {\n\t\t\tthis._input_has_focus = false;\n\t\t\tif (!this._mouse_in_menu) {\n\t\t\t\tthis._requestHide();\n\t\t\t}\n\t\t},\n\n\t\t_onCalendarChange: function(formatted_date) {\n\t\t\tvar modifier_and_keyword = this._calendar_modifier + formatted_date + ' ';\n\t\t\tthis._open_menu_on_focus = false;\n\t\t\tthis._replaceCurrentWord(modifier_and_keyword);\n\t\t\tif (this.options.data.triggerSearch) this.options.data.triggerSearch();\n\t\t\tthis._hide();\n\t\t},\n\n\t\t_onTextInputKeydown: function(e) {\n\n\t\t\t_last_key_code = e.which;\n\n\t\t\t// don't want history results once the search is submitted\n\t\t\tif (e.keyCode === _key_codes.enter) {\n\t\t\t\tthis._handleEnterKey();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._block_menu = false;\n\n\t\t\tif (!this._menuShowing()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.keyCode === _key_codes.escape) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis._handleEscKey();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.keyCode === _key_codes.tab) {\n\t\t\t\tthis._handleTabKey();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Autocomplete on right arrow if the caret is at the end of the string\n\t\t\tif (e.keyCode === _key_codes.right && TS.utility.contenteditable.getLength(this.element) === this._getCaretPosition() && !TS.kb_nav.getHighlightedItem()) {\n\t\t\t\tsetTimeout(_.bind(function() {\n\t\t\t\t\t// kb_nav will not highlight on right arrow since it does not track caret position\n\t\t\t\t\tTS.kb_nav.highlightFirstItem();\n\t\t\t\t\tthis._highlightModifierAndKeywordInSearchField();\n\t\t\t\t}, this), 0);\n\t\t\t}\n\t\t},\n\n\t\t_handleTabKey: function() {\n\t\t\t// special case tabbing to the only item\n\t\t\t// this hack will be made unnecessary when we implement tab completions with ghost text\n\t\t\tif (this._menuShowing() && this._$menu_items.length === 1) {\n\t\t\t\tthis._selectFirstItem();\n\t\t\t}\n\t\t},\n\n\t\t_onTextInput: function(e) {\n\t\t\t// fixes an issue in IE where pressing tab in an empty textbox will fire an input event. No other\n\t\t\t// browser has this behavior, so this is required to fix a bug where pressing tab in the search box\n\t\t\t// would not move focus to the next element as expected with keyboard navigation.\n\t\t\tif (_last_key_code == 9) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._saveCaretPosition();\n\t\t\tthis._last_query = TS.utility.contenteditable.value(this.element);\n\n\t\t\tif (this._prevent_next_input_event) {\n\t\t\t\tthis._prevent_next_input_event = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._showAutocompleteSuggestions();\n\t\t},\n\n\t\t_onTextInputKeyup: function(e) {\n\t\t\tif (e.keyCode === _key_codes.escape) return;\n\t\t\tif (this._block_menu) return;\n\t\t\tif (this._hideMenuIfTextSelected()) return;\n\t\t},\n\n\t\t_selectFirstItem: function() {\n\t\t\tsetTimeout(_.bind(function() {\n\t\t\t\tthis._highlightModifierAndKeywordInSearchField();\n\n\t\t\t\t// submit the item\n\t\t\t\tthis._selectItem();\n\t\t\t}, this), 0);\n\t\t},\n\n\t\t_handleEnterKey: function() {\n\t\t\tthis._cancelCurrentHistoryQuery();\n\t\t\tthis._block_menu = true;\n\n\t\t\tif (this._menuShowing()) {\n\t\t\t\tvar fake_event = $.Event('keydown', {\n\t\t\t\t\ttarget: $('.' + this.options.selected_class, this._$menu),\n\t\t\t\t});\n\t\t\t\tthis._onMenuClick(fake_event);\n\t\t\t}\n\t\t},\n\n\t\t_handleEscKey: function() {\n\t\t\tif (this._menuShowing()) {\n\t\t\t\tthis._hide();\n\t\t\t}\n\t\t},\n\n\t\t_selectItem: function() {\n\t\t\tvar $selected_item = $('.' + this.options.selected_class, this._$menu);\n\t\t\tif (this._menuShowing()) {\n\t\t\t\tif ($selected_item.length > 0) {\n\t\t\t\t\tif (this._isProfileItemElement($selected_item)) {\n\t\t\t\t\t\tthis._handleProfileItem($selected_item);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._isRevealHiddenElement($selected_item)) {\n\t\t\t\t\t\tthis._revealHiddenItems($selected_item);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._shouldAppendSpaceToItem($selected_item)) {\n\t\t\t\t\t\t// insert space, move cursor forward one column\n\t\t\t\t\t\tvar query = TS.utility.contenteditable.value(this.element);\n\t\t\t\t\t\tvar caret_pos = this._getCaretPosition();\n\t\t\t\t\t\tquery = query.substring(0, caret_pos) + ' ' + query.substring(caret_pos);\n\t\t\t\t\t\tTS.utility.contenteditable.value(this.element, query);\n\t\t\t\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\t\t\t\tthis.element.trigger('change');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tTS.utility.contenteditable.cursorPosition(this.element, caret_pos + 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._modifierAutocompleteShowing() || this._isModifierItemElementWithoutKeyword($selected_item)) {\n\t\t\t\t\t\tthis._showKeywordAutocompleteMenu();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (this.options.data.triggerSearch) this.options.data.triggerSearch();\n\t\t\t\t\tthis._hide();\n\t\t\t\t} else {\n\t\t\t\t\t// enter kicks off a search, so hide the menu\n\t\t\t\t\tthis._hide();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_handleBackspaceKey: function(e) {\n\t\t\tvar mod_str_info = this._getCurrentModifyingStrDetails();\n\t\t\tif (mod_str_info) {\n\t\t\t\tvar text = TS.utility.contenteditable.value(this.element);\n\n\t\t\t\t// this is either the modifier (e.g. 'in:') or the keyword (e.g. '#general')\n\t\t\t\tvar slug_to_delete = null;\n\n\t\t\t\tif (mod_str_info.caret_in_keyword && this._keywordIsValid(mod_str_info.keyword.keyword, mod_str_info.modifier.modifier)) {\n\t\t\t\t\tslug_to_delete = mod_str_info.keyword;\n\t\t\t\t} else if (!mod_str_info.caret_in_keyword && this._modifierIsValid(mod_str_info.modifier.modifier)) {\n\t\t\t\t\tslug_to_delete = mod_str_info.modifier;\n\t\t\t\t}\n\n\t\t\t\tif (slug_to_delete) {\n\t\t\t\t\tvar new_val = this._replaceRange(text, slug_to_delete.start, slug_to_delete.start + slug_to_delete.length, '');\n\t\t\t\t\t// remove the whole word\n\t\t\t\t\tTS.utility.contenteditable.value(this.element, new_val);\n\t\t\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\t\t\tthis.element.trigger('change');\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// put the cursor where the beginning of the slug used to be\n\t\t\t\t\tthis.element.setCursorPosition(slug_to_delete.start);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_modifierIsValid: function(modifier) {\n\t\t\treturn !!modifier && this.options.data.modifiers_by_name[modifier];\n\t\t},\n\n\t\t_keywordIsValid: function(keyword, modifier) {\n\t\t\tvar modifier_details = this.options.data.modifiers_by_name[modifier];\n\t\t\tif (!modifier_details) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// use the same code that checks if the keyword should be highlighted\n\t\t\tfor (var i = 0; i < modifier_details.keyword_testers.length; i++) {\n\t\t\t\tif (modifier_details.keyword_testers[i](keyword)) return true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_showAutocompleteSuggestions: function(from_focus) {\n\t\t\tif (this._texty_block_menu) return;\n\n\t\t\tvar query = TS.utility.contenteditable.value(this.element);\n\n\t\t\tthis._cancelDelayedSearch();\n\n\t\t\t// re-init the calendar when the input is cleared\n\t\t\tif (!query) this._initCalendar();\n\n\t\t\tif (query && this._hasNonWhiteSpace(query)) {\n\t\t\t\tvar current_word = this._getWordAtCaretPosition();\n\t\t\t\tvar current_word_up_to_caret = this._getCurrentWordUpToCaret();\n\n\t\t\t\tif (current_word_up_to_caret && this._startsWith(current_word_up_to_caret, '+')) {\n\t\t\t\t\tthis._showModifierAutocompleteMenu(current_word_up_to_caret);\n\n\t\t\t\t} else if (current_word_up_to_caret && might_be_modifier_regex.test(current_word)) {\n\t\t\t\t\t// Might end up needing to confirm that it is actually a modifier here\n\t\t\t\t\t// and not just something that looks like it (x:x)\n\n\t\t\t\t\t// Need to determine if caret is on the modifier side or the keyword\n\t\t\t\t\t// side. i.e. \"from:@poo|pers\" or \"fro|m:@poopers\", where \"|\" is caret\n\n\t\t\t\t\tvar mod_str_info = this._getCurrentModifyingStrDetails();\n\t\t\t\t\tvar modifier = mod_str_info.modifier.modifier;\n\n\t\t\t\t\tif (mod_str_info.caret_in_keyword || mod_str_info.caret_is_modifier_adjacent) {\n\t\t\t\t\t\tthis._showKeywordAutocompleteMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._showModifierAutocompleteMenu(modifier);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tthis._getResultsForQueryObj({\n\t\t\t\t\t\tcurrent_word_up_to_caret: current_word_up_to_caret,\n\t\t\t\t\t\tcurrent_word: current_word,\n\t\t\t\t\t\tquery: query,\n\t\t\t\t\t}).then(function(results) {\n\t\t\t\t\t\tthis._render_data = results;\n\n\t\t\t\t\t\tthis._$popover.addClass('showing_query_header');\n\t\t\t\t\t\tthis._render_data.header = {\n\t\t\t\t\t\t\tquery: query,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis._render_data.show_modifier = true;\n\n\t\t\t\t\t\tif (this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\t\t\t\tthis._hide();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._syncUI();\n\t\t\t\t\t\t\tthis._show();\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}\n\n\t\t\t\t// only decide whether to show/hide if there's no pending search\n\t\t\t\tif (!this._search_pending) {\n\t\t\t\t\tif (this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\t\t\tthis._hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._syncUI();\n\t\t\t\t\t\tthis._show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (this._menuShowing() || from_focus) {\n\t\t\t\tthis._$popover.removeClass('showing_query_header');\n\t\t\t\t// The user hasn't typed anything yet, show them the modifier list menu\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmodifier_groups: true,\n\t\t\t\t\theader: true\n\t\t\t\t};\n\n\t\t\t\tthis._syncUI();\n\t\t\t\tthis._show();\n\t\t\t}\n\t\t},\n\n\t\t_showKeywordAutocompleteMenu: function() {\n\t\t\tif (this._texty_block_menu) return;\n\n\t\t\tvar mod_str_info = this._getCurrentModifyingStrDetails();\n\t\t\tvar modifier = this.options.data.modifiers_by_name[mod_str_info.modifier.modifier];\n\n\t\t\tif (!mod_str_info) {\n\t\t\t\tthrow this.widgetName + ': Lawdy how did you get here?';\n\t\t\t}\n\n\t\t\tvar keyword = mod_str_info.keyword.keyword;\n\n\t\t\t// show possible keywords if '+' follows the colon, e.g. 'during:+'\n\t\t\tif (this._startsWith(keyword, '+')) {\n\t\t\t\tthis._showSpecialKeywordsAutocompleteMenu(keyword, mod_str_info);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!modifier) return;\n\n\t\t\t// There's probably a better way? Are more automated way defined by the\n\t\t\t// set of modifiers itself? That way it can plug in to 3rd party things.\n\t\t\t// There should probably we a way to infer what autocomplete menu should\n\t\t\t// be showing based on the information we get from the server about the\n\t\t\t// modifiers.\n\t\t\tswitch (modifier.modifier) {\n\t\t\t\tcase 'from:':\n\t\t\t\t\tthis._showUserAutocompleteMenu(keyword);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// case 'group:':\n\t\t\t\t// \tthis._showGroupAutocompleteMenu(keyword);\n\t\t\t\t// \tbreak;\n\n\t\t\t\t// case 'channel:':\n\t\t\t\t// \tthis._showChannelAutocompleteMenu(keyword);\n\t\t\t\t// \tbreak;\n\n\t\t\t\tcase 'to:':\n\t\t\t\t\tthis._showConversationAutocompleteMenu(keyword, TS.i18n.t('to:', 'search_menu')());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'in:':\n\t\t\t\t\tthis._showConversationAutocompleteMenu(keyword, TS.i18n.t('in:', 'search_menu')());\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'during:':\n\t\t\t\tcase 'on:':\n\t\t\t\t\tthis._showDateAutocompleteMenu(keyword, mod_str_info.modifier.modifier);\n\t\t\t\t\tthis._setCalendarModifier(mod_str_info.modifier.modifier);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'after:':\n\t\t\t\tcase 'before:':\n\t\t\t\t\tthis._showDateAutocompleteMenu(keyword, mod_str_info.modifier.modifier);\n\t\t\t\t\tthis._setCalendarModifier(mod_str_info.modifier.modifier);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'has:':\n\t\t\t\t\tthis._showHasAutocompleteMenu(keyword);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t// show the default, no results footer/display\n\t\t\t\t\tthis._render_data = {\n\t\t\t\t\t\tfooter: true\n\t\t\t\t\t};\n\t\t\t\t\tthis._syncUI();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\n\t\t_showSpecialKeywordsAutocompleteMenu: function(query, mod_str_info) {\n\t\t\tvar modifier = this.options.data.modifiers_by_name[mod_str_info.modifier.modifier];\n\t\t\tvar rest_of_query = query.substring(1);\n\t\t\tvar exact_match;\n\t\t\tvar keywords = modifier.keywords.filter(function(keyword) {\n\t\t\t\tif (keyword === rest_of_query) exact_match = keyword;\n\t\t\t\treturn query === '+' || this._startsWith(keyword, rest_of_query);\n\t\t\t}, this);\n\n\t\t\t// for an exact match, remove the plus and start over\n\t\t\tif (exact_match) {\n\t\t\t\tthis._replaceCurrentWord(mod_str_info.modifier.modifier + exact_match);\n\t\t\t\tthis._showAutocompleteSuggestions();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// list possible keywords\n\t\t\tthis._render_data = {};\n\t\t\tthis._render_data.modifiers = keywords.map(function(keyword) {\n\t\t\t\treturn $.extend({}, modifier, {\n\t\t\t\t\tmatching_keyword: keyword\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn;\n\t\t},\n\n\t\t_showConversationAutocompleteMenu: function(query, modifier) {\n\t\t\tif (!query) {\n\t\t\t\t// Same as channel pane\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmenu_type: MENU_TYPES.conversation,\n\t\t\t\t\tconversation_modifier: modifier,\n\t\t\t\t\tspecial: this.options.data.conversationsStarred(),\n\t\t\t\t\tspecial_section_header: TS.i18n.t('Starred', 'search_menu')(),\n\t\t\t\t\tchannels: this.options.data.channelsOpen(),\n\t\t\t\t\tdms: this.options.data.usersOpen(),\n\t\t\t\t\tgroups: this.options.data.groupsOpen(),\n\t\t\t\t};\n\t\t\t\tthis._syncUI();\n\t\t\t} else {\n\t\t\t\tvar exclude_self = false;\n\t\t\t\tvar promises = [];\n\t\t\t\tvar _render_data = {\n\t\t\t\t\tmenu_type: MENU_TYPES.conversation,\n\t\t\t\t\tconversation_modifier: modifier,\n\t\t\t\t};\n\n\t\t\t\tpromises.push(this._getUsersForQuery(query, null, exclude_self).then(function(results) {\n\t\t\t\t\t_render_data.dms = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getUsersForQuery(query, null, exclude_self, true).then(function(results) {\n\t\t\t\t\t_render_data.dms_deleted = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getChannelsForQuery(query, null).then(function(results) {\n\t\t\t\t\t_render_data.channels = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getChannelsForQuery(query, null, true).then(function(results) {\n\t\t\t\t\t_render_data.channels_archived = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getGroupsForQuery(query, null).then(function(results) {\n\t\t\t\t\t_render_data.groups = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getGroupsForQuery(query, null, true).then(function(results) {\n\t\t\t\t\t_render_data.groups_archived = results;\n\t\t\t\t}));\n\n\t\t\t\tvar search_p = Promise.all(promises);\n\t\t\t\tsearch_p.then(function() {\n\t\t\t\t\tif (_render_data.dms.length === 0 && _render_data.dms_deleted.length > 0) {\n\t\t\t\t\t\t_render_data.dms = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_render_data.channels.length === 0 && _render_data.channels_archived.length > 0) {\n\t\t\t\t\t\t_render_data.channels = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_render_data.groups.length === 0 && _render_data.groups_archived.length > 0) {\n\t\t\t\t\t\t_render_data.groups = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._render_data = _render_data;\n\t\t\t\t\tthis._search_pending = false;\n\n\t\t\t\t\tif (this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\t\t\tthis._hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._syncUI();\n\t\t\t\t\t\tthis._show();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\n\t\t\t\tthis._search_promises.push(search_p);\n\t\t\t\tthis._search_pending = true;\n\t\t\t}\n\t\t},\n\n\t\t_showDateAutocompleteMenu: function(query, modifier_str) {\n\t\t\t// for empty queries and queries that start with a number, show the calendar\n\t\t\t// for everything else, suggest matching keywords\n\n\t\t\tvar not_number = query.length > 0 && /^\\D/.test(query);\n\t\t\tvar modifier = this.options.data.modifiers_by_name[modifier_str];\n\t\t\tvar keywords;\n\n\t\t\tif (not_number) {\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tshow_calendar: false\n\t\t\t\t};\n\t\t\t\tkeywords = modifier.keywords.filter(function(keyword) {\n\t\t\t\t\treturn this._startsWith(keyword, query);\n\t\t\t\t}, this);\n\t\t\t\tthis._render_data.modifiers = keywords.map(function(keyword) {\n\t\t\t\t\treturn $.extend({}, modifier, {\n\t\t\t\t\t\tmatching_keyword: keyword\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmenu_type: MENU_TYPES.date,\n\t\t\t\t\tshow_calendar: true,\n\t\t\t\t\tfooter: {\n\t\t\t\t\t\tcalendar_tip: true\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t_showChannelAutocompleteMenu: function(query) {\n\t\t\t// NOTE: Deprecated\n\n\t\t\tthis._render_data = {\n\t\t\t\tmenu_type: MENU_TYPES.channel,\n\t\t\t\tconversation_modifier: DEFAULT_CONVERSATION_MODIFIER,\n\t\t\t\tchannels: _getChannelsForQuery(query, CHANNEL_RESULT_LIMIT)\n\t\t\t};\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t_showGroupAutocompleteMenu: function(query) {\n\t\t\t// NOTE: Deprecated\n\n\t\t\tthis._render_data = {\n\t\t\t\tmenu_type: MENU_TYPES.group,\n\t\t\t\tconversation_modifier: DEFAULT_CONVERSATION_MODIFIER,\n\t\t\t\tgroups: _getGroupsForQuery(query, GROUP_RESULT_LIMIT)\n\t\t\t};\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t_showUserAutocompleteMenu: function(query) {\n\t\t\tif (this._texty_block_menu) return;\n\n\t\t\tthis._render_data = {\n\t\t\t\tmenu_type: MENU_TYPES.user\n\t\t\t};\n\n\t\t\tif (!query || (query.length === 1 && query.charAt(0) === '@')) {\n\t\t\t\t// show open and starred DMs\n\t\t\t\tthis._render_data.conversation_modifier = TS.i18n.t('from:', 'search_menu')();\n\t\t\t\tthis._render_data.special = this.options.data.usersStarred().concat(this.options.data.usersOpen());\n\t\t\t\tthis._render_data.special_section_header = TS.i18n.t('Starred and recent', 'search_menu')();\n\t\t\t\t// adds from:me to the list of suggestions\n\t\t\t\tvar modifier = this.options.data.modifiers_by_name['from:'];\n\t\t\t\tthis._render_data.modifiers = modifier.keywords.map(function(keyword) {\n\t\t\t\t\treturn $.extend({}, modifier, {\n\t\t\t\t\t\tmatching_keyword: keyword\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis._syncUI();\n\t\t\t} else {\n\t\t\t\tvar promises = [];\n\t\t\t\tvar _render_data = {\n\t\t\t\t\tmenu_type: MENU_TYPES.user,\n\t\t\t\t};\n\n\t\t\t\tpromises.push(this._getUsersForQuery(query, null).then(function(results) {\n\t\t\t\t\t_render_data.users = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getUsersForQuery(query, null, false, true).then(function(results) {\n\t\t\t\t\t_render_data.users_deleted = results;\n\t\t\t\t}));\n\n\t\t\t\tvar search_p = Promise.all(promises);\n\t\t\t\tsearch_p.then(function() {\n\t\t\t\t\tif (_render_data.users.length === 0 && _render_data.users_deleted.length > 0) {\n\t\t\t\t\t\t_render_data.users = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._render_data = _render_data;\n\t\t\t\t\tthis._search_pending = false;\n\n\t\t\t\t\tif (this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\t\t\tthis._hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._syncUI();\n\t\t\t\t\t\tthis._show();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\n\t\t\t\tthis._search_promises.push(search_p);\n\t\t\t\tthis._search_pending = true;\n\t\t\t}\n\t\t},\n\n\t\t_showHasAutocompleteMenu: function(query) {\n\t\t\tthis._render_data = {\n\t\t\t\tmenu_type: MENU_TYPES.has,\n\t\t\t\thas: []\n\t\t\t};\n\t\t\tthis.options.data.modifiers_by_name['has:'].keywords.forEach($.proxy(function(keyword) {\n\t\t\t\tif (query === '' || this._startsWith(keyword, query)) {\n\t\t\t\t\tthis._render_data.has.push({\n\t\t\t\t\t\tname: keyword\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, this));\n\t\t\tthis._syncUI();\n\t\t},\n\n\n\t\t_showModifierAutocompleteMenu: function(query) {\n\t\t\tvar by_name = this.options.data.modifiers_by_name;\n\t\t\tif (query && this._startsWith(query, '+')) {\n\t\t\t\tquery = query.substring(1);\n\t\t\t\tif (by_name[query]) {\n\t\t\t\t\t// starts with + and is an exact match, e.g. +has:\n\t\t\t\t\t// remove the plus and start over\n\t\t\t\t\tthis._replaceCurrentWord(query);\n\t\t\t\t\tthis._showAutocompleteSuggestions();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!query) {\n\t\t\t\t// the full list is hard-coded in the template to preserve my sanity.\n\n\t\t\t\tthis._$popover.removeClass('showing_query_header');\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmodifier_groups: true,\n\t\t\t\t\theader: true\n\t\t\t\t};\n\n\t\t\t} else {\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmodifiers: this._getModifiersForQuery(query, true),\n\t\t\t\t\tmenu_type: MENU_TYPES.modifier\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t// Fetch all the information you need about the current modifier-keyword pair\n\t\t// and the caret's position inside it.\n\t\t_getCurrentModifyingStrDetails: function() {\n\t\t\tvar caret_pos = this._getCaretPosition();\n\t\t\tvar modifying_str_range = this._getWordRangeAtCaretPosition(caret_pos);\n\n\t\t\tif (!modifying_str_range || modifying_str_range.length === 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar modifying_str = this._getWordAtCaretPosition(); // i.e. x:x\n\t\t\tvar word_colon_index = modifying_str.indexOf(':'); // index of colon in current x:x\n\t\t\tvar query_colon_index = TS.utility.contenteditable.value(this.element).indexOf(':', modifying_str_range.start); // index of same colon in the whole query\n\t\t\tvar modifier_str = modifying_str.slice(0, word_colon_index + 1);\n\n\t\t\treturn {\n\t\t\t\tmodifier: {\n\t\t\t\t\tstart: modifying_str_range.start,\n\t\t\t\t\tlength: word_colon_index + 1,\n\t\t\t\t\tmodifier: modifier_str\n\t\t\t\t},\n\t\t\t\tkeyword: {\n\t\t\t\t\tstart: modifying_str_range.start + word_colon_index + 1,\n\t\t\t\t\tlength: modifying_str.length - modifier_str.length,\n\t\t\t\t\tkeyword: modifying_str.slice(word_colon_index + 1)\n\t\t\t\t},\n\t\t\t\tcaret_in_keyword: caret_pos > query_colon_index + 1,\n\t\t\t\tcaret_is_modifier_adjacent: caret_pos === query_colon_index + 1\n\t\t\t};\n\t\t},\n\n\t\t_highlightModifierAndKeywordInSearchField: function() {\n\t\t\tvar $highlighted_item = TS.kb_nav.getHighlightedItem();\n\n\t\t\tif (!$highlighted_item || !$highlighted_item.length) return;\n\n\t\t\tvar replacement = $highlighted_item.attr(REPLACEMENT_ATTR);\n\n\t\t\tif (replacement) {\n\t\t\t\tthis._prevent_next_input_event = true;\n\t\t\t\tthis._replaceCurrentWord(replacement);\n\t\t\t}\n\t\t},\n\n\t\t// open member preview in the flexpane\n\t\t_handleProfileItem: function($item) {\n\t\t\tvar id = $item.data('member-id');\n\t\t\tvar bot_id = $item.data('bot-id');\n\t\t\tTS.search.autocomplete.clearInput();\n\n\t\t\tif(bot_id) {\n\t\t\t\tthis.options.data.openBotProfile(bot_id);\n\t\t\t} else {\n\t\t\t\tthis.options.data.openProfile(id);\n\t\t\t}\n\t\t\tthis._hide();\n\t\t},\n\n\t\t_revealHiddenItems: function($item) {\n\t\t\tvar $to_reveal = $item.nextAll('.'+this.options.hidden_class);\n\t\t\t$item.addClass(this.options.hidden_class);\n\t\t\t$to_reveal.removeClass(this.options.hidden_class);\n\t\t},\n\n\t\t_deduplicateModifiers: function(modifiers) {\n\t\t\tvar deduped_modifiers = [];\n\t\t\tvar unique_modifier_names = [];\n\t\t\tmodifiers.forEach(function(modifier_details) {\n\t\t\t\tif (unique_modifier_names.indexOf(modifier_details.modifier) === -1) {\n\t\t\t\t\tdeduped_modifiers.push(modifier_details);\n\t\t\t\t\tunique_modifier_names.push(modifier_details.modifier);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn deduped_modifiers;\n\t\t},\n\n\t\t_getUsersForQuery: function(query, limit, exclude_self, just_deleted) {\n\t\t\tif (TS.boot_data.feature_more_texty_search) {\n\t\t\t\t// We'll rely on TabComplete's members under Texty search\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}\n\n\t\t\treturn TS.searcher.search(query, {\n\t\t\t\tmembers: {\n\t\t\t\t\tinclude_slackbot: true,\n\t\t\t\t\tinclude_self: !exclude_self,\n\t\t\t\t\tinclude_deleted: true,\n\t\t\t\t},\n\t\t\t\tlimit: limit,\n\t\t\t\tsort: { allow_empty_query: true },\n\t\t\t}).then(function(results) {\n\t\t\t\tvar models = _.map(results, 'model_ob');\n\t\t\t\tif (just_deleted) {\n\t\t\t\t\tmodels = _.filter(models, 'deleted');\n\t\t\t\t} else {\n\t\t\t\t\tmodels = _.filter(models, function(m) {\n\t\t\t\t\t\treturn !m.deleted;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn models;\n\t\t\t});\n\t\t},\n\n\t\t_getModifiersForQuery: function(query, exclude_keywords) {\n\t\t\tvar results = [];\n\t\t\t// find matching modifiers first because they should be at the top of the list\n\n\t\t\tthis.options.data.modifiers.forEach(function(modifier) {\n\t\t\t\t// matching modifiers\n\t\t\t\tif (this._startsWith(modifier.modifier, query) || this._startsWith(modifier.name, query)) {\n\t\t\t\t\tresults.push($.extend({}, modifier));\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tthis.options.data.modifiers.forEach(function(modifier) {\n\t\t\t\t// *and* modifier keywords!\n\t\t\t\tif (!exclude_keywords) {\n\t\t\t\t\tmodifier.keywords.forEach(function(keyword) {\n\t\t\t\t\t\tif (this._startsWith(keyword, query)) {\n\t\t\t\t\t\t\tresults.push($.extend({}, modifier, {\n\t\t\t\t\t\t\t\tmatching_keyword: keyword\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\n\t\t\t\t\tif (modifier.dynamic_keywords && modifier.dynamic_keywords.length > 0) {\n\t\t\t\t\t\tmodifier.dynamic_keywords.forEach(function(dynamic_keyword) {\n\t\t\t\t\t\t\tif (dynamic_keyword(query)) {\n\t\t\t\t\t\t\t\tresults.push($.extend({}, modifier, {\n\t\t\t\t\t\t\t\t\tmatching_keyword: query\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tresults = this._deduplicateModifiers(results);\n\t\t\treturn results;\n\t\t},\n\n\t\t_getChannelsForQuery: function(query, limit, just_archived) {\n\t\t\treturn TS.searcher.search(query, {\n\t\t\t\tchannels: {\n\t\t\t\t\tinclude_archived: true,\n\t\t\t\t},\n\t\t\t\tlimit: limit,\n\t\t\t\tsort: { allow_empty_query: true },\n\t\t\t}).then(function(results) {\n\t\t\t\tvar models = _.map(results, function(result) {\n\t\t\t\t\tvar model_ob = result.model_ob;\n\t\t\t\t\tmodel_ob._score = result.score;\n\t\t\t\t\treturn model_ob;\n\t\t\t\t});\n\t\t\t\tif (just_archived) {\n\t\t\t\t\tmodels = _.filter(models, 'is_archived');\n\t\t\t\t} else {\n\t\t\t\t\tmodels = _.filter(models, function(m) {\n\t\t\t\t\t\treturn !m.is_archived;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn models;\n\t\t\t});\n\t\t},\n\n\t\t_getGroupsForQuery: function(query, limit, just_archived) {\n\t\t\treturn TS.searcher.search(query, {\n\t\t\t\tgroups: true,\n\t\t\t\tlimit: limit,\n\t\t\t\tsort: { allow_empty_query: true },\n\t\t\t}).then(function(results) {\n\t\t\t\tvar models = _.map(results, function(result) {\n\t\t\t\t\tvar model_ob = result.model_ob;\n\t\t\t\t\tmodel_ob._score = result.score;\n\t\t\t\t\treturn model_ob;\n\t\t\t\t});\n\t\t\t\tif (just_archived) {\n\t\t\t\t\tmodels = _.filter(models, 'is_archived');\n\t\t\t\t} else {\n\t\t\t\t\tmodels = _.filter(models, function(m) {\n\t\t\t\t\t\treturn !m.is_archived;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn models;\n\t\t\t});\n\t\t},\n\n\t\t_getHistoryForQuery: function(query) {\n\t\t\t// same query, same result:\n\t\t\tif (query === this._current_history_query) return this._current_history_items;\n\n\t\t\t// new query, clear out current history data:\n\t\t\tthis._current_history_query = query;\n\t\t\tthis._current_history_items = [];\n\n\t\t\t// make api request\n\t\t\t// when it returns the ui will update\n\t\t\tthis.options.data.history(query, $.proxy(this._historyFetched, this));\n\n\t\t\treturn this._current_history_items;\n\t\t},\n\n\t\t_getResultsForQueryObj: function(query_obj) {\n\t\t\tvar results = {\n\t\t\t\tconversation_modifier: DEFAULT_CONVERSATION_MODIFIER,\n\t\t\t\tquery: query,\n\t\t\t};\n\n\t\t\tvar is_at = false;\n\t\t\tvar is_hash = false;\n\n\t\t\tif (!query_obj) {\n\t\t\t\treturn results;\n\t\t\t}\n\n\n\t\t\tvar promises = [];\n\n\t\t\tif (query_obj.current_word_up_to_caret) {\n\t\t\t\tvar query = query_obj.current_word_up_to_caret.toLowerCase();\n\t\t\t\tis_hash = query === '#';\n\t\t\t\tis_at = query === '@';\n\n\t\t\t\tresults.modifiers = this._getModifiersForQuery(query);\n\n\t\t\t\tpromises.push(this._getUsersForQuery(query, is_at ? null : USER_RESULT_LIMIT).then(function(r) {\n\t\t\t\t\tresults.users = r;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getChannelsForQuery(query, is_hash ? null : CHANNEL_RESULT_LIMIT).then(function(r) {\n\t\t\t\t\tresults.channels = r;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getGroupsForQuery(query, GROUP_RESULT_LIMIT).then(function(r) {\n\t\t\t\t\tresults.groups = r;\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tif (!is_at) {\n\t\t\t\tpromises.push(this._getUsersForQuery(query_obj.query, PROFILE_RESULT_LIMIT).then(function(r) {\n\t\t\t\t\tresults.profiles = r;\n\t\t\t\t\tTS.presence_manager.queryMemberPresence(_.map(r, 'id'));\n\t\t\t\t\treturn null;\n\t\t\t\t}));\n\t\t\t}\n\t\t\tif (!is_at && !is_hash) results.history = this._getHistoryForQuery(query_obj.query);\n\n\t\t\tvar models_p = Promise.all(promises).then(function() {\n\t\t\t\tthis._search_pending = false;\n\t\t\t\treturn results;\n\t\t\t}.bind(this));\n\n\t\t\tthis._search_promises.push(models_p);\n\t\t\tthis._search_pending = true;\n\n\t\t\treturn models_p;\n\t\t},\n\n\t\t_getCurrentWordUpToCaret: function() {\n\t\t\tvar caret_pos = this._getCaretPosition();\n\t\t\tvar text = TS.utility.contenteditable.value(this.element);\n\t\t\tvar pre_caret_text = text.substring(0, caret_pos);\n\t\t\tvar wurds = pre_caret_text.split(' ');\n\t\t\tvar current_word = wurds[wurds.length - 1];\n\n\t\t\tif (current_word) {\n\t\t\t\treturn current_word;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\n\t\t_getCaretPosition: function() {\n\t\t\treturn this._caret_position;\n\t\t},\n\n\t\t_getRealCaretPosition: function() {\n\t\t\t// we can swap this with whatever method we use to get cursor position index,\n\t\t\t// provided that for the string \"0123|45\" it would return 4, if \"|\" is the caret\n\t\t\treturn TS.utility.contenteditable.cursorPosition(this.element).start;\n\t\t},\n\n\t\t_saveCaretPosition: function() {\n\t\t\t// save the last known value because clicking on menu items causes the element to lose focus\n\t\t\tthis._caret_position = this._getRealCaretPosition();\n\t\t},\n\n\t\t_shouldUseTextyAutocomplete: function(word) {\n\t\t\tif (!TS.boot_data.feature_more_texty_search) return false;\n\n\t\t\tif (Array.isArray(word)) {\n\t\t\t\tif (word[word.length-1].insert === 'from:') return true;\n\t\t\t} else {\n\t\t\t\tif (word.endsWith('from:')) return true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_replaceCurrentWord: function(word) {\n\t\t\tif (!word) {\n\t\t\t\tthrow this.widgetName + ': A replacement word must be provided.';\n\t\t\t}\n\n\t\t\tvar word_range = this._getWordRangeAtCaretPosition();\n\n\t\t\tif (TS.boot_data.feature_more_texty_search) {\n\t\t\t\tTS.utility.contenteditable.cursorPosition(this.element, word_range.start, word_range.length);\n\t\t\t\tTS.utility.contenteditable.insertContentsAtCursor(this.element, TS.format.texty.convertContentsStringToContents(word));\n\t\t\t} else {\n\t\t\t\tvar text = TS.utility.contenteditable.value(this.element);\n\t\t\t\tvar new_text = this._replaceRange(text, word_range.start, word_range.start + word_range.length, word);\n\n\t\t\t\tTS.utility.contenteditable.value(this.element, new_text);\n\t\t\t\tTS.utility.contenteditable.cursorPosition(this.element, word_range.start + word.length);\n\t\t\t}\n\n\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\tthis.element\n\t\t\t\t\t.trigger('change')\n\t\t\t\t\t// scroll all the way to the right (good enough for now)\n\t\t\t\t\t.scrollLeft(10000);\n\t\t\t}\n\n\t\t\tthis._saveCaretPosition();\n\t\t},\n\n\t\t_replaceEntireInput: function(str) {\n\t\t\tTS.utility.contenteditable.value(this.element, str);\n\t\t\tTS.utility.contenteditable.setCursorAtEnd(this.element);\n\n\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\tthis.element\n\t\t\t\t\t.trigger('change')\n\t\t\t\t\t// scroll all the way to the right\n\t\t\t\t\t.scrollLeft(10000);\n\t\t\t}\n\n\t\t\tthis._saveCaretPosition();\n\t\t},\n\n\t\t_startsWith: function(str, prefix) {\n\t\t\tif (!str ||\n\t\t\t\t!prefix ||\n\t\t\t\tstr.length < prefix.length\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//return str.slice(0, prefix.length) === prefix; // faster with long strings\n\t\t\treturn str.indexOf(prefix) === 0; // faster with shorter strings\n\t\t},\n\n\t\t_getWordAtCaretPosition: function(caret_pos) {\n\t\t\tif (typeof caret_pos === 'undefined') {\n\t\t\t\tcaret_pos = this._getCaretPosition();\n\t\t\t}\n\n\t\t\tvar range = this._getWordRangeAtCaretPosition(caret_pos);\n\t\t\tvar word = TS.utility.contenteditable.displayValue(this.element).slice(range.start, range.start + range.length);\n\t\t\treturn word || null;\n\t\t},\n\n\t\t// Get the start and length of the word the caret is in or immediately adjacent to\n\t\t_getWordRangeAtCaretPosition: function(caret_pos) {\n\t\t\tif (typeof caret_pos === 'undefined') {\n\t\t\t\tcaret_pos = this._getCaretPosition();\n\t\t\t}\n\n\n\t\t\tif (TS.boot_data.feature_more_texty_search) {\n\t\t\t\tvar range = {\n\t\t\t\t\tstart: 0,\n\t\t\t\t\tlength: 0,\n\t\t\t\t};\n\n\t\t\t\t// Get display value in order to avoid the longer length of the contents string\n\t\t\t\tvar txt = TS.utility.contenteditable.displayValue(this.element);\n\t\t\t\tif (!txt.length) return range;\n\n\t\t\t\t// Find start of word\n\t\t\t\tvar current_pos = caret_pos - 1;\n\t\t\t\tif (caret_pos > 0) {\n\t\t\t\t\t// Keep looking backwards until we find a space (or hit zero)\n\t\t\t\t\t// If that space is formatted as a mention, ignore it\n\t\t\t\t\twhile (current_pos > 0) {\n\t\t\t\t\t\tif (txt.charAt(current_pos) === ' ') {\n\t\t\t\t\t\t\t// The space after a mention ends will register as being formatted\n\t\t\t\t\t\t\tvar formats = TS.utility.contenteditable.getFormats(this.element, current_pos);\n\t\t\t\t\t\t\tvar formats_next = TS.utility.contenteditable.getFormats(this.element, current_pos+1);\n\t\t\t\t\t\t\tif (!formats.slackmention || !formats_next.slackmention) {\n\t\t\t\t\t\t\t\trange.start = current_pos + 1;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrent_pos = current_pos - 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Find end of word\n\t\t\t\tif (caret_pos === txt.length) {\n\t\t\t\t\trange.length = caret_pos - range.start;\n\t\t\t\t} else {\n\t\t\t\t\t// Keep looking forward until we find a space (or hit end of string)\n\t\t\t\t\t// If that space is formatted as a mention, ignore it\n\t\t\t\t\tcurrent_pos = caret_pos;\n\n\t\t\t\t\twhile (current_pos < txt.length) {\n\t\t\t\t\t\tif (txt.charAt(current_pos) === ' ') {\n\t\t\t\t\t\t\tvar formats = TS.utility.contenteditable.getFormats(this.element, current_pos);\n\t\t\t\t\t\t\tif (!formats.slackmention) {\n\t\t\t\t\t\t\t\trange.length = Math.max(current_pos - range.start, 0);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrent_pos = current_pos + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Return range\n\t\t\t\treturn range;\n\t\t\t} else {\n\t\t\t\tvar preceeding_char_index = caret_pos - 1;\n\t\t\t\tvar words = TS.utility.contenteditable.value(this.element).split(' ');\n\n\t\t\t\tvar range = {\n\t\t\t\t\tstart: 0,\n\t\t\t\t\tlength: words[0].length || 0\n\t\t\t\t};\n\n\t\t\t\tvar caret_pos_in_word_range = words.some(function(word, index) {\n\t\t\t\t\tif (preceeding_char_index >= range.start && preceeding_char_index < range.start + range.length) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tif (preceeding_char_index === range.start - 1) {\n\t\t\t\t\t\trange.start = caret_pos;\n\t\t\t\t\t\trange.length = 0;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tif (index + 1 < words.length) {\n\t\t\t\t\t\trange.start = range.start + word.length + 1;\n\t\t\t\t\t\trange.length = words[index + 1].length;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\n\t\t\t\tif (caret_pos_in_word_range) {\n\t\t\t\t\treturn range;\n\t\t\t\t}\n\t\t\t\trange.start = caret_pos;\n\t\t\t\trange.length = 0;\n\t\t\t\treturn range;\n\t\t\t}\n\t\t},\n\n\t\t// takes a string of text and replaces the text between two indices\n\t\t_replaceRange: function(str, start, end, what) {\n\t\t\tvar prefix = str.substring(0, start);\n\t\t\tvar suffix = str.substring(end);\n\n\t\t\tvar new_str;\n\n\t\t\tif (suffix === str) {\n\t\t\t\tnew_str = what;\n\t\t\t} else {\n\t\t\t\tnew_str = prefix + what + suffix;\n\t\t\t}\n\t\t\treturn new_str;\n\t\t},\n\n\t\t_menuShowing: function() {\n\t\t\treturn this._$menu.is(':visible');\n\t\t},\n\n\t\t_hasNonWhiteSpace: function(str) {\n\t\t\treturn str && /\\S/.test(str);\n\t\t},\n\n\t\t_modifierAutocompleteShowing: function() {\n\t\t\treturn this._render_data.menu_type === MENU_TYPES.modifier;\n\t\t},\n\n\t\t// this function is called after we've collected some results for the autocomplete and we want to determine\n\t\t// if we'll show it.\n\t\t_resultSetIsEmpty: function(results) {\n\t\t\tif (results.show_calendar) return false;\n\t\t\tif (results.modifier_groups) return false;\n\n\t\t\t// all this is to handle the case where this only one item but the\n\t\t\t// input already contains it\n\n\t\t\tvar replacements = null;\n\n\t\t\tif (results.modifiers) {\n\t\t\t\tif (results.modifiers.length > 1) return false;\n\t\t\t\tif (results.modifiers.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [results.modifiers[0].modifier + results.modifiers[0].matching_keyword];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.has) {\n\t\t\t\tif (results.has.length > 1) return false;\n\t\t\t\tif (results.has.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = ['has:' + results.has[0].name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.users) {\n\t\t\t\tif (results.users.length > 1) return false;\n\t\t\t\tif (results.users.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\t'from:' + results.users[0].name,\n\t\t\t\t\t\t'from:@' + results.users[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.users_deleted) {\n\t\t\t\tif (results.users_deleted.length > 1) return false;\n\t\t\t\tif (results.users_deleted.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\t'from:' + results.users_deleted[0].name,\n\t\t\t\t\t\t'from:@' + results.users_deleted[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.dms) {\n\t\t\t\tif (results.dms.length > 1) return false;\n\t\t\t\tif (results.dms.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\tresults.conversation_modifier + results.dms[0].name,\n\t\t\t\t\t\tresults.conversation_modifier + '@' + results.dms[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.dms_deleted) {\n\t\t\t\tif (results.dms_deleted.length > 1) return false;\n\t\t\t\tif (results.dms_deleted.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\tresults.conversation_modifier + results.dms_deleted[0].name,\n\t\t\t\t\t\tresults.conversation_modifier + '@' + results.dms_deleted[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.channels) {\n\t\t\t\tif (results.channels.length > 1) return false;\n\t\t\t\tif (results.channels.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\tresults.conversation_modifier + results.channels[0].name,\n\t\t\t\t\t\tresults.conversation_modifier + '#' + results.channels[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.channels_archived) {\n\t\t\t\tif (results.channels_archived.length > 1) return false;\n\t\t\t\tif (results.channels_archived.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\tresults.conversation_modifier + results.channels_archived[0].name,\n\t\t\t\t\t\tresults.conversation_modifier + '#' + results.channels_archived[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.groups) {\n\t\t\t\tif (results.groups.length > 1) return false;\n\t\t\t\tif (results.groups.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [results.conversation_modifier + results.groups[0].name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.groups_archived) {\n\t\t\t\tif (results.groups_archived.length > 1) return false;\n\t\t\t\tif (results.groups_archived.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [results.conversation_modifier + results.groups_archived[0].name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.history) {\n\t\t\t\tif (results.history.length > 1) return false;\n\t\t\t\tif (results.history.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [results.history[0].text];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (replacements) {\n\t\t\t\tvar current_word = this._getWordAtCaretPosition();\n\t\t\t\tvar any = replacements.some(function(r) {\n\t\t\t\t\treturn r === current_word;\n\t\t\t\t});\n\t\t\t\treturn any;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\t_isHistoryItemElement: function(element) {\n\t\t\tif (!element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\t\t\t// Cuz in the HTML the modifiers ol has this class\n\t\t\treturn element && $(element).closest(ITEM_GROUP_WRAPPER_SEL).hasClass(HISTORY_LIST_CLASS);\n\t\t},\n\n\t\t_isModifierItemElement: function(element) {\n\t\t\tif (!element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\t\t\t// Cuz in the HTML the modifiers ol has this class\n\t\t\treturn element && $(element).closest(ITEM_GROUP_WRAPPER_SEL).hasClass(MODIFIERS_LIST_CLASS);\n\t\t},\n\n\t\t_isProfileItemElement: function($element) {\n\t\t\tif (!$element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\t\t\treturn $element.closest(ITEM_GROUP_WRAPPER_SEL).hasClass(PROFILE_LIST_CLASS);\n\t\t},\n\n\t\t_isRevealHiddenElement: function($element) {\n\t\t\treturn $element.hasClass('reveal_hidden_items');\n\t\t},\n\n\t\t_modifierItemElementHasKeyword: function (element) {\n\t\t\tif (!element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\t\t\treturn !!$(element).attr(MATCHING_KEYWORD_ATTR);\n\t\t},\n\n\t\t_isModifierItemElementWithoutKeyword: function (element) {\n\t\t\treturn this._isModifierItemElement(element) && !this._modifierItemElementHasKeyword(element);\n\t\t},\n\n\t\t_shouldAppendSpaceToItem: function (element) {\n\t\t\tif (!element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\n\t\t\tif (this._modifierAutocompleteShowing()) return false;\n\t\t\tif (this._isModifierItemElement(element)) return this._modifierItemElementHasKeyword(element);\n\t\t\tif (this._isHistoryItemElement(element)) return false;\n\n\t\t\treturn true;\n\t\t},\n\n\t\t// callback for search.autocomplete api calls\n\t\t_historyFetched: function(query, suggestions) {\n\t\t\tif (this._block_menu) return;\n\t\t\t// a newer request has been submitted:\n\t\t\tif (query !== this._current_history_query) return;\n\t\t\t// input has changed:\n\t\t\tif (query !== TS.utility.contenteditable.value(this.element)) return;\n\t\t\t// user has started selecting things, don't change the dom:\n\t\t\tif (this._menu_index) return;\n\t\t\t// if only one suggestion and it's an exact match, don't suggest it\n\t\t\tif (suggestions.length === 1 && suggestions[0] === query) return;\n\n\t\t\tvar highlighter_plugin = this.element.data('TS-highlighter');\n\t\t\tthis._current_history_items = suggestions.map(function(history_str) {\n\t\t\t\tvar display_str = history_str;\n\t\t\t\tif (TS.boot_data.feature_more_texty_search) {\n\t\t\t\t\tdisplay_str = TS.format.texty.convertContentsToStringForDisplay(TS.format.texty.convertContentsStringToContents(history_str));\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\ttext: history_str,\n\t\t\t\t\thtml: new Handlebars.SafeString(highlighter_plugin ? highlighter_plugin.highlightStr(display_str, true) : display_str)\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tthis._render_data.history = this._current_history_items;\n\n\t\t\tif (!this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\tthis._render_data.noResults = false;\n\t\t\t\tthis._syncUI();\n\t\t\t\tthis._show();\n\t\t\t}\n\n\t\t},\n\n\t\t_cancelCurrentHistoryQuery: function() {\n\t\t\t// this will cause the response to be ignored\n\t\t\tthis._current_history_query = null;\n\t\t},\n\n\t\t// if text is selected in the input, hide the autocomplete menu\n\t\t// returns true if it was hidden\n\t\t_hideMenuIfTextSelected: function() {\n\t\t\tvar range = TS.utility.contenteditable.cursorPosition(this.element);\n\n\t\t\tif (range.start !== range.end) {\n\t\t\t\tthis._hide();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_cancelDelayedSearch: function() {\n\t\t\t_.each(this._search_promises, function(promise) {\n\t\t\t\tpromise.cancel();\n\t\t\t});\n\t\t\tthis._search_promises = [];\n\t\t\tthis._search_pending = false;\n\n\t\t\tthis.options.data.cancelSearch();\n\t\t},\n\n\t\t_updateGhostText: function() {\n\t\t\tvar val = TS.utility.contenteditable.value(this.element);\n\t\t\tvar last_char = val.charAt(val.length-1);\n\t\t\tvar caret_pos = this._getCaretPosition();\n\t\t\tvar highlighter_plugin = this.element.data('TS-highlighter');\n\t\t\tvar current_word = this._getCurrentWordUpToCaret();\n\t\t\tvar modifier = this.options.data.modifiers_by_name[current_word];\n\n\t\t\tif (!highlighter_plugin) return this._clearGhostText();\n\n\t\t\t// caret must be at the end of the input\n\t\t\tif (caret_pos !== val.length) return this._clearGhostText();\n\n\t\t\t// if it matches a modifer, show the modifier's descriptive text\n\t\t\tif (modifier) {\n\t\t\t\t// special case for `in:` & `to:` since their descriptive text is too long\n\t\t\t\tvar keyword_placeholder = modifier.keyword_placeholder;\n\t\t\t\tif ((modifier.modifier === 'in:' || modifier.modifier === 'to:') && $(window).width() < 1368) keyword_placeholder = 'channel or DM';\n\t\t\t\thighlighter_plugin.setGhostText(keyword_placeholder, last_char);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// otherwise try to match it with the first autocomplete suggestion\n\n\t\t\tif (this._$menu_items.length === 0) return this._clearGhostText();\n\n\t\t\tvar first = this._$menu_items[0];\n\t\t\tvar replacement = $(first).data('replacement');\n\n\t\t\tif (!current_word || !replacement) return this._clearGhostText();\n\t\t\tif (current_word === replacement) return this._clearGhostText();\n\n\t\t\t// special case for '+'\n\t\t\tif (val === '+') {\n\t\t\t\thighlighter_plugin.setGhostText(replacement);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar current_word_suffix = _getSuffix(replacement, current_word);\n\t\t\tif (current_word_suffix) {\n\t\t\t\thighlighter_plugin.setGhostText(current_word_suffix, last_char);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// history items start from the beginning\n\t\t\tvar entire_input_suffix =_getSuffix(replacement, val);\n\t\t\tif (entire_input_suffix) {\n\t\t\t\thighlighter_plugin.setGhostText(entire_input_suffix, last_char);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\n\t\t_clearGhostText: function() {\n\t\t\tvar highlighter_plugin = this.element.data('TS-highlighter');\n\t\t\tif (!highlighter_plugin) return;\n\n\t\t\thighlighter_plugin.setGhostText('');\n\t\t}\n\t});\n\n// private\nvar _key_codes = {\n\tbackspace: 8,\n\ttab: 9,\n\tenter: 13,\n\tshift: 16,\n\tescape: 27,\n\tup: 38,\n\tright: 39,\n\tdown: 40\n}\n\nvar _regexpEscape = function(text) {\n\ttext = text || '';\n\tif (text.length > 50) {\n\t\ttext = text.substring(0, 50);\n\t}\n\treturn text.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\n}\n\n// returns the part of str after prefix, ignoring @ and #\nvar _getSuffix = function(str, prefix) {\n\tprefix = _regexpEscape(prefix);\n\t// ignoring # and @...\n\tvar fuzzy_prefix = prefix.replace(/:/g, ':(@|#)?');\n\tvar starts_with = new RegExp('^'+fuzzy_prefix+'(.+)', 'i');\n\tvar match = starts_with.exec(str);\n\tif (match && match.length > 0) return match[match.length-1];\n\treturn false;\n}\n\n}(jQuery));\n"},1635:function(e,t,i){i(0)(i(1636))},1636:function(e,t){e.exports='/*!\n  * exif-js - JavaScript library for reading EXIF image metadata\n  * https://github.com/jseidelin/exif-js\n  * MIT License | (c) 2008 Jacob Seidelin\n  */\n\n(function() {\n\n    var debug = false;\n\n    var root = this;\n\n    var EXIF = function(obj) {\n        if (obj instanceof EXIF) return obj;\n        if (!(this instanceof EXIF)) return new EXIF(obj);\n        this.EXIFwrapped = obj;\n    };\n\n    if (typeof exports !== \'undefined\') {\n        if (typeof module !== \'undefined\' && module.exports) {\n            exports = module.exports = EXIF;\n        }\n        exports.EXIF = EXIF;\n    } else {\n        root.EXIF = EXIF;\n    }\n\n    var ExifTags = EXIF.Tags = {\n\n        // version tags\n        0x9000 : "ExifVersion",             // EXIF version\n        0xA000 : "FlashpixVersion",         // Flashpix format version\n\n        // colorspace tags\n        0xA001 : "ColorSpace",              // Color space information tag\n\n        // image configuration\n        0xA002 : "PixelXDimension",         // Valid width of meaningful image\n        0xA003 : "PixelYDimension",         // Valid height of meaningful image\n        0x9101 : "ComponentsConfiguration", // Information about channels\n        0x9102 : "CompressedBitsPerPixel",  // Compressed bits per pixel\n\n        // user information\n        0x927C : "MakerNote",               // Any desired information written by the manufacturer\n        0x9286 : "UserComment",             // Comments by user\n\n        // related file\n        0xA004 : "RelatedSoundFile",        // Name of related sound file\n\n        // date and time\n        0x9003 : "DateTimeOriginal",        // Date and time when the original image was generated\n        0x9004 : "DateTimeDigitized",       // Date and time when the image was stored digitally\n        0x9290 : "SubsecTime",              // Fractions of seconds for DateTime\n        0x9291 : "SubsecTimeOriginal",      // Fractions of seconds for DateTimeOriginal\n        0x9292 : "SubsecTimeDigitized",     // Fractions of seconds for DateTimeDigitized\n\n        // picture-taking conditions\n        0x829A : "ExposureTime",            // Exposure time (in seconds)\n        0x829D : "FNumber",                 // F number\n        0x8822 : "ExposureProgram",         // Exposure program\n        0x8824 : "SpectralSensitivity",     // Spectral sensitivity\n        0x8827 : "ISOSpeedRatings",         // ISO speed rating\n        0x8828 : "OECF",                    // Optoelectric conversion factor\n        0x9201 : "ShutterSpeedValue",       // Shutter speed\n        0x9202 : "ApertureValue",           // Lens aperture\n        0x9203 : "BrightnessValue",         // Value of brightness\n        0x9204 : "ExposureBias",            // Exposure bias\n        0x9205 : "MaxApertureValue",        // Smallest F number of lens\n        0x9206 : "SubjectDistance",         // Distance to subject in meters\n        0x9207 : "MeteringMode",            // Metering mode\n        0x9208 : "LightSource",             // Kind of light source\n        0x9209 : "Flash",                   // Flash status\n        0x9214 : "SubjectArea",             // Location and area of main subject\n        0x920A : "FocalLength",             // Focal length of the lens in mm\n        0xA20B : "FlashEnergy",             // Strobe energy in BCPS\n        0xA20C : "SpatialFrequencyResponse",    //\n        0xA20E : "FocalPlaneXResolution",   // Number of pixels in width direction per FocalPlaneResolutionUnit\n        0xA20F : "FocalPlaneYResolution",   // Number of pixels in height direction per FocalPlaneResolutionUnit\n        0xA210 : "FocalPlaneResolutionUnit",    // Unit for measuring FocalPlaneXResolution and FocalPlaneYResolution\n        0xA214 : "SubjectLocation",         // Location of subject in image\n        0xA215 : "ExposureIndex",           // Exposure index selected on camera\n        0xA217 : "SensingMethod",           // Image sensor type\n        0xA300 : "FileSource",              // Image source (3 == DSC)\n        0xA301 : "SceneType",               // Scene type (1 == directly photographed)\n        0xA302 : "CFAPattern",              // Color filter array geometric pattern\n        0xA401 : "CustomRendered",          // Special processing\n        0xA402 : "ExposureMode",            // Exposure mode\n        0xA403 : "WhiteBalance",            // 1 = auto white balance, 2 = manual\n        0xA404 : "DigitalZoomRation",       // Digital zoom ratio\n        0xA405 : "FocalLengthIn35mmFilm",   // Equivalent foacl length assuming 35mm film camera (in mm)\n        0xA406 : "SceneCaptureType",        // Type of scene\n        0xA407 : "GainControl",             // Degree of overall image gain adjustment\n        0xA408 : "Contrast",                // Direction of contrast processing applied by camera\n        0xA409 : "Saturation",              // Direction of saturation processing applied by camera\n        0xA40A : "Sharpness",               // Direction of sharpness processing applied by camera\n        0xA40B : "DeviceSettingDescription",    //\n        0xA40C : "SubjectDistanceRange",    // Distance to subject\n\n        // other tags\n        0xA005 : "InteroperabilityIFDPointer",\n        0xA420 : "ImageUniqueID"            // Identifier assigned uniquely to each image\n    };\n\n    var TiffTags = EXIF.TiffTags = {\n        0x0100 : "ImageWidth",\n        0x0101 : "ImageHeight",\n        0x8769 : "ExifIFDPointer",\n        0x8825 : "GPSInfoIFDPointer",\n        0xA005 : "InteroperabilityIFDPointer",\n        0x0102 : "BitsPerSample",\n        0x0103 : "Compression",\n        0x0106 : "PhotometricInterpretation",\n        0x0112 : "Orientation",\n        0x0115 : "SamplesPerPixel",\n        0x011C : "PlanarConfiguration",\n        0x0212 : "YCbCrSubSampling",\n        0x0213 : "YCbCrPositioning",\n        0x011A : "XResolution",\n        0x011B : "YResolution",\n        0x0128 : "ResolutionUnit",\n        0x0111 : "StripOffsets",\n        0x0116 : "RowsPerStrip",\n        0x0117 : "StripByteCounts",\n        0x0201 : "JPEGInterchangeFormat",\n        0x0202 : "JPEGInterchangeFormatLength",\n        0x012D : "TransferFunction",\n        0x013E : "WhitePoint",\n        0x013F : "PrimaryChromaticities",\n        0x0211 : "YCbCrCoefficients",\n        0x0214 : "ReferenceBlackWhite",\n        0x0132 : "DateTime",\n        0x010E : "ImageDescription",\n        0x010F : "Make",\n        0x0110 : "Model",\n        0x0131 : "Software",\n        0x013B : "Artist",\n        0x8298 : "Copyright"\n    };\n\n    var GPSTags = EXIF.GPSTags = {\n        0x0000 : "GPSVersionID",\n        0x0001 : "GPSLatitudeRef",\n        0x0002 : "GPSLatitude",\n        0x0003 : "GPSLongitudeRef",\n        0x0004 : "GPSLongitude",\n        0x0005 : "GPSAltitudeRef",\n        0x0006 : "GPSAltitude",\n        0x0007 : "GPSTimeStamp",\n        0x0008 : "GPSSatellites",\n        0x0009 : "GPSStatus",\n        0x000A : "GPSMeasureMode",\n        0x000B : "GPSDOP",\n        0x000C : "GPSSpeedRef",\n        0x000D : "GPSSpeed",\n        0x000E : "GPSTrackRef",\n        0x000F : "GPSTrack",\n        0x0010 : "GPSImgDirectionRef",\n        0x0011 : "GPSImgDirection",\n        0x0012 : "GPSMapDatum",\n        0x0013 : "GPSDestLatitudeRef",\n        0x0014 : "GPSDestLatitude",\n        0x0015 : "GPSDestLongitudeRef",\n        0x0016 : "GPSDestLongitude",\n        0x0017 : "GPSDestBearingRef",\n        0x0018 : "GPSDestBearing",\n        0x0019 : "GPSDestDistanceRef",\n        0x001A : "GPSDestDistance",\n        0x001B : "GPSProcessingMethod",\n        0x001C : "GPSAreaInformation",\n        0x001D : "GPSDateStamp",\n        0x001E : "GPSDifferential"\n    };\n\n    var StringValues = EXIF.StringValues = {\n        ExposureProgram : {\n            0 : "Not defined",\n            1 : "Manual",\n            2 : "Normal program",\n            3 : "Aperture priority",\n            4 : "Shutter priority",\n            5 : "Creative program",\n            6 : "Action program",\n            7 : "Portrait mode",\n            8 : "Landscape mode"\n        },\n        MeteringMode : {\n            0 : "Unknown",\n            1 : "Average",\n            2 : "CenterWeightedAverage",\n            3 : "Spot",\n            4 : "MultiSpot",\n            5 : "Pattern",\n            6 : "Partial",\n            255 : "Other"\n        },\n        LightSource : {\n            0 : "Unknown",\n            1 : "Daylight",\n            2 : "Fluorescent",\n            3 : "Tungsten (incandescent light)",\n            4 : "Flash",\n            9 : "Fine weather",\n            10 : "Cloudy weather",\n            11 : "Shade",\n            12 : "Daylight fluorescent (D 5700 - 7100K)",\n            13 : "Day white fluorescent (N 4600 - 5400K)",\n            14 : "Cool white fluorescent (W 3900 - 4500K)",\n            15 : "White fluorescent (WW 3200 - 3700K)",\n            17 : "Standard light A",\n            18 : "Standard light B",\n            19 : "Standard light C",\n            20 : "D55",\n            21 : "D65",\n            22 : "D75",\n            23 : "D50",\n            24 : "ISO studio tungsten",\n            255 : "Other"\n        },\n        Flash : {\n            0x0000 : "Flash did not fire",\n            0x0001 : "Flash fired",\n            0x0005 : "Strobe return light not detected",\n            0x0007 : "Strobe return light detected",\n            0x0009 : "Flash fired, compulsory flash mode",\n            0x000D : "Flash fired, compulsory flash mode, return light not detected",\n            0x000F : "Flash fired, compulsory flash mode, return light detected",\n            0x0010 : "Flash did not fire, compulsory flash mode",\n            0x0018 : "Flash did not fire, auto mode",\n            0x0019 : "Flash fired, auto mode",\n            0x001D : "Flash fired, auto mode, return light not detected",\n            0x001F : "Flash fired, auto mode, return light detected",\n            0x0020 : "No flash function",\n            0x0041 : "Flash fired, red-eye reduction mode",\n            0x0045 : "Flash fired, red-eye reduction mode, return light not detected",\n            0x0047 : "Flash fired, red-eye reduction mode, return light detected",\n            0x0049 : "Flash fired, compulsory flash mode, red-eye reduction mode",\n            0x004D : "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",\n            0x004F : "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",\n            0x0059 : "Flash fired, auto mode, red-eye reduction mode",\n            0x005D : "Flash fired, auto mode, return light not detected, red-eye reduction mode",\n            0x005F : "Flash fired, auto mode, return light detected, red-eye reduction mode"\n        },\n        SensingMethod : {\n            1 : "Not defined",\n            2 : "One-chip color area sensor",\n            3 : "Two-chip color area sensor",\n            4 : "Three-chip color area sensor",\n            5 : "Color sequential area sensor",\n            7 : "Trilinear sensor",\n            8 : "Color sequential linear sensor"\n        },\n        SceneCaptureType : {\n            0 : "Standard",\n            1 : "Landscape",\n            2 : "Portrait",\n            3 : "Night scene"\n        },\n        SceneType : {\n            1 : "Directly photographed"\n        },\n        CustomRendered : {\n            0 : "Normal process",\n            1 : "Custom process"\n        },\n        WhiteBalance : {\n            0 : "Auto white balance",\n            1 : "Manual white balance"\n        },\n        GainControl : {\n            0 : "None",\n            1 : "Low gain up",\n            2 : "High gain up",\n            3 : "Low gain down",\n            4 : "High gain down"\n        },\n        Contrast : {\n            0 : "Normal",\n            1 : "Soft",\n            2 : "Hard"\n        },\n        Saturation : {\n            0 : "Normal",\n            1 : "Low saturation",\n            2 : "High saturation"\n        },\n        Sharpness : {\n            0 : "Normal",\n            1 : "Soft",\n            2 : "Hard"\n        },\n        SubjectDistanceRange : {\n            0 : "Unknown",\n            1 : "Macro",\n            2 : "Close view",\n            3 : "Distant view"\n        },\n        FileSource : {\n            3 : "DSC"\n        },\n\n        Components : {\n            0 : "",\n            1 : "Y",\n            2 : "Cb",\n            3 : "Cr",\n            4 : "R",\n            5 : "G",\n            6 : "B"\n        }\n    };\n\n    function addEvent(element, event, handler) {\n        if (element.addEventListener) {\n            element.addEventListener(event, handler, false);\n        } else if (element.attachEvent) {\n            element.attachEvent("on" + event, handler);\n        }\n    }\n\n    function imageHasData(img) {\n        return !!(img.exifdata);\n    }\n\n\n    function base64ToArrayBuffer(base64, contentType) {\n        contentType = contentType || base64.match(/^data\\:([^\\;]+)\\;base64,/mi)[1] || \'\'; // e.g. \'data:image/jpeg;base64,...\' => \'image/jpeg\'\n        base64 = base64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, \'\');\n        var binary = atob(base64);\n        var len = binary.length;\n        var buffer = new ArrayBuffer(len);\n        var view = new Uint8Array(buffer);\n        for (var i = 0; i < len; i++) {\n            view[i] = binary.charCodeAt(i);\n        }\n        return buffer;\n    }\n\n    function objectURLToBlob(url, callback) {\n        var http = new XMLHttpRequest();\n        http.open("GET", url, true);\n        http.responseType = "blob";\n        http.onload = function(e) {\n            if (this.status == 200 || this.status === 0) {\n                callback(this.response);\n            }\n        };\n        http.send();\n    }\n\n    function getImageData(img, callback) {\n        function handleBinaryFile(binFile) {\n            var data = findEXIFinJPEG(binFile);\n            var iptcdata = findIPTCinJPEG(binFile);\n            img.exifdata = data || {};\n            img.iptcdata = iptcdata || {};\n            if (callback) {\n                callback.call(img);\n            }\n        }\n\n        if (img.src) {\n            if (/^data\\:/i.test(img.src)) { // Data URI\n                var arrayBuffer = base64ToArrayBuffer(img.src);\n                handleBinaryFile(arrayBuffer);\n\n            } else if (/^blob\\:/i.test(img.src)) { // Object URL\n                var fileReader = new FileReader();\n                fileReader.onload = function(e) {\n                    handleBinaryFile(e.target.result);\n                };\n                objectURLToBlob(img.src, function (blob) {\n                    fileReader.readAsArrayBuffer(blob);\n                });\n            } else {\n                var http = new XMLHttpRequest();\n                http.onload = function() {\n                    if (this.status == 200 || this.status === 0) {\n                        handleBinaryFile(http.response);\n                    } else {\n                        throw "Could not load image";\n                    }\n                    http = null;\n                };\n                http.open("GET", img.src, true);\n                http.responseType = "arraybuffer";\n                http.send(null);\n            }\n        } else if (window.FileReader && (img instanceof window.Blob || img instanceof window.File)) {\n            var fileReader = new FileReader();\n            fileReader.onload = function(e) {\n                if (debug) console.log("Got file of length " + e.target.result.byteLength);\n                handleBinaryFile(e.target.result);\n            };\n\n            fileReader.readAsArrayBuffer(img);\n        }\n    }\n\n    function findEXIFinJPEG(file) {\n        var dataView = new DataView(file);\n\n        if (debug) console.log("Got file of length " + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n            if (debug) console.log("Not a valid JPEG");\n            return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength,\n            marker;\n\n        while (offset < length) {\n            if (dataView.getUint8(offset) != 0xFF) {\n                if (debug) console.log("Not a valid marker at offset " + offset + ", found: " + dataView.getUint8(offset));\n                return false; // not a valid marker, something is wrong\n            }\n\n            marker = dataView.getUint8(offset + 1);\n            if (debug) console.log(marker);\n\n            // we could implement handling for other markers here,\n            // but we\'re only looking for 0xFFE1 for EXIF data\n\n            if (marker == 225) {\n                if (debug) console.log("Found 0xFFE1 marker");\n\n                return readEXIFData(dataView, offset + 4, dataView.getUint16(offset + 2) - 2);\n\n                // offset += 2 + file.getShortAt(offset+2, true);\n\n            } else {\n                offset += 2 + dataView.getUint16(offset+2);\n            }\n\n        }\n\n    }\n\n    function findIPTCinJPEG(file) {\n        var dataView = new DataView(file);\n\n        if (debug) console.log("Got file of length " + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n            if (debug) console.log("Not a valid JPEG");\n            return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength;\n\n\n        var isFieldSegmentStart = function(dataView, offset){\n            return (\n                dataView.getUint8(offset) === 0x38 &&\n                dataView.getUint8(offset+1) === 0x42 &&\n                dataView.getUint8(offset+2) === 0x49 &&\n                dataView.getUint8(offset+3) === 0x4D &&\n                dataView.getUint8(offset+4) === 0x04 &&\n                dataView.getUint8(offset+5) === 0x04\n            );\n        };\n\n        while (offset < length) {\n\n            if ( isFieldSegmentStart(dataView, offset )){\n\n                // Get the length of the name header (which is padded to an even number of bytes)\n                var nameHeaderLength = dataView.getUint8(offset+7);\n                if(nameHeaderLength % 2 !== 0) nameHeaderLength += 1;\n                // Check for pre photoshop 6 format\n                if(nameHeaderLength === 0) {\n                    // Always 4\n                    nameHeaderLength = 4;\n                }\n\n                var startOffset = offset + 8 + nameHeaderLength;\n                var sectionLength = dataView.getUint16(offset + 6 + nameHeaderLength);\n\n                return readIPTCData(file, startOffset, sectionLength);\n\n                break;\n\n            }\n\n\n            // Not the marker, continue searching\n            offset++;\n\n        }\n\n    }\n    var IptcFieldMap = {\n        0x78 : \'caption\',\n        0x6E : \'credit\',\n        0x19 : \'keywords\',\n        0x37 : \'dateCreated\',\n        0x50 : \'byline\',\n        0x55 : \'bylineTitle\',\n        0x7A : \'captionWriter\',\n        0x69 : \'headline\',\n        0x74 : \'copyright\',\n        0x0F : \'category\'\n    };\n    function readIPTCData(file, startOffset, sectionLength){\n        var dataView = new DataView(file);\n        var data = {};\n        var fieldValue, fieldName, dataSize, segmentType, segmentSize;\n        var segmentStartPos = startOffset;\n        while(segmentStartPos < startOffset+sectionLength) {\n            if(dataView.getUint8(segmentStartPos) === 0x1C && dataView.getUint8(segmentStartPos+1) === 0x02){\n                segmentType = dataView.getUint8(segmentStartPos+2);\n                if(segmentType in IptcFieldMap) {\n                    dataSize = dataView.getInt16(segmentStartPos+3);\n                    segmentSize = dataSize + 5;\n                    fieldName = IptcFieldMap[segmentType];\n                    fieldValue = getStringFromDB(dataView, segmentStartPos+5, dataSize);\n                    // Check if we already stored a value with this name\n                    if(data.hasOwnProperty(fieldName)) {\n                        // Value already stored with this name, create multivalue field\n                        if(data[fieldName] instanceof Array) {\n                            data[fieldName].push(fieldValue);\n                        }\n                        else {\n                            data[fieldName] = [data[fieldName], fieldValue];\n                        }\n                    }\n                    else {\n                        data[fieldName] = fieldValue;\n                    }\n                }\n\n            }\n            segmentStartPos++;\n        }\n        return data;\n    }\n\n\n\n    function readTags(file, tiffStart, dirStart, strings, bigEnd) {\n        var entries = file.getUint16(dirStart, !bigEnd),\n            tags = {},\n            entryOffset, tag,\n            i;\n\n        for (i=0;i<entries;i++) {\n            entryOffset = dirStart + i*12 + 2;\n            tag = strings[file.getUint16(entryOffset, !bigEnd)];\n            if (!tag && debug) console.log("Unknown tag: " + file.getUint16(entryOffset, !bigEnd));\n            tags[tag] = readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd);\n        }\n        return tags;\n    }\n\n\n    function readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd) {\n        var type = file.getUint16(entryOffset+2, !bigEnd),\n            numValues = file.getUint32(entryOffset+4, !bigEnd),\n            valueOffset = file.getUint32(entryOffset+8, !bigEnd) + tiffStart,\n            offset,\n            vals, val, n,\n            numerator, denominator;\n\n        switch (type) {\n            case 1: // byte, 8-bit unsigned int\n            case 7: // undefined, 8-bit byte, value depending on field\n                if (numValues == 1) {\n                    return file.getUint8(entryOffset + 8, !bigEnd);\n                } else {\n                    offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint8(offset + n);\n                    }\n                    return vals;\n                }\n\n            case 2: // ascii, 8-bit byte\n                offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n                return getStringFromDB(file, offset, numValues-1);\n\n            case 3: // short, 16 bit int\n                if (numValues == 1) {\n                    return file.getUint16(entryOffset + 8, !bigEnd);\n                } else {\n                    offset = numValues > 2 ? valueOffset : (entryOffset + 8);\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint16(offset + 2*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 4: // long, 32 bit int\n                if (numValues == 1) {\n                    return file.getUint32(entryOffset + 8, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint32(valueOffset + 4*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 5:    // rational = two long values, first is numerator, second is denominator\n                if (numValues == 1) {\n                    numerator = file.getUint32(valueOffset, !bigEnd);\n                    denominator = file.getUint32(valueOffset+4, !bigEnd);\n                    val = new Number(numerator / denominator);\n                    val.numerator = numerator;\n                    val.denominator = denominator;\n                    return val;\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        numerator = file.getUint32(valueOffset + 8*n, !bigEnd);\n                        denominator = file.getUint32(valueOffset+4 + 8*n, !bigEnd);\n                        vals[n] = new Number(numerator / denominator);\n                        vals[n].numerator = numerator;\n                        vals[n].denominator = denominator;\n                    }\n                    return vals;\n                }\n\n            case 9: // slong, 32 bit signed int\n                if (numValues == 1) {\n                    return file.getInt32(entryOffset + 8, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getInt32(valueOffset + 4*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 10: // signed rational, two slongs, first is numerator, second is denominator\n                if (numValues == 1) {\n                    return file.getInt32(valueOffset, !bigEnd) / file.getInt32(valueOffset+4, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getInt32(valueOffset + 8*n, !bigEnd) / file.getInt32(valueOffset+4 + 8*n, !bigEnd);\n                    }\n                    return vals;\n                }\n        }\n    }\n\n    function getStringFromDB(buffer, start, length) {\n        var outstr = "";\n        for (n = start; n < start+length; n++) {\n            outstr += String.fromCharCode(buffer.getUint8(n));\n        }\n        return outstr;\n    }\n\n    function readEXIFData(file, start) {\n        if (getStringFromDB(file, start, 4) != "Exif") {\n            if (debug) console.log("Not valid EXIF data! " + getStringFromDB(file, start, 4));\n            return false;\n        }\n\n        var bigEnd,\n            tags, tag,\n            exifData, gpsData,\n            tiffOffset = start + 6;\n\n        // test for TIFF validity and endianness\n        if (file.getUint16(tiffOffset) == 0x4949) {\n            bigEnd = false;\n        } else if (file.getUint16(tiffOffset) == 0x4D4D) {\n            bigEnd = true;\n        } else {\n            if (debug) console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");\n            return false;\n        }\n\n        if (file.getUint16(tiffOffset+2, !bigEnd) != 0x002A) {\n            if (debug) console.log("Not valid TIFF data! (no 0x002A)");\n            return false;\n        }\n\n        var firstIFDOffset = file.getUint32(tiffOffset+4, !bigEnd);\n\n        if (firstIFDOffset < 0x00000008) {\n            if (debug) console.log("Not valid TIFF data! (First offset less than 8)", file.getUint32(tiffOffset+4, !bigEnd));\n            return false;\n        }\n\n        tags = readTags(file, tiffOffset, tiffOffset + firstIFDOffset, TiffTags, bigEnd);\n\n        if (tags.ExifIFDPointer) {\n            exifData = readTags(file, tiffOffset, tiffOffset + tags.ExifIFDPointer, ExifTags, bigEnd);\n            for (tag in exifData) {\n                switch (tag) {\n                    case "LightSource" :\n                    case "Flash" :\n                    case "MeteringMode" :\n                    case "ExposureProgram" :\n                    case "SensingMethod" :\n                    case "SceneCaptureType" :\n                    case "SceneType" :\n                    case "CustomRendered" :\n                    case "WhiteBalance" :\n                    case "GainControl" :\n                    case "Contrast" :\n                    case "Saturation" :\n                    case "Sharpness" :\n                    case "SubjectDistanceRange" :\n                    case "FileSource" :\n                        exifData[tag] = StringValues[tag][exifData[tag]];\n                        break;\n\n                    case "ExifVersion" :\n                    case "FlashpixVersion" :\n                        exifData[tag] = String.fromCharCode(exifData[tag][0], exifData[tag][1], exifData[tag][2], exifData[tag][3]);\n                        break;\n\n                    case "ComponentsConfiguration" :\n                        exifData[tag] =\n                            StringValues.Components[exifData[tag][0]] +\n                            StringValues.Components[exifData[tag][1]] +\n                            StringValues.Components[exifData[tag][2]] +\n                            StringValues.Components[exifData[tag][3]];\n                        break;\n                }\n                tags[tag] = exifData[tag];\n            }\n        }\n\n        if (tags.GPSInfoIFDPointer) {\n            gpsData = readTags(file, tiffOffset, tiffOffset + tags.GPSInfoIFDPointer, GPSTags, bigEnd);\n            for (tag in gpsData) {\n                switch (tag) {\n                    case "GPSVersionID" :\n                        gpsData[tag] = gpsData[tag][0] +\n                            "." + gpsData[tag][1] +\n                            "." + gpsData[tag][2] +\n                            "." + gpsData[tag][3];\n                        break;\n                }\n                tags[tag] = gpsData[tag];\n            }\n        }\n\n        return tags;\n    }\n\n    EXIF.getData = function(img, callback) {\n        if ((img instanceof Image || img instanceof HTMLImageElement) && !img.complete) return false;\n\n        if (!imageHasData(img)) {\n            getImageData(img, callback);\n        } else {\n            if (callback) {\n                callback.call(img);\n            }\n        }\n        return true;\n    }\n\n    EXIF.getTag = function(img, tag) {\n        if (!imageHasData(img)) return;\n        return img.exifdata[tag];\n    }\n\n    EXIF.getAllTags = function(img) {\n        if (!imageHasData(img)) return {};\n        var a,\n            data = img.exifdata,\n            tags = {};\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                tags[a] = data[a];\n            }\n        }\n        return tags;\n    }\n\n    EXIF.pretty = function(img) {\n        if (!imageHasData(img)) return "";\n        var a,\n            data = img.exifdata,\n            strPretty = "";\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                if (typeof data[a] == "object") {\n                    if (data[a] instanceof Number) {\n                        strPretty += a + " : " + data[a] + " [" + data[a].numerator + "/" + data[a].denominator + "]\\r\\n";\n                    } else {\n                        strPretty += a + " : [" + data[a].length + " values]\\r\\n";\n                    }\n                } else {\n                    strPretty += a + " : " + data[a] + "\\r\\n";\n                }\n            }\n        }\n        return strPretty;\n    }\n\n    EXIF.readFromBinaryFile = function(file) {\n        return findEXIFinJPEG(file);\n    }\n\n    if (typeof define === \'function\' && define.amd) {\n        define(\'exif-js\', [], function() {\n            return EXIF;\n        });\n    }\n}.call(this));\n'},280:function(e,t){(function(e){var t=function(){var t='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_controls"><div class="colpick_color_state"><div class="colpick_new_color"></div><div class="colpick_current_color"></div></div><div class="colpick_color_fields"><div class="colpick_rgb_hsb"><div class="colpick_rgb"><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div></div><div class="colpick_hsb"><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div></div></div><div class="colpick_hex_submit"><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_submit"></div></div></div></div></div>',n={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:true,flat:false,layout:"full",submit:1,submitText:"OK",height:156},o=function(t,i){var n=s(t),a=0;e(i).data("colpick").fields.eq(a).val(n.r).end().eq(a+1).val(n.g).end().eq(a+2).val(n.b).end()},d=function(t,i){var n=3;e(i).data("colpick").fields.eq(n).val(Math.round(t.h)).end().eq(n+1).val(Math.round(t.s)).end().eq(n+2).val(Math.round(t.b)).end()},c=function(t,i){e(i).data("colpick").fields.eq(6).val(l(t))},_=function(t,i){e(i).data("colpick").selector.css("backgroundColor","#"+l({h:t.h,s:100,b:100}));e(i).data("colpick").selectorIndic.css({left:parseInt(e(i).data("colpick").height*t.s/100,10),top:parseInt(e(i).data("colpick").height*(100-t.b)/100,10)})},u=function(t,i){e(i).data("colpick").hue.css("top",parseInt(e(i).data("colpick").height-e(i).data("colpick").height*t.h/360,10))},m=function(t,i){e(i).data("colpick").currentColor.css("backgroundColor","#"+l(t))},f=function(t,i){e(i).data("colpick").newColor.css("backgroundColor","#"+l(t))},h=function(t){var i=e(this).parents(".colpick"),n,m=0;if(this.parentNode.className.indexOf("_swatches")>0){n=a(e(t.target).data("swatch-color"));c(n,i.get(0));o(n,i.get(0));d(n,i.get(0))}else if(this.parentNode.className.indexOf("_hex")>0){i.data("colpick").color=n=a(D(this.value));o(n,i.get(0));d(n,i.get(0))}else if(this.parentNode.className.indexOf("_hsb")>0){i.data("colpick").color=n=$({h:parseInt(i.data("colpick").fields.eq(m+3).val(),10),s:parseInt(i.data("colpick").fields.eq(m+4).val(),10),b:parseInt(i.data("colpick").fields.eq(m+5).val(),10)});o(n,i.get(0));c(n,i.get(0))}else{i.data("colpick").color=n=r(B({r:parseInt(i.data("colpick").fields.eq(m).val(),10),g:parseInt(i.data("colpick").fields.eq(m+1).val(),10),b:parseInt(i.data("colpick").fields.eq(m+2).val(),10)}));c(n,i.get(0));d(n,i.get(0))}_(n,i.get(0));u(n,i.get(0));f(n,i.get(0));i.data("colpick").onChange.apply(i.parent(),[n,l(n),s(n),i.data("colpick").el,0])},g=function(t){e(this).parent().removeClass("colpick_focus")},p=function(){var t=e(this).parents(".colpick");t.data("colpick").fields.parent().removeClass("colpick_focus");e(this).parent().addClass("colpick_focus")},S=function(t){t.preventDefault?t.preventDefault():t.returnValue=false;var i=e(this).parent().find("input").focus(),n=e(this).parents(".colpick"),a={el:e(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:i,val:parseInt(i.val(),10),preview:n.data("colpick").livePreview};e(document).mouseup(a,v);e(document).mousemove(a,T)},T=function(e){e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val-e.pageY+e.data.y,10))));if(e.data.preview)h.apply(e.data.field.get(0),[true]);return false},v=function(t){h.apply(t.data.field.get(0),[true]);t.data.el.removeClass("colpick_slider").find("input").focus();e(document).off("mouseup",v);e(document).off("mousemove",T);return false},b=function(t){t.preventDefault?t.preventDefault():t.returnValue=false;var i={cal:e(this).parent(),y:e(this).offset().top};e(document).on("mouseup touchend",i,y);e(document).on("mousemove touchmove",i,w);var n="touchstart"==t.type?t.originalEvent.changedTouches[0].pageY:t.pageY;h.apply(i.cal.data("colpick").fields.eq(3).val(parseInt(360*(i.cal.data("colpick").height-(n-i.y))/i.cal.data("colpick").height,10)).get(0),[i.cal.data("colpick").livePreview]);return false},w=function(e){var t="touchmove"==e.type?e.originalEvent.changedTouches[0].pageY:e.pageY;h.apply(e.data.cal.data("colpick").fields.eq(3).val(parseInt(360*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.y)))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]);return false},y=function(t){o(t.data.cal.data("colpick").color,t.data.cal.get(0));c(t.data.cal.data("colpick").color,t.data.cal.get(0));e(document).off("mouseup touchend",y);e(document).off("mousemove touchmove",w);return false},k=function(t){t.preventDefault?t.preventDefault():t.returnValue=false;var i={cal:e(this).parent(),pos:e(this).offset()};i.preview=i.cal.data("colpick").livePreview;e(document).on("mouseup touchend",i,C);e(document).on("mousemove touchmove",i,A);var n,a;if("touchstart"==t.type)pageX=t.originalEvent.changedTouches[0].pageX,a=t.originalEvent.changedTouches[0].pageY;else{pageX=t.pageX;a=t.pageY}var r=4;h.apply(i.cal.data("colpick").fields.eq(r+1).val(parseInt(100*(i.cal.data("colpick").height-(a-i.pos.top))/i.cal.data("colpick").height,10)).end().eq(r).val(parseInt(100*(pageX-i.pos.left)/i.cal.data("colpick").height,10)).get(0),[i.preview]);return false},A=function(e){var t,i;if("touchmove"==e.type)pageX=e.originalEvent.changedTouches[0].pageX,i=e.originalEvent.changedTouches[0].pageY;else{pageX=e.pageX;i=e.pageY}var n=4;h.apply(e.data.cal.data("colpick").fields.eq(n+1).val(parseInt(100*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,i-e.data.pos.top)))/e.data.cal.data("colpick").height,10)).end().eq(n).val(parseInt(100*Math.max(0,Math.min(e.data.cal.data("colpick").height,pageX-e.data.pos.left))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]);return false},C=function(t){o(t.data.cal.data("colpick").color,t.data.cal.get(0));c(t.data.cal.data("colpick").color,t.data.cal.get(0));e(document).off("mouseup touchend",C);e(document).off("mousemove touchmove",A);return false},M=function(t){var i=e(this).parents(".colpick");var n=i.data("colpick").color;i.data("colpick").origColor=n;m(n,i.get(0));i.data("colpick").onSubmit(n,l(n),s(n),i.data("colpick").el)},I=function(t){if(t)t.stopPropagation();var i=e("#"+e(this).data("colpickId"));i.data("colpick").onBeforeShow.apply(this,[i.get(0)]);var n=e(this).offset();var a=n.top+this.offsetHeight;var r=n.left;var s=E();var o=i.width();if(r+o>s.l+s.w)r-=o;i.css({left:r+"px",top:a+"px"});if(false!=i.data("colpick").onShow.apply(this,[i.get(0)]))i.addClass("visible");e("html").mousedown({cal:i},x);i.mousedown(function(e){e.stopPropagation()})},x=function(t){if(false!=t.data.cal.data("colpick").onHide.apply(this,[t.data.cal.get(0)]))t.data.cal.removeClass("visible");e("html").off("mousedown",x)},E=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth)}},$=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},B=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},D=function(e){var t=6-e.length;if(t>0){var i=[];for(var n=0;n<t;n++)i.push("0");i.push(e);e=i.join("")}return e},F=function(){var t=e(this).parent();var i=t.data("colpick").origColor;t.data("colpick").color=i;o(i,t.get(0));c(i,t.get(0));d(i,t.get(0));_(i,t.get(0));u(i,t.get(0));f(i,t.get(0))};return{init:function(s){s=e.extend({},n,s||{});if("string"==typeof s.color)s.color=a(s.color);else if(void 0!=s.color.r&&void 0!=s.color.g&&void 0!=s.color.b)s.color=r(s.color);else if(void 0!=s.color.h&&void 0!=s.color.s&&void 0!=s.color.b)s.color=$(s.color);else return this;var l=t;if(s.swatches&&Array.isArray(s.swatches)){var T="",v;for(i=0;i<s.swatches.length;i++){v=s.swatches[i];if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(v))T+='<div class="colpick_swatch" style="background-color: '+v+';" data-swatch-color="'+v+'"></div>'}if(T){T='<div class="colpick_swatches">'+T+"</div>";l=t.slice(0,-6)+T+"</div>"}}return this.each(function(){if(!e(this).data("colpickId")){var t=e.extend({},s);t.origColor=s.color;var i="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colpickId",i);var n=e(l).attr("id",i);n.addClass("colpick_"+t.layout+(t.submit?"":" colpick_"+t.layout+"_ns"));if("light"!=t.colorScheme)n.addClass("colpick_"+t.colorScheme);n.find("div.colpick_submit").html(t.submitText).click(M);t.fields=n.find("input").change(h).blur(g).focus(p);n.find("div.colpick_field_arrs").mousedown(S).end().find("div.colpick_current_color").click(F);t.swatches=n.find(".colpick_swatch").click(h);t.selector=n.find("div.colpick_color").on("mousedown touchstart",k);t.selectorIndic=t.selector.find("div.colpick_selector_outer");t.el=this;t.hue=n.find("div.colpick_hue_arrs");huebar=t.hue.parent();var a=navigator.userAgent.toLowerCase();var r="Microsoft Internet Explorer"===navigator.appName;var T=r?parseFloat(a.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0;var v=r&&T<10;var w=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(v){var y,A;for(y=0;y<=11;y++){A=e("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+w[y]+", endColorstr="+w[y+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+w[y]+", endColorstr="+w[y+1]+')";');huebar.append(A)}}else{stopList=w.join(",");huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ")}n.find("div.colpick_hue").on("mousedown touchstart",b);t.newColor=n.find("div.colpick_new_color");t.currentColor=n.find("div.colpick_current_color");n.data("colpick",t);o(t.color,n.get(0));d(t.color,n.get(0));c(t.color,n.get(0));u(t.color,n.get(0));_(t.color,n.get(0));m(t.color,n.get(0));f(t.color,n.get(0));if(t.flat){n.appendTo(this).show();var C={position:"relative"};C.display="flex";n.css(C)}else{n.appendTo(document.body);e(this).on(t.showEvent,I);n.css({position:"absolute"})}}})},showPicker:function(){return this.each(function(){if(e(this).data("colpickId"))I.apply(this)})},hidePicker:function(){return this.each(function(){if(e(this).data("colpickId"))e("#"+e(this).data("colpickId")).hide()})},setColor:function(t,i){i="undefined"===typeof i?1:i;if("string"==typeof t)t=a(t);else if(void 0!=t.r&&void 0!=t.g&&void 0!=t.b)t=r(t);else if(void 0!=t.h&&void 0!=t.s&&void 0!=t.b)t=$(t);else return this;return this.each(function(){if(e(this).data("colpickId")){var n=e("#"+e(this).data("colpickId"));n.data("colpick").color=t;n.data("colpick").origColor=t;o(t,n.get(0));d(t,n.get(0));c(t,n.get(0));u(t,n.get(0));_(t,n.get(0));f(t,n.get(0));n.data("colpick").onChange.apply(n.parent(),[t,l(t),s(t),n.data("colpick").el,1]);if(i)m(t,n.get(0))}})}}}();var n=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(65280&e)>>8,b:255&e}};var a=function(e){return r(n(e))};var r=function(e){var t={h:0,s:0,b:0};var i=Math.min(e.r,e.g,e.b);var n=Math.max(e.r,e.g,e.b);var a=n-i;t.b=n;t.s=0!=n?255*a/n:0;if(0!=t.s)if(e.r==n)t.h=(e.g-e.b)/a;else if(e.g==n)t.h=2+(e.b-e.r)/a;else t.h=4+(e.r-e.g)/a;else t.h=-1;t.h*=60;if(t.h<0)t.h+=360;t.s*=100/255;t.b*=100/255;return t};var s=function(e){var t={};var i=e.h;var n=255*e.s/100;var a=255*e.b/100;if(0==n)t.r=t.g=t.b=a;else{var r=a;var s=(255-n)*a/255;var o=i%60*(r-s)/60;if(360==i)i=0;if(i<60){t.r=r;t.b=s;t.g=s+o}else if(i<120){t.g=r;t.b=s;t.r=r-o}else if(i<180){t.g=r;t.r=s;t.b=s+o}else if(i<240){t.b=r;t.r=s;t.g=r-o}else if(i<300){t.b=r;t.g=s;t.r=s+o}else if(i<360){t.r=r;t.g=s;t.b=r-o}else{t.r=0;t.g=0;t.b=0}}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}};var o=function(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];e.each(i,function(e,t){if(1==t.length)i[e]="0"+t});return i.join("")};var l=function(e){return o(s(e))};e.fn.extend({colpick:t.init,colpickHide:t.hidePicker,colpickShow:t.showPicker,colpickSetColor:t.setColor});e.extend({colpick:{rgbToHex:o,rgbToHsb:r,hsbToHex:l,hsbToRgb:s,hexToHsb:a,hexToRgb:n}})})(jQuery)},281:function(e,t){/**
 * @package		PickMeUp - jQuery datepicker plugin
 * @author		Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @author		Stefan Petre <www.eyecon.ro>
 * @copyright	Copyright (c) 2013-2014, Nazar Mokrynskyi
 * @copyright	Copyright (c) 2008-2009, Stefan Petre
 * @license		MIT License, see license.txt
 */
(function(e){function t(){var e=new Date(this.toString()),t=28,i=e.getMonth();while(e.getMonth()==i){++t;e.setDate(t)}return t-1}e.addDays=function(e){this.setDate(this.getDate()+e)};e.addMonths=function(e){var i=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+e);this.setDate(Math.min(i,t.apply(this)))};e.addYears=function(e){var i=this.getDate();this.setDate(1);this.setFullYear(this.getFullYear()+e);this.setDate(Math.min(i,t.apply(this)))};e.getDayOfYear=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var t=new Date(this.getFullYear(),0,0,0,0,0);var i=e-t;return Math.floor(i/24*60*60*1e3)}})(Date.prototype);(function(e){var t=0;e.pickmeup=e.extend(e.pickmeup||{},{date:new Date,flat:false,first_day:1,default_date:true,prev:"&#9664;",next:"&#9654;",mode:"single",select_year:true,select_month:true,select_day:true,view:"days",calendars:1,format:"d-m-Y",position:"bottom",trigger_event:"click touchstart",class_name:"",separator:" - ",hide_on_select:false,min:null,max:null,render:function(){},change:function(){return true},before_show:function(){return true},show:function(){return true},hide:function(){return true},fill:function(){return true},locale:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}});var i={years:"pmu-view-years",months:"pmu-view-months",days:"pmu-view-days"},n={wrapper:'<div class="pickmeup" />',head:function(e){var t="";for(var i=0;i<7;++i)t+="<div>"+e.day[i]+"</div>";return'<div class="pmu-instance"><nav><div class="pmu-prev pmu-button">'+e.prev+'</div><div class="pmu-month pmu-button" /><div class="pmu-next pmu-button">'+e.next+'</div></nav><nav class="pmu-day-of-week">'+t+"</nav></div>"},body:function(e,t){var i="";for(var n=0;n<e.length;++n){i+='<div class="'+e[n].class_name+' pmu-button">';if(-1!=e[n].class_name.indexOf("pmu-today"))i+='<span class="pmu-today-border">'+e[n].text+"</span>";else i+=e[n].text;i+="</div>"}return'<div class="'+t+'">'+i+"</div>"}};function a(){var t=e(this).data("pickmeup-options"),i=this.pickmeup,a=Math.floor(t.calendars/2),r=t.date,o=t.current,l,d,c,_,u=(new Date).setHours(0,0,0,0).valueOf(),m,f,h;i.find(".pmu-instance > :not(nav)").remove();for(var g=0;g<t.calendars;g++){l=new Date(o);_=i.find(".pmu-instance").eq(g);if(i.hasClass("pmu-view-years")){l.addYears(12*(g-a));d=l.getFullYear()-6+" - "+(l.getFullYear()+5)}else if(i.hasClass("pmu-view-months")){l.addYears(g-a);d=l.getFullYear()}else if(i.hasClass("pmu-view-days")){l.addMonths(g-a);d=s(l,"B Y",t.locale)}if(!f)if(t.max){h=new Date(l);if(t.select_day)h.addMonths(t.calendars-1);else if(t.select_month)h.addYears(t.calendars-1);else h.addYears(12*(t.calendars-1));if(h>t.max){--g;o.addMonths(-1);f=void 0;continue}}f=new Date(l);if(!m){m=new Date(l);m.setDate(1);m.addMonths(1);m.addDays(-1);if(t.min&&t.min>m){--g;o.addMonths(1);m=void 0;continue}}_.find(".pmu-month").text(d);c="";var p=function(e){return"range"==t.mode&&e>=new Date(r[0]).getFullYear()&&e<=new Date(r[1]).getFullYear()||"multiple"==t.mode&&-1!==r.reduce(function(e,t){e.push(new Date(t).getFullYear());return e},[]).indexOf(e)||new Date(r).getFullYear()==e};var S=function(e,i){var n=new Date(r[0]).getFullYear(),a=new Date(r[1]).getFullYear(),s=new Date(r[0]).getMonth(),o=new Date(r[1]).getMonth();return"range"==t.mode&&e>n&&e<a||"range"==t.mode&&e==n&&e<a&&i>=s||"range"==t.mode&&e>n&&e==a&&i<=o||"range"==t.mode&&e==n&&e==a&&i>=s&&i<=o||"multiple"==t.mode&&-1!==r.reduce(function(e,t){t=new Date(t);e.push(t.getFullYear()+"-"+t.getMonth());return e},[]).indexOf(e+"-"+i)||new Date(r).getFullYear()==e&&new Date(r).getMonth()==i};(function(){var e=[],i=l.getFullYear()-6,a=new Date(t.min).getFullYear(),r=new Date(t.max).getFullYear(),s;for(var o=0;o<12;++o){s={text:i+o,class_name:[]};if(t.min&&s.text<a||t.max&&s.text>r)s.class_name.push("pmu-disabled");else if(p(s.text))s.class_name.push("pmu-selected");s.class_name=s.class_name.join(" ");e.push(s)}c+=n.body(e,"pmu-years")})();(function(){var e=[],i=l.getFullYear(),a=new Date(t.min).getFullYear(),r=new Date(t.min).getMonth(),s=new Date(t.max).getFullYear(),o=new Date(t.max).getMonth(),d;for(var _=0;_<12;++_){d={text:t.locale.monthsShort[_],class_name:[]};if(t.min&&(i<a||_<r&&i==a)||t.max&&(i>s||_>o&&i>=s))d.class_name.push("pmu-disabled");else if(S(i,_))d.class_name.push("pmu-selected");d.class_name=d.class_name.join(" ");e.push(d)}c+=n.body(e,"pmu-months")})();(function(){var i=[],a=l.getMonth(),r;(function(){l.setDate(1);var e=(l.getDay()-t.first_day)%7;l.addDays(-(e+(e<0?7:0)))})();for(var s=0;s<42;++s){r={text:l.getDate(),class_name:[]};if(a!=l.getMonth())r.class_name.push("pmu-not-in-month");if(0==l.getDay())r.class_name.push("pmu-sunday");else if(6==l.getDay())r.class_name.push("pmu-saturday");var o=t.render(l)||{},d=l.valueOf(),_=t.min&&t.min>l||t.max&&t.max<l;if(o.disabled||_)r.class_name.push("pmu-disabled");else if(o.selected||t.date==d||-1!==e.inArray(d,t.date)||"range"==t.mode&&d>=t.date[0]&&d<=t.date[1])r.class_name.push("pmu-selected");if(d==u)r.class_name.push("pmu-today");if(o.class_name)r.class_name.push(o.class_name);r.class_name=r.class_name.join(" ");i.push(r);l.addDays(1)}c+=n.body(i,"pmu-days")})();_.append(c)}m.setDate(1);f.setDate(1);f.addMonths(1);f.addDays(-1);i.find(".pmu-prev").css("visibility",t.min&&t.min>=m?"hidden":"visible");i.find(".pmu-next").css("visibility",t.max&&t.max<=f?"hidden":"visible");t.fill.apply(this)}function r(t,i,n,a){if(t.constructor==Date)return t;else if(!t)return new Date;var s=t.split(n);if(s.length>1){s.forEach(function(t,s,o){o[s]=r(e.trim(t),i,n,a)});return s}var o=a.monthsShort.join(")(")+")("+a.months.join(")("),n=new RegExp("[^0-9a-zA-Z("+o+")]+"),l=t.split(n),d=i.split(n),c,_,u,m,f,h=new Date;for(var g=0;g<l.length;g++)switch(d[g]){case"b":_=a.monthsShort.indexOf(l[g]);break;case"B":_=a.months.indexOf(l[g]);break;case"d":case"e":c=parseInt(l[g],10);break;case"m":_=parseInt(l[g],10)-1;break;case"Y":case"y":u=parseInt(l[g],10);u+=u>100?0:u<29?2e3:1900;break;case"H":case"I":case"k":case"l":m=parseInt(l[g],10);break;case"P":case"p":if(/pm/i.test(l[g])&&m<12)m+=12;else if(/am/i.test(l[g])&&m>=12)m-=12;break;case"M":f=parseInt(l[g],10)}var p=new Date(void 0===u?h.getFullYear():u,void 0===_?h.getMonth():_,void 0===c?h.getDate():c,void 0===m?h.getHours():m,void 0===f?h.getMinutes():f,0);if(isNaN(1*p))p=new Date;return p}function s(e,t,i){var n=e.getMonth();var a=e.getDate();var r=e.getFullYear();var s=e.getDay();var o={};var l=e.getHours();var d=l>=12;var c=d?l-12:l;var _=e.getDayOfYear();if(0==c)c=12;var u=e.getMinutes();var m=e.getSeconds();var f=t.split(""),h;for(var g=0;g<f.length;g++){h=f[g];switch(h){case"a":h=i.daysShort[s];break;case"A":h=i.days[s];break;case"b":h=i.monthsShort[n];break;case"B":h=i.months[n];break;case"C":h=1+Math.floor(r/100);break;case"d":h=a<10?"0"+a:a;break;case"e":h=a;break;case"H":h=l<10?"0"+l:l;break;case"I":h=c<10?"0"+c:c;break;case"j":h=_<100?_<10?"00"+_:"0"+_:_;break;case"k":h=l;break;case"l":h=c;break;case"m":h=n<9?"0"+(1+n):1+n;break;case"M":h=u<10?"0"+u:u;break;case"p":case"P":h=d?"PM":"AM";break;case"s":h=Math.floor(e.getTime()/1e3);break;case"S":h=m<10?"0"+m:m;break;case"u":h=s+1;break;case"w":h=s;break;case"y":h=(""+r).substr(2,2);break;case"Y":h=r}f[g]=h}return f.join("")}function o(){var t=e(this),i=t.data("pickmeup-options"),n=i.current,a;switch(i.mode){case"multiple":a=n.setHours(0,0,0,0).valueOf();if(-1!==e.inArray(a,i.date))e.each(i.date,function(e,t){if(t==a){i.date.splice(e,1);return false}return true});else i.date.push(a);break;case"range":if(!i.lastSel)i.date[0]=n.setHours(0,0,0,0).valueOf();a=n.setHours(0,0,0,0).valueOf();if(a<=i.date[0]){i.date[1]=i.date[0];i.date[0]=a}else i.date[1]=a;i.lastSel=!i.lastSel;break;default:i.date=n.valueOf()}var r=d(i);if(t.is("input"))t.val("single"==i.mode?r[0]:r[0].join(i.separator));i.change.apply(this,r);if(i.hide_on_select&&("range"!=i.mode||!i.lastSel)){i.binded.hide();return false}}function l(t){var i=e(t.target);if(!i.hasClass("pmu-button"))i=i.closest(".pmu-button");if(i.length){if(i.hasClass("pmu-disabled"))return false;var n=e(this),a=n.data("pickmeup-options"),r=i.parents(".pmu-instance").eq(0),s=r.parent(),o=e(".pmu-instance",s).index(r);if(i.parent().is("nav"))if(i.hasClass("pmu-month")){a.current.addMonths(o-Math.floor(a.calendars/2));if(s.hasClass("pmu-view-years")){if("single"!=a.mode)a.current=new Date(a.date[a.date.length-1]);else a.current=new Date(a.date);if(a.select_day)s.removeClass("pmu-view-years").addClass("pmu-view-days");else if(a.select_month)s.removeClass("pmu-view-years").addClass("pmu-view-months")}else if(s.hasClass("pmu-view-months")){if(a.select_year)s.removeClass("pmu-view-months").addClass("pmu-view-years");else if(a.select_day)s.removeClass("pmu-view-months").addClass("pmu-view-days")}else if(s.hasClass("pmu-view-days"))if(a.select_month)s.removeClass("pmu-view-days").addClass("pmu-view-months");else if(a.select_year)s.removeClass("pmu-view-days").addClass("pmu-view-years")}else if(i.hasClass("pmu-prev"))a.binded.prev(false);else a.binded.next(false);else if(!i.hasClass("pmu-disabled"))if(s.hasClass("pmu-view-years")){a.current.setFullYear(parseInt(i.text(),10));if(a.select_month)s.removeClass("pmu-view-years").addClass("pmu-view-months");else if(a.select_day)s.removeClass("pmu-view-years").addClass("pmu-view-days");else a.binded.update_date()}else if(s.hasClass("pmu-view-months")){a.current.setMonth(r.find(".pmu-months .pmu-button").index(i));a.current.setFullYear(parseInt(r.find(".pmu-month").text(),10));if(a.select_day)s.removeClass("pmu-view-months").addClass("pmu-view-days");else a.binded.update_date();a.current.addMonths(Math.floor(a.calendars/2)-o)}else{var l=parseInt(i.text(),10);a.current.addMonths(o-Math.floor(a.calendars/2));if(i.hasClass("pmu-not-in-month"))a.current.addMonths(l>15?-1:1);a.current.setDate(l);a.binded.update_date()}a.binded.fill()}return false}function d(t){var i;if("single"==t.mode){i=new Date(t.date);return[s(i,t.format,t.locale),i]}else{i=[[],[]];e.each(t.date,function(e,n){var a=new Date(n);i[0].push(s(a,t.format,t.locale));i[1].push(a)});return i}}function c(t){var i=this.pickmeup;if(t||!i.is(":visible")){var n=e(this),a=n.data("pickmeup-options"),s=n.offset(),o={l:document.documentElement.scrollLeft,t:document.documentElement.scrollTop,w:document.documentElement.clientWidth,h:document.documentElement.clientHeight},l=s.top,d=s.left;a.binded.fill();if(n.is("input"))n.pickmeup("set_date",r(n.val(),a.format,a.separator,a.locale)).keydown(function(e){if(9==e.which)n.pickmeup("hide")});a.before_show();switch(a.position){case"top":l-=i.outerHeight();break;case"left":d-=i.outerWidth();break;case"right":d+=this.offsetWidth;break;case"bottom":l+=this.offsetHeight}if(l+i.offsetHeight>o.t+o.h)l=s.top-i.offsetHeight;if(l<o.t)l=s.top+this.offsetHeight+i.offsetHeight;if(d+i.offsetWidth>o.l+o.w)d=s.left-i.offsetWidth;if(d<o.l)d=s.left+this.offsetWidth;if(false==a.show())return;i.css({display:"inline-block",top:l+"px",left:d+"px"});e(document).on("mousedown"+a.events_namespace,a.binded.hide).on("resize"+a.events_namespace,[true],a.binded.forced_show)}}function _(){c.call(this,true)}function u(t){if(!t||!t.target||t.target!=this&&!(16&this.pickmeup.get(0).compareDocumentPosition(t.target))){var i=this.pickmeup,n=e(this).data("pickmeup-options");if(false!=n.hide()){i.hide();e(document).off("mousedown",n.binded.hide).off("resize",n.binded.forced_show);n.date[1]=n.date[0];n.lastSel=false}}}function m(){var t=e(this).data("pickmeup-options");e(document).off("mousedown",t.binded.hide).off("resize",t.binded.forced_show);t.binded.forced_show()}function f(){var t=e(this).data("pickmeup-options");if("single"!=t.mode){t.date=[];t.lastSel=false;t.binded.fill()}}function h(t){if("undefined"==typeof t)t=true;var i=this.pickmeup;var n=e(this).data("pickmeup-options");if(i.hasClass("pmu-view-years"))n.current.addYears(-12);else if(i.hasClass("pmu-view-months"))n.current.addYears(-1);else if(i.hasClass("pmu-view-days"))n.current.addMonths(-1);if(t)n.binded.fill()}function g(t){if("undefined"==typeof t)t=true;var i=this.pickmeup;var n=e(this).data("pickmeup-options");if(i.hasClass("pmu-view-years"))n.current.addYears(12);else if(i.hasClass("pmu-view-months"))n.current.addYears(1);else if(i.hasClass("pmu-view-days"))n.current.addMonths(1);if(t)n.binded.fill()}function p(t){var i=e(this).data("pickmeup-options"),n=d(i);if("string"===typeof t){var a=n[1];if(a.constructor==Date)return s(a,t,i.locale);else return a.map(function(e){return s(e,t,i.locale)})}else return n[t?0:1]}function S(t){var i=e(this).data("pickmeup-options");i.date=t;if("string"===typeof i.date)i.date=r(i.date,i.format,i.separator,i.locale).setHours(0,0,0,0);else if(i.date.constructor==Date)i.date.setHours(0,0,0,0);if(!i.date){i.date=new Date;i.date.setHours(0,0,0,0)}if("single"!=i.mode)if(i.date.constructor!=Array){i.date=[i.date.valueOf()];if("range"==i.mode&&i.default_date)i.date.push(new Date(i.date[0]).setHours(0,0,0,0).valueOf())}else{for(var n=0;n<i.date.length;n++)i.date[n]=r(i.date[n],i.format,i.separator,i.locale).setHours(0,0,0,0).valueOf();if("range"==i.mode)i.date[1]=new Date(i.date[1]).setHours(0,0,0,0).valueOf()}else i.date=i.date.constructor==Array?i.date[0].valueOf():i.date.valueOf();i.current=new Date("single"!=i.mode?i.date[0]:i.date);i.binded.fill()}function T(){var t=e(this),i=t.data("pickmeup-options");t.removeData("pickmeup-options");t.off(i.events_namespace);e(document).off(i.events_namespace);e(this.pickmeup).remove()}e.fn.pickmeup=function(s){if("string"===typeof s){var d,v=Array.prototype.slice.call(arguments,1);switch(s){case"hide":case"show":case"clear":case"update":case"prev":case"next":case"destroy":this.each(function(){d=e(this).data("pickmeup-options");if(d)d.binded[s]()});break;case"get_date":d=this.data("pickmeup-options");if(d)return d.binded.get_date(v[0]);else return null;case"set_date":this.each(function(){d=e(this).data("pickmeup-options");if(d)d.binded[s].apply(this,v)})}return this}return this.each(function(){var d=e(this);if(d.data("pickmeup-options"))return;var v,b,w=e.extend({},e.pickmeup,s||{});for(v in w){b=d.data("pmu-"+v);if("undefined"!==typeof b)w[v]=b}if("days"==w.view&&!w.select_day)w.view="months";if("months"==w.view&&!w.select_month)w.view="years";if("years"==w.view&&!w.select_year)w.view="days";if("days"==w.view&&!w.select_day)w.view="months";w.calendars=Math.max(1,parseInt(w.calendars,10)||1);w.mode=/single|multiple|range/.test(w.mode)?w.mode:"single";if("string"===typeof w.min)w.min=r(w.min,w.format,w.separator,w.locale).setHours(0,0,0,0);else if(w.min&&w.min.constructor==Date)w.min.setHours(0,0,0,0);if("string"===typeof w.max)w.max=r(w.max,w.format,w.separator,w.locale).setHours(0,0,0,0);else if(w.max&&w.max.constructor==Date)w.max.setHours(0,0,0,0);if(!w.select_day){if(w.min){w.min=new Date(w.min);w.min=w.min.valueOf()}if(w.max){w.max=new Date(w.max);w.max=w.max.valueOf()}}if("string"===typeof w.date)w.date=r(w.date,w.format,w.separator,w.locale).setHours(0,0,0,0);else if(w.date.constructor==Date)w.date.setHours(0,0,0,0);if(!w.date){w.date=new Date;w.date.setHours(0,0,0,0)}if("single"!=w.mode){if(w.date.constructor!=Array){w.date=[w.date.valueOf()];if("range"==w.mode&&w.default_date)w.date.push(new Date(w.date[0]).setHours(0,0,0,0).valueOf())}else{for(v=0;v<w.date.length;v++)w.date[v]=r(w.date[v],w.format,w.separator,w.locale).setHours(0,0,0,0).valueOf();if("range"==w.mode)w.date[1]=new Date(w.date[1]).setHours(0,0,0,0).valueOf()}w.current=new Date(w.date[0]);if(!w.select_day)for(v=0;v<w.date.length;++v){w.date[v]=new Date(w.date[v]);w.date[v].setDate(1);w.date[v]=w.date[v].valueOf();if("range"!=w.mode&&w.date.indexOf(w.date[v])!==v){w.date.splice(v,1);--v}}}else{w.date=w.date.valueOf();w.current=new Date(w.date);if(!w.select_day){w.date=new Date(w.date);w.date.setDate(1);w.date=w.date.valueOf()}}w.current.setDate(1);w.current.setHours(0,0,0,0);var y,k=e(n.wrapper);this.pickmeup=k;if(w.class_name)k.addClass(w.class_name);var A="";for(v=0;v<w.calendars;v++){y=w.first_day;A+=n.head({prev:w.prev,next:w.next,day:[w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7],w.locale.daysMin[y++%7]]})}d.data("pickmeup-options",w);for(v in w)if(-1!=["render","change","before_show","show","hide"].indexOf(v))w[v]=w[v].bind(this);w.binded={fill:a.bind(this),update_date:o.bind(this),click:l.bind(this),show:c.bind(this),forced_show:_.bind(this),hide:u.bind(this),update:m.bind(this),clear:f.bind(this),prev:h.bind(this),next:g.bind(this),get_date:p.bind(this),set_date:S.bind(this),destroy:T.bind(this)};w.events_namespace=".pickmeup-"+ ++t;k.on("click touchstart",w.binded.click).addClass(i[w.view]).append(A).on(e.support.selectstart?"selectstart":"mousedown",function(e){e.preventDefault()});w.binded.fill();if(w.flat)k.appendTo(this).css({position:"relative",display:"inline-block"});else{k.appendTo(document.body);var C=w.trigger_event.split(" ");for(v=0;v<C.length;++v)C[v]+=w.events_namespace;C=C.join(" ");d.on(C,w.binded.show)}})}})(jQuery)},285:function(e,t,i){i(0)(i(286))},286:function(e,t){e.exports='/*\n\nIMPORTANT: Do not edit this file directly. Apply your patch upstream at https://github.com/iamcal/lib_timezones\nSee: https://slack-github.com/slack/docs/blob/master/appeng/howto_time_zones.md\n\n*/\n\n"use strict";\n\nwindow.timezones_list = function(){\n\tvar tz = new TimezoneDetector();\n\treturn tz.getList();\n}\n\nwindow.timezones_guess = function(){\n\tvar tz = new TimezoneDetector();\n\tvar opts = {};\n\tif (arguments.length > 0) opts.default = arguments[0];\n\tvar ret = tz.detect(opts);\n\treturn ret.zoneId;\n}\n\n;(function() {\n\n\tvar root = this;\n\tvar previous_detector = root.TimezoneDetector;\n\n\tvar tz = function(){\n\n\t\tvar self = this;\n\n\t\tself.getList = function(){\n\n\t\t\treturn _list;\n\t\t}\n\n\t\tself.detect = function(opts){\n\n\t\t\tvar out = {\n\t\t\t\t\'zoneId\' : \'America/Los_Angeles\',\n\t\t\t\t\'method\' : \'gave_up\',\n\t\t\t};\n\n\t\t\tif (opts && opts.default){\n\t\t\t\tout.zoneId = opts.default;\n\t\t\t\tout.method = \'default\';\n\t\t\t}\n\n\n\t\t\tout.intl = _try_using_api();\n\t\t\tvar api_guess = out.intl.zoneId;\n\n\t\t\tif (api_guess){\n\t\t\t\t// is this one of our choices?\n\t\t\t\tfor (var i=0; i<_list.length; i++){\n\t\t\t\t\tif (_list[i][1] == api_guess){\n\t\t\t\t\t\tout.zoneId = api_guess;\n\t\t\t\t\t\tout.method = \'intlapi_exact\';\n\t\t\t\t\t\treturn out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// does it map to a manual equivalent?\n\t\t\t\tif (_manual_alts[api_guess]){\n\t\t\t\t\tout.zoneId = _manual_alts[api_guess];\n\t\t\t\t\tout.method = \'intl_api_manual\';\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t\t// does it map to an automatic equivalent?\n\t\t\t\tif (_auto_alts[api_guess]){\n\t\t\t\t\tout.zoneId = _auto_alts[api_guess];\n\t\t\t\t\tout.method = \'intl_api_equivalent\';\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t\t// does it map to a fallback equivalent?\n\t\t\t\tif (_fallback_alts[api_guess]){\n\t\t\t\t\tout.zoneId = _fallback_alts[api_guess];\n\t\t\t\t\tout.method = \'intl_api_fallback\';\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// use auto-detection via probe dates\n\t\t\tout.probe = _try_using_probe();\n\n\t\t\tif (out.probe.zoneId){\n\t\t\t\tout.zoneId = out.probe.zoneId;\n\t\t\t\tout.method = \'date_probe\';\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\t//console.log(\'no match for TZ on key \'+key);\n\n\t\t\treturn out;\n\t\t}\n\n\t\tvar _try_using_api = function(){\n\n\t\t\tvar out = {\n\t\t\t\t\'zoneId\'\t: null,\n\t\t\t\t\'hasIntl\'\t: false,\n\t\t\t\t\'hasDateTime\'\t: false,\n\t\t\t\t\'hasOptions\'\t: false,\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tif (typeof Intl === "undefined") return out;\n\n\t\t\t\tout.hasIntl = true;\n\n\t\t\t\tif (typeof Intl.DateTimeFormat === "undefined") return out;\n\t\t\t\tvar format = Intl.DateTimeFormat();\n\t\t\t\tif (typeof format === "undefined") return out;\n\n\t\t\t\tout.hasDateTime = true;\n\n\t\t\t\tif (typeof format.resolvedOptions === "undefined") return out;\n\n\t\t\t\tout.hasOptions = true;\n\t\t\t\tout.zoneId = format.resolvedOptions().timeZone;\n\n\t\t\t}catch (e){\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\treturn out;\n\t\t};\n\n\t\tvar _try_using_probe = function(){\n\n\t\t\tvar key_parts = [];\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2008, 10, 27, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2010, 4, 30, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2001, 10, 28, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2002, 4, 7, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2004, 10, 3, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2011, 11, 7, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2012, 11, 10, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2015, 9, 22, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2015, 11, 2, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2016, 3, 27, 0, 0, 0, 0)).getTimezoneOffset());\n\n\n\t\t\tfor (var i=1; i<=key_parts.length; i++){\n\n\t\t\t\tvar key = key_parts.slice(0,i).join(\':\');\n\t\t\t\tif (_map[key]){\n\t\t\t\t\treturn {\n\t\t\t\t\t\t\'zoneId\'\t: _map[key],\n\t\t\t\t\t\t\'probeKey\'\t: key,\n\t\t\t\t\t\t\'fullKey\'\t: key_parts.join(\':\')\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t\'zoneId\'\t: null,\n\t\t\t\t\'fullKey\'\t: key_parts.join(\':\')\n\t\t\t};\n\t\t}\n\n\n\t\tvar _map = {\n\t\t\t\'-660:-660:-660:-660:-660:-660\':\t\'Pacific/Midway\',\n\t\t\t\'-540\':\t\'America/Adak\',\n\t\t\t\'-600\':\t\'Pacific/Honolulu\',\n\t\t\t\'-570\':\t\'Pacific/Marquesas\',\n\t\t\t\'-480:-480\':\t\'America/Anchorage\',\n\t\t\t\'-480:-420\':\t\'America/Tijuana\',\n\t\t\t\'-420:-420:-420:-480\':\t\'America/Los_Angeles\',\n\t\t\t\'-420:-420:-420:-420\':\t\'America/Phoenix\',\n\t\t\t\'-420:-360\':\t\'America/Chihuahua\',\n\t\t\t\'-360:-360:-360:-420\':\t\'America/Denver\',\n\t\t\t\'-360:-360:-360:-360\':\t\'America/Regina\',\n\t\t\t\'-300:-300:-300:-360\':\t\'America/Chicago\',\n\t\t\t\'-300:-360\':\t\'Pacific/Easter\',\n\t\t\t\'-360:-300:-360:-360:-300:-360:-360:-300:-360\':\t\'America/Mexico_City\',\n\t\t\t\'-300:-300:-300:-300:-300:-300:-300:-300\':\t\'America/Bogota\',\n\t\t\t\'-360:-300:-360:-360:-300:-360:-360:-300:-300\':\t\'America/Cancun\',\n\t\t\t\'-240:-240:-240:-300:-240:-300:-300:-240:-300\':\t\'America/New_York\',\n\t\t\t\'-300:-300:-300:-300:-300:-300:-300:-240\':\t\'America/Port-au-Prince\',\n\t\t\t\'-300:-240\':\t\'America/Havana\',\n\t\t\t\'-240:-240:-300\':\t\'America/Indiana/Indianapolis\',\n\t\t\t\'-180:-240:-180:-180\':\t\'America/Asuncion\',\n\t\t\t\'-180:-180:-180:-240\':\t\'America/Halifax\',\n\t\t\t\'-270\':\t\'America/Caracas\',\n\t\t\t\'-180:-240:-180:-240:-240:-180:-180:-240\':\t\'America/Cuiaba\',\n\t\t\t\'-240:-240:-240:-240\':\t\'America/Manaus\',\n\t\t\t\'-180:-240:-180:-240:-240:-180:-180:-180\':\t\'America/Santiago\',\n\t\t\t\'-240:-240:-240:-300:-240:-300:-300:-240:-240\':\t\'America/Grand_Turk\',\n\t\t\t\'-150\':\t\'America/St_Johns\',\n\t\t\t\'-180:-180:-120:-180:-180:-180\':\t\'America/Fortaleza\',\n\t\t\t\'-120:-180:-120\':\t\'America/Sao_Paulo\',\n\t\t\t\'-180:-180:-180:-180\':\t\'America/Cayenne\',\n\t\t\t\'-120:-180:-180:-180:-180\':\t\'America/Buenos_Aires\',\n\t\t\t\'-180:-120\':\t\'America/Godthab\',\n\t\t\t\'-120:-180:-180:-180:-120\':\t\'America/Montevideo\',\n\t\t\t\'-120:-120:-120\':\t\'America/Miquelon\',\n\t\t\t\'-180:-180:-120:-180:-180:-120\':\t\'America/Bahia\',\n\t\t\t\'-120:-120:-60\':\t\'America/Noronha\',\n\t\t\t\'-60:0\':\t\'Atlantic/Azores\',\n\t\t\t\'-60:-60\':\t\'Atlantic/Cape_Verde\',\n\t\t\t\'0:0:0:0:0:0:0:60\':\t\'Africa/Casablanca\',\n\t\t\t\'0:60\':\t\'Europe/London\',\n\t\t\t\'0:0:0:0:0:0:0:0\':\t\'Africa/Monrovia\',\n\t\t\t\'60:120\':\t\'Europe/Amsterdam\',\n\t\t\t\'60:60\':\t\'Africa/Algiers\',\n\t\t\t\'120:60\':\t\'Africa/Windhoek\',\n\t\t\t\'180:180:120:180:180\':\t\'Asia/Amman\',\n\t\t\t\'120:180:180\':\t\'Europe/Athens\',\n\t\t\t\'120:180:120:180:180:120:120:180:120\':\t\'Asia/Beirut\',\n\t\t\t\'120:180:120:120:120:120:120:120\':\t\'Africa/Cairo\',\n\t\t\t\'180:180:120:180:120\':\t\'Asia/Damascus\',\n\t\t\t\'120:180:120:120:120:120:120:180\':\t\'Asia/Gaza\',\n\t\t\t\'120:120:120:120:120:120:120\':\t\'Africa/Harare\',\n\t\t\t\'120:180:120:180:120\':\t\'Asia/Jerusalem\',\n\t\t\t\'120:180:120:180:180:180:180:120\':\t\'Europe/Kaliningrad\',\n\t\t\t\'120:120:120:120:120:120:60\':\t\'Africa/Tripoli\',\n\t\t\t\'180:180:180:240\':\t\'Asia/Baghdad\',\n\t\t\t\'120:180:120:180:180:120:120:180:180\':\t\'Asia/Istanbul\',\n\t\t\t\'180:180:180:180\':\t\'Asia/Kuwait\',\n\t\t\t\'120:180:120:180:180:180:180:180\':\t\'Europe/Minsk\',\n\t\t\t\'180:240:180:240:240:240:240:180:180:180\':\t\'Europe/Moscow\',\n\t\t\t\'210\':\t\'Asia/Tehran\',\n\t\t\t\'240:240:240:240\':\t\'Asia/Muscat\',\n\t\t\t\'180:240:180:240:240:240:240:180:180:240\':\t\'Europe/Astrakhan\',\n\t\t\t\'240:300:240:300:300:240:240:300\':\t\'Asia/Baku\',\n\t\t\t\'240:240:240:300:300\':\t\'Europe/Samara\',\n\t\t\t\'300:240\':\t\'Indian/Mauritius\',\n\t\t\t\'240:240:240:300:240\':\t\'Asia/Tbilisi\',\n\t\t\t\'240:300:240:300:300:240:240:240\':\t\'Asia/Yerevan\',\n\t\t\t\'270\':\t\'Asia/Kabul\',\n\t\t\t\'300:300\':\t\'Asia/Tashkent\',\n\t\t\t\'300:360\':\t\'Asia/Yekaterinburg\',\n\t\t\t\'360:300\':\t\'Asia/Karachi\',\n\t\t\t\'330:330:330\':\t\'Asia/Kolkata\',\n\t\t\t\'330:330:360\':\t\'Asia/Colombo\',\n\t\t\t\'345\':\t\'Asia/Katmandu\',\n\t\t\t\'360:360:360:420\':\t\'Asia/Almaty\',\n\t\t\t\'360:360:360:360\':\t\'Asia/Dhaka\',\n\t\t\t\'390\':\t\'Asia/Rangoon\',\n\t\t\t\'360:420:360:420:420:420:420:360:360:360\':\t\'Asia/Novosibirsk\',\n\t\t\t\'420:420:420:420\':\t\'Asia/Bangkok\',\n\t\t\t\'360:420:360:420:420:420:420:360:360:420\':\t\'Asia/Barnaul\',\n\t\t\t\'420:420:420:480\':\t\'Asia/Hovd\',\n\t\t\t\'420:480\':\t\'Asia/Krasnoyarsk\',\n\t\t\t\'360:420:420\':\t\'Asia/Tomsk\',\n\t\t\t\'480:480:480:480\':\t\'Asia/Chongqing\',\n\t\t\t\'480:540\':\t\'Asia/Irkutsk\',\n\t\t\t\'540:480\':\t\'Australia/Perth\',\n\t\t\t\'480:480:480:540\':\t\'Asia/Ulaanbaatar\',\n\t\t\t\'540:540:540:540:540:540:540:510\':\t\'Asia/Pyongyang\',\n\t\t\t\'585\':\t\'Australia/Eucla\',\n\t\t\t\'540:600:540:600:600:600:600:480\':\t\'Asia/Chita\',\n\t\t\t\'540:540:540:540:540:540:540:540\':\t\'Asia/Tokyo\',\n\t\t\t\'540:600:540:600:600:600:600:540\':\t\'Asia/Yakutsk\',\n\t\t\t\'630\':\t\'Australia/Adelaide\',\n\t\t\t\'570\':\t\'Australia/Darwin\',\n\t\t\t\'600:600:600:600:600:600:600:600\':\t\'Australia/Brisbane\',\n\t\t\t\'660:600:660:600:600\':\t\'Australia/Canberra\',\n\t\t\t\'660:600:660:600:660\':\t\'Australia/Hobart\',\n\t\t\t\'600:660:600:660:660:660:660:600:600:600\':\t\'Asia/Vladivostok\',\n\t\t\t\'660:630\':\t\'Australia/Lord_Howe\',\n\t\t\t\'600:600:600:600:600:600:600:660\':\t\'Pacific/Bougainville\',\n\t\t\t\'660:720:660:720:720:720:720:660\':\t\'Asia/Srednekolymsk\',\n\t\t\t\'660:720:660:720:720:720:720:600\':\t\'Asia/Magadan\',\n\t\t\t\'690\':\t\'Pacific/Norfolk\',\n\t\t\t\'600:660:600:660:660:660:660:600:600:660\':\t\'Asia/Sakhalin\',\n\t\t\t\'660:660\':\t\'Pacific/Guadalcanal\',\n\t\t\t\'720:720:720:780\':\t\'Asia/Anadyr\',\n\t\t\t\'780:720\':\t\'Pacific/Auckland\',\n\t\t\t\'720:720:720:720\':\t\'Pacific/Fiji\',\n\t\t\t\'825\':\t\'Pacific/Chatham\',\n\t\t\t\'780:780\':\t\'Pacific/Tongatapu\',\n\t\t\t\'-660:-660:-660:-660:-660:-600\':\t\'Pacific/Apia\',\n\t\t\t\'840\':\t\'Pacific/Kiritimati\'\n\t\t};\n\n\t\tvar _list = [\n\t\t\t["(UTC-11:00) Midway Island, American Samoa", \'Pacific/Midway\'],\n\t\t\t["(UTC-10:00) Aleutian Islands", \'America/Adak\'],\n\t\t\t["(UTC-10:00) Hawaii", \'Pacific/Honolulu\'],\n\t\t\t["(UTC-09:30) Marquesas Islands", \'Pacific/Marquesas\'],\n\t\t\t["(UTC-09:00) Alaska", \'America/Anchorage\'],\n\t\t\t["(UTC-08:00) Baja California", \'America/Tijuana\'],\n\t\t\t["(UTC-08:00) Pacific Time (US and Canada)", \'America/Los_Angeles\'],\n\t\t\t["(UTC-07:00) Arizona", \'America/Phoenix\'],\n\t\t\t["(UTC-07:00) Chihuahua, La Paz, Mazatlan", \'America/Chihuahua\'],\n\t\t\t["(UTC-07:00) Mountain Time (US and Canada)", \'America/Denver\'],\n\t\t\t["(UTC-06:00) Central America", \'America/Belize\'],\n\t\t\t["(UTC-06:00) Central Time (US and Canada)\t", \'America/Chicago\'],\n\t\t\t["(UTC-06:00) Easter Island", \'Pacific/Easter\'],\n\t\t\t["(UTC-06:00) Guadalajara, Mexico City, Monterrey", \'America/Mexico_City\'],\n\t\t\t["(UTC-06:00) Saskatchewan", \'America/Regina\'],\n\t\t\t["(UTC-05:00) Bogota, Lima, Quito", \'America/Bogota\'],\n\t\t\t["(UTC-05:00) Chetumal", \'America/Cancun\'],\n\t\t\t["(UTC-05:00) Eastern Time (US and Canada)", \'America/New_York\'],\n\t\t\t["(UTC-05:00) Haiti", \'America/Port-au-Prince\'],\n\t\t\t["(UTC-05:00) Havana", \'America/Havana\'],\n\t\t\t["(UTC-05:00) Indiana (East)", \'America/Indiana/Indianapolis\'],\n\t\t\t["(UTC-04:00) Asuncion", \'America/Asuncion\'],\n\t\t\t["(UTC-04:00) Atlantic Time (Canada)", \'America/Halifax\'],\n\t\t\t["(UTC-04:00) Caracas", \'America/Caracas\'],\n\t\t\t["(UTC-04:00) Cuiaba", \'America/Cuiaba\'],\n\t\t\t["(UTC-04:00) Georgetown, La Paz, Manaus, San Juan", \'America/Manaus\'],\n\t\t\t["(UTC-04:00) Santiago", \'America/Santiago\'],\n\t\t\t["(UTC-04:00) Turks and Caicos", \'America/Grand_Turk\'],\n\t\t\t["(UTC-03:30) Newfoundland", \'America/St_Johns\'],\n\t\t\t["(UTC-03:00) Araguaina", \'America/Fortaleza\'],\n\t\t\t["(UTC-03:00) Brasilia", \'America/Sao_Paulo\'],\n\t\t\t["(UTC-03:00) Cayenne, Fortaleza", \'America/Cayenne\'],\n\t\t\t["(UTC-03:00) City of Buenos Aires", \'America/Buenos_Aires\'],\n\t\t\t["(UTC-03:00) Greenland", \'America/Godthab\'],\n\t\t\t["(UTC-03:00) Montevideo", \'America/Montevideo\'],\n\t\t\t["(UTC-03:00) Saint Pierre and Miquelon", \'America/Miquelon\'],\n\t\t\t["(UTC-03:00) Salvador", \'America/Bahia\'],\n\t\t\t["(UTC-02:00) Fernando de Noronha", \'America/Noronha\'],\n\t\t\t["(UTC-01:00) Azores", \'Atlantic/Azores\'],\n\t\t\t["(UTC-01:00) Cabo Verde Islands", \'Atlantic/Cape_Verde\'],\n\t\t\t["(UTC) Casablanca", \'Africa/Casablanca\'],\n\t\t\t["(UTC) Dublin, Edinburgh, Lisbon, London", \'Europe/London\'],\n\t\t\t["(UTC) Monrovia, Reykjavik", \'Africa/Monrovia\'],\n\t\t\t["(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna", \'Europe/Amsterdam\'],\n\t\t\t["(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague", \'Europe/Belgrade\'],\n\t\t\t["(UTC+01:00) Brussels, Copenhagen, Madrid, Paris", \'Europe/Brussels\'],\n\t\t\t["(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb", \'Europe/Warsaw\'],\n\t\t\t["(UTC+01:00) West Central Africa", \'Africa/Algiers\'],\n\t\t\t["(UTC+01:00) Windhoek", \'Africa/Windhoek\'],\n\t\t\t["(UTC+02:00) Amman", \'Asia/Amman\'],\n\t\t\t["(UTC+02:00) Athens, Bucharest", \'Europe/Athens\'],\n\t\t\t["(UTC+02:00) Beirut", \'Asia/Beirut\'],\n\t\t\t["(UTC+02:00) Cairo", \'Africa/Cairo\'],\n\t\t\t["(UTC+02:00) Damascus", \'Asia/Damascus\'],\n\t\t\t["(UTC+02:00) Gaza, Hebron", \'Asia/Gaza\'],\n\t\t\t["(UTC+02:00) Harare, Pretoria", \'Africa/Harare\'],\n\t\t\t["(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius", \'Europe/Helsinki\'],\n\t\t\t["(UTC+02:00) Jerusalem", \'Asia/Jerusalem\'],\n\t\t\t["(UTC+02:00) Kaliningrad", \'Europe/Kaliningrad\'],\n\t\t\t["(UTC+02:00) Tripoli", \'Africa/Tripoli\'],\n\t\t\t["(UTC+03:00) Baghdad", \'Asia/Baghdad\'],\n\t\t\t["(UTC+03:00) Istanbul", \'Asia/Istanbul\'],\n\t\t\t["(UTC+03:00) Kuwait, Riyadh", \'Asia/Kuwait\'],\n\t\t\t["(UTC+03:00) Minsk", \'Europe/Minsk\'],\n\t\t\t["(UTC+03:00) Moscow, St. Petersburg, Volgograd", \'Europe/Moscow\'],\n\t\t\t["(UTC+03:00) Nairobi", \'Africa/Nairobi\'],\n\t\t\t["(UTC+03:30) Tehran", \'Asia/Tehran\'],\n\t\t\t["(UTC+04:00) Abu Dhabi, Muscat", \'Asia/Muscat\'],\n\t\t\t["(UTC+04:00) Astrakhan, Ulyanovsk", \'Europe/Astrakhan\'],\n\t\t\t["(UTC+04:00) Baku", \'Asia/Baku\'],\n\t\t\t["(UTC+04:00) Izhevsk, Samara", \'Europe/Samara\'],\n\t\t\t["(UTC+04:00) Port Louis", \'Indian/Mauritius\'],\n\t\t\t["(UTC+04:00) Tbilisi", \'Asia/Tbilisi\'],\n\t\t\t["(UTC+04:00) Yerevan", \'Asia/Yerevan\'],\n\t\t\t["(UTC+04:30) Kabul", \'Asia/Kabul\'],\n\t\t\t["(UTC+05:00) Tashkent, Ashgabat", \'Asia/Tashkent\'],\n\t\t\t["(UTC+05:00) Ekaterinburg", \'Asia/Yekaterinburg\'],\n\t\t\t["(UTC+05:00) Islamabad, Karachi", \'Asia/Karachi\'],\n\t\t\t["(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi", \'Asia/Kolkata\'],\n\t\t\t["(UTC+05:30) Sri Jayawardenepura", \'Asia/Colombo\'],\n\t\t\t["(UTC+05:45) Kathmandu", \'Asia/Katmandu\'],\n\t\t\t["(UTC+06:00) Astana", \'Asia/Almaty\'],\n\t\t\t["(UTC+06:00) Dhaka", \'Asia/Dhaka\'],\n\t\t\t["(UTC+06:30) Yangon (Rangoon)", \'Asia/Rangoon\'],\n\t\t\t["(UTC+07:00) Novosibirsk", \'Asia/Novosibirsk\'],\n\t\t\t["(UTC+07:00) Bangkok, Hanoi, Jakarta", \'Asia/Bangkok\'],\n\t\t\t["(UTC+07:00) Barnaul, Gorno-Altaysk", \'Asia/Barnaul\'],\n\t\t\t["(UTC+07:00) Hovd", \'Asia/Hovd\'],\n\t\t\t["(UTC+07:00) Krasnoyarsk", \'Asia/Krasnoyarsk\'],\n\t\t\t["(UTC+07:00) Tomsk", \'Asia/Tomsk\'],\n\t\t\t["(UTC+08:00) Beijing, Chongqing, Hong Kong SAR, Urumqi", \'Asia/Chongqing\'],\n\t\t\t["(UTC+08:00) Irkutsk", \'Asia/Irkutsk\'],\n\t\t\t["(UTC+08:00) Kuala Lumpur, Singapore", \'Asia/Kuala_Lumpur\'],\n\t\t\t["(UTC+08:00) Perth", \'Australia/Perth\'],\n\t\t\t["(UTC+08:00) Taipei", \'Asia/Taipei\'],\n\t\t\t["(UTC+08:00) Ulaanbaatar", \'Asia/Ulaanbaatar\'],\n\t\t\t["(UTC+08:30) Pyongyang", \'Asia/Pyongyang\'],\n\t\t\t["(UTC+08:45) Eucla", \'Australia/Eucla\'],\n\t\t\t["(UTC+09:00) Chita", \'Asia/Chita\'],\n\t\t\t["(UTC+09:00) Osaka, Sapporo, Tokyo", \'Asia/Tokyo\'],\n\t\t\t["(UTC+09:00) Seoul", \'Asia/Seoul\'],\n\t\t\t["(UTC+09:00) Yakutsk", \'Asia/Yakutsk\'],\n\t\t\t["(UTC+09:30) Adelaide", \'Australia/Adelaide\'],\n\t\t\t["(UTC+09:30) Darwin", \'Australia/Darwin\'],\n\t\t\t["(UTC+10:00) Brisbane", \'Australia/Brisbane\'],\n\t\t\t["(UTC+10:00) Canberra, Melbourne, Sydney", \'Australia/Canberra\'],\n\t\t\t["(UTC+10:00) Guam, Port Moresby", \'Pacific/Guam\'],\n\t\t\t["(UTC+10:00) Hobart", \'Australia/Hobart\'],\n\t\t\t["(UTC+10:00) Vladivostok", \'Asia/Vladivostok\'],\n\t\t\t["(UTC+10:30) Lord Howe Island", \'Australia/Lord_Howe\'],\n\t\t\t["(UTC+11:00) Bougainville Island", \'Pacific/Bougainville\'],\n\t\t\t["(UTC+11:00) Chokirdakh", \'Asia/Srednekolymsk\'],\n\t\t\t["(UTC+11:00) Magadan", \'Asia/Magadan\'],\n\t\t\t["(UTC+11:00) Norfolk Island", \'Pacific/Norfolk\'],\n\t\t\t["(UTC+11:00) Sakhalin", \'Asia/Sakhalin\'],\n\t\t\t["(UTC+11:00) Solomon Islands, New Caledonia", \'Pacific/Guadalcanal\'],\n\t\t\t["(UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky", \'Asia/Anadyr\'],\n\t\t\t["(UTC+12:00) Auckland, Wellington", \'Pacific/Auckland\'],\n\t\t\t["(UTC+12:00) Fiji Islands", \'Pacific/Fiji\'],\n\t\t\t["(UTC+12:45) Chatham Islands", \'Pacific/Chatham\'],\n\t\t\t["(UTC+13:00) Nuku\'alofa", \'Pacific/Tongatapu\'],\n\t\t\t["(UTC+13:00) Samoa", \'Pacific/Apia\'],\n\t\t\t["(UTC+14:00) Kiritimati Island", \'Pacific/Kiritimati\']\n\t\t];\n\n\t\tvar _manual_alts = {\n\t\t\t"America\\/Guatemala": "America\\/Belize",\n\t\t\t"America\\/Indianapolis": "America\\/Indiana\\/Indianapolis",\n\t\t\t"America\\/La_Paz": "America\\/Manaus",\n\t\t\t"UTC": "Africa\\/Monrovia",\n\t\t\t"Atlantic\\/Reykjavik": "Africa\\/Monrovia",\n\t\t\t"Europe\\/Berlin": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Budapest": "Europe\\/Belgrade",\n\t\t\t"Europe\\/Paris": "Europe\\/Brussels",\n\t\t\t"Africa\\/Lagos": "Africa\\/Algiers",\n\t\t\t"Europe\\/Bucharest": "Europe\\/Athens",\n\t\t\t"Africa\\/Johannesburg": "Africa\\/Harare",\n\t\t\t"Europe\\/Kiev": "Europe\\/Helsinki",\n\t\t\t"Europe\\/Istanbul": "Asia\\/Istanbul",\n\t\t\t"Asia\\/Riyadh": "Asia\\/Kuwait",\n\t\t\t"Asia\\/Dubai": "Asia\\/Muscat",\n\t\t\t"Asia\\/Calcutta": "Asia\\/Kolkata",\n\t\t\t"Asia\\/Shanghai": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Singapore": "Asia\\/Kuala_Lumpur",\n\t\t\t"Australia\\/Sydney": "Australia\\/Canberra",\n\t\t\t"Pacific\\/Port_Moresby": "Pacific\\/Guam",\n\t\t\t"Asia\\/Kamchatka": "Asia\\/Anadyr"\n\t\t}\n\t\tvar _auto_alts = {\n\t\t\t"Africa\\/Abidjan": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Accra": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Addis_Ababa": "Europe\\/Moscow",\n\t\t\t"Africa\\/Asmara": "Europe\\/Moscow",\n\t\t\t"Africa\\/Asmera": "Europe\\/Moscow",\n\t\t\t"Africa\\/Bamako": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Bangui": "Africa\\/Algiers",\n\t\t\t"Africa\\/Banjul": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Bissau": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Blantyre": "Africa\\/Harare",\n\t\t\t"Africa\\/Brazzaville": "Africa\\/Algiers",\n\t\t\t"Africa\\/Bujumbura": "Africa\\/Harare",\n\t\t\t"Africa\\/Ceuta": "Europe\\/Amsterdam",\n\t\t\t"Africa\\/Conakry": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Dakar": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Dar_es_Salaam": "Europe\\/Moscow",\n\t\t\t"Africa\\/Djibouti": "Europe\\/Moscow",\n\t\t\t"Africa\\/Douala": "Africa\\/Algiers",\n\t\t\t"Africa\\/El_Aaiun": "Africa\\/Casablanca",\n\t\t\t"Africa\\/Freetown": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Gaborone": "Africa\\/Harare",\n\t\t\t"Africa\\/Johannesburg": "Africa\\/Harare",\n\t\t\t"Africa\\/Juba": "Europe\\/Moscow",\n\t\t\t"Africa\\/Kampala": "Europe\\/Moscow",\n\t\t\t"Africa\\/Khartoum": "Europe\\/Moscow",\n\t\t\t"Africa\\/Kigali": "Africa\\/Harare",\n\t\t\t"Africa\\/Kinshasa": "Africa\\/Algiers",\n\t\t\t"Africa\\/Lagos": "Africa\\/Algiers",\n\t\t\t"Africa\\/Libreville": "Africa\\/Algiers",\n\t\t\t"Africa\\/Lome": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Luanda": "Africa\\/Algiers",\n\t\t\t"Africa\\/Lubumbashi": "Africa\\/Harare",\n\t\t\t"Africa\\/Lusaka": "Africa\\/Harare",\n\t\t\t"Africa\\/Malabo": "Africa\\/Algiers",\n\t\t\t"Africa\\/Maputo": "Africa\\/Harare",\n\t\t\t"Africa\\/Maseru": "Africa\\/Harare",\n\t\t\t"Africa\\/Mbabane": "Africa\\/Harare",\n\t\t\t"Africa\\/Mogadishu": "Europe\\/Moscow",\n\t\t\t"Africa\\/Ndjamena": "Africa\\/Algiers",\n\t\t\t"Africa\\/Niamey": "Africa\\/Algiers",\n\t\t\t"Africa\\/Nouakchott": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Ouagadougou": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Porto-Novo": "Africa\\/Algiers",\n\t\t\t"Africa\\/Sao_Tome": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Timbuktu": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Tunis": "Africa\\/Algiers",\n\t\t\t"America\\/Anguilla": "America\\/Manaus",\n\t\t\t"America\\/Antigua": "America\\/Manaus",\n\t\t\t"America\\/Araguaina": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Buenos_Aires": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Catamarca": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/ComodRivadavia": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Cordoba": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Jujuy": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/La_Rioja": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Mendoza": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Rio_Gallegos": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Salta": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/San_Juan": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/San_Luis": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Tucuman": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Ushuaia": "America\\/Buenos_Aires",\n\t\t\t"America\\/Aruba": "America\\/Manaus",\n\t\t\t"America\\/Atikokan": "America\\/Bogota",\n\t\t\t"America\\/Atka": "America\\/Adak",\n\t\t\t"America\\/Bahia_Banderas": "America\\/Mexico_City",\n\t\t\t"America\\/Barbados": "America\\/Manaus",\n\t\t\t"America\\/Belem": "America\\/Buenos_Aires",\n\t\t\t"America\\/Blanc-Sablon": "America\\/Manaus",\n\t\t\t"America\\/Boa_Vista": "America\\/Manaus",\n\t\t\t"America\\/Boise": "America\\/Denver",\n\t\t\t"America\\/Cambridge_Bay": "America\\/Denver",\n\t\t\t"America\\/Campo_Grande": "America\\/Cuiaba",\n\t\t\t"America\\/Catamarca": "America\\/Buenos_Aires",\n\t\t\t"America\\/Cayman": "America\\/Bogota",\n\t\t\t"America\\/Coral_Harbour": "America\\/Bogota",\n\t\t\t"America\\/Cordoba": "America\\/Buenos_Aires",\n\t\t\t"America\\/Costa_Rica": "America\\/Regina",\n\t\t\t"America\\/Creston": "America\\/Phoenix",\n\t\t\t"America\\/Curacao": "America\\/Manaus",\n\t\t\t"America\\/Danmarkshavn": "Africa\\/Monrovia",\n\t\t\t"America\\/Dawson": "America\\/Los_Angeles",\n\t\t\t"America\\/Dawson_Creek": "America\\/Phoenix",\n\t\t\t"America\\/Detroit": "America\\/New_York",\n\t\t\t"America\\/Dominica": "America\\/Manaus",\n\t\t\t"America\\/Edmonton": "America\\/Denver",\n\t\t\t"America\\/Eirunepe": "America\\/Bogota",\n\t\t\t"America\\/El_Salvador": "America\\/Regina",\n\t\t\t"America\\/Ensenada": "America\\/Los_Angeles",\n\t\t\t"America\\/Fort_Wayne": "America\\/New_York",\n\t\t\t"America\\/Glace_Bay": "America\\/Halifax",\n\t\t\t"America\\/Goose_Bay": "America\\/Halifax",\n\t\t\t"America\\/Grenada": "America\\/Manaus",\n\t\t\t"America\\/Guadeloupe": "America\\/Manaus",\n\t\t\t"America\\/Guatemala": "America\\/Regina",\n\t\t\t"America\\/Guayaquil": "America\\/Bogota",\n\t\t\t"America\\/Guyana": "America\\/Manaus",\n\t\t\t"America\\/Hermosillo": "America\\/Phoenix",\n\t\t\t"America\\/Indiana\\/Knox": "America\\/Chicago",\n\t\t\t"America\\/Indiana\\/Marengo": "America\\/New_York",\n\t\t\t"America\\/Indiana\\/Petersburg": "America\\/New_York",\n\t\t\t"America\\/Indiana\\/Tell_City": "America\\/Chicago",\n\t\t\t"America\\/Indiana\\/Vevay": "America\\/New_York",\n\t\t\t"America\\/Indiana\\/Vincennes": "America\\/New_York",\n\t\t\t"America\\/Indiana\\/Winamac": "America\\/New_York",\n\t\t\t"America\\/Indianapolis": "America\\/New_York",\n\t\t\t"America\\/Inuvik": "America\\/Denver",\n\t\t\t"America\\/Iqaluit": "America\\/New_York",\n\t\t\t"America\\/Jamaica": "America\\/Bogota",\n\t\t\t"America\\/Jujuy": "America\\/Buenos_Aires",\n\t\t\t"America\\/Juneau": "America\\/Anchorage",\n\t\t\t"America\\/Kentucky\\/Louisville": "America\\/New_York",\n\t\t\t"America\\/Kentucky\\/Monticello": "America\\/New_York",\n\t\t\t"America\\/Knox_IN": "America\\/Chicago",\n\t\t\t"America\\/Kralendijk": "America\\/Manaus",\n\t\t\t"America\\/La_Paz": "America\\/Manaus",\n\t\t\t"America\\/Lima": "America\\/Bogota",\n\t\t\t"America\\/Louisville": "America\\/New_York",\n\t\t\t"America\\/Lower_Princes": "America\\/Manaus",\n\t\t\t"America\\/Maceio": "America\\/Buenos_Aires",\n\t\t\t"America\\/Managua": "America\\/Regina",\n\t\t\t"America\\/Marigot": "America\\/Manaus",\n\t\t\t"America\\/Martinique": "America\\/Manaus",\n\t\t\t"America\\/Matamoros": "America\\/Chicago",\n\t\t\t"America\\/Mazatlan": "America\\/Chihuahua",\n\t\t\t"America\\/Mendoza": "America\\/Buenos_Aires",\n\t\t\t"America\\/Menominee": "America\\/Chicago",\n\t\t\t"America\\/Merida": "America\\/Mexico_City",\n\t\t\t"America\\/Moncton": "America\\/Halifax",\n\t\t\t"America\\/Monterrey": "America\\/Mexico_City",\n\t\t\t"America\\/Montreal": "America\\/New_York",\n\t\t\t"America\\/Montserrat": "America\\/Manaus",\n\t\t\t"America\\/Nassau": "America\\/New_York",\n\t\t\t"America\\/Nipigon": "America\\/New_York",\n\t\t\t"America\\/Nome": "America\\/Anchorage",\n\t\t\t"America\\/North_Dakota\\/Beulah": "America\\/Chicago",\n\t\t\t"America\\/North_Dakota\\/Center": "America\\/Chicago",\n\t\t\t"America\\/North_Dakota\\/New_Salem": "America\\/Chicago",\n\t\t\t"America\\/Ojinaga": "America\\/Denver",\n\t\t\t"America\\/Panama": "America\\/Bogota",\n\t\t\t"America\\/Pangnirtung": "America\\/New_York",\n\t\t\t"America\\/Paramaribo": "America\\/Buenos_Aires",\n\t\t\t"America\\/Port_of_Spain": "America\\/Manaus",\n\t\t\t"America\\/Porto_Acre": "America\\/Bogota",\n\t\t\t"America\\/Porto_Velho": "America\\/Manaus",\n\t\t\t"America\\/Puerto_Rico": "America\\/Manaus",\n\t\t\t"America\\/Rainy_River": "America\\/Chicago",\n\t\t\t"America\\/Rankin_Inlet": "America\\/Chicago",\n\t\t\t"America\\/Recife": "America\\/Buenos_Aires",\n\t\t\t"America\\/Resolute": "America\\/Chicago",\n\t\t\t"America\\/Rio_Branco": "America\\/Bogota",\n\t\t\t"America\\/Rosario": "America\\/Buenos_Aires",\n\t\t\t"America\\/Santa_Isabel": "America\\/Los_Angeles",\n\t\t\t"America\\/Santarem": "America\\/Buenos_Aires",\n\t\t\t"America\\/Santo_Domingo": "America\\/Manaus",\n\t\t\t"America\\/Scoresbysund": "Atlantic\\/Azores",\n\t\t\t"America\\/Shiprock": "America\\/Denver",\n\t\t\t"America\\/Sitka": "America\\/Anchorage",\n\t\t\t"America\\/St_Barthelemy": "America\\/Manaus",\n\t\t\t"America\\/St_Kitts": "America\\/Manaus",\n\t\t\t"America\\/St_Lucia": "America\\/Manaus",\n\t\t\t"America\\/St_Thomas": "America\\/Manaus",\n\t\t\t"America\\/St_Vincent": "America\\/Manaus",\n\t\t\t"America\\/Swift_Current": "America\\/Regina",\n\t\t\t"America\\/Tegucigalpa": "America\\/Regina",\n\t\t\t"America\\/Thule": "America\\/Halifax",\n\t\t\t"America\\/Thunder_Bay": "America\\/New_York",\n\t\t\t"America\\/Toronto": "America\\/New_York",\n\t\t\t"America\\/Tortola": "America\\/Manaus",\n\t\t\t"America\\/Vancouver": "America\\/Los_Angeles",\n\t\t\t"America\\/Virgin": "America\\/Manaus",\n\t\t\t"America\\/Whitehorse": "America\\/Los_Angeles",\n\t\t\t"America\\/Winnipeg": "America\\/Chicago",\n\t\t\t"America\\/Yakutat": "America\\/Anchorage",\n\t\t\t"America\\/Yellowknife": "America\\/Denver",\n\t\t\t"Antarctica\\/Casey": "Asia\\/Chongqing",\n\t\t\t"Antarctica\\/Davis": "Asia\\/Bangkok",\n\t\t\t"Antarctica\\/DumontDUrville": "Australia\\/Brisbane",\n\t\t\t"Antarctica\\/Macquarie": "Pacific\\/Bougainville",\n\t\t\t"Antarctica\\/Mawson": "Asia\\/Tashkent",\n\t\t\t"Antarctica\\/McMurdo": "Pacific\\/Auckland",\n\t\t\t"Antarctica\\/Palmer": "America\\/Santiago",\n\t\t\t"Antarctica\\/Rothera": "America\\/Buenos_Aires",\n\t\t\t"Antarctica\\/South_Pole": "Pacific\\/Auckland",\n\t\t\t"Antarctica\\/Syowa": "Europe\\/Moscow",\n\t\t\t"Antarctica\\/Vostok": "Asia\\/Dhaka",\n\t\t\t"Arctic\\/Longyearbyen": "Europe\\/Amsterdam",\n\t\t\t"Asia\\/Aden": "Europe\\/Moscow",\n\t\t\t"Asia\\/Aqtau": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Aqtobe": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Ashgabat": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Ashkhabad": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Bahrain": "Europe\\/Moscow",\n\t\t\t"Asia\\/Bishkek": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Brunei": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Calcutta": "Asia\\/Kolkata",\n\t\t\t"Asia\\/Choibalsan": "Asia\\/Ulaanbaatar",\n\t\t\t"Asia\\/Chungking": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Dacca": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Dili": "Asia\\/Tokyo",\n\t\t\t"Asia\\/Dubai": "Asia\\/Muscat",\n\t\t\t"Asia\\/Dushanbe": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Harbin": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Hebron": "Asia\\/Gaza",\n\t\t\t"Asia\\/Ho_Chi_Minh": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Hong_Kong": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Jakarta": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Jayapura": "Asia\\/Tokyo",\n\t\t\t"Asia\\/Kamchatka": "Asia\\/Anadyr",\n\t\t\t"Asia\\/Kashgar": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Kathmandu": "Asia\\/Katmandu",\n\t\t\t"Asia\\/Khandyga": "Asia\\/Tokyo",\n\t\t\t"Asia\\/Kuching": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Macao": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Macau": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Makassar": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Manila": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Nicosia": "Europe\\/Athens",\n\t\t\t"Asia\\/Novokuznetsk": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Omsk": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Oral": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Phnom_Penh": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Pontianak": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Qatar": "Europe\\/Moscow",\n\t\t\t"Asia\\/Qyzylorda": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Riyadh": "Europe\\/Moscow",\n\t\t\t"Asia\\/Saigon": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Samarkand": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Shanghai": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Singapore": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Tel_Aviv": "Asia\\/Jerusalem",\n\t\t\t"Asia\\/Thimbu": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Thimphu": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Ujung_Pandang": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Ulan_Bator": "Asia\\/Ulaanbaatar",\n\t\t\t"Asia\\/Urumqi": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Ust-Nera": "Australia\\/Brisbane",\n\t\t\t"Asia\\/Vientiane": "Asia\\/Bangkok",\n\t\t\t"Atlantic\\/Bermuda": "America\\/Halifax",\n\t\t\t"Atlantic\\/Canary": "Europe\\/London",\n\t\t\t"Atlantic\\/Faeroe": "Europe\\/London",\n\t\t\t"Atlantic\\/Faroe": "Europe\\/London",\n\t\t\t"Atlantic\\/Jan_Mayen": "Europe\\/Amsterdam",\n\t\t\t"Atlantic\\/Madeira": "Europe\\/London",\n\t\t\t"Atlantic\\/Reykjavik": "Africa\\/Monrovia",\n\t\t\t"Atlantic\\/South_Georgia": "America\\/Noronha",\n\t\t\t"Atlantic\\/St_Helena": "Africa\\/Monrovia",\n\t\t\t"Atlantic\\/Stanley": "America\\/Buenos_Aires",\n\t\t\t"Australia\\/ACT": "Australia\\/Canberra",\n\t\t\t"Australia\\/Broken_Hill": "Australia\\/Adelaide",\n\t\t\t"Australia\\/Currie": "Australia\\/Canberra",\n\t\t\t"Australia\\/LHI": "Australia\\/Lord_Howe",\n\t\t\t"Australia\\/Lindeman": "Australia\\/Brisbane",\n\t\t\t"Australia\\/Melbourne": "Australia\\/Canberra",\n\t\t\t"Australia\\/NSW": "Australia\\/Canberra",\n\t\t\t"Australia\\/North": "Australia\\/Darwin",\n\t\t\t"Australia\\/Queensland": "Australia\\/Brisbane",\n\t\t\t"Australia\\/South": "Australia\\/Adelaide",\n\t\t\t"Australia\\/Sydney": "Australia\\/Canberra",\n\t\t\t"Australia\\/Tasmania": "Australia\\/Canberra",\n\t\t\t"Australia\\/Victoria": "Australia\\/Canberra",\n\t\t\t"Australia\\/West": "Asia\\/Chongqing",\n\t\t\t"Australia\\/Yancowinna": "Australia\\/Adelaide",\n\t\t\t"Brazil\\/Acre": "America\\/Bogota",\n\t\t\t"Brazil\\/DeNoronha": "America\\/Noronha",\n\t\t\t"Brazil\\/East": "America\\/Sao_Paulo",\n\t\t\t"Brazil\\/West": "America\\/Manaus",\n\t\t\t"CET": "Europe\\/Amsterdam",\n\t\t\t"CST6CDT": "America\\/Chicago",\n\t\t\t"Canada\\/Atlantic": "America\\/Halifax",\n\t\t\t"Canada\\/Central": "America\\/Chicago",\n\t\t\t"Canada\\/East-Saskatchewan": "America\\/Regina",\n\t\t\t"Canada\\/Eastern": "America\\/New_York",\n\t\t\t"Canada\\/Mountain": "America\\/Denver",\n\t\t\t"Canada\\/Newfoundland": "America\\/St_Johns",\n\t\t\t"Canada\\/Pacific": "America\\/Los_Angeles",\n\t\t\t"Canada\\/Saskatchewan": "America\\/Regina",\n\t\t\t"Canada\\/Yukon": "America\\/Los_Angeles",\n\t\t\t"Chile\\/Continental": "America\\/Santiago",\n\t\t\t"Chile\\/EasterIsland": "Pacific\\/Easter",\n\t\t\t"Cuba": "America\\/Havana",\n\t\t\t"EET": "Europe\\/Athens",\n\t\t\t"EST": "America\\/New_York",\n\t\t\t"EST5EDT": "America\\/New_York",\n\t\t\t"Egypt": "Africa\\/Cairo",\n\t\t\t"Eire": "Europe\\/London",\n\t\t\t"Etc\\/GMT": "Africa\\/Monrovia",\n\t\t\t"Etc\\/GMT+0": "Africa\\/Monrovia",\n\t\t\t"Etc\\/GMT+1": "Atlantic\\/Cape_Verde",\n\t\t\t"Etc\\/GMT+10": "Pacific\\/Honolulu",\n\t\t\t"Etc\\/GMT+11": "Pacific\\/Midway",\n\t\t\t"Etc\\/GMT+2": "America\\/Noronha",\n\t\t\t"Etc\\/GMT+3": "America\\/Buenos_Aires",\n\t\t\t"Etc\\/GMT+4": "America\\/Manaus",\n\t\t\t"Etc\\/GMT+5": "America\\/Bogota",\n\t\t\t"Etc\\/GMT+6": "America\\/Regina",\n\t\t\t"Etc\\/GMT+7": "America\\/Phoenix",\n\t\t\t"Etc\\/GMT-0": "Africa\\/Monrovia",\n\t\t\t"Etc\\/GMT-1": "Africa\\/Algiers",\n\t\t\t"Etc\\/GMT-10": "Australia\\/Brisbane",\n\t\t\t"Etc\\/GMT-11": "Pacific\\/Bougainville",\n\t\t\t"Etc\\/GMT-12": "Asia\\/Anadyr",\n\t\t\t"Etc\\/GMT-13": "Pacific\\/Tongatapu",\n\t\t\t"Etc\\/GMT-14": "Pacific\\/Kiritimati",\n\t\t\t"Etc\\/GMT-2": "Africa\\/Harare",\n\t\t\t"Etc\\/GMT-3": "Europe\\/Moscow",\n\t\t\t"Etc\\/GMT-4": "Asia\\/Muscat",\n\t\t\t"Etc\\/GMT-5": "Asia\\/Tashkent",\n\t\t\t"Etc\\/GMT-6": "Asia\\/Dhaka",\n\t\t\t"Etc\\/GMT-7": "Asia\\/Bangkok",\n\t\t\t"Etc\\/GMT-8": "Asia\\/Chongqing",\n\t\t\t"Etc\\/GMT-9": "Asia\\/Tokyo",\n\t\t\t"Etc\\/GMT0": "Africa\\/Monrovia",\n\t\t\t"Etc\\/Greenwich": "Africa\\/Monrovia",\n\t\t\t"Etc\\/UCT": "Africa\\/Monrovia",\n\t\t\t"Etc\\/UTC": "Africa\\/Monrovia",\n\t\t\t"Etc\\/Universal": "Africa\\/Monrovia",\n\t\t\t"Etc\\/Zulu": "Africa\\/Monrovia",\n\t\t\t"Europe\\/Andorra": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Belfast": "Europe\\/London",\n\t\t\t"Europe\\/Berlin": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Bratislava": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Bucharest": "Europe\\/Athens",\n\t\t\t"Europe\\/Budapest": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Busingen": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Copenhagen": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Dublin": "Europe\\/London",\n\t\t\t"Europe\\/Gibraltar": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Guernsey": "Europe\\/London",\n\t\t\t"Europe\\/Isle_of_Man": "Europe\\/London",\n\t\t\t"Europe\\/Istanbul": "Asia\\/Istanbul",\n\t\t\t"Europe\\/Jersey": "Europe\\/London",\n\t\t\t"Europe\\/Kiev": "Europe\\/Athens",\n\t\t\t"Europe\\/Kirov": "Europe\\/Moscow",\n\t\t\t"Europe\\/Lisbon": "Europe\\/London",\n\t\t\t"Europe\\/Ljubljana": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Luxembourg": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Madrid": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Malta": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Mariehamn": "Europe\\/Athens",\n\t\t\t"Europe\\/Monaco": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Nicosia": "Europe\\/Athens",\n\t\t\t"Europe\\/Oslo": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Paris": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Podgorica": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Prague": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Riga": "Europe\\/Athens",\n\t\t\t"Europe\\/Rome": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/San_Marino": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Sarajevo": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Simferopol": "Europe\\/Moscow",\n\t\t\t"Europe\\/Skopje": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Sofia": "Europe\\/Athens",\n\t\t\t"Europe\\/Stockholm": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Tallinn": "Europe\\/Athens",\n\t\t\t"Europe\\/Tirane": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Ulyanovsk": "Europe\\/Astrakhan",\n\t\t\t"Europe\\/Uzhgorod": "Europe\\/Athens",\n\t\t\t"Europe\\/Vaduz": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Vatican": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Vienna": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Vilnius": "Europe\\/Athens",\n\t\t\t"Europe\\/Volgograd": "Europe\\/Moscow",\n\t\t\t"Europe\\/Zagreb": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Zaporozhye": "Europe\\/Athens",\n\t\t\t"Europe\\/Zurich": "Europe\\/Amsterdam",\n\t\t\t"Factory": "Africa\\/Monrovia",\n\t\t\t"GB": "Europe\\/London",\n\t\t\t"GB-Eire": "Europe\\/London",\n\t\t\t"GMT": "Africa\\/Monrovia",\n\t\t\t"GMT+0": "Africa\\/Monrovia",\n\t\t\t"GMT-0": "Africa\\/Monrovia",\n\t\t\t"GMT0": "Africa\\/Monrovia",\n\t\t\t"Greenwich": "Africa\\/Monrovia",\n\t\t\t"HST": "Pacific\\/Honolulu",\n\t\t\t"Hongkong": "Asia\\/Chongqing",\n\t\t\t"Iceland": "Africa\\/Monrovia",\n\t\t\t"Indian\\/Antananarivo": "Europe\\/Moscow",\n\t\t\t"Indian\\/Chagos": "Asia\\/Dhaka",\n\t\t\t"Indian\\/Christmas": "Asia\\/Bangkok",\n\t\t\t"Indian\\/Cocos": "Asia\\/Rangoon",\n\t\t\t"Indian\\/Comoro": "Europe\\/Moscow",\n\t\t\t"Indian\\/Kerguelen": "Asia\\/Tashkent",\n\t\t\t"Indian\\/Mahe": "Asia\\/Muscat",\n\t\t\t"Indian\\/Maldives": "Asia\\/Tashkent",\n\t\t\t"Indian\\/Mayotte": "Europe\\/Moscow",\n\t\t\t"Indian\\/Reunion": "Asia\\/Muscat",\n\t\t\t"Iran": "Asia\\/Tehran",\n\t\t\t"Israel": "Asia\\/Jerusalem",\n\t\t\t"Jamaica": "America\\/Bogota",\n\t\t\t"Japan": "Asia\\/Tokyo",\n\t\t\t"Kwajalein": "Asia\\/Anadyr",\n\t\t\t"Libya": "Africa\\/Harare",\n\t\t\t"MET": "Europe\\/Amsterdam",\n\t\t\t"MST": "America\\/Denver",\n\t\t\t"MST7MDT": "America\\/Denver",\n\t\t\t"Mexico\\/BajaNorte": "America\\/Los_Angeles",\n\t\t\t"Mexico\\/BajaSur": "America\\/Chihuahua",\n\t\t\t"Mexico\\/General": "America\\/Mexico_City",\n\t\t\t"NZ": "Pacific\\/Auckland",\n\t\t\t"NZ-CHAT": "Pacific\\/Chatham",\n\t\t\t"Navajo": "America\\/Denver",\n\t\t\t"PRC": "Asia\\/Chongqing",\n\t\t\t"PST8PDT": "America\\/Los_Angeles",\n\t\t\t"Pacific\\/Chuuk": "Australia\\/Brisbane",\n\t\t\t"Pacific\\/Efate": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Enderbury": "Pacific\\/Tongatapu",\n\t\t\t"Pacific\\/Fakaofo": "Pacific\\/Tongatapu",\n\t\t\t"Pacific\\/Funafuti": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Galapagos": "America\\/Regina",\n\t\t\t"Pacific\\/Johnston": "Pacific\\/Honolulu",\n\t\t\t"Pacific\\/Kosrae": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Kwajalein": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Majuro": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Nauru": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Niue": "Pacific\\/Midway",\n\t\t\t"Pacific\\/Noumea": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Pago_Pago": "Pacific\\/Midway",\n\t\t\t"Pacific\\/Palau": "Asia\\/Tokyo",\n\t\t\t"Pacific\\/Pohnpei": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Ponape": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Port_Moresby": "Australia\\/Brisbane",\n\t\t\t"Pacific\\/Rarotonga": "Pacific\\/Honolulu",\n\t\t\t"Pacific\\/Saipan": "Australia\\/Brisbane",\n\t\t\t"Pacific\\/Samoa": "Pacific\\/Midway",\n\t\t\t"Pacific\\/Tahiti": "Pacific\\/Honolulu",\n\t\t\t"Pacific\\/Tarawa": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Truk": "Australia\\/Brisbane",\n\t\t\t"Pacific\\/Wake": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Wallis": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Yap": "Australia\\/Brisbane",\n\t\t\t"Poland": "Europe\\/Amsterdam",\n\t\t\t"Portugal": "Europe\\/London",\n\t\t\t"ROC": "Asia\\/Chongqing",\n\t\t\t"ROK": "Asia\\/Tokyo",\n\t\t\t"Singapore": "Asia\\/Chongqing",\n\t\t\t"Turkey": "Asia\\/Istanbul",\n\t\t\t"UCT": "Africa\\/Monrovia",\n\t\t\t"US\\/Alaska": "America\\/Anchorage",\n\t\t\t"US\\/Aleutian": "America\\/Adak",\n\t\t\t"US\\/Arizona": "America\\/Phoenix",\n\t\t\t"US\\/Central": "America\\/Chicago",\n\t\t\t"US\\/East-Indiana": "America\\/New_York",\n\t\t\t"US\\/Eastern": "America\\/New_York",\n\t\t\t"US\\/Hawaii": "Pacific\\/Honolulu",\n\t\t\t"US\\/Indiana-Starke": "America\\/Chicago",\n\t\t\t"US\\/Michigan": "America\\/New_York",\n\t\t\t"US\\/Mountain": "America\\/Denver",\n\t\t\t"US\\/Pacific": "America\\/Los_Angeles",\n\t\t\t"US\\/Pacific-New": "America\\/Los_Angeles",\n\t\t\t"US\\/Samoa": "Pacific\\/Midway",\n\t\t\t"UTC": "Africa\\/Monrovia",\n\t\t\t"Universal": "Africa\\/Monrovia",\n\t\t\t"W-SU": "Europe\\/Moscow",\n\t\t\t"WET": "Europe\\/Amsterdam",\n\t\t\t"Zulu": "Africa\\/Monrovia"\n\t\t};\n\t\tvar _fallback_alts = {\n\t\t\t"America\\/Fort_Nelson": "America\\/Denver"\n\t\t};\n\n\t\t// The follow zone IDs have no mapping to our choice list:\n\t\t// America/Metlakatla\n\t\t// Antarctica/Troll\n\t\t// Europe/Chisinau\n\t\t// Pacific/Gambier\n\t\t// Pacific/Pitcairn\n\t\t// Etc/GMT+12 (Obsolete)\n\t\t// Etc/GMT+8 (Obsolete)\n\t\t// Etc/GMT+9 (Obsolete)\n\t\t// Europe/Tiraspol (Obsolete)\n\n\n\t\treturn self;\n\t}\n\n\t// export\n\tif (typeof exports !== \'undefined\'){\n\t\tif (typeof module !== \'undefined\' && module.exports){\n\t\t\texports = module.exports = tz;\n\t\t}\n\t\texports.TimezoneDetector = tz;\n\t}else if (typeof define === \'function\' && define.amd){\n\t\tdefine(function() { return tz; })\n\t}else{\n\t\troot.TimezoneDetector = tz;\n\t}\n\n}).call(function(){\n\treturn this || (typeof window !== \'undefined\' ? window : global);\n}());\n'},3641:function(e,t){(function(){"use strict";TS.registerModule("files.media",{INLINE_VIDEO_CLASS_NAME:"inline_video",COUNT_LABEL_MOV_CANPLAY:"inline_mov_canplay",COUNT_LABEL_MOV_ERROR:"inline_mov_error",bindVideoElements:function t(i){var n=$(_.get(i,"container","body"));var a=_.get(i,"onCanplay",_.noop);var r=_.get(i,"onError",_.noop);n[0].addEventListener("canplay",function(t){var i=$(t.target);if(i.hasClass(TS.files.media.INLINE_VIDEO_CLASS_NAME)){e(i,TS.files.media.COUNT_LABEL_MOV_CANPLAY);a(i)}},true);n[0].addEventListener("error",function(t){var i=$(t.target);if(i.hasClass(TS.files.media.INLINE_VIDEO_CLASS_NAME)){e(i,TS.files.media.COUNT_LABEL_MOV_ERROR);r(i)}},true);n[0].addEventListener("play",function(e){var t=$(e.target);var i=t.closest("ts-message");var n=""+i.data("ts");var a=i.data("model-ob-id");var r=i.data("member-id");var s=i.data("app-id");var o=i.data("bot-id");var l=i.find(".msg_inline_video_new_window_button");var d=l.data("referer-original-href");var c=d||l.attr("href");var _={message_timestamp:n,channel_id:a,channel_type:a?a.charAt(0):"",member_id:r,app_id:s,bot_id:o,url:c||""};TS.clog.track("MSG_VIDEO_PLAY",_)},true);n.find("."+TS.files.media.INLINE_VIDEO_CLASS_NAME).each(function(){var e=$(this);if(this.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA)a(e);else if(this.error)r(e)})},test:function e(){return{_isSrcMov:t}}});var e=function e(i,n){if(t(i.attr("src")))TS.metrics.count(n)};var t=function e(t){return _.isString(t)&&"mov"===_.last(t.split(".")).toLowerCase()}})()},3643:function(e,t){(function(){"use strict";TS.registerModule("coachmark",{$coachmark:null,context:null,is_showing:false,is_small:false,reject_on_off_target_click:false,onStart:function e(){},start:function n(a,r,s){if(!a)return;if(TS.coachmark.is_showing)TS.coachmark.end();if(!TS.coachmark.$coachmark)t(a,r);i(a);var o=TS.coachmark.$coachmark;if(!$("#"+a.coachmark_el_id).length){TS.error(["Cannot show coachmark ",a.id," because there is no element ",a.coachmark_el_id,""].join('"'));o.addClass("hidden");return}s=s||{};TS.coachmark.clean();TS.coachmark.context=a;TS.model.coachmark_is_showing=true;TS.coachmark.is_showing=true;TS.coachmark.reject_on_off_target_click=_.get(s,"reject_on_off_target_click",false);o.removeClass("hidden");o.css("left","").css("right","").css("top","").css("bottom","").css("height","auto").css("width","auto");$("#coachmark_callout").css("left","").css("right","").css("top","").css("bottom","");o.addClass(a.coachmark_el_id);$("#"+a.coachmark_el_id).removeClass("hidden");if(!a.reject)$("#coachmark_footer > .coachmark_footer_text").addClass("hidden");$(window.document).bind("keydown",TS.coachmark.onKeyDown);if(!a.has_close_btn)$("html").bind("mousedown",TS.coachmark.onMouseDown);else $("#coachmark_bg").on("click",TS.coachmark.end);if(a.disable_scrolling)$("#client-ui").addClass("disable_scrolling");o.css("opacity",1);if(a.place&&a.placeSmall){o.addClass("small_coachmark");TS.coachmark.is_small=true}e();$(window).on("resize.coachmark_placement",e);if(TS.coachmark.context.ui_click){$(".coachmark_got_it").removeClass("hidden");$(".coachmark_next_tip").addClass("hidden")}if(!TS.coachmark.context.no_bg_on_small&&!TS.coachmark.context.no_bg)$("#coachmark_bg").removeClass("hidden")},placeRightOf:function e(t,i,n,a,r){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;i=i||0;n=n||0;a=a||0;var s=TS.coachmark.$coachmark;var o=30;var l=18;var d;if(r)d={top:0,left:0};else d=t.offset();s.css("top",d.top+i);s.css("left",d.left+t.width()+n);if(!r)TS.coachmark.keepInBounds();var c=s.dimensions_rect();if(r)$("#coachmark_callout").css("top",l+a).css("left",-10);else $("#coachmark_callout").css("top",Math.round(_.clamp(d.top-c.top+(t.height()-o)/2+a,l,c.height-(l+o)))).css("left",-10)},placeBelowOf:function e(t,i,n,a,r){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;i=i||0;n=n||0;a=a||0;var s=TS.coachmark.$coachmark;var o=30;var l=18;var d;if(r)d={top:0,left:0};else d=t.offset();s.css("top",d.top+t.height()+i);s.css("left",d.left+n);if(!r)TS.coachmark.keepInBounds();var c=s.dimensions_rect();if(r)$("#coachmark_callout").css("left",l+a).css("top",-10);else $("#coachmark_callout").css("left",Math.round(_.clamp(d.left-c.left+(t.width()-o)/2+a,l,c.width-(l+o)))).css("top",-10)},placeAboveOf:function e(t,i,n,a,r){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;i=i||0;n=n||0;a=a||0;var s=TS.coachmark.$coachmark;var o=30;var l=18;var d;if(r)d={top:0,left:0};else d=t.offset();s.css("top",d.top-o-s.height()+i);s.css("left",d.left+n);if(!r)TS.coachmark.keepInBounds();var c=s.dimensions_rect();if(r)$("#coachmark_callout").css("left",l+a).css("bottom",-10);else $("#coachmark_callout").css("left",Math.round(_.clamp(d.left-c.left+(t.width()-o)/2+a,l,c.width-(l+o)))).css("bottom",-10)},placeLeftOf:function e(t,i,n,a,r){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;i=i||0;n=n||0;a=a||0;var s=TS.coachmark.$coachmark;var o=30;var l=18;var d;if(r)d={top:0,left:0};else d=t.offset();s.css("top",d.top+i);s.css("left",d.left-s.width()+n);if(!r)TS.coachmark.keepInBounds();var c=s.dimensions_rect();if(r)$("#coachmark_callout").css("top",l+a).css("right",-10);else $("#coachmark_callout").css("top",Math.round(_.clamp(d.top-c.top+(t.height()-o)/2+a,l,c.height-(l+o)))).css("right",-10)},keepInBounds:function e(){if(!TS.coachmark.context||!TS.coachmark.$coachmark)return;var t=TS.coachmark.$coachmark;var i=TS.coachmark.context;var n=4;var a=t.dimensions_rect();var r={top:0+n,right:$(window).width()-n,bottom:$(window).height()-n,left:0+n};if(!i.place)t.css("left","").css("right","").css("top","").css("bottom","");if(TS.utility.doesRectContainRect(r,a))return;if(a.left<r.left)t.css("left",r.left);else if(a.right>r.right)t.css("left",Math.max(r.left,r.right-a.width));if(a.top<r.top)t.css("top",r.top);else if(a.bottom>r.bottom)t.css("top",Math.max(r.top,r.bottom-a.height))},clean:function e(){$("#coachmark_footer > .coachmark_footer_text").removeClass("hidden");if(TS.coachmark.context)TS.coachmark.$coachmark.removeClass(TS.coachmark.context.coachmark_el_id).removeClass("small_coachmark");TS.coachmark.is_small=false;TS.coachmark.context=null},reject:function e(t){var i=TS.coachmark.context;if(i&&i.reject)i.reject();TS.coachmark.end();if(TS.newxp)TS.clog.track("GROWTH_ONBOARDING",{action:"skip_tutorial_step",step:TS.newxp.getCurrentStepName()});if(t)t.stopPropagation()},resolve:function e(t){var i=TS.coachmark.context;if(i&&i.resolve)i.resolve();TS.coachmark.end();if(t)t.stopPropagation()},expand:function t(i){var n=TS.coachmark.$coachmark;var a=n.find("#coachmark_interior");if(TS.coachmark.is_small){TS.coachmark.is_small=false;a.css("opacity",0);n.removeClass("small_coachmark");e();$("#coachmark_bg").removeClass("hidden");window.setTimeout(function(){a.css("opacity",1)},100)}if(i)i.stopPropagation()},end:function e(){TS.model.coachmark_is_showing=false;TS.coachmark.is_showing=false;var t=TS.coachmark.$coachmark;t.css("opacity",0);TS.coachmark.$coachmark.find(".coachmark_div").remove();TS.coachmark.clean();t.addClass("hidden");$("#coachmark_bg").addClass("hidden");$("#client-ui").removeClass("disable_scrolling");TS.coachmark.$coachmark.remove();TS.coachmark.$coachmark=null;$(window.document).off("keydown",TS.coachmark.onKeyDown);$("html").off("mousedown",TS.coachmark.onMouseDown);$(window).off("resize.coachmark_placement");$("#coachmark_bg").off("click",TS.coachmark.end)},onKeyDown:function e(t){if(t.which==TS.utility.keymap.esc)TS.coachmark.reject(t);else if(t.which==TS.utility.keymap.enter)if(TS.coachmark.is_small)TS.coachmark.expand(t);else TS.coachmark.resolve(t)},onMouseDown:function e(t){if(TS.coachmark.is_small)TS.coachmark.expand(t);else if(!$(t.target).closest("#coachmark").length)if(TS.coachmark.reject_on_off_target_click)TS.coachmark.reject(t);else TS.coachmark.resolve(t)},onClickInvite:function e(t){if($(t.target).is("#coachmark_bg"))return TS.coachmark.resolve(t);if(TS.ui.admin_invites.canInvite())TS.ui.admin_invites.start();return TS.coachmark.resolve(t)}});var e=function e(){var t=TS.coachmark.context;if(t.placeSmall&&TS.coachmark.is_small)t.placeSmall();else if(t.place)t.place();else TS.coachmark.keepInBounds()};var t=function e(t,i){var n;if(i)n=$("."+t.inline_wrapper_el_class);else n=$("#client-ui");if(!n.length&&TS.calls)n=$("#calls_conference_content");n.append(TS.templates.coachmark({has_close_btn:t.has_close_btn}));TS.coachmark.$coachmark=$("#coachmark");var a=TS.coachmark.$coachmark;a.css("opacity",0);a.on("click",".coachmark_skip_link",TS.coachmark.reject);a.on("click",".coachmark_got_it",TS.coachmark.resolve);a.on("click",".coachmark_next_tip",TS.coachmark.resolve);a.on("click",".coachmark_ok",TS.coachmark.resolve);a.on("click",".coachmark_close_btn",TS.coachmark.reject)};var i=function e(t){if(!TS.coachmark.$coachmark)return;if(t.content)TS.coachmark.$coachmark.find("#coachmark_interior").prepend(t.content());if(t.buttonText)TS.coachmark.$coachmark.find(".coachmark_next_tip").text(t.buttonText());else TS.coachmark.$coachmark.find(".coachmark_next_tip").text(TS.i18n.t("Next Tip","coachmarks")());if(t.footer)TS.coachmark.$coachmark.find("#coachmark_footer").html(t.footer())}})()},3665:function(e,t){(function(){"use strict";TS.registerModule("client.highlights",{updated_sig:new signals.Signal,feedback_submitted_sig:new signals.Signal,last_request_id:null,sli_recaps_debug_group:null,onStart:function e(){if(!TS.client||!TS.boot_data.feature_sli_recaps)return;TS.client.login_sig.addOnce(function(){i=_.get(TS.shared.getActiveModelOb(),"id")});TS.channels.switched_sig.add(o);TS.groups.switched_sig.add(u);TS.mpims.switched_sig.add(u);TS.ims.switched_sig.add(u);TS.client.threads.switched_sig.add(u);TS.client.unread.switched_sig.add(u);TS.channels.history_fetched_sig.add(h);TS.client.unread.marked_group_as_read_sig.add(l);TS.experiment.loadUserAssignments().then(a)},msgIsHighlight:function t(i,n){return!!(e[i]&&e[i][n]&&e[i][n].show_recap)},msgIsHighlightUnfurl:function t(i,n){return!!(e[i]&&e[i][n]&&e[i][n].is_unfurl)},msgIsLeavingFeedback:function t(i,n){return!!(e[i]&&e[i][n]&&e[i][n].is_leaving_feedback)},canShowRecapDebug:function t(i,n){return"sli_debug_info"===TS.client.highlights.sli_recaps_debug_group&&e[i]&&e[i][n]},shouldRenderHighlightsUI:function e(t,i){return TS.boot_data.feature_sli_recaps_interface&&(TS.client.highlights.msgIsHighlight(t,i)||TS.client.highlights.msgIsLeavingFeedback(t,i))},isMsgBeingRequested:function e(i,n){return t[i]&&t[i][n]},getHighlight:function t(i,n){return e[i]&&e[i][n]},getHighlightsForChannel:function t(i){return e[i]},addHighlights:function t(i){var n={};e=_.reduce(i,function(e,t,i){e[i]=e[i]||{};_.each(t,function(t,a){if(!e[i][a]||!e[i][a].show_recap&&!e[i][a].is_leaving_feedback&&!e[i][a].left_feedback){e[i][a]=t;e[i][a].justification=TS.format.formatWithOptions(t.justification||"",void 0,{no_linking:true});n[i]=n[i]||{};n[i][a]=e[i][a]}else{e[i][a].request_id=t.request_id;e[i][a].cached_request_id=t.cached_request_id}});return e},e);if(!_.isEmpty(n))TS.client.highlights.updated_sig.dispatch(n)},setDefaultFeedbackForHighlight:function t(i,a,r,s){if(e[i]&&e[i][a]){e[i][a]=_.assign({},e[i][a],r);if("negative"===r.feedback){e[i][a].show_recap=false;e[i][a].is_leaving_feedback=true}var o={};o[i]={};o[i][a]=e[i][a];TS.client.highlights.feedback_submitted_sig.dispatch(o);var l;if("dismiss"===r.feedback)l="dismiss";else l="default_"+r.feedback;n(e[i][a],_.get(e[i][a],["feedback_options",l,"args"]),s)}},setNegativeFeedbackForHighlight:function t(i,a,r,s){if(e[i]&&e[i][a]){e[i][a].is_leaving_feedback=false;e[i][a].left_feedback=true;var o={};o[i]={};o[i][a]=e[i][a];TS.client.highlights.feedback_submitted_sig.dispatch(o);n(e[i][a],_.get(e[i][a],["feedback_options","negative",r,"args"]),s)}},getHighlightsForMessages:function e(t){if(!t.timestamps.length)return;var i=_.map(t.timestamps,function(e){return{ts:e,is_unread:true}});r(t.channel.id,t.timestamps);return TS.api.call("highlights.list",{channel:t.channel.id,messages:JSON.stringify(i),channel_open_ts:t.channel_open_ts||TS.interop.datetime.makeTsStamp(t.channel.last_made_active,{padder:"0"}),channel_open_last_read_ts:t.channel.last_read}).then(function(e){TS.client.highlights.last_request_id=e.request_id;TS.client.highlights.addHighlights(e.data.messages)}).catch(function(e){TS.error(e)}).finally(function(){s(t.channel.id,t.timestamps)})},test:function t(){var i={};Object.defineProperty(i,"_cache",{get:function t(){return e},set:function t(i){e=i}});return i}});var e={};var t={};var i=null;var n=function e(t,i,n){if(i){var a=_.assign({},i,{request_id:t.request_id||TS.client.highlights.last_request_id,source:n});if(t.cached_request_id)a.cached_request_id=t.cached_request_id;TS.api.call("highlights.feedback",a).catch(function(e){TS.error(e)})}};var a=function e(){TS.client.highlights.sli_recaps_debug_group=TS.experiment.getGroup("sli_recaps_debug")};var r=function e(i,n){t[i]=t[i]||{};_.each(n,function(e){t[i][e]=true})};var s=function e(i,n){_.each(n,function(e){if(t[i]&&t[i][e])delete t[i][e]});if(!_.isUndefined(t[i])&&_.isEmpty(t[i]))delete t[i]};var o=function e(){var t=TS.shared.getModelObById(i);if(t)d(t);i=_.get(TS.shared.getActiveModelOb(),"id");u()};var l=function e(t){d(t.model_ob)};var d=function t(i){if(e[i.id]){var n=parseFloat(i.last_read);_.each(e[i.id],function(e,t){if(parseFloat(t)<=n)c(i.id,t)});if(_.isEmpty(e[i.id]))delete e[i.id]}};var c=function t(i,n){if(e[i]&&e[i][n])delete e[i][n]};var u=function e(){f={}};var m={};var f={};var h=function e(t){if(!t||t.is_mpim||t.is_im||!t.unread_cnt||t.id!==TS.model.active_channel_id)return;if(m[t.id])return;m[t.id]=true;TS.membership.promiseToGetMembershipCounts(t).then(function(e){if(e.member_count<5)return;var i=TS.utility.msgs.getUnreadMsgTimestampsWithoutHighlights(t);_.each(i,function(e,t){if(f[t])delete i[t];else f[t]=true});if(_.isEmpty(i))return;TS.client.highlights.getHighlightsForMessages({channel:t,timestamps:_.keys(i)})}).finally(function(){delete m[t.id]})}})()},3666:function(e,t){(function(){"use strict";TS.registerModule("client.ui.highlights",{openNegativeFeedbackMenu:function i(n,a,r,s){var o=TS.client.highlights.getHighlight(a,r);if(!o)return;var l=$("<ul></ul>");_.each(o.feedback_options.negative,function(e){l.append('<li role="menuitem" data-js="highlights_feedback_item"><a href="#">'+TS.format.formatWithOptions(e.text,"",{no_linking:true})+"</a></li>")});TS.menu.startWithList(n,l,{close_on_click:true,menu_class:"sli_briefing__menu",position_by_click:true,onClick:function e(t){t.preventDefault();var i=$(t.target).parents("li[data-js=highlights_feedback_item]").index();TS.client.highlights.setNegativeFeedbackForHighlight(a,r,i,s)}});TS.menu.positionAt($(n.target),e,t)}});var e=0;var t=18})()},3670:function(e,t){(function(){"use strict";TS.registerModule("magic_login",{onStart:function e(){},make:function e(t,i){n(t,i)},execute:function e(t){a(t)}});var e;var t;var i;var n=function n(a,s){e=s.app_uri;t=s.browser_uri;i=s.fall_back_to_browser;if(e)a.attr("href",e);else e=a.attr("href");if(i&&t)r(a)};var a=function n(a){e=a.app_uri;t=a.browser_uri;i=a.fall_back_to_browser;d()};var r=function e(t){t.on("click",function(e){d(e)})};var s=function i(){window.navigator.msLaunchUri(e,function(){},function(){window.location.href=t})};var o=function i(n){if(n)n.preventDefault();var a=window.setTimeout(function(){window.location.href=t},1500);window.addEventListener("blur",function(){clearTimeout(a)});var r=document.createElement("iframe");r.className="hidden";r.src=e;document.body.appendChild(r)};var l=function i(n){if(n)n.preventDefault();var a=window.setTimeout(function(){window.location.href=t},1500);window.addEventListener("blur",function(){clearTimeout(a)});window.location.href=e};var d=function i(n){if(bowser&&(bowser.firefox||bowser.safari))o(n);else if(bowser&&(bowser.msie||bowser.msedge)&&"undefined"!==typeof window.navigator.msLaunchUri&&e.indexOf("://")>0)s(n);else if(bowser&&bowser.chromeBook)window.location.href=t;else l(n)}})()},3671:function(e,t){(function(){"use strict";TS.registerModule("menu.date",{onStart:function e(){},startWithExpirationPresets:function i(r){e=r.date_picker_args;t=r.onSelect;a();n(r)}});var e;var t;var i=5;var n=function e(t){var n=_.isUndefined(t.attach_to_target)?true:t.attach_to_target;TS.menu.start(t.event,false,{attach_to_target_at_full_width:n,onClose:t.onClose});if(n){var a=-1*TS.menu.$menu.outerHeight()-i;var r=t.$target.position().left-TS.menu.$menu.outerWidth()/2+t.$target.outerWidth()/2;TS.menu.$menu.css({top:Math.floor(a),left:Math.floor(r)})}else{var s=t.$target.outerWidth()/2*-1;var o=t.$target.outerHeight()+i;TS.menu.positionAt(t.$target,Math.floor(s),Math.floor(o))}};var a=function e(){TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu.addClass("expiration_date_picker");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_expiration_date_items());TS.menu.$menu_items.on("click.menu","li",o);TS.menu.$menu_footer.removeClass("hidden").html(TS.templates.menu_expiration_context())};var r=function t(){TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu.addClass("date_picker expiration_date_picker");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_footer.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_expiration_date_picker());TS.menu.$menu_items.on("click.menu","li#date_picker_back_item",function(e){a();e.stopPropagation()});var i={onChange:s,onHide:l};_.assign(i,e);var n=TS.menu.$menu.find("#date_picker_container");TS.ui.date_picker.startExpirationDatePicker(n,i)};var s=function e(i){if("string"===typeof i)i=parseInt(i,10);if(isNaN(i)){TS.warn("date_ts could not be parsed as a number.");return}if(t)t(i);TS.menu.end()};var o=function e(t){if(TS.menu.isRedundantClick(t))return;var i=$(this).attr("data-expiration-option");if(!i){TS.warn("Selected an invalid expiration date menu item.");return}var n;switch(i){case"none":s(0);break;case"7days":n=d(7);s(n);break;case"30days":n=d(30);s(n);break;case"60days":n=d(60);s(n);break;case"custom":r()}t.stopPropagation()};var l=function e(){var t=$("#date_picker_container");if(t.pickmeup)_.defer(function(){t.pickmeup("destroy")})};var d=function e(t){if(!_.isNumber(t)){TS.error("num_days must be a number.");return}var i=new Date;i.setHours(23,59,59,0);i.setDate(i.getDate()+t);var n=i.getTime()/1e3;return n}})()},3679:function(e,t){(function(){"use strict";TS.registerModule("ui.admin_invites",{invites_sent_sig:new signals.Signal,emails_parsed_sig:new signals.Signal,onStart:function e(){TS.ui.admin_invites.invites_sent_sig.add(se,TS.ui.admin_invites);TS.ui.admin_invites.emails_parsed_sig.add(de,TS.ui.admin_invites);TS.team.team_email_domain_changed_sig.add(A,TS.ui.admin_invites);TS.prefs.team_auth_mode_changed_sig.add(W,TS.ui.admin_invites);TS.prefs.team_sso_auth_restrictions_changed_sig.add(W,TS.ui.admin_invites);TS.prefs.team_invites_only_admins_changed_sig.add(TS.ui.admin_invites.maybeShowInviteLink,TS.ui.admin_invites);if(TS.web)TS.web.login_sig.add(TS.ui.admin_invites.onLogin,TS.ui.admin_invites);if(TS.client)TS.client.login_sig.add(TS.ui.admin_invites.onLogin,TS.ui.admin_invites);r=TS.storage.fetchInvitesState();$("body").on("click",'[data-action="admin_invites_modal"]',function(){if(TS.isPartiallyBooted())return;var e={};if($(this).data("account-type"))e.account_type=$(this).data("account-type");w(e)})},onLogin:function e(){A()},start:function e(t){if(TS.isPartiallyBooted())return;if(he())w(t)},switchToPicker:function e(){if(he())J()},maybeShowInviteLink:function e(){if(!TS.client)return;var t=false;var i=false;if(he()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26)t=true;if(he()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length>=2)i=true;$("#channel_list_invites_link").toggleClass("hidden",!t).toggleClass("dim",i)},populateInvites:function t(i){if(!he())return;if(!i)return;var n=r.reduce(function(e,t){e[t.email]=true;return e},{});i.forEach(function(e){if(!n[e.email]){n[e.email]=true;r.push(e)}});TS.storage.storeInvitesState(r);if(r.length&&TS.ui.fs_modal.is_showing){e.find(".admin_invite_row").remove();r.forEach(function(e){O(e)})}},canInvite:function e(){return he()},test:function e(){var t={_error_map:b,_getError:pe};Object.defineProperty(t,"_getError",{get:function e(){return pe},set:function e(t){pe=t}});Object.defineProperty(t,"_error_map",{get:function e(){return b},set:function e(t){b=t}});return t}});var e;var t=0;var i=0;var n=[];var a=[];var r=[];var s=TS.i18n.t("name@example.com","invite")();var o=s;var l="";var d="";var c;var u;var m="#admin_invites_show_date_picker";var f;var h;var g;var p;var S="INVITEMODAL";var T=S+"_ACTION";var v=3;var b={url_in_message:TS.i18n.t("Sorry, but URLs are not allowed in the custom message. Please remove it and try again!","invite")(),invalid_email:TS.i18n.t("That doesn’t look like a valid email address!","invite")(),already_in_team:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("This person is already in your workspace.","invite")():TS.i18n.t("This person is already on your team.","invite")(),user_disabled:function e(){var t=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('This person is already in your workspace, but their account is deactivated. You can <a href="{url}#disabled">manage</a> their account.',"invite")({url:TS.model.team_url}):TS.i18n.t('This person is already on your team, but their account is deactivated. You can <a href="{url}#disabled">manage</a> their account.',"invite")({url:TS.model.team_url});return t},already_invited:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("This person has already been invited to your workspace.","invite")():TS.i18n.t("This person has already been invited to your team.","invite")(),sent_recently:TS.i18n.t("This person was recently invited. No need to invite them again just yet.","invite")(),invite_failed:TS.i18n.t("Something went wrong with this invite :(","invite")(),ura_limit_reached:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("You’ve reached your workspace limit for Single-channel Guests. You must invite more paid members first.","invite")():TS.i18n.t("You’ve reached your team limit for Single-channel Guests. You must invite more paid team members first.","invite")(),user_limit_reached:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("You’ve reached the maximum number of users for this workspace.","invite")():TS.i18n.t("You’ve reached the maximum number of users for this team.","invite")(),not_allowed:TS.i18n.t("You can’t invite this type of account based on your current SSO settings.","invite")(),custom_message_not_allowed:TS.i18n.t("Sorry, you can’t add a custom message to this invite. Please remove it and try again!","invite")(),domain_mismatch:TS.i18n.t("Your SSO settings prevent you from inviting people from this email domain.","invite")(),invite_limit_reached:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Your workspace has exceeded the limit on invitations. After more people have accepted the ones your workspace has sent, you can send more. Revoking invitations will not lift the limit. Our Help Center has <a href='https://get.slack.help/hc/{locale}/articles/201330256#invitation_limits'>more details on invitation limits</a>.","invite")({locale:TS.i18n.zdLocale()}):TS.i18n.t("Your team has exceeded the limit on invitations. After more people have accepted the ones your team has sent, you can send more. Revoking invitations will not lift the limit. Our Help Center has <a href='https://get.slack.help/hc/{locale}/articles/201330256#invitation_limits'>more details on invitation limits</a>.","invite")({locale:TS.i18n.zdLocale()}),too_long:TS.i18n.t("This person’s name exceeds the 35-character limit.","invite")(),org_user_is_disabled:TS.i18n.t("This person has a deactivated account for your organization.","invite")(),org_user_is_disabled_but_present:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("This person is already in your workspace, but they have been deactivated by your organization. Contact an organization administrator to re-enable their account","invite")():TS.i18n.t("This person is already on your team, but they have been deactivated by your organization. Contact an organization administrator to re-enable their account","invite")(),mismatch_with_pending_team_invite:function e(t){var i;switch(t.user_type){case"ultra_restricted":i=TS.i18n.t("Single-Channel Guest","invite")();break;case"restricted":i=TS.i18n.t("Multi-Channel Guest","invite")();break;default:i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("full Member","invite")():TS.i18n.t("full Team Member","invite")()}return TS.i18n.t("This person can’t be invited, because they have already been invited as a {account_type} to your organization","invite")({account_type:i})},user_type_mismatch:function e(t){var i;var n;switch(t.issue){case"org_user_is_restricted":i=TS.i18n.t("Multi-Channel Guest","invite")();break;case"org_user_is_ultra_restricted":i=TS.i18n.t("Single-Channel Guest","invite")();break;case"org_user_not_restricted":case"org_user_not_ultra_restricted":i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("full Member","invite")():TS.i18n.t("full Team Member","invite")()}if(_.isUndefined(i))n=TS.i18n.t("This person already has an account for your organization","invite")();else n=TS.i18n.t("This person already has a {account_type} account for your organization, so you can only invite them in that role.","invite")({account_type:i});return n}};var w=function e(t){var i;u=null;if(ge()){if(t&&t.account_type)i=t.account_type}else i="full";if(t&&t.initial_channel_id)c=t.initial_channel_id;var n=TS.templates.admin_invite_modal({can_add_ura:TS.model.can_add_ura,team_name:TS.model.team.name,team_in_org:TS.model.team.enterprise_id,hide_full_member_option:TS.utility.invites.hideFullMemberInviteOption(),team_signup_url:"https://"+TS.model.team.domain+".slack.com/signup",invites_limit:""===TS.model.team.plan&&TS.model.team.prefs.invites_limit,show_custom_message:TS.model.team.plan,is_paid_team:TS.model.team.plan,is_our_app:TS.model.is_our_app});var a={body_template_html:n,onShow:y,onCancel:k,clog_name:"INVITEMODAL"};if(TS.client)TS.ui.a11y.saveCurrentFocus();TS.ui.fs_modal.start(a);if(i)setTimeout(function(){X(i)},0)};var y=function t(){e=$("#admin_invites_container");var i=e.find(".admin_invites_custom_message_container");var n=e.find("#admin_invites_alert");var a=e.find('button[data-action="api_send_invites"]');if(!TS.model.team.plan&&TS.model.user.is_admin){n.removeClass("hidden");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"admin_invites",action:"impression",ui_element:"invite_modal_guest_alert"}}})}else n.addClass("hidden");e.find("#admin_invites_switcher").on("click",'[data-action="switch_type"]',function(e){var t=$(e.target);if(t.is("a"))return;if(t.closest(".admin_invites_account_type_option").hasClass("disabled"))return;X($(this).data("account-type"))});e.find('[data-action="admin_invites_add_row"]').on("click",O);e.find('a[data-action="admin_invites_switch_view"]').on("click",function(){Z($(this).data("view"))});e.find("#invite_rows").on("keydown",function(e){if(e.which===TS.utility.keymap.enter)a.trigger("click")});a.on("click",function(e){e.preventDefault();ne();if(!TS.model.team.plan&&TS.model.user.is_admin)n.css("visibility","hidden")});e.find('button[data-action="api_parse_emails"]').on("click",function(e){e.preventDefault();oe();$(this).find(".ladda-label").text(TS.i18n.t("Processing email addresses ...","invite")())});I();C();e.find('a[data-action="admin_invites_show_custom_message"]').on("click",function(){U()});e.find('[data-action="admin_invites_hide_custom_message"]').on("click",function(){Q()}).hover(function(){i.addClass("delete_highlight")},function(){i.removeClass("delete_highlight")});e.find("#admin_invite_custom_message").on("input",L);e.find("#bulk_emails").css("overflow","hidden").autogrow();r=TS.storage.fetchInvitesState();if(r.length)TS.ui.admin_invites.populateInvites(r);else O();var s=e.find(".admin_invite_row").length;if(s<v){var o=v-s;_.times(o,O)}};var k=function e(){t=0;i=0;r=a.length?[]:ie();n=[];a=[];j();if(p)p();TS.storage.storeInvitesState(r);if(TS.client)TS.ui.a11y.restorePreviousFocus()};var A=function e(){o=s};var C=function e(){if(!TS.model.team.plan)return M(false);TS.api.callImmediately("users.admin.canAddUltraRestricted").then(function(e){M(e.data.ok)},function(){M(false)})};var M=function e(t){TS.model.can_add_ura=t;var i=$('.admin_invites_account_type_option[data-account-type="ultra_restricted"]');i.toggleClass("disabled",!TS.model.can_add_ura);if(!TS.model.can_add_ura){var n=$(".account_type_disabled_hover",i);n.removeClass("hidden")}};var I=function e(){h=document.getElementById("btn_connect_contacts");if(!h)return;h.addEventListener("click",x);g=TS.model.user.id+Date.now();TS.google_auth.getAuthLink(g).then(function(){TS.utility.disableElement(h,false)})};var x=function e(){TS.google_auth.getAuthLink(g).then(function(e){var t="menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes,width=600,height=500";var i=window.open(e,"auth_window",t);E(i)})};var E=function e(t){p=TS.google_auth.pollForAuthStatus(g,B,t).cancel};var B=function t(i){p=null;if(i){var n=TS.i18n.t("Google contacts connected","invite")();e.find(".btn_connect_contacts_text").text(n);h.removeEventListener("click",x);TS.clog.track(T,{action:"google_auth_success",trigger:"user_allowed_access"});D()}};var D=function e(){var t={page:1,count:1e3};TS.google_auth.getContactList(g,t).then(function(e){var t=$("input.email_field").filter(function(){return!this.value});if(0===t.length)O();F(e)})};var F=function e(t){if(!t)return;f=f||t.items;$("input.email_field").lazyFilterSelect({approx_item_height:50,data:f,single:true,placeholder_text:TS.i18n.t("name@example.com","invite")(),onReady:function e(){P(this)},filter:function e(t,i){i=i.toLowerCase();if(t.full_name)var n=t.full_name.toLowerCase();if(t.email)var a=t.email.toLowerCase();return n&&-1!==n.indexOf(i)||a&&-1!==a.indexOf(i)},noResultsTemplate:function e(t){var i=TS.i18n.t("None of your Google contacts match <strong>{query}</strong>","invite")({query:_.escape(t)});return i},onItemAdded:function e(t){P(this,t);TS.clog.track(T,{action:"add_google_email",trigger:"select_google_contact_from_dropdown"})},onInputFocus:function e(){$(".ts_tip_tip").remove();$(".lazy_filter_select").removeClass("ts_tip ts_tip_top ts_tip_float ts_tip_multiline ts_tip_delay_1000")},onInputBlur:function e(){P(this)},template:function e(t){var i=TS.templates.admin_invite_filter_select_contact({contact:t});return new Handlebars.SafeString(i)}}).addClass("hidden");if(void 0!==t.items){var i=TS.i18n.t("Type here to search your Google contacts","invite")();var n='<span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+i+"</span></span>";var a=$("input.email_field").filter(function(){return!this.value}).first();a.lazyFilterSelect("container").addClass("ts_tip ts_tip_top ts_tip_float ts_tip_multiline ts_tip_delay_1000").append(n)}};var P=function e(t,i){var n=t.$container[0];var a=$(n).parents(".admin_invite_row");if(i){if(TS.boot_data.feature_name_tagging_client)$(a).find("input[name*=real_name]").val(i.full_name);else{$(a).find("input[name*=first_name]").val(i.given_name);$(a).find("input[name*=last_name]").val(i.family_name)}$(a).find("input[name*=email_address]").val(i.email)}else{var r=$(a).find("input.lfs_input").val();var s=$(a).find("input[name*=email_address]").val();if(r){$(a).find("input.email_field").lazyFilterSelect("clearValue");$(a).find("input[name*=email_address]").val(r)}else if(s)$(a).find("input.lfs_input").val(s)}};var O=function i(n){var a=true;if(0===e.find(".admin_invite_row").length)a=false;else e.find(".admin_invite_row").first().find(".delete_row").removeClass("hidden");e.find("#invite_rows").append(TS.templates.admin_invite_row({index:t,show_delete_btn:a,placeholder_email_address:o}));var r=e.find("#invite_"+t);r.find('[data-action="admin_invites_delete_row"]').on("click",function(){N(r)}).hover(function(){r.addClass("delete_highlight")},function(){r.removeClass("delete_highlight")});r.find('[name="email_address"]').focus();if(n){r.find('[name="email_address"]').val(n.email);r.find(".lfs_input_container input.lfs_input").val(n.email);if(TS.boot_data.feature_name_tagging_client)r.find('[name="real_name"]').val(n.real_name);else{r.find('[name="first_name"]').val(n.first_name);r.find('[name="last_name"]').val(n.last_name)}}if(TS.google_auth.isAuthed(g)&&f)F(f);t+=1};var R=function t(i,n){e.find("#invite_notice").toggleClass("alert_warning","alert_warning"===i).toggleClass("alert_info","alert_info"===i).toggleClass("alert_error","alert_error"===i).html(n).slideDown(100)};var U=function t(){e.find(".admin_invites_hide_custom_message").addClass("hidden");e.find(".admin_invites_show_custom_message").removeClass("hidden");L()};var Q=function t(){e.find(".admin_invites_hide_custom_message").removeClass("hidden");e.find(".admin_invites_show_custom_message").addClass("hidden");L()};var L=function t(){var i=e.find("#admin_invite_custom_message");var n=i.val().trim();var a=e.find(".admin_invites_show_custom_message");var r=!a.hasClass("hidden")&&!!i.data("validation")&&i.data("validation").includes("hasnourl")&&!!TS.utility.findUrls(n).length;H(r)};var H=function t(i){e.find("#admin_invites_submit_btn").toggleClass("disabled",i)};var N=function t(i){if(!i||!i.length)return;i.slideToggle(100,function(){i.remove();var t=$(".admin_invite_row").length;if(0===t)O();else if(1===t)e.find(".admin_invite_row").first().find(".delete_row").addClass("hidden")})};var G=function t(){var i=$("#account_type").val();var n;if("full"===i)n=TS.i18n.t("Send Invitations","invite")();else n=TS.i18n.t("Invite Guests","invite")();e.find('button[data-action="api_send_invites"]').find(".ladda-label").text(n)};var j=function e(){c=void 0};var W=function t(){var i=e.find("#account_type").val();var n=false;var a="google"===TS.model.team.prefs.auth_mode||"saml"===TS.model.team.prefs.auth_mode;var r=false;var s=TS.boot_data.page_needs_enterprise;var o="";if(s&&"full"===i||a&&0===TS.model.team.prefs.sso_auth_restrictions){r=true;var l=TS.utility.enterprise.getProviderLabel(TS.model.enterprise,_.get(TS.model,"enterprise.sso_provider.label","single sign-on"));o=TS.i18n.t("Only people with {account_type} accounts will be able to accept invitations.","invite")({account_type:l})}if("google"===TS.model.team.prefs.auth_mode){if("full"===i&&(0===TS.model.team.prefs.sso_auth_restrictions||1===TS.model.team.prefs.sso_auth_restrictions))n=true;else if(("restricted"===i||"ultra_restricted"===i)&&0===TS.model.team.prefs.sso_auth_restrictions)n=true}else if("saml"===TS.model.team.prefs.auth_mode)if(0===TS.model.team.prefs.sso_auth_restrictions||1===TS.model.team.prefs.sso_auth_restrictions)if("full"===i)if(!s){var d=TS.templates.admin_invite_switcher({can_add_ura:TS.model.can_add_ura,hide_full_member_option:TS.utility.invites.hideFullMemberInviteOption(),team_signup_url:"https://"+TS.model.team.domain+".slack.com/signup",team_in_org:TS.model.team.enterprise_id});$("#admin_invites_switcher").html(d);J()}$("#google_auth_email_domain_notice").toggleClass("hidden",!n);$("#sso_signup_notice").html(o).toggleClass("hidden",!r)};var K=function t(i){var n;e.find('input[name="email_address"]').each(function(){if($(this).val()==i)n=$(this).closest(".admin_invite_row")});return n};var z=function e(t,i){if(!_.isObject(i))TS.error("_rowError did not receive an error object: ",i);var n=pe(i);if(t){t.find("label.email").addClass("error").end().find(".error_msg").removeClass("hidden").html(n);if("too_long"===i.error)t.find("label").addClass("error");t.find("input").on("keyup.admin_invite_error_fixed",function(){V(t)})}};var V=function e(t){if(t){t.find("label").removeClass("error").end().find(".error_msg").addClass("hidden");t.find("input").off(".admin_invite_error_fixed")}};var Y=function t(){setTimeout(function(){Ladda.stopAll();e.find(".admin_invite_row").remove();n=[];a=[];u=null;G();_.times(v,O)},0)};var q=function t(){setTimeout(function(){Ladda.stopAll();e.find('button[data-action="api_parse_emails"]').find(".ladda-label").text(TS.i18n.t("Add Invitees","invite")());e.find("#bulk_emails").prop("disabled",false)},0)};var J=function t(){e.find("#admin_invites_header").find(".admin_invites_header_type").removeClass("normal").text("people").end().find(".admin_invites_header_team_name").removeClass("hidden");e.find("#admin_invites_switcher").removeClass("hidden");e.find("#admin_invites_workflow").addClass("hidden");TS.ui.fs_modal.hideBackButton()};var Z=function t(i){if("individual"===i){e.find("#individual_invites").removeClass("hidden");e.find("#bulk_invites, #bulk_notice").addClass("hidden");e.find("#bulk_emails").val("");e.find(".email_field").first().focus();e.find(".invite_modal_options_container").removeClass("hidden");q()}else if("bulk"===i){e.find("#bulk_invites").removeClass("hidden");e.find("#individual_invites").addClass("hidden");e.find(".invite_modal_options_container").addClass("hidden");var n=e.find('button[data-action="api_parse_emails"]');if(!n.hasClass("ladda")){Ladda.bind('button[data-action="api_parse_emails"]');n.addClass("ladda")}n.find(".ladda-label").text(TS.i18n.t("Add Invitees","invite")());var a=ie();if(a){var r="";$.each(a,function(e,t){if(TS.boot_data.feature_name_tagging_client){if(t.real_name)r+=t.real_name+" "}else{if(t.first_name)r+=t.first_name+" ";if(t.last_name)r+=t.last_name+" "}r+="<"+t.email+">, "});e.find("#bulk_emails").val(r).autogrow()}e.find("#bulk_emails").focus()}};var X=function t(i){var n=[];var a=TS.channels.getUnarchivedChannelsForUser();if(_.isArray(TS.model.team.prefs.default_channels))a.forEach(function(e){if(-1!==TS.model.team.prefs.default_channels.indexOf(e.id)){e.is_default=true;n.push(e)}});var r=TS.channels.getGeneralChannel();var s="";if(r){s=r.name;if(!n.length)n.push(r)}var o={invite_type:i,channels:a,default_channels:n,general_name:s,groups:TS.groups.getUnarchivedGroups(),email_domains:TS.model.team.email_domain.split(","),is_admin:TS.model.user.is_admin,initial_channel_id:c};var l="enterprise"!==TS.model.team.plan;var d=TS.templates.admin_invite_channel_picker(o);var u=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Members","invite")():TS.i18n.t("Team Members","invite")();if("restricted"===i)u=TS.i18n.t("Multi-Channel Guests","invite")();else if("ultra_restricted"===i)u=TS.i18n.t("Single-Channel Guests","invite")();e.find("#admin_invites_header").find(".admin_invites_header_type").addClass("normal").text(u).end().find(".admin_invites_header_team_name").addClass("hidden");e.find("#admin_invites_channel_picker_container").html(d);e.find("#account_type").val(i);e.find("#admin_invites_switcher, #admin_invites_workflow").toggleClass("hidden");e.find("#admin_invites_billing_notice").toggleClass("hidden",!(l&&"ultra_restricted"!==i));e.find("#admin_guide_to_billing_at_slack").toggleClass("hidden",!(l&&"ultra_restricted"!==i));e.find("#ura_warning").toggleClass("hidden","restricted"!==i&&"ultra_restricted"!==i);e.find("#invite_notice").hide();e.find(".admin_invites_guest_expiration_date_container").toggleClass("hidden","full"===i);e.find(m).on("click",ee);var f="";if("restricted"===i)f=TS.i18n.t("These guests will only have access to messages and files in specified channels.","invite")();else if("ultra_restricted"===i)f=TS.i18n.t("These guests will only have access to messages and files in a single channel.","invite")();e.find("#admin_invites_subheader").text(f).toggleClass("hidden","full"===i);e.find("#ultra_restricted_channel_picker").on("change",function(){G();j()});e.find(".email_field").first().focus();var h=e.find('button[data-action="api_send_invites"]');if(!h.hasClass("ladda")){Ladda.bind('button[data-action="api_send_invites"]');h.addClass("ladda")}G();W();e.find("#defaultchannelsmulti, #ultra_restricted_channel_picker").lazyFilterSelect({onItemRemoved:function e(t){if(t.value==c)j()}}).addClass("hidden");if(ge()){TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker);TS.ui.fs_modal.showBackButton()}};var ee=function e(t){var i={event:t,$target:$(m),onSelect:te,date_picker_args:{}};if(u)i.date_picker_args.selected_expiration_ts=u;TS.menu.date.startWithExpirationPresets(i)};var te=function e(t){if(!_.isNumber(t)||t===u)return;var i;var n;if(0===t){u=null;i=TS.i18n.t("By default, guest accounts stay active indefinitely.","invite")();n=TS.i18n.t("Set a time limit","invite")()}else{u=t;i=TS.i18n.t("These accounts will be deactivated on <strong>{date} at {time}</strong>.","invite")({date:TS.interop.datetime.formatDate(t,"{date}"),time:TS.interop.datetime.formatDate(t,"{time}")});n=TS.i18n.t("Change","invite")()}$("#admin_invites_guest_expiration_copy").html(i);$(m).text(n)};var ie=function t(){var i=[];var n;e.find(".admin_invite_row").each(function(){n=$.trim($(this).find('[name="email_address"]').val());if(TS.boot_data.feature_name_tagging_client)var e=$.trim($(this).find('[name="real_name"]').val());else{var t=$.trim($(this).find('[name="first_name"]').val());var a=$.trim($(this).find('[name="last_name"]').val())}if(n){var r={};r.email=n;if(TS.boot_data.feature_name_tagging_client&&e)r.real_name=e;if(t)r.first_name=t;if(a)r.last_name=a;i.push(r)}else if($(".admin_invite_row").length>1)N($(this))});r=i;TS.storage.storeInvitesState(r);return i};var ne=function t(){var n=false;e.find(".admin_invite_row").each(function(){var e=$.trim($(this).find('[name="email_address"]').val());if(e)if(!TS.utility.email_regex.test(e)){z($(this),{error:"invalid_email"});n=true}else V($(this));else if($(".admin_invite_row").length>1)N($(this))});if(n){setTimeout(Ladda.stopAll,0);return}var a=ie();if(!a.length){var r='<i class="ts_icon ts_icon_info_circle"></i> '+TS.i18n.t("Add at least one email address before sending invitations.","invite")();R("alert_info",r);setTimeout(Ladda.stopAll,0)}else if(a){var s=e.find("#account_type").val();var o=e.find(".admin_invites_show_custom_message");var l=e.find("#admin_invite_custom_message");var c;var _=TS.google_auth.isAuthed(g)?"contact":"manual";if("full"===s||"restricted"===s){var m=e.find("#defaultchannelsmulti").val();if(m)c=m.join(",")}else if("ultra_restricted"===s)c=e.find("#ultra_restricted_channel_picker").val();if(!o.hasClass("hidden"))d=l.val();else d="";i=a.length;$.each(a,function(e,t){var i={email:t.email,source:"invite_modal",mode:_};if(c)i.channels=c;if(d)i.extra_message=d;if(t.real_name)i.real_name=t.real_name;if(t.first_name)i.first_name=t.first_name;if(t.last_name)i.last_name=t.last_name;if(("restricted"===s||"ultra_restricted"===s)&&u)i.expiration_ts=u;if("restricted"===s)i.restricted=1;else if("ultra_restricted"===s)i.ultra_restricted=1;TS.api.call("users.admin.invite",i,ae)})}};var ae=function t(i,r,s){if(i){n.push({email:s.email,real_name:s.real_name,first_name:s.first_name,last_name:s.last_name});var o=K(s.email);N(o)}else{var l;if("requires_channel"===r.error){setTimeout(Ladda.stopAll,0);e.find("#ra_channel_picker_header").highlightText();var d=TS.i18n.t("Pick at least one channel before inviting Multi-Channel Guests.","invite")();l='<i class="ts_icon ts_icon_info_circle"></i> '+d;R("alert_warning",l);return}else if("requires_one_channel"===r.error){setTimeout(Ladda.stopAll,0);e.find("#ura_channel_picker_header").highlightText();var c=TS.i18n.t("Pick a channel before inviting Single-Channel Guests.","invite")();l='<i class="ts_icon ts_icon_info_circle"></i> '+c;R("alert_warning",l);return}var u=r.error;if(TS.boot_data.feature_name_tagging_client){if("invalid_name_specials"===u)u="name_invalid_name_specials";if("invalid_name_maxlength"===u)u="name_invalid_name_maxlength";if("invalid_name_required"===u)u="name_invalid_name_required"}if(TS.boot_data.page_needs_enterprise){var m=null!==TS.members.getMemberByEmail(s.email);if(m&&"org_user_is_disabled"===u)u="org_user_is_disabled_but_present"}a.push({email:s.email,error:u,error_msg:pe(_.extend({},r,{error:u}))})}re()};var re=function e(){i-=1;if(0===i){r=[];TS.storage.storeInvitesState(r);var t=function e(){setTimeout(Ladda.stopAll,0);TS.ui.admin_invites.invites_sent_sig.dispatch()};l=_e(n);if(l)TS.api.call("team.checkEmailDomains",{email_domains:l}).then(function(e){if(e.data.ok)l=e.data.email_domains;else l=""},function(){l=""}).finally(t);else t()}};var se=function t(){var i=$("#account_type").val();var r;var s;if("full"===i){var o=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("{invites_length,plural,=1{{invites_length} Member}other{{invites_length} Members}}","invite")({invites_length:n.length}):TS.i18n.t("{invites_length,plural,=1{{invites_length} Team Member}other{{invites_length} Team Members}}","invite")({invites_length:n.length});r="<strong>"+o+"</strong>"}else if("restricted"===i){var c=TS.i18n.t("{invites_length,plural,=1{{invites_length} Multi-Channel Guest}other{{invites_length} Multi-Channel Guests}}","invite")({invites_length:n.length});r="<strong>"+c+"</strong>"}else if("ultra_restricted"===i){var _=TS.i18n.t("{invites_length,plural,=1{{invites_length} Single-Channel Guest}other{{invites_length} Single-Channel Guests}}","invite")({invites_length:n.length});r="<strong>"+_+"</strong>"}if(u&&("restricted"===i||"ultra_restricted"===i))s=TS.i18n.t("{invites_length,plural,=1{This account}other{These accounts}} will be deactivated on {date} at {time}.","invite")({invites_length:n.length,date:TS.interop.datetime.formatDate(u,"{date}"),time:TS.interop.datetime.formatDate(u,"{time}")});var m={success_invites_html:r,success_invites:n,error_invites:a,team_name:TS.model.team.name,domains:l,paid_team:""!==TS.model.team.plan,is_admin:TS.model.user.is_admin,expiration_msg:s};if(TS.model.team.plan)m.custom_message=d;var f=TS.templates.admin_invite_summary(m);e.find("#invite_notice").slideUp(100);e.find("#admin_invites_workflow, #admin_invites_header, #admin_invites_subheader").addClass("hidden");e.find("#admin_invites_success").html(f).removeClass("hidden");function h(){Y();$("#admin_invites_workflow, #admin_invites_success").toggleClass("hidden");if(!TS.model.team.plan&&TS.model.user.is_admin)$("#admin_invites_alert").css("visibility","visible");$("#admin_invites_header, #admin_invites_subheader").removeClass("hidden");TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker)}e.find('button[data-action="admin_invites_reset"]').on("click",h);TS.ui.fs_modal.bindBackButton(h);e.find('button[data-action="admin_invites_try_again"]').on("click",function(){$.each(a,function(e,t){var i=K(t.email);z(i,t)});$("#admin_invites_workflow, #admin_invites_success").toggleClass("hidden");$("#admin_invites_header, #admin_invites_subheader").removeClass("hidden");TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker);n=[];a=[]});if(ce()){var g=e.find('button[data-action="add_signup_domains"]').on("click",me);e.on("keyup","#invite_signup_domains",TS.ui.resetButtonSpinner.bind(Object.create(null),g.get(0)))}};var oe=function t(){var i=$.trim($("#bulk_emails").val().replace(/[\u200B-\u200D\uFEFF]/g,""));e.find("#bulk_emails").prop("disabled",true);TS.api.call("users.admin.parseEmails",{emails:i},le)};var le=function t(i,n){if(!i){TS.error("failed onEmailsParsed");var a=TS.i18n.t("Oops! There was an error processing those emails. Please try again.","invite")();e.find("#bulk_notice").html('<i class="ts_icon ts_icon_warning"></i> '+a).removeClass("hidden");q();return}if(0===n.emails.length){var r=TS.i18n.t("We couldn’t find any email addresses in that text. Please try again.","invite")();e.find("#bulk_notice").html('<i class="ts_icon ts_icon_warning"></i> '+r).removeClass("hidden");q();return}TS.ui.admin_invites.emails_parsed_sig.dispatch(n.emails)};var de=function t(i){e.find(".admin_invite_row").remove();Z("individual");var n;if(1==i.length){var a=TS.i18n.t("We found 1 email address to invite. We’ve done our best to guess a name. See if it looks right, then press Invite.","invite")();n='<i class="ts_icon ts_icon_check_circle_o_large"></i> '+a}else{var s=TS.i18n.t("We found {emails_length} email addresses to invite. We’ve done our best to guess a name for each one. See if everything looks right, then press Invite.","invite")({emails_length:i.length});n='<i class="ts_icon ts_icon_check_circle_o_large"></i> '+s}R("alert_info",n);e.find(".admin_invite_row").each(function(){var e=$.trim($(this).find('[name="email_address"]').val());if(!e)N($(this))});$.each(i,function(e,t){O(t)});r=i;TS.storage.storeInvitesState(r)};var ce=function e(){var t=$("#account_type").val();return"full"===t&&TS.model.user.is_owner&&"normal"===TS.model.team.prefs.auth_mode};var _e=function e(t){if(!ce())return"";var i=t.map(function(e){return e.email.split("@")[1]});if(TS.model.team.email_domain){var n=TS.model.team.email_domain.split(",").reduce(function(e,t){e[t]=true;return e},{});i=_.uniq(i.filter(function(e){return!n[e]}))}return i.join(", ")};var ue=function e(t){if(!t)return t;var i=t.split(",").reduce(function(e,t){e[t]=true;return e},{});return Object.keys(i).join(",")};var me=function t(){TS.ui.startButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0));var i=e.find("#invite_signup_domains").val();if(TS.model.team.email_domain)i=[TS.model.team.email_domain,i].join(",");i=ue(i);var n={prefs:JSON.stringify({signup_mode:"email",signup_domains:i})};TS.api.call("team.prefs.set",n).then(function(t){TS.ui.stopButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0),true);TS.model.team.email_domain=t.data.prefs.signup_domains},function(t){TS.ui.stopButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0),false);var i=TS.i18n.t("Sorry! Something went wrong. Please try again.","invite")();if("signup_domains_missing"===t.data.error)i=TS.i18n.t("Please enter a domain","invite")();else if("bad_domain"===t.data.error)i=TS.i18n.t("Sorry! You can’t use {response_data_domain}.","invite")({response_data_domain:t.data.domain});else if("invalid_domain"===t.data.error)i=TS.i18n.t("Hmm, this doesn’t look like a domain! Check for typos?","invite")();else if("too_many_domains"===t.data.error)i=TS.i18n.t("Sorry! You’ve entered too many domains.","invite")();$("#invite_signup_domains").focus().tooltip({title:i,trigger:"manual"}).tooltip("show").on("blur",function(){$(this).tooltip("destroy")})})};var fe=function e(){if(!TS.model.team||!TS.model.team.prefs||!TS.model.user)return false;return!TS.model.team.prefs.invites_only_admins&&!TS.model.user.is_restricted};var he=function e(){if(!TS.model.user)return false;return TS.model.user.is_admin||fe()};var ge=function e(){if(TS.boot_data.feature_guest_invitation_restrictions&&TS.boot_data.page_needs_enterprise)return TS.permissions.members.canOrgUserManageGuests();return TS.model.user.is_admin&&""!==TS.model.team.plan};var pe=function e(t){var i="";if(!t||!t.error)return"";if(TS.boot_data.feature_name_tagging_client&&!b[t.error])return TS.ui.validation.getErrorMessage(t.error,{maxlength:80});if(!b[t.error])return"";i=b[t.error];return _.isFunction(i)?i(t):i}})()},3680:function(e,t){(function(){"use strict";TS.registerModule("ui.date_picker",{onStart:function e(){},start:function e(t,i){t.pickmeup(i)},startJumpToDatePicker:function e(t){var i=$("#channel_actions_toggle").attr("data-oldest-ts");if(i){var a=TS.interop.datetime.toDateObject(i);n(t,a)}else{var r=TS.shared.getActiveModelOb();var s=TS.shared.getHistoryApiMethodForModelOb(r);var o={channel:r.id,oldest:283996800,count:1,inclusive:1,include_pin_count:true};if(TS.useReactMessages())o.ignore_replies=true;TS.api.callImmediately(s,o).then(function(e){var i;if(e.data.messages.length<1)i=TS.shared.getActiveModelOb().created;i=_(e.data.messages).map("ts").min();var a=TS.interop.datetime.toDateObject(i);n(t,a);return true}).catch(function(){n(t);return TS.warn("couldn’t find messages in this channel :"+r.id)})}},startArchiveDatePicker:function e(t){var i=TS.shared.getActiveModelOb();var n=TS.interop.datetime.toDateObject(i.created);var a=Date.now();var r=a;if(boot_data.calendar_start)r=TS.interop.datetime.toDateObject(boot_data.calendar_start);if(boot_data.calendar_oldest)n=TS.interop.datetime.toDateObject(boot_data.calendar_oldest);TS.ui.date_picker.start(t,{first_day:window.moment.localeData().firstDayOfWeek()||0,hide_on_select:true,select_year:true,date:r,min:n,max:a,locale:{days:window.moment.weekdays(),daysShort:window.moment.weekdaysShort(),daysMin:window.moment.weekdaysMin(),months:window.moment.months(),monthsShort:window.moment.monthsShort()},change:function e(){r=$(this).pickmeup("get_date");var t=1e3*Date.parse(r);var n=i.is_mpim?TS.mpims.getMpimArchivesPath(i):"/archives/"+i.id;window.location=n+"/s"+t}})},startExpirationDatePicker:function e(t,i){i=i||{};var n=new Date;var r=n.getTime();var s;var o;if(i.selected_expiration_ts)o=new Date(1e3*i.selected_expiration_ts);else{o=new Date;o.setDate(n.getDate()+a)}o.setHours(0,0,0,0);s=o.getTime();var l={first_day:window.moment.localeData().firstDayOfWeek()||0,select_year:false,min:r,date:s,format:"s",position:"top",flat:true,hide_on_select:true,locale:{days:window.moment.weekdays(),daysShort:window.moment.weekdaysShort(),daysMin:window.moment.weekdaysMin(),months:window.moment.months(),monthsShort:window.moment.monthsShort()}};if(i.class_name)l.class_name=i.class_name;if(i.onHide)l.hide=i.onHide;if(i.onChange)l.change=function(e){var t=new Date(1e3*e);t.setHours(23,59,59,0);var n=Math.floor(t.getTime()/1e3);i.onChange(n)};TS.ui.date_picker.start(t,l)},getOldestMsgTs:function e(){var t=$("#channel_actions_toggle").attr("data-oldest-ts");if(t)return;var i=TS.shared.getActiveModelOb();var n=TS.shared.getHistoryApiMethodForModelOb(i);var a={channel:i.id,oldest:283996800,count:1,inclusive:1,include_pin_count:true};if(TS.useReactMessages())a.ignore_replies=true;TS.api.callImmediately(n,a).then(function(e){var t;if(e.data.messages.length<1)return;t=_(e.data.messages).map("ts").min();$("#channel_actions_toggle").attr("data-oldest-ts",t);return true}).catch(function(){return TS.warn("couldn’t find messages in this channel :"+i.id)})}});var e=function e(i){var n=TS.shared.getActiveModelOb();if(TS.useReactMessages()){TS.client.ui.tryToJump(n.id,""+Date.parse(i)/1e3);return}if(n.is_channel&&!n.is_member){if(n.id==TS.client.archives.current_model_ob.id)t(n,i)}else{if(n.msgs.length<1){TS.warn("no messages in this channel: "+n.id);return}var a=Date.parse(i)/1e3;var r=n.msgs[n.msgs.length-1];var s=parseFloat(r.ts);if(s<a){if(TS.model.archive_view_is_showing)TS.client.archives.cancel();var o=TS.utility.msgs.getDisplayedMsgAfterTS(a,n.msgs);if(o)TS.client.ui.scrollMsgsSoMsgIsInView(o.ts,false,true);else if(!o&&n.msgs.length>0){o=TS.utility.msgs.getDisplayedMsgBeforeTS(a,n.msgs);TS.client.ui.scrollMsgsSoMsgIsInView(o.ts,false,true)}}else t(n,i)}};var t=function e(t,n){var a=Date.parse(n)/1e3;a=a.toString()+".000000";i(t,a).then(function(e){if(TS.utility.msgs.getMsg(e,t.msgs)){if(TS.model.archive_view_is_showing)TS.client.archives.cancel();TS.client.ui.scrollMsgsSoMsgIsInView(e,false,true)}else TS.client.archives.start(e);return true}).catch(function(){return TS.warn("couldn’t find message for date: "+a+" in channel: "+t.id)})};var i=function e(t,i,n){n=n||1;if(n>100){if(t._archive_msgs&&t._archive_msgs.length>0)return t._archive_msgs[0];throw new Error("no_visible_message_found")}var a=TS.shared.getHistoryApiMethodForModelOb(t);return new Promise(function(e,r){var s={channel:t.id,oldest:i,count:n,inclusive:1,ignore_replies:true,include_pin_count:true};TS.api.call(a,s).then(function(i){if(!i||!i.data||0===i.data.messages.length)if(t._archive_msgs&&t._archive_msgs.length>0)e(t._archive_msgs[0]);else r(new Error("api_call_failed"));else{var n=i.data.messages;for(var a=n.length-1;a>=0;a-=1){var s=n[a];if(!TS.utility.msgs.isMsgReply(s)&&!("pinned_item"===s.subtype))e(s.ts)}r(new Error("no_visible_message_found"))}})}).then(function(e){return e},function(a){if("no_visible_message_found"===a.message)return e(t,i,10*n);throw a})};var n=function t(i,n){if(!n)n=TS.interop.datetime.toDateObject(TS.shared.getActiveModelOb().created);var a=Date.now();var r=a;TS.ui.date_picker.start(i,{first_day:window.moment.localeData().firstDayOfWeek()||0,hide_on_select:true,select_year:false,flat:true,date:r,min:n,max:a,locale:{days:window.moment.weekdays(),daysShort:window.moment.weekdaysShort(),daysMin:window.moment.weekdaysMin(),months:window.moment.months(),monthsShort:window.moment.monthsShort()},change:function t(){r=$(this).pickmeup("get_date");e(r);TS.menu.$menu.css("opacity",0);TS.menu.end()},hide:function e(){window.setTimeout(function(){if($(this).pickmeup)$(this).pickmeup("destroy")}.bind(this),0)}});i.pickmeup("show")};var a=7})()},3682:function(e,t){(function(){"use strict";TS.registerModule("ui.paste",{catcher_div:null,onStart:function e(){if(!window.Clipboard){TS.ui.paste.catcher_div=document.createElement("div");TS.ui.paste.catcher_div.setAttribute("tabindex","-1");TS.ui.paste.catcher_div.setAttribute("contenteditable","");TS.ui.paste.catcher_div.setAttribute("class","offscreen");document.body.appendChild(TS.ui.paste.catcher_div)}var t=86;$(window.document).keydown(function(e){if(!TS.ui.paste.okToGo())return;if(TS.utility.cmdKey(e)&&e.which==t){if(!TS.ui.paste.catcher_div)return;if(e.altKey)return;if(!TS.utility.isFocusOnInput())TS.ui.paste.catcher_div.focus()}});$(window).bind("paste",TS.ui.paste.handler)},okToGo:function e(){if(TS.web)return true;if(TS.client&&!TS.client.ui.$msg_input)return false;if(TS.utility.contenteditable.supportsTexty()){if(!TS.utility.isFocusOnInput()||TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input))return true}else if(!TS.utility.isFocusOnInput()||document.activeElement==TS.client.ui.$msg_input[0])return true;return false},handler:function e(t){if(!TS.ui.paste.okToGo())return;TS.info("TS.ui.paste.handler");t=t.originalEvent||t;var i=TS.model.shift_key_pressed;if(window.desktop&&window.desktop.app.getModifierKeys){var n=window.desktop.app.getModifierKeys();i=i||n&&n.shift}if(!(TS.model.is_FF&&bowser.version<50)&&t.clipboardData){var a=TS.ui.paste.detectImageFromEvent(t);if(a){t.preventDefault();if(t.clipboardData.items)TS.client.ui.file_pasted_sig.dispatch(a,i);else TS.ui.paste.startUploadFromMacSSBReadImage(a,i)}else if(!TS.model.is_FF&&t.clipboardData.items&&TS.client&&!TS.utility.isFocusOnInput())if(TS.boot_data.feature_texty_mentions)TS.utility.contenteditable.paste(TS.client.msg_input.$input,t);else TS.view.focusMessageInput()}else{var r=t.clipboardData&&t.clipboardData.types;var s;if(r&&_.includes(r,"text/plain"))s=t.clipboardData.getData("text");setTimeout(TS.ui.paste.checkCatcher,0,i,s)}},supportsUploadOnPaste:function e(){return!TS.model.is_IE},detectImageFromEvent:function e(t){TS.info("clipboardData!");TS.info(t.clipboardData.types);var i;var n;var a=t.clipboardData.items;var r={};if(a){for(i=0;i<a.length;i+=1)if(a[i])r[a[i].type]=true;for(i=0;i<a.length;i+=1)if(-1!==a[i].type.indexOf("image"))if(TS.model.is_mac&&r["text/plain"]&&r["text/html"]&&r["text/rtf"])TS.info("Ignoring pasted image data, likely from Office/Word for Mac.");else if(TS.model.is_win&&r["text/plain"]&&r["text/html"]&&r["image/png"])TS.info("Ignoring pasted image data from Windows, which should render as text");else{n=a[i].getAsFile();if(null!==n)return n}}else{TS.warn("no clipboardData.items");var s=t.clipboardData.types||[];for(i=0;i<s.length;i+=1)if(s[i])r[s[i]]=true;var o=window.macgap||window.winssb;if(o&&o.clipboard&&o.clipboard.readImage)if(!r["text/rtf"]&&o.clipboard.readImage())return o.clipboard.readImage()}return false},startUploadFromMacSSBReadImage:function e(t,i){var n=document.getElementById("converter_canvas");if(!n){$("body").append('<canvas id="converter_canvas" class="offscreen"></canvas>');n=document.getElementById("converter_canvas")}var a=n.getContext("2d");var r=new Image;r.src="data:image/tiff;base64,"+t;r.onload=function(){n.width=r.width;n.height=r.height;a.clearRect(0,0,n.width,n.height);a.drawImage(r,0,0);var e=TS.utility.base64StrFromDataURI(n.toDataURL("image/png"));TS.client.ui.file_pasted_sig.dispatch(e,i)}},checkCatcher:function e(t,i){var n=TS.ui.paste.catcher_div;if(!n)return;var a=n.childNodes[0];var r=TS.utility.contenteditable.value(TS.client.ui.$msg_input);var s=i;if(!s){s="textContent"in n?n.textContent:n.innerText;s=$.trim(s)}var o;var l;if(a)if("IMG"===a.tagName)TS.client.ui.file_pasted_sig.dispatch(TS.utility.base64StrFromDataURI(a.src),t);else{if(r){l=TS.client.ui.$msg_input.getCursorRange();var d=l.l;var c=l.s;var _=r.substr(0,c);var u=r.substr(c+d);o=_+s+u}else o=s;TS.client.msg_input.populate(o)}n.innerHTML="";if(l)TS.client.ui.$msg_input.setCursorPosition(l.s+l.l+s.length)},getPlainTextFromClipboard:function e(t){if(t&&t.clipboardData)return t.clipboardData.getData("text/plain");if(window.clipboardData)return window.clipboardData.getData("Text");return null}})})()},3691:function(e,t){(function(){"use strict";TS.registerModule("ui.shortcuts_dialog",{$div:null,showing:false,is_space:false,onStart:function e(){},onKeydown:function e(t){if(!TS.ui.shortcuts_dialog.showing)return;if(t.which==TS.utility.keymap.enter||t.which==TS.utility.keymap.esc){TS.ui.shortcuts_dialog.cancel();t.preventDefault()}if(70==t.which&&TS.utility.cmdKey(t))t.preventDefault()},start:function e(){TS.ui.shortcuts_dialog.is_space=TS.web&&TS.web.space;TS.tips.hideAll();if(!TS.ui.shortcuts_dialog.$div)TS.ui.shortcuts_dialog.build();var t=TS.templates.shortcuts_dialog({meta_key:TS.model.is_mac?TS.i18n.t("Option","keys")():TS.i18n.t("Alt","keys")(),cmd_key:TS.model.is_mac?TS.i18n.t("Cmd","keys")():TS.i18n.t("Ctrl","keys")(),cmd_key_label:TS.model.is_mac?TS.i18n.t("Command","keys")():TS.i18n.t("Control","keys")(),can_show_a11y_keyboard_shortcuts:TS.boot_data.feature_a11y_keyboard_shortcuts,can_show_unread_view:TS.client&&TS.client.unread.isEnabled(),show_browse_dms_shortcut:true});if(TS.ui.shortcuts_dialog.is_space)t=TS.templates.shortcuts_spaces_dialog({clear_formatting:!TS.model.is_win,meta_key:TS.model.is_mac?TS.i18n.t("Option","keys")():TS.i18n.t("Alt","keys")(),cmd_key:TS.model.is_mac?TS.i18n.t("Cmd","keys")():TS.i18n.t("Ctrl","keys")(),cmd_key_label:TS.model.is_mac?TS.i18n.t("Command","keys")():TS.i18n.t("Control","keys")()});var i=TS.ui.shortcuts_dialog.$div;i.html(t).modal("show").find(".dialog_cancel").click(TS.ui.shortcuts_dialog.cancel);if(!TS.ui.shortcuts_dialog.is_space)TS.ui.a11y.saveCurrentFocusAndFocusOnElement(i)},cancel:function e(){TS.ui.shortcuts_dialog.$div.modal("hide")},end:function e(){TS.model.dialog_is_showing=false;TS.ui.shortcuts_dialog.showing=false;TS.ui.shortcuts_dialog.$div.empty();$(window.document).unbind("keydown",TS.ui.shortcuts_dialog.onKeydown);if(!TS.ui.shortcuts_dialog.is_space)TS.ui.a11y.restorePreviousFocusAndCleanUpElement(TS.ui.shortcuts_dialog.$div);TS.tips.unhideAll()},build:function e(){var t;if(TS.ui.shortcuts_dialog.is_space){$("body").append('<div id="shortcuts_spaces_dialog" class="modal hide fade"></div>');TS.ui.shortcuts_dialog.$div=$("#shortcuts_spaces_dialog");t=TS.ui.shortcuts_dialog.$div}else{$("body").append('<div id="shortcuts_dialog" class="modal hide fade"></div>');TS.ui.shortcuts_dialog.$div=$("#shortcuts_dialog");t=TS.ui.shortcuts_dialog.$div}t.on("hidden",function(e){if(e.target!=this)return;TS.ui.shortcuts_dialog.end()});t.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.shortcuts_dialog.showing=true});t.on("shown",function(e){if(e.target!=this)return;$(window.document).bind("keydown",TS.ui.shortcuts_dialog.onKeydown);TS.ui.shortcuts_dialog.height=t.outerHeight()+t.offset().top;TS.ui.shortcuts_dialog.width=t.outerWidth();TS.ui.shortcuts_dialog.toggleScrollbars();$(window).on("resize",TS.ui.shortcuts_dialog.toggleScrollbars)})},toggleScrollbars:function e(){if(!TS.ui.shortcuts_dialog.showing)return;var t=TS.ui.shortcuts_dialog.width>$(window).width();var i=TS.ui.shortcuts_dialog.height>$(window).height()||t;TS.ui.shortcuts_dialog.$div.toggleClass("single_column",t);TS.ui.shortcuts_dialog.$div.toggleClass("scroll_content",i)}})})()},3692:function(e,t){(function(){"use strict";TS.registerModule("coachmarks",{coachmarks:{channels:{id:"channels_coachmark",coachmark_el_id:"channels_coachmark_div",place:function e(){if(TS.useReactSidebar())TS.coachmark.placeRightOf($('[data-qa-channel-sidebar-section-heading="channels"]'),-26,-5,5);else TS.coachmark.placeRightOf($("#channels_header"),-26,10,5)},content:function e(){var t=TS.channels.getChannelsForUser().length;var i=TS.groups.getUnarchivedGroups().length;var n=TS.groups.getUnarchivedGroups().length?TS.groups.getUnarchivedGroups()[0].name:"";var a={channels_count:t,groups_count:i,total_count:t+i,first_group_channel_name:n,in_single_private_channel:!t&&1===i};return TS.templates.channels_coachmark(a)}},invites:{id:"invites_coachmark",coachmark_el_id:"invites_coachmark_div",place:function e(){if(TS.useReactSidebar())TS.coachmark.placeRightOf($(".p-channel_sidebar__link--invites"),-26,-5,5);else TS.coachmark.placeRightOf($("#channel_list_invites_link"),-26,50,5)},content:function e(){return TS.templates.invites_coachmark()}},direct_messages:{id:"direct_messages_coachmark",coachmark_el_id:"direct_messages_coachmark_div",place:function e(){if(TS.useReactSidebar())TS.coachmark.placeRightOf($('[data-qa-channel-sidebar-section-heading="ims"]'),-26,-5,5);else TS.coachmark.placeRightOf($("#direct_messages_header"),-26,10,5)},content:function e(){var t={channels_count:TS.channels.getChannelsForUser().length,groups_count:TS.groups.getUnarchivedGroups().length};return TS.templates.direct_messages_coachmark(t)}},highlights_feedback:{id:"highlights_feedback_coachmark",coachmark_el_id:"highlights_feedback_coachmark_div",inline_wrapper_el_class:"highlights_feedback_to_coach",no_bg:true,has_close_btn:true,place:function e(){TS.coachmark.placeBelowOf($(".highlights_feedback_to_coach"),40,-330,340,true)},content:function e(){return TS.templates.highlights_feedback_coachmark()},buttonText:function e(){return TS.i18n.t("Got it!","coachmarks")()}},recent_mentions:{id:"recent_mentions_coachmark",coachmark_el_id:"recent_mentions_coachmark_div",no_bg_on_small:true,place:function e(){TS.coachmark.placeBelowOf($("#recent_mentions_toggle"),25,-340,1)},placeSmall:function e(){TS.coachmark.placeBelowOf($("#recent_mentions_toggle"),25,-240,1)},content:function e(){return TS.templates.recent_mentions_coachmark()}},starred_items:{id:"starred_items_coachmark",coachmark_el_id:"starred_items_coachmark_div",no_bg_on_small:true,place:function e(){TS.coachmark.placeBelowOf($("#stars_toggle"),25,-340,3)},placeSmall:function e(){TS.coachmark.placeBelowOf($("#stars_toggle"),25,-220,8)},content:function e(){return TS.templates.starred_items_coachmark()}},replies:{id:"replies_coachmark",coachmark_el_id:"replies_coachmark_div",place:function e(){TS.coachmark.placeLeftOf($("#convo_tab_header"),-27,-20,6)},content:function e(){return TS.templates.replies_coachmark()},buttonText:function e(){return TS.i18n.t("Next","coachmarks")()},resolve:function e(){TS.ui.replies.focusReplyInput();_.defer(function(){TS.coachmark.start(TS.coachmarks.coachmarks.replies_2)})}},replies_2:{id:"replies_coachmark",coachmark_el_id:"replies_coachmark_div",place:function e(){TS.coachmark.placeLeftOf($("#reply_container"),-75,-20,6)},content:function e(){return TS.templates.replies_coachmark_step_two()},buttonText:function e(){return TS.i18n.t("Next","coachmarks")()},resolve:function e(){_.defer(function(){if(TS.useReactSidebar())TS.client.threads.showThreadsView();else $("#channels_scroller").scrollTop(0);TS.coachmark.start(TS.coachmarks.coachmarks.replies_3)})}},replies_3:{id:"replies_coachmark",coachmark_el_id:"replies_coachmark_div",place:function e(){if(TS.useReactSidebar())TS.coachmark.placeRightOf($("p-channel_sidebar__link--all-threads"),-16);else TS.coachmark.placeRightOf($("#all_threads_nav"),-16)},buttonText:function e(){return TS.i18n.t("Got it!","coachmarks")()},content:function e(){return TS.templates.replies_coachmark_step_three()}},unread_view:{id:"unread_view_coachmark",coachmark_el_id:"unread_view_coachmark_div",place:function e(){if(TS.useReactSidebar())TS.coachmark.placeRightOf($("p-channel_sidebar__link--all-unreads"),-16);else TS.coachmark.placeRightOf($("#all-unreads-list"),-16)},content:function e(){return TS.templates.unread_view_coachmark()}},calls_video_beta:{id:"calls_video_beta_coachmark",coachmark_el_id:"calls_video_beta_coachmark_div",place:function e(){TS.coachmark.placeAboveOf($("#camera"),15,-64,19)},content:function e(){return TS.templates.calls_video_beta_coachmark()},ui_click:true},calls_ss_window:{id:"calls_ss_window_coachmark",coachmark_el_id:"calls_ss_window_coachmark_div",place:function e(){TS.coachmark.placeAboveOf($("#screen"),0,-180,12)},buttonText:function e(){return TS.i18n.t("Got it!","coachmarks")()},content:function e(){return TS.templates.calls_ss_window_coachmark()},ui_click:true},calls_ss_main:{id:"calls_ss_main_coachmark",coachmark_el_id:"calls_ss_main_coachmark_div",place:function e(){TS.coachmark.placeBelowOf($(".call_icon"),17,-25,5)},buttonText:function e(){return TS.i18n.t("Got it!","coachmarks")()},content:function e(){return TS.templates.calls_ss_main_coachmark()}},calls_interactive_mas_migration:{id:"calls_interactive_mas_migration_coachmark",coachmark_el_id:"calls_interactive_mas_migration_coachmark_div",place:function e(){TS.coachmark.placeBelowOf($(".call_icon"),17,-25,5)},buttonText:function e(){return TS.i18n.t("Got it!","coachmarks")()},content:function e(){return TS.templates.calls_interactive_mas_migration_coachmark()}},calls_video_ga:{id:"calls_video_ga_coachmark",coachmark_el_id:"calls_video_ga_coachmark_div",place:function e(){TS.coachmark.placeBelowOf($(".call_icon"),17,-97,5)},content:function e(){return TS.templates.calls_video_ga_coachmark()}},gdrive:{id:"gdrive_coachmark",coachmark_el_id:"gdrive_coachmark_div",place:function e(){TS.coachmark.placeAboveOf($("#primary_file_button"),13,-6,0)},content:function e(){return TS.templates.gdrive_coachmark()}},intl_channel_names:{id:"intl_channel_names_coachmark",coachmark_el_id:"intl_channel_names_coachmark_div",place:function e(){TS.coachmark.placeBelowOf($(".title_input"),70,105,20)},buttonText:function e(){return TS.i18n.t("Got it!","coachmarks")()},content:function e(){return TS.templates.intl_channel_names_coachmark()}}},onStart:function e(){}})})()},4349:function(e,t){(function(){"use strict";TS.registerModule("client",{before_login_sig:new signals.Signal,login_sig:new signals.Signal,user_added_to_team_sig:new signals.Signal,user_removed_from_team_sig:new signals.Signal,flexpane_display_switched_sig:new signals.Signal,core_url:null,onStart:function e(){TS.client.core_url=document.location.href.split(/\/+messages/)[0]+"/messages";TS.model.ui_state=TS.storage.fetchUIState();TS.model.initial_ui_state_str=TS.model.ui_state?JSON.stringify(TS.model.ui_state):"none";TS.model.flex_name_in_url=TS.utility.getFlexNameFromUrl(location.href).toLowerCase();TS.model.flex_extra_in_url=TS.utility.getFlexExtraFromUrl(location.href);if(-1==TS.model.flex_names.indexOf(TS.model.flex_name_in_url)){TS.model.flex_name_in_url="";TS.model.flex_extra_in_url=""}if(TS.model.flex_name_in_url&&"search"!==TS.model.flex_name_in_url){TS.model.ui_state.flex_name=TS.model.flex_name_in_url;TS.model.ui_state.flex_extra=TS.model.flex_extra_in_url||""}if("list"===TS.model.ui_state.flex_name)TS.model.ui_state.flex_name="files";if("activity"===TS.model.ui_state.flex_name)TS.model.ui_state.flex_name="mentions";TS.model.ui_state.flex_visible=!!TS.model.ui_state.flex_name;TS.storage.storeUIState(TS.model.ui_state);var t=$("body");if(TS.boot_data.feature_name_tagging_client)t.addClass("feature_name_tagging_client");if(TS.boot_data.feature_texty_mentions)t.addClass("feature_texty_mentions");if(TS.boot_data.feature_texty_search)t.addClass("feature_texty_search");if(TS.utility.contenteditable.supportsTexty())t.addClass("feature_texty");if(TS.boot_data.feature_file_threads)t.addClass("feature_file_threads");if(TS.boot_data.feature_shared_channels_client||TS.boot_data.feature_name_tagging_client)t.addClass("unify_user");if(TS.boot_data.feature_keyboard_navigation)t.addClass("feature_keyboard_navigation");if(TS.boot_data.feature_min_web&&TS.model.is_electron){if(!window.desktop)TS.error("TS.model.is_electron is true, but window.desktop is not present");if(window.desktop&&desktop.teams&&desktop.teams.setTeamIdleTimeout)F()}TS.client.user_added_to_team_sig.add(TS.client.userAddedToTeam);TS.client.user_removed_from_team_sig.add(TS.client.userRemovedFromTeam);if(TS.isSocketManagerEnabled())TS.interop.SocketManager.troubleConnectingSig.add(TS.client.showConnectionTroubleDialog)},isEnhancedDebuggingEnabled:function e(){return!!k},gogogo:function e(){$(window).bind("popstate",f);if(TS.model.is_mac_ssb)TSSSB.callMacGap("didSignin",{id:TS.model.user.id,name:TS.model.user.name,team_id:TS.model.team.id,team_name:TS.model.team.name,team_url:"https://"+location.host})},updateTeamIcon:function e(){if(TS.model.team.icon)if(TS.model.team.icon.image_68&&true!==TS.model.team.icon.image_default)if(window.winssb)TSSSB.call("setImage",TS.model.team.icon);else TSSSB.call("setImage",TS.model.team.icon.image_68);else TSSSB.call("setImage",false)},markLastReadsWithAPI:function e(){if(TS.isPartiallyBooted())return;var t;var i=TS.redux.channels.getAllIdsNeedingMarking();i.forEach(function(e){var i=TS.redux.channels.getEntityById(e);if(!i)return;TS.model.last_reads_set_by_client[i.id+"_"+i.last_read]=true;t="muted"===i._marked_reason;var n="channels.mark";var a=TS.channels.onMarked;if(TS.redux.channels.isGroup(i)){n="groups.mark";a=TS.groups.onMarked}else if(TS.redux.channels.isIm(i)){n="im.mark";a=TS.ims.onMarked;t=void 0}else if(TS.redux.channels.isMpim(i)){n="mpim.mark";a=TS.mpims.onMarked}if(TS.boot_data.feature_shared_channels_beta)n="conversations.mark";TS.api.call(n,{channel:e,ts:i.last_read,reason:i._marked_reason},a,t)});if(i.length)TS.redux.channels.clearAllMarkingFlags()},activeChannelDisplayGoneAway:function e(){TS.model.active_history.pop();var t;var i;var n;var a=function e(t){TS.model.active_history.push(t.id);TS.model.active_channel_id=null;TS.model.active_im_id=null;TS.model.active_group_id=null;TS.model.active_mpim_id=null;if(t.is_im)TS.model.active_im_id=t.id;else if(t.is_mpim&&t.is_group)TS.model.active_mpim_id=t.id;else if(t.is_group)TS.model.active_group_id=t.id;else if(t.is_channel)TS.model.active_channel_id=t.id;TS.model.active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id};while(TS.model.active_history.length&&!n){t=TS.model.active_history.pop();i=TS.shared.getModelObById(t);if(i.is_im&&i.is_open){n=true;if(TS.has_pri[U])TS.log(U,"switching to im "+i.id);if(TS.client.activeChannelIsHidden())return a(i);TS.ims.displayIm(i.id);TS.client.channelDisplaySwitched({id:i.id})}else if(i.is_mpim&&i.is_group&&i.is_open){n=true;if(TS.has_pri[U])TS.log(U,"switching to mpim "+i.id);if(TS.client.activeChannelIsHidden())return a(i);TS.mpims.displayMpim({id:i.id,replace_history_state:true})}else if(i.is_group&&!i.is_archived){n=true;if(TS.has_pri[U])TS.log(U,"switching to group "+i.id);if(TS.client.activeChannelIsHidden())return a(i);TS.groups.displayGroup({id:i.id})}else if(i.is_channel){n=true;if(TS.has_pri[U])TS.log(U,"switching to channel "+i.id);if(TS.client.activeChannelIsHidden())return a(i);TS.channels.displayChannel({id:i.id,replace_history_state:true})}}if(!TS.model.active_history.length){var r=TS.channels.getUnarchivedChannelsForUser();var s=TS.groups.getUnarchivedGroups();if(r.length>0){var o=_.find(r,{is_member:true})||r[0];if(TS.client.activeChannelIsHidden())return a(o);TS.channels.displayChannel({id:o.id,replace_history_state:true});return}else if(s.length>0){if(TS.client.activeChannelIsHidden())return a(s[0]);TS.groups.displayGroup({id:s[0].id});return}TS.error("WTF no channel or group to display?")}},flexDisplaySwitched:function e(t,i,n,a){i=g(i);n=true;if(!a&&(TS.model.c_name_in_url||TS.client.activeChannelIsHidden())){var r=function(){if(TS.model.unread_view_is_showing)return"/unreads";if(TS.model.threads_view_is_showing)return"/threads";return"/messages/"+TS.model.c_name_in_url}();var s=TS.utility.refashionUrl(window.location.href,r,t,i);p(s,n)}var o=TS.model.ui_state.flex_name;var l=TS.model.ui_state.flex_extra;TS.model.flex_name_in_url=t;TS.model.flex_extra_in_url=i;TS.model.ui_state.flex_name=t;TS.model.ui_state.flex_extra=i;TS.model.ui_state.prev_flex_name=o;TS.model.ui_state.prev_flex_extra=l;TS.storage.storeUIState(TS.model.ui_state);TS.client.flexpane_display_switched_sig.dispatch(o,l)},channelDisplaySwitched:function e(t){var i=_.defaults({},t,{from_history:false,replace_history_state:false});var n=i.id;if(!n){TS.error("no model id supplied");return}var a=i.replace_history_state;var r=i.no_history_add;if(!n){TS.error("no model_ob_id?");return false}var s=TS.shared.getModelObById(n);if(!s){TS.error("unknown model_ob id: "+n);return false}var o=TS.utility.getChannelStringIdentifierForUrl(s);var l=i.channel_path||"/messages/"+o;if(!r){var d=g(TS.model.flex_extra_in_url);var c=TS.utility.refashionUrl(window.location.href,l,TS.model.flex_name_in_url,d);p(c,!TS.model.c_name_in_url||a)}TS.model.c_name_in_url=o;if(!TS.client.activeChannelIsHidden()){if(s.is_channel&&n==TS.model.active_channel_id){TS.warn("not switching, it is the active channel already");return false}if(s.is_im&&n==TS.model.active_im_id){TS.warn("not switching, it is the active im already");return false}if(s.is_mpim&&n==TS.model.active_mpim_id){TS.warn("not switching, it is the active mpim already");return false}if(s.is_group&&n==TS.model.active_group_id){TS.warn("not switching, it is the active group already");return false}}TS.utility.msgs.checkForMsgsToTruncate();TS.model.last_active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id;TS.model.active_channel_id=null;TS.model.active_im_id=null;TS.model.active_group_id=null;TS.model.active_mpim_id=null;TS.model.unread_view_is_showing=false;TS.model.threads_view_is_showing=false;if(s.is_im)TS.model.active_im_id=n;else if(s.is_channel)TS.model.active_channel_id=n;else if(s.is_mpim&&s.is_group)TS.model.active_mpim_id=n;else if(s.is_group)TS.model.active_group_id=n;TS.model.active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id;TSSSB.call("displayChannel",TS.model.active_cid);TS.view.updateTitleWithContext();s.last_made_active=Date.now();var u=n;if(TS.has_pri[U])TS.log(U,u+" is now active");var m=TS.model.active_history;var f=m.indexOf(u);if(-1!=f)m.splice(f,1);m.push(u);if(TS.has_pri[U])TS.log(U,m);TS.storage.storeActiveHistory(m);if(TS.useReactSidebar())TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem(u));return true},unreadViewActivated:function e(t,i){if(!i){var n=g(TS.model.flex_extra_in_url);var a=TS.utility.refashionUrl(window.location.href,"/unreads",TS.model.flex_name_in_url,n);if(!t)if(!TS.model.unread_view_is_showing&&!TS.model.c_name_in_url)t=true;p(a,t)}if(TS.model.unread_view_is_showing){TS.warn("not switching, unread view is already active");return false}TS.client.threads.destroyThreadsView();TS.model.threads_view_is_showing=false;if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();TS.client.archives.cancel(true);TS.model.unread_view_is_showing=true;TS.view.updateTitleWithContext();return true},threadsViewActivated:function e(t,i){if(!i){var n=g(TS.model.flex_extra_in_url);var a=TS.utility.refashionUrl(window.location.href,"/threads",TS.model.flex_name_in_url,n);if(!t)if(!TS.model.threads_view_is_showing&&!TS.model.c_name_in_url)t=true;p(a,t)}if(TS.model.threads_view_is_showing){TS.warn("not switching, threads view is already active");return false}if(TS.client.unread.isEnabled()){TS.client.unread.destroyUnreadView();TS.model.unread_view_is_showing=false}TS.model.threads_view_is_showing=true;TS.client.archives.cancel(true);TS.view.updateTitleWithContext();if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();return true},calculateInitialCid:function e(){return S()},calculateInitialMessage:function e(){return T()},startCheckingForCleanup:function e(){m()},complianceExportStartChanged:function e(){c()},onFirstLoginMS:function e(){D("timing-www-perceived-load");M();h();setInterval(TS.client.markLastReadsWithAPI,5e3);m();if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.connectedSig.add(r);TS.interop.SocketManager.connectedSig.addOnce(Q)}else{TS.ms.connected_sig.add(r);TS.ms.connected_sig.addOnce(Q)}TS.channels.renamed_sig.add(i);TS.groups.renamed_sig.add(t);TS.members.changed_name_sig.add(a);TS.members.changed_account_type_sig.add(n);TS.view.members.unknown_resolution_rebuild_sig.add(a);TS.prefs.box_enabled_changed_sig.add(l);TS.prefs.dropbox_enabled_changed_sig.add(d);TS.prefs.compliance_export_start_changed_sig.add(c);TS.prefs.team_disallow_public_file_urls_changed_sig.add(u);if(TS.model.team.prefs.compliance_export_start)c();if(TS.model.mac_ssb_version&&!TS.model.prefs.no_macssb1_banner)TS.prefs.setPrefByAPI({name:"no_macssb1_banner",value:true});if(window.winssb&&!TS.model.prefs.no_winssb1_banner)TS.prefs.setPrefByAPI({name:"no_winssb1_banner",value:true});if(1==TS.qs_args.halt_at_loading_screen)throw new Error("Intentionally halting at loading screen");if(TS._incremental_boot)if(TS.client.ui&&TS.client.ui.$messages_input_container)TS.client.ui.$messages_input_container.addClass("pretend-to-be-online");$("#loading_welcome").transition({opacity:0},200,function(){$("#col_channels_bg").css("z-index",0);$("#loading-zone").transition({opacity:0},200,function(){$("body").removeClass("loading");TS.view.resizeManually("onFirstLoginMS");$("#loading-zone, #loading_zone_styles").remove();s();if(TS.model.initial_msg_ts){var e=TS.shared.getActiveModelOb();if(e&&e.id)TS.client.ui.tryToJump(e.id,TS.model.initial_msg_ts,TS.model.initial_thread_ts)}})});var o=TS.shared.getActiveModelOb();var _=o&&o.msgs&&(o.msgs.length>0||null===o.latest);if(TS.client.archives.current_model_ob);else if(_){TS.metrics.mark("content_visible");var f=TS.metrics.measure("client_content_visible_4","start_nav","content_visible");var g=TS.experiment.getGroup("early_incr_boot");if(g)TS.metrics.store("early_incr_boot_ttv_"+g,f)}else if(o)TS.client.ui.record_content_visible_metric_after_fetching_model_ob=o.id;if(TS.experiment)TS.experiment.getGroup("perf_aa",["client_total_load","beachballs"])},onEveryLoginMS:function t(i){var n=TS.shared.getActiveModelOb();var a=TS.shared.getControllerForModelOb(n);var r=true;if(window.desktop&&desktop.teams&&desktop.teams.setTeamLocale)desktop.teams.setTeamLocale(TS.i18n.locale());if(n&&!n.history_is_being_fetched)TS.shared.checkInitialMsgHistory(n,a);if(!TS.model.ms_logged_in_once){TS.warn(Date.now()-TS.boot_data.start_ms+"ms from first html to login_sig.dispatch()");TS.client.before_login_sig.dispatch();TS.client.login_sig.dispatch()}if(r&&!TS.useReactMessages())if(TS.isPartiallyBooted()){if(i._incremental_boot_users_counts_resp){e=i._incremental_boot_users_counts_resp;y(e)}}else if(e){y(e);e=void 0}else w();TS.model.ims.forEach(function(e){if(e.id==TS.model.active_im_id)return;if(!e.is_open&&!TS.shared.hasUnreads(e))return;TS.shared.checkInitialMsgHistory(e,TS.ims,r)});TS.model.channels.forEach(function(e){if(e.id==TS.model.active_channel_id)return;if(!e.is_member)return;TS.shared.checkInitialMsgHistory(e,TS.channels,r)});TS.model.groups.forEach(function(e){if(e.id==TS.model.active_group_id)return;if(e.is_archived)return;TS.shared.checkInitialMsgHistory(e,TS.groups,r)});TS.model.mpims.forEach(function(e){if(e.id==TS.model.active_mpim_id)return;if(e.is_archived)return;if(!e.is_open&&!TS.shared.hasUnreads(e))return;TS.shared.checkInitialMsgHistory(e,TS.mpims,r)})},handleDeepLink:function e(t){t=decodeURIComponent(t);TS.info("handleDeepLink url:"+t);if(!t)return;if(!t.indexOf)return;if(-1==t.indexOf("://"))return;if(-1==t.indexOf("?"))return;var i=t.split("?");var n=i[0].split("://")[1];TS.info("handleDeepLink cmd:"+n);if(!n)return;var a=i[1];TS.info("handleDeepLink qs:"+a);var r=TS.utility.url.queryStringParse(a);TS.info("handleDeepLink qs_args:"+JSON.stringify(r,null,2));TS.client._handleParsedDeepLink(n,r)},handleDeepLinkWithArgs:function e(t){TS.info("handleDeepLinkWithArgs string:"+t);var i=TS.utility.parseJSONOrElse(t,null);if(!i)return;var n=i.cmd;if(!n)return;delete i.cmd;TS.client._handleParsedDeepLink(n,i)},_handleParsedDeepLink:function e(t,i){if(!i.team)return;if(i.team!=TS.model.team.id){if(TS.boot_data.feature_teams_to_workspaces)TS.generic_dialog.alert(TS.i18n.t("You tried to perform an action on a workspace you’re not yet logged into! Sorry, no can do :/","client")());else TS.generic_dialog.alert(TS.i18n.t("You tried to perform an action on a team you’re not yet logged into! Sorry, no can do :/","client")());return}var n=i.id;var a;if("channel"===t){a=TS.shared.getModelObById(n);if(!a)return TS.error(n+" is not a recognized channel/dm/group");if("false"===i.thread_ts)delete i.thread_ts;TS.client.ui.tryToJump(a.id,i.message,i.thread_ts);return}if("user"===t){var r=TS.members.getMemberById(n);if(!r)return TS.error(n+" is not a recognized member");TS.client.ui.previewMember(n);var s=TS.ims.getImByMemberId(n);if(!s)return TS.error("Could not get im channel for user "+n);a=TS.shared.getModelObById(s.id);if(!a)return TS.error(s+" is not a recognized dm");TS.client.ui.tryToJump(a.id,i.message);return}if("file"===t){TS.client.ui.files.previewFile(n);return}if("files"===t);if("team"===t)if(n)TS.client.ui.previewMember(n);else TS.client.ui.showTeamList();if("invite"===t)TS.ui.admin_invites.start();if("notifications"===t)TS.ui.prefs_dialog.start("notifications")},manualReconnectNow:function e(){if(TS.isSocketManagerEnabled())TS.interop.SocketManager.reconnectImmediately();else TS.ms.manualReconnectNow()},apiPaused:function e(t){var i;if(t.reason.API_ERROR)i=TS.i18n.t('We’re having trouble connecting to Slack. We’ll try again shortly, or you can <a onclick="TS.client.manualReconnectNow()">try now</a>.',"client")();else if(t.reason.SERVICE_DOWN){var n="https://status.slack.com/"+_.escape(_.get(TS.model,"team.prefs.custom_status_site",""));i=TS.i18n.t('Slack is unavailable, but don’t worry — we’re on the case. <a href="{status_uri}">Check our status page</a> for updates.',"client")({status_uri:n})}else if(t.reason.OFFLINE)i=TS.i18n.t('Your computer seems to be offline. We’ll keep trying to reconnect, or you can <a onclick="TS.client.manualReconnectNow()">try now</a>.',"client")();if(TS.model.ms_logged_in_once){$("#connection_div").html(i).removeClass("hidden");TS.client.msg_pane.topMessagesBannerShown()}else{$("#loading_message_attribution").empty();$("#loading_message_attribution_img").remove();$("#loading_welcome_msg").html(i)}},apiUnpaused:function e(){if(TS.model.ms_logged_in_once){$("#connection_div").html("").addClass("hidden");TS.client.msg_pane.topMessagesBannerHidden()}else{$("#loading_message_attribution").empty();$("#loading_message_attribution_img").remove();$("#loading_welcome_msg").html(TS.i18n.t("Trying to log in again.","client")())}},displayModelObById:function e(t){var i=TS.shared.getModelObById(t);if(i)TS.client.displayModelOb(i)},displayModelOb:function e(t){if(t.presence)return TS.ims.startImByMemberId(t.id);else if(t.is_im)return TS.ims.startImById(t.id);else if(t.is_channel)return TS.channels.displayChannel({id:t.id});else if(t.is_mpim)return TS.mpims.displayMpim({id:t.id});else if(t.is_group)return TS.groups.displayGroup({id:t.id})},activateMsgRateLimit:function e(t){if(TS.model.is_msg_rate_limited)return;if(!t)t={};TS.model.is_msg_rate_limited=true;if(t.notify_user)TS.client.ui.addEphemeralBotMsg({text:TS.i18n.t("To stop overzealous bots from flooding channels, Slack sets a limit on flurries of messages. You are reading this, so you are not a bot. And yet — somehow — you hit this limit.","client")(),ephemeral_type:"disconnected_feedback",slackbot_feels:"sad_surprise"})},deactivateMsgRateLimit:function e(){if(!TS.model.is_msg_rate_limited)return;TS.model.is_msg_rate_limited=false},userAddedToTeam:function e(t){TS.info("You have been added to a team with the ID of "+t+".");if(!TS.model.is_our_app||!TS.model.is_electron)return;var i={user_id:TS.model.user.id,enterprise_id:TS.model.enterprise.id,team_ids:t};if(!TS.shared.isRelevantTeam()){TS.info("This team is not relevant, ignoring user_added_to_team for "+t+".");return}TS.info("Attempting to sign in to team with ID of "+t,i);var n=TSSSB.call("getSignedInTeamIds");if(!n||!n.length){TS.warn("WTF no signed-in team IDs from app?",n);return}if(-1!==n.indexOf(t)){TS.info("User is already signed into team "+t+". Exiting.");P=_.union(P,[t]);return}TS.info("calling enterprise.teams.signin for team_id = "+t,i);TS.api.call("enterprise.teams.signin",i).then(function(e){var i=e.data.teams;if(!i||!i.length){TS.warn("WTF no authed_teams from enterprise.teams.signin?");return}var n;_.each(i,function(e){if(e&&e.team_id==t){var i=document.domain.split(".").splice(1).join(".");n={name:TS.model.user.name,id:TS.model.user.id,team_id:t,team_name:e.team_name,team_url:"https://"+e.team_domain+"."+i}}});if(n){TS.info("calling TSSSB didSignIn with app_params",n);TSSSB.call("didSignIn",n)}else TS.warn("WTF did not find matching authed team?",i)})},userRemovedFromTeam:function e(t){if(t!==TS.model.team.id){TS.info("You have been removed from the team with ID = "+t+".");return}if(TS.model._user_removed_from_team)return;TS.model._user_removed_from_team=true;TS.generic_dialog.start({body:TS.boot_data.feature_teams_to_workspaces?"<p>"+TS.i18n.t("You have been removed from <strong>{team_name}</strong>.","client")({team_name:_.escape(TS.model.team.name)})+"</p>":"<p>"+TS.i18n.t("You have been removed from the <strong>{team_name}</strong> team.","client")({team_name:_.escape(TS.model.team.name)})+"</p>",show_cancel_button:false,esc_for_ok:true,go_button_text:TS.i18n.t("OK","client")(),onGo:function e(){if(_.includes(P,t)){TS.info("Was going to remove this team, but we were told to add them before the user hit ok to the original removal event.");P=_.remove(P,function(e){return e===t});return}if(TS.model.is_our_app){TS.info("calling TSSSB.signOutAndRemoveTeam because user_removed_from_team with team_id = "+t);TSSSB.signOutAndRemoveTeam(t)}else TS.reload(null,"user_removed_from_team with team_id = "+t)}})},activeChannelIsHidden:function e(){return TS.model.unread_view_is_showing||TS.model.threads_view_is_showing},setClientLoadWatchdogTimer:function e(){if(null!==x){B("www-load-watchdog-v2",E);E*=2}if(E<3e5)x=window.setTimeout(TS.client.setClientLoadWatchdogTimer,E)},showConnectionTroubleDialog:function e(){var t;if(TS.model.is_our_app)t=TS.i18n.t("We’ve seen this problem clear up with a restart of Slack, a solution which we suggest to you now only with great regret and self-loathing.","ms")();else t=TS.i18n.t("We’ve seen this problem clear up with a restart of your browser, a solution which we suggest to you now only with great regret and self-loathing.","ms")();var i=TS.i18n.t("Connection trouble","ms")();TS.generic_dialog.start({title:i,body:TS.i18n.t("<p>Apologies, we’re having some trouble with your WebSocket connection.</p>","ms")()+"<p>"+t+"</p>",show_cancel_button:false,go_button_text:TS.i18n.t("OK","ms")(),esc_for_ok:true});var n=TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig:TS.ms.connected_sig;n.addOnce(function(){if(!TS.generic_dialog.is_showing)return;var e=_.get(TS.generic_dialog.current_setting,"title");if(e===i)TS.generic_dialog.cancel()})}});var e;var t=function e(t){if(t.id!=TS.model.active_group_id)return;if(TS.client.activeChannelIsHidden())return;TS.client.channelDisplaySwitched({id:t.id,replace_history_state:true})};var i=function e(t){if(t.id!=TS.model.active_channel_id)return;if(TS.client.activeChannelIsHidden())return;TS.client.channelDisplaySwitched({id:t.id,replace_history_state:true})};var n=function e(t){if(!t||t.id!=TS.model.user.id)return;var i;if(t.is_ultra_restricted)if(TS.boot_data.feature_teams_to_workspaces)i=TS.i18n.t("Your account permissions have changed! You are now a single-channel guest of the workspace. You must now reload for the changes to take effect.","client")();else i=TS.i18n.t("Your account permissions have changed! You are now a single-channel guest of the team. You must now reload for the changes to take effect.","client")();else if(t.is_restricted)if(TS.boot_data.feature_teams_to_workspaces)i=TS.i18n.t("Your account permissions have changed! You are now a multi-channel guest of the workspace. You must now reload for the changes to take effect.","client")();else i=TS.i18n.t("Your account permissions have changed! You are now a multi-channel guest of the team. You must now reload for the changes to take effect.","client")();else if(TS.boot_data.feature_teams_to_workspaces)i=TS.i18n.t("Your account permissions have changed! You are now a full member of the workspace. You must now reload for the changes to take effect.","client")();else i=TS.i18n.t("Your account permissions have changed! You are now a full member of the team. You must now reload for the changes to take effect.","client")();TS.generic_dialog.start({title:TS.i18n.t("Reload required","client")(),body:"<p>"+i+"</p>",show_cancel_button:false,esc_for_ok:true,go_button_text:TS.i18n.t("Reload","client")(),onGo:function e(){TS.reload()}})};var a=function e(t){if(TS.model.active_im_id&&t&&t.id){var i=TS.ims.getImByMemberId(t.id);if(!i||i.id!=TS.model.active_im_id)return;TS.client.channelDisplaySwitched({id:i.id,replace_history_state:true})}else if(TS.model.active_mpim_id&&t&&t.id){var n=TS.mpims.getMpimById(TS.model.active_mpim_id);if(!n||!t)return;var a=TS.membership.getUserChannelMembershipStatus(t.id,n);var r=a.is_known&&!a.is_member;if(r)return;TS.client.channelDisplaySwitched({id:n.id,replace_history_state:true})}};var r=function e(){TS.ims.checkForOldImsToClose();if(TS.shared){if(TS.has_pri[R])TS.log(R,"_socketConnected: calling TS.shared.maybeResetHistoryFetchedOnAll");TS.shared.maybeResetHistoryFetchedOnAll()}};var s=function e(){var t=TS.qs_args.open;if(!t)return;if("create_channel"===t){if(TS.model.ms_connected||TS.model.change_channels_when_offline)if(TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups())TS.ui.new_channel_modal.start()}else if("invite_members"===t){if(TS.model.user.is_admin||!TS.model.team.prefs.invites_only_admins&&!TS.model.user.is_restricted)TS.ui.admin_invites.start()}else if("notifications"===t)TS.ui.prefs_dialog.start("notifications");else if("help"===t)TS.help_modal.start();else if("channel_membership"===t)TS.client.channel_page.members_dialog.show(TS.shared.getActiveModelOb());p(TS.utility.url.removeUrlQueryStringValue(location.href,"open"),true)};var o=function e(t,i,n,a){var r;var s;var o=t;var l=document.getElementById(o);var d="data-app-key";if(l)return;s=document.getElementsByTagName("head");if(s&&s[0])s=s[0];else s=document.body;r=document.createElement("script");r.setAttribute("async",true);if(i)r.setAttribute(d,i);r.id=o;r.src=n;if(s)s.appendChild(r);else if(TS.logError)TS.logError({message:a},"No target_node for TS.client._dynamicallyLoadJS")};var l=function e(){if(window.BoxSelect||!TS.model.prefs.box_enabled||!boot_data.box_js_url)return;var t="boxjs";var i=boot_data.box_app_key;var n=boot_data.box_js_url;var a="_boxEnabledChanged: Could not append box script node";o(t,i,n,a)};var d=function e(){if(window.Dropbox)return;if(!TS.model.prefs.dropbox_enabled)return;if(!boot_data.dropbox_js_url)return;var t="dropboxjs";var i=boot_data.dropbox_app_key;var n=boot_data.dropbox_js_url;var a="_dropboxEnabledChanged: Could not append dropbox script node";o(t,i,n,a)};var c=function e(){var t;var i;var n=$(".show_when_ce_enabled");var a=$(".show_when_ce_disabled");var r=$(".js_compliance_export_start");if(TS.model.team.prefs.compliance_export_start){r.html(TS.interop.datetime.toDate(TS.model.team.prefs.compliance_export_start));n.removeClass("hidden");a.addClass("hidden")}else{n.addClass("hidden");a.removeClass("hidden")}t=TS.shared.getActiveModelOb();if(!t)return;i=TS.members.getMemberById(t.user);if(!i)return;if(t.is_im)$("#im_meta").html(TS.templates.dm_badge({member:i,model_ob:t,compliance_exports_enabled_for_team:!!TS.model.team.prefs.compliance_export_start}))};var u=function e(){if(TS.model.team.prefs.disallow_public_file_urls){$(".file_public_link").remove();$("#file_public_link_revoker").remove()}};var m=function e(){setInterval(function(){if(TS.model.ms_connected)TS.ims.checkForOldImsToClose();TS.utility.msgs.checkForMsgsToTruncate()},9e5)};var f=function e(){if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.close();if(TS.ui.jumper.is_showing)TS.ui.jumper.end();var t=history.location||document.location;TS.qs_args=TS.utility.url.queryStringParse(t.search.substring(1));var i=TS.utility.isUnreadViewPath(t.pathname);var n=TS.utility.isThreadsViewPath(t.pathname);var a=TS.utility.getFlexNameFromUrl(t.href);var r=TS.utility.getFlexExtraFromUrl(t.href);if(!i&&!n&&!TS.model.ui_state.flex_name&&TS.model.ui_state.details_tab_active){a="details";r=""}else{a=TS.model.ui_state.flex_name;r=TS.model.ui_state.flex_extra}if((i||n)&&"details"===a){a="";r=""}var s=TS.utility.getChannelNameFromUrl(t.href);var o=s.split(":");s=o[0];var l=o.length>1?o[1]:"";if(!TS.model.channels)return;var d;var c;var _;var u;var m;var f;var h=false;_=TS.shared.getModelObById(s);if(_){d=_.id;if((TS.boot_data.feature_name_tagging_client||TS.boot_data.feature_shared_channels_client)&&_.is_im)c=_;else if(_.is_mpim)f=_;else if(_.is_channel)u=_;else if(_.is_group)m=_}if(!d&&s){u=TS.channels.getChannelByName(s);if(u)d=u.id;else if(-1!=s.indexOf("@")){c=TS.ims.getImByUsername(s);if(c)d=c.id}if(!d){m=TS.groups.getGroupByName(s);if(m)d=m.id}if(!d){f=TS.mpims.getMpimByName(s);if(f&&f.is_open)d=f.id}}TS.info("_onPopState\nc_extra from new url:"+l+"\nflex_name from new url:"+a+"\nflex_extra from new url:"+r);if(d){h=true;TS.info("c_name from new url is good, using id = "+d)}else if(!i&&!n){if(TS.model.channels.length){u=TS.channels.getFirstChannelYouAreIn();if(u){d=u.id;TS.info("got getFirstChannelYouAreIn:"+d)}}if(!d&&TS.model.ims.length){c=TS.ims.getFirstOpenIm();if(c){d=c.id;TS.info("got getFirstOpenIm:"+d)}}}if(TS.boot_data.feature_prev_next_button)TS.model.nav_used=true;if(c)TS.ims.startImByMemberId(c.user,true);else if(u)TS.channels.displayChannel({id:u.id,from_history:true,replace_history_state:!h});else if(m)TS.groups.displayGroup({id:m.id,from_history:true,replace_history_state:!h});else if(f)TS.mpims.displayMpim({id:f.id,from_history:true,replace_history_state:!h});else if(i)TS.client.unread.showUnreadView(true,true);else if(n)TS.client.threads.showThreadsView(true,true);else TS.error("WTF DONT KNOW WHAT TO DO");TS.client.ui.flex.setFlexStateFromHistory(a,r);var g=function(){if(i)return"/unreads";if(n)return"/threads";return"/messages/"+s}();var S=TS.utility.refashionUrl(window.location.href,g,a,r);var T=true;p(S,T)};var h=function e(){if(!TS.model.initial_cid){TS.error("TS.model.initial_cid was empty when _switchToInititalModelOb was called, which should be impossible");return}var t=TS.shared.getModelObById(TS.model.initial_cid);if(!t)TS.error("TS.model.initial_cid ("+TS.model.initial_cid+") referred to a channel that does not exist in _switchToInititalModelOb, which should be impossible");var i=true;if(t.is_im)if(t.is_open)TS.client.channelDisplaySwitched({id:t.id,replace_history_state:i});else TS.ims.startImByMemberId(t.user,i);else if(t.is_mpim&&t.is_group)TS.mpims.displayMpim({id:t.id,replace_history_state:i});else if(t.is_group&&!t.is_mpim)TS.groups.displayGroup({id:t.id,replace_history_state:i});else if(t.is_channel)TS.client.channelDisplaySwitched({id:t.id,replace_history_state:i});if(TS.model.initial_unread_view&&TS.model.prefs.enable_unread_view){var n=true;TS.client.unread.showUnreadView(false,i,n)}if(TS.model.initial_threads_view)TS.client.threads.showThreadsView(false,i);if(TS.boot_data.feature_prev_next_button){TS.client.nav_history.initialSetup();TS.client.nav_history.updateNavHistory()}};var g=function e(t){if(!t)return t;if(-1!=t.indexOf("#"))t=t.replace(/#/g,"%23");if(-1!=t.indexOf("/"))t=t.replace(/\//g,"%252F");return t};var p=function e(t,i){if(!history.pushState){TS.warn("This browser does not support pushState.");return}if(window.location.href.replace(/%20/g," ")!==t.replace(/%20/g," "))if(i)window.history.replaceState(null,null,t);else window.history.pushState(null,null,t)};var S=function e(){if(TS.model.initial_cid){TS.client.calculateInitialMessage();return}var t=TS.storage.fetchActiveHistory();var i;var n;var a;var r;var s;var o;var l;var d=function e(){if(TS.model.welcome_model_ob&&TS.model.welcome_model_ob.id)return;var t=TS.ims.getImByMemberId("USLACKBOT");if(t)TS.model.welcome_model_ob=t;else{TS.error("Tried to lookup Slackbot but failed");if(TS.boot_data.feature_shared_channels_beta)TS.api.callImmediately("conversations.open",{users:"USLACKBOT"}).finally(function(){var e=TS.i18n.t("Slack has encountered a problem and needs to reload.","client")();var t=TS.i18n.t("Reload required","client")();var i=TS.i18n.t("Reload","client")();return TS.generic_dialog.alert(e,t,i)}).then(function(){TS.reload()});else TS.api.callImmediately("im.open",{user:"USLACKBOT"}).finally(function(){var e=TS.i18n.t("Slack has encountered a problem and needs to reload.","client")();var t=TS.i18n.t("Reload required","client")();var i=TS.i18n.t("Reload","client")();return TS.generic_dialog.alert(e,t,i)}).then(function(){TS.reload()})}};if(!window.location.pathname.match(/^\/(message|unreads|threads|app-space)/)&&window.history)window.history.replaceState(null,null,window.location.origin+"/messages");d();for(n=0;n<t.length;n+=1){i=t[n];if(TS.model.active_history.indexOf(i)>-1)continue;l=TS.shared.getModelObById(i);if(!l)continue;if(l.is_im&&l.is_open)TS.model.active_history.push(i);else if(l.is_mpim&&l.is_open)TS.model.active_history.push(i);else if(l.is_group&&!l.is_archived)TS.model.active_history.push(i);else if(l.is_channel&&!l.is_archived&&!TS.model.user.is_restricted)TS.model.active_history.push(i)}TS.model.c_name_in_url=TS.utility.getChannelNameFromUrl(location.href);var c=TS.model.c_name_in_url;var u=TS.utility.isUnreadViewPath(location.pathname);var m=TS.utility.isThreadsViewPath(location.pathname);if(u)TS.model.initial_unread_view=true;if(m)TS.model.initial_threads_view=true;var f=function e(){if(c){a=TS.channels.getChannelByName(c);if(a)return a.id;s=TS.ims.getImByUsername(c);if(s)return s.id;r=TS.groups.getGroupByName(c);if(r)return r.id;o=TS.mpims.getMpimByName(c);if(o)return o.id}if(TS.model.active_history.length){i=TS.model.active_history[TS.model.active_history.length-1];l=TS.shared.getModelObById(i);if(l)return i}var t;if(TS.model.user.is_restricted){var d=TS.model.channels;d.sort(function(e,t){if(e._name_lc>t._name_lc)return 1;if(t._name_lc>e._name_lc)return-1;return 0});for(n=0;n<d.length;n+=1){a=d[n];if(a.is_archived)continue;if(!a.is_member)continue;return a.id}var u=TS.model.groups;u.sort(function(e,t){if(e._name_lc>t._name_lc)return 1;if(t._name_lc>e._name_lc)return-1;return 0});for(n=0;n<u.length;n+=1){r=u[n];if(u.is_archived)continue;return r.id}t=TS.ims.getImByMemberId("USLACKBOT");if(t)return t.id}else{if(TS.model.user.is_primary_owner&&!TS.model.prefs.newxp_seen_last_message){t=TS.ims.getImByMemberId("USLACKBOT");if(t)return t.id}var m=TS.channels.getGeneralChannel();if(m)return m.id;TS.info("No general channel?! Known channel IDs:",_.map(TS.model.channels,"id"));var f=TS.ims.getImByMemberId("USLACKBOT");if(f){TS.info("Using IM with Slackbot ("+f.id+") as our initial model object");return f.id}}alert(TS.i18n.t("ERROR could not find starting channel","client")())};TS.model.initial_cid=f();if(!TS.model.initial_cid){var h="TS.client.calculateInitialCid() failed to find a channel";TS.error(h);throw new Error(h)}TS.client.calculateInitialMessage()};var T=function e(){if(TS.model.initial_msg_ts)return;TS.model.initial_msg_ts=TS.utility.getMessageTimestampFromUrl(location.href);TS.model.initial_thread_ts=TS.qs_args.thread_ts};var v=function e(t,i,n){var a=true;if(TS.has_pri[R])TS.log(R,"we have a muted channel: "+t.id);if("hide_read_channels"===TS.model.prefs.sidebar_behavior){if(TS.has_pri[R])TS.log(R,"user pref is to HIDE READ CHANNELS");if(!i&&!n){if(TS.has_pri[R])TS.log(R,t.id+" has no unreads");if(t.id==TS.model.active_cid){if(TS.has_pri[R])TS.log(R,t.id+" is currently being viewed. showing even though no unreads.");a=true}else{if(TS.has_pri[R])TS.log(R,t.id+" is not the active channel. no unreads, can be hidden.");a=false}}else{if(TS.has_pri[R])TS.log(R,t.id+" has unreads.");a=false}}else if("hide_read_channels_unless_starred"===TS.model.prefs.sidebar_behavior){if(TS.has_pri[R])TS.log(R,"user pref is to HIDE READ CHANNELS UNLESS STARRED");if(!i&&!n){if(TS.has_pri[R])TS.log(R,t.id+" has no unreads");if(t.is_starred){if(TS.has_pri[R])TS.log(R,t.id+" IS STARRED - showing even though no unreads.");a=true}else if(t.id==TS.model.active_cid){if(TS.has_pri[R])TS.log(R,t.id+" is currently being viewed. showing even though no unreads.");a=true}else{if(TS.has_pri[R])TS.log(R,t.id+" is not the active channel. no unreads, can be hidden.");a=false}}else{if(TS.has_pri[R])TS.log(R,t.id+" has unreads.");a=false}}return a};var b=function e(t){var i=[];var n=[];t.forEach(function(e){var t=TS.redux.channels.getEntityById(e.id);if(!t){TS.warn("users.counts returned data for a model_ob we don't know about",e.id);return}if(t.is_archived&&!t.is_member)return;var a=TS.shared.getControllerForModelOb(t);t._latest_via_users_counts=e.latest;TS.shared.setUserCountsInfoForId(t.id,e);var r=parseInt(t.unread_cnt,10);var s=parseInt(t.unread_highlight_cnt,10);var o=t._show_in_list_even_though_no_unreads;var l=o;var d=r;var c=s;var _=e.has_unreads?1:0;var u=t.is_im||t.is_mpim;if(u)d=e.unread_count_display||e.dm_count||_;else{if(_)d=Math.max(t.unread_cnt,e.unread_count_display||e.dm_count||_);else d=e.unread_count_display||e.dm_count||_;c=e.mention_count_display||0}var m=TS.notifs.isCorGMuted(t.id);if(!a){TS.warn("Unable to figure out controller for model_ob with id="+t.id);return}if(t.msgs.length&&(d!==r||c!==s)){if(TS.has_pri[R])TS.log(R,'msgs exist, calculating unreads for "'+t.id+'"');n.push(function(){var e=false;a.calcUnreadCnts(t,e)})}if(m){if(!c){d=0;n.push(function(){a.markMostRecentReadMsg(t,TS.model.marked_reasons.none_qualify)})}l=v(t,d,c);if(!c)n.push(function(){TS.shared.maybeMarkReadIfMuted(t,a)})}var f={id:t.id};var h=false;if(d!==r){h=true;f.unread_cnt=d}if(c!==s){h=true;f.unread_highlight_cnt=c}if(l!==o){h=true;f._show_in_list_even_though_no_unreads=l}if(h)i.push(f);if(d!==r&&!m){if(TS.has_pri[R])TS.log(R,'unread count has changed for "'+t.id+'", from '+r+" to "+t.unread_cnt);n.push(function(){a.unread_changed_sig.dispatch(t)})}if(c!==s){if(TS.has_pri[R])TS.log(R,'unread highlight count has changed for "'+t.id+'", from '+s+" to "+t.unread_highlight_cnt);n.push(function(){a.unread_highlight_changed_sig.dispatch(t)})}if(d||c){if(!TS.client.history_prefetch){TS.warn("WTF no TS.client.history_prefetch module?");return}TS.client.history_prefetch.addToHistoryFetchQueue(t.id)}});if(!_.isEmpty(i))TS.redux.channels.bulkUpdateEntities(i);n.forEach(function(e){e()})};var w=function e(){var t={mpim_aware:true,only_relevant_ims:true,simple_unreads:true,include_threads:true};TS.api.callImmediately("users.counts",t).then(y)};var y=function e(t){if(TS.client.history_prefetch)TS.client.history_prefetch.resetHistoryFetchQueue();var i=0;var n=0;var a=_.compact(t.data.channels.concat(t.data.groups).concat(t.data.ims).concat(t.data.mpims));b(a);var r=t.data.threads;if(r){TS.client.threads.setThreadsUnreadData(r.has_unreads,r.mention_count);TS.client.threads.logThreadState("users.counts: "+!!r.has_unreads+" "+r.mention_count)}if(TS.client.history_prefetch)TS.client.history_prefetch.processHistoryFetchQueue();TS.info("Finished processing users.counts");t.data.ims.forEach(function(e){if(e.has_unreads)i+=1;if(e.dm_count)n+=e.dm_count});TS.info(i+" IMs with unreads, "+n+" total dm_count");return null};var k;function A(){if(!_.isFunction(window.requestAnimationFrame)){TS.warn("Enhanced debugging: unable to install beachball detector without requestAnimationFrame");return}TS.info("Enhanced debugging: installing beachball detector");var e=[];var t=TS.replaceConsoleFunction(function(i,n,a){var r=_.toArray(a).slice(1).join(" ");e.push({type:i,pri:n,msg:r,time:performance.now()});return t.apply(window,arguments)});var i=60;var n=4;var a=[];var r=performance.now();var s=function t(){var s=performance.now();var o=s-r;var l=r;r=s;a.push(o);if(a.length>i)a.shift();requestAnimationFrame(t);if(a.length<i){e.length=0;return}var d=_.sum(a)/a.length;if(o>n*d&&TS.has_pri[U]){TS.log(U,"========");TS.log(U,"Enhanced debugging: slowness detected");TS.log(U,"Current time: "+s+"; previous frame was at "+l);TS.log(U,"Last frame took: "+Math.round(o)+" ms");TS.log(U,"Average frame takes: "+Math.round(d)+" ms");if(e.length){TS.log(U,"Begin logs since last healthy tick:");e.forEach(function(e){var t=e.time-l;var i="["+_.padStart(Math.floor(t),5," ")+"]";var n=e.pri?" ("+e.pri+")":"";TS.log(U,i+" "+e.type+n+": "+e.msg)});TS.log(U,"End logs since last healthy tick")}else TS.log(U,"(No logs captured, sorry)");TS.log(U,"========")}e.length=0};requestAnimationFrame(s)}var C=function e(){if(JSON._shimmed)return;JSON._shimmed=true;var t=JSON.parse;JSON.parse=function(e){var i=performance.now();var n=t.apply(this,arguments);var a=performance.now()-i;if(a>1)TS.info("JSON parsing: "+_.toString(e).length+" bytes took "+_.round(a,2)+" ms");return n};var i=JSON.stringify;JSON.stringify=function(){var e=performance.now();var t=i.apply(this,arguments);var n=performance.now()-e;if(n>1)TS.info("JSON stringify into "+t.length+" bytes took "+_.round(n,2)+" ms");return t}};var M=function e(){k=TS.client&&(TS.qs_args.enhanced_debugging||TS.model.prefs.enhanced_debugging);if("0"===TS.qs_args.enhanced_debugging)k=false;if(!k)return false;A();C();I();return true};var I=function e(){if(!TS.model.is_our_app)return;var t;var i;var n=300;window.addEventListener("sleep",function(){if(t)return;t=setInterval(function(){TS.info("Debug tick")},1e3)},false);window.addEventListener("wake",function(){if(i)return;TS.info("Will stop debug ticking in "+n+" seconds");i=setTimeout(function(){clearTimeout(t);i=void 0;t=void 0;TS.info("Stopping debug ticking")},1e3*n)},false)};var x=null;var E=1e4;var B=function e(t,i){};var D=function e(t){window.clearTimeout(x);if(!window.performance)return;if(!performance.timing)return;B(t,Date.now()-window.performance.timing.navigationStart)};var F=function e(){var t=5;var i=43200;var n="dev"===TS.boot_data.version_ts?t:i;TSSSB.call("setTeamIdleTimeout",n)};var P=[];var O=1989;var R=58;var U=4;var Q=function e(){var t=100;var i=TS.boot_data.page_needs_enterprise?"W":"U";var n=_.map(TS.model.members,"id");var a=_(TS.ui.frecency.getMostCommonWithPrefix(i,t)).map("id").difference(n).value();if(!a.length)return;if(TS.has_pri[O])TS.log(O,"Flannel: pre-fetching "+a.length+" most frequently accessed members...");TS.members.ensureMembersArePresent(a).then(function(e){if(TS.has_pri[O])TS.log(O,"Flannel: pre-fetched "+e.length+" most frequently accessed members 👍")}).catch(_.noop)}})()},4350:function(e,t){(function(){"use strict";TS.registerModule("view",{file_list_heading:TS.i18n.t("All File Types","view")(),file_list_lazyload:null,members_list_lazyload:null,user_groups_members_list_lazyload:null,member_stars_list_lazyload:null,last_attachment_max_width:null,resize_sig:new signals.Signal,onStart:function e(){TS.view.rebuildMentionsImmediately=TS.view.rebuildMentions;TS.view.rebuildMentions=_.throttle(TS.view.rebuildMentions,1e3,{leading:false});TS.view.maybeRebuildUserGroupList=TS.utility.throttleFunc(TS.view.rebuildUserGroupList,1e3);TS.client.login_sig.add(TS.view.loggedIn,TS.view);TS.channels.read_only.list_updated_sig.add(TS.view.checkIfInputShouldBeDisabledAndPopulate);TS.user_groups.updated_sig.add(TS.view.userGroupUpdated,TS.view);TS.members.view.team_filter_changed_sig.add(function(){TS.view.maybeRebuildUserGroupList()},TS.view);TS.bots.added_sig.add(TS.view.botChanged,TS.view);TS.bots.changed_name_sig.add(TS.view.botChanged,TS.view);TS.bots.changed_icons_sig.add(TS.view.botChanged,TS.view);TS.ui.window_unloaded_sig.add(TS.view.windowUnloaded,TS.view);TS.client.flexpane_display_switched_sig.add(TS.view.flexpaneDisplaySwitched,TS.view);TS.client.ui.file_dropped_sig.add(TS.view.filesDropped);TS.client.ui.file_pasted_sig.add(TS.view.filePasted);TS.team.team_plan_changed_sig.add(TS.view.teamPlanChanged,TS.view);TS.team.team_profile_changed_sig.add(TS.view.teamProfileChanged,TS.view);TS.mentions.mentions_fetched_sig.add(TS.view.mentionsFetched,TS.view);TS.mentions.mention_changed_sig.add(TS.view.mentionChanged,TS.view);TS.mentions.mention_removed_sig.add(TS.view.mentionRemoved,TS.view);TS.mentions.mentions_being_fetched_sig.add(TS.view.mentionsBeingFetched,TS.view);TS.prefs.enable_unread_view_changed_sig.add(TS.view.resize);TS.prefs.team_disable_file_editing_changed_sig.add(TS.view.rebuildMsgFile);TS.view.members.unknown_resolution_rebuild_sig.add(TS.view.rebuildMentions);TS.view.resizeManually("TS.view.onStart");$(window).resize(TS.view.onResize);if("0"!=TS.qs_args.new_scroll){var n="1"==TS.qs_args.debug_scroll;if(!TS.environment.supports_custom_scrollbar)TS.client.ui.$msgs_scroller_div.monkeyScroll({debug:n,always_show:true,no_gutter:true});if(!TS.environment.supports_custom_scrollbar){$(".flex_content_scroller").monkeyScroll({debug:n});TS.client.channel_pane.$scroller.monkeyScroll({debug:n})}}TS.view.ms.changeConnectionStatus("trouble");$("a.clear_unread_messages").tooltip({placement:"bottom",delay:{show:500,hide:150}});$(".channels_list_new_btn").tooltip({container:"body",delay:{show:400,hide:150}});$(".channel_list_header_label, #direct_messages_header, #apps_header").tooltip({placement:"top-left",container:"body",delay:{show:400,hide:150}});TS.view.cached_wh=0;TS.view.resizeManually("TS.view.onStart 2");var a=false;$(window).bind("scroll",function(){if(a)return;a=true;$(window).unbind("mouseup.scroll").bind("mouseup.scroll",function(){a=false;$(window).unbind("mouseup.scroll");$("body").scrollTop(0)})});if(TS.model.is_mac)$("#drag_drop_mac_key").text(TS.i18n.t("Command","view")());var r=10;t=TS.utility.enableFeatureForUser(r);$("#stars_scroller").on("click.fetchUserStarredItems",".flexpane_load_more_btn",function(){var e=$(this);if(!e.data("ladda"))e.data("ladda",Ladda.create(this));e.data("ladda").start();TS.stars.fetchUserStarredItems().finally(function(){e.data("ladda").stop()})});i=!TS.boot_data.feature_initial_scroll_position||!TS.environment.supports_custom_scrollbar},was_at_bottom_at_first_resize_event:false,resize_tim:0,onResize:function e(){if(!TS.view.triggering_resize)TS.view.cached_wh=0;TS.model.ui.cached_file_preview_scroller_rect=null;TS.model.ui.cached_msgs_scroller_rect=null;TS.model.ui.cached_msgs_scroll_result=null;TS.model.ui.cached_search_scroller_rect=null;TS.model.ui.cached_channels_scroller_rect=null;TS.model.ui.cached_archives_scroller_rect=null;TS.model.ui.cached_archive_scroll_result=null;TS.model.ui.cached_convo_scroller_rect=null;TS.model.ui.cached_unread_scroller_rect=null;TS.model.ui.cached_threads_scroller_rect=null;if(TS.view.resize_tim){clearTimeout(TS.view.resize_tim);TS.view.resize_tim=0}else if(i)TS.view.was_at_bottom_at_first_resize_event=TS.client.ui.areMsgsScrolledToBottom(50);TS.view.resize_tim=setTimeout(function(){clearTimeout(TS.view.resize_tim);TS.view.resize_tim=0;if(TS.view.should_reset_input)TS.view.resetForInput();TS.view.resize(true);TS.view.should_reset_input=false},250);if(TS.view.triggering_resize)return;TS.view.resize(false,true)},team_menu_h:$("#team_menu").outerHeight(),cached_wh:0,last_msgs_div_width:0,last_input_height:0,last_preview_height:0,last_preview_height_changed:0,last_input_container_height:0,msgs_scroller_y:-1,footer_outer_h:-1,triggering_resize:false,resizeManually:function e(t,i){if(!TS.model.ms_logged_in_once)return;t=t||"unspecified";if(TS.has_pri[o])TS.log(o,"======================================resizeManually ("+t+") starting");var n=Date.now();TS.view.resize(false,false,!!i);if(TS.has_pri[o])TS.log(o,"======================================resizeManually ("+t+") took "+(Date.now()-n)+"ms")},resetUI:function e(){TS.view.should_reset_input=true},resetForInput:function e(){TS.view.cached_wh=0;TS.view.last_input_height=0;TS.view.last_preview_height=0;TS.view.last_preview_height_changed=0;TS.view.last_input_container_height=0;TS.view.msgs_scroller_y=-1;TS.view.footer_outer_h=-1},resizeForBanner:function e(t){TS.view.msgs_scroller_y=-1;TS.view.resizeManually(t);var i=$("html");i.height(i.height());TS.utility.rAF(function(){i.height("")})},resize:function e(n,a,r){if(t){var s="start_resize";TS.metrics.mark(s)}var d=Date.now();if(TS.has_pri[o])TS.log(o,d+" #1 cached_wh:"+TS.view.cached_wh+" TS.view.resize from_timer:"+n+" no_trigger:"+a+" "+(Date.now()-d)+"ms");d=Date.now();var c=i&&TS.client.ui.areMsgsScrolledToBottom(50);if(i&&!r&&(c||TS.view.was_at_bottom_at_first_resize_event)){var _=TS.shared.getActiveModelOb();if(_)if(TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest){if(_.unread_cnt&&(-1==_.scroll_top||void 0===_.scroll_top)&&TS.client.ui.$msgs_unread_divider&&!TS.client.ui.$msgs_unread_divider.hasClass("no_unreads"))if(TS.client.msg_pane.dont_check_unreads_til_switch){if(TS.has_pri[l])TS.log(l,"view resize: NOT scrolling despite unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+_.scroll_top+"), because _has_auto_scrolled is true.");if(c){if(TS.has_pri[l])TS.log(l,"view resize: was at bottom, so insta-scrolling to bottom.");TS.client.ui.instaScrollMsgsToBottom()}else if(TS.has_pri[l])TS.log(l,"view resize: was NOT scrolled to bottom before resize, so not doing anything.")}else if(_._has_auto_scrolled){if(TS.has_pri[l])TS.log(l,"view resize: NOT scrolling first unread into view despite unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+_.scroll_top+"), because _has_auto_scrolled is true.")}else{if(TS.has_pri[l])TS.log(l,"view resize: scrolling first unread into view because unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+_.scroll_top+")");TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()}else if(c){if(TS.has_pri[l])TS.log(l,"view resize: insta-scrolling to bottom because was_at_bottom, AND, !unread_cnt ("+_.unread_cnt+") OR scroll_top ("+_.scroll_top+") OR !TS.client.ui.$msgs_unread_divider ("+TS.client.ui.$msgs_unread_divider+") OR $msg_unread_divider has .no_unreads ("+(TS.client.ui.$msgs_unread_divider?TS.client.ui.$msgs_unread_divider.hasClass("no_unreads"):"undefined")+")");TS.client.ui.instaScrollMsgsToBottom()}}else TS.client.ui.instaScrollMsgsToBottom()}if(n)TS.view.was_at_bottom_at_first_resize_event=false;else if(!a){TS.view.triggering_resize=true;$(window).trigger("resize");TS.view.triggering_resize=false}TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads();if(TS.view.msgs_unscrollable)TS.view.makeMsgsDivUnscrollable();TS.ui.msg_tab_complete.positionUI();TS.view.resize_sig.dispatch();if(TS.has_pri[o])TS.log(o,d+" #15 "+(Date.now()-d)+"ms");if(t){TS.metrics.measure("resize",s);TS.metrics.clearMarks(s)}},never_set:true,measureMsgPreview:function e(){TS.view.footer_outer_h=$("#footer").outerHeight();TS.view.last_preview_height_changed=TS.view.last_preview_height!==TS.view.footer_outer_h;TS.view.last_preview_height=TS.view.footer_outer_h},makeAttachmentWidthRule:function e(t){var i;var n;var a;var r;var s;r=-96;if(TS.model.prefs&&"dense"===TS.model.prefs.theme)r=-144;i=t+r;s="\t\t\t#msgs_div div.dynamic_content_max_width {\t\t\t\tmax-width:"+i+"px;\t\t\t}\t\t";if(TS.view.last_attachment_max_width!==i){TS.view.last_attachment_max_width=i;n="dynamic_content_max_width_rule";a=$("#"+n);if(a.length)a.html(s);else $('<style type="text/css" id="'+n+'">'+s+"</style>").appendTo("head")}},filesSelected:function e(t){TS.client.ui.files.validateFiles(t,false,function(e){TS.ui.upload_dialog.startWithCommentFromChatInput(e)})},filePasted:function e(t,i){if("disable_all"===TS.model.team.prefs.disable_file_uploads){TS.generic_dialog.start({title:TS.i18n.t("Upload failed","view")(),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("At the request of your administrator, file uploads have been disabled in this workspace.","view")():TS.i18n.t("At the request of your administrator, file uploads have been disabled on this team.","view")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});return}if(i)TS.files.justUploadTheseFileNow([t]);else TS.ui.upload_dialog.startWithCommentFromChatInput([t])},filesDropped:function e(t,i){if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.close();if(i)TS.files.justUploadTheseFileNow(t);else TS.ui.upload_dialog.startWithCommentFromChatInput(t)},updateTypingText:function e(){var t=TS.typing.getTypersInChannel(TS.shared.getActiveModelOb().id);if(!t||!t.length||TS.model.archive_view_is_showing){$("#typing_text").empty();$("#notification_bar").removeClass("showing_typing");return}if(!TS.model.prefs.show_typing)return;$("#notification_bar").addClass("showing_typing");var i;var n;var a;i=TS.members.getPrefCompliantMemberName(t[0],true);if(2==t.length)n=TS.members.getPrefCompliantMemberName(t[1],true);if(1==t.length)a=TS.i18n.t("{user_name} is typing","view")({user_name:'<span class="typing_name">'+i+"</span>"});else if(2==t.length)a=TS.i18n.t("{user_name} and {another_user_name} are typing","view")({user_name:'<span class="typing_name">'+i+"</span>",another_user_name:'<span class="typing_name">'+n+"</span>"});else a=TS.model.typing_msg;$("#typing_text").html(a)},botChanged:function e(){if(TS.bots.is_in_bulk_upsert_mode)return;if(TS.isPartiallyBooted())return;var t=true;TS.client.msg_pane.rebuildMsgsWithReason("botChanged",t)},switchedHelper:function e(t){var i=TS.shared.getActiveModelOb();var a=TS.shared.getModelObById(TS.model.last_active_cid);if(a){TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",a.id);a._show_in_list_even_though_no_unreads=false;s(TS.model.last_active_cid)}if(TS.client.unread.isEnabled())TS.client.unread.destroyUnreadView();TS.client.threads.destroyThreadsView();if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();if(!TS.model.ui_state.flex_name&&TS.model.ui_state.details_tab_active)TS.client.ui.flex.openFlexTab("details",true);var r=true;var o=false;var l={};if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.features.messagePane.switchToChannel({channelId:i.id,startTs:n}));TS.client.ui.rebuildAllButMsgs(r,l,o)}else{if(i.is_channel&&(!i.is_member||i.is_archived))TS.client.archives.start();else if(i.is_group&&i.is_archived)TS.client.archives.start();else if(TS.ims.isImWithDeletedMember(i))TS.client.archives.start();else TS.client.archives.cancel(true);i._show_in_list_even_though_no_unreads=false;TS.client.msg_pane.clearBlueBarTimer();if(t)TS.client.ui.rebuildAllButMsgs(r,l,o);else{var d=i.scroll_top;TS.client.ui.rebuildAll(r,o);if(TS.boot_data.feature_initial_scroll_position)TS.client.msg_pane.setInitialScrollPosition(d)}}window.setTimeout(TS.view.focusMessageInput,0);TS.view.checkIfInputShouldBeDisabledAndPopulate();TS.utility.contenteditable.clearHistory(TS.client.ui.$msg_input);TS.view.showInterstitialAfterChannelOrImShown();if(!TS.client.activeChannelIsHidden()&&!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div);if(TS.utility.enableFeatureForUser(1)){var c="start_channel_change_"+TS.model.active_cid;var _="channel_change";if(i.is_shared)_+="_shared";if(i.is_im)_+="_im";else if(i.is_mpim)_+="_mpim";else if(i.is_group)_+="_group";else if(i.is_private)_+="_private";TS.metrics.measureAndClear(_,c)}},removeMsg:function e(t,i){TS.view.removeMessageDiv(i)},removeMsgsAfterTruncation:function e(t){var i;var n;for(var a=0;a<t.length;a+=1){i=t[a];n=TS.client.msg_pane.getDivsForMsg(i.ts);var r=n.parent(".day_msgs");TS.client.msg_pane.cleanMsgDiv(n);n.remove();if(!r.children().length)r.parent(".day_container").remove()}var s=TS.utility.msgs.getDisplayedMsgs(TS.shared.getActiveModelOb().msgs);if(s)TS.view.rebuildMsg(s[s.length-1]);TS.client.msg_pane.updateEndMarker();TS.view.resizeManually("TS.view.removeMsgsAfterTruncation")},removeMessageDiv:function e(t,i){var n=TS.client.msg_pane.getDivsForMsg(t.ts);if(!n.length)return;TS.client.msg_pane.cleanMsgDiv(n);var a=TS.client.msg_pane.last_rendered_msg&&TS.client.msg_pane.last_rendered_msg.ts==n.data("ts");var r;var s=n.nextAll(".message:not(.hidden)").first();if(a)r=n.prevAll(".message:not(.hidden)").first();var o=function e(){n=TS.client.msg_pane.getDivsForMsg(t.ts);var i=n.parent(".day_msgs");n.remove();if(!i.children().length)i.parent(".day_container").remove();if(TS.client.ui.$msgs_unread_divider){var o=TS.client.ui.$msgs_unread_divider.nextAll(".message:not(.hidden)");if(!o.length){TS.info("calling TS.client.ui.markMostRecentReadMsgInActive(true) after message removal because there are no displayed messages after the red line now");TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.deleted,true)}}if(a&&r&&r.length){var l=TS.utility.msgs.getMsg(r.data("ts"),TS.shared.getActiveModelOb().msgs);if(l){TS.client.msg_pane.last_rendered_msg=l;TS.client.msg_pane.last_in_stream_msg=TS.client.msg_pane.last_rendered_msg;TS.info("set a new TS.client.msg_pane.last_rendered_msg && TS.client.msg_pane.last_in_stream_msg because the deleted msg was the last one")}}if(s&&s.length){var d=TS.utility.msgs.getMsg(s.data("ts"),TS.shared.getActiveModelOb().msgs);if(d)TS.view.rebuildMsg(d)}TS.view.resizeManually("TS.view.removeMessageDiv")};if(i||TS.utility.msgs.isTempMsg(t))o();else n.addClass("delete_mode").slideUp(200,o)},updateTitleWithContext:function t(){var i;var n;var a;var r;var s;n=TS.shared.getActiveModelOb();if(TS.model.unread_view_is_showing)a=TS.i18n.t("Unread Messages","view")();else if(TS.model.threads_view_is_showing)a=TS.i18n.t("Threads","view")();else if(n)a=n.name||"";if(!a)return;i=" | ";s=document.title;r=s.indexOf(i);if(-1!==r)s=a+i+s.substr(r+i.length);else s=a+i+s;if(e!==s){e=s;document.title=s}},start_time:new Date,checkIfInputShouldBeDisabledAndPopulate:function e(t){TS.view.actuallyCheckIfInputShouldBeDisabledAndPopulate(t)},actuallyCheckIfInputShouldBeDisabledAndPopulate:function e(t){var i=TS.shared.getActiveModelOb();var n;if(i&&i.is_general&&!TS.members.canUserPostInGeneral()){TS.utility.contenteditable.clear(TS.client.ui.$msg_input,true);if(!TS.utility.contenteditable.supportsTexty())TS.client.ui.$msg_input.trigger("autosize").trigger("autosize-resize");TS.utility.contenteditable.disable(TS.client.ui.$msg_input);n=$("#msg_input_message span");if(TS.boot_data.feature_teams_to_workspaces)n.html(TS.i18n.t("Your Workspace Owners have limited who can post to {channel_or_group}","view")({channel_or_group:"#<strong>"+i.name+"</strong>"}));else n.html(TS.i18n.t("Your Team Owners have limited who can post to {channel_or_group}","view")({channel_or_group:"#<strong>"+i.name+"</strong>"}));TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")}else if(i&&(i.is_channel||i.is_group)&&TS.shared.isModelObOrgShared(i)&&!TS.permissions.members.canPostInChannel(i)){TS.utility.contenteditable.clear(TS.client.ui.$msg_input,true);if(!TS.utility.contenteditable.supportsTexty())TS.client.ui.$msg_input.trigger("autosize").trigger("autosize-resize");TS.utility.contenteditable.disable(TS.client.ui.$msg_input);n=$("#msg_input_message span");if(i.is_group)if(TS.boot_data.feature_teams_to_workspaces)n.html(TS.i18n.t("Your Workspace Owners have limited who can post to {channel_or_group}","view")({channel_or_group:'<ts-icon class="ts_icon_lock prefix"></ts-icon>'+i.name+'<ts-icon class="ts_icon_shared_channel"></ts-icon>'}));else n.html(TS.i18n.t("Your Team Owners have limited who can post to {channel_or_group}","view")({channel_or_group:'<ts-icon class="ts_icon_lock prefix"></ts-icon>'+i.name+'<ts-icon class="ts_icon_shared_channel"></ts-icon>'}));else if(TS.boot_data.feature_teams_to_workspaces)n.html(TS.i18n.t("Your Workspace Owners have limited who can post to {channel_or_group}","view")({channel_or_group:"#<strong>"+i.name+'<ts-icon class="ts_icon_shared_channel"></ts-icon></strong>'}));else n.html(TS.i18n.t("Your Team Owners have limited who can post to {channel_or_group}","view")({channel_or_group:"#<strong>"+i.name+'<ts-icon class="ts_icon_shared_channel"></ts-icon></strong>'}));TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")}else if(i&&i._checking_at_channel_status){TS.utility.contenteditable.clear(TS.client.ui.$msg_input,true);TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,TS.i18n.t("Sending...","view")());TS.utility.contenteditable.disable(TS.client.ui.$msg_input)}else{TS.utility.contenteditable.enable(TS.client.ui.$msg_input);if(!t){TS.utility.contenteditable.clear(TS.client.ui.$msg_input,true);TS.client.msg_input.populateWithLast()}TS.client.msg_input.setPlaceholder()}},userGroupUpdated:function e(t){if(r)TS.view.maybeRebuildUserGroupList();if(t&&TS.model.previewed_user_group_id===t){var i=TS.user_groups.getUserGroupsById(t);if(i&&-1===i.date_delete){TS.model.previewed_user_group_id="";if("team"===TS.model.ui_state.flex_name)$("#back_from_user_group_preview").trigger("click");return}TS.client.ui.previewUserGroup(t)}if(TS.client&&TS.client.msg_pane){var n=TS.shared.getActiveModelOb();if(!n||!n.msgs)return;var a="<!subteam^"+t;_.each(n.msgs,function(e){if(e.text&&-1!==e.text.indexOf(a))TS.view.rebuildMsg(e)})}},maybeRebuildUserGroupList:_.noop,rebuildUserGroupList:function e(t){var i="user_groups_flexpane_rebuild";var n="start_user_groups_flexpane_rebuild";TS.metrics.mark(n);if(!t)t=TS.model.user_groups.concat();var a=TS.client.ui.user_groups.getUserGroupQuery();if(void 0!==a&&null!==a&&a.length){a=a.toLowerCase();t=t.filter(function(e){return!e.date_delete&&(-1!==e.handle.indexOf(a)||-1!==e._name_lc.indexOf(a)||e.description&&-1!==e.description.toLowerCase().indexOf(a))})}else{a=null;t=t.filter(function(e){return!e.date_delete})}var r=$("#user_groups_list");if(t.length){r.empty();var s=97;var o=$('<div id="user_groups_list_wrapper">');r.append(o);o.longListView({items:t,approx_item_height:s,preserve_dom_order:true,scrollable:$("#user_group_list_scroller"),makeElement:function e(){return $('<div style="width:100%">')},renderItem:function e(t,i){var n=TS.templates.builders.buildUserGroupHTML(i,true);t.html(n)},calcItemHeight:function e(t){var i=t.outerHeight();if(!i)return s;return i}});if("groups"!==TS.model.ui_state.flex_name)o.longListView("setHidden",true)}else if(a&&TS.model.user_groups.length){var l={query:a,tab:{label:TS.i18n.t("User Groups","view")()}};var d='<div class="no_results top_margin">'+TS.templates.team_list_no_results(l)+"</div>";r.html(d)}else r.html(TS.templates.user_group_tip({is_flexpane:true}));if(TS.utility.enableFeatureForUser(1))TS.metrics.measureAndClear(i,n)},showUnSentControlsForMsg:function e(t,i,n){if(n&&n.error&&"4"==n.error.code){TS.utility.msgs.handleFailedMsgSend(t.ts,i,false);var a={text:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("A Workspace Owner has restricted posting to the {channel_name} channel.","view")({channel_name:"#*"+i.name+"*"}):TS.i18n.t("A Team Owner has restricted posting to the {channel_name} channel.","view")({channel_name:"#*"+i.name+"*"}),ephemeral_type:"general_posting_restricted",slackbot_feels:"sad_surprise"};TS.client.ui.addOrFlashEphemeralBotMsg(a);TS.utility.contenteditable.value(TS.client.ui.$msg_input,t.text);TS.view.focusMessageInput();return}setTimeout(function(){TS.model.display_unsent_msgs[t.ts]=true;if(TS.utility.msgs.isMsgReply(t)){TS.ui.replies.maybeUpdateConversationWithMessage(i,t);TS.client.threads.maybeRerenderMessage(i,t)}else TS.view.rebuildMsg(t)},5e3)},scroll_down_when_msg_from_user_is_added:false,addMsg:function e(t,i){var n=false;var a=TS.shared.getActiveModelOb();if(t.user==TS.model.user.id&&TS.view.scroll_down_when_msg_from_user_is_added){TS.view.scroll_down_when_msg_from_user_is_added=false;n=true}else if(TS.client.ui.areMsgsScrolledToBottom())n=true;var r=TS.utility.msgs.getPrevDisplayedMsg(t.ts,a.msgs);var s=TS.templates.builders.msgs.buildHTML({msg:t,model_ob:a,prev_msg:r,container_id:"msgs_div",enable_slack_action_links:true});var o=TS.client.ui.$msgs_div;var l=TS.client.ui.$msgs_div.find(".day_msgs").last();if(TS.interop.datetime.toCalendarDate(t.ts)===l.attr("data-date"))o=l;else{s='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(t.ts)+'" data-ts="'+t.ts+'">'+s+"</div>";s='<div class="day_container">'+TS.templates.messages_day_divider({ts:t.ts})+s+"</div>"}l=null;o.append(s);o=null;var d=TS.client.msg_pane.getCanonicalDivForMsg(t.ts);if(TS.model.prefs.animate_new_msgs){d.css("opacity","0");d.transition({opacity:1},200)}TS.utility.makeSureAllLinksHaveTargets(d);if(!t.is_pending){TS.client.msg_pane.last_in_stream_msg=t;if(!TS.utility.msgs.isMsgHidden(t))TS.client.msg_pane.last_rendered_msg=t}TS.client.msg_pane.assignLastReadMsgDiv(a);if(n)TS.client.ui.instaScrollMsgsToBottom(false);var c=TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&i<2;if(t.user==TS.model.user.id||c)TS.client.msg_pane.checkUnreads();else TS.client.ui.checkInlineImgsAndIframes("main");TS.client.msg_pane.insertUnreadDivider();TS.attachment_actions.select.decorateNewElements();TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div)},reClassUnreads:function e(t){var i=TS.client.ui.areMsgsScrolledToBottom();TS.client.ui.$msgs_div.children("div.message").each(function(){var e=$(this).data("ts");if(e>t)$(this).addClass("unread");else $(this).removeClass("unread")});if(TS.shared.getActiveModelOb().unread_cnt)TS.client.msg_pane.insertUnreadDivider();if(i)TS.client.ui.instaScrollMsgsToBottom(false)},rebuildMsg:function e(t){if(!t)return;var i=TS.client.msg_pane.getCanonicalDivForMsg(t.ts);if(!i.length)return;var n=TS.shared.getActiveModelOb();var a=TS.client.ui.areMsgsScrolledToBottom();var r;var s;var o;var l;var d=false;var c=false;if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.msgHasReplies(t)||TS.ui.thread.isMessageBeingConvertedToThread(n.id,t)){o=TS.ui.thread.makeInlineThread(n.id,t.thread_ts||t.ts);if(!i.closest("ts-thread").length){r=TS.ui.thread.buildThreadHTML(o,{inline:true,expanded:TS.ui.thread.isThreadExpanded(n.id,t.ts)});d=TS.ui.thread.isThreadExpanded(n.id,t.ts)}else r=TS.templates.builders.buildThreadMsgHTML(t,n,o,{inline:true})}else{s=TS.utility.msgs.getPrevDisplayedMsg(t.ts,n.msgs);r=TS.templates.builders.msgs.buildHTML({msg:t,model_ob:n,prev_msg:s,container_id:"msgs_div",enable_slack_action_links:true});l=i.closest("ts-thread");if(l.length&&l.attr("data-thread-ts")===t.ts)c=true}else{s=TS.utility.msgs.getPrevDisplayedMsg(t.ts,n.msgs);r=TS.templates.builders.msgs.buildHTML({msg:t,model_ob:n,prev_msg:s,container_id:"msgs_div",enable_slack_action_links:true})}TS.client.msg_pane.cleanMsgDiv(i);var _=i.hasClass("hidden");if(c)l.replaceWith(r);else i.replaceWith(r);i=TS.client.msg_pane.getCanonicalDivForMsg(t.ts);if(_)i.addClass("hidden");if(d)TS.ui.thread.renderReplyInput(i.closest("ts-thread"),o);TS.utility.makeSureAllLinksHaveTargets(i);if(a)TS.client.ui.instaScrollMsgsToBottom(true);TS.client.ui.checkInlineImgsAndIframes("main");TS.attachment_actions.select.decorateNewElements()},rebuildMsgsIncludingMember:function e(t){var i=TS.shared.getActiveModelOb();if(!i)return;_.each(i.msgs,function(e){if(TS.utility.msgs.messageIncludesMember(t,e)){if(TS.has_pri[l])TS.log(l,"memberChangedProfile: Rebuilding msg "+e.ts+" because it includes member "+t.id);TS.view.rebuildMsg(e)}})},rebuildMsgCurrentStatusIncludingMember:function e(t){var i=TS.shared.getActiveModelOb();var n={member:t,for_message:true};_.each(i.msgs,function(e){if(TS.utility.msgs.memberSentMessage(t,e)){var i=TS.client.msg_pane.getCanonicalDivForMsg(e.ts).find(".message_current_status");i.replaceWith(TS.templates.current_status(n))}})},rebuildMsgFile:function e(t,i,n){if(!t||!i)return;var a=n?TS.client.msg_pane.getDivForArchiveMsg(t.ts):TS.client.msg_pane.getCanonicalDivForMsg(t.ts);a=a.length?a:TS.client.msg_pane.getDivForArchiveMsg(t.ts);if(!a.length)return TS.warn("Trying to rebuild message file, but invalid message");var r=a.find(".file_container");var s=TS.files.getFileActions(i);s.file=i;s.is_message=true;s.msg_dom_id=a.attr("id");s.new_window=!s.edit;s.download=!("snippet"===i.mode||"post"===i.mode||"space"===i.mode);$.extend(s,TS.files.getFileTemplateArguments(i));if("post"===i.mode||"space"===i.mode)r.replaceWith(TS.templates.file_post(s));else if("snippet"===i.mode){var o=$(TS.templates.file_snippet(s));o=o.filter(".file_container");r.replaceWith(o)}else if("email"===i.mode)r.replaceWith(TS.templates.file_email(s));else if("arugula"===i.mode)r.replaceWith(TS.templates.file_arugula(s));else return TS.warn("Trying to rebuild message file, but cannot rebuild "+i.mode);TS.utility.makeSureAllLinksHaveTargets(a);if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(a)},showInterstitialAfterChannelOrImShown:function e(){var t=TS.channels.getChannelById(TS.model.active_channel_id);var i=TS.groups.getGroupById(TS.model.active_group_id);var n=false;if(t&&t.needs_created_message)if(TS.model.prefs.no_created_overlays)t.needs_created_message=false;else{n=true;TS.view.overlay.startWithCreatedChannel(t)}else if(t&&t.needs_invited_message&&TS.shared.isModelObShared(t))TS.view.overlay.startWithJoinedSharedChannel(t);else if(t&&t.needs_invited_message)if(TS.model.prefs.no_joined_overlays)t.needs_invited_message=false;else{n=true;TS.view.overlay.startWithInvitedChannel(t)}else if(t&&t.needs_joined_message)if(TS.model.prefs.no_joined_overlays)t.needs_joined_message=false;else{n=true;TS.view.overlay.startWithJoinedChannel(t)}else if(i&&i.needs_invited_message)if(TS.model.prefs.no_joined_overlays)i.needs_invited_message=false;else{n=true;TS.view.overlay.startWithInvitedGroup(i)}else if(i&&i.needs_created_message)if(TS.model.prefs.no_created_overlays)i.needs_created_message=false;else{n=true;TS.view.overlay.startWithCreatedGroup(i)}if(!n)TS.view.overlay.fadeInAndOut()},toggleStarsError:function e(t){$("#member_stars_more").toggleClass("hidden",t);$("#member_stars_error").toggleClass("hidden",!t)},rebuildStars:function e(t){if(!t&&"stars"!==TS.model.ui_state.flex_name)return;var i=TS.model.user;var n="";var a=$("#member_stars_list");var r=$("#member_stars_explanation");var s=$("#stars_scroller");var o=$("#member_stars_more");TS.view.cleanStars();if(i.stars&&i.stars.length)TS.model.user.stars.forEach(function(e){n+=TS.templates.builders.buildStarredItemHTML(e)});if(n){a.html(n);TS.view.member_stars_list_lazyload=a.find(".lazy").lazyload({container:s});TS.utility.makeSureAllLinksHaveTargets(a);r.addClass("hidden");if(TS.stars.has_more)o.css("visibility","visible");else o.css("visibility","hidden")}else{a.html("");r.removeClass("hidden");o.css("visibility","hidden")}s.trigger("resize")},cleanStars:function e(){if(TS.view.member_stars_list_lazyload&&TS.view.member_stars_list_lazyload.detachEvents){TS.view.member_stars_list_lazyload.detachEvents();TS.view.member_stars_list_lazyload=null}$("#member_stars_list").empty()},mentionChanged:function e(t){TS.warn("mentionChanged:"+t.message.ts);var i=$("#member_mentions").find("#"+TS.templates.makeMsgDomId(t.message.ts));if(!i.length)return TS.view.rebuildMentions();var n=TS.templates.builders.buildMentionHTML(t);if(!n)return TS.view.rebuildMentions();i.replaceWith(n)},mentionRemoved:function e(t){TS.warn("mentionRemoved:"+t);var i=$("#member_mentions").find("#"+TS.templates.makeMsgDomId(t));if(!i.length)return;var n=function e(){TS.view.rebuildMentions()};i.addClass("delete_mode").slideUp(200,n)},mentionsFetched:function e(){TS.view.rebuildMentions();if($("#member_mentions_more_btn").data("ladda"))$("#member_mentions_more_btn").data("ladda").stop()},rebuildMentions:function e(t){if(!t&&"mentions"!==TS.model.ui_state.flex_name)return;$("#mentions_spinner").empty();TS.view.prefs.rebuildMentionOptions();var i=$("#member_mentions_more_btn");if(void 0===i.data("ladda")){i.data("ladda",Ladda.create(document.querySelector("#member_mentions_more_btn")));i.bind("click.fetchMoreMentions",function(){TS.mentions.fetchMoreMentions();$(this).data("ladda").start()})}$("#exclude_at_channels").unbind("change.toggle_exclude_at_channels").bind("change.toggle_exclude_at_channels",function(){var e=$(this).is(":checked");TS.mentions.setExcludeAtChannelsPref(!e)});$("#exclude_at_user_groups").unbind("change.toggle_exclude_at_user_groups").bind("change.toggle_exclude_at_user_groups",function(){var e=$(this).is(":checked");TS.mentions.setExcludeAtUserGroupsPref(!e)});var n=TS.templates.builders.buildMentions();if(n){$("#member_mentions").html(n);TS.utility.makeSureAllLinksHaveTargets($("#member_mentions"));$("#member_mentions_explanation").addClass("hidden");if(TS.mentions.has_more)$("#member_mentions_more").css("visibility","visible");else TS.view.hideMentionsMoreButton()}else{$("#member_mentions").html("");$("#member_mentions_explanation").toggleClass("hidden","replies"===TS.mentions.active_tab);$("#member_mentions_more").css("visibility","hidden")}TS.view.resize()},rebuildMentionsLoading:function e(){$("#member_mentions").html(TS.templates.builders.loadingHTML())},hideMentionsMoreButton:function e(){$("#member_mentions_more").css("visibility","hidden")},cleanMentions:function e(){$("#member_mentions").empty()},mentionsBeingFetched:function e(t){if(!t)return;$("#mentions_spinner").html(TS.templates.loading_indicator())},loggedIn:function e(){r=true;TS.templates.makeSidebarBehaviorRule();TS.ui.setThemeClasses(true);var t=TS.shared.getActiveModelOb();var i=true;if(!TS.isPartiallyBooted()&&t.is_group)TS.client.ui.rebuildAllButMsgs(i);else{TS.client.ui.rebuildAll(i);if(TS.boot_data.feature_initial_scroll_position)TS.client.msg_pane.setInitialScrollPosition(-1)}if(TS.useReactMessages()){var n=t.msgs;if(n&&n.length){var s=true;var o=true;TS.redux.messages.addMessages(n,s,o)}TS.redux.dispatch(TS.interop.redux.features.messagePane.switchToChannel({channelId:t.id}))}TS.view.focusMessageInput();new TS.PresenceList(TS.model.user.id);a();if(!TS.utility.contenteditable.supportsTexty())TS.client.msg_input.populateWithLast();TS.client.ui.rebuildMemberListToggle();TS.view.members.updateUserDisplayName();TS.view.members.updateUserCurrentStatus();TS.view.showProperTeamPaneFiller();var l={full_profile_filter:true,is_long_list_view:false,include_bots:true,include_deleted:false};TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",l);TS.client.channel_pane.$scroller.css("visibility","visible");TS.view.showInterstitialAfterChannelOrImShown();TS.view.prefs.toggleSpellcheck();if(TS.members.shouldDisplayRealNames())$("#col_channels").addClass("real_names");else $("#col_channels").removeClass("real_names");if(!TS.model.is_iOS)if(TS.ui.growls.no_notifications&&"1"!=window.readCookie("no_growl_prompt")){$("#growl_prompt_div").removeClass("hidden");$("#growl_prompt_a").bind("click",function(){TS.view.overlay.startWithGrowlPromptDisplay()})}else if(TS.ui.growls.shouldShowPermissionButton()&&"denied"!==TS.ui.growls.getPermissionLevel()&&"1"!=window.readCookie("no_growl_prompt")){$("#growl_prompt_div").removeClass("hidden");$("#growl_prompt_a").bind("click",function(){TS.view.overlay.startWithGrowlPromptDisplay()})}if(TS.model.is_FF)TS.client.ui.$msgs_scroller_div.removeAttr("tabindex");if(TS.boot_data.feature_tinyspeck);if(!TS.model.unread_view_is_showing&&!TS.model.threads_view_is_showing)if(TS.shared.getActiveModelOb().is_channel&&!TS.shared.getActiveModelOb().is_member||TS.ims.isImWithDeletedMember(TS.shared.getActiveModelOb()))TS.client.archives.start()},showProperTeamPaneFiller:function e(){var t=TS.members.getActiveMembersWithSelfAndSlackbot().length;var i=4;if(TS.model.user.is_admin){$("#team_block").removeClass("hidden");if(t>i){$("#team_block_admin_invite_few").addClass("hidden");$("#team_block_admin_invite_many").removeClass("hidden")}else{$("#team_block_admin_invite_few").removeClass("hidden");$("#team_block_admin_invite_many").addClass("hidden")}}if(t>i)$("#team_block_description").addClass("hidden");else{$("#team_block").removeClass("hidden");$("#team_block_description").removeClass("hidden")}if(TS.model.team.email_domain){var n=TS.model.team.email_domain.split(",");if(1==n.length)$("#team_block_email_domains").html("<b>@"+_.escape(TS.model.team.email_domain)+"</b>");else{var a=_.escape(n.pop());var r=n.join("</b>, <b>@")+"</b> "+TS.i18n.t("or","view")()+" <b>@"+_.escape(a)+"</b>";$("#team_block_email_domains").html("<b>@"+r)}$("#team_block").removeClass("hidden");$("#team_block_email_on").removeClass("hidden");$("#team_block_admin_email_off").addClass("hidden")}else{$("#team_block_email_on").addClass("hidden");if(TS.model.user.is_owner){$("#team_block").removeClass("hidden");$("#team_block_admin_email_off").removeClass("hidden")}}if(!TS.model.user.profile||!TS.model.user.profile.phone||!TS.model.user.profile.real_name){$("#team_block").removeClass("hidden");$("#team_block_fill_prompt").removeClass("hidden")}else $("#team_block_fill_prompt").addClass("hidden")},current_unread_status:null,changeUnreadStatus:function e(t){TS.view.current_unread_status=t;TS.view.maybeChangeFavIco();TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()},maybeChangeFavIco:function e(){var t=TS.view.ms.current_connection_status;var i=TS.view.current_unread_status;var n;if("online"===t)n="app_icon_32px_green";else if("trouble"===t)n="app_icon_32px_yellow";else n="app_icon_32px_red";if("unreads"===i)n+="_unreads";else if("mentions"===i)n+="_mentions";var a=TS.model.data_urls[n];var r=$("#favicon");if(r.attr("href")!=a)r.replaceWith('<link id="favicon" rel="shortcut icon" href="'+a+'" sizes="16x16 32x32 48x48" type="image/png" />')},windowUnloaded:function e(){if(!TS.model.mac_ssb_version||TS.model.mac_ssb_version>=.32){$("BODY").addClass("loading");$("#connection_div").html("").addClass("hidden");TS.client.msg_pane.topMessagesBannerHidden()}},buildMemberPresenceStatusHTML:function e(t){var i="";i+='<span class="'+TS.templates.makeMemberStatusDomClass(t.id)+'">';if(t.status)i+=' - "'+t.status+'"';i+="</span>";return i},last_team_list_html:null,large_team_directory_trigger:2e3,rebuildTeamMember:function e(t){if(!TS.model.ui_state.flex_visible||"team"!==TS.model.ui_state.flex_name)return;if(!t||!t.id)return;var i='#team_list .team_list_item[data-member-id="'+t.id+'"]';var n=$(i);if(n.length){if(TS.view.members_list_lazyload){TS.view.members_list_lazyload.detachEvents();TS.view.members_list_lazyload=null}n.replaceWith(TS.templates.team_list_item({member:t}));n=$(i);if(!n.length)TS.error("Unable to find node at selector "+i);var a=$("#team_list_scroller");var r=$("#team_list_members");var s=r.find(".lazy");TS.view.members_list_lazyload=s.lazyload({container:a,ignore_when_hidden_element:r,all_images_same_size:true});TS.utility.makeSureAllLinksHaveTargets(n);TS.view.updateTeamListCache()}},clearTeamListCache:function e(){TS.view.last_team_list_html=null},updateTeamListCache:function e(){if(TS.view.last_team_list_html)TS.view.last_team_list_html=$("#team_list_members_wrapper").html()},refilterTeamList:function e(){if(!TS.model.ui_state.flex_visible||"team"!==TS.model.ui_state.flex_name)return;var t=$("#team_list_container input.member_filter");var i=TS.storage.fetchFilterState();if("string"!==typeof i)i="";if(i){t.val(i);$("#team_list_container .icon_close").toggleClass("hidden",!i);TS.members.view.filterTeam(i,"#team_filter","#team_list_scroller",true)}},buildLongListTeamListItems:function e(t,i){var n=t.members;var a=t.disabled_members;var r=t.deleted_bots;var s=t.bots;var o=t.restricted_members;var l=t.ultra_restricted_members;var d=t.admin_members;var c=n.slice(0);if(s.length){if(!i)c.push({bot:true,is_divider:true});c.push.apply(c,s)}var _=[];if(o.length){if(!i)_.push({multi_channel_guest:true,is_divider:true});_.push.apply(_,o)}if(l.length){if(!i)_.push({single_channel_guest:true,restricted_members:!!o.length,is_divider:true});_.push.apply(_,l)}var u=a.slice(0);if(r.length){if(!i)u.push({deleted_bot:true,is_divider:true});u.push.apply(u,r)}var m=[];if(d&&d.length)m=d;return{active_members_list_items:c,restricted_members_list_items:_,deleted_members_list_items:u,admin_members_list_items:m}},cleanTeamList:function e(t){if(TS.view.members_list_lazyload&&TS.view.members_list_lazyload.detachEvents){TS.view.members_list_lazyload.detachEvents();TS.view.members_list_lazyload=null}var i=$("#team_list_members");i.off("click.toggle_list_item");i.off("click.member_preview_menu");if(t)i.remove();i=null},triggerInitialTeamListLazyLoad:function e(){TS.ui.utility.updateClosestMonkeyScroller($("#team_list_members"));$("#team_list_scroller").trigger("resize-immediate")},maybeFollowLink:function e(t){if(!TS.utility.isSpaceClickEventSafe(t))return true;if(!t.metaKey&&!t.ctrlKey)return false;var i=$(t.target);var n=i.closest("a[href]");if(n.length&&document.hasFocus())return true;return false},markAllUnread:function e(){TS.model.last_reads_set_by_client={};function t(e){var t=TS.utility.msgs.getDisplayedMsgs(e.msgs);if(!t.length)return;var i=t[t.length-1];if(!i)return;if(e.is_channel)TS.channels.markReadMsg(e.id,i.ts);else if(e.is_im)TS.ims.markReadMsg(e.id,i.ts);else if(e.is_group)TS.groups.markReadMsg(e.id,i.ts);else{TS.warn("markIt "+e.id+"????");return}TS.info("markIt "+e.id+" "+i.ts)}_.forOwn(TS.model.channels,function(e){if(e.is_archived)return;if(!e.is_member)return;t(e)});_.forOwn(TS.model.ims,function(e){if(!e.is_open)return;t(e)});_.forOwn(TS.model.groups,function(e){if(e.is_archived)return;t(e)});TS.model.client.reads.length=0;TS.client.markLastReadsWithAPI();TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();TS.client.msg_pane.insertUnreadDivider();TS.client.msg_pane.dont_check_unreads_til_switch=true},onGroupReferenceClick:function e(t,i){var n=TS.groups.getGroupById(i);if(!n)return;if(n.is_archived&&!n.was_archived_this_session){t.preventDefault();TS.groups.displayGroup({id:n.id})}else{t.preventDefault();TS.groups.displayGroup({id:n.id})}},onChannelReferenceClick:function e(t,i){var n=TS.channels.getChannelById(i);if(!n)return;t.preventDefault();TS.channels.displayChannel({id:n.id})},onMemberReferenceClick:function e(t,i){var n;if(TS.interop.utility.looksLikeMemberId(i))n=TS.members.getMemberById(i)||TS.members.getMemberByName(i);else n=TS.members.getMemberByName(i);if(!n)return;TS.menu.member.startWithMember(t,n.id)},onUserGroupReferenceClick:function e(t,i){var n=TS.user_groups.getUserGroupsById(i);if(!n)return;TS.client.ui.previewUserGroup(n.id)},adjustForWelcomeSlideShow:function e(){if(TS.model.cancelled_welcome_2_this_session)return;TS.model.showing_welcome_2=true;$(".messages_banner").css("visibility","hidden");TS.view.makeMsgsDivUnscrollable()},msgs_unscrollable:false,makeMsgsDivUnscrollable:function e(){TS.view.msgs_unscrollable=true;TS.client.ui.$msgs_scroller_div.css("overflow-y","hidden").css("height","100%");$("#monkey_scroll_wrapper_for_msgs_scroller_div").find(".monkey_scroll_bar").css("visibility","hidden");TS.client.ui.$msgs_scroller_div.scrollTop(0);TS.client.ui.$msgs_div.css("visibility","hidden");$("#footer").addClass("hidden")},unAdjustForWelcomeSlideShow:function e(t){if(!TS.model.showing_welcome_2){TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div);return}TS.model.showing_welcome_2=false;$(".messages_banner").css("visibility","");if(TS.model.seen_onboarding_this_session&&TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id)$("#messages_unread_status").css("visibility","hidden");else $("#messages_unread_status").css("visibility","");if(TS.view.makeMsgsDivScrollable()){TS.view.resizeManually("ran TS.view.makeMsgsDivScrollable()",true);if(t)TS.client.ui.$msgs_scroller_div.scrollTop(0)}else TS.view.resizeManually("NOT ran TS.view.makeMsgsDivScrollable()",true)},makeMsgsDivScrollable:function e(){if(!TS.view.msgs_unscrollable)return false;TS.view.msgs_unscrollable=false;TS.client.ui.$msgs_scroller_div.css("overflow-y","auto").css("height","");$("#monkey_scroll_wrapper_for_msgs_scroller_div").find(".monkey_scroll_bar").css("visibility","");TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div);TS.client.ui.$msgs_div.css("visibility","visible");$("#footer").removeClass("hidden");return true},submit:function e(){var t=TS.utility.contenteditable.value(TS.client.ui.$msg_input);if(!TS.model.ms_connected&&"/wakewake"!==t)return false;TS.client.ui.onSubmit(t);return true},focusMessageInput:function e(){var t=TS.ims.getImById(TS.model.active_im_id);var i=TS.shared.getActiveModelOb();if(!i)return;if(t&&TS.members.getMemberById(t.user).deleted){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"account deactivated");TS.utility.contenteditable.disable(TS.client.ui.$msg_input);return}if(TS.utility.contenteditable.isDisabled(TS.client.ui.$msg_input))return;if(!TS.client.ui.isUserAttentionOnChat())return;if(TS.model.is_iOS)return;var n=TS.model.last_key_down_e;var a=TS.utility.keymap;if(n&&n.altKey&&(n.which==a.down||n.which==a.up))return;TS.utility.contenteditable.focus(TS.client.ui.$msg_input);if(!TS.model.archive_view_is_showing){var r=TS.model.input_cursor_positions[i.id];if(r){TS.utility.setCursorPosition(TS.client.ui.$msg_input,r.start,r.length);delete TS.model.input_cursor_positions[i.id]}else TS.utility.contenteditable.setCursorAtEnd(TS.client.ui.$msg_input)}},clearMessageInput:function e(){TS.client.msg_input.populate("")},updateTitleBarColor:function e(){if(TS.model.is_our_app)TSSSB.call("updateTitleBarColor",TS.utility.rgb2hex($("#team_menu").css("background-color")))},teamPlanChanged:function e(t){TS.model.team.plan=t.plan;TS.model.can_add_ura=t.can_add_ura},teamProfileChanged:function e(){TS.view.refilterTeamList();TS.view.rebuildPreviewedMember()},rebuildPreviewedMember:function e(){if(TS.model.previewed_member_id)TS.client.ui.previewMember(TS.model.previewed_member_id)},displayMsgInModelOb:function e(t,i){if(TS.useReactMessages()){var a=TS.shared.getActiveModelOb();if(a.id===t.id&&!TS.client.activeChannelIsHidden()){TS.redux.dispatch(TS.interop.redux.features.messagePane.jumpToTimestamp(i));return}n=i}if(t.is_channel)TS.channels.displayChannel({id:t.id});else if(t.is_mpim)TS.mpims.displayMpim({id:t.id});else if(t.is_group)TS.groups.displayGroup({id:t.id});else TS.ims.startImById(t.id);if(TS.useReactMessages()){n=null;return}if(t.id!=TS.model.active_cid)return;var r=TS.utility.msgs.getMsg(i,t.msgs);if(r&&!TS.model.archive_view_is_showing)TS.client.ui.scrollMsgsSoMsgIsInView(i,false,true);else TS.client.archives.start(i)},flexpaneDisplaySwitched:function e(t){var i=TS.model.ui_state.flex_name;if(!i||"team"===t&&"team"!==i){TS.view.cleanTeamList(true);return}if("team"!==t&&"team"===i)return;if("mentions"===i)if(TS.mentions.mentions_needs_fetched){var n=true;TS.mentions.maybeUpdateMentions(n)}if("files"===i)TS.client.flex_pane.maybeFetchFileList()},_maybeUpdateOnboarding:function e(){if(TS.model.seen_onboarding_this_session)if(TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id)TS.onboarding.startOnboarding();else TS.onboarding.cancelOnboarding()},addReplyMsg:function e(t,i){if(!TS.ui.thread.isThreadExpanded(t.id,i.thread_ts))return;var n=TS.client.ui.$msgs_div.find('ts-thread[data-thread-ts="'+i.thread_ts+'"]');if(!n.length)return;var a=TS.ui.thread.makeInlineThread(t.id,i.thread_ts);var r=true;TS.ui.thread.updateThreadWithMessage(n,a,i,r)}});var e=null;var t=false;var i=true;var n=null;var a=function e(){TS.view.ms.maybeChangeConnectionDisplay()};var r;var s=function e(t){if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input)){delete TS.model.input_cursor_positions[t];return}var i=TS.utility.getCursorPosition(TS.client.ui.$msg_input);if(i)TS.model.input_cursor_positions[t]=i};var o=389;var l=888})()},4351:function(e,t){(function(){"use strict";TS.registerModule("view.channel",{channel_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function e(){TS.channels.renamed_sig.add(TS.view.channel.channelRenamed,TS.view.channel);TS.channels.switched_sig.add(TS.view.channel.channelSwitched,TS.view.channel);TS.channels.created_sig.add(TS.view.channel.channelCreated,TS.view.channel);TS.channels.deleted_sig.add(TS.view.channel.channelDeleted,TS.view.channel);TS.channels.joined_sig.add(TS.view.channel.channelJoined,TS.view.channel);TS.channels.member_joined_sig.add(TS.view.channel.channelMemberJoined,TS.view.channel);TS.channels.left_sig.add(TS.view.channel.channelLeft,TS.view.channel);TS.channels.member_left_sig.add(TS.view.channel.channelMemberLeft,TS.view.channel);TS.channels.history_fetched_sig.add(TS.view.channel.channelHistoryFetched,TS.view.channel);TS.channels.history_being_fetched_sig.add(TS.view.channel.channelHistoryBeingFetched,TS.view.channel);if(!TS.useReactMessages()){TS.channels.message_received_sig.add(TS.view.channel.channelMessageReceived,TS.view.channel);TS.channels.message_removed_sig.add(TS.view.channel.channelMessageRemoved,TS.view.channel);TS.channels.message_changed_sig.add(TS.view.channel.channelMessageChanged,TS.view.channel)}TS.channels.marked_sig.add(TS.view.channel.channelMarked,TS.view.channel);TS.channels.unread_changed_sig.add(TS.view.channel.channelUnreadCountChanged,TS.view.channel);TS.channels.unread_highlight_changed_sig.add(TS.view.channel.channelUnreadHighlightCountChanged,TS.view.channel);TS.channels.topic_changed_sig.add(TS.view.channel.channelTopicChanged,TS.view.channel);TS.channels.purpose_changed_sig.add(TS.view.channel.channelPurposeChanged,TS.view.channel);TS.channels.archived_sig.add(TS.view.channel.channelArchived,TS.view.channel);TS.channels.unarchived_sig.add(TS.view.channel.channelUnArchived,TS.view.channel);TS.channels.msg_not_sent_sig.add(TS.view.channel.channelMsgNotsent,TS.view.channel)},channelRenamed:function e(){var t=false;TS.client.ui.rebuildAll(t);TS.view.updateTitleWithContext()},channelSwitched:function e(){TS.view._maybeUpdateOnboarding();TS.view.switchedHelper();TS.view.updateTitleWithContext();TS.view.updateTypingText()},channelCreated:function e(){TS.client.channel_pane.rebuild("channels","starred")},channelDeleted:function e(){TS.client.channel_pane.rebuild("channels","starred")},channelJoined:function e(){TS.client.channel_pane.rebuild("channels","starred")},channelMemberJoined:function e(t){if(t.id!=TS.model.active_channel_id)return;TS.client.msg_pane.rebuildChannelMembersList();if(t.needs_created_message)TS.view.overlay.startWithCreatedChannel(t)},channelLeft:function e(){TS.client.channel_pane.rebuild("channels","starred")},channelMemberLeft:function e(t){if(t.id!=TS.model.active_channel_id)return;TS.client.msg_pane.rebuildChannelMembersList()},channelHistoryFetched:function e(t){if(t.id!=TS.model.active_channel_id)return;TS.client.ui.afterHistoryFetch(t)},channelHistoryBeingFetched:function e(t){if(t.id!=TS.model.active_channel_id)return;TS.client.msg_pane.updateEndMarker();t=TS.channels.getChannelById(TS.model.active_channel_id);if(!t||!t.msgs.length)return;if(TS.model.ms_connected)if(t.history_changed)TS.model.ui.last_top_msg=null;else{var i=TS.utility.msgs.getDisplayedMsgs(t.msgs);TS.model.ui.last_top_msg=i[i.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")},channelMessageReceived:function e(t,i){if(t.id!=TS.model.active_channel_id)return;if(!i){TS.error("no msg?");return}if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.isMsgReply(i)){TS.view.addReplyMsg(t,i);return}if(TS.utility.msgs.isMsgHidden(i))return;var n=_.reject(t.msgs,TS.utility.msgs.isMsgHidden);var a=n;var r=a.length>1&&TS.utility.msgs.msgMightBeRolledUp(i)&&TS.utility.msgs.msgMightBeRolledUp(a[1]);if(r||1==a.length||a[0]!=i){var s=true;TS.client.msg_pane.rebuildMsgsWithReason("channelMessageReceived",s)}else{TS.view.addMsg(i,t.unread_cnt);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearUnreadDivider(t,i)}TS.view.channel.channel_ui_updated_with_new_msg_sig.dispatch(i)},channelMessageRemoved:function e(t,i){if(t.id!=TS.model.active_channel_id)return;if(!i){TS.error("no msg?");return}TS.view.removeMsg(t,i)},channelMessageChanged:function e(t,i,n){if(t.id!=TS.model.active_channel_id)return;setTimeout(function(){if(TS.boot_data.feature_new_broadcast&&_.includes(n,"_hidden_reply")){if(i._hidden_reply&&_.includes(n,"subtype"))TS.view.channel.channelMessageRemoved(t,i);else if(!i._hidden_reply&&"thread_broadcast"===i.subtype)TS.view.channel.channelMessageReceived(t,i)}else TS.view.rebuildMsg(i,n)},0)},channelMarked:function e(t){if(t.id!=TS.model.active_channel_id)return;TS.client.msg_pane.assignLastReadMsgDiv(t);TS.view.reClassUnreads(t.last_read)},channelUnreadCountChanged:function e(t){if(TS.useReactMessages())return;if(!t)return;var i="."+TS.templates.makeChannelDomId(t);var n=$(i);if(0===t.unread_cnt)n.removeClass("unread mention");else{if(!TS.notifs.isCorGMuted(t.id))n.addClass("unread");if(t.unread_highlight_cnt>0)n.addClass("mention")}if(t._show_in_list_even_though_no_unreads)n.addClass("show_in_list_even_though_no_unreads");else n.removeClass("show_in_list_even_though_no_unreads");var a=n.find(".channel_name");if(a.length)a.attr("aria-label",TS.templates.builders.makeChannelLinkAriaLabelSafe(t));i="."+TS.templates.makeUnreadMsgsDomId(t);var r=$(i);if(0===t.unread_cnt)r.html(t.unread_cnt).addClass("hidden");else if(t.unread_cnt<10)r.html(t.unread_cnt).removeClass("hidden");else r.html("9+").removeClass("hidden");TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads();TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(t);TS.client.msg_pane.maybeResetAndAutoScroll(t)},channelUnreadHighlightCountChanged:function e(t){if(TS.useReactMessages())return;if(!t)return;var i="."+TS.templates.makeUnreadHighlightDomId(t);if(0===t.unread_highlight_cnt)$(i).html(t.unread_highlight_cnt).addClass("hidden");else if(t.unread_highlight_cnt<10)$(i).html(t.unread_highlight_cnt).removeClass("hidden");else $(i).html("9+").removeClass("hidden")},channelTopicChanged:function e(t){if(!t)return;if(t.id!=TS.model.active_channel_id)return;TS.client.msg_pane.updateEndMarker()},channelPurposeChanged:function e(t){if(!t)return;if(t.id!=TS.model.active_channel_id)return;TS.client.msg_pane.updateEndMarker()},channelArchived:function e(t){TS.client.channel_pane.rebuild("channels","starred");TS.client.msg_pane.rebuildChannelMembersList();if(t.id!=TS.model.active_channel_id)return;TS.client.archives.start()},channelUnArchived:function e(t){TS.client.channel_pane.rebuild("channels","starred");if(t.id!=TS.model.active_channel_id)return;TS.client.msg_pane.rebuildChannelMembersList();TS.client.msg_pane.rebuildMsgsWithReason("channelUnArchived")},channelMsgNotsent:function e(t,i,n){if(t.id!=TS.model.active_channel_id)return;TS.view.showUnSentControlsForMsg(i,t,n)}})})()},4352:function(e,t){(function(){"use strict";TS.registerModule("view.dnd",{onStart:function e(){TS.dnd.dnd_statuses_changed_sig.add(TS.view.dnd.dndStatusesChanged,TS.view.dnd);TS.dnd.current_user_dnd_status_changed_sig.add(TS.view.dnd.currentUserDndStatusChanged,TS.view.dnd)},dndStatusesChanged:function e(t){if(!t||!t.length)return;var i=$(".presence[data-member-presence]");var n={};i.each(function(){var e=$(this);var t=e.attr("data-member-presence");if(!n[t])n[t]=[];n[t].push(e)});var a=0;t.forEach(function(e){var t=n[e.id];if(!t)return;t.forEach(function(t){a+=1;var i=TS.templates.makeMemberPresenceStateClass(e);t.removeClass("away active dnd").addClass(i);var n=TS.ims.getImByMemberId(e.id);if(n)t.closest(".im_name").attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:e,im:n}))})});if(TS.has_pri[2002])TS.log(2002,"dndStatusesChanged updated "+a+" out of "+i.length+" presence icons")},currentUserDndStatusChanged:function e(){if(TS.model.ms_connected)TS.view.ms.maybeChangeConnectionDisplay();var t=$("#team_menu").find(".notifications_menu_btn");if(TS.dnd.isMemberInDnd(TS.model.user))t.removeClass("ts_icon_bell_o").addClass("ts_icon_snooze_outline");else t.removeClass("ts_icon_snooze_outline").addClass("ts_icon_bell_o")}})})()},4353:function(e,t){(function(){"use strict";TS.registerModule("view.files",{onStart:function e(){TS.files.team_file_added_sig.add(TS.view.files.teamAdded,TS.view.files);TS.files.team_file_deleted_sig.add(TS.view.files.teamDeleted,TS.view.files);TS.files.team_file_changed_sig.add(TS.view.files.teamChanged,TS.view.files);TS.files.file_uploaded_sig.add(TS.view.files.uploaded,TS.view.files);TS.files.file_uploading_sig.add(TS.view.files.uploading,TS.view.files);TS.files.file_progress_sig.add(TS.view.files.progress,TS.view.files);TS.files.file_canceled_sig.add(TS.view.files.canceled,TS.view.files);TS.files.file_queue_emptied_sig.add(TS.view.files.queueEmptied,TS.view.files)},teamAdded:function e(t){if(!t.is_deleted&&TS.view.files.shouldAppearInlist(t))TS.view.files.throttledRebuildList()},teamDeleted:function e(t){if(TS.view.files.shouldAppearInlist(t))TS.view.files.throttledRebuildList()},teamChanged:function e(t){if(!t.is_deleted&&TS.view.files.shouldAppearInlist(t))TS.view.files.singleListItemChanged(t);var i=TS.shared.getActiveModelOb();if(i)TS.utility.msgs.updateFileMsgs(i,t)},uploaded:function e(t,i){$("#file_progress").queue(function(e){if(t){$(this).removeClass("loaded").find(".progress_bar").addClass("seafoam_green_bg no_transition").end().find(".progress_bar_progress_animated_thin").addClass("no_transition progress_bar_progress_thin progress_bar_progress_striped").removeClass("progress_bar_progress_animated_thin").attr("data-label-left",TS.i18n.t("Processing uploaded file… complete!","files")()).css({width:"0%"}).end();if(TS.model.ui_state.flex_visible){var n=TS.files.getFileById(i);if(n&&("snippet"===n.mode||"post"===n.mode))TS.client.ui.files.previewFile(n.id,"file_list")}}e()}).delay(1e3)},uploading:function e(t,i,n){var a="";if(n)a+='<a id="cancel_upload_in_progress" class="float_right very_small_right_margin">'+TS.i18n.t("cancel","files")()+"</a>";var r="";if(i)r=TS.i18n.t("Re-uploading {filename}","files")({filename:t});else r=TS.i18n.t("Uploading {filename}","files")({filename:t});$("#file_progress").queue(function(e){$(this).toggleClass("is_cancelable",!!n).removeClass("hidden loaded").find(".progress_bar").removeClass("candy_red_bg seafoam_green_bg").end().find(".progress_bar_progress_thin").removeClass("no_transition").data("label-left-original",r).attr("data-label-left",r).end().find("#progress_text").html(a).find("#cancel_upload_in_progress").click(TS.files.cancelCurrentUpload);e();TS.client.msg_pane.topMessagesBannerShown()}).fadeIn(200)},progress:function e(t){$("#file_progress").queue(function(e){$(this).find(".progress_bar.no_transition").removeClass("no_transition");var i=$(".progress_bar_progress_thin");var n="";if(TS.files.uploadQ.length)n=TS.i18n.t("(1 of {total})","files")({total:TS.files.uploadQ.length+1});if(t<99){var a=i.data("label-left-original")+"…"+t+"% "+n;i.css({width:t+"%"}).attr("data-label-left",a)}else $("#file_progress").addClass("loaded").find(".progress_bar_progress_thin").removeClass("progress_bar_progress_thin progress_bar_progress_striped").addClass("progress_bar_progress_animated_thin").css({width:"100%"}).attr("data-label-left",TS.i18n.t("Processing uploaded file…","files")()+" "+n).end().find("#cancel_upload_in_progress").remove().end();e()})},canceled:function e(t){$("#file_progress").queue(function(e){$(this).removeClass("loaded").find(".progress_bar").addClass("candy_red_bg").end().find(".progress_bar_progress_thin").addClass("no_transition progress_bar_progress_striped").css({width:"0%"}).attr("data-label-left","").end().find("#progress_text").html(TS.i18n.t('Canceling <strong class="filename">{filename}</strong>…',"files")({filename:_.escape(t)})).end().find("#cancel_upload_in_progress").remove().end();e()}).delay(1e3)},queueEmptied:function e(){$("#file_progress").fadeOut(200,function(){TS.client.msg_pane.topMessagesBannerHidden()})},throttledRebuildList:function e(){TS.utility.throttle.method(TS.view.files.maybeRebuildList,"file_list_rebuild",1e3)},maybeRebuildList:function e(){if(!TS.model.ui_state.flex_visible||TS.model.ui_state.flex_name&&"files"!==TS.model.ui_state.flex_name||!TS.model.ui_state.flex_name&&"files"!==TS.model.default_flex_name)return;TS.view.files.rebuildList()},last_files_html:"",rebuildList:function t(){TS.metrics.mark("start_file_flexpane_rebuild");var i=$("#file_list");var n=$("#file_list_block");var a=i.data("list");var r=TS.model.files;var s;var o="/files";if("user"===a){r=TS.model.user.files;o+="/"+TS.model.user.name}else if(TS.interop.utility.looksLikeMemberId(a)){s=TS.members.getMemberById(a);if(s){r=s.files;o+="/"+s.name}else TS.error(a+" is not valid?")}var l=r.filter(function(e){return!e.is_deleted&&TS.view.files.shouldAppearInlist(e)});$("#file_list_heading").find(".heading_label").text(TS.view.file_list_heading);$("#file_list_toggle").removeClass("hidden");$("#file_search_cancel").addClass("hidden");var d=TS.model.file_list_types;var c=!d||!d.length||-1!=d.indexOf("all");n.find(".subsection").addClass("hidden");if(c)n.find('.subsection[data-filter="all"]').removeClass("hidden");else{if("all"===TS.model.active_file_list_member_filter)o+="/all";o+="/"+TS.model.active_file_list_filter;n.find('.subsection[data-filter="'+d[0]+'"]').removeClass("hidden")}if(!l.length){var _=TS.i18n.t("No files.","files")();if(c){if("user"===a)_=TS.i18n.t("No files from you.","files")();else if(s)_=TS.i18n.t("No files from {user}.","files")({user:"<strong>"+TS.members.getPrefCompliantMemberName(s,true)+"</strong>"})}else if("user"===a)_=TS.i18n.t("No {files_type} from you.","files")({files_type:TS.model.file_list_type_map[d[0]]});else if(s)_=TS.i18n.t("No {files_type} from {user}.","files")({files_type:TS.model.file_list_type_map[d[0]],user:"<strong>"+TS.members.getPrefCompliantMemberName(s,true)+"</strong>"});if(e){i.longListView("destroy");e=false}i.empty().html('<p class="no_results">'+_+"</p>")}if(l.length)if(!e){i.empty();var u=80;i.longListView({items:l,approx_item_height:u,preserve_dom_order:true,scrollable:$("#file_list_scroller"),makeElement:function e(){return $("<div>")},renderItem:function e(t,i){var n=TS.templates.builders.fileHTML(i);n=TS.format.replaceHighlightMarkers(n);var a=$(n);a.find("i.lazy").each(function(){var e=$(this);e.removeClass("lazy");e.css("background-image","url("+e.attr("data-original")+")")});t.attr("id",a.attr("id"));t.attr("class",a.attr("class"));t.attr("data-file-id",i.id);t.data("file-id",i.id);if(TS.boot_data.feature_arugula){t.attr("draggable","true");t.attr("data-drag-meta",TS.templates.makeFileDragData(i))}t.empty();a.children().each(function(){t.append(this)});TS.utility.makeSureAllLinksHaveTargets(t)},calcItemHeight:function e(t){var i=t.outerHeight();if(!i)return u;return i+12}});e=true}else i.longListView("setItems",l,false,true);if(0===TS.model.files.length)$("#file_listing_bottom_button").addClass("hidden");else $("#file_listing_bottom_button").removeClass("hidden").attr("href",o);TS.ui.utility.updateClosestMonkeyScroller(i);TS.metrics.measureAndClear("file_flexpane_rebuild","start_file_flexpane_rebuild")},filterSet:function e(){if("files"!==TS.model.ui.active_tab_id||!TS.model.ui_state.flex_visible||TS.model.previewed_file_id)TS.client.ui.files.showFileList();TS.view.files.maybeRebuildList();$("#file_list_scroller").scrollTop(0);TS.client.flex_pane.maybeFetchFileList()},clearFilter:function e(){TS.model.active_file_list_filter="all";TS.view.file_list_heading=TS.i18n.t("All File Types","files")();TS.model.file_list_types=["all"];TS.view.files.filterSet();TS.view.files.setButtonState("all");$("#file_list_clear_filter").addClass("hidden")},setButtonState:function e(t){$(".secondary_file_button").addClass("hidden");if("snippets"===t)$("#secondary_snippet_button").removeClass("hidden");else if("posts"===t)$("#secondary_post_button").removeClass("hidden");else $("#file_list_button").removeClass("hidden")},shouldAppearInlist:function e(t){var i=TS.model.file_list_types;if(!i)return true;if(!i.length)return true;if(i.indexOf("all")>-1)return true;if(i.indexOf("snippets")>-1&&"snippet"===t.mode)return true;if(i.indexOf("posts")>-1&&"post"===t.mode)return true;if(i.indexOf("spaces")>-1&&"space"===t.mode)return true;if(TS.boot_data.feature_arugula)if(i.indexOf("arugula")>-1&&"arugula"===t.mode)return true;if(i.indexOf("emails")>-1&&"email"===t.mode)return true;if(i.indexOf("zips")>-1&&"zip"===t.filetype)return true;if(i.indexOf("pdfs")>-1&&"pdf"===t.filetype)return true;if(i.indexOf("images")>-1&&t.mimetype&&0===t.mimetype.indexOf("image/"))return true;if(i.indexOf("videos")>-1&&t.mimetype&&0===t.mimetype.indexOf("video/"))return true;if(i.indexOf("gdocs")>-1&&t.mimetype&&0===t.mimetype.indexOf("application/vnd.google-apps"))return true;return false},singleListItemChanged:function t(i){if(!e)return;if("files"!==TS.model.ui_state.flex_name)return;$("#file_list").longListView("itemUpdated",i)},cleanList:function t(){if(e){$("#file_list").longListView("destroy");e=false}},hideList:function t(){if(!e)return;$("#file_list_scroller").data("disable-scroll",true);$("#file_list").longListView("setHidden",true)},unHideList:function t(){$("#file_list_scroller").data("disable-scroll",false);if(e)$("#file_list").longListView("setHidden",false);else TS.view.files.rebuildList()},shareInCurrentChannelOrIM:function e(t,i){TS.files.shareOrReshareFile(t,void 0,void 0,i,true)},delete:function e(t){var i;var n;var a;var r=TS.files&&TS.files.getFileById?TS.files.getFileById(t):null;if(r&&r.filetype&&"space"===r.filetype){i=TS.i18n.t("Delete post","files")();n=TS.i18n.t("Are you sure you want to delete this post permanently?","files")();a=TS.i18n.t("Yes, delete this post","files")()}else{i=TS.i18n.t("Delete file","files")();n=r.is_external?TS.i18n.t("Are you sure you want to permanently delete this file from Slack?","files")():TS.i18n.t("Are you sure you want to delete this file permanently?","files")();a=TS.i18n.t("Yes, delete this file","files")()}TS.generic_dialog.start({title:i,body:n,show_cancel_button:true,show_go_button:true,go_button_class:"btn_danger",go_button_text:a,cancel_button_text:TS.i18n.t("Cancel","files")(),onGo:function e(){TS.files.deleteFile(t)}})},saveToDropbox:function e(t){TS.generic_dialog.start({title:TS.i18n.t("Save to Dropbox","files")(),body:TS.i18n.t("Do you want to save this file to your Dropbox Slack folder?","files")(),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes","files")(),cancel_button_text:TS.i18n.t("No","files")(),onGo:function e(){TS.files.saveFileToDropbox(t)}})}});var e=false})()},4354:function(e,t){(function(){"use strict";TS.registerModule("view.group",{group_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function e(){TS.groups.renamed_sig.add(TS.view.group.groupRenamed,TS.view.group);TS.groups.switched_sig.add(TS.view.group.groupSwitched,TS.view.group);TS.groups.deleted_sig.add(TS.view.group.groupDeleted,TS.view.group);TS.groups.joined_sig.add(TS.view.group.groupJoined,TS.view.group);TS.groups.member_joined_sig.add(TS.view.group.groupMemberJoined,TS.view.group);TS.groups.left_sig.add(TS.view.group.groupLeft,TS.view.group);TS.groups.member_left_sig.add(TS.view.group.groupMemberLeft,TS.view.group);TS.groups.history_fetched_sig.add(TS.view.group.groupHistoryFetched,TS.view.group);TS.groups.history_being_fetched_sig.add(TS.view.group.groupHistoryBeingFetched,TS.view.group);if(!TS.useReactMessages()){TS.groups.message_received_sig.add(TS.view.group.groupMessageReceived,TS.view.group);TS.groups.message_removed_sig.add(TS.view.group.groupMessageRemoved,TS.view.group);TS.groups.message_changed_sig.add(TS.view.group.groupMessageChanged,TS.view.group)}TS.groups.marked_sig.add(TS.view.group.groupMarked,TS.view.group);TS.groups.unread_changed_sig.add(TS.view.group.groupUnreadCountChanged,TS.view.group);TS.groups.unread_highlight_changed_sig.add(TS.view.group.groupUnreadHighlightCountChanged,TS.view.group);TS.groups.topic_changed_sig.add(TS.view.group.groupTopicChanged,TS.view.group);TS.groups.purpose_changed_sig.add(TS.view.group.groupPurposeChanged,TS.view.group);TS.groups.opened_sig.add(TS.view.group.groupOpened,TS.view.group);TS.groups.closed_sig.add(TS.view.group.groupClosed,TS.view.group);TS.groups.archived_sig.add(TS.view.group.groupArchived,TS.view.group);TS.groups.unarchived_sig.add(TS.view.group.groupUnArchived,TS.view.group);TS.groups.msg_not_sent_sig.add(TS.view.group.groupMsgNotSent,TS.view.group)},groupRenamed:function e(){TS.view.updateTitleWithContext();var t=false;TS.client.ui.rebuildAll(t)},groupSwitched:function e(){TS.view._maybeUpdateOnboarding();TS.view.switchedHelper();TS.view.unAdjustForWelcomeSlideShow();TS.view.updateTitleWithContext();TS.view.updateTypingText()},groupDeleted:function e(){TS.client.channel_pane.rebuild("channels","starred")},groupJoined:function e(){TS.client.channel_pane.rebuild("channels","starred")},created_group_overlay_tim:0,groupMemberJoined:function e(t){if(t.id!=TS.model.active_group_id)return;TS.client.msg_pane.rebuildChannelMembersList();if(t.needs_created_message){clearTimeout(TS.view.group.created_group_overlay_tim);TS.view.group.created_group_overlay_tim=setTimeout(function(){if(t.id==TS.model.active_group_id)TS.view.overlay.startWithCreatedGroup(t)},1e3)}},groupLeft:function e(){TS.client.channel_pane.rebuild("channels","starred")},groupMemberLeft:function e(t){if(t.id!=TS.model.active_group_id)return;TS.client.msg_pane.rebuildChannelMembersList()},groupHistoryFetched:function e(t){if(t.id!=TS.model.active_group_id)return;TS.client.ui.afterHistoryFetch(t)},groupHistoryBeingFetched:function e(t){if(t.id!=TS.model.active_group_id)return;TS.client.msg_pane.updateEndMarker();t=TS.groups.getGroupById(TS.model.active_group_id);if(!t||!t.msgs.length)return;if(TS.model.ms_connected)if(t.history_changed)TS.model.ui.last_top_msg=null;else{var i=TS.utility.msgs.getDisplayedMsgs(t.msgs);TS.model.ui.last_top_msg=i[i.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")},groupMessageReceived:function e(t,i){if(t.id!=TS.model.active_group_id)return;if(!i){TS.error("no msg?");return}if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.isMsgReply(i)){TS.view.addReplyMsg(t,i);return}if(TS.utility.msgs.isMsgHidden(i))return;var n=_.reject(t.msgs,TS.utility.msgs.isMsgHidden);var a=n;var r=a.length>1&&TS.utility.msgs.msgMightBeRolledUp(i)&&TS.utility.msgs.msgMightBeRolledUp(a[1]);if(r||1==a.length||a[0]!=i){var s=true;TS.client.msg_pane.rebuildMsgsWithReason("groupMessageReceived",s)}else{TS.view.addMsg(i,t.unread_cnt);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearUnreadDivider(t,i)}TS.view.group.group_ui_updated_with_new_msg_sig.dispatch(i)},groupMessageRemoved:function e(t,i){if(t.id!=TS.model.active_group_id)return;if(!i){TS.error("no msg?");return}TS.view.removeMsg(t,i)},groupMessageChanged:function e(t,i,n){if(t.id!=TS.model.active_group_id)return;setTimeout(function(){if(TS.boot_data.feature_new_broadcast&&_.includes(n,"_hidden_reply")){if(i._hidden_reply&&_.includes(n,"subtype"))TS.view.group.groupMessageRemoved(t,i);else if(!i._hidden_reply&&"thread_broadcast"===i.subtype)TS.view.group.groupMessageReceived(t,i)}else TS.view.rebuildMsg(i,n)},0)},groupMarked:function e(t){if(t.id!=TS.model.active_group_id)return;TS.client.msg_pane.assignLastReadMsgDiv(t);TS.view.reClassUnreads(t.last_read)},groupUnreadCountChanged:function e(t){if(TS.useReactMessages())return;if(!t)return;var i="."+TS.templates.makeGroupDomId(t);var n=$(i);if(0===t.unread_cnt)n.removeClass("unread mention");else{n.addClass("unread");if(t.unread_highlight_cnt>0)n.addClass("mention")}if(t._show_in_list_even_though_no_unreads)n.addClass("show_in_list_even_though_no_unreads");else n.removeClass("show_in_list_even_though_no_unreads");var a=n.find(".group_name");if(a.length)a.attr("aria-label",TS.templates.builders.makeChannelLinkAriaLabelSafe(t));i="."+TS.templates.makeUnreadMsgsDomId(t);var r=$(i);if(0===t.unread_cnt)r.html(t.unread_cnt).addClass("hidden");else if(t.unread_cnt<10)r.html(t.unread_cnt).removeClass("hidden");else r.html("9+").removeClass("hidden");TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads();TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(t);TS.client.msg_pane.maybeResetAndAutoScroll(t)},groupUnreadHighlightCountChanged:function e(t){if(TS.useReactMessages())return;if(!t)return;var i="."+TS.templates.makeUnreadHighlightDomId(t);if(0===t.unread_highlight_cnt)$(i).html(t.unread_highlight_cnt).addClass("hidden");else if(t.unread_highlight_cnt<10)$(i).html(t.unread_highlight_cnt).removeClass("hidden");else $(i).html("9+").removeClass("hidden")},groupTopicChanged:function e(t){if(!t)return;if(t.id!=TS.model.active_group_id)return;TS.client.msg_pane.updateEndMarker()},groupPurposeChanged:function e(t){if(!t)return;if(t.id!=TS.model.active_group_id)return;TS.client.msg_pane.updateEndMarker()},groupOpened:function e(){TS.client.msg_pane.rebuildChannelMembersList();TS.client.channel_pane.rebuild("channels","starred")},groupClosed:function e(){TS.client.msg_pane.rebuildChannelMembersList();TS.client.channel_pane.rebuild("channels","starred")},groupArchived:function e(t){TS.client.channel_pane.rebuild("channels","starred");if(t.id!=TS.model.active_group_id)return;TS.client.archives.start()},groupUnArchived:function e(t){TS.client.channel_pane.rebuild("channels","starred");if(t.id!=TS.model.active_group_id)return;TS.client.msg_pane.rebuildMsgsWithReason("groupUnArchived")},groupMsgNotSent:function e(t,i,n){if(t.id!=TS.model.active_group_id)return;TS.view.showUnSentControlsForMsg(i,t,n)}})})()},4355:function(e,t){(function(){"use strict";TS.registerModule("view.im",{im_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function e(){TS.ims.opened_sig.add(TS.view.im.imOpened,TS.view.im);TS.ims.closed_sig.add(TS.view.im.imClosed,TS.view.im);TS.ims.switched_sig.add(TS.view.im.imSwitched,TS.view.im);TS.ims.history_fetched_sig.add(TS.view.im.imHistoryFetched,TS.view.im);TS.ims.history_being_fetched_sig.add(TS.view.im.imHistoryBeingFetched,TS.view.im);if(!TS.useReactMessages()){TS.ims.message_received_sig.add(TS.view.im.imMessageReceived,TS.view.im);TS.ims.message_removed_sig.add(TS.view.im.imMessageRemoved,TS.view.im);TS.ims.message_changed_sig.add(TS.view.im.imMessageChanged,TS.view.im)}TS.ims.marked_sig.add(TS.view.im.imMarked,TS.view.im);TS.ims.unread_changed_sig.add(TS.view.im.imUnreadCountChanged,TS.view.im);TS.ims.unread_highlight_changed_sig.add(TS.view.im.imUnreadHighlightCountChanged,TS.view.im);TS.ims.msg_not_sent_sig.add(TS.view.im.imMsgNotsent,TS.view.im)},imOpened:function e(){TS.client.msg_pane.rebuildChannelMembersList();if(TS.apps.isAppSpaceEnabled())TS.client.channel_pane.rebuild("ims","starred","apps");else TS.client.channel_pane.rebuild("ims","starred")},imClosed:function e(){TS.client.msg_pane.rebuildChannelMembersList();if(TS.apps.isAppSpaceEnabled())TS.client.channel_pane.rebuild("ims","starred","apps");else TS.client.channel_pane.rebuild("ims","starred")},imSwitched:function e(){TS.view._maybeUpdateOnboarding();TS.view.switchedHelper();if(!TS.onboarding.inOnboarding())TS.view.unAdjustForWelcomeSlideShow();TS.view.updateTitleWithContext();TS.view.updateTypingText()},imHistoryFetched:function e(t){if(t.id!==TS.model.active_im_id)return;TS.client.ui.afterHistoryFetch(t)},imHistoryBeingFetched:function e(t){if(t.id!==TS.model.active_im_id)return;TS.client.msg_pane.updateEndMarker();t=TS.ims.getImById(TS.model.active_im_id);if(!t||!t.msgs.length)return;if(TS.model.ms_connected)if(t.history_changed)TS.model.ui.last_top_msg=null;else{var i=TS.utility.msgs.getDisplayedMsgs(t.msgs);TS.model.ui.last_top_msg=i[i.length-1]}else TS.model.ui.last_top_msg=null;TS.client.msg_pane.updateEndMarker();$("html").unbind("mousemove.monkeyScroll")},imMessageReceived:function e(t,i,n){if(!n&&TS.model.user&&TS.model.user.is_restricted)if(-1===(TS.model.guest_accessible_user_ids||[]).indexOf(t.user)){TS.members.maybeUpdateMembersUserCanSee(t.user).then(function(){TS.view.im.imMessageReceived(t,i,true)});return}if(!t.is_open)TS.client.channel_pane.rebuild("ims","starred");if(t.id!==TS.model.active_im_id)return;if(!i){TS.error("no msg?");return}if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.isMsgReply(i)){TS.view.addReplyMsg(t,i);return}if(TS.utility.msgs.isMsgHidden(i))return;if(1===t.msgs.length||t.msgs[0]!==i)TS.client.msg_pane.rebuildMsgsWithReason("imMessageReceived");else{TS.view.addMsg(i,t.unread_cnt);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearUnreadDivider(t,i)}TS.view.im.im_ui_updated_with_new_msg_sig.dispatch(i)},imMessageRemoved:function e(t,i){if(t.id!==TS.model.active_im_id)return;if(!i){TS.error("no msg?");return}TS.view.removeMsg(t,i)},imMessageChanged:function e(t,i,n){if(t.id!==TS.model.active_im_id)return;setTimeout(function(){if(TS.boot_data.feature_new_broadcast&&_.includes(n,"_hidden_reply")){if(i._hidden_reply&&_.includes(n,"subtype"))TS.view.im.imMessageRemoved(t,i);else if(!i._hidden_reply&&"thread_broadcast"===i.subtype)TS.view.im.imMessageReceived(t,i)}else TS.view.rebuildMsg(i,n)},0)},imMarked:function e(t){TS.client.channel_pane.rebuild("ims","starred");if(t.id!==TS.model.active_im_id)return;TS.client.msg_pane.assignLastReadMsgDiv(t);TS.view.reClassUnreads(t.last_read)},imUnreadCountChanged:function e(t){if(TS.useReactMessages())return;if(!t)return;var i=TS.members.getMemberById(t.user);var n="."+TS.templates.makeMemberDomId(i);var a=$(n);var r="."+TS.templates.makeUnreadHighlightDomId(i);if(0===t.unread_cnt){a.removeClass("unread mention");$(r).html(t.unread_cnt).addClass("hidden")}else if(t.unread_cnt<10){a.addClass("unread mention");$(r).html(t.unread_cnt).removeClass("hidden")}else{a.addClass("unread mention");$(r).html("9+").removeClass("hidden")}var s=a.find(".im_name");if(s.length)s.attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:i,im:t}));TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads();TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(t);TS.client.msg_pane.maybeResetAndAutoScroll(t)},imUnreadHighlightCountChanged:function e(t){if(TS.useReactMessages())return;if(!t)return;var i="."+TS.templates.makeUnreadHighlightDomId(t);$(i).html(t.unread_highlight_cnt);TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()},imMsgNotsent:function e(t,i,n){if(t.id!==TS.model.active_im_id)return;TS.view.showUnSentControlsForMsg(i,t,n)}})})()},4356:function(e,t){(function(){"use strict";TS.registerModule("view.members",{unknown_resolution_rebuild_sig:new signals.Signal,onStart:function e(){TS.members.presence_changed_sig.add(TS.view.members.memberPresenceChanged,TS.view.members);TS.members.status_changed_sig.add(TS.view.members.memberStatusChanged,TS.view.members);TS.members.joined_team_sig.add(TS.view.members.memberJoinedTeam,TS.view.members);TS.members.members_for_user_changed_sig.add(TS.view.members.memberChangeVisibilityToUser,TS.view.members);TS.members.changed_name_sig.add(TS.view.members.memberChangedName,TS.view.members);TS.members.changed_real_name_sig.add(TS.view.members.memberChangedRealName,TS.view.members);TS.members.changed_self_sig.add(TS.view.members.somethingChangedOnUser,TS.view.members);TS.members.changed_deleted_sig.add(t,TS.view.members);TS.members.non_loaded_changed_deleted_sig.add(t,TS.view.members);TS.members.changed_profile_sig.add(TS.view.members.memberChangedProfile,TS.view.members);TS.members.changed_current_status_sig.add(TS.view.members.memberChangedCurrentStatus,TS.view.members);TS.members.changed_tz_sig.add(TS.view.members.memberChangedTZ,TS.view.members);TS.members.changed_account_type_sig.add(TS.view.members.memberAccountTypeChanged,TS.view.members);TS.members.changed_admin_perms_sig.add(TS.view.members.memberAdminPermsChanged,TS.view.members);TS.members.changed_owner_perms_sig.add(TS.view.members.memberAdminPermsChanged,TS.view.members);TS.members.changed_is_unknown_sig.add(i);TS.typing.started_sig.add(TS.view.members.memberTypingStarted,TS.view.members);TS.typing.ended_sig.add(TS.view.members.memberTypingEnded,TS.view.members);TS.stars.member_stars_fetched_sig.add(TS.view.members.memberStarsFetched,TS.view.members);TS.view.members.unknown_resolution_rebuild_sig.add(TS.view.members.memberChangedName)},memberPresenceChanged:function e(t){if(!t)return;var i;var n;var a;if(t.is_self){if(TS.model.ms_connected)TS.view.ms.maybeChangeConnectionDisplay();var r=$("#menu").find("#member_presence").find(".menu_item_label");if("away"===t.presence)r.text(TS.i18n.t("[Away] Set yourself to active","view_members")());else r.text(TS.i18n.t("Set yourself away","view_members")())}else{i="."+TS.templates.makeMemberDomId(t);n=$(i).not(".call_icon");if("away"===t.presence)n.addClass("away");else n.removeClass("away")}i="."+TS.templates.makeMemberPresenceDomClass(t.id);a=TS.templates.makeMemberPresenceStateClass(t);var s="active"===t.presence?TS.i18n.t("active","view_members")():TS.i18n.t("away","view_members")();$(i).removeClass("away active dnd").addClass(a).attr("title",s);var o=TS.ims.getImByMemberId(t.id);if(o)$(i).closest(".im_name").attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:t,im:o}));TS.view.last_team_list_html=null},memberStatusChanged:function e(t){if(!t)return;if(t.is_self)$(".user_status_label").text(t.status||"");var i="."+TS.templates.makeMemberStatusDomClass(t.id);$(i).html(t.status?t.status:"-");TS.view.updateTeamListCache()},memberJoinedTeam:function e(){},member_changed_visibility_to_user_tim:0,memberChangeVisibilityToUser:function e(){clearTimeout(TS.view.members.member_changed_visibility_to_user_tim);TS.view.members.member_changed_visibility_to_user_tim=setTimeout(function(){TS.client.channel_pane.rebuild("ims","starred","apps")},1e3)},memberChangedName:function e(t){if(t.id==TS.model.user.id){TS.view.members.updateUserDisplayName();TS.prefs.setHighlightWords(TS.model.prefs.highlight_words)}TS.view.updateTitleWithContext();var i=false;var n=true;TS.client.ui.rebuildAll(i,n);TS.view.rebuildTeamMember(t);if(t.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(t.id)},memberChangedRealName:function e(){},somethingChangedOnUser:function e(){TS.view.showProperTeamPaneFiller()},memberChangedProfile:function e(t){var i=[];if(!TS.members.is_in_bulk_upsert_mode){var n=TS.shared.getActiveModelOb();var a=n.is_im&&n.user===t.id||n.is_mpim&&n.members.indexOf(t.id)>-1;var r=_.map(TS.model.ims,"user").indexOf(t.id)>-1;var s=t.id===TS.model.user.id;var o=false;var l={channel_header:!a,user_current_status:!s,channel_pane_channels:true,channel_pane_apps:true,channel_pane_ims:!r,channel_pane_starred:!r};var d=true;TS.client.ui.rebuildAllButMsgs(o,l,d);TS.view.rebuildMsgsIncludingMember(t);TS.client.ui.threads.rebuildMsgsIncludingMember(t);TS.ui.replies.rebuildMsgsIncludingMember(t);if(TS.client.unread.isEnabled())TS.client.ui.unread.rebuildMsgsIncludingMember(t)}if(t.id==_.get(TS.model.user,"id")){TS.view.members.updateUserDisplayName();i.push("url("+t.profile.image_72+")");$('a[data-member-id="'+TS.model.user.id+'"] .member_image, a[data-member-id="'+TS.model.user.id+'"].member_image').attr("style","background-image: "+i.join(","));$('#menu a[data-member-id="'+TS.model.user.id+'"].member_image').attr("style","background-image: "+TS.templates.builders.makeMemberPreviewCardLinkImageBackground(TS.model.user.id))}TS.view.rebuildTeamMember(t);if(t.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(t.id)},memberChangedCurrentStatus:function e(t){if(!TS.members.is_in_bulk_upsert_mode){var i=TS.shared.getActiveModelOb();var n=i.is_im&&i.user===t.id||i.is_mpim&&i.members.indexOf(t.id)>-1;var a=_.map(TS.model.ims,"user").indexOf(t.id)>-1;var r=t.id===TS.model.user.id;var s=false;var o={channel_header:!n,user_current_status:!r,channel_pane_channels:true,channel_pane_apps:true,channel_pane_ims:!a,channel_pane_starred:!a};var l=true;TS.client.ui.rebuildAllButMsgs(s,o,l);TS.view.rebuildMsgCurrentStatusIncludingMember(t);TS.client.ui.threads.rebuildMsgCurrentStatusIncludingMember(t);TS.ui.replies.rebuildMsgCurrentStatusIncludingMember(t);TS.client.ui.flex.rebuildMsgCurrentStatusIncludingMember(t);TS.client.ui.unread.rebuildMsgCurrentStatusIncludingMember(t);$(".team_list_item.member_item .current_status.color_"+t.id).replaceWith(TS.templates.current_status({member:t}));var d=TS.templates.current_status({member:t,classes:"ts_tip_float"});$(".member_info .current_status.color_"+t.id).replaceWith(d);$("#channel_page_member_"+t.id+" .current_status").replaceWith(d)}if(t.id==TS.model.user.id)TS.view.members.updateUserCurrentStatus();TS.view.rebuildTeamMember(t);if(t.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(t.id)},memberChangedTZ:function e(t){var i=false;var n=true;TS.client.ui.rebuildAll(i,n);TS.view.rebuildTeamMember(t);if(t.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(t.id)},member_account_changed_tim:0,memberAccountTypeChanged:function e(t){if(t&&t.id==TS.model.user.id)return;clearTimeout(TS.view.members.member_account_changed_tim);TS.view.members.member_account_changed_tim=setTimeout(function(){if(t.id!=TS.model.previewed_member_id)return;TS.client.ui.previewMember(t.id)},1e3)},memberAdminPermsChanged:function e(t){if(t&&t.id==TS.model.user.id)TS.ui.admin_invites.maybeShowInviteLink();$("#team_list_admin_link").toggleClass("hidden",!t.is_admin);if(TS.model.previewed_member_id===t.id)TS.client.ui.previewMember(t.id)},updateUserDisplayName:function e(){$(".current_user_name").html(TS.members.getPrefCompliantMemberName(TS.model.user,true))},updateUserCurrentStatus:function e(){$(".current_user_current_status").replaceWith(TS.templates.current_status({member:TS.model.user,tip_direction:"bottom",classes:"current_user_current_status ts_tip_float"}))},getUserPresenceStr:function e(){var t=TS.model.user;if("away"===t.manual_presence)return t.presence+" "+TS.i18n.t("(manual)","view_members")();return t.presence},memberTypingStarted:function e(t,i){if(!TS.model.prefs.show_typing)return;var n=TS.shared.getActiveModelOb();if(n&&t.id==n.id)TS.view.updateTypingText();if(i.is_self)return;var a=TS.view.members.getSelectorForTypingIndicator(t,i);if(a)$(a).addClass("typing")},memberTypingEnded:function e(t,i){var n=TS.shared.getActiveModelOb();if(n&&t.id==n.id)TS.view.updateTypingText();var a=TS.view.members.getSelectorForTypingIndicator(t,i);if(a)$(a).removeClass("typing")},getSelectorForTypingIndicator:function e(t,i){var n;var a=TS.shared.getActiveModelOb();if(t.is_im)n=".channels_list_holder ul li."+TS.templates.makeMemberDomId(i);else if(a&&t.id===a.id)n="#"+TS.templates.makeChannelListDomId(t)+" ."+TS.templates.makeMemberDomId(i);return n},memberStarsFetched:function e(t,i){TS.view.toggleStarsError(!!t);if(t)return;if(!i||!i.is_self)return;TS.view.rebuildStars()}});var e=false;var t=function t(){if(e)return;var i=TS.shared.getActiveModelOb();if(!i)return;e=true;TS.utility.rAF(function(){e=false;TS.client.channel_pane.rebuild("ims","starred","apps");TS.client.msg_pane.rebuildChannelMembersList()})};var i=function e(t){if($(".unknown_member").length>0)TS.view.members.unknown_resolution_rebuild_sig.dispatch(t)}})()},4357:function(e,t){(function(){"use strict";TS.registerModule("view.mpim",{mpim_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function e(){TS.mpims.switched_sig.add(TS.view.mpim.mpimSwitched,TS.view.mpim);TS.mpims.history_fetched_sig.add(TS.view.mpim.mpimHistoryFetched,TS.view.mpim);TS.mpims.history_being_fetched_sig.add(TS.view.mpim.mpimHistoryBeingFetched,TS.view.mpim);if(!TS.useReactMessages()){TS.mpims.message_received_sig.add(TS.view.mpim.mpimMessageReceived,TS.view.mpim);TS.mpims.message_removed_sig.add(TS.view.mpim.mpimMessageRemoved,TS.view.mpim);TS.mpims.message_changed_sig.add(TS.view.mpim.mpimMessageChanged,TS.view.mpim)}TS.mpims.joined_sig.add(TS.view.mpim.mpimJoined,TS.view.mpim);TS.mpims.opened_sig.add(TS.view.mpim.mpimOpened,TS.view.mpim);TS.mpims.closed_sig.add(TS.view.mpim.mpimClosed,TS.view.mpim);TS.mpims.marked_sig.add(TS.view.mpim.mpimMarked,TS.view.mpim);TS.mpims.unread_changed_sig.add(TS.view.mpim.mpimUnreadCountChanged,TS.view.mpim);TS.mpims.unread_highlight_changed_sig.add(TS.view.mpim.mpimUnreadHighlightCountChanged,TS.view.mpim);TS.mpims.msg_not_sent_sig.add(TS.view.mpim.mpimMsgNotsent,TS.view.mpim)},mpimSwitched:function e(){TS.view._maybeUpdateOnboarding();var t=!TS.model.ms_logged_in_once;TS.view.switchedHelper(t);if(!TS.onboarding.inOnboarding())TS.view.unAdjustForWelcomeSlideShow();TS.view.updateTitleWithContext();TS.view.updateTypingText()},mpimHistoryFetched:function e(t){if(t.id!==TS.model.active_mpim_id)return;TS.client.ui.afterHistoryFetch(t)},mpimHistoryBeingFetched:function e(t){if(t.id!==TS.model.active_mpim_id)return;TS.client.msg_pane.updateEndMarker();t=TS.mpims.getMpimById(TS.model.active_mpim_id);if(!t||!t.msgs.length)return;if(TS.model.ms_connected)if(t.history_changed)TS.model.ui.last_top_msg=null;else{var i=TS.utility.msgs.getDisplayedMsgs(t.msgs);TS.model.ui.last_top_msg=i[i.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")},mpimMessageReceived:function e(t,i){if(!t.is_open)TS.client.channel_pane.rebuild("ims","starred");if(t.id!==TS.model.active_mpim_id)return;if(!i){TS.error("no msg?");return}if(TS.boot_data.feature_message_replies_inline)if(TS.utility.msgs.isMsgReply(i)){TS.view.addReplyMsg(t,i);return}if(TS.utility.msgs.isMsgHidden(i))return;if(1===t.msgs.length||t.msgs[0]!==i)TS.client.msg_pane.rebuildMsgsWithReason("mpimMessageReceived");else{TS.view.addMsg(i,t.unread_cnt);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearUnreadDivider(t,i)}TS.view.mpim.mpim_ui_updated_with_new_msg_sig.dispatch(i)},mpimMessageRemoved:function e(t,i){if(t.id!==TS.model.active_mpim_id)return;if(!i){TS.error("no msg?");return}TS.view.removeMsg(t,i)},mpimMessageChanged:function e(t,i,n){if(t.id!==TS.model.active_mpim_id)return;setTimeout(function(){if(TS.boot_data.feature_new_broadcast&&_.includes(n,"_hidden_reply")){if(i._hidden_reply&&_.includes(n,"subtype"))TS.view.mpim.mpimMessageRemoved(t,i);else if(!i._hidden_reply&&"thread_broadcast"===i.subtype)TS.view.mpim.mpimMessageReceived(t,i)}else TS.view.rebuildMsg(i,n)},0)},mpimJoined:function e(){TS.client.channel_pane.rebuild("ims","starred")},mpimOpened:function e(){TS.client.channel_pane.rebuild("ims","starred")},mpimClosed:function e(){TS.client.channel_pane.rebuild("ims","starred")},mpimMarked:function e(t){TS.client.channel_pane.rebuild("ims","starred");if(t.id!==TS.model.active_mpim_id)return;TS.client.msg_pane.assignLastReadMsgDiv(t);TS.view.reClassUnreads(t.last_read)},mpimUnreadCountChanged:function e(t){if(TS.useReactMessages())return;if(!t)return;var i=$("#im-list, #starred-list").find("."+TS.templates.makeMpimDomId(t));i.replaceWith(TS.templates.mpim({model_ob:t}));TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads();TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(t);TS.client.msg_pane.maybeResetAndAutoScroll(t)},mpimUnreadHighlightCountChanged:function e(){},mpimMsgNotsent:function e(t,i,n){if(t.id!==TS.model.active_mpim_id)return;TS.view.showUnSentControlsForMsg(i,t,n)}})})()},4358:function(e,t){(function(){"use strict";TS.registerModule("view.ms",{onStart:function e(){if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.troubleConnectingSig.add(TS.view.ms.socketTroubled,TS.view.ms);TS.interop.SocketManager.waitingForRateLimitSig.add(TS.view.ms.socketReconnecting,TS.view.ms);TS.interop.SocketManager.connectedSig.add(TS.view.ms.socketConnected,TS.view.ms);TS.interop.SocketManager.disconnectedSig.add(TS.view.ms.socketDisconnected,TS.view.ms)}else{TS.ms.connected_sig.add(TS.view.ms.socketConnected,TS.view.ms);TS.ms.trouble_sig.add(TS.view.ms.socketTroubled,TS.view.ms);TS.ms.disconnected_sig.add(TS.view.ms.socketDisconnected,TS.view.ms);TS.ms.reconnecting_sig.add(TS.view.ms.socketReconnecting,TS.view.ms)}},ever_connected:false,socketConnected:function t(i){var n=!!TS.view.ms.ever_connected;if(TS.view.ms.ever_connected){TS.utility.msgs.removeAllEphemeralMsgsByType("disconnected_feedback");var a=true;TS.client.ui.rebuildAllButMsgs(a);TS.client.ui.rebuildMemberListToggle();TS.mentions.maybeUpdateMentions();if(i){var r=TS.shared.getActiveModelOb();if(r)TS.shared.maybeDealWithAllSentTempMsgs(r,TS.shared.getControllerForModelOb(r))}}else{if(TS.metrics.getLatestMark("start_load"))TS.metrics.measure("client_load","start_load");TS.metrics.measure("client_total_load","start_nav");TS.metrics.logPerfTimingSections();e()}TS.view.ms.ever_connected=true;TS.client.msg_input.setOnline();TS.info("Hiding the reconnection banner because we are connected");s();$("#connection_div").html("").addClass("hidden");TS.client.msg_pane.topMessagesBannerHidden();TS.view.ms.changeConnectionStatus("online");TS.view.prefs.toggleSpellcheck();TS.view.checkIfInputShouldBeDisabledAndPopulate(n);TS.ui.a11y.annouceCurrentChannelOrImOrGroup()},socketTroubled:function e(){TS.view.ms.changeConnectionStatus("trouble");TS.client.msg_input.setOffline();TS.info("Hiding the reconnection banner because we are troubled");s()},socketDisconnected:function e(){TS.view.ms.changeConnectionStatus("offline");TS.client.msg_input.setOffline();TS.info("Hiding the reconnection banner because we are disconnected");s()},socketReconnecting:function e(t){if(TS.model.window_unloading){TS.info("Hiding the reconnection banner because we are unloading");s();$("#connection_div").html("").addClass("hidden");TS.client.msg_pane.topMessagesBannerHidden()}else if($("#connection_div").hasClass("hidden"))a(t);else r(t)},current_connection_status:null,changeConnectionStatus:function e(t){TS.view.ms.current_connection_status=t;TS.view.maybeChangeFavIco();TS.view.ms.maybeChangeConnectionDisplay()},maybeChangeConnectionDisplay:function e(){var t=$("#presence");var i="";var n;switch(TS.view.ms.current_connection_status){case"online":TSSSB.call("setConnectionStatus","online");if("away"===TS.model.user.presence){n=TS.dnd.isMemberInDnd(TS.model.user)?TS.i18n.t('Away<br><span class="greigh">Notifications snoozed</span>',"ms")():TS.i18n.t("Away","ms")();i="away"}else{n=TS.dnd.isMemberInDnd(TS.model.user)?TS.i18n.t('Active<br><span class="greigh">Notifications snoozed</span>',"ms")():TS.i18n.t("Active","ms")();i="active"}if(TS.dnd.isMemberInDnd(TS.model.user))i+=" dnd";break;case"trouble":TSSSB.call("setConnectionStatus","connecting");n=TS.i18n.t("Connecting...","ms")();i="connecting";break;default:TSSSB.call("setConnectionStatus","offline");n=TS.i18n.t("away","ms")();i="Away"}TS.tips.updateTipTitle($("#presence_container"),n);t.removeClass("active away connecting dnd");t.addClass(i)}});var e=function e(){var t=Array.prototype.slice.call(document.getElementsByTagName("style"));var i=Array.prototype.slice.call(document.getElementsByTagName("link"));var n=Array.prototype.slice.call(document.getElementsByTagName("script"));var a=n.filter(function(e){return!e.src&&"text/x-handlebars-template"!==e.type});var r=n.filter(function(e){return!!e.src});var s=n.filter(function(e){return!e.src&&"text/x-handlebars-template"===e.type});i=i.filter(function(e){return"stylesheet"===e.rel});TS.metrics.store("inline_script_nodes",a.length,{is_count:true});TS.metrics.store("inline_template_nodes",s.length,{is_count:true});TS.metrics.store("inline_style_nodes",t.length,{is_count:true});TS.metrics.store("external_script_nodes",r.length,{is_count:true});TS.metrics.store("external_link_nodes",i.length,{is_count:true})};var t=1e4;var i;var n;var a=function e(a){n=a;if(i)return;if(1e3*a>t){r(a);return}i=setTimeout(function(){i=void 0;if(!TS.model.ms_connected)r(n)},t)};var r=function e(t){s();if(TS.api.isPaused()&&!$("#connection_div").hasClass("hidden")){TS.info("Not showing reconnecting banner because API is paused and showing its own banner");return}var i=TS.i18n.t("Reconnecting...","ms")();if(t){i=TS.i18n.t("Reconnecting in {num_secs, plural, =1 {# second} other {# seconds...}}","ms")({num_secs:t});if(t>2)i+=' <a onclick="TS.client.manualReconnectNow()">'+TS.i18n.t("Retry now?","ms")()+"</a>"}$("#connection_div").html(i).removeClass("hidden");TS.client.msg_pane.topMessagesBannerShown()};var s=function e(){if(!i)return;clearTimeout(i);i=void 0}})()},4359:function(e,t){(function(){"use strict";TS.registerModule("view.prefs",{onStart:function i(){TS.prefs.webapp_spellcheck_changed_sig.add(TS.view.prefs.toggleSpellcheck,TS.view.prefs);TS.prefs.highlight_words_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.highlight_words_changed_sig"),TS.view.prefs);TS.prefs.emoji_mode_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);if(!TS.boot_data.feature_name_tagging_client)TS.prefs.team_require_at_for_mention_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);TS.prefs.expand_inline_imgs_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_inline_imgs_changed_sig"),TS.view.prefs);TS.prefs.expand_internal_inline_imgs_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_internal_inline_imgs_changed_sig"),TS.view.prefs);TS.prefs.expand_non_media_attachments_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_non_media_attachments_changed_sig"),TS.view.prefs);TS.prefs.obey_inline_img_limit_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.obey_inline_img_limit_changed_sig"),TS.view.prefs);TS.prefs.messages_theme_changed_sig.add(TS.ui.setThemeClasses,TS);TS.prefs.dtop_notif_changed_sig.add(TS.view.prefs.dTopNotificationChanged,TS.view.prefs);TS.prefs.muted_channels_changed_sig.add(TS.view.prefs.mutedChannelsChanged,TS.view.prefs);TS.prefs.sidebar_behavior_changed_sig.add(TS.view.prefs.sidebarBehaviorPrefChanged,TS.view.prefs);TS.prefs.team_hide_referers_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.team_hide_referers_changed_sig"),TS.view.prefs);TS.prefs.team_perms_pref_changed_sig.add(TS.view.prefs.teamPermsPrefChanged,TS.view.prefs);TS.prefs.display_real_names_override_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);TS.prefs.team_display_real_names_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);TS.prefs.time24_changed_sig.add(TS.view.prefs.time24PrefChanged,TS.view.prefs);TS.prefs.sidebar_theme_changed_sig.add(TS.view.prefs.sidebarThemePrefChanged,TS.view.prefs);TS.prefs.mentions_exclude_at_channels_changed_sig.add(TS.view.prefs.rebuildMentionOptions,TS.view.prefs);TS.prefs.mentions_exclude_at_user_groups_changed_sig.add(TS.view.prefs.rebuildMentionOptions,TS.view.prefs);if(TS.boot_data.feature_prev_next_button){TS.prefs.prev_next_btn_changed_sig.add(TS.client.channel_pane.rebuildFooter,TS.view.prefs);TS.prefs.no_omnibox_in_channels_changed_sig.add(TS.client.channel_pane.rebuildFooter,TS.view.prefs)}else{TS.prefs.no_omnibox_in_channels_changed_sig.add(TS.client.channel_pane.updateQuickSwitcherBtnVisibility,TS.view.prefs);TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.add(e,TS.view.prefs)}TS.prefs.separate_private_channels_changed_sig.add(t);TS.prefs.team_display_email_addresses_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs);TS.prefs.hide_hex_swatch_changed_sig.add(TS.view.prefs.hideHexSwatchPrefChanged,TS.view.prefs)},toggleSpellcheck:function e(){var t="textarea";if(TS.utility.contenteditable.supportsTexty())t+=', [contenteditable="true"]';$(t).attr("autocorrect","off");$(t).attr("autocomplete","off");if(TS.model.prefs.webapp_spellcheck)$(t).attr("spellcheck",true);else $(t).attr("spellcheck",false)},farReachingDisplayPrefChanged:function e(){var t=true;TS.client.msg_pane.rebuildMsgsWithReason("farReachingDisplayPrefChanged",t);TS.search.view.renderResults();TS.view.rebuildMentions();TS.view.rebuildStars();TS.view.files.throttledRebuildList();TS.view.members.updateUserDisplayName();TS.view.members.updateUserCurrentStatus();TS.client.channel_pane.rebuild("ims","starred");TS.client.msg_pane.displayTitle();TS.client.msg_pane.rebuildChannelMembersList();TS.view.rebuildPreviewedMember();if(TS.members.shouldDisplayRealNames())$("#col_channels").addClass("real_names");else $("#col_channels").removeClass("real_names");if(TS.model.previewed_file_id)TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},dTopNotificationChanged:function e(){TS.utility.msgs.reCalcAndCountAllUnreads();TS.client.channel_pane.rebuild("starred","channels")},mutedChannelsChanged:function e(){if(TS.model.newly_unmuted_channels&&TS.model.newly_unmuted_channels.length){TS.log(389,"mutedChannelsChanged: recalculating unreads for newly-unmuted channel(s): "+TS.model.newly_unmuted_channels.join(", "));TS.utility.msgs.reCalcAndCountSomeUnreads(TS.model.newly_unmuted_channels)}else TS.log(389,"mutedChannelsChanged: No newly-unmuted channels, no need to recalculate unreads.");TS.model.newly_muted_channels=[];TS.model.newly_unmuted_channels=[];TS.client.channel_pane.rebuild("starred","channels","ims");TS.client.msg_pane.displayTitle()},sidebarBehaviorPrefChanged:function e(){TS.utility.msgs.reCalcAndCountAllUnreads()},teamPermsPrefChanged:function e(t){if("who_can_at_channel"===t||"who_can_at_everyone"===t||"who_can_post_general"===t)TS.utility.msgs.reCalcAndCountAllUnreads();if("who_can_edit_user_groups"===t||"who_can_create_delete_user_groups"===t)TS.view.userGroupPrefUpdated();TS.client.channel_pane.rebuild("channels","starred");TS.view.checkIfInputShouldBeDisabledAndPopulate()},time24PrefChanged:function e(){TS.client.msg_pane.rebuildMsgsWithReason("time24PrefChanged");TS.search.view.renderResults();TS.view.rebuildMentions();TS.view.rebuildStars();TS.view.files.throttledRebuildList();TS.client.channel_pane.rebuild("ims","starred");if(TS.model.previewed_file_id)TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},hideHexSwatchPrefChanged:function e(){TS.client.msg_pane.rebuildMsgsWithReason("hideHexSwatchPrefChanged");TS.search.view.renderResults();TS.view.rebuildMentions();TS.view.rebuildStars();if(TS.model.previewed_file_id)TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},sidebarThemePrefChanged:function e(t){t=false!==t;if(TS.model.prefs.sidebar_theme){if(TS.prefs.last_theme_selected_in_UI&&TS.model.prefs.sidebar_theme!==TS.prefs.last_theme_selected_in_UI)return;else if(TS.prefs.last_theme_selected_in_UI&&t){TS.prefs.last_theme_selected_in_UI=null;TS.model.prefs.sidebar_theme_custom_values=TS.sidebar_themes.default_themes[TS.model.prefs.sidebar_theme]}if("arctic_theme"===TS.model.prefs.sidebar_theme)TS.model.prefs.sidebar_theme="hoth_theme";var i=$("#client-ui");var n="sidebar_theme_";var a=i[0];var r=a.className.split(" ").filter(function(e){return 0!==e.lastIndexOf(n,0)});a.className=r.join(" ");i.addClass(n+TS.model.prefs.sidebar_theme)}if("default"===TS.model.prefs.sidebar_theme||"default_theme"===TS.model.prefs.sidebar_theme||"basic_theme"===TS.model.prefs.sidebar_theme)$("#sidebar_theme_css").remove();else if(TS.model.prefs.sidebar_theme_custom_values){var s=JSON.parse(TS.model.prefs.sidebar_theme_custom_values);if(TS.environment.supports_custom_scrollbar)_.forEach(s,function(e,t){s[t+"_rgb"]=TS.utility.hex2rgb(e)});var o=TS.templates.sidebar_theme_css({theme:s});if($("#sidebar_theme_css").length)$("#sidebar_theme_css").replaceWith(o);else $("head").append(o)}TS.view.updateTitleBarColor();TSSSB.call("refreshTileColors")},rebuildMentionOptions:function e(){var t;var i=TS.model.prefs.mentions_exclude_at_channels;var n=TS.model.prefs.mentions_exclude_at_user_groups;if(i&&n)t=TS.i18n.t("mentions and reactions, no {at_label} or User Groups","prefs")({at_label:TS.templates.builders.atLabel("channel")});else if(!i&&n)t=TS.i18n.t("mentions, reactions, and {at_label} mentions","prefs")({at_label:TS.templates.builders.atLabel("channel")});else if(i&&!n)t=TS.i18n.t("mentions, reactions, and User Group mentions","prefs")();else t=TS.i18n.t("everything","prefs")();var a=TS.templates.mentions_options({include_text:t});$("#mentions_options").html(a);$(".mentions_filter_menu_target").click(TS.menu.startWithMentionsFilter)},userGroupPrefUpdated:function e(){var t=$("#user_group_edit.tab_action");var i=TS.permissions.members.canEditUserGroups();var n=TS.permissions.members.canCreateAndDeleteUserGroups();$('[data-action="admin_user_groups_modal"]').toggleClass("hidden",i);$('[data-action="admin_user_groups_modal_new"]').toggleClass("hidden",n);t.toggleClass("hidden",!(i||n))}});var e=function e(){if(5===TS.model.prefs.k_key_omnibox_auto_hide_count&&!TS.model.prefs.no_omnibox_in_channels){TS.prefs.setPrefByAPI({name:"no_omnibox_in_channels",value:true});TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut",action:"button_hidden"})}};var t=function e(){TS.client.channel_pane.rebuild("starred","channels")}})()},4360:function(e,t){(function(){"use strict";TS.registerModule("client.windows",{open_log:"WINDOWS OPENED:",win_became_key_sig:new signals.Signal,win_resigned_key_sig:new signals.Signal,win_crashed_sig:new signals.Signal,win_will_close_sig:new signals.Signal,win_began_loading_sig:new signals.Signal,win_estimated_progress_changed_sig:new signals.Signal,win_finished_loading_sig:new signals.Signal,onStart:function e(){TS.client.login_sig.add(TS.client.windows.onLogin);TS.ui.window_unloaded_sig.add(l);m=TS.utility.throttleFunc(u,2e3)},onLogin:function e(){var n;var a;var r=false;var s=TSSSB.call("listWindows");if(TS.has_pri[T])TS.log(T,"listWindows windows_str:"+s);if(s){n=JSON.parse(s);if(TS.has_pri[T])TS.dir(T,n,"listWindows wins:");_.each(_.keys(n),function(e){t[e]=n[e];a=t[e];a.token=e;if("screenhero"!==a.windowType&&"calls"!==a.windowType)r=true;a.no_spinner=true;i(a)})}if(r){S();return}var o=TS.storage.fetchClientWindows();var l=Object.keys(o).length;if(!l)return;var d=3e3;setTimeout(function(){var e=function e(){_.forOwn(o,function(e){TS.client.windows.openWindow(e)})};TS.generic_dialog.start({unique:"reopen_windows",title:TS.i18n.t("You previously had {window_count} {window_count, plural, =1{window}other{windows}} open","client_window")({window_count:l}),body:TS.i18n.t("Would you like to re-open {window_count, plural, =1{it}other{them}}?","client_window")({window_count:l}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, re-open {window_count, plural, =1{it}other{them}} please","client_window")({window_count:l}),go_button_class:"btn_success",cancel_button_text:TS.i18n.t("No thanks","client_window")(),onGo:_.once(function(){setTimeout(e,1e3)}),onCancel:function e(){TS.storage.storeClientWindows({})}})},d)},openFileWindow:function e(t,i){if(!TS.model.supports_spaces_in_windows)return false;var n=TS.files.getFileById(t);if(!n)return TS.files.fetchFileInfo(t).then(function(e){return r(e,i)});return r(n,i)},openWindow:function e(i){if(isNaN(i.x)||isNaN(i.y)||isNaN(i.width)||isNaN(i.height)){var n={x:0,y:0,w:1024,h:768};var a=f();if(TS.has_pri[T])TS.dir(T,a,"sizer_win");if(a){n.x=a.x;n.y=a.y;n.w=a.width;n.h=a.height}if(isNaN(i.width)||isNaN(i.height)){i.width=n.w;i.height=n.h}if(isNaN(i.x)||isNaN(i.y)){i.x=n.x+22;i.y=n.y+22}}if(!i.no_spinner){if(!i.destination_url)if(i.url)i.destination_url=i.url;if(window.winssb)i.url="data:text/html;charset=utf-8,"+d(i)}if(TS.has_pri[T])TS.dir(T,i,"calling openWindow");var r=_.cloneDeep(i);r.url=r.url&&r.url.substr(0,100);TS.client.windows.open_log+="\n\n"+JSON.stringify(r,null,2);i.token=TSSSB.call("openWindow",i);t[i.token]=i;S(i.token);if(TS.has_pri[T])TS.log(T,"new window:"+i.token);window.last_win=i;return i.token},closeFileWindow:function e(t){var i=TS.client.windows.getWinByProp("file_id",t);if(!i)return;TSSSB.call("closeWindow",i.token)},getWinByToken:function e(i){return t[i]},getWinByProp:function e(i,n){if(!i)return null;var a=null;_.forOwn(t,function(e){if(e[i]==n){a=e;return false}});return a},distributeMsgToWins:function e(i){_.forOwn(t,function(e,t){if(!e)return;if("screenhero"!==e.windowType&&"calls"!==e.windowType)return;if(TS.utility.calls.isSupportedMessage(i.type))TS.ssb.distributeMsgToWin(t,i)})},closeAll:function e(){_.each(_.keys(t),function(e){TSSSB.call("closeWindow",e)})},windowWithTokenBecameKey:function e(t){if(TS.has_pri[T])TS.log(T,"windowWithTokenBecameKey token:"+t);var i=TS.client.windows.getWinByToken(t);if(!i){TS.error("windowWithTokenBecameKey: no win for token:"+t);return}S(i.token);TS.client.windows.win_became_key_sig.dispatch(t)},windowWithTokenResignedKey:function e(t){if(TS.has_pri[T])TS.log(T,"windowWithTokenResignedKey token:"+t);var i=TS.client.windows.getWinByToken(t);if(!i){TS.error("windowWithTokenResignedKey: no win for token:"+t);return}TS.client.windows.win_resigned_key_sig.dispatch(t)},windowWithTokenCrashed:function e(t){if(TS.has_pri[T])TS.log(T,"windowWithTokenCrashed token:"+t);TS.client.windows.win_crashed_sig.dispatch(t)},windowWithTokenWillClose:function e(i){if(TS.has_pri[T])TS.log(T,"windowWithTokenWillClose token:"+i);var n=TS.client.windows.getWinByToken(i);if(!n){TS.error("windowWithTokenWillClose: no win for token:"+i);return}delete t[i];S();TS.client.windows.win_will_close_sig.dispatch(i)},windowWithTokenBeganLoading:function e(t){if(TS.has_pri[T])TS.log(T,"windowWithTokenBeganLoading token:"+t);var i=TS.client.windows.getWinByToken(t);if(!i){TS.error("windowWithTokenBeganLoading: no win for token:"+t);return}TS.client.windows.win_began_loading_sig.dispatch(t)},windowWithTokenEstimatedProgressChanged:function e(t,i){if(TS.has_pri[T])TS.log(T,"windowWithTokenEstimatedProgressChanged token:"+t+" progress:"+i);var n=TS.client.windows.getWinByToken(t);if(!n){TS.error("windowWithTokenEstimatedProgressChanged: no win for token:"+t);return}TS.client.windows.win_estimated_progress_changed_sig.dispatch(t,i)},windowWithTokenDidChangeGeometry:function e(t){S(t)},windowWithTokenFinishedLoading:function e(t,n){if(TS.has_pri[T])TS.log(T,"windowWithTokenFinishedLoading token:"+t+" doc:"+n);var a=TS.client.windows.getWinByToken(t);if(!a){TS.error("windowWithTokenFinishedLoading: no win for token:"+t);return}if(a.document)TS.warn("windowWithTokenFinishedLoading: win already has document? token:"+t);var r=function e(){i(a,n);TS.client.windows.win_finished_loading_sig.dispatch(t,n)};if(a.no_spinner)r();else setTimeout(r,50)}});var e=true;var t={};var i=function e(t,i){if(window.macgap){i=i||TSSSB.call("getDomForWindowWithToken",t.token);a(t,i)}else n(t)};var n=function e(t){if(TS.has_pri[T])TS.log(T,"_setUpWindowForAtomSSB: win.token: "+t.token);TS.ssb.setUpAtomSSBWin(t)};var a=function e(t,i){if(TS.has_pri[T])TS.log(T,"_setUpWindowForMacgapSSB: win.token: "+t.token);if(!i){TS.error("_setUpWindowForMacgapSSB called with !doc");return}t.document=i;t.window=i.defaultView;i.ssb_main=i.ssb_main||{};i.ssb_main.TS=TS;t.window.is_in_ssb=true;if(!t.no_spinner){var n=d(t);t.document.write(n)}t.no_spinner=true;if(t&&t.window&&t.window.addEventListener){t.window.addEventListener("unload",s);t.window.addEventListener("resize",o)}};var r=function t(i,n){if(!i&&!i.id)return;var a=i.id;if("space"!==i.mode&&"arugula"!==i.mode)return false;var r=TS.client.windows.getWinByProp("file_id",a);if(r){if(!TSSSB.call("focusWindow",r.token))TS.generic_dialog.alert("window already open; but you need to get a new build of the app. ask in #triage-mac-ssb ");return true}n=(n?"?"+n.substr(1):"?")+TS.getQsArgsForUrl();var s=TS.model.team&&TS.model.team.name;var o=_.unescape(i.title);var l=s?s+": "+o:o;r={file_id:a,title:l,destination_url:i.permalink+n,url:i.permalink+n,worth_saving:true};if(e)r.no_spinner=true;var d=TS.client.windows.openWindow(r);if(!d){TS.error("no window token!");return false}return d};var s=function e(t){var i=TS.client.windows.getWinByProp("window",t.currentTarget);if(!i){TS.warn("unknown win in _macSSBWinUnloaded");return}i.window=null;i.document=null};var o=function e(t){var i=TS.client.windows.getWinByProp("window",t.currentTarget);if(i)S(i.token);else{TS.warn("unknown win in _macSSBWinResized");S()}};var l=function e(){_.forOwn(t,function(e){if(!e.window)return;delete e.document.ssb_main.TS;e.window.removeEventListener("unload",s);e.window.removeEventListener("resize",o)});S()};var d=function e(t){var i="";var n="";var a;if(!t.skip_css)for(a=0;a<document.styleSheets.length;a+=1){if(!document.styleSheets[a])continue;if(document.styleSheets[a].cssRules)for(var r=0;r<document.styleSheets[a].cssRules.length;r+=1)i+=document.styleSheets[a].cssRules[r].cssText;else if(document.styleSheets[a].href)n+='<LINK href="'+document.styleSheets[a].href+'" rel="stylesheet" type="text/css">'}var s=t.destination_url?"document.location.href = '"+t.destination_url+"'":"";var o=TS.i18n.t("Loading...","client_window")();var l="data:image/gif;base64,R0lGODlhUABQAPdqAOn38njO398JXN4GWarg6////7Xk7fP7++mmGvjI2mnI27Di0v326P7///XXmEi9lzC0ieiiD94DV/POgPTSjD65kaHd6Du4kDK1iupck/jjt+mnHffdp2TH2uARYJTYwvOfv+H0+GvJ2+Msc+ijE////jW2jP/+/d8NXje3jfSpxlLAnOEeaYnU4/768W/LrTq4j/WzzeU4e//+/4DRt/LJdNnx9vzi7OmoIOT18PrV47/o8G/L3u/BX27K3OAVYzO1i+v49P7//vzq8fDEaef2+ehTjHfOsu+9VWzJ3OtlmfD69v/+++IkbeikFv76/J/cyOyzO/3w9v/8/edJhvzy3OZAgPCNtMbq8f74+t/z7WTHp++Fru22RKngztLv5tfx6crs4eqqJc/u9MLp3Pf8/HLN4H/Q4WbH2u35+7jl11rEoYnVvO5+qZbZ5ve90+uvM/StyfGVuP789/n9/f3+/vv+/eqsKu1zovrpxkC7kvvu0uEZZu65TPz+/mzK3P70+C6ziP/9/vCKseEVZc7x5eAQY+qrIGrH2DpraOGmILmbHiaaieEVaCmihTUON27G0WWKKza+kV6AEla6wfFMim/O5r4UWtdDfr65beL3/qU8bdEfEf2hw8qCojemnm24p+cVZS+jkPKzOGWCEx+XgF6DHDq8kWWFHOF7GBqSfGWvluqvHvOwMPT3827I1UwPPTWui+uxIecPYWjK4uaXGT22kM0NC9ikIuigH+2pINwSTuMVZNMPJz6/lGXF0z2cgskKVz6qpZ+TGj1WXmaPOSSggrJYgekVZfGqIDSoh4CMG23J2d0UVTqJd9QKWdLDetcRO12/yj7DluWFSOWnIFC2uTcxSdUUYHUQSNlMFGmfZKURU8+hHm3EyvCoGucKXtQxEnvKx+I1aqyrU9wHTpHgxbqSpvFclOmpFemSWtknQzrAk9k1djS8j6jGotufE+HCbGPUrvJTj5Tc8NnCzOqtJ32Jj+yqc+6rjNMHWOJcWLzx3/CfkQAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFFABqACwAAAAAUABQAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDihxJsqTJkyhTqlzJsqXLlzBjyrwoREuYMABEHghho0iDkV9eVEiR4gGNIB6LWAigQAGPFjZCkqkA5EKFChcwrMjBMUSADiJ8iEWjAMtHAA9SXF1bAcILji0UiJ3rQwSPIh0bQIHAti+YjA1ChKU7twMBjy9M9F2LwYvGHWgIz1XQwuMWtYupfnjcQbJYyh6PAMlcobHGMXI9d7CQdwHfxRcu/M1Y5kxquklERO24ZIXivhBo/DwNlq6IDgZAhnmAweoFGBC2LNn4E4uZDmjQdAiwQ6QWGg+srv+AcqCExzQ7CFjAcmA4yAZCloDR0j5kA/cz8+vfz7+///8ABijggAQWaOCBCCao4IIMNujggxBGKOGEFFbYoBQ3DCGSCxpMMAEHDIyUQAYjsNCEETF8pEEUJLRIghgOhBTDDxJ4YKMAAnDRkQYbOIHDjzggEAEFH93QBAo/JJmkBwOocIJGLkThI5A/boBDFeZxdMUASnaJggxPZHSCBiRQSSUJRHZkhABdtqmDRhOUaeaPTvTgERVstrlkAnDKOacTSHikBJd6JvlmRhz4aSYJNXikAqFtCmDFkxlVIYaVf2rg0RRUSNAmCk1yNEEEc0Zgp0cnDEHFADgKIEETIHQ4xEQNLSKAgBOmuhBSFiooQYURXNwAkgZEdBFFDxwwMdIMM5h0grIWRivttNRWa+212Gar7bYVBQQAIfkEBQUAAAAsDgARADQAMgAACP8AAQgcSLCgwYMICR4YI1BEwocQIwpscMBCgA4SER7JCPHAmQ5JfHAseEFPjpEI3XTwIRIlQSALhLgkGIIly5kDTbzAORDLyps8S57kuQONTYgFvAA5WKECEDU8AYwxevRhDj0VDDbF4EUmzgMBRNhsmfCFiaYAmqp9GhXAjg5/xvpQgHABBrVpmwptC8CAiA4K0HTg4WbHwSAPUqhVG+gDX4EhCLgpXKRBQjJ6MFyocCEFhCNlLD8G0EA0RDBHHlTQs8aLndE4l4DJQacE7Nu4c+vezbu379/AgwsfTry48ePIkytfzry58+fG52igMIEDgxPH83RxQoJEhDsUbCennHIjgY4ssPOIcYKjPQ4EESYg1HHFCh8UP2TImcKXSR/27rW3AQ57GETFDwOg4MEPP6AwgBLi8ZQHgAG2RwIFBXkwAIMcciiBHG05QIJ7BOHgRB8RHtQhCiOgx5MDEbSH0B4FPNThDzpEpQF7bTHoQQJRMQAHAlH5yMcNUZVABF8/CEAFXxoU2aQHb/AlJJEueSDAADJUidwALBgBAiDJZQDicjMgFxAAIfkEBQIADAAsDwARADIAMgAACP8AGQgcSLCgwYMIC7pJyLChQ4EHsAhEg+ZhwRcWE4awEKCiiIwEK8D4ArLgmD8dRPgoWRDDhwIsGRw4o2BlTIIw1vhh2QBLBx9ALZpAKJIkSwtogNpsuIChy5hIlT4E8AAGwhRr6LA08FNqwwZHElZIYRRkCJVKlzL4U9EgkIMVKmCA0oAlgQ5/0to0w0AiTIIXDMYFwiamHwIiOlDswKNvmr8Fj5iIyyCu5bl1Y4YgYMHCjjQMMh9Ug4Gy5bhkbw5sIJphmTVATseFEFY1SzArIMC4cCEFhC1BbMcEwGZFBT0roBwoITxmiQNatJRpTr269evYs2vfzr279+/gw4vyH0++vPnzGV1ooEBBgwvzGqKQmB8BDofxJTQgcIKjPw4EEdwXngtw8OdffwiIUUVDJUihww1PqFYCByQceCAJDiBUwBAqZNAEIXzIcEUWN9VQYX8E4eAEEswRNEQcHgoggAc/eICCBEZIEZOJKB604EBKNCHjQD8UWaQEeJzAkgMVJuQAEwL9wIAHBxnpAR86sLQHDhswBFlCRv4ggAox9YEAdUUOAEJMTDKUoUNGChCDICxVIUaXqlnJwhA3IeGEbUV6IAEXqr150w83snCFkjdVwWVJiE5pxSA3MDqeB1ZwoQOd5RnRRgJ0zjBDeV+OFxAAIfkEBQIASAAsDwARADIAMgAACP8AkQgcSLCgwYMIC1pAoiChw4cQkYwR2KFDxIJHLiI8MFEgGo0FYTwAAHJgEQsB0HwsaRDIApYhAnQQ4YPlQRMvCoCk0wKNj5oggSC8oCcHyDEdfgK96MWhS40NCCT9CTKHngoIceq8aMEnVY0FXiQkajRiHQNTlxr00TCol60QbShQ+nVgQx5IdiBpMLBsVrEX61hIq7ShmRY7ivA1CPggWSEXy7jpgEaBgqQtkBQpANfgAqEHKzzV6GeMmxZuDGyOCOABDIMVKmD4YHPv4ohCjpiIzZs3hqa1S6rBEBtJ7wopvgQH2SDIgxTHK0BovFyjGhO7Y1+AsMJv9Yh8yaz/gYFdDw2S31naAaOGTI4Gt9PLn0+/vv37+PPr38+/v80qFPTQwwR5+FeQA2JE4IQTJDhRwxwGIsEBCQjgYKGFEdRQgn8M3FHhhRZugEMV/k0IIogkOHBCfxOQcCFBODjRh0ZT6PBGAkPMUBIFLuJgkIh7PHSCDldY8YMAKLCAxxAanaCBEz4iRAFCMxBJxQ8DoPDDlh5IIMMQK0bU4QYJ9dEZElZiicQPa27p5gAZaFQCEQ8FOdCVA6x5kJtb6qCRBg9RsJUHeibE5wAqaMQAHAg4tKFGbgoAAkhEkJAQmSBF+oacTzo0JaQ/oDCCFCAt2uh3W6IgaUkFVJqeAAOMNRBDmCB1WpsHsCJhBAik2uQCoyXhigQfuyJxJktTYnoRH1TIccMMOlb3KEhX3BAhQifQ6l9AACH5BAUCABAALA8AEQAzADIAAAj/ACEIHEiwoMGDCAu6gSAiocOHEAViEYgGTUSDLy5G7KDRYAUYYDoKPDBGJEQMHzqGsBCgokmHKbbUuWjDTAcRPl5CMIHw45eIZc4o8JHz5YKHKSFiQUO06MsHMBCmWOMHIgGmRHUKOZLQJ0QLWJ06tCgSJUQDHZpCNANhYkEAMNfQeRgCp9qDPBamKYCQa08YPx8S6PCnaVYIPASmadAgoRA1Ds06bEDHgoIOFdO22KHz4NQyEW0QcOPGQJECfDXyBfI3zEXGnQWyPlhBcuyIqS94rACExu2OXCsMrECcN5vfFwuoAVK8eW3IyCMeWGHCeQUTa8qUiB4xjB4gF4hf/8DwIDD3iGBeXK/+Qsv5jkK0kCGjpfH7+/jzD9xDoUcPClXo9xAFG0TghBMR4ECBgAeVQEEEG+AgIQ4bkLAggwTtQeGEEyIgBgMnYAiBgwlyOCEJDogoEBEkTFiQE0ikxmAJLEp4kBgqQuBAgg7J2NEQCegwxEUabpAQEh0VMEQcGTTxgyFNKHFDRH044VAVIfa4pBJNQCCABx784MEATegAkQMkJBRBiggVIEUcXAowgAcC/WCnnQNYkcVDexziEBJZEiRFDHFCQKdBd/4wQBwPFVBlQn4WpMQIAhgKEZ54nPmQAzMM9IOlEd05QKYOnVAFhT3qJCoXgR5pJUI4dGd2JwoJQFQAmg6xKZKdHkigxEVViGFkQtt19OkAfLSx50VIvHrbpxD8QIUcN7R6ZpqyohCtFVfoIIggnXYU7LDGauuBFVzoMMVtE0AQa0ceyMBFAoL4qJO9F7WRwBMQoJajQf7+C0FAACH5BAUCAAQALA4AEQA0ADEAAAj/AAkIHEiwoMGDCA1aCKAgocOHEAeOEdihQ8SDR4Rc3MiR4AU9WjqK5OilQYGTKFOmPDBx5EaVME+GWIgGjcuBQCro3Knzo5aYKcfw6CDCx00CGh9CAXoyDUMfRo8K1MOzqoktTAsY6AA16tECLxyCZNpCQdezaNP6aDhyacwGZbtu5OFmxwGYOR5ifesGjdyHXh2GTVgBDNCtaA9GLVLgYYEFSoGWOeMXrYIOPFoYkGpwb8wQZzooEHH5TwuBJrO+PWKialXDQA8YaHFGc4gGnB1CSc10Bm/VqgE4vJo099EKF74AX768+MEKJtwynw40yIMLrnUCYUO9e0zW2StA/5DuvbyanNlNhPnNvIoDIkQo7Jm+ZEXrqkC21PHuQEwEEiREgAAFJzBHRgVAYIccBCv81J0DTiCAw4Q4bBDBBNN98QJ0JuhBQw7dncDAHRJSOOEGYlQxnR9akBEGiOU5QIKJJpLgQHcNsEddDTPSOKETSJQnZAE1OOHjiSmWMCR1J3Awo3FSVSHGBg4VuCR1SDiREA6cTaFDDDHoIEhWHECkpHcn6DCIFT8IIMAPVCTAlJQO9dHdDDpcQcUPA6Dww59t8vEGUz2Q4NB8y+W55wBvAuooCiNIERMTZR51gxyL+unopn8OoIKVKlVhT51npnTCpVQQwiinrP4pAB6EOnrEpUFGqNpoq62+CqpKlSZEQWMDeTAArsR2egVQJYz4UAmc/enBDzpk1YNDVDaLwgBtqNYrQhRIJcAATYAAnLIOAcuRBwKxYAQIki43LZQC8bHuDd1te9O3fFAhB73ljYiAS9/Cue8J8HL0gxVXRHsCwQVfNIiYDT8UEAAh+QQFAgAaACwPABEAMwAxAAAI/wA1CBxIsKDBgwgLutEgIqHDhxAFYhGIBk3EghheNLjIsePACim+eBzJ8UMBkigdrrHz8MCYgR1S0khYAUaYhCEsBLCYcqAahxg+HGwwRkQHET56DgTw4ALCFGvKGCzCQ4GPpEoHHgGS0KZBAh2uYu34h2fBnw7ZGGyB9CrHJBbNaJhYMMjDqAVbWHUbEQ2PuQ6POExxk6AbNGIh8liYRsPJhGpMJASiluCOsIkPyt2RZmNEu04PwlghdSCdFpjFYk26Q0MJj0JocEVoorDABmlQo1GgIKzAIo9RSkZIObhAOljctHBjIIRxlEs0wEA4+gDCBp6zCpSdsLYQ7Q/rkP8ZfhBCZY4lqlAgQsQBg4vRu6448DpiCQobIpAgEeEOByYRcXdQBSaQwdEEEWyAw4I4IEACBxGNh1AFGJz3UB4bKMjgggjA8V5E0xVUAYEvRDQDghtu+GCAJowo0IgjAkHDdxAh4QSDBOHgRA8RAlGBBjDCCMECF9m44EF3fOiQH1tgEOSIJqwQH0QUkIBDQv9BBMYDGFww4gVA6CHSRXkgcKVSORyhRwom6PGCFtlBxEQXCCR0h2P2ARBGGDmMVMAED0EI3kN7mOnQcyg9kYAcV8QxREElnNBFQjiIkVUCbcjgwQADCMCCHCcUVOVDiEIkSAJcaDoAChr84KoHErTUQdAJeyiYEBIdTYGqFR4Y5OqrKCQgyECS1omQGFVANIUGXPCqAasH/frDAEoQVAAFDpHg0Ak6DOJsRL+iYEVBe5yJEBLPFaDDFVb88CxH4VJhUB8OIVsQFe5C29Gv1IZKELYOOTDorwLEUFAB5TqErnb5SoBHfQXRS2kVEKPUqwAjgDDsQQAnJHBPAmigRBxSOFSFuYMK1EQGjkL0msRZ9aoBCxmoMIS/F32ckswsGAGCBoLM4FF6OGwwksx8+JyyR4RQIccNQZe69EFX4DmD0FMfFBAAIfkEBQIAEwAsDgARADQAMQAACP8AJwgcSLCgwYMIDVpIyLChQ4JlxjxkCGFCgYkHywxUgAYjwgpgPArUKHIilAYTSU5QUPLhFiENVU7o2FLgEYYXQmaUeGZmTYINFlCEYrAIgQBoaP4smENPwxkEbQTooMDH0oMlJphImHPggTNofFit6YPlQaEMPww00EHsWI9lJ/CYsGMCyoENADCEMcGOXTdhxYrsYKZF3Z8XvghsUVXwRB8tJhR5uABIQgxqGwB269CqgSIXJ+pNmGJNHbodknA+mGSCAbslCxzZihDGlwZfA7sdK0JgiLs/LSPE7HuqAhEiOojo2Rd4FQc1iDiogjHIhAsIS9Oxe4BAiwAtCIT/8NMA+AQHYiKQWC/GAcbZCfmGnjCDjp3y5s9HQICjPw4EEbjnUANqCHcQcQ6VUIUY/PnXHwJ3MPCQdaStQcd8CVFAgoMOksDBCQ/dFF8YDxGxYX8E4eAEEhOpkcJVE5iIYkEbiEHdQw9UKBNCGuKAUAQeGVhQBSmQ2NAeOGyQEIsPqUGbQRUAoVZDJfTBkI0PLfEAdkNGSQOM52GYEA1AVFCBQGaaCQQbDyGp5FVkYJDmnFGSkVVDBfThREJiPFQCHWuYQGcFGGyxnUMnCJiQog198QAGF5h5AQQr6ESQIDqoAMIbgKT4JkJ3OqTFEXqkAIMeNORA0Ak6XGHFDwII/4DCCCpYlGdCn2KUQxhhUGhRq1T8MAEKPxT7AwoDXCEQo2AOVIAOcgQ7gQAEGfuDBx4kMEMVSSZkpUfPRisstQdZOwAeFiGxJ0I+gtjQCTdEy8e0DhkrABUTlMBsQUAyVEC8RsxL7kPGokAFiDd6exC8IAQ8rQciGTuAEgMxeVB/exjksAAQtyRxDAPtWxAFB3X807ESUDzQggx92+wEHggwQBNXTFGQxQjtIWZNMrOQgQpDHCQyQSRfNQALRoAwhLsI9fmyQMJOwEfSNzh0Ec5XRf0DFXLcIAhUE3EA47ETbC2HDgXsjOcETpdE9g9WXIH20x55YAUXOpygNt0JcQiRgCC28o1QQAAh+QQFAgAEACwOABEANAAxAAAI/wAJCBxIsKDBgwgNuknIsKFDggewPJxIseCBgWg6VDyY4stGAhc/PvxQYGJIAmhEOlxjp+FJAhpVCjSREMYXIQdDBoApc2AJNQwxfLA4xkLPhAAewGBIR6ANCwHQoBFx9GADAkBqhpmxI6MIH0f/SD2oBkPDEAq+glWZROrOMQRKbmyhwIfdijx4iCUQwA2WlxtTSDNjd21DHpYsSbVE7+/VhkATAhFG+O5hAqu2LSMXbw/FIAxhMGLGozBDWpC2LYL3LVkEBBRKUMx6UI8xSpUNF+RBYEefCN906cKBY0MEBxRp1o4lrHRhuwoI+GhBoEgBDk50bSDOHcEdBg4bLP8hsPRgBVs80ChY3yEJAQPWCxQoQYQE9/s4SHCYSIP2wQtqGNDCGW4YEEID8slFQB9OcEcQDk708JCCCJnAhkANZIgQg8QZtAFF49W0wgGyMTSBfQxRmBANDKVAhkN5IIBDQhI+RIZyB2U1Q0NzdOFEQt+d8NAKIgJ20AQMkVCRWRW+2FAe29FYIkMNOLmiQyd00RB4Q5ZnEAwrhGhiQxwwcVQFJliJ0I4yVkVACghVAAQbODHEhJZVHbCClwNVUEEKWxz0RAJXtCGHDgSkk1AE+z3EBgZ+CuSnnya8UCcBg7YhAwoDdNqIESQckqKNJkxqqpzmECBIApp6MAAKP8T/+oMHAoSDgKg90bFGqZPq4cs0etTDhRUeGCTrD41Eo40suMoUhh5AVPArDMAQswkyBKCAkKyG7BLOjAghQREY8rgDTCLXPMINCsUyFCshhvRSS7MFiRGXQwXowMUm3GTDDTahPCQrH9HMi5CSDM2gwxVU/CAAOLPMgkzAAsdqyDiH0FsQElMOlC/DPwgUMgGE8MILRbJKcEWNB31YhUENi3zUD5waIQgBETDkQMcyH+WqACPI8UQJe4DrJkUCEKBEDFIQ1EdDVQjppgBNEBDHQVLrfHQGKtybkNFHE9AuCwIN4ZBsT4ctEB9GgBBXATPs6BByVSXNh0A3yAT2RkkTEUCFHGp/FPIVXgdeEaKGNxQQACH5BAUCAAYALA4AEQA0ADEAAAj/AA0IHEiwoMGDCA1aSMiwocOCYx5KnFiwzEAFaCgavFABjEYDFj8+hDIxpAEFIh1uKdDQpIGMKQUCSdiRpUGTGGMObLCgIUmCLnUezKHnQsItDUBGPCmRBw+KBV6YSKiHDIEALx/ysGTJKdeCPgx0OLhg6kE9yoTRShLWoVNQ24oV2waqqw8FHZ5iMZB0YIEcCPUAUcXIx1O3kLaRIoVqsalttJ7uSNNwZkE9xlSpmshDMWNUpkyhWpYpjZ++CXsatFVKs0RLoBiHRmVgWDcErRg8BGAABkE9rF0fZmhp26TRw3DpMpBMFwkOE80ODK5ZWsOM22zrSmYAh0AcTnpM/7Q8ELPmzWaGCxRhQMQZA5qQfPvWveAGA1UcFghiwGj5WOcxkgQPPvjA3h9nEBBCHQJREIF3Qh1hEFrnUcJDBwokaIMfBe2xAYQIleCQEAZI919mwrRAgA102FQQEw7l5xB/Z+lhwhpluIgQBQ7N8JCECV3whUN74HAfQkhIpAZDGHyAGkIF9MGQGFXoeFBSDySUwhp0OMRjQk44MJ6WYRBpZEJIWHlQAUsmBMEH+knJkIwOPeDfQTiKyJCYe6qp0QUplMlQCVXIIsshQpXYkJ8CCaIDCPukUsshiB6kZ0INLMEQDCsEZUABOhhgxQ8D9HLLLdpsUOlAJPDpEA00Bf9K4qc6XEHFDwag8AMhzZx6SziUGnQppgxV4I45oMpxqwECEPTDD6aemoosKS2xgm8DVSCQL8Dcs2yzCfnKyZEFDZsQDUBou60BiVzzSDbgNMSruJMWJKdDZLgzjS8EPeJvNrPwwtCuBviay6rf7THiAau06+/D/mIjsLwF/ypSATeAMA83EEPMDTIPzYsqtQbdS9AJQ4BgBAu5IsMNLBDD8rFEhBjyq6oIKVxQBiwb4MFAyPDCDTfZXIINyA55IIAAI+xzcEIUqPmzQaEgY3UoEzPUbBMZxAEIA/YkhIAB5iZqwAAsZKDCEAQlydAejH6EthEgIAQdQ1+mhKsBfNBLfUNDYphd0N58UCHH34saIJ7gA/1geKifxk3Q3UKhYMAPVlyhg48alcDAHWOLZLkHVgxigCA6lT3Rz22czrhIbSQwxQwnnPA6QwEBACH5BAUCAAAALA4AEQAzADEAAAj/AAEIHEiwoMGDCBEqSMiwocOCHTo8LIgBQIOJBw8MjIjRYAUTXzoK1Cjy4QchE0kCQFPS4Ro6DVUCkNgSAA2GKcIgVMlyIA9Llnj8tPSwgBqGQNgQvMiQB4BV24oV2+YtqMMgDxLCWFOmBE+EPCAVI0UWFSlUq8w4FEIDyEE9ekx4eSh0LKq7d8muIirwz0qDRw3qieVI1ScAIhpaWnUWL15SkV7xQINGLYAyBZcAgEFQjzJVqgQicmjJLl4AeCftBYBFZkEaJgYOBh0aAKWGPJgVc5yxQIGEQsjEFqjHGO2JTu0WXITrGwAXDjVfEGir1HHRirdNMiVwUTeBunA4/9FQwmFb6tZBD7zNkBaoZQJxGCRB5KFw9NcBHPZRcOGfFgDkEAUAyRyEABwMRLcCZ8XlB8BoAi0kQgsGWCRQDSQwpMFDNwEQF221ETQhACHUUVAeTiREn0MFkCFbLCCGdphAfhxUwhxRIIDQgQnGtCBxJjhSypDG6JGGQxNE0NBvDNWhlGx6yJaCiwyVkAcC8h20okNUIgQEDUwmhKOOCN3RY0JeraDVCppVOUFDHDz0JEImkIESQ1dmeVAPa4WRQkIYdMjQHF2QeZCZDh3wI0IPLBEmQm/KIqmkhxAUp0NzegRAYAkxsQcOqWgjaioAsDIQnw75yRAN5SH0RAJtcP9yy6yzclJLpQAgylABmCV0wQNBGDQFrDJ4AEA0AtE6660CXdoQG27RqQaTw3JR7ECN7DKQsuHIIlAPjx5UgKoISULDCQBwYYWxKDCkLLMAnJlQGWv8qWkimMwCQLsOKZuKtwA4yxAbFQ1UAUGPcINMQ9omS2sqpgKAxENhnJLQI9l4QAhDPxBEay64moluQiNfDAsAvDDUSC8O36JNxABEIPBBV1SSDUKPPAJLyhPVWosYBCERriA3yEFFyuBwkzPCOWO8cEPt3sKJNtXgOpAYVRRkRMcAdMxLKLA0LXbOl4QyUSq1yAIzQQ4YxLVAvCBzydhNK9yQEjFIscchVhd05ITQDsmdjdiwcIPNQQIIFEdBfTCE9UNmcyO54aFsXFAGKohLQUNtT4RMKI3wkrKxArAg0BCClFzQpyrWNJARIGDUuOsM3SCIIDNMtDntBFEhBwDhPjRDFThs4HrHVwAwQ+41Bd8RFwCozntJ0APv2/QPBQQAIfkEBQIAAQAsDwARADMAMgAACP8AAwgcSLCgwYMID4pIyLChw4Jo0DwsCCFAgYkHywxUIBGjQRhgPAZoQEfgGVq0RDK86BHUtmLFtnnjwUNlQRgB/DTUKPDXNlKTTKEiRWqVpZoNj5hIeOELQp4BFAT4s20SKVRYsRZFynABQwwfCLI0aGnV1axaSUWCxBVhjgA4D6bIWQCq1IKWfp7FGgBVgKKWGjZQmtCWV4Y0i50t6HebwQ4GDw/Uo8fWQGEOeRTja9CvN4GQBR4YGwBAgAsC9cRyVIpgEsR5rz5Mk/BIamWqVIm0BMpvQnIjGzBUA0R1bt0imSEcNpCBQ9MBSh03uNDjMFwCkwUgwYE0wiOBjiP/tylQl0EnPR6qwT29IGaErwOE6CIQh8ENdwKUaBjElviGC/1xhkB+CDdBQxw8dMR/CSkwoA3BEYRAQuh5d5AaxjBI0HsMMUEfQvg9tMQDGYqXm0APBDCDQyQ0tB9DDdBggjKlSFeKI7FYBkMYDZ2wR0PpPVRcALakYAtlA7HhkIdOJCRGFYKNmJoeBx3QkIUFtfgQDQ5hSdCPDCHhUB1kLJWQkgyVcEIATQZwiCyyHMJKnAFA2dCIqCG0wgEvJkRBm7mkok044aRSSzoBrNkQlwyRcWUAuQh0y6SUcpLKRGUyxEYdCQHyhhIGUTrppUzcyRAMKyxhkKd4jICCAAhR/xqOA1s2RIZwAbDqKkHNHCRqFII4lOlBp7jDxhMJtPqqBxNReqlDB6wQV2rTEOkMMe2gEACzHjlLq5ACVRvAteQRNCknEWAkibXEHITMDypNqg0rONiZkBBZANNuQtg0REg0BU0aTi6HkPDtQVMkwIUMDT3CTSjdWurmQIoOVIDCVjA7S8PZIONRKjiwQpB9BWUsgLYBhAJvQo/AAvFB2qLA8MR0GlTqQLASBG82CD3ySDa8GDQACiPgkcAMDMjCUB8OIXOJzwT57HPHBRX9RhYqztAnQjiA2RAsUoft8yUbCzCCEm8AYlAJB5cbytNi+8wNOE0oEYMUBRSwokFViFJBoX5NXwK21LBwg04cUkwkZrkDIeNBMNxwc4wKQ+TtpUFt2+QBrCwYAcIQdXDq0UV+q7S5AHx4fkPejJPHBxUgrN4643LcsObes5N3QsW5TxQQACH5BAUCAAAALA4AEQA0ADIAAAj/AAEIHEiwoMGDCBEqSMiwocE5Gogg6UGBQYMyWAR26ODwIAYADToKZICEBIlvJCIsemdJZMMUYUS66EMimaJFw1CZmgSqpcuEbEQ6gIdTpylUqEgV88Hj58EUAMowDImFHClTR5ECQEqqZ0c2HxHCDGnwwMBfWJGiMrjNUtOpZEwkBBJ0IFmCf5gVI7W2INJirzouWZEQxgqpZgWiKWhpG9++BkF1LEADiEE9Ak14aWgJFF+RSQAsNkgGqkDMA40B+NSQB6RICZW++iM6gIUxZe4CKHFgBQw9emwBUE0QEUMfHUEFADAmMcKgsYyVckqQFMNMAAoU0G0wjCNVqqgP/3x9cJEiAKPmdMRSCjzCUsZ/LgKQDIAuAE40OPTT4lN48aINtAguB5FQg0NFmEHJfwixhhByO+QwCgA4HIQAHC4UwJANfyDCiEsL+dACAEVoB8CBCeXXUBF/mCFMQ9YIlEQLBhTRgIkC6ZeQgQ35cQYPCzLEmgEhcCdQAXNEkdCFLjSERQceMliQIxVk11ANTqSogYYJ1WEALf6BJ2WVKZDR0Ax5ZIlQBChOZYM4qpRSiiOxVEkQDQ4liQBCTJbQUAFlrCDXUwAs0dAJDanY0QdhHQSEGg6ladAhrMiSTg1MOFRAGDDMhWdDeg7ECoWpaGOqHDc4ZMcaph30wBJcJv80AQmjVggAJ7fkeks5LKgww1SMJmQCpAxlCkAttxaUay+GCBBHQ1+0ehANQiQ0RQJchMPQLT+gMIIUDNHBakIPBGHQFDpwYYUhA/SybTSNCBBDQx8w9CiXgugwiBUeELRLQ700MoAc0HZ6EGY0FKDDFVb8MAAKTt3iwQAg9LhGQRX4AoAewCSCCS8AQIyQuwndEo0hCQhCb1gac5yIS41se0svVKgMLTsA+NLxQf0CqGsCxiZUAB2rvIzQIw41QrKynGgTgY4IFXCDHJUASFDMBmmTSi6W9uBnQSfcAIIRfAAAziUOheKStrkAwMohAt3BgEFkDyBAv7yAzNAjlyDOwzMAAowgELIIcRCrQAP0LJDee3PjN0ECCNBEBnEMsQfcCfVgNUGPZEPQACxkoMIQ2RVwQhd7IiT31wnxonZCj8DyDOhGgEC6QRQ0xEFHyHBzdOy1pyrQrwXtYWuBRIh0ySNID8T8NYmAYqRBJfSx+UC8ZMP884kAcwo7hYiU+/XdBvMI9MDoMc0pGEAhEqLHO9Vt4lYMksAR7KQARAorqFGtSKyjDgqs0AYdCKIBfgCAFtSwgDA453oOaUMCnjCDEyAKguKZwQxwhEGXBAQAIfkEBQIAAQAsDAAOADgANwAACP8AAwgcSLCgwYMEmbhwgbChw4cQA7ig0AUOnB4aImrcaHBPlAhOECAg4aTGiYINynBcWdBFFCc4YsbcEIHCQJUBzohgyfKEgwgyZer61srVmJwK0PAkCCFAgYhIYMbUlSyZogDDQNFaivACGIgnoiCgGqCawGUCt3FtCEUIxD7frgpEFcCUwEje1ho0scVtwwINMg1Di3AVyyMmGsL48tSgSgJnQE2C6GNjgQVAHH4g+NQG0gC0XjkkFQnSyhwPGqZYMyMAHc9nFLA0zFEIYoMVBNpSk1MvwcodHi7AMDD3QEcBhEFkVowUQlSovPFQ0IGHGywH/gJ4cEFgd+S/fa//shRgRxqNRzKDNygtIt2G5NI0aND4YRFxqvT6KHZwGK4ArTCwERY8tOcQI0msNEwAugSQTAAkcBBRAzaIkIQZEBmI0FYCDdPNQU70oFELClRmzUPKGbTTTgaE0IWDB21wBwMlODRDGjz44AMPv5Ty0E4C7SQbASHYMd8EDkUIkQ1J6FjZJw9RIpACZxBggx0CNSBQHhs0FCJEITjpgxknOqSclXQgdEIXTiAko4AO0aGTjjz6iJAxqUFEAQkNRVhjQzPs0IGTGCJkSwAXhPEQE3t0iZATSEDkhwUdlEhmAPkZE8ChBLEBERNsuilGFfUhFOgZPOToiDKcFgRDADg1/1SCTX1KGJEfaRThBw2JIZRCGH41tAcCB8kSQC3UKEEFFXjoIAhEavSKkKeL9tGmQLKwkotAnNxSDgooSODBIBAtwV1DKxzwZ0M2GbutQdE08sMPHgwgx0MF0JBZQ4o+VEUAqThEyLw/oNDEEA+RIe1BbJRaECBv4MHJQ80MPK8AMZzU0BIrvIpQugZBjMcIAgQQTUQE2wsRDQ6ZQMZAWUQ8AgoBeCBQMxAR/MMAIECkMEKnSMLGEwngIQPNNq9U8bwe6FDuCgXpMc2mzhBz9EMnPySvBEZEVAcbmekhUAVVb0QIzg+hMAAVN2hEhiQBkE3MQcj4Ng4IWWgkRBbAzP+NECwQEZI1Qqk4oNEUOrRhRUR1N0RIQ4cEwEofDheEOBdW2DwLNxA1HpE2AeAgi7ECibGHQ5kHgMIPAYTC+kPY8HIQzQHIINC7Bzmg8UECvC6Q7zyNoMQbgDAgCw4N9eHbQaEMJEATSsQAiEAzlBBVQzjsUXlDP2Dz0CMBPK9EHFLk7lAEhq+UjUOPHBMHwk5VXoUYXorIETKcN6QMtQ4VEOnyAuHFDwBXkFhMYxqSWIOWHpI+AHoAHOsTiDKm5osKVCAFW4DIU+jnm5L9oBKeUIYvpuELPVjQghhgmQaXx7p7NYAOWzDBCU94ARP0C4AOGYQOSlCAHgYgDDCQIQ0xA/GBOuDwL5XTEhlWgIEmYqACUPDDEZdyADV8gA1e0MJ8priU+fTwi2AMoxjHOMaAAAAh+QQFBQAhACwKAAsAPQA9AAAI/wBDCBxIsKDBgwWZuGBSAqHDhxAjEizBYEIXOFGI5JHIsSPEPHciOEGAgAQCBx5TqqxyxwmOly83RNCgsqbEGhFg6nTShaHNnwVLzImCQKdOBBsJFjgAtCaDOxteFsRBYsJApm4CNFXpAk5RhKOWCAyAZmtBDCEaRCRCAgfEDmYPpggD8YQGlwMVCUQVNyKbAhBdtCpoKgTfEMVe9TWYYg2dhyXK7HUIqikNIA7nImRqIcSqxQaFkDHxkE3BA2NCaIULKdLhg4mBLlmRAiGMFZJRqy6bsrJBBRwbXDaoR6AJL6r7igiB5kzH0QOLDzQW4lPE1q8LkioG6Q8aNAEs2P8oA1ji7IG2QlAniGgrqDMWxpRpoNYjGwjqEVKSSMrhsExMlddRA2XYYNYrkRB02CKKIDCKCyk1YIMFASgA10OltOcRg8mEoEsITtDkkQUdlOWDRPsh5N1AHBpEQg0eGdCBDzQKlKJD1v0WAg9u7ADAKB4ehAAcLgj4UBpmiFCjQIgwApGGIQDnQ49pFGAljA6FyNEYMy4pkDAQWSOQDy3sUEQBapWnAQIOkUAERzug4aWNEH3ihgFnIjQUm0ISKREWctJ4IpNOIuRICEFEVIMTWYoIURE+JCEoQWAeVEEIJpAB0Qx58HmQmxyRKOiSNx4q3UA0RLQnQkMyINEBbnT/oEASSYjQgQhnxBLLpYyFINZDJ1jVaAhPJNBGBka0kYBBdBjQghlmnEGADQV88BAQahh5UB6MTsUKiOoMIgMKAwggwAAo4DGFQX4ckMZjaYVRm0OpQrRqCDiwIksItQw0QAg/BCywBHhIRMca8x70wBLaGmTVt26FEA5CAv/ggQfLQlTHB2g5pAZEJeyBQL8TH9TIQBUPwIVEYcDwEA1COCSIDlyU7FDAKAcsgBISlYEwQhc8kGhBM+gwiBUn9+KRwAMULBHHDmE7UNFXUPFDCCh0dLJATIMgSERCfOHyQXq4Q0MBOshhdQgCAKVzE0NwZMfPA1XgSwi+AJMIJnyw/+2Q0hL9gIIETbzRUbVo8Zp3IlrvEpEhWMvQxg0pfXEK3nof5AEhTY2ARwJZqNQAHaswjtAjETUCOGgF3ADCPBKF8tDWB+XCSjo9eNQ6CEawEAI4l0Qk+82QCzSx7d8O5CpHGfgugAch8CLRJchoLtAIAvWLr0EcMMHRANAPJL1NAzSRQRxD7HHIIQiRkDtoBcGCzPgDsJCBCkOcEIKVfTwkRhU/4cX4HAKLYISABUYAwQ0EoT+CUOAhJOAA/AqyiU5QziF7iNin9mcT6QXPIY44gkT6N0GBDJAgwCiOL/SQg4g8sIQnDEEKCVIBDCygLtsDTdY8YAUZ2uJuvBJIBXpM8IKINESHMuBCAqbwtYTVrQJB+1UJD6KsJxAEChgIYggqwMXbSHGKU5tBaLQARS5ycYtD3AIYPfICIJjxjRC44Ro5ooUHuNGMF4CACOfYETBswQQYAAIGLsCGMhyRj0akQxg+wAYvgAGRolNLA6xEyUpa8pKYxGRAAAAh+QQFMgAgACwGAAgAQwBDAAAI/wBBCBxIsKDBgwhLzGGCsKHDhxAhunDQB06XGntORNzIsWOVKCScIEAQAYGDjihTGnQBEodLlxtIcFBJEyWFCC9zIogyp6ZPiH2c5MzpRMPPowddwEHgsiAOEjWQSh3IpIvQgwjguCgw1WCDHF++LNlYgAgJHAiLGiwDIkQarjXBHNEDAwYINmMhariKsEYJgWwtgPAhAoSbmmH0YBgIA8KaIA//QnSF8E8HEWNSLllhwiCEI0IgRoWIJslBBWbShN5Yx4vDL5EbLuNoAOWRxQg/RBxVEBUIUyBQRYLkEI0bPxyFvOjc0I7DAs67bsR90C5CtgRAgArukIfD7B3VAP9piEE3wTI2QJwBgQYEIhCkGg5HKOJPCJQAHlg3mGINHRBsqQdCB0gVtkMDKR1xUAUCpbCAegpI9ceAAWBBk3gDMTiQIyAIA9ErDgnnjXcdmOEGFgfUFMQDBXFIUGE/rWLJiW/BVRMNArkoHQizvYUUHfchVQxBwAmECwitMPDTfwSs98tDjKQ0DC66gICWTDWF0CQaBILgXU0+RCjQMN0c5AQRNO0gwmUFWfOQhwgl0YIBIUQBQjIHbXCHkihhgYYIPvhgUCkcFabAnCHUAQITEziEZUd0nKFAoAd98hAlAilwhgE2IIegQHk40ZATPXTUgA2TUmqQmw+1QIANdnz/SlAJDDWkJ58b+RmooAcRipAxtqT40AQkNCSTjRCNgQalvBZkaUMwhPEQsmaWetAJGhVUhA9/7HoQqwNdUBAbij5kFUJ6gpAtCEPEoYQVVigRA0ENWNDBrviypwAPoihjS3UgCNsQtQalM5MUMSjRhAACoIDCAAIoAchAB7RwWaAioIFGABaMUQcbGOiBkAlkRISAQYfIAkIt1OCxsAAe/CDzzBIocR4BARAWwIkHICgEGczRVEBVA6UsUCoDlWOIQTP/4EECBZURQggCD7TZfgatsJETKuciECcQNT0AFx2xMV5DJT8HQi5Ig30QIQfNPAAeHQE9bUNZvIGH2w01/9MI0zIP0AZHJRywAtYG5UXQE3rLgIIA0ag0swDzlu1Q0CBkkQAejhO0C0RwFySzBFZk0VEBdh90yl1TJNBG5ygc9cPDVuiQkuFY6zENCLY4Q0w7HkgQO0KRczSAB1bI8QRNZoMgsvO+cxT6Q7EjD4IO66oUhiQgMEjMQbz88NM4gwsCwgwz1FTAE8B8XxMhxe9YkCA6cGFFRMg4NP1BKiMhmUr0G4QVxLeR/DWEEMMDgTYEIguVDaQKNaGC+FBAQGxABBu8+IkDCAaRN/ABBAQ8igBAIC9AVIEVo+pDSobgk2yETyACaAII4iCFgpwMIWjJHkTkcEALOuQR+hBIBv9UMIQCIIuDBTlJRzLwk2Owq1wHgSBaEEKE/0XECA35QSgiIiuVkMBaHRlhFhGyO3Y8AABdPIgSETIBK0KkcgjxgEF8UZCzqU0MDckDSmaARYT8gAoCOcXuDgKaaVEABBswCJpQwhUsDmAgyBuEDqCzBofoIQcQKcEERCUQEpBgkSqZwryMkAEu2I4g5lkQEB4UkTxEpQtEMIpPjGhEbBGkAF+AgYYKUgETKCgiJXCj/ATihzWkYEH9ic4wafIBDOyyexWoAAzWAMVlpgQMuoymNqOJARxZkyYNeIEzt1mBC5hAWt+kiRYeMM5owiAQH1hNOlUChi2YAAMYAIIeoJAdxnmihA5hgAIUFgAAfyKlAQ2gpUIXytCGOpSWAQEAIfkEBQUAAAAsBgAIAEMAQwAACP8ACwgcSLCgwYMImQBYyLChw4cQI0qcKJEBhYVRiORByLGjx48c90SJwJCEEwogU6pUySBiBA4nKMqcSZOmkyguVurcSbALAhxAgwIlUbOo0aNIkyqdeIKn05Q1JhJ9+LRqwTwUiQz0k6ZIGasfZc6JEhHHt1YuQhhoYYZHAAtFwAr0A4ZMmCADZzoRiiNZMhzdFprpoODPHxEdeIwBG2bLhRQmHrBZAjLPz75/AwNAJVFBgDRVF0CuQBpGoDV4Pc5ZCHjYsoakAHiD2MFAA6da9MAgzbsChCMgoblGZcrUw1UQFbR4ygZDb94XLoBB2EBtCwDFjSp3KmRLColQClb/X/unAy1mxSjOdojGjVM6a75H3HK7jvXyCooiZ79YIFITEtlCxg4t4LfUQkl0YEFoEFVggiOlLJSfRD4Ug8qFGGbIGUM8EFBHVTk0VAEQyjjkw0Q81NTCDgcydIQJsZQIkTQzbRgROS0uVABXOaYI0TDdfJNjA0WsxQONFPlIkXEMaZZMi0W24ANhPpghE5IR0eIQDhD14JQBU054IGIinGGADX3I1JRKDWDRQRIQ/SITnA2VSUAIfjTQwEU5MnRAACIohSUABNhgRwF6CrTHBhSVsNIYaCwlzBkL0ZFQH05MVMVKLE4k50QPHDDDbRzxOdEMKmGBlDGx2FIBDF94/1TCHjgwGhESCAkiiEEh+HCiTKosZEtDGHwgxEdpSiTGpg2pkIEMMmQQxxQEuRERna840pAevaWwhqUemfqQrQAMEUcGLAzAkAADZCDFQGlQylASaKBhhhtY0EGDCc91G8ZHtJILkRIAqCvRmgUcsJAIIlgJAGgCqTERBB+AhKlDtSx0y0wovFHQASGEkAZED1ww0VfhpsNKQxsX1cZKNEyUwr8eVcFQy0YJQHCfALDRESBv7EwRIRPhweYSE8GwAsoDlQC0EiMIkKMKOsUs0czHFgA0HlEL4MFCzcj0w9hkkz2ADIDwrAcA5jzxBtdS5+gBuzIghTRFI3gwwNctsv/LhxEgAMJTHQxVMM00wxoV9kyEGCHHDVaRIawzESFT9uVjE02RFY9Ta5UQaU8Ey1LhAFCLAycg7NQUCbRRN88YcwlAskkJpIIMes/CDeymsyLLIQzhsEdVcggQNwA/UDR6RCgMgIIVCx0iy8oPoeSUDj94UDZSKBgvQxsJFOCCLAI7hKtTbRjc0O4UWd49CiPgkQAggqBaAhJ78QWUE304utMJRhDA5UKRPNE9QwDxewMgUlcQB0iEBF5yChWOZxQFzgBVB2GAGC7DFxJw4ClKGADmkME+h1zjGs4IhM8+QoEIbIAvEUCC6nQSAwpOhHILOcUDKCOrCTiBBAhAgBOrItAHBvjPKRmQAEViMQ2HmEANIDlBHojQhSgggQNzAAsglNA8dg2ABeg4BxMP1y8gWI0iBShBCZiQRTXKpQAJ4IIS8ACCG2wrIjt8I1hq8kQ9vrEBYUhBv3iDARr48Y10SNoamHbIpzRgIib4ViPB8gVBDhIIRyDVJKuyBSBckgybBAsY9MAv6KgwlHL5whqAgIFW6uEDfuCdLAFABiiwYQE5OCIqwaLJXQYEACH5BAUCAA4ALAoACwA8AD0AAAj/AB0IHEiwoMGDCAcWSMiwocOHAhFEYQKxosWHCPJc3Mix4IQCIEOKHEmypMmTIOdEQZAwyhyUMGPKLECEoZM8M3PqBMmhYY2dQGMygINQl4NRrjSFOBC06ciaBI06ULRIoKUkASykcepUgxMcUqk6QGWKoIgOAUJwDeqi1dSqqATGFfhqIJoWdJz60UKGTI6ZdjKNNWVqLkFQBDuMaQrmxQUTJvQc0XKyzBgLZ1ZNMnzQko/PHQg02CkkTAUMFypUuIDhAZiRdC6fUaCA1qtIqHLr3h0Jkl0LQJesMKG6eAUgW+wUsIwZDRoRFhEL7LBjtE4vEBCa8EJg9vOOAhUE/9i684iJgrZiOVL1iVYShpBw757fm5YCLEFfpNCjJ72jgtAl5ANEZywWFBsQqIcQJQ+RwlAmB1inEx02gEeQbwctgstRLkxoA2YK/OIQIg9NMpCGAumCgxMazBQCiN89xGBCaBCEi1QFETGTCGi8RxAlqgQp5JDsHaRABz60sEMOoySEABwMLMQRiQ1R6cCRSbRgQBENjFZDQxpY6NCMImgZQh0jaYAADmy22SYJUHUEJJFEftICAWeapNKabrb5pAvgIcIIQ7YIBNMEETQkpZgDORJLBXrAQIZDefDZJ5twWjhnKQJVQBAQNMS0Z0J3RBmSFDEo0VCAAYgSy0DGVf8AwwpLwHTCBGAWAEiqIwiQEI9oZDVGCWykEKtxQKgRU6U4IJQoHr06JGwZIJVm7LGqmRAqTHN0wRJBuQjEiUAePBShhAUcsAIMCT1Q66EkyELQuIwKxEZDyqJUwh7f0mtQI+CFkQJDNJRwUhYJ4OGQBz9wVEIZayR0wQNBkIQwHjKgMEC9DN2bkAn5FvBEAm1kPAAKAu3iEMAdCYxtBadIQoMgJGfM8Q8oPwTxwAT54kAFwDiAySwn16uxBzLIIZMQH2AAqc8OBG2Ryg0ZIgAKMrSRwBQ5FXLKz1IbxPAPZJdtdsMNjaD1EzudcMAqDD2yci+31G133eOm4kBTOlT/8lAoHKUSrgM/AZUACxJc4hDgD93igOCssCIQnEA9YYWvDslNyNlkeyCAACMIVIsshxziJgkTGKxTDAL8wAtHngvQRAZxSLEHK6ZfehNQXGws0CWPBC/88I/A4gAvng/AQgYqDCESERFcGoGOOwnSxgBkv+5QMMpnAILzJLnQQwROIIAACST00CFQckhg0Sad3GArBz1EEUUPHDDB9w/l/k688A5IhCOOoJM5vGQtbZBA/w6SiJ4BAF1rkckT2qAxzA0EGHooCBAWEEGgzIBkRnCAJ4BxAQf44lgmeEEHudKALVwLW3r4ywqbAgWGYMALHAMPGFLzshTOsCktZMgKH5TzQ6DUECE8y2FHwOCphBQxKHV4gRKnKJAvUBEhAQEAIfkEBQIAAQAsCgALADwAPQAACP8AAwgcSLCgwYMIB55IyLChw4cCnURxAbGixYckNFzcyLFgjQIgQ4ocSbKkyZMgmXRxkhAOA5QwY8o8MYFhRpk4c47Mg4AhEZ1Acc6JghBHADgugipFOYEEjqdPkyXDgQueBiZLs+5EEHVqt2HLUJEKYKCM1rMqA+D4uszUQFQBvLVI0+BsVmhgTek1uIpWi7p2c9YJYaAFqL0M0YwJHNMP4RZJOtBKUowUqsuYL4/11oEA4wM5ctARObiwiA4KLPa1YBcAmxV69KzxQqdI4cgKfOjWzUMgXIa0DJwF8wDDBT0VAhj79EpB6oQ8KmeejsqbJq1L1qSoYKLgJzO7w+//7u3w3VkvgRJKe/j74LAeSxuE2PGp40BLCIcJvPMyp/zCPnTASEPkNeSWQPoJNBUJHOBkWwsB5lagesAR1M1BJMAnE24FWaPKhyCGqIowZvAg3mkinGGAJn0ktMEdVdj3i0M+DITiGQSEUEcDDVDQEAf2PbReAArgaIMfI+2BwwZQNYmDEz0s1JGHIooojJGjlVRCH044CdWLMXb0SykMPVAGYCdRQEJDMwRpkDEB2ILcFzEpyaSXTyIRJJWqCGQLQRh8gOZJXCYkRhUiDaFCBg0lIdArjigzEHIVVJrCGnQ45MCPBQwRRwZNMJQEGmiY4cYYdNBgQqWstgpDGHUu/4lQLQEo0cQAD7mBxQEF1KXGqq22CsQHMhVKEK0B3CKQIQ+lQdISD1wQLKuX0lECTJsWpKybA9HA0KsOVZGLQNsaRIh9ZAA7bQUYsIESIG8o4VAz527UwBIrJFQtSfAqMYIAAnDbkLf6wgoSvHj8K4AHAjXj0A8dNZDuuhXo4Y45T7yRMMDmchTwQ/jCUNA009jiDDEycCywAAMQQgUIONEARKXTCOSMRY043BAKA3hAxRU66JRuyTcfhMwPSCet9A/1JtSLFYPocAJQJRywQtEHwfJQNAzhc9Y9DiHDC0eHsJLHtUtJsUnYDRnSyy2cCISDLKxEUAPaS6kgQUOwYMfDy9JIoyAACiPgkU8u6bBCAgkITDCHVnW0AY59hb+RxQwFVEFBDz1MsAfeWeEBDjcNZXO0QAKMoMQbgMyAuZagLyUHONg49IwATSgRgxSMyXQDC7M4dMzuU/eO0xWjI0RMAMq4azxQcvBxkDK+CLTCEs/rNMMN9xCzvDI1F0RG9tqHIQk7JE8LBA2Dko9SCWWsoe/17uf0AQQUc6eGwEGGkQJDNKgfTuggP4TsS4AwacAH+MdAg3zhfw2MYAG2EMEKgqGCCAkIACH5BAUCAA4ALAoACwA8ADsAAAj/AB0IHEiwoMGDCAcWSMiwocOHBOdAnEjxoZM8Jypq3DjQCcePCKMgSBhlTgmQKAsQYTgSpUsNJBjWcImSAZyECKLQREnE40BdQHXh8Lhw50YNHnUJVOQAV7VkJGoUKGqUootWDhQtcoCq67JhG0a5mEq1qkM7mbgKRCXQlKllTjSQNduwzBgLZ1ZNQmhqWI0SU+ketItXgQIHryLxRYVrbFmQZMsSPoMGjQiIphbJfbwx8ty7ASpfJuhDICmEkxZJ5VzRsx0bBAIosMwQUiS2BjO3YsB6Ilk6NixAktaBB4/SCZEffIuDhAaUdmN/KiWQkTBExx2eJmgKVTddJFZq/2wAHO8faYwMMvrlENLBbslwIIDjgmL5M7P/+BCFUFSSh3sJtMhTOODgQFwZORRCYbT5YIY1DFHC0GEC4pLMQeI5dNloAjkoDEOfOKCcQIfx0MIOAIzigFIGzccARz7wECJDiAw0mw8nFkHWTAn59NGHEf4hYgsG6FhQHk4YeFB4ve1EZAislTCHSAi5+FGNCTmixwEzNDSBQ01u5IgDFTiQAhkO5YGAkgf1QBN1ZBIEBA1hOjBlSwfd8eJAUsSAR0OXJRGAMrGUGedAMKywREMlfIkQm4D4OYIDAyB0mQJnWGBDAWwwZAIZQjSkJpsFkaAOHiOgMAAKDGU6Bh0OLP+EZkIY0MAoE13gKVAuAnFCURkGHbACDAjB8MASdU7gBCsE+bpTpwkBMStDe2zQK0KNfBRGCtHS0EBCTyTwp0PZalQAsAldcKxBUyTQhgweCFYQG0AkZIIaA4X7rgerCrQLudpye1AFktCZABfwVlrQDw1F0wjDBLH6ELoEVeALmcAk0g4vCm8UDSEQs+qBDHJAxAYGAlnsCzAUEfJvQs0QIhAKMrSRwBQThQFDBRVMo8xBhjRU7kHRrCoDHglkoVEZa6QwDTDXGPSIQ4Q00otBvYyAxxuAgPQBBL4Qk1AoEB/0Q9W7XN3LOhlwPUNgHDUQxiksj83QDx4IIEATSsS4IAVgc31UAB1rOJPQ1DIbFO/efUshyNuRQVZAA+YkotEATWQQxxALeQa35IUYfvdAA7CQgQqc9/a54AXYsULUCD0SjAMsGAHCDTN0KS9BZFXO0Cad3FCnYFMVMo3lBUXtyBG7P9T6GuzEkojYDtTtwAM5NN/QVB8A4Ysv0xy0gPbbg3EBz4YSZMILw+9egO4IVaBH9uQ3ZAKtXtSfUAnmM/SC/gmpwxbud5BE2QGACIECAjfSv/oFBAAh+QQFAgAAACwKAAsAOwA7AAAI/wABCBxIsKDBgwgHnkjIsKHDhwNdQJxI8aGGAhUzahRIYqPHjHAkfhxZg6GTkSgBIGBIJKVHF1EYwnHpsUbHgThy4hhYgqZHHLp06czppKXPinNGAcChSJGuZDoRwGFwdGKJOtAALEO1bNmioDlvVm3oJwSBFqAGmlo7rJpQEkbHGixroEUSNAKLEWQLVSpVuQLpthDRAW9DXEJPMhkrOEkHBRBNLYIK92idEAbO/HnMkFkxUnu/4thwx+XluiIAKPChUTJUgRw+nh782Idt2w9RqV3mlGiPjAUaYLZb2wcPM2Z43G7ITC2AyTkBkP77UDhqzraRI5ImTURy3BCh7//kyAFjwyJ1N0MGcNvML2GlSgFgJAyRGdYIaQ0cJjD6QCe/OZSEagVlJw0jBjHyS0KpGRBCFwmRBkBPGRmHCIIHiaKcQIRBRkAIdjQAwAQMiVWhGdY0xINqZxBgQx0GbZAQgBv5YMYnDrnox0EFMAEhQhJqZJwoCRnzQBrmfUQhTbYAAEMYDc2wh4wImfiRMQA0SRAbDvl4EkJiVEHQECpkwNCACrwiijJaHlSGQxQ8NEQcGTQBgAAHDYhGAG6M4QcNAOiBUApQNrQHQ7VQo0QTAgjgQUJ8YnGAQDAyBASXDvXx5UC1CHTLRGkYtMQDFyS0wgFLIkQBCbKMBWhCKTj/hFEunh5FhgkMsVHpQYC8oURDvRDyg0ZLMATDqQYBEgMeI6DgUDSNDKvRqwmRMVCvzDo7UDMM7SKsRgXcitApALAhyBvZ4lkQIdEgBO0P0mY0qUEV+AKAM8QAMAsAjx4Eb7sF9QIvvAX9YMVDMwAAxEAVVDCNMxMN3EwvFPeySyPCEsyvFVzoIAhEZMQKQMO+AFMQMg3BSwjGPzQS7Q/aAsAFAB9TdMAKMDRc7zUEweLQwECjMAAKMrSRwBMesYEBySYbhDJDA3sw9AhGZzGSEACk0PA0iRz0NENT4/FGFoIkjNLNOT+MEC8MjQDAG4AUkGRKBbABRL0QQyTACErEmQAIYACEobUeFfBsUCgDCdCEEnFIAbhAJdDhpMN5F/TMAE1kEMcQcj++5d2UGz7QMQAM4TlCgjeshy+xOJNIvgBQe7pBb2qtui++TAOAvUHMfhDWS+vcMEFq+H6Q4AkBcYTxBkme0AUP9M58QRgkr4aI0wNQQBgwMLR89oGt0T1Ca7wJfgEfJIQr+AN9MT5CDcgt//z0119/QAAh+QQFAgAAACwKAAsAPgA8AAAI/wABCBxIsKDBgwgHFkjIsKHDhwW7MIFIsSJFBHksatx4cALHjwjnNIzCZCHIkwBKEGGIEaVLDk4YenR5kgEchlFE0gS5MiFGkzs1niCIA0fBCDODbnRxE0DRogRzllCq0U48eDiSPYUKwElGqhDp2BhIatmiarq2CqwBFOxBsQTOKOgAwFskU6aWoX0qMKdbg3DlohFx0NSwtHwB5Bn6N7ACAIQb4kJsFEANt3ABPI6MEFIkVABMLaIMAEEUF0EdQ7YoWitXBBpcquZMkVTo0YlJXP44W6CP3z4ges67t3Lp0xp7+wbOnOIi1wWdxKYYIu7mgsyzB0/4GMBzrgR1V/8kTHtgdh5mzPAAjjD4DlejEBgniACOi7YbmaNHJE3ar/TbaQZAcAYUUUAJJeyGkHQoAWcGIsIwIlApn/z3WBItGBACfhogkJBujH30mxm/SFhQKdIAoGEdIUXhk30n/caDKAmV4VANMS04nYhmUHJQBQCkQIZDeXiYUE88CiOQIwAASRANDs0RhZEG1ccAR4Sh0YI1AFxwUAoALNHQCUkhtCMALAzQEGcWpAQFBk4aBIQa+BmUR44IqSOQmg4lAYAFY9iYUhhgJgRlQ1JSaVA0AnhA0QGArVHoQQ8sUWdBE+Ap0C0DRdPIDyAJ8QEGCZmgBpEMeUAIqCAVMulBNAj/kZAUAq2DkKc/sMqbpAhd8EAQBU31hhIACDCAAL0sumquKI2a0JwHCdAoAD8QQsguvWTbSzOf5qorR0J8AQNCFWBwqEDGGpSrtdU20i2z0VZkB68FAckOMJgI4JC3/H47kL6EUAECADM8VICzBFVQgS/KVNSvtwZRcQXBBVP0hZcDKVzBNMQI5Oi+zMLrsRWD6DBFxRUVUAe9TVagRywCPfKRB1YAoIMgzQIhkMa+AENQKBChIJAMAglSwAwoc1TAxTsr3PPPDaGgLwBtJPBEAZd+5AevGuthC0GXIHOQ0ELjkYBASe9UwpstK8zxQ3i8kQXSfwkEhpdAOm3LNQLBioIMLwONAEAMgNBdt0AFCLEFmBovrEzHsAQDDgBKxEDr4Qix3bbLPTtzzhuYO3R3012f4o48oTvUwBYmZNy4lzmkzlABUDCEwQKyMwRGBRgbZMILuSdUAOsJ6RF78AfVnhAGXmQtuxBa8J4Q8MgbNHzrCK1gR/UGKf8l9wdpoUfv1oNPUAMvkJp6QAAh+QQFAgAUACwKAAsAPgA8AAAI/wApCBxIsKDBgwgHlkjIsKHDhwWjzIFIsSJFJxosatx4sAbHjwiZNITjAqTJgQUcZjx5cmVCjyxBnijJkGRMkzARYrz5cSFDEjl5ckSQ0KZQiwVK1CBBAQdCl0cdNqDToIAGJziyOi1IJGrDOhQMtDjTgoCWUQi0bh1o1CtBPyEotBDRAY0IBR0oZCKh1qAGn17rxG2RhIICg7QoLErWd6CTrlEFG6DwB42CPwl/LVO7ViAcBjzhyhVh2CEPgd10aS3IlKVkCkksY67YbcNqroA1NgghljTHPyJwfbtN8LNGyXNLf0RDbwLWzgQ5WBRb+LBJBT405UmbEDLE6g59iP/30TCAjQZzoiTccAf0zfHwyRf0nabqiQk/pceMH580aQIUNFBQHk4k5EQPKZ0UHw9mmOGDZWcQYIMfB+V2EHvumTQeg79II80rBoRAh0MTtHYQCRwk+NGGv3zCiEAPsLGEigjReJATQXFEFw+/iKJMCgJdAMEKWjzURYEn1mAjBUpQpEAAFoyxBpAFYbCFHQ0tSRAJDqioRBMUDFDRAQWQYUJCZDy0wQYGsUJBHjEIJICYDZHmBgUHCFRAAWxg8NGeNURw0D4jCKBbQQUccSZCKzw0h0duCsRJLxII0MgPJvHZUJpZAtIPBZP2Uk4jl/6AqUmcMqSlQIBQgMcIhsT/Gmuppp5UwgErwIBQCissgahAeAzkAamkmmrsTWwAAdETA6FAJwXGRlvrTWFQmdCeOlBBgQAeHFTrsQ2hMGauCMHwwAFDyPAsSOJ6IIMcFKxqULIHVVCBCfzgIQFLKMjARQKCyHtQtfVW4A4oI8zCUbf9tpHAEwInVAa5BNlbwQPAfITCCHgkkMUMJrFhkMW+ZIwMRN1SwPEbWVBrrUAWnwIBBQoz1K2hSrzRqlBljGzxNMQ8w8tBNzehRJzxRuXHBz5XcIoym4BzkNFxSLGnWwIRXLHFkoAyjwcDiNlEBioMcTXWA9GxRtMXB6EDCHLEMQTaCTHdNBALnE03QjMUR6KrzyYcsbdDar9sEAACDl43Q8oqztAXMFTg+EZ2TJnQA5PX3fhBeGduUAGQS8654J4XVIflpVNkd+oQgRE56w8VsMXmdAcEACH5BAUCABQALAoACwA7ADwAAAj/ACkIHEiwoMGDCAcWSMiwocOHArswgUixokMEeSxq3DgwwgSOIAvOaRhlZMiTDjOiBMmh4YQTKzcWYEDSZEyNRBhiLHHTIsyeQB9GobAwqEOeORMiMOqwgFOBJBjWYHrQzwE6TguUcAGH4VCqAunYoHAmwBk3NrJObVgUqFiyaCiImItGgQGtGpzgQEhi7U2xBCgo6CDCR8E/HbAU4Lo0oYuVb88okMtQxBk/J2qQ2HvQyUnAggkbfhiiQF7OB/1WBCx5o4i0jBk+hsh6sgiOPIo41cxQA0QCrW+D7OAma96Enh/eFh4SjZnSTmcjRADHxU+wAs9AX1hAtUEnvqlO/za84wCFBgQ1ND5IwgHPmD7iD/bRwoDug235OsgPUn6HJC0IxF9qyOVxHUgidKBAfSHU8dRDTmzwnUQDWmSZASHY0UBWDzLUXQQSDhRhHiVUmEFDHZBFgA1+NLBhCWUcIERWTX1Ewo0kRJEHjQOdKIAACCl4xop0EOVUA2S8sMIKW0BxwHseFlCFAzVMoIELJZQ4BAUnUgBkQmdYYEORChVgBw0YmAADDCZAsEYOD3GYZQlSxKFEExSVMaBTHwRiEAZbkBmlU1LEcOePHvwQUgFa6HHBQUCoAZGhTSD6g6InFbAABgxBiZASXgqQ6KUr8cnpQRc8EIRBT1AAqpcUXP9Kak9QUOTUDVT8iB1RFMCQkAlHCFgAIFYMsOtAdKyRAkKPBpGVHBKs9IMVDzXwwamQquFUCbmG5AG1OlD0ha8IAesUICN4YBEKA3FBgSAW2aEssw8AUMATI7BbkQxtUPBEhQ9di1AFQCzgVAZfQpTAux1qNO7AQBxRwAkxGIvQAOziQUEWN9nBUKr2FoCHBPoSNAIFbxgFsEAVmGCwU3LkSwEKJ8cACFhfPFruETOem0AMb0jhKVMr90pByDweKxAUECTEKXpKF9QAGDoj9ELUB9VhNEJ65FA0drVibREYFYhdUQFbJFSBHmYXBAW2f3rR9kBk/3r13ESljbdDYe8NzZAWFVTtt0FC3I1dQAAh+QQFAgA3ACwKAAsAOwA8AAAI/wBvCBxIsKDBgwgHlkjIsKHDhwKjzIFIsaJDJxosatw4kESNAiBDihxJsqTJkwWYNITjAqXLly9P1GCIEabNmyI1kGA4k6NPhS5WtsRJ9GVPhDWLKjX5s2nFDQlZllhKVeTRgzudNnXCkMjUqlVdRGEIhwFYmDNIam1ax4aBFi3cGDgw8kSehkTOjvQTgkALER0UKEDT4YwNkREbmj3L18AZwAoMogmQZqRDDlUbn0kSmGEHAg1E3u2qlK9fERQVnKETMjHCDXcWwzT9F42CPxSTBDgQOuQEhyodvk1ie6OI1SJL5EGQkMQEmJzR/PzcO+TE5s8LrE2ogDLJE78Rkv/QoH07wjMhTO5BALWgE6nlzUMWSLfk1AkR2gt0klR+h+MG2OBHdSdRIEYEJCQIhwYntLbWGQQISOBLVThQwwQcMPBVfBzZBqENrFVVwoYgHRSHEg1Jd4MFIOqlVkExoMgQGpNZMEZBLpIkRYwPBWBjGTmetKMSI1BUn0sNHLBEHUoBEgMeRa4Vkh8LbLHCCltAASRMUrwBpQADoLAdSAccAYEJMMBgAgRbAIDSFF4KFKZ5AoFEAwQV5KknBC9MGNIQGYBJJ45fwJAQGX4+QYUEgxrUABR46ikpEDSUJAejjeLIBgaSSgrDCktMSIUAP3kgg1YpDBQSICOIqREKMrTXkcAUNoVhQqeT0kAiqx5A1KtAeCSQBU4llLGCoQktIdIJRpDK0K8j4PEGIFSxAQRDaoykwgAJCeDstGeFkQKueppQp0hKSPCrQN6OoEQMUjSol7EwkFsBDA8oK9ITXLDgrQBNvCtFkCGxwRAQ2ZI0RAwgxDAEwSOFUa+9QBwB8U3FMnTBA0FcfNMHB6shhMcwicuQxSS/RMcaqSL0gJspo9QAyJlq9UXLCB0xcswnrZwQvjDzbBLNCS0g9EmFnny0SX6sgWzNPxENtU+FVjC1TwVscfUNAQEAIfkEBQIADgAsCQALADoAPAAACP8AHQgcSLCgwYMICRZIyLChw4cOupSASLFiww17JlrcyDEChQIgQ4ocSbKkyZNzGDrpwuSky5cwQZYgwhBHnpg4c4bk4IQhhRk6g75koJKl0KMmaSZEcBOpU5AnHE54SpUBHAQJu8yh+lQpQqYcwx4kwXAqV6RWGUZpedZlWLBiGZZp4LKEhoZm29KxIfBMCwJp6II0CEft1qcN9hI4g0agCAUdzIwxGZUhU6eKGXcQ4aOzZwU8ipi8y5CD0MwKHHawILJgYYQkTONEvdmz7ds+RJwpY7LG0j0nXjYIsRgyZ9zIO4sIcGA0CRzQo+Mg0afEwoYiaiffnvsMnZNEImz/kO7E5uC4DTsQOFliTg0EJOKTiNL0OnqEHc40f7mHQo0aHMxhXUj3GYRGBy2IFlMJA7ZW4ECQ+dDCDt899WCELRigIFX3QfZHhiG05ZAKGTDUgQIg1vFgQ3GUmNBmZxgQgh0NrJhQHA4lcQYBNvjRgGBtjVSZA00IMIBDdgR5khQOKGGjQE9N8YaTDgjggY1PSZHBAANc+aQDIy2xRJIxZSDBlwOF1AAZLzzwwBofBPHSGwKgCSVIfrABgQkwwJACBCuAcdIJeBxpJ5gFQBHIBRU02qgJaxzQ4EhG1GlnAQ0A8AAMjnYKgUEhnZCBpRVxoZMaGHTaqQlHnDSIoQ+1t5HAE0FBgQFDAJh0AwsoHNTrQAlkAZRQC9ya0AInqeABqQ7A6kAWBcwwrFBgqKoqEAeJ9AYVfKDw6xuABLlFCtY2esEDObgkiA5vJIAmFA0hq6ROWlTAaLkmvDBvUFuYkJAe6e6LExTYHntoQ0JooccFCekrME5bMATwwzDV4UVDXlAMk8IMI+SwxifV8YIJ5TaqhxYgu+TFpwllnLJJHDf88kkjHyxWA14UbDNHOeixs1gvGGtnQAAh+QQFAgASACwKAAwAPAA7AAAI/wAlCBxIsKDBgwgFRpmTsKHDhxAHOslzIqLFixAnFNjIsaPHjyBDitzIpCGChSVGqlzJ0iECDSxjyvSogUTDGgUw6tw58KQLnkAPOknoBObMoytLPMSJtKnInw3hQA1K1WHRqlWHJqyR0qlXjiWmIpSKtaxQo1/TPnSQdmbDDQhJOOjatkERA25auNlRJmnDonXvtvCBRoHhDmdCrMxj06CThV+L7BjcQYGPy5jRBEgzsgSTGhHg9nzpVDJlNJhTY+5AoIHKORMQkJhNAo4GujHTGKBsWbVvHyLO0FFZosQeCkRqcGCAOybh3r9/J9ncNqaI6Nh9TO/r1GzCDha+ev8/qMBMEaTjEYroEMDGxvRA1ys4QyANfJ4iCp+xYIPO/Z1ooLHfGP79VxALAzQUYAAWjMFddSINEUcGEInA4BgHQChSCVLEMZAAER3QgGsafgSIQE0IkKCBF210gxUrsojRRlNQESOLTcVx431fKQGigV/NYIQAPxRp5JFIFvmjRR0JsUQQw8WUAZFJVqkiH1SAgJQfC2zxwANrfLDESjPIsSNCP1Ahhw5NlXEEBCZccEEKEKyhxUpDjEAlkigM8IMVV+gwg1dsBFLBoYgCsUaUI72BoAeQCuSBFVzoIEhaWsiJ6KYYqCHESjooMQIfLMjARQInQOgFBptuaoJDHQl2IsUNNzxRYgEfYNAQADKdUJGMBHV6K1JfwFBBQkd8OqxMdqyRQquIwvAAr8vKlCus1cZU7LHA7uTHGjAk9EC3CeHaEAYLZBsTGBdwS+5FMzjbUA7qsgRFQ0C8e1AD7LqrL0QNbJHCvxdBoSvBEbGLsEVb5CtjQAAh+QQFAgABACwKAAwAPAA7AAAI/wADCBxIsKDBgwgDkEBSIKHDhxAjCtyAY09DiRgzPiThoIDHjyBDihxJsqTHOQ6d9DHJsqXLAiUcbhBj8aXNmwU4OHHo4ITGn0AHqrwYtGhBEjiSKk1KsSbOpyWZQKQAtSpJBin7xDTKFWLFrl2RLl3qRIPVsyCxJiRhFizXCGOZVkRLt4QGsWMX0t3LBAlcsjQ/ug1QByqDHk5IKCYRJc9ej3RsEGhxxs0OOjhP5JlApAYHF3sjEziDRqAINB1apHlaokRoyaQ7iPBBu3ZqzI9thhitQHbt37Z35LYpwjfw4z7QuBn+Mgny5wpagBw8WLlg6m47YLmOnWsHN7i7c/9VgKbFAY/ig/b20QKLH6LpMa5vYaAI/PgBlDQRkLD3H/r2MTeSFDEoIdAADv1nQAiFCSjSGz816GBIU+CBIH5AfdSGBBhm6NENfHjQ4U8eCQLChSNmpCGKKUYE0iAD/CDjjDTSiEJRZ70hQI08ojCABzLIMaFJU1DBYkEoyNBGAlMMyZIOI0jgwQ8eeDBAkngkkMVeDSwBQBlQ3aDflCPg8QYguanxwgMPrMCGFlANoYMOaA7HBgYmXHBBChA8EMZTM8wgIBQQGGTCA0s04KRLSzwAA0ILLOoSGSYk9IKkLDWwABAIXaBHDpiaRAanDgkR6kgN5KDHBS2S+EIKCek60epBmpJ6EBBenEoSAI7OquILlSYEp64iLRDsQRh40YCvBPHKKrMuHnEstKWqYSu1DjmLLURHFNphQAAh+QQFAgAAACwJAAsAPAA8AAAI/wABCBxIsKDBgwgJlkjIsKHDhwKdRJkDsaJFhzic5DlxsaNHgjU+ijTIhCGCKC5GqgRQgCEOBBpWqtRAgmGNljJzFtwAJ6XOj04Qvtz48yJOhg6KdvSJkASHo0ofngh5cAOAPVCjOszjxGrBCD0KZNXKsMCECAgIRoBTRSzZigUc3CFBFwGStm7fOhRbgIEGBw72nOCrFyLfEiX4Ev6Z16hixTofL4YrWWaDIgbcuCFgowFkx5Yxt/CBRoGCDmjcHPhceGAB0T4AKDDYwY3nxq0Fkp6dsAOWybkBiHCYGnhwhwpaGD/OsPZy5gg7GHgOvSCaM2VwVzc4/EwR7dsFiv8ofYbAgeAZWAxIOP66BRt0CmcBkAHAAAEMRZyxMCZ+4QJSGLEeROe1xpcSEoRX1gk6eKBgQnzJMeCDBSnWxoQUEsTXFRhmKJBYMySAgocV8mVEggbh94MV1Sl2gxUSoOCBgwB4YMUgOizUIl9SDCJDE01YwYUOU8jEmkWPPTHEEFOcwNFKko310JFGRillQ+BBaSV1wSkGBhtbbHGEGnRceRxfUFyAQQopAAHBFkE8KFYDC0BwQUEYbOFfeAUs8QAMB2GghoIFCEEGEAgBcQSFUGCQ0ANyeuFoQgs8+MUFFZBoUB1rpMBQDg9+gGiilfJ5aaaaElTHFgytQYeOLX4RMKlBJmQIBqYJNUDhFqO+FRAAIfkEBQUAAQAsCQALAD0APAAACP8AAwgcSLCgwYMICRZIyLChw4cE+yyESLGiww049ky0yLHjQAoFQoocSbKkyZMoRc5h6ERiypcwYxYo0RBHFZk4c4rk4ASHz58/neQ54bGoRaEbjSoNQALoTwR3GOicGpNmBKc+SdSgyvVliR4RMP6M0MXFjK5oTc6ZIIaE2w1EpKadW7IKBwocNNLda7IE37+AAwseTLiw4cOIE4ukY4NAixYWbDRQ/LJBCAJnFAgUgUaBBTojlxoV0UGEj9OoO1gILdpjEtSwTycJIbK17YEdDNS+bRvN6pC8beeenDT4aBu7jRtVnVx5wThKHKJRDVrxGyVNBDBU0IFHizFCKA/PQjGA4esWO4pQDgligAeHRRrIX59FBgrnRUXOSHAff/6QcWjnn0civSHggByJNAQL7yFY0UiCtCGBgwmGBIgREqDggQfkeSDDFeullMUVMvDBhwxtJPBEiDBlcUMAK7IY01ky1mjjjTjmqKNJDdSxY0lafLDFGi9AcYBfOy6gBwQmpGACBGuAsSMZKcBQkAkrLJHjDGuYcBAEXuQIxgUUdlSAGl4mpAWOVCaEQZg35vAAmWVaVMALDK1gB44LAIFQCnUmBMADViKk4xEQIBgQACH5BAUUAAAALAkADAA9ADsAAAj/AAEIHEiwoMGDCAd2YZKwocOHEAfiQADgRMSLGCE64ZCxo0eDGj6KzLhBTJUCKFOqXMmypcuXKjWQwEGzJo4IRErA3MmzZ8oTNSJssEkCzkmfSJOuZDJBDImnCJAcVUpVaRUOFBzkOVG1q9evYMOKHUu2rNmzaNOqXcu2rdu3cOPKXVnEgAULBoqsHMm3oA80gDv4MKCyr2GDIjoQTnm4scAkPvSidOxYMWPKh9FYKIy5LxoClzvzRTNmLsopcTI47ODGNEolEhombnHA9ZXYCEWIOGOgjGspTVA0DEHHNco3wkWPVBlHgHK+Kd84fy4S5Qngyal3VDkIt/aMKqfgdBkgwIOH7xdVnohjZMQIK3KM8wQkRZD8+/jz69/Pv7///wAGWJUQdgQIBg1brPGCF7XxB0UFGKSQggkQrJGDEPkJoQYQF1TgoYdArNHgfQeskMKHKEKAnkMNhGHCih8tgAGMHqlBo0daVHDBjRgJ8QIQ3wUEACH5BAUFAAEALAcACABCAEMAAAj/AAsIHEiwoMGDCBMqXMiwocOHECNKnEix4kAmLpiUsMjRYQkGE7rAiUIkT8eTCfPcieAEAQISCBygnDmwyh0nOHLm3EBCA82ZNSLoHOqkz8afFkvMiYJgqNMqSDkyuLPBqU4neU5EpVjCBZymVnFg3WoRCU6rCO4wIFuRg1CrJGqwrViiR4SqOiN0cTFjLsU5E8SQGLyByFq/FqtwoMBhD+KZRx9Lnky5suXLmDNrLtBgDIEWLSzYaLBZoYUOHRSIQKPAAp3SBw108EG7dgcLsAumMSOitu8kIXIPHDPbt20DwgXuQGO8NhrcybEwb+6jgwHSwov4SEJdhI3kAk83/78NXuABN6mTJEFz+7XkBG0yGGmTYCEdAy3MmGkxRsjkQSgMIIAAA6CAxxQL+bHEAZWBMIAHP0QYoQR4lJeFDChIKKEHHtQn3AwJZKihhANwAV4cAowooQBKgPdGiir+MECFyQ3BAoQqDgCCIMkJ0oYEKgrQxBDlAWKEBChw6MEATbzRl4VXyMAHH03gcUN5BWVxgw5SYOnll2CGKeaYEdVRx5iF0LDFGkeoYYeXDXyQAgYppGACBC8sgSUUgVxQwZ9/4lleDnr4CSigQIQB3gIYHHooBmwkJ8QHjTr6pwkvgAcFBJZemqlwDZBhQqcVQPABeGWskIKlF1wARnlq1CN5KAwQQOElGStgoCsGD3jhH5YNLKHGB2wsAACZyCarLGUBAQAh+QQFAgAAACwKAAsAPQA8AAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpxI8SATFy4qamzogkIXOHB6aNhI0uCeKBGcIEBAwkmNEyVLuojiBIdNmxsiOIAZs+IJBxFuCkUAJ2PPikhqCr3pJA+ToxNPREGw9CYJB1Ap9lFalQSHrBNrkKiKYwOOPWAl5kFgdmmEHmknTohA9WYEOFXiTnRwh4RfBEjy6p3IQIMDB3t4Dp5YosTix5AjC5yRxoAbNwRsNJDcEAuPDgoUdEDj5gDnhA1siBDho3XrDm42nz7YQoHr2x2wzC5Imcft26R3F7SR5LdrBS2EEwxh3DVs5QPpnGFtvIMB6JN3dDCO5kwZ7AL9WP8A3VpEhzNFwA+cseOM7zMETKsn6CdNke+Ds6jIYIUKHh2CzFeAFEZIIAAKKAzgwSACKiHBDxBC6MEAcoB3gg4eRKghCk0MAZ4cA2iooQAxKCZcGyGKCCGF4F2RoooDgIDdDAmgoKKEOqhXoIoSGDHfDVZIgIIHHiRIxQ0CSjGIDE00YQUITwg40BNDDDGFlFhmqR4YbGyxxRFq0CElFBdgkEIKQECwRRDqNbAABBdUIKecGGxhB3hLPADDnHwCoQZ2QpABBJ990gAeFBgQOmcKa4DnRaKKVpDCFuB9kUKkFWBgKHZ1rGGCoheYEIZ6YcDw6ZwXBPJBHfORsQIGsCYWCoUfUh6gxgdseKFFA7IJyKuWwCoXEAAh+QQFAgAZACwMAA4AOAA3AAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpy4kIkLFxQzJizBYEKUO3B6aNBIcmAeOBEQbEBAwsmEkhk5wnGCo2bNDRE4wKQ4IYLNn06iMCmxEyKTLjR/2kSwpyhEF3AQKLVJQgMTpw7nRJE6FYeTkVgdEiHRdYOYKmEdaiA7NUKNtA9rpLSJMwoDoiQb1JlYgsIdEoA3EGFQ0oaFFmfc7KAjkYEGBxya4s1oAE0HBSIst0gD1yEWNH98iBbdoQXjzgrrtFAwunWHHagVFgndejQaN7ET2hBRe7SCFrkRzu4t+nbwg37OsO7dAcvxg1g6MHdz+nlBAmjQiMiMpsUB6wjHuP8JEKAFFj/gFdIpMyO9+/cOE7RRokTODfgDp+ARMEAA/yYqnIBfGxL8YKCBKAgQB3w38OHBgQeiMIIU7gkCwgAQQihADO+1gWGGBg4gx3uDfAjiACC894YAICKYgCDuTUGFiQcOYAWM7+kwggQPeuCBBCPoICCDSjRhYBNtDFHSFzRssQUNZFA0hA46KNleRnZ8kAIQKaSAgQk0lCHRDIIMSdIHgVxQwZprBkIDfFpUoCaba14AAxjvQYEBnXRiAIUQ7tEABJ9sAnHEe2wMSmgFhronhBqKEgoBFO8F8QAMhMKghxbweYEBpmzCAIEX+BWwwAMYAAEEBg940UADpQYQ4QUbbHgBQKm45qrrrgsFBAAh+QQFAgAAACwQABEAMQAwAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSjTIhIGLExMzEnRBocsdOH04YNQYsUSVKBGcIEDgJAKROSQhzulCAofNmxEmjIy5kAmHCDeDIhDDgGfDHjWD3iTBwSjDPk6U3nRCwelCJFGl4iDhIGIIAm5aWBjjpyEFoFoR5IG4Q0EHNArQdHBzoMHCPTg2SCWBBOIYNEl8CPaRZG4dhg5IIAhKAs6ehw1aoBlMuQOWhhyikNiMAEkVyEUoi0bjxqGLPA447Nnp0IYI0YMVtHhYQmOIwLB9kLaqkM4ZBbk77OCdsMGODrA7tKBDvLiFDgr+/HHbIk1zhQ2wtDDDo4UB5tcX1v9Jk8ZO+PPo06tf3xCQCiVUMsgZwn7gDSsSBKAQMKDJm/pTUDHADwQSiMIPCbAXx4AFFigAFewpIUCDBXrAxw2CpDeDERNSaGCCEQmxRBDgNZRBhx56AKJDfiywxQMPrPHBEgzNIAeDFKIwghQPlXEEBCZccEEKEKyhBUNDjIBigRK0McVDbARSwZRUArFGiQm9wcIAHnTJXwaAPKSFkFSWCYQaDemgxAh8sGCFCqwx5AUGZZpJg0OCSHHDDU9G9AGddU5pwhYQnRCnQ1AAGmgKL6z3RQqBTgkBFEKoJ8QWQAQKgx45sPeFHplSaUIKalS6XglabAEDEECksAYZ9Q0QVAcYCywQRhmx5qrrrgsFBAAh+QQFAgAAACwSABQALAAqAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjIpzDwMUJiRhPMJgQ5c4dJBxKYIS4B04EBBs2OCFRg0nEOmUaNGQAhwSOmzc3RKDwMISFFmdaEEgjMyGFCDiTIoDjQuRCLCI6KBChoIOZMQr7OEmalEQehiFEiPBBlqwCHkUQMomCgCtOEhxcKnTToazdDhYQltDq9ibchWXOjLVLVsSZMghr2HS7AUeVGQkbHAiQhHDhAAcQ5kHpNgIRhnQEW/ZhmI7Rk0kjRGHgVKGFupY7EFBYggOclTaJsG4YgocCwh3OZF7oIo8DDVWYlGi9cAwPqVQ7tEjL0OlyiUUInAm6w/RIiDJn2P/5Tr68+fPo06tfz179lARc8LSJAah9QSkZBAzYL8CKDkEQ1bHEEnU4lIEEPySY4ABN6OBQGV5s8cADW3hBB3MGvSGAghwOkAGGBwWxBQQmXHCBCYG8sERCJ+AxAIcKesDHDQy9AEEFOOYYyBEKGbEhjAmikACACZFhQo5IVpACGAidkB+QQSawEBtAJJkjBlAkNMiLQHrQxBAXJXTEkVZWAAQNCd3AAgpASqAEQzSQaSUQbCikggc//oCCBFbQSJsaGJRZAQZqLPQGFYSggMIIXNTH0BIPpGClCSscAGJBJ+jwRgJSQOaQGinIaWYFYdg3EBlrmIABBils8YUQpgoRVAIdYXjhxRfexarrrrxCFBAAIfkEBQIAKgAsFQAXACYAJAAACP8ACwgcSLCgwYMIEypcyBDhjIYQDxYh0KKFGwMHGs5hwIBJwzE+OihQgKbDGRsKXUzoIuZOFwdzFIbwIcKHTZtoAqRBWCVKBAQbNjiJgMRFQgsdbirtQKCBQSZ9SOCYSjUCEYRlztRUalPBGToGOUSgSjZolYMHAmzlmiTAAacEiUglS5WEg4Nl1HK1KeKrQSRO6NadgNANmr0hmxqUK3gqCQoHZ4QQsbarzoMOxjYmkSchFhEdRCRRYDIEQgZ3EAgm0YdJCYQNQrg5E+AMRoUcnASue2dPQzoH/DTU0AUBCRIbkFQ5ETEikzwcOOx53by69evYs2vfDvvAkjrcEfr2WbBlxYotUMqEJ3jgCAQTMGCYgLAFgEIpIJRkwBPjyUIaEFQg4IAQvICQIDqMMIAAAixIxQ0JfQHDgBRWYEIYBw2h4A8ccjiADFIwV1ADUARYoYAYfGDQDFxI0OGLEnCBEBsYnCigCUcIYZAVArzYIQoy+DfiBzXaiKNBUozggY8cetDEEAeRYYKNFUDgBXUDZaEkkz84GaJBZawwZYUpPGCfQRkMwKUAVCRExgVj3piCGgglgMKSPkoAgkJhrGECBhiYsAYZDhVwBYNLesAgHiImREcYXngRRhlYIhQDFXz8wAcVMaxnkCA3JHDDFJ4q9FCp1QUEACH5BAUCAA8ALBYAGAAkACIAAAj/AAsIHEiwAJ0DdgoqXMiwoA03ZwKcsVCkoUWGdXagQSOiYwceYy6KHGiDo4+TJ0X4KNJg5EU3aFDK7GDBpcUDAZLIRCniDJ2WCl0wYMDkYpqcO1MGOKCQQY0oYu50cVCUIZ0zCpL6UHAG6MA9cCIg2LDBSYQeLhpa6KC1gwGCJVxEIYGjrt0INRoW4ZF1ZosyBR1EsEt4wx0GJRiOMdNBgQI0HdykUYjECWHCTjhYTEOgRQs3WOx4HdjH8uW6JBzMuNhgNGXTp1PbbEhh8OkNCPbMXliiCg4Ep8/ubujACewNEeBU4X2A6WwNURCQoEuEgcIyXrasWPFCjR+bc/Jw8dBQpURiggC2QDABAwYQDEcAD1dY5wWECvjzB2IzX6EaDPkFeEEFOfRHEA1ABBggBgsYKFB9JiiYHwYfLJRFAoO0IYcOFx2RoIQVUOjaDVQIMMCJHighxQkMQXEfiECQUVAWVkjww403SkBFFgzloMeACpqwBh3nCSSHjTjiKMEVDXkBRAoBmqBHGAWVUGKSOKIgA4sMqbHCexiksMUXCgEyggdY3uhBE0OsxhwZUHgRBh0LPTECCmn+sOYQDgqUgQB5omBFnwWcEMMAeS5JqEB4SIDnjShIYASPixYgx50CoDCCHE9UOhAgCcTwhhQWBQQAIfkEBQIAAAAsFQAXACYAJQAACP8ACwgcSLBgAzoNCipcyHBhEQMtzrSwEKKhxYs2AnRAI0JBhz87LooseOAMGh8oUYpAM2akSwMdUspU0CKhS4sN3JyUKbPIzYstFPBMKcLGz4Y5dw714fMowx0dkgxF46aO04UNSipFKbTiwhMnnIbQqKBjhwA2bA4soYFIly5ENJS4mZVAiwAtDKRRK3AOERIkEDgBTGTO0Rl07DTgK7BGBByQI0eocZVhHgQbIkfesKGKwgZlysy9OYGEZs0kHIwu4GfBixUrXiywM7LE39ORSVAWuOQFBhMpYJiA8OLA6oaOcUPWPfAIhArQoweiMdKBaeUkOAgMkyK69wswwIj1ZCAGAW4EcBgUaPABg3fvGKBUj2A+smDtAo+YeB8dCPWRHNwBGGBw4CcQDUDwBx0GbNRWAgMcTDABBy4UtECCCmKwQGUKBfFAd++ZsMISHCqkBnDemQADGYwNAQIeSlyhQ1gjNVAHGSuYgMFva4RR0AlvNDGAAAIM4AEeWdB1ABlQQEFGGQrpQAgKP1T5gwcSKFFiQYJkMICVYAoQw5YDDcGCB2BaOYASx1U2gw5oplmlAFSQKZCUcs5JxQx2AiIDlXIOgIedAl0hgZweoJAAoQU8kYEEgP4gAApXMCrQE1eMkOgPVLxhKUFS6JDAjJ/+SKNLAQEAIfkEBQIAAAAsFAAWACgAJgAACP8ACwgcSLAgwTJpDhhcyLBhQRtuzpgJ4GaMw4sOG4xJgkZEEhFoFBDASLJgETOIfKhc2QFLyZcEOqycKeKMnZckW4iYybNIA5wXWyjguTKJDaAX3aAh6iOJmTRIHe6QSRSNm6gO6bSguhJNAKhYGTZIszUkmg4tioS9SAeLmxZusND5GbVBGTprSZbxsmXFmiNk1jJhwjDHFggmYMAAAoSNEKBMOPSI0oWIhoJ0tmCowLlzICiPS7pAQsIJAgQkSNQgLHDB5s6dYTwI8rJHBBy4c0eYMPAIENiwTZCpQ1IDidzIN9xhUELIlhTAO0OAQvJEjePIc5PgIPDF7+gVMFD1J4nESXbtvBt8eB09RZiSPcyfx0GCgkAwMC5EB7LlJkkK2J1HwmUCfQABDLABoccXL+2BwwbnORHFHAR58QAGGJqwBYM4URABAsiZRiBBQagBBRRh4IWUA3eklloUeTTUAF1YMcDBBBRo4EIJJQA1QxYJyHFFHEM4xGOPUelghQADDCAAC3KckNdCN4wwwA9Y/uCBBG1MaZASV2aJpQcoJCCIlwJJ0YQHYmY5gBJoCqRDm2KiYEWcBcxJJ5YoUIEnICOgsOebUsbZhgR7ChADngVIQYUEbPIpAR5I4jkEHnwIIAAKI4BwJqMCnXBDHCq8IQVSAQEAIfkEBQIAAAAsEwAVACoAKAAACP8ACwgcSLCgQYF1Dtg5yLChw4EhCJwJcMaCjYcYH47h0UFBEhEdd9TJSJJgmgAKfKhUCXJMyZcGOqycqaBFg5ckW6ScObMITowNdPJcKSLEzZ8NG7hBM9RHEh5pkD6M2bSDG6kPy5xhStOMT5x0Fj4McaajCAUdzhgtaUfNizVrjpB5eMBAizMtdhx4ueQFBBMpUgDBQEOswxkFGhzNKOQIhAqQI0Ngg9UhGSCRM1/Qk6PywTpsMGTOjGGB54MvTIyOjIHy6YJHVK+uAOQDViZMDkIRPRuImp8lNPSIEgUJh9wCheTQA2N1ihV7X86pQYIEAgROSCBxQXB388gmLszxxVkjAo7z6CP0KLjgAYb3QNaE+blnwwb0+BHkKRhEzQcoZBxQwk8UkIAffiRQcMJrBFF3IHokEMEgQRMY+CAOEQ444QkaWPhgBA5MOJALcDjxIAJ3MKChiBw4gUB+JHCwIkY3qNBGGyoMgVhDGsBRXXVwcPASCCwMYOQATYDgUAkuaEDBBBpwV1IMKKDww5U/oDAACAs2VMKAX5b0hAwCYIklCizcIKJACVhpJpYDyLHmCSqU+eaVA+CxZgFx2HlnnnvqcCecSu6ZgQR3oqnmnjeMIIEHV3oggAcq7DnQDUqwUOUPRiRgaUE3vPGGDp4FBAAh+QQFAgAAACwRABQALAAqAAAI/wALCBxIsKBBgw3KFElj56DDhxAJhrAQgAePMzvoRNwYcUYIHh1E+EiioIObMhxTGixzRoGPlzA7WFBJUyCWDjBzJuFRpKZKAjhzwkSDxWdKC2iEDt1hlKOBoEoV2GiQ0k4dlSFEKkXTws/GMl5erFlD40sJjkD/5HQ5NWKOLRBMwEiBIQWUjQ3oWCiJBk2HMza+rsFQoXDhCxC8pLRBwI0bLCg3eoFguHKKFZHxUlX5wkRly2GaQixRZg2Mz4aBKBb9UMiaFKgLY1jA+uEJNoRjw/hS+2EYz6iBbOn9sAGbQBcqA3kAhvhDPx/0YJhuYgsYIc4h5vDyAUoYjdk5NvoY73zOnPARmXBAEiVKDw5M0Bt00SOCEwQInJDo4UL+wBJERIDDgARGUIN/AuVBAoEMbrDBHv6dMMGCDBJIggMI9kBhhTiQcKB/RGxYYQQTIMiBgBx2yAFHgCQAAggJZLEREwzcgQCHCMDRX0RvyIDCAAOgIMMbG5Vw4o0E3qfBRgkQIsAPUP4gAAoxRHQWB3CQoKUTUSy5ERUDRBklCk0MwZELGlBAgQbnRSSIDh6IKeYAIHBUwlk0qfCknFAOgMcM/sWxJ59+Iggnn33KIYh8gILJZ5w6IFiADiyEOeYAV0g6wxQ6UPHjAALIEIekA83whItyvAEIcQEBACH5BAUCAEAALBEAEwAuACwAAAj/AAsIHEiwoMGDA+2kOdAAocOHEAUCIXAmQIAWWOpE3BgxRIAOIpKIQNPBAh2OKA3SaYHGh0uXfzoQSElT4JgOL3Mm4ZGmJsoGBHDmfNlhTMQDOXKcpGmh5VCXaHY8BMBmhR49a6As3VjHgNCnaGw4BPMAA4wKFVJAeHGgBEcbCp76UHCGTsOCJQ6sMIG2bwUINFDWsfDVpQIRYhF6geC37wU9OVCWcdMBjQIFHQKMaXDX4Au+jdGaWJDSzxg3LdwYOABxS4rQaDF88FmAc8TPsCtg8EKbIxQMuVN86b0xh56zjdcS56jGBOgKFyCsiLwcYkMya2A410MDQHWUdsCo/yGTw/b38+jTq1/Pvr379/BrzpnjNj5BDT3gROnjgH58JjWQ4AQCCDgRQRcMxDdBBDg06GAEfTDxXhU4bODghSRo8J4DJFyIYQ3vTdChhw06gQREN6jAxRVvPEETBSOS6EQP9R10BR8D5IiCFQmgNEMeTpDYYAQUOCSHBB78oOQPArDQI0dzRBGkhwiIUcVBM9zAQpJLKikAFSdwxEQeG0zZYIEOOATCAF12icKTG5WQRxdOkGAnHBw8hAebbXoJAkpuuZCHAxRo4AJEbfDZpwB/0lRCjRCpoGibb74nxQgCLCrDFPDF4EGmSw7AB5zvJWDFp5lmoEMBM8A3wwxTJAcQRxyrrhcQACH5BAUCAAEALBAAEgAwAC4AAAj/AAsIHEiwoMGDB9OEKEIHocOHEAnacGMmiY8zBspE3MhxjI8Of3z4UNChxQGOKBEeOKNApMuPFh6WOJAjSJ2UBRtg6fDSpcUiCLXQWKHnwRY1QnAOtICmp0s0WA6S0QMBxoULJiCwuamUqVORUA3meJCigtmzEKAoLWCA51cFNgyygXC2booVGnGGEPEVTQuDftaUrXs2xZekOAmAfInGTAiDS1bAIHwWg5q1fgiI6ICmQ8nHBukIpmzWBJkGawuEIGDBwpiGCGlgIH1BD4DUA1FDDJPiAmWtXHFz/ABhcIULgbYsEY5zwYoUQEzoYbOcecqZYdSQuW09dQPd3cOL/x9Pvrz58+jTq1/Pvr379/DjCyzhwoV8JhyQwIGDxMEc9y70EIETCCDgRARIMMDeCTVEgMODEEbQA3t5ILABhBg6kYdDgCSgQhw3CEeBgxhGSAFCcYzggQAC/JDBDSesVQMJJUJIAhElFDRDHCig8MOPHkgwQog4lTABjTXicKNBQ4zg449QDmCEIEppgGSNEThQ0AkqDADllz94kECRLsDhRI0IwKFgQW14CeaPA4CwlgZOnAlhnRrESNAMbb75owByzhmFEySQ4EQUGuRoEAhuvinAG7jNkYcDDmjw30EnDNHEk1+iMAIguJUgakQzgCAApz+cqkJ7JagwggADDBAggBWQvidFHFdc8UYW6QUEACH5BAUCACwALA8AEQAyADEAAAj/AAsIHEiwoMGDCAfSSZOGTsKHECMWaHCAwBkzPM4QOPCwDIAgdSSKPHCmg4g/f0R0OFPkIAA2Kx482LIgpMiHbjr42MmzQ4sGBb88gADjwgUTEGg4vHkwBM+nO9GMIRhkhYkKWLMG+sD0IBadUKMSIAgFQtazMB4sAdp14A40YaNaILjl6tmsJsi0JTgGbtwOOxSuSXE3KwYvbPceCCAirAgzaegSLlwByIK9BHd0+PNUBJrABD+YLWwUDGaCBlQqQNPBDJbEAsEYLQzhyOmCIQi4cWMg8kEoQCZXuABhTY7bBhvAPqhmRQogQCrQAIAc84EwC9TkELK8uvfv4MOL/x9Pvrz58+jTq1/Pvr379/Djy59Pv7598C5cMJGvAQmcO11QwIB7J9RAghMIbOBEBFHsgdANKsihgg7gURABDhhmSEIXLhSURRt8CDCAAD8oMQRyJzAgxgYZthgBBwXhIYEHP9TogQRWSFHCbRyQ0GKLJBCxo0BvkFjjkT9IgMdtJzhw4Y8YOtEHQXgMgOSRHjSh42kO+AglDlISRIWRV9aYwG17sPglCROIiUKZNp55Wx9etsiigwNVCWeWJ6IpRp04IECCAwUl4AGNV0qQgXd79CHogXDAaBAXM2IpwQg3fMfEHg44oEGHCMnRhAAilnhDCSd8NyREJUgRAwgT0gZ3QqrsBQQAIfkEBQIABgAsDQAQADUAMgAACP8ACwgceCDIkoEIEypcyFBgGhs20jTUQmPFgwcvyDTcyLFACDdmFCgw46aIQjJ6MMC4cAGIiQ8dYyIMEaDDHx8+kqAxEwKhFj0pKggVegHDApkyWyjAydQHmjN2BtKAMLRqijV1kG5sEEJE06YdxggsswJG1bNahGhtuAPNV6YdCBRoAODBhbNDTWhcy3BHh7c44wo8UBav0BRh+DIcsxRwBywNCgg5AsQwjAcHFSssc6ZxUwUBDgwkQxUvBDaaF3fwylRBErECGwhhE8gsUQhbRKdOGBmLmQ5ogp+xodAPlAcmgADRwybz7oVpdhAgMKYMwwZLyCxQk+M5xwbgI3v/H0++vPnz6NOrX8++vfv38OPLn0+/vv37+PPr38+/v///AAYo4AkuuMDERoAkEEMCUqh3Agd9wHFHFxS4sBAII3ggAApNcJHFeXMQEYETG2zgRARdVJHQIBKg8MOLHkhgxIfl1RABDjjmSEIfBwqkgwcevCjkDxJwUd4eOGyQ45IkaCCQIG0MMKSQKIzQ4HgOkLAkkzUMZIQAUwrpgQ6CjDeBllvi6AQSA1EBZpg/eJAAeRSgmaYTPQyEh5RhesDHDeTl4USaOEZAgUAnvPHmlAMYQV4JTHQx6JYI3MEAQnhIEKSQAvCRwAzl5YGDnTg44QQHBZSAaBZt/DDAqwJQITHneXn0gQAJJDgRhZML6SBHG1y88YR6TOTBgQN5WDhQQAAh+QQFAgBjACwNABAANQAzAAAI/wDHCBQoREuYMAAGKlzIsKHDMQdCjCnSwOGXFxVSpHhAI8jDjyCLWAggkEcLGw0rALlQocIFDCtygJzpUIRAH2MUYFEI4AHDChBe0Bz6UASPIgIbQHHYEgzRpwwJCCzwwoRDDF4KQN2qoMWYAgW2pHAI5MNWrl6/HgFy1cvZrRa0NlgAoeGFC07fDk0iAqXAJSusMqRRUe9MER0MDAQb5gGGC2MuwPhreGaHADsYFtBC4wHLFVAOlKj80QKWA4UZClkCRgtq0iDBwp5Nu7bt27hz697Nu7fv38CDCx9OvLjx48iTK1/OvLnz59CjwwYr+2EBKTeGaMVdwIWGCRM4MMnYvjBBhhEsmhiJQX52AQ1RSMgnIcZB+zExfkjwwF+AAC73VabBBk4ohEAEFJB3QxMoLOTBACqcMJsLURS40AY4VDFaAVc8JMMTsJ2gwUcU0PTDV731INwEHyExkBIO/fCDDrNxQIJDJNQwlQoDNCSAFRKSVkAVYmzAEA5OjCjQFFSMceJAKEAYoF4TRICDQjhEoCJ5Q1AxgH8CSNAECLYxUYN8CCAwhpYuMJSFCkpQYQQXN+SmARFdRNEDB0w4NMMMv53ABHXUBQQAOw==";var d;d='<img onload="'+s+'" src="'+l+'" alt="'+o+'" /><br />';var c=t.content_html?t.content_html:'<div class="loading_hash_animation">'+d+o+"</div>";var _='<base href="https://'+document.location.hostname+'" target="_blank">\n<style>'+i+"</style>\n"+n+"\n"+c;TS.dir(439,t,"_getSpinnerHtml html: "+_);return _};var c=function e(t){if(TS.has_pri[T])TS.dir(T,t,"_storeLastWindowSize token: "+t.token);TS.model.prefs.ssb_space_window=JSON.stringify({token:t.token,x:t.x,y:t.y,width:t.width,height:t.height});m()};var u=function e(){TS.prefs.setPrefByAPI({name:"ssb_space_window",value:TS.model.prefs.ssb_space_window})};var m=function e(){u()};var f=function e(){return TS.utility.parseJSONOrElse(TS.model.prefs.ssb_space_window,null)};var h=function e(t,i){if(window.macgap)p(t,i);else g(t,i)};var g=function e(t,i){var n;try{n=TSSSB.call("getGeometryForWindow",t.token)}catch(e){TS.warn('TSSSB method getGeometryForWindow threw error with token of "'+t.token+'"',e)}if(n){t.x=n.x;t.y=n.y;t.height=n.height;t.width=n.width;setTimeout(i,0)}};var p=function e(t,i){if(t.window){t.x=t.window.screenX+22;t.y=t.window.screenY-23+22;t.width=t.window.innerWidth;t.height=t.window.innerHeight}if(t.document)t.title=t.document.title;i()};var S=function e(i){var n={};if(!Object.keys(t).length){TS.storage.storeClientWindows(n);return}_.forOwn(t,function(e,a){if(!e.worth_saving)return;h(e,function(e){return function(){var a=t[e];if(!a)return;n[e]={token:e,x:a.x,y:a.y,width:a.width,height:a.height,file_id:a.file_id,title:a.title,destination_url:a.destination_url,url:a.url,no_spinner:a.no_spinner,worth_saving:a.worth_saving};if(TS.has_pri[T])TS.dir(T,n[e],"_storeWins LS_win token: "+e);TS.storage.storeClientWindows(n);if(e==i)c(n[e])}}(a))});if(!Object.keys(n).length)TS.storage.storeClientWindows("")};var T=438})()},4361:function(e,t){(function(){"use strict";TS.registerModule("client.ui",{test:function e(){return{_getMemberSharedTeamsContext:R}},CLIENT_HEADER_OVERHANG:8,POSSIBLE_REBUILD_OMISSIONS:["channel_header","user_current_status","channel_pane_channels","channel_pane_apps","channel_pane_ims","channel_pane_starred"],$msgs_scroller_div:$("#msgs_scroller_div"),$msgs_div:$("#msgs_div"),$msg_input:$("#msg_input"),$msg_preview_msg:$("#msg_preview_msg"),$msg_preview:$("#msg_preview"),$emo_menu:null,$banner:$("#banner"),$msgs_unread_divider:null,file_dropped_sig:new signals.Signal,file_pasted_sig:new signals.Signal,did_rebuild_all_sig:new signals.Signal,did_rebuild_all_but_msgs_sig:new signals.Signal,msgs_scrolled_sig:new signals.Signal,onStart:function t(){V();TS.channels.data_updated_sig.add(T);TS.ui.window_focus_changed_sig.add(TS.client.ui.windowFocusChanged);TS.membership.membership_counts_need_refetch_sig.add(TS.client.ui.rebuildMemberListToggle);TS.channels.joined_sig.add(TS.client.ui.rebuildMemberListToggle);TS.channels.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched);TS.ims.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched);TS.groups.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched);TS.mpims.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched);TS.prefs.color_names_in_list_changed_sig.add(TS.client.ui.prefColorNamesInListChanged);TS.prefs.msg_preview_changed_sig.add(TS.client.ui.prefMsgPreviewChanged);TS.prefs.sidebar_behavior_changed_sig.add(TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads);TS.rooms.added_sig.add(w);TS.rooms.changed_name_sig.add(y);TS.rooms.changed_participants_sig.add(k);TS.rooms.changed_date_end_sig.add(A);TS.rooms.changed_channels_sig.add(C);TS.prefs.team_display_email_addresses_changed_sig.add(D);TS.prefs.team_allow_calls_changed_sig.add(x);TS.view.im.im_ui_updated_with_new_msg_sig.add(f);TS.view.channel.channel_ui_updated_with_new_msg_sig.add(f);TS.view.group.group_ui_updated_with_new_msg_sig.add(f);TS.view.mpim.mpim_ui_updated_with_new_msg_sig.add(f);setInterval(W,15e3);TS.client.ui.$msgs_scroller_div.bind("mousedown mouseup",function(){TS.client.msg_pane.checkUnreads()});var i=null;e=new TS.PresenceList;$("html").bind("mousedown",function(e){TS.model.ui.is_mouse_down=true;TS.client.ui.maybeTickleMS();i=$(e.target)});$("html").bind("dragend",function(){TS.model.ui.is_mouse_down=false});$("html").bind("mouseup",function(){TS.model.ui.is_mouse_down=false;setTimeout(function(){if(i&&i.closest(".monkey_scroll_handle").length)if(TS.model.archive_view_is_showing)TS.client.archives.maybeLoadScrollBackHistory();else if(!TS.model.showing_welcome_2)TS.client.ui.maybeLoadScrollBackHistory();i=null},10)});TS.client.ui.$msgs_scroller_div.scroll(TS.client.ui.onMsgsScroll);if(!TS.useReactSidebar())TS.client.channel_pane.$scroller.scroll(TS.client.ui.onChannelsScroll);TS.client.login_sig.add(TS.client.ui.loggedIn,TS.ui);TS.client.msg_input.bind(TS.client.ui.$msg_input);if(!(TS.boot_data.feature_texty&&(TS.model.is_our_app||TS.boot_data.feature_texty_browser_substitutions)))TSSSB.call("inputFieldCreated",TS.client.ui.$msg_input.get(0));function n(){TS.client.ui.enhanceComponents();TS.client.ui.bindCommentInput();$(window.document).keydown(TS.client.ui.onWindowKeyDown).keyup(TS.client.ui.onWindowKeyUp);$("#team_menu .notifications_menu_btn").bind("click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.menu.startWithNotificationsMenu(e)});$("#team_menu").bind("click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;if($(e.target).closest(".notifications_menu_btn").length)return false;TS.menu.startWithTeamAndUser(e)});if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())$("#file_preview_container").on("textchange","#file_comment",function(){TS.client.ui.files.storeLastCommentInputForPreviewedFile($(this).val());TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"))});if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())$("#file_comment").css("overflow","hidden").autogrow();$("#file_comment_form").bind("submit",function(){TS.client.ui.files.submitFileComment();return false});$(window).on("click",S);if(!TS.qs_args.ignore_mm)$("#header, #footer, #col_channels, #client_body, #col_flex").on("mouseenter",S);var e="ontouchstart"in document.documentElement;if(e)$("html").addClass("touch");else $("html").addClass("no_touch");TS.client.archives.$scroller.scroll(function(){TS.model.ui.cached_archive_scroll_result=null});TS.client.ui.$msgs_scroller_div.scroll(function(){TS.model.ui.cached_msgs_scroll_result=null});var t=_.throttle(function(e){var t=$(e.target);if(!t.closest("body").length)return;var i=t.closest("button");var n=i.data("emoji");if(!n)return;n=n.toString();var a=t.closest(".rxn_panel").data("rxnKey");var r=TS.rxns.getExistingRxnsByKey(a);var s=_.find(r,{name:n});var o=s.users;var l={count:s.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(r,n),name:n,url:s.url,rxn_key:a,member_ids:o};if(TS.boot_data.feature_teams_to_workspaces)TS.tips.updateTipTitle(i,TS.i18n.t("Loading members…","client")());else TS.tips.updateTipTitle(i,TS.i18n.t("Loading team members…","client")());TS.members.ensureMembersArePresent(o).then(function(){var e=TS.templates.builders.buildRxnTitle(l,true);TS.tips.updateTipTitle(i,e)}).catch(function(e){TS.console.logError(e,"couldnt_load_reactors","unknown_member_error",false);if(TS.boot_data.feature_teams_to_workspaces)TS.tips.updateTipTitle(i,TS.i18n.t("Couldn’t load members","client")());else TS.tips.updateTipTitle(i,TS.i18n.t("Couldn’t load team members","client")())})},300);$("BODY").delegate(".rxn_panel button","mouseover",t);$(window).on("copy cut",function(e){if(TS.utility.isFocusOnInput()){if(!TS.utility.contenteditable.supportsTexty())return;var t=document.activeElement;if(!TS.utility.contenteditable.isContenteditable(t))return}try{var i=window.getSelection();var n;var a=TS.format.formatSelection(i,{customFn:function e(t){if(t.getAttribute("data-member-label")===t.textContent)return t.getAttribute("data-member-label");else if(t.hasAttribute("data-member-name"))return"@"+t.getAttribute("data-member-name")}});var r;if(TS.boot_data.feature_texty_mentions)r=TS.format.formatSelection(i,{customFn:function e(t){if(t.hasAttribute("data-member-id"))return"<@"+t.getAttribute("data-member-id")+"|"+t.getAttribute("data-member-label")+">";else if(t.hasAttribute("data-user-group-id"))return"<@"+t.getAttribute("data-user-group-id")+"|"+t.getAttribute("data-stringify-text")+">";else if(t.hasAttribute("data-broadcast-id"))return"<@"+t.getAttribute("data-broadcast-id")+"|"+t.getAttribute("data-stringify-text")+">"}});if(TS.boot_data.feature_texty_mentions&&$(e.target).closest(".ql-editor").length)n=TS.format.formatSelectionAsHTML(i);var s={};if(a)s={"text/plain":a,text:a,"public.utf8-plain-text":a,Text:a};if(TS.boot_data.feature_texty_mentions){if(n){s["text/html"]=n;s["slack/"+TS.model.team.id]=n}if(r)s["slack/plain"]=r}if(_.size(s)>0)TS.clipboard.writeTextFromEvent(e,s)}catch(e){TS.error("window copy handler error: "+e)}})}if(TS.has_pri[N])TS.log(N,"deferring UI bind until login_sig");TS.client.login_sig.add(n);if(TS.useReactMessages())TS.interop.mountMessagePane(document.querySelector(".p-history_container"));Y()},spaces_tooltip:{state:"hide",pending_change:null},loggedIn:function e(){if(TS.isPartiallyBooted()&&!TS.model.ms_connected){if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(TS.client.ui.loggedIn);else TS.ms.connected_sig.addOnce(TS.client.ui.loggedIn);if(TS.model.ui_state.flex_name)TS.client.ui.flex.showFlex();$("#main_emo_menu").removeClass("hidden").bind("click.incremental_boot",function(e){e.preventDefault();TS.incremental_boot.userDidInteractWithUI()});return}TS.client.ui.flex.setFlexStateFromHistory(TS.model.ui_state.flex_name,TS.model.ui_state.flex_extra,true);if(TS.model.ui_state.flex_name){TS.client.flexDisplaySwitched(TS.model.ui_state.flex_name,TS.model.ui_state.flex_extra,true);TS.client.ui.flex.showFlex()}$("#main_emo_menu").removeClass("hidden").off("click.incremental_boot").bind("click.open_dialog",function(e){TS.client.msg_input.removePrecedingAtSign();TS.ui.react_emoji_menu.start({e:e,input_to_fill:TS.client.ui.$msg_input,offset_y:4});TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"emoji_menu_button"}}})});if(window.extraCmds)window.extraCmds();TS.shared.checkDisplayEmailAddressPref()},rebuildAllButMsgs:function e(r,s,o){s=s||{};if(o){n=n||r;TS.client.ui.POSSIBLE_REBUILD_OMISSIONS.forEach(function(e){if(!s[e])a[e]=false});i+=1;if(t)return;d(n,a);t=true;setTimeout(function(){t=false;if(i>1){d(n,a);TS.metrics.count("rebuild_all_but_msgs_throttles",i)}i=0;n=false;a={}},1e3)}else d(r,a)},rebuildAll:function e(t,i){if(i){if(TS.utility.enableFeatureForUser(10))TS.statsd.count("client_rebuild_throttled");o=o||t;s+=1;if(r)return;c(o);r=true;setTimeout(function(){r=false;if(s>1){c(o);TS.metrics.count("rebuild_all_throttles",s)}s=0;o=false},1e3)}else c(t)},windowFocusChanged:function e(t){if(t){TS.client.ui.startUnreadCheckingTimer();TS.client.ui.maybeTickleMS();if(TS.view)TS.view.updateTitleBarColor();TS.model.ui.is_mouse_down=false}else clearTimeout(TS.client.ui.unread_checking_tim)},cal_key_checker:{tim:null,tim_ms:200,prevent_enter:false,space_pressed_last:false,reset:function e(){clearTimeout(TS.client.ui.cal_key_checker.tim);TS.client.ui.cal_key_checker.space_pressed_last=false;TS.client.ui.cal_key_checker.prevent_enter=false},check:function e(t){if(TS.client.ui.cal_key_checker.space_pressed_last&&32!=t){TS.client.ui.cal_key_checker.reset();if(73==t){TS.client.ui.cal_key_checker.prevent_enter=true;TS.client.ui.cal_key_checker.tim=setTimeout(TS.client.ui.cal_key_checker.reset,TS.client.ui.cal_key_checker.tim_ms)}}else if(32==t){TS.client.ui.cal_key_checker.reset();TS.client.ui.cal_key_checker.space_pressed_last=true;TS.client.ui.cal_key_checker.tim=setTimeout(TS.client.ui.cal_key_checker.reset,TS.client.ui.cal_key_checker.tim_ms)}else TS.client.ui.cal_key_checker.reset()}},keyPressIsValidForFocusOnNextOrPreviousMessage:function e(t){if(!t)return false;var i=TS.utility.keymap;var n=-1!==[i.left_square_bracket,i.right_square_bracket,i.minus_sign,i.equals_sign].indexOf(t.which);var a=t.altKey&&TS.utility.cmdKey(t);return n&&a&&TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()},keyPressIsValidForGotoNextOpenChannelOrIM:function e(t){var i=TS.utility.keymap;if(!t)return false;if(!t.altKey)return false;if(t.which!=i.up&&t.which!=i.down)return false;if(!TS.client.ui.isUserAttentionOnChat())return false;if(TS.utility.isFocusOnInput()){var n=$(document.activeElement);var a=TS.utility.contenteditable.getLength(n);if(a){var r=TS.utility.contenteditable.isTextSelected(n);if(r)return false;var s=TS.utility.getCursorPosition(n).start;if(t.which==i.up&&0!==s)return false;if(t.which==i.down&&s!=a)return false}}return true},page_scroll_dest:null,onWindowKeyDown:function e(t){if(TS.isPartiallyBooted()){if(TS.utility.cmdKey(t)){t.preventDefault();t.stopPropagation()}return}var i=Date.now();var n=TS.utility.keymap;var a=t.which==n.enter;TS.model.last_key_down_e=t;TS.client.ui.cal_key_checker.check(t.which);var r=TS.key_triggers[t.which.toString()];if(TS.client.ui.isUserAttentionOnChat()&&r&&(!r.isDisabled||!r.isDisabled(t))&&(t.metaKey&&(!t.ctrlKey||!TS.model.is_mac)||t.ctrlKey&&!t.altKey&&!TS.model.is_mac)&&(!r.no_shift&&(t.shiftKey||r.shift_optional)||r.no_shift&&!t.shiftKey)){t.preventDefault();t.stopPropagation();if(TS.model.ms_logged_in_once&&TS.model.prefs&&!$("body").hasClass("loading"))r.func(t)}else if(TS.boot_data.feature_a11y_keyboard_shortcuts&&TS.client.ui.keyPressIsValidForFocusOnNextOrPreviousMessage(t)){t.preventDefault();t.stopPropagation();switch(t.which){case n.left_square_bracket:TS.ui.a11y.focusOnPreviousMessage();break;case n.right_square_bracket:TS.ui.a11y.focusOnNextMessage();break;case n.minus_sign:TS.ui.a11y.focusOnOldestUnreadMessage();break;case n.equals_sign:TS.ui.a11y.focusOnMessageInput()}}else if(TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&!TS.utility.isFocusOnInput()&&TS.utility.cmdKey(t)&&!t.altKey&&t.which==n.up)TS.client.ui.maybeEditLast(t);else if(TS.client.ui.isUserAttentionOnChat()&&(t.which==n.left_square_bracket||t.which==n.right_square_bracket||t.which==n.left||t.which==n.right))g(t);else if(TS.client.ui.keyPressIsValidForGotoNextOpenChannelOrIM(t)&&!TS.useReactSidebar()){var s=false;if(t.which==n.up)s=TS.client.ui.gotoNextOpenChannelOrIM(t.shiftKey,true);else if(t.which==n.down)s=TS.client.ui.gotoNextOpenChannelOrIM(t.shiftKey,false);if(s)if(TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input))TS.client.ui.$msg_input.blur();t.preventDefault()}else if((TS.client.ui.isUserAttentionOnChat()||TS.ui.shortcuts_dialog.showing)&&191==t.which&&!t.altKey&&!t.shiftKey&&TS.utility.cmdKey(t)){if(TS.ui.shortcuts_dialog.showing)TS.ui.shortcuts_dialog.cancel();else TS.ui.shortcuts_dialog.start();t.preventDefault()}else if(TS.client.ui.isUserAttentionOnChat()&&190==t.which&&!t.altKey&&TS.utility.cmdKey(t)){if("whats_new"===TS.model.ui_state.flex_name)TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"keyboard_cmd_dot",step:TS.client.whats_new.getNewestID()});TS.client.ui.flex.toggleFlex();t.preventDefault()}else if(TS.client.ui.isUserAttentionOnChat()&&TS.utility.cmdKey(t)&&t.shiftKey&&(75==t.which||84==t.which&&TS.model.is_our_app))if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.close();else{if(84==t.which)TS.client.threads.showThreadsView();else TS.ui.im_browser.start();t.preventDefault()}else if(t.which==n.space){if(TS.model.prefs&&TS.model.prefs.pagekeys_handled)if(TS.utility.isFocusOnInput()){if(t.which==n.space&&t.shiftKey&&TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input)&&TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input)){TS.client.ui.$msg_input.blur();t.preventDefault()}}else if(TS.model.is_FF)TS.client.ui.$msgs_scroller_div.focus()}else if(t.which==n.esc)TS.client.ui.onEscKey(t);else if(TS.utility.isPageKey(t.which)&&TS.model.prefs&&TS.model.prefs.pagekeys_handled&&!t.shiftKey&&!t.ctrlKey&&!t.altKey&&!t.metaKey){if(TS.model.unread_view_is_showing||TS.model.threads_view_is_showing)return;var o=TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input);var l=!o&&TS.utility.isFocusOnInput();var d=TS.model.archive_view_is_showing;var c=d?TS.client.archives.$scroller:TS.client.ui.$msgs_scroller_div;var _=c[0].scrollTop;var u=c[0].scrollHeight;var m=c.height();i=_;if(null!==TS.client.ui.page_scroll_dest)i=TS.client.ui.page_scroll_dest;var f=true;var h=$(document.activeElement);var p=false;if(t.which==n.pageup)if(l)f=false;else if(p&&o&&h.val())f=false;else TS.client.ui.page_scroll_dest=i-m;else if(t.which==n.pagedown)if(l)f=false;else if(p&&o&&h.val())f=false;else TS.client.ui.page_scroll_dest=i+m;else if(t.which==n.home)if(l||o&&h.val()){if(TS.model.is_mac)if(t.shiftKey);else{h.setCursorPosition(0);t.preventDefault()}f=false}else TS.client.ui.page_scroll_dest=0;else if(t.which==n.end)if(l||o&&h.val()){if(TS.model.is_mac)if(t.shiftKey);else{h.setCursorPosition(1e6);t.preventDefault()}f=false}else TS.client.ui.page_scroll_dest=u;if(f){TS.client.ui.slowScrollMsgsToPosition(TS.client.ui.page_scroll_dest,true,function(){TS.client.ui.page_scroll_dest=null});t.preventDefault()}}else if(!TS.utility.isFocusOnInput()&&TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&!TS.utility.isArrowKey(t.which)&&!TS.utility.isPageKey(t.which)&&!t.metaKey&&!t.ctrlKey&&!t.altKey&&!TS.ui.react_emoji_menu.is_showing){if(16==t.keyCode)return;if(TS.boot_data.feature_keyboard_navigation&&"BUTTON"==t.target.tagName&&a&&bowser&&bowser.msedge){t.preventDefault();t.target.click();return}if(TS.model.archive_view_is_showing&&a){if(TS.boot_data.feature_keyboard_navigation&&$(t.target).hasClass("focus-ring")&&!$(t.target).is("#footer_archives_action_button"))return;TS.client.archives.tryToJoin();return}if(TS.boot_data.feature_keyboard_navigation&&(t.which==n.tab||a))return;if(t.which==n.tab&&!TS.utility.cmdKey(t)||a)t.preventDefault();if(TS.i18n.isLocaleCJK())setTimeout(TS.view.focusMessageInput,0);else TS.view.focusMessageInput()}else if((window.macgap||window.winssb)&&!TS.utility.isFocusOnInput()&&TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&t.which==n.V&&!t.altKey&&TS.utility.cmdKey(t)){var S;var T;var v=window.macgap||window.winssb;if(v.clipboard&&v.clipboard.readString&&v.clipboard.readImage){S=v.clipboard.readString();if(S){TS.client.msg_input.populate(TS.utility.contenteditable.value(TS.client.ui.$msg_input)+S);t.preventDefault()}else{T=v.clipboard.readImage();if(T){TS.ui.paste.startUploadFromMacSSBReadImage(T,t.shiftKey);t.preventDefault()}}}TS.view.focusMessageInput()}else if(TS.model.archive_view_is_showing&&t.which==n.enter&&!t.metaKey&&!t.ctrlKey&&!t.altKey);if(TS.model.profiling_keys)TS.model.addProfilingKeyTime("onWindowKeyDown",Date.now()-i);if(t.which==n.shift||t.shiftKey)TS.model.shift_key_pressed=true;if(t.which==n.insert)TS.model.insert_key_pressed=true;if(t.which==n.alt||t.altKey)TS.model.alt_key_pressed=true;if(t.shiftKey&&t.metaKey&&t.which!=n.V)TS.model.shift_key_pressed=false},onWindowKeyUp:function e(t){TS.model.last_key_down_e=null;var i=TS.utility.keymap;if(t.which==i.shift)TS.model.shift_key_pressed=false;if(t.which==i.insert)TS.model.insert_key_pressed=false;if(t.which==i.alt){TS.model.alt_key_pressed=false;if(!TS.utility.isFocusOnInput()&&!TS.selection.isAnyTextSelected()&&!TS.ui.fs_modal.is_showing)TS.view.focusMessageInput()}},onEscKey:function e(t){try{t.stopPropagation()}catch(e){}try{t.preventDefault()}catch(e){}var i=$(t.target);if(TS.boot_data.feature_keyboard_navigation&&i.hasClass("focus-ring"))i.removeClass("focus-ring");if(!TS.client.ui.isUserAttentionOnChat())return;if(TS.model.unread_view_is_showing)return;if(TS.model.archive_view_is_showing){TS.client.archives.userWantsToCancel();return}if(TS.msg_edit.editing)return;if(TS.ui.react_emoji_menu.is_showing)return;var n=t.shiftKey;if(n){var a=function e(){TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.esc_all,n);var t=TS.model.channels;var i=TS.model.groups;var a;var r=true;TS.redux.channels.clearAllShowInListEvenThoughUnreadsFlags();for(a=t.length-1;a>-1;a-=1)if(t[a].unread_cnt){TS.channels.markMostRecentReadMsg(t[a],TS.model.marked_reasons.muted,r);TS.channels.unread_changed_sig.dispatch(t[a],true)}for(a=i.length-1;a>-1;a-=1)if(i[a].unread_cnt){TS.groups.markMostRecentReadMsg(i[a],TS.model.marked_reasons.muted,r);TS.groups.unread_changed_sig.dispatch(i[a],true)}TS.replies.markAllThreads()};if(false===TS.model.prefs.confirm_clear_all_unreads||0===TS.model.all_unread_cnt)a();else{var r='<p class="no_bottom_margin float_right"><label class="checkbox overlay_pref block"><input id="confirm_clear_all_unreads_cb" type="checkbox" /> '+TS.i18n.t("Don’t ask me again, please","client")()+"</label><p>";TS.generic_dialog.start({title:TS.i18n.t("Clear all unreads?","client")(),body:"<p>"+TS.i18n.t("<b>Shift+esc</b> will clear all unread messages and notifications. Are you sure you want to do this? It’s liberating … but there’s no going back.","client")()+"</p>"+r,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, clear all!","client")(),onGo:function e(){a();var t=!!$("#confirm_clear_all_unreads_cb").prop("checked");if(t)TS.prefs.setPrefByAPI({name:"confirm_clear_all_unreads",value:false})}})}}else if(!TS.client.activeChannelIsHidden())TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.esc,n);else if(TS.model.threads_view_is_showing)TS.client.threads.markAllNewThreads()},checkForEditing:function e(t){if(!TS.msg_edit.editing)return false;if(!t||!t.target||0===$(t.target).closest("#message_edit_form, #emoji_menu").length){if(!TS.msg_edit.editing_in_msg_pane)return false;if(TS.msg_edit.mousedown_active){TS.msg_edit.mousedown_active=false;return true}if(TS.msg_edit.cancelEditingINothingHasChanged())return false;TS.sounds.play("beep");TS.msg_edit.promptEdit()}return true},maybeTickleMS:function e(){var t="returning from client.ui.maybeTickleMS: ";TS.console.log(2017,"client.ui.maybeTickleMS called");if(!TS.model.user){TS.console.log(2017,t+" TS.model.user is falsy ("+TS.model.user+")");return}if(!TS.model.ms_connected){TS.console.log(2017,t+" TS.model.ms_connected is falsy ("+TS.ms.connected+")");return}if("away"===TS.model.user.manual_presence){TS.console.log(2017,t+" TS.model.user.manual_presence is set to AWAY");return}var i=Date.now()-TS.model.last_net_send;var n=2e4;if(i<n&&"active"===TS.model.user.presence){TS.console.log(2017,t+" TS.model.user.manual_presence is set to ACTIVE, and we haven't hit timeout yet.");return}TS.client.ui.tickleMS()},tickleMS:function e(){if(!TS.interop.SocketManager.isConnected())return;TS.console.log(2017,"client.ui.tickleMS called");TS.model.last_net_send=Date.now();if(TS.isSocketManagerEnabled())TS.interop.SocketManager.send({type:"tickle"});else TS.ms.send({type:"tickle"})},forceMarkAllRead:function e(t,i){TS.client.msg_pane.dont_check_unreads_til_switch=false;TS.client.ui.markMostRecentReadMsgInActive(t,true);if(i){var n=TS.model.channels;var a=TS.model.ims;var r=TS.model.groups;var s=TS.model.mpims;var o;var l=true;for(o=n.length-1;o>-1;o-=1)if(n[o].unread_cnt)TS.channels.markMostRecentReadMsg(n[o],t,l);for(o=a.length-1;o>-1;o-=1)if(a[o].unread_cnt)TS.ims.markMostRecentReadMsg(a[o],t,l);for(o=r.length-1;o>-1;o-=1)if(r[o].unread_cnt)TS.groups.markMostRecentReadMsg(r[o],t,l);for(o=s.length-1;o>-1;o-=1)if(s[o].unread_cnt)TS.mpims.markMostRecentReadMsg(s[o],t,l)}TS.client.markLastReadsWithAPI()},maybePromptForSetActive:function e(){var t=TS.model.user;if("away"!==t.manual_presence)return;if(TS.model.ui.is_window_focused)TS.client.ui.promptForSetActive();else TS.ui.window_focus_changed_sig.addOnce(TS.client.ui.promptForSetActive)},promptForSetActive:function e(){if(TS.model.prefs.confirm_user_marked_away){var t=TS.model.user;var i='<p class="no_bottom_margin float_right"><label class="checkbox overlay_pref block"><input id="confirm_user_marked_away" type="checkbox" /> '+TS.i18n.t("Don’t ask me again, please","client")()+"</label><p>";setTimeout(function(){if("away"!==t.manual_presence)return;TS.generic_dialog.start({unique:"set_active_prompt",title:TS.i18n.t('You are marked as "away"',"client")(),body:"<p>"+TS.i18n.t("Would you like to switch to appear active?","client")()+"</p>"+i,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, set me to active","client")(),go_button_class:"btn_success",cancel_button_text:TS.i18n.t("No, still away","client")(),onGo:function e(){if("away"===t.manual_presence)TS.members.toggleUserPresence();var i=!!$("#confirm_user_marked_away").prop("checked");if(i)TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:false})},onCancel:function e(){var t=!!$("#confirm_user_marked_away").prop("checked");if(t)TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:false})}})},2e3)}},enhanceComponents:function e(){$("#flexpane_tabs li a").on("shown",function(){TS.view.resizeManually("TS.client.ui.enhanceComponents")})},shouldEventTriggerMaybeEditLast:function e(t,i){return TS.utility.contenteditable.isEmpty(i)&&(TS.utility.cmdKey(t)||TS.model.prefs&&!TS.model.prefs.arrow_history)&&!t.altKey&&t.which==TS.utility.keymap.up},maybeEditLast:function e(t){t.preventDefault();t.stopPropagation();var i=TS.shared.getActiveModelOb();var n;var a;if(i){if(TS.useReactMessages()){var r=TS.redux.getState();var s=TS.interop.redux.entities.messages.getMessagesByChannelId(r,i.id);a=_.orderBy(Object.values(s),"ts","desc")}else a=i.msgs;a=TS.utility.msgs.getDisplayedMsgs(a);n=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,a);if(n){TS.msg_edit.startEdit(n.ts,i,null,n);return true}}TS.sounds.play("beep");return false},bindCommentInput:function e(){if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty())$("#file_comment").on("focusin",function(){var e=$(this).closest(".flex_content_scroller")[0];if(e)e.scrollTop=e.scrollHeight});else $("#file_comment").bind("focus",function(){var e=$(this).closest(".flex_content_scroller")[0];if(e)e.scrollTop=e.scrollHeight})},showRepliesFromHistory:function e(t){var i=false;var n=true;TS.client.flexDisplaySwitched("convo",t,i,n)},showAppsFromHistory:function e(t){if(!t)return TS.client.ui.flex.hideFlex();var i=false;var n=true;var a;var r=TS.shared.getActiveModelOb().id;var s=TS.channels.getChannelById(r);if(_.get(s,"is_shared"))return TS.client.ui.flex.hideFlex();a=_.get(TS.model.team,"id");TS.apps.promiseToGetFullAppProfile(t,a,null,true).then(function(e){TS.client.ui.app_profile.openWithApp(e,t,a);TS.client.flexDisplaySwitched("apps",t,i,n)}).catch(function(){return TS.client.ui.flex.hideFlex()})},showSearchFromHistory:function e(t){if(!t){TS.client.ui.flex.openFlexTab("mentions");return}t=TS.search.truncateQuery(t);t=t.replace(/%23/g,"#");t=t.replace(/%252F/g,"/");var i=TS.search.input;TS.utility.contenteditable.value(i,t);i.data("textchange_lastvalue",t);$("#header_search_form").submit();TS.client.flexDisplaySwitched("search",t,false,true)},showTeamFromHistory:function e(t,i){if(!t){TS.client.ui._displayTeamList();TS.client.flexDisplaySwitched("team",null,false,true);return}var n;if(TS.interop.utility.looksLikeMemberId(t)){n=TS.members.getMemberById(t);if(!n&&!i){TS.members.ensureMembersArePresent([t]).finally(function(){TS.client.ui.showTeamFromHistory(t,true)});return}}if(!n)n=TS.members.getMemberByName(t);var a=TS.user_groups.getUserGroupsById(t);if(n)TS.client.ui._displayMember(n.id).then(function(e){TS.client.flexDisplaySwitched("team",e,false,true)},_.noop);else if(a){TS.client.ui._displayUserGroup(a.id);TS.client.flexDisplaySwitched("team",a.id,false,true)}else{TS.client.ui._displayTeamList();TS.client.flexDisplaySwitched("team",null,true)}},showView:function e(t){switch(t){case"Vall_unreads":TS.client.unread.showUnreadView();break;case"Vall_threads":TS.client.threads.showThreadsView();break;case"Vapp_space":TS.ui.apps_browser.start();break;default:TS.warn('Unknown view "'+t+'" passed to TS.client.ui.showView()')}},onSubmit:function e(t){try{var i=$.trim(t);if(!i)return;var n="/unarchive"===i||"/leave"===i||"/part"===i||"/close"===i;var a=TS.shared.getActiveModelOb();if(!n&&a&&a.is_archived){TS.generic_dialog.alert(TS.i18n.t("This channel has been archived; you cannot send messages to it.","client")());TS.client.msg_input.populate(i);return}TS.view.clearMessageInput();TS.utility.contenteditable.clearHistory(TS.client.msg_input.$input);if(TS.utility.msgs.shouldSendSlashCommand(t))TS.client.ui.sendSlashCommand(a,t);else TS.client.ui.sendMessage(a,t)}catch(e){TS.error(e)}},sendSlashCommand:function e(t,i,n){if("／"===i.substr(0,1))i=i.replace("／","/");TS.chat_history.add(i);var a=TS.cmd_handlers.parseArgs(i);var r=TS.utility.msgs.getEditLastShortcutCmd(i);if(TS.cmd_handlers[a.cmd]&&"client"===TS.cmd_handlers[a.cmd].type)setTimeout(function(){TS.cmd_handlers.runCommand(a,n,t)},10);else if(r){TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",t.id);TS.utility.msgs.tryToEditLastMsgFromShortcut(r)}else{if(n&&!TS.cmd_handlers.isCmdSupportedInThreads(a.cmd)){TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(a.cmd,a.original_txt,n,t);return}if("/me"===a.cmd&&TS.model.prefs.convert_emoticons&&"as_text"!==TS.model.prefs.emoji_mode)a.rest=TS.format.doEmoticonConversion(a.rest);var s=a.rest;var o=TS.format.cleanCommandText(s);if(TS.boot_data.feature_name_tagging_client){s=_.trim(a.original_txt.substr(a.cmd.length));o=TS.format.cleanMsg(s)}var l={command:a.cmd,text:o,channel:t.id,disp:a.disp,client_token:TS.interop.client_action_token.generateAndEnqueue()};if(n)l.thread_ts=n.ts;TS.api.call("chat.command",l,function(e,t,i){TS.client.ui.onAPICommand(e,t,i,TS.boot_data.feature_name_tagging_client?a.original_txt:s)})}u(t)},sendMessage:function e(t,i,n,a){TS.chat_history.add(i);var r=TS.shared.getControllerForModelOb(t);if(_.isFunction(r.sendMsg))r.sendMsg(t.id,i,n,a);else return;if(t.id===TS.model.active_cid)TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);u(t)},prefMsgPreviewChanged:function e(){if(!TS.model.prefs.msg_preview&&TS.model.msg_preview_showing){TS.client.ui.$msg_preview.addClass("hidden");TS.model.msg_preview_showing=false}else if(TS.model.prefs.msg_preview&&!TS.model.msg_preview_showing)TS.client.ui.$msg_input.trigger("textchange");if(TS.model.prefs.msg_preview&&!TS.model.prefs.msg_preview_persistent&&TS.model.msg_preview_showing)TS.client.ui.$msg_input.trigger("textchange");TS.view.resizeManually()},prefColorNamesInListChanged:function e(){if(TS.model.prefs.color_names_in_list)$(".nuc").removeClass("nuc").addClass("user_colored");else $(".user_colored").removeClass("user_colored").addClass("nuc")},onAPICommand:function e(t,i,n,a){if(!TS.boot_data.feature_name_tagging_client)a=n.disp+" "+a;var r=TS.model.active_cid;var s;if(!t){if(n.channel&&n.thread_ts)TS.utility.populateThreadInputs(a,n.channel,n.thread_ts);else if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input))TS.utility.populateInput(TS.client.ui.$msg_input,a);var o;var l=_.escape(a);if(TS.boot_data.feature_name_tagging_client)l=TS.format.texty.convertContentsToStringForDisplay(TS.format.texty.convertContentsStringToContents(a));if(i.error&&"restricted_action"===i.error)o=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("*{cmd_txt}* failed because you are not allowed to perform that action. Talk to your Workspace Owner.","client")({cmd_txt:l}):TS.i18n.t("*{cmd_txt}* failed because you are not allowed to perform that action. Talk to your Team Owner.","client")({cmd_txt:l});else if(i.error&&"Unknown command"!==i.error&&"unknown_command"!==i.error)o=TS.i18n.t('*{cmd_txt}* failed with the error "{err_txt}"',"client")({cmd_txt:l,err_txt:i.error});else if(i.error)o=TS.i18n.t('*{cmd_txt}* is not a valid command. In Slack, all messages that start with the "/" character are interpreted as commands.\n\n If you are trying to send a message and not run a command, try preceding the "/" with an empty space.',"client")({cmd_txt:l});else o=TS.i18n.t("*{cmd_txt}* failed with an unknown error.","client")({cmd_txt:l});s={text:o,ephemeral_type:"temp_slash_cmd_feedback",channel:r,slackbot_feels:"sad_surprise"};if(n.channel&&n.thread_ts){s.channel=n.channel;s.thread_ts=n.thread_ts;s.ephemeral_type="threads_temp_slash_cmd_feedback"}TS.client.ui.addOrFlashEphemeralBotMsg(s)}if(i.response){if(i.open_url){var d="_"+Math.random();TS.info("gonna try to launch a new tab/window with target: "+d+" url: "+i.open_url);TS.utility.openInNewTab(i.open_url,d)}if(i.keep_input)if(n.channel&&n.thread_ts)TS.utility.populateThreadInputs(a,n.channel,n.thread_ts);else if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input))TS.utility.populateInput(TS.client.ui.$msg_input,a);var c=r;if(n.channel&&n.channel!=c)if(TS.channels.getChannelById(n.channel))c=n.channel;else if(TS.ims.getImById(n.channel))c=n.channel;else if(TS.groups.getGroupById(n.channel))c=n.channel;if(i.is_temp){s={text:i.response,ephemeral_type:"temp_slash_cmd_feedback",channel:c};if(n.thread_ts){s.thread_ts=n.thread_ts;s.ephemeral_type="threads_temp_slash_cmd_feedback"}TS.client.ui.addOrFlashEphemeralBotMsg(s)}else{TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);if(n.channel&&n.thread_ts)TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.channel);else TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);s={text:i.response,channel:c,thread_ts:n.thread_ts};TS.client.ui.addEphemeralBotMsg(s)}}else if(t){if(n.channel&&n.thread_ts)TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.channel);else TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);if(i.keep_input)if(n.channel&&n.thread_ts)TS.utility.populateThreadInputs(a,n.channel,n.thread_ts);else if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input))TS.utility.populateInput(TS.client.ui.$msg_input,a)}},checkInlineImgsAndIframesEverywhere:function e(t){TS.client.ui.checkInlineImgsAndIframes("main",t);TS.client.ui.checkInlineImgsAndIframes("search",t);TS.client.ui.checkInlineImgsAndIframes("archives",t);TS.client.ui.checkInlineImgsAndIframes("file_preview",t);TS.client.ui.checkInlineImgsAndIframes("file_list",t);TS.client.ui.checkInlineImgsAndIframes("replies",t);TS.client.ui.checkInlineImgsAndIframes("threads",t);TS.client.ui.checkInlineImgsAndIframes("unread",t)},checkInlineImgsAndIframesMain:function e(){TS.client.ui.checkInlineImgsAndIframes("main")},getCachedDimensionsRect:function e(t,i){var n;if(TS.model.ui[t])return TS.model.ui[t];if(!i||!i[0])return{top:0,bottom:0,left:0,right:0,width:0,height:0};n=i.dimensions_rect();if(n.width&&0!==n.width)TS.model.ui[t]=n;return n},checkInlineImgsAndIframes:function e(t,i){var n;var a;if("main"===t){n=TS.client.ui.$msgs_div;a=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div)}else if("search"===t){n=$("#search_results");a=TS.client.ui.getCachedDimensionsRect("cached_search_scroller_rect",n)}else if("archives"===t){n=TS.client.archives.$scroller;a=TS.client.ui.getCachedDimensionsRect("cached_archives_scroller_rect",n)}else if("file_preview"===t){n=$("#file_preview_container");a=TS.client.ui.getCachedDimensionsRect("cached_file_preview_scroller_rect",n)}else if("file_list"===t){n=$("#file_list");a=TS.client.ui.getCachedDimensionsRect("cached_file_list_scroller_rect",n)}else if("replies"===t){n=$("#convo_scroller");a=TS.client.ui.getCachedDimensionsRect("cached_convo_scroller_rect",n)}else if("unread"===t){n=TS.client.ui.unread.$scroller;a=TS.client.ui.getCachedDimensionsRect("cached_unread_scroller_rect",n)}else if("threads"===t){n=TS.client.ui.threads.$scroller;a=TS.client.ui.getCachedDimensionsRect("cached_threads_scroller_rect",n)}else{TS.info("unknown which in checkInlineImgsAndIframes(which)");return}if(i)TS.info("checkInlineImgsAndIframes which:"+t);var r=n.find(".msg_inline_holder:not(.hidden) .msg_inline_child.hidden, .msg_inline_file_preview_toggler:not(.collapsed) + .image_container .image_bg");var s;var o;var l;var d;var c="loaded_bg";r.each(function(){o=$(this);d=o.closest(".msg_inline_holder, .image_container");if(!d.length)return;if(d.data(c))return;s=d.dimensions_rect();if(i)TS.dir(0,s);if(i)TS.dir(0,a);if(TS.utility.doRectsOverlap(a,s)){if(i)TS.info("yes");if(o.data("real-background-image")){o.removeClass("hidden");o.css("background-image",'url("'+o.data("real-background-image")+'")');l=o.find("img")}else{l=o;l.removeClass("hidden")}l.attr("src",l.data("real-src"));l.error(function(){$(this).closest(".msg_inline_holder, .image_body").addClass("broken_image")});d.data(c,true)}else if(i)TS.warn("no");o=null;l=null;d=null})},logUnreads:function e(){var t=[];var i=TS.shared.getActiveModelOb();var n=i.unreads;if(!i)return;for(var a=0;a<n.length;a+=1)if(-1==TS.model.client.reads.indexOf(n[a]))t.push(n[a]);TS.info(t)},markMostRecentReadMsgInActive:function e(t,i){var n=TS.shared.getActiveModelOb();if(TS.has_pri[G]&&n.unread_cnt)TS.log(G,"TS.client.ui.markMostRecentReadMsgInActive, "+n.id+": reason = "+t+(i?", get_rid_of_line = "+i:""));var a=TS.shared.getControllerForModelOb(n);if(_.isFunction(a.markMostRecentReadMsg))a.markMostRecentReadMsg(n,t);if(i){if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.setGhostLastRead(null));else{if(TS.has_pri[G])TS.log(G,"markMostRecentReadMsgInActive, "+n.id+', reason = "'+t+'": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()');TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar(t)}TS.ui.pins.clearUnreadPinState(n)}if(n&&(n._temp_unread_cnt||n._temp_last_read)){if(TS.has_pri[H])TS.log(H,"markMostRecentReadMsgInActive: Nulling _temp_unread_cnt and _temp_last_read on "+n.id);n._temp_unread_cnt=null;n._temp_last_read=null}},isMsgInView:function e(t){var i=TS.shared.getActiveModelOb();if(i){var n=TS.utility.msgs.getMsg(t,i.msgs);if(n&&n._jl_rolled_up_in)t=n._jl_rolled_up_in}var a=TS.client.msg_pane.getCanonicalDivForMsg(t);if(!a.length)return false;if(a.hasClass("hidden"))return true;var r=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);return TS.client.ui.isElInView(a,5,r)},isUnreadDividerInView:function e(t){t=t||5;var i=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);return TS.client.ui.isElInView(TS.client.ui.$msgs_unread_divider,t,i)},isElInView:function e(t,i,n){if(!t||!t.length)return false;i=i||0;var a=t.dimensions_rect();if(a.height>n.height)return TS.utility.doesRectContainRect(a,n,i,true);else if(TS.utility.doesRectContainRect(n,a,i,true))return true;return false},scrollSoTopUnseenChannelIsInView:function e(t){if(TS.useReactSidebar())return;var i=I(TS.client.channel_pane.$scroller,$(t));if(i.length)i.first().scrollintoview({offset:"top",px_offset:50,scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null});else{var n=$("#starred_div");if(n.length&&n.length&&!n.hasClass("hidden"))$("#starred_section_header").scrollintoview({scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null});else $("#channels_header").scrollintoview({scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null})}},scrollSoBottomUnseenChannelIsInView:function e(t){if(TS.useReactSidebar())return;var i=I(TS.client.channel_pane.$scroller,$(t));if(i.length)i.last().scrollintoview({offset:"bottom",px_offset:-50,scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null});else TS.client.channel_pane.$scroller.children().last().scrollintoview({scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null})},onChannelsScroll:function e(){if(TS.useReactSidebar())return;TS.model.ui.cached_channels_scroller_rect=null;TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads();TS.client.channel_pane.checkScrolledAtAll()},checkUnseenChannelsImsGroupsWithUnreads:TS.utility.immediateDebounce(function(){if(TS.useReactSidebar())return;TS.client.ui.actuallyCheckUnseenChannelsImsGroupsWithUnreads()}),actuallyCheckUnseenChannelsImsGroupsWithUnreads:function e(){if(TS.useReactSidebar())return;TS.client.ui.getCachedDimensionsRect("cached_channels_scroller_rect",TS.client.channel_pane.$scroller);var t;var i;var n;var a=false;var r;r=TS.client.channel_pane.$scroller.find("li.unread:not(.muted_channel):not(.all_unreads)");r.each(function(){var e=$(this);if(!TS.client.ui.isElInView(e,10,TS.model.ui.cached_channels_scroller_rect)){var r;if(e.hasClass("all_threads"))r=e.closest("#channels_scroller").position().top+e.position().top;else r=e.closest(".section_holder").position().top+e.position().top;if(r<TS.model.ui.cached_channels_scroller_rect.top){t=true;if(e.hasClass("mention"))n=true}else{i=true;if(e.hasClass("mention"))a=true}}});var s=$("#channel_scroll_up");if(t){s.removeClass("hidden unseen_have_mentions");if(n)s.addClass("unseen_have_mentions").find("span").html(TS.i18n.t("unread mentions","client")());else s.find("span").html(TS.i18n.t("more unreads","client")())}else s.addClass("hidden").removeClass("unseen_have_mentions");var o=$("#channel_scroll_down");if(i){o.removeClass("hidden unseen_have_mentions");if(a)o.addClass("unseen_have_mentions").find("span").html(TS.i18n.t("unread mentions","client")());else o.find("span").html(TS.i18n.t("more unreads","client")())}else o.addClass("hidden").removeClass("unseen_have_mentions")},onMsgsScrollThrottled:function e(){TS.client.ui.msgs_scrolled_sig.dispatch();TS.client.ui.markScrollTop();if(TS.client.ui.$msgs_unread_divider&&TS.shared.getActiveModelOb().unread_cnt){var t=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);var i=z(TS.client.ui.$msgs_unread_divider,5,t);var n=$("#messages_unread_status");var a="within"===i;var r="below"===i;var s=a&&!(TS.boot_data.feature_scrollback_half_measures&&TS.shared.lastReadIsOlderThanCurrentHistory());n.toggleClass("unreads_below",r);n.toggleClass("quiet no_jump",s);n.off("click mouseenter mouseleave");if(a)n.click(function(e){e.preventDefault();if(TS.boot_data.feature_scrollback_half_measures&&TS.shared.lastReadIsOlderThanCurrentHistory())TS.client.ui.$msgs_scroller_div.animate({scrollTop:0},75);else TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.clicked)});else{n.click(function(e){e.preventDefault();if(TS.boot_data.feature_scrollback_half_measures&&TS.shared.lastReadIsOlderThanCurrentHistory())TS.client.ui.$msgs_scroller_div.animate({scrollTop:0},200);else TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()});TS.client.msg_pane.showNewMsgsBar();TS.client.msg_pane.startNewMsgsTimer()}}if(TS.model.ui.msgs_are_auto_scrolling)return;TS.client.msg_pane.checkUnreads()},onMsgsScroll:function e(){TS.utility.throttle.method(TS.client.ui.onMsgsScrollThrottled,"ts_ui_on_msgs_scroll",250)},markScrollTop:function e(){var t;if(TS.client.ui.areMsgsScrolledToBottom())t=-1;else t=TS.client.ui.$msgs_scroller_div[0].scrollTop;var i=false;var n=TS.shared.getActiveModelOb();var a=TS.shared.getControllerForModelOb(n);if(_.isFunction(a.markScrollTop))i=a.markScrollTop(n.id,t);if(0===t&&TS.shared.getActiveModelOb()&&TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id&&TS.model.cancelled_welcome_2_this_session){TS.model.cancelled_welcome_2_this_session=false;TS.view.adjustForWelcomeSlideShow();return}if(i)TS.client.ui.maybeLoadScrollBackHistory()},maybeLoadScrollBackHistory:function e(){if(TS.client.ui.active_highlight_count||TS.model.ui.is_mouse_down)return;TS.client.ui.doLoadScrollBackHistory()},doLoadScrollBackHistory:function e(t){var i=TS.shared.getActiveModelOb();var n=TS.shared.getControllerForModelOb(i);if(_.isFunction(n.maybeLoadScrollBackHistory))n.maybeLoadScrollBackHistory(i.id,t)},areMsgsScrolledToBottom:function e(t,i){var n=TS.model.archive_view_is_showing?TS.model.ui.cached_archive_scroll_result:TS.model.ui.cached_msgs_scroll_result;if(null!==n&&!i)return n;t=!isNaN(t)?t:50;var a=TS.model.archive_view_is_showing?TS.client.archives.$scroller:TS.client.ui.$msgs_scroller_div;var r=a[0];if(!r)return;var s=parseInt(a.css("height"),10)+r.scrollTop+t>=r.scrollHeight;if(TS.model.archive_view_is_showing)TS.model.ui.cached_archive_scroll_result=s;else TS.model.ui.cached_msgs_scroll_result=s;return s},instaScrollMsgsToBottom:function e(t){if(TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest){var i=TS.shared.getActiveModelOb();if(i&&i.unread_cnt&&TS.model.ui.msgs_are_auto_scrolling){if(TS.model.ui.is_window_focused){if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToBottom: exiting early because unread_cnt = "+i.unread_cnt+", and TS.model.ui.msgs_are_auto_scrolling = true");return}if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToBottom: allowing scroll despite msgs_are_auto_scrolling = true and unread_cnt = "+i.unread_cnt+", because window is blurred.")}}if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToBottom: and_check = "+t);var n=TS.client.ui.$msgs_scroller_div[0].scrollHeight;if(TS.boot_data.feature_initial_scroll_position&&!n){if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToBottom: stopping because scrollHeight is 0");return}TS.client.ui.instaScrollMsgsToPosition(n,t,true)},slowScrollMsgsToBottom:function e(){var t=TS.model.archive_view_is_showing;if(t)TS.client.archives.$scroller.animate({scrollTop:TS.client.archives.$scroller[0].scrollHeight},"500");else TS.client.ui.$msgs_scroller_div.animate({scrollTop:TS.client.ui.$msgs_scroller_div[0].scrollHeight},"500")},instaScrollMsgsToPosition:function e(t,i,n){if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToPosition: scroll_top = "+t+", and_check = "+i+", set_btm_result = "+n);TS.model.ui.msgs_are_auto_scrolling=true;if(TS.client.ui.$msgs_scroller_div.length)TS.client.ui.$msgs_scroller_div[0].scrollTop=t;var a=TS.shared.getActiveModelOb();setTimeout(function(){if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToPosition -> timeout(): scroll_top = "+t+", set_btm_result = "+n+"... resetting msgs_are_auto_scrolling.");TS.model.ui.msgs_are_auto_scrolling=false;if(null!==n){var e=TS.shared.getActiveModelOb();if(a.id!==e.id){if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToPosition -> timeout(): active model_ob changed from "+a.id+" to "+e.id);if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToPosition -> timeout(): NOT setting TS.client.ui.cached_msgs_scroll_result = "+n);return}if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToPosition -> timeout(): set TS.client.ui.cached_msgs_scroll_result = "+n+", previously "+TS.client.ui.cached_msgs_scroll_result);TS.client.ui.cached_msgs_scroll_result=n}},100);if(i){if(TS.has_pri[j])TS.log(j,"instaScrollMsgsToPosition: and_check, so checking unreads as well.");TS.client.msg_pane.checkUnreads()}},slowScrollMsgsToPosition:function e(t,i,n){var a=TS.model.archive_view_is_showing;i=i&&!a;var r;if(a){TS.client.archives.msgs_are_auto_scrolling=true;r=TS.client.archives.$scroller}else{TS.model.ui.msgs_are_auto_scrolling=true;r=TS.client.ui.$msgs_scroller_div}r.stop().animate({scrollTop:t},"500",function(){setTimeout(function(){if(a)TS.client.archives.msgs_are_auto_scrolling=false;else TS.model.ui.msgs_are_auto_scrolling=false},100);if(i)TS.client.msg_pane.checkUnreads();if(n)n()})},scrollMsgsSoMsgIsInView:function e(t,i,n,a,r){a=isNaN(a)?1e3:a;var s;var o=TS.model.archive_view_is_showing;if(o)s=TS.client.msg_pane.getDivForArchiveMsg(t);else s=TS.client.msg_pane.getCanonicalDivForMsg(t);if(!s.length){if(!r)TS.utility.rAF(function(){r=true;TS.client.ui.scrollMsgsSoMsgIsInView(t,i,n,a,r)});return}var l;if(i){l=s.prevAll().slice(0,20);l.css("opacity",0);s.next().scrollintoview({duration:0,offset:"top"})}var d=2500;if(!o&&n)TS.client.ui.active_highlight_count+=1;if(o)TS.client.archives.msgs_are_auto_scrolling=true;else TS.model.ui.msgs_are_auto_scrolling=true;TS.model.ui.scrolled_to_msg_ts=t;clearTimeout(B);B=setTimeout(function(){TS.model.ui.scrolled_to_msg_ts=null},1e4);s.scrollintoview({duration:a,offset:"center_vertical",complete:function e(){if(n){s.highlight(d,"msg_highlighter");if(!o)setTimeout(function(){TS.client.ui.active_highlight_count-=1},d)}setTimeout(function(){if(i&&l)l.transition({opacity:1},300)},100);if(o){TS.client.archives.msgs_are_auto_scrolling=false;TS.client.archives.onMsgsScroll()}else{TS.model.ui.msgs_are_auto_scrolling=false;TS.client.ui.onMsgsScroll()}}})},active_highlight_count:0,scrollMsgsSoFirstUnreadMsgIsInView:function e(t){var i=false;if(i){TS.info("scrollMsgsSoFirstUnreadMsgIsInView called");TS.info("TS.client.ui.$msgs_unread_divider="+TS.client.ui.$msgs_unread_divider)}if(!TS.client.ui.$msgs_unread_divider)return;if(i)TS.info("TS.client.ui.$msgs_unread_divider.length="+TS.client.ui.$msgs_unread_divider.length);var n=TS.client.ui.$msgs_unread_divider;TS.model.ui.msgs_are_auto_scrolling=true;n.scrollintoview({duration:200,offset:"top",px_offset:50,complete:function e(){setTimeout(function(){if(i)TS.info("scrollMsgsSoFirstUnreadMsgIsInView animation complete");TS.model.ui.msgs_are_auto_scrolling=false;TS.client.ui.onMsgsScroll();if(t)t()},1)}})},afterHistoryFetch:function e(t){var i;var n=false;if(TS.boot_data.feature_initial_scroll_position){if(TS.model.ui.last_top_msg)i=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts);if(TS.boot_data.feature_scrollback_half_measures&&i&&i.length){i=K(i);TS.ui.utility.preventElementFromScrolling(i,function(){TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(t?t.id:"unspecified"),n)},function(){var e=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts);if(!e.length)if(TS.utility.msgs.isMsgRolledUp(TS.model.ui.last_top_msg))e=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg._jl_rolled_up_in);e=K(e);return e});if(TS.model.prefs.start_scroll_at_oldest&&TS.client.ui.$msgs_unread_divider&&t.unread_cnt&&!TS.client.msg_pane.dont_check_unreads_til_switch&&TS.client.ui.isUserAttentionOnChat())TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()}else{TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(t?t.id:"unspecified"),n);TS.client.msg_pane.setInitialScrollPosition(-1)}}else if(TS.boot_data.feature_scrollback_half_measures&&t.scroll_top>0&&TS.model.ui.last_top_msg){i=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts);TS.ui.utility.preventElementFromScrolling(i,function(){TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(t?t.id:"unspecified"),n)},function(){return TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts)})}else TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(t?t.id:"unspecified"),n);var a=!!TS.boot_data.feature_initial_scroll_position;TS.view.resizeManually("TS.client.ui.afterHistoryFetch",a);if(TS.client.ui.record_content_visible_metric_after_fetching_model_ob==t.id){TS.metrics.mark("content_visible");TS.metrics.measure("client_content_visible_4","start_nav","content_visible");delete TS.client.ui.record_content_visible_metric_after_fetching_model_ob}if(0!==t.scroll_top)return;if(!TS.model.ui.last_top_msg)return;if(!TS.boot_data.feature_initial_scroll_position)TS.client.ui.scrollMsgsSoMsgIsInView(TS.model.ui.last_top_msg.ts,true);TS.model.ui.last_top_msg=null;setTimeout(function(){if(0===t.scroll_top){TS.info("TS.client.ui.afterHistoryFetch: we're still scrolled to the top, so we'll try to fetch more messages now");TS.client.ui.maybeLoadScrollBackHistory()}},1e3)},rebuildMemberListToggle:function e(){var t;var i;if(TS.model.active_channel_id||TS.model.active_group_id||TS.model.active_mpim_id){var n=TS.shared.getActiveModelOb();if(TS.channels.backfills.isBackfilling(n.id)){i=false;Q(i,t);return}var a=TS.membership.getMembershipCounts(n);if(a.promise)if(!l){l=true;a.promise.then(function(){if(TS.shared.getActiveModelOb().id!==n.id)return;i=true;var e=_.get(a,"counts.member_count");if(n.is_mpim&&TS.shared.isModelObShared(n)&&TS.teams.getTeamNameById(n.shared_team_ids[0])){L(i,e,n);return}Q(i,e)}).catch(function(e){var t=n.id;var i=1e4;TS.warn("Fetching membership counts for "+t+" failed; trying again in "+i+" ms");TS.logError(e);setTimeout(function(){var e=TS.shared.getActiveModelOb();if(!e)return;if(e.id!==t)return;TS.client.ui.rebuildMemberListToggle()},i)}).finally(function(){l=false})}i=_.has(a,"counts.member_count");t=_.get(a,"counts.member_count");if(n.is_mpim&&TS.shared.isModelObShared(n)&&TS.teams.getTeamNameById(n.shared_team_ids[0])){L(i,t,n);return}Q(i,t)}else $("#channel_members_toggle").addClass("hidden")},maybePromptForClosingGroup:function e(t){var i=TS.groups.getGroupById(t);if(i.unread_cnt){var n=TS.model.group_prefix+i.name;TS.generic_dialog.start({title:TS.i18n.t("You have unread messages","client")(),body:TS.i18n.t("You have unread messages in the {group_name} private channel. Are you sure you want to close it?","client")({group_name:n}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes","client")(),cancel_button_text:TS.i18n.t("No","client")(),onGo:function e(){TS.groups.markMostRecentReadMsg(i,TS.model.marked_reasons.closed);TS.client.markLastReadsWithAPI();TS.shared.closeArchivedChannel(i.id)}})}else TS.shared.closeArchivedChannel(i.id)},maybePromptForClosingIm:function e(t){var i=TS.ims.getImById(t);if(i.unread_cnt)TS.generic_dialog.start({title:TS.i18n.t("You have unread messages","client")(),body:TS.i18n.t("You have unread messages from {im_name}. Are you sure you want to close the DM?","client")({im_name:i.name}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes","client")(),cancel_button_text:TS.i18n.t("No","client")(),onGo:function e(){TS.ims.markMostRecentReadMsg(i,TS.model.marked_reasons.closed);TS.client.markLastReadsWithAPI();TS.ims.closeIm(i.id)}});else TS.ims.closeIm(i.id)},unread_checking_tim:0,channelOrImOrGroupDisplaySwitched:function e(){TS.client.msg_pane.dont_check_unreads_til_switch=false;TS.model.client.reads.length=0;TS.client.msg_pane.hideNewMsgsBar();TS.client.ui.startUnreadCheckingTimer();TS.client.ui.rebuildMemberListToggle();if(!TS.useReactMessages())TS.shared.maybeFetchHistoryAndThenCheckConsistency(TS.shared.getActiveModelOb());if(TS.apps.isAppSpaceEnabled())TS.client.ui.app_space.resetUI();if("files"===TS.model.ui_state.flex_name||"convo"===TS.model.ui_state.flex_name){if(!TS.model.ui_state.flex_extra)return;var t;if("files"===TS.model.ui_state.flex_name){var i=$("#back_from_file_preview");t=i.data("origin");if("channel_page"===t||"group_page"===t||"im_page"===t)TS.client.ui.files._rebuildBackFromFilePreview("")}else if("convo"===TS.model.ui_state.flex_name){t=TS.ui.replies.activeConvoOrigin();if("channel_page"===t||"group_page"===t||"im_page"===t){var n=false;TS.ui.replies.toggleBackButton(n)}}}},startUnreadCheckingTimer:function e(){if(TS.client.ui.unread_checking_tim)window.clearTimeout(TS.client.ui.unread_checking_tim);var t=0;var i=1e3;var n=i;if(TS.model.prefs&&TS.model.prefs.mark_msgs_read_immediately)n=t;TS.client.ui.unread_checking_tim=setTimeout(TS.client.msg_pane.checkUnreads,n)},isUserAttentionOnChat:function e(){if(!TS.model.ui.is_window_focused)return false;if(TS.model.dialog_is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.coachmark_is_showing)return false;if(TS.model.overlay_is_showing)return false;if(TS.ui.msg_tab_complete.isShowing())return false;if(TS.ui.fs_modal.is_showing)return false;if(TS.ui.react_emoji_menu.is_showing)return false;if("hidden"===document.visibilityState)return false;return true},previewMember:function e(t,i){return TS.client.ui._displayMember(t,i).then(function(e){TS.client.flexDisplaySwitched("team",e)},_.noop)},_displayMember:function e(t,i){return new Promise(function(e,n){var a=TS.members.getPotentiallyUnknownMemberById(t);if(!a)return void n(new Error("wtf: no member to display"));if(!TS.client.ui.flex._displayFlexTab("team"))return void n(new Error("wtf: failed to open team tab"));var r=function t(){P(a,i);if(TS.boot_data.feature_name_tagging_client||TS.boot_data.feature_shared_channels_client)e(a.id);else e(a.name)};if(a.profile&&a.profile.fields)TS.team.ensureTeamProfileFields().then(r);else r()})},showTeamList:function e(){var t=true;if(!TS.client.ui._displayTeamList(t))return;TS.client.flexDisplaySwitched("team")},_displayTeamList:function e(t){if(!TS.client.ui.flex._displayFlexTab("team"))return false;TS.model.previewed_member_name="";TS.model.previewed_member_id="";TS.model.previewed_user_group_id="";$("#user_group_preview_container").hideWithRememberedScrollTop();$("#member_preview_container").hideWithRememberedScrollTop();$("#team_list_container").unhideWithRememberedScrollTop();TS.view.resizeManually("TS.client.ui._displayTeamList");var i=TS.SearchableMemberList.get("team_directory");if(!i){var n=new TS.SearchableMemberList({$container:$("#team_list_container"),id:"team_directory",triggered_by_user_action:t});n.showInitial()}else i.maybeRerenderLongListView();return true},showGroupsList:function e(){if(!TS.client.ui._displayGroupsList())return;TS.client.flexDisplaySwitched("groups")},_displayGroupsList:function e(){if(!TS.client.ui.flex._displayFlexTab("groups"))return false;$("#user_groups_container").unhideWithRememberedScrollTop();return true},previewUserGroup:function e(t,i){if(!i)i="groups";if(!TS.client.ui._displayUserGroup(t,i))return;var n=TS.user_groups.getUserGroupsById(t);TS.client.flexDisplaySwitched("groups",n.id)},_displayUserGroup:function e(t,i){if(E)return;E=true;var n=TS.user_groups.getUserGroupsById(t);if(!n)return false;if(!TS.client.ui.flex._displayFlexTab("groups"))return false;if(TS.view.user_groups_members_list_lazyload){TS.view.user_groups_members_list_lazyload.detachEvents();TS.view.user_groups_members_list_lazyload=null}TS.model.previewed_user_group_id=n.id;TS.info("TS.model.previewed_user_group_id:"+TS.model.previewed_user_group_id);$("#user_groups_container").hideWithRememberedScrollTop();var a;var r;var s=function e(){$("#user_group_preview_container").unhideWithRememberedScrollTop();r=n.users;TS.members.ensureMembersArePresent(r).then(function(){var e=[];for(a=0;a<r.length;a+=1)e.push(TS.members.getMemberById(r[a]));e.sort(function(e,t){var i=e._real_name_lc||e._name_lc;var n=t._real_name_lc||t._name_lc;if(i>n)return 1;if(n>i)return-1;return 0});var t=n.prefs.channels;var s=[];for(a=0;a<t.length;a+=1)s.push(TS.channels.getChannelById(t[a]));var o=n.prefs.groups;var l=[];for(a=0;a<o.length;a+=1)l.push(TS.groups.getGroupById(o[a]));s=s.concat(l);var d=-1===n.date_delete;var c=TS.permissions.members.canEditUserGroups()||TS.permissions.members.canCreateAndDeleteUserGroups();var _=TS.templates.user_group_preview({user_group:n,members:e,channels:s,show_user_groups_edit:c,is_user_group_deleted:d});var u=$("#user_group_preview_scroller");u.html(_);TS.utility.makeSureAllLinksHaveTargets(u);$("#user_group_menu_toggle").on("click",function(e){TS.menu.startWithUserGroupMenu(e,n.id)});$("#edit_default_channels").on("click",function(){TS.ui.admin_user_groups.editInfo(n)});TS.ui.tabs.create($("#user_group_tabs"));if(TS.model.last_previewed_user_group_id!=TS.model.previewed_user_group_id)if(u.length)u[0].scrollTop=0;TS.model.last_previewed_user_group_id=n.id;var m=$("#user_group_members");m.bind("click.view",TS.view.onMemberListClick);m.on("click.toggle_list_item",".team_list_item",TS.members.view.onTeamDirectoryItemClick);TS.utility.makeSureAllLinksHaveTargets(m);if(!TS.environment.supports_custom_scrollbar)u.find(".user_group_member_list").monkeyScroll();TS.view.user_groups_members_list_lazyload=m.find(".lazy").lazyload({container:$(".user_group_member_list"),ignore_when_hidden_element:$("#user_group_members"),all_images_same_size:true});$(".user_group_member_list").trigger("resize-immediate");var f=$("#back_from_user_group_preview");b(i,f);TS.client.flex_pane.stopLocalTimeInterval();TS.view.resizeManually("TS.client.ui._displayUserGroup");E=false;return true})};if(void 0===n.users)TS.user_groups.getUserGroupMembers(t,function(e){if(e&&e.users){n=e;return s()}});else s();return true},getNextOpenChannelOrIMElements:function e(t){var i=false;var n=false;if(!t&&"hide_read_channels"===TS.model.prefs.sidebar_behavior)n=true;else if(!t&&"hide_read_channels_unless_starred"===TS.model.prefs.sidebar_behavior)i=true;var a="LI:not(.public_private_channel_list_separator):not(.hidden)";if(t)a="LI.unread:not(.hidden), LI.active";else if(i)a="LI.unread:not(.hidden), LI.active, LI.show_in_list_even_though_no_unreads:not(.hidden), UL#starred-list LI";else if(n)a="LI.unread:not(.hidden), LI.active, LI.show_in_list_even_though_no_unreads:not(.hidden)";var r=TS.client.channel_pane.$scroller.find(a);r=r.filter(":not(.all_unreads):not(.all_threads):not(.app_space)");if(!r.length)TS.error('no $lis found for "'+a+'"');return r},getNextOpenChannelOrIM:function e(t,i,n){var a=TS.client.ui.getNextOpenChannelOrIMElements(t);if(!a.length)return a;n=n||a.filter(".active");if(!n.length){TS.error("active li not found");return n}if(n.length>1){TS.error("too many active $lis found");return n}var r;if(i){r=a.eq(a.index(n)-1);if(!r.length)r=a.last()}else{r=a.eq(a.index(n)+1);if(!r.length)r=a.first()}return r},gotoNextOpenChannelOrIM:function e(t,i){var n;if(TS.client.activeChannelIsHidden()){var a=TS.client.ui.getNextOpenChannelOrIMElements(t);n=i?a.filter(":first"):a.filter(":last")}var r=TS.client.ui.getNextOpenChannelOrIM(t,i,n);if(!r||!r.length)return false;var s;if(r)s=TS.client.ui.getNextOpenChannelOrIM(t,i,r);function o(){if(!s||!s.length)return;var e=l(s);if(!e)return;var t=e.id;if(!t)return;var i=e.byIdMethod(t);if(!i||i._history_fetched_since_last_connect||i.history_is_being_fetched)return;TS.api.callFuncWhenApiQisEmpty(function(){if(TS.has_pri[H])TS.log(H,'pre-fetching history for next keyboard action "'+i.id+'"');TS.shared.maybeFetchHistory(i)})}function l(e){var t={};if(!e||!e.length)return t;var i;var n;var a;var r;var s;if(e.hasClass("all_unreads")){n="data-action";i="channel_name";s="unread_view"}else if(e.hasClass("channel")){n="channel-id";i="channel_name";s="channel";a=TS.channels.displayChannel;r=TS.channels.getChannelById}else if(e.hasClass("group")){n="group-id";i="group_name";s="group";a=TS.groups.displayGroup;r=TS.groups.getGroupById}else if(e.hasClass("member")){n="member-id";i="im_name";s="im";a=TS.ims.startImByMemberId;r=TS.ims.getImByMemberId}else if(e.hasClass("mpim")){n="mpim-id";i="mpim_name";s="mpim";a=TS.mpims.displayMpim;r=TS.mpims.getMpimById}else if(e.hasClass("all_threads")){n="data-action";i="channel_name";s="threads_view"}var o=e.find("."+i);if(!o||!o.length)return t;t={id:o.data(n),type:s,displayMethod:a,byIdMethod:r};return t}var d=l(r);if("unread_view"===d.type){TS.client.unread.showUnreadView();return}if("threads_view"===d.type){TS.client.threads.showThreadsView();return}if(!d.id||!d.type||!d.displayMethod){TS.warn("WTF no result from getDataFromListItem for $next_li?",r);return false}if(d.displayMethod==TS.ims.startImByMemberId)d.displayMethod(d.id);else d.displayMethod({id:d.id});o();return true},tryToJump:function e(t,i,n){var a=TS.shared.getModelObById(t);if(!a){TS.error("NO CHANNEL NO IM GROUP");return false}if(!i){TS.client.displayModelOb(a);return true}var r;if(TS.useReactMessages())r=TS.utility.msgs.findMsg(i,a.id);else r=TS.utility.msgs.getMsg(i,a.msgs);if(r&&TS.utility.msgs.isMsgReply(r)){TS.ui.replies.openConversation(a,r.thread_ts,r.ts);return true}if(!r&&n){TS.ui.replies.openConversation(a,n,i);return true}TS.view.displayMsgInModelOb(a,i);return true},sendChannelMsgThroughSlackBot:function e(t,i,n,a){var r=TS.channels.getChannelById(t);if(!r)return;var s=n.split(",");if(!s.length)return;var o=TS.utility.msgs.getMsg(i,r.msgs);if(!o){TS.client.ui.addEphemeralBotMsg({channel:r.id,text:TS.i18n.t("Darn, it looks like that message no longer exists.","client")(),slackbot_feels:"sad_surprise"});return}var l=TS.i18n.t("<p>Would you like to have slackbot send {names_text} your message?</p>","client")({names_text:F(s)});l+=TS.templates.builders.msgs.buildHTML({msg:o,model_ob:r,standalone:true});TS.generic_dialog.start({title:TS.i18n.t("Send message to users not in #{channel_name}","client")({channel_name:r.name}),body:l,go_button_text:TS.i18n.t("Yes, send it","client")(),onGo:function e(){for(var i=0;i<s.length;i+=1)TS.api.call("chat.sendMention",{channel:t,user:s[i],ts:o.ts});if(a)if("C"===t.charAt(0))TS.channels.removeMsg(t,TS.utility.msgs.getMsg(a,r.msgs));else if("G"===t.charAt(0))TS.groups.removeMsg(t,TS.utility.msgs.getMsg(a,r.msgs))}})},promptForGroupOrChannelInvite:function e(t,i,n){var a=TS.groups.getGroupById(t)||TS.channels.getChannelById(t);if(!a)return;var r=i.split(",");if(!r.length)return;if(a.is_private||a.is_group){TS.ui.invite.showInviteMembersPreSelected(t,r,n);return}TS.generic_dialog.start({title:TS.i18n.t("Invite new members to #{channel_name}","client")({channel_name:a.name}),body:TS.i18n.t("<p>Would you like to invite {names_text} to #{channel_name}?</p>","client")({names_text:F(r),channel_name:a.name}),go_button_text:TS.i18n.t("Yes, invite them","client")(),onGo:function e(){TS.api.call("channels.invite",{channel:t,users:i});if(n)TS.channels.removeMsg(t,TS.utility.msgs.getMsg(n,a.msgs))}})},addEphemeralBotMsg:function e(t){var i=t.channel||TS.shared.getActiveModelOb().id;var n=t.text;if(!n)return;var a;if(t.username)a={type:"message",subtype:"bot_message",icons:t.icons||null,is_ephemeral:true,username:t.username,ts:t.ts,text:n};else a={type:"message",user:"USLACKBOT",is_ephemeral:true,ts:t.ts,text:n};if(t.slackbot_feels)a.slackbot_feels=t.slackbot_feels;if(t.thread_ts)a.thread_ts=t.thread_ts;var r=h(i,a,t.ephemeral_type);TS.info(r)},addOrFlashEphemeralBotMsg:function e(t){var i=t.channel||TS.shared.getActiveModelOb().id;var n=t.ephemeral_type;var a=n?TS.utility.msgs.getEphemeralMsgsByCidAndType(i,n):null;if(t.thread_ts)a=_.filter(a,function(e){return e.thread_ts===t.thread_ts});if(a&&a.length){var r=TS.shared.getModelObById(i);var s=a[0];if(TS.utility.contenteditable.supportsTexty())s.text=TS.format.cleanInternalMsg(t.text);else s.text=t.text;if(TS.boot_data.feature_parsed_mrkdwn)TS.utility.msgs.clearCachedFormatting(s);if(r.is_im)TS.ims.message_changed_sig.dispatch(r,s);else if(r.is_mpim)TS.mpims.message_changed_sig.dispatch(r,s);else if(r.is_channel)TS.channels.message_changed_sig.dispatch(r,s);else if(r.is_group)TS.groups.message_changed_sig.dispatch(r,s)}else TS.client.ui.addEphemeralBotMsg(t)},maybeHandleReactionCmd:function e(t,i,n){if(!t)return false;var a=i.match(/:/g)&&i.match(/:/g).length;if(a<2)return false;var r=":[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?";if(TS.boot_data.feature_localization){if(TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)i=TS.emoji.maybeGetCanonicalEmojiString(i);r=_.get(TSF,"emoji_rx.r.source")||r}var s=new RegExp("^(\\+|-) {0,1}("+r+")\\s*$");var o=i.match(s);if(!o)return false;var l=o[1];var d=o[2];if("+"!==l&&"-"!==l)return false;var c=TS.rxns.getRxnKeyByMsgType(t);if(!c){TS.sounds.play("beep");return true}var u="+"===l;if(!v(t)||!TS.emoji.isValidName(d)||TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(c),d)==u){TS.sounds.play("beep");return true}TS.rxns.changeRxnsFromUserAction(c,d,u);if(n)n();return true},sendMsgFromUserFromSSB:function e(t,i,n){if(!t)return false;if(!i)return false;var a=false;var r=TS.shared.getModelObById(t);var s=r&&TS.utility.msgs.getMsg(n,r.msgs);if(s&&TS.client.ui.maybeHandleReactionCmd(s,i))return true;if(s&&!s.thread_ts)s=null;if(0==t.indexOf("C")&&TS.channels.getChannelById(t))a=TS.channels.sendMsg(t,i,s);else if(0==t.indexOf("G")&&TS.groups.getGroupById(t))a=TS.groups.sendMsg(t,i,s);else if(0==t.indexOf("G")&&TS.mpims.getMpimById(t))a=TS.mpims.sendMsg(t,i,s);else if(TS.ims.getImById(t))a=TS.ims.sendMsg(t,i,s);if(!a){TSSSB.warn("TSSSB.sendMsgFromUser failed, invalid c_id or possible permission failure");return false}return true},shouldIgnoreClick:function e(t){if(TS.isPartiallyBooted()){t.preventDefault();TS.incremental_boot.userDidInteractWithUI();return true}if(TS.onboarding.inOnboarding())return true;return false},maintainMessagePanePosition:function e(t){var i;var n;if(TS.model.archive_view_is_showing){if(TS.useReactMessages()){t();return}n=TS.client.archives.$scroller}else if(TS.model.unread_view_is_showing)n=TS.client.ui.unread.$scroller;else if(TS.model.threads_view_is_showing)n=TS.client.ui.threads.$scroller;else{if(TS.useReactMessages()){t();return}n=TS.client.ui.$msgs_scroller_div}i=n.find("ts-message");if(!TS.client.activeChannelIsHidden()&&TS.client.ui.areMsgsScrolledToBottom())t();else{var a=n.offset().top;var r=_.find(i.toArray(),function(e){var t=$(e).offset().top;return t-a>=0});TS.ui.utility.preventElementFromScrolling($(r),function(){t()})}}});var e;var t=false;var i=0;var n=false;var a={};var r=false;var s=0;var o=false;var l=false;var d=function e(t,i){TS.metrics.mark("_rebuildAllButMsgsForReal");i=i||{};var n=["channels","ims","starred","apps"].filter(function(e){return!i["channel_pane_"+e]});if(n.length)TS.client.channel_pane.rebuild.apply(void 0,n);TS.client.msg_pane.rebuildChannelMembersList();if(!i.channel_header){TS.client.msg_pane.displayTitle();TS.client.msg_pane.updateEndMarker()}if(!i.user_current_status)TS.view.members.updateUserCurrentStatus();if(t)TS.client.channel_pane.makeSureActiveChannelIsInView();if(TS.client.unread.isEnabled())TS.client.ui.unread.updateSidebarLink();TS.client.ui.threads.updateChannelPaneActiveState();TS.client.ui.did_rebuild_all_but_msgs_sig.dispatch();if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.measure("client_ui_rebuild_all_but_msgs","_rebuildAllButMsgsForReal")};var c=function e(t){if(TS.utility.enableFeatureForUser(10))TS.statsd.count("client_rebuild");var i=false;var n=null;var a="rebuildAll";TS.metrics.mark("client_ui_rebuild_all");TS.client.ui.rebuildAllButMsgs(t,n,i);TS.client.msg_pane.rebuildMsgsWithReason(a,i);TS.client.ui.did_rebuild_all_sig.dispatch();if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.measure("client_ui_rebuild_all","_rebuildAllButMsgsForReal")};var u=function e(t){if(t!==TS.model.active_cid)return;if(TS.client.ui.isUnreadDividerInView())TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.sent);if(TS.model.overlay_is_showing)TS.view.overlay.cancelFromSendingMessage();if(TS.model.showing_welcome_2){TS.model.cancelled_welcome_2_this_session=true;TS.view.unAdjustForWelcomeSlideShow();TS.client.ui.instaScrollMsgsToBottom(true)}};var m=function e(t){var i=$(t).closest(".member_details");if(i.hasClass("cropped_preview")){i.removeClass("cropped_preview");TS.model.ui_state.expand_member_images_in_flexpane=true}else{i.addClass("cropped_preview");TS.model.ui_state.expand_member_images_in_flexpane=false}TS.storage.storeUIState(TS.model.ui_state);TS.view.resizeManually("TS.client.ui._displayMember")};var f=function e(t){if(TS.model.prefs.seen_single_emoji_msg)return;if(!(TS.model.user.id===t.user))return;var i=TS.shared.getActiveModelOb();var n=t.text;if(!v(t))return;var a=n.match(/:/g)&&n.match(/:/g).length;if(a<2)return;var r=n.match(/^\s*(:[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?)\s*$/);if(!r)return;var s=TS.emoji.isValidName(r[1]);if(!s)return;var o=TS.rxns.getRxnKeyByMsgType(t);if(!o)return;if(TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(o),s))return;if(i.is_slackbot_im)return;var l=TS.model.is_mac?"cmd":"ctrl";TS.client.ui.addEphemeralBotMsg({channel:i.id,ts:TS.interop.datetime.makeTsStamp(),text:TS.i18n.t("Hey! Looks like you just posted an emoji response. Did you know you can also react to messages directly with emojis? Click *Add reaction ...* on any message to try it. You can also type `+:emoji_name:` or `{cmd_key}+shift+\\` to react without leaving the comfort of your keyboard. Enjoy! :sparkles:","client")({cmd_key:l}),thread_ts:t.thread_ts});TS.model.prefs.seen_single_emoji_msg=true;TS.prefs.setPrefByAPI({name:"seen_single_emoji_msg",value:true})};var h=function e(t,i,n){if(TS.utility.contenteditable.supportsTexty())i.text=TS.format.cleanInternalMsg(i.text);i.ts=i.ts||TS.interop.datetime.makeTsStamp();var a=TS.utility.msgs.processImsg(i,t);var r=TS.shared.getModelObById(t);var s=TS.shared.getControllerForModelOb(r);if(_.isFunction(s.addMsg))s.addMsg(t,a);var o={c_id:t,ephemeral_type:n};if(i.thread_ts)o.thread_ts=i.thread_ts;TS.utility.msgs.ephemeral_msgs_map[i.ts]=o;return i.ts};var g=function e(t){var i=TS.model.mac_ssb_version||TS.model.win_ssb_version&&TS.model.is_mac;var n=TS.model.win_ssb_version&&TS.model.is_win||TS.model.lin_ssb_version&&TS.model.is_lin;var a=TS.model.win_ssb_version&&TS.model.win_ssb_version>2||2===TS.model.win_ssb_version&&TS.model.win_ssb_version_minor>=4;var r=TS.model.lin_ssb_version&&TS.model.lin_ssb_version>2||2===TS.model.lin_ssb_version&&TS.model.lin_ssb_version_minor>=4;var s=TS.model.mac_ssb_version||a||r;var o=t.metaKey&&!t.shiftKey&&!t.altKey;var l=!t.metaKey&&!t.shiftKey&&t.altKey;var d=TS.utility.keymap;var c=t.which==d.left_square_bracket||t.which==d.right_square_bracket;var _=t.which==d.left||t.which==d.right;var u=o&&_;if(TS.boot_data.feature_prev_next_button)TS.client.nav_history.setDirection(t.which);if(i&&!s&&o&&c)p(t.which,d.left_square_bracket,d.right_square_bracket,u,t);else if(n&&!s&&l&&_)p(t.which,d.left,d.right,u,t);else if(o&&_)p(t.which,d.left,d.right,u,t);else if(o&&c)TS.clog.track("HISTORY_NAV_ACTION",{trigger:"keyboard_shortcut",action:"nav_prev_next"})};var p=function e(t,i,n,a,r){var s=TS.utility.contenteditable.isEmpty(document.activeElement);if(TS.utility.isFocusOnInput()&&(s||!a)||document.activeElement==document.body){TS.clog.track("HISTORY_NAV_ACTION",{trigger:"keyboard_shortcut",action:"nav_prev_next"});if(t===i)window.history.go(-1);else if(t===n)window.history.go(1);if(r)r.preventDefault()}};var S=function e(){TS.model.client.last_user_active_timestamp=new Date};var T=function e(t){if(t.id!=TS.model.active_cid)return;TS.client.msg_pane.displayTitle();TS.client.msg_pane.rebuildChannelMembersList()};var v=function e(t){return t&&!TS.utility.msgs.isTempMsg(t)&&!t.is_ephemeral};var b=function e(t,i){i.unbind();if("file_list"===t||"file_preview"===t)i.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Files","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("files")});else if("search_results"===t)i.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Search Results","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("search")});else if("im_page"===t)i.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Conversation Details","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")});else if("groups"===t)i.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("User Groups","client")()).bind("click.back",function(){TS.client.ui.showGroupsList()});else if(TS.boot_data.feature_teams_to_workspaces)i.html(TS.templates.builders.filePreviewBackIcon()+(TS.boot_data.page_needs_enterprise?TS.i18n.t("Organization Directory","client")():TS.i18n.t("Workspace Directory","client")())).bind("click.back",function(){TS.client.ui.showTeamList()});else i.html(TS.templates.builders.filePreviewBackIcon()+(TS.boot_data.page_needs_enterprise?TS.i18n.t("Organization Directory","client")():TS.i18n.t("Team Directory","client")())).bind("click.back",function(){TS.client.ui.showTeamList()})};var w=function e(t){M(t)};var y=function e(t){M(t)};var k=function e(t){M(t)};var A=function e(t){M(t)};var C=function e(t){M(t)};var M=function e(t){var i=$("."+TS.templates.makeSHRoomClass(t.id));if(!i.length)return;i.replaceWith(TS.templates.builders.buildSHRoomAttachment(t))};var I=function e(t,i){if(i.hasClass("unseen_have_mentions"))return t.find("li.mention");return t.find("li.unread:not(.all_unreads)")};var x=function e(){if("team"===TS.model.ui.active_tab_id&&TS.model.previewed_member_id)TS.client.ui._displayMember(TS.model.previewed_member_id)};var E;var B=null;var D=function e(){TS.shared.onDisplayEmailAddressesPrefChanged()};var F=function e(t){var i=t.map(function(e){return TS.members.getPrefCompliantMemberName(TS.members.getPotentiallyUnknownMemberById(e),true)});return TS.i18n.listify(i,{strong:true}).join("")};var P=function t(i,n){var a=$("#member_preview_container");var r=TS.model.previewed_member_id===i.id&&!a.find(".cropped_preview").length||"menu_member_header"===n||TS.model.ui_state.expand_member_images_in_flexpane;TS.model.previewed_member_name=i.name;TS.model.previewed_member_id=i.id;TS.info("TS.model.previewed_member_id:"+TS.model.previewed_member_id);var s;var o=i.is_bot&&TS.model.user.is_admin;var l;if(o){l="/services/"+i.profile.bot_id;l=TS.bots.configureUrl(i)}var d={member:i,show_bot_configuration:o,hide_more_menu:false,bot_configure_url:l,show_call_action:TS.utility.calls.isEnabled()&&!i.is_bot&&"USLACKBOT"!==i.id,team_name:TS.model.team.name,show_admin_info:i.is_admin&&i.team_id===TS.model.user.team_id,lazy_load_profile_fields:true,lazy_load_shared_teams:TS.boot_data.feature_lazy_grid_teams};e.clear();e.add(i.id);if(TS.boot_data.page_needs_enterprise){var c=TS.model.team;if(c&&c.id!==i.team_id)d.show_call_action=false;if(!i.is_self)if(TS.boot_data.feature_lazy_grid_teams){d.shared_teams=TS.teams.getSharedTeamsForMember(i);TS.teams.ensureSharedTeamsForMember(i).then(function(){U(i)})}else{var _=TS.enterprise.getTeamsForMember(i,true);d.teams=_}}s=TS.templates.team_member_preview(d);$("#user_group_preview_container").hideWithRememberedScrollTop();$("#team_list_container").hideWithRememberedScrollTop();a.unhideWithRememberedScrollTop();var u=$("#member_preview_scroller");u.html(s);TS.utility.makeSureAllLinksHaveTargets(u);if(i.deleted)$("#member_deleted_view_archives_btn").removeClass("hidden");if(TS.model.last_previewed_member_id!=TS.model.previewed_member_id){var f=$("#member_preview_scroller");if(f.length)f.get(0).scrollTop=0}TS.model.last_previewed_member_id=i.id;var h=$("#back_from_member_preview");b(n,h);TS.view.resizeManually("TS.client.ui._displayMember");u.find(".member_details .member_image").click(function(){m(this);TS.clog.track("USER_PROFILE_CLICK");return false});u.find(".member_preview_menu_target").click(function(e){TS.menu.member.startWithMemberPreview(e,i.id,false,true)});if(r)m(a.find(".member_image"));if(i.is_self)TS.client.ui.flex.registerCurrentStatusInput();TS.members.fetchMemberObjectsForUserProfileFields(i).then(function(){if(i.is_external&&!i.is_stranger)return TS.members.fetchMemberProfileExtras(i.id);return Promise.resolve()}).then(function(e){var t=e&&e.shared_channels;O(i,t)})};var O=function e(t,i){if(TS.model.previewed_member_id===t.id){var n=TS.team.getVisibleTeamProfileFieldsForMember(t);$("#member_data_table_team_fields").html(TS.templates.team_profile_fields({fields:n}));if(t.is_restricted)$("#member_data_table_guest_fields").html(TS.templates.guest_profile_fields({member:t}));if(t.is_external&&!t.is_stranger)$("#member_data_table_shared_channels").html(TS.templates.shared_channels_profile_field({shared_channels:i}))}};var R=function e(t){return{shared_teams:TS.teams.getSharedTeamsForMember(t)}};var U=function e(t){if(TS.model.previewed_member_id!==t.id)return;$("#member_data_table_shared_teams").html(TS.templates.member_shared_teams(R(t)))};var Q=function e(t,i){var n="–";var a=t?TS.i18n.number(i,"client"):n;$("#channel_members_toggle_count_count").text(a);$("#channel_members_toggle_count").removeClass("hidden")};var L=function e(t,i,n){i=t?TS.i18n.number(i,"client"):"–";var a=_(n.members).map(TS.members.getMemberById).compact().filter(TS.utility.teams.isMemberExternal).value().length;var r=TS.teams.getTeamNameById(n.shared_team_ids[0]);var s=i+" ("+TS.i18n.number(a,"client")+TS.i18n.t(" from ","client")()+r+")";$("#channel_members_toggle_count_count").text(s);$("#channel_members_toggle_count").removeClass("hidden")};var H=58;var N=82;var G=142;var j=888;var W=function e(){var t=$("#presence");if(1==t.css("opacity"))t.css("opacity",.98);else t.css("opacity",1)};var K=function e(t){if(!t||!t.length||!t.is("ts-message"))return t;var i=t.find(".comment");if(i.length)return i;var n=t.find(".message_body");if(n.length)return n;return t};var z=function e(t,i,n){if(!t||!t.length||!n)return null;i=i||0;var a=t.dimensions_rect();if(n.top>a.top-i)return"above";if(n.bottom<a.bottom+i)return"below";return"within"};var V=function e(){if(!TS.boot_data.feature_keyboard_navigation)return;var t=$('<div tabindex="0"></div>');$("body").prepend(t);t.on("focus",TS.view.focusMessageInput);t.on("blur",function(){t.remove()})};var Y=function e(){if(!TS.isSocketManagerEnabled())return;var t=3e5;var i=void 0;TS.interop.SocketManager.disconnectedSig.add(function(){i=Date.now()});TS.interop.SocketManager.connectedSig.add(function(e){if(e)return;if(i){var n=Date.now()-i;if(n<t)return}TS.client.ui.maybePromptForSetActive()})}})()},4362:function(e,t){(function(){"use strict";TS.registerModule("client.ui.files",{$file_btn:null,onStart:function e(){TS.files.team_file_comment_added_sig.add(TS.client.ui.files.teamFileCommentAdded);TS.files.team_file_comment_edited_sig.add(TS.client.ui.files.teamFileCommentEdited);TS.files.team_file_comment_deleted_sig.add(TS.client.ui.files.teamFileCommentDeleted);TS.files.team_file_changed_sig.add(TS.client.ui.files.teamFileChanged);TS.files.team_file_deleted_sig.add(TS.client.ui.files.teamFileDeleted);TS.view.members.unknown_resolution_rebuild_sig.add(TS.client.ui.files.memberChanged);function t(){TS.client.ui.files.bindUploadUI();TS.client.ui.files.bindFileUI();if(TS.useReactMessages())TS.files.media.bindVideoElements({container:".p-history_container",onError:g});else TS.files.media.bindVideoElements({container:"#msgs_div",onError:g})}if(TS.has_pri[82])TS.log(82,"deferring UI bind until login_sig");TS.client.login_sig.add(t)},preview_file_waiting_on:null,showFilesFromHistory:function e(t){if(!t){TS.client.ui.files._displayFileList();TS.client.flexDisplaySwitched("files",null,false,true);return}var i=TS.files.getFileById(t);if(i){TS.client.ui.files._displayFile(i.id);TS.client.flexDisplaySwitched("files",i.id,false,true);TS.files.fetchFileInfo(t)}else{TS.client.ui.files.preview_file_waiting_on=t;TS.files.fetchFileInfo(t,function(e,t){if(e!=TS.client.ui.files.preview_file_waiting_on)return;TS.client.ui.files.preview_file_waiting_on=null;if(t){TS.client.ui.files._displayFile(t.id);TS.client.flexDisplaySwitched("files",t.id,false,true)}else{TS.client.ui.files._displayFileList();TS.client.flexDisplaySwitched("files",null,true)}})}},_displayFile:function i(r,s,o){var l=TS.files.getFileById(r);if(!l)return false;if(!TS.client.ui.flex._displayFlexTab("files"))return false;if(TS.boot_data.feature_file_threads){e=s;t=o}else TS.client.ui.files._rebuildBackFromFilePreview(s);TS.model.previewed_file_id=r;TS.view.files.hideList();$("#file_list_container").hideWithRememberedScrollTop();if(TS.boot_data.feature_share_mention_comment_cleanup)if(o)a(l,o);else n(l);else{$("#file_preview_container").unhideWithRememberedScrollTop();TS.client.ui.files.rebuildFilePreview(l);$("#file_preview_scroller").scrollTop(0)}$("#file_comment_form").css("visibility","");TS.view.resizeManually("TS.client.ui.files._displayFileList");return true},_displayFileList:function e(){if(!TS.client.ui.flex._displayFlexTab("files",true))return false;TS.model.previewed_file_id="";$("#file_preview_container").hideWithRememberedScrollTop();$("#file_list_container").unhideWithRememberedScrollTop();TS.view.files.unHideList();TS.view.resizeManually("TS.client.ui.files._displayFileList");return true},rebuildFilePreview:function i(n){var a;if(n.user&&"USLACKBOT"===n.user&&n.bot_id){a=TS.bots.getBotById(n.bot_id);a.is_bot=true;a.is_service=true}else a=TS.members.getPotentiallyUnknownMemberById(n.user);var s=TS.files.getFileActions(n);s.file=n;s.member=a;s.user=TS.model.user;s.show_open_public_link=!TS.model.team.prefs.disallow_public_file_urls;s.show_revoke_public_link=!TS.model.team.prefs.disallow_public_file_urls&&s.revoke_public_link;if(TS.boot_data.feature_file_threads){var o=h(n,e,t);var d=TS.shared.getModelObById(o);s.model_ob=d}if("email"===n.mode){s.to_more_count=n.to.length-1;s.cc_more_count=n.cc.length-1}if(n&&n.id)if("snippet"===n.mode||"post"===n.mode||"space"===n.mode)if(!n.content&&!n.content_html&&!n.content_highlight_html)TS.files.fetchFileInfo(n.id);$.extend(s,TS.files.getFileTemplateArguments(n));var c=$("#file_preview_scroller").find("#file_preview_head_section");if(s.video_height)s.video_height=TS.model.native_video_embed_height_flexpane;var _=TS.templates.file_preview_title(s);var u=TS.templates.file_preview_file(s);var m=TS.templates.file_preview_meta(s);var g=false;if(TS.files.fileIsHostedSupportedMedia(n)&&n.id===TS.model.previewed_file_id){var p;if(TS.files.fileIsSupportedAudio(n))p=c.find("audio");else if(TS.files.fileIsSupportedVideo(n))p=c.find("video");if(p.length){var S=p[0];var T=!S.paused;var v=0===S.currentTime;var b=S.currentTime===S.duration;if(T||!v&&!b)g=true}}if(g){c.find(".file_preview_title").replaceWith(_);c.find(".file_preview_meta").replaceWith(m)}else{var w=_+u+m;c.html(w)}TS.utility.makeSureAllLinksHaveTargets(c);if(TS.files.fileIsImage(n))c.find(".image_container .image_bg img").error(function(){$(this).closest(".image_body").addClass("broken_image")});else if(TS.files.fileIsSupportedVideo(n))TS.files.media.bindVideoElements({container:c,onError:function e(t){t.addClass("hidden")}});else if("space"===n.mode)TS.utility.attachments.unfurlPlaceholders(c);s={file:n};var y=$("#file_preview_scroller").find("#file_preview_comments_section");y.html(TS.templates.comments(s));TS.utility.makeSureAllLinksHaveTargets(y);if(TS.boot_data.feature_file_threads){l(n.id);f(n)}else if(n.id!=TS.model.last_previewed_file_id){var k=TS.storage.fetchLastCommentInput(n.id);if(k)TS.utility.contenteditable.value($("#file_comment_form #file_comment"),k);else TS.utility.contenteditable.clear($("#file_comment_form #file_comment"));TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment"));if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())$("#file_comment_form #file_comment").trigger("keyup")}if("email"===n.mode);TS.model.last_previewed_file_id=n.id;if(n.content&&"snippet"===n.mode){$("#truncated_message").addClass("hidden");var A=!!TS.model.code_wrap_long_lines;var C=$("#snippet_wrap");var M=$('#flex_contents .snippet_container[data-file-id="'+n.id+'"]');C.bind("change",function(){TS.model.code_wrap_long_lines=$(this).prop("checked");if(TS.model.code_wrap_long_lines)M.addClass("snippet_wrap");else M.removeClass("snippet_wrap")});if(A){C.prop("checked","checked");M.addClass("snippet_wrap")}}TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"));if(!TS.boot_data.feature_file_threads)r(n);if(TS.utility.contenteditable.hasFocus($("#file_comment"))||TS.utility.contenteditable.isActiveElement($("#file_comment")))$("#file_comment_submit_btn").scrollintoview({offset:"bottom",px_offset:-50,duration:0})},cleanFilePreview:function i(){$("#file_preview_head_section").empty();$("#file_preview_comments_section").empty();if(TS.boot_data.feature_file_threads){e=null;t=null}},_rebuildBackFromFilePreview:function e(t){var i=$("#back_from_file_preview");i.unbind();var n;if("member_preview"===t){n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Member","files")():TS.i18n.t("Team Member","files")();i.html(TS.templates.builders.filePreviewBackIcon()+" "+n);i.bind("click.back",function(){TS.client.ui.previewMember(TS.model.last_previewed_member_id)})}else if("starred_items"===t){n=TS.i18n.t("Starred Items","files")();i.html(TS.templates.builders.filePreviewBackIcon()+" "+n);i.bind("click.back",function(){TS.client.ui.flex.openFlexTab("stars")})}else if("search_results"===t){n=TS.i18n.t("Search Results","files")();i.html(TS.templates.builders.filePreviewBackIcon()+" "+n);i.bind("click.back",function(){TS.search.view.showResults();TS.search.view.maybeRebuildResults()})}else if("channel_page"===t){n=TS.i18n.t("Channel Details","files")();i.html(TS.templates.builders.filePreviewBackIcon()+" "+n);i.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")});i.data("origin",t)}else if("group_page"===t){n=TS.i18n.t("Channel Info","files")();i.html(TS.templates.builders.filePreviewBackIcon()+" "+n);i.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")})}else if("im_page"===t){n=TS.i18n.t("Conversation Details","files")();i.html(TS.templates.builders.filePreviewBackIcon()+" "+n);i.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")})}else{n=TS.i18n.t("Files","files")();i.html(TS.templates.builders.filePreviewBackIcon()+" "+n);i.bind("click.back",function(){TS.client.ui.files.showFileList();TS.client.flex_pane.maybeFetchFileList()})}i.data("origin",t)},previewFile:function e(t,i,n,a,r){var s=TS.files.getFileById(t);if(TS.model.ui_state.flex_visible&&TS.model.previewed_file_id===t&&!$("#file_preview_scroller").is(":hidden"))$("#file_preview_scroller").highlight(1500,"flex_highlight",false,0);if(!s){TS.client.ui.files.preview_file_waiting_on=t;TS.files.fetchFileInfo(t,function(e,t){if(e!=TS.client.ui.files.preview_file_waiting_on)return;TS.client.ui.files.preview_file_waiting_on=null;if(t)TS.client.ui.files.previewFile(t.id,i,true,r);else TS.generic_dialog.alert(TS.i18n.t("This file can’t be found.","files")(),TS.i18n.t("Sorry, that didn’t work","files")())});return}if(!TS.client.ui.files._displayFile(t,i,r))return;TS.client.flexDisplaySwitched("files",t);if(a)TS.utility.contenteditable.focus($("#file_comment"));if(!n)TS.files.fetchFileInfo(t)},teamFileCommentAdded:function e(t,n){if(i(t))TS.client.ui.files.appendFileComment(t,n);if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(t)},teamFileCommentEdited:function e(t,n){if(i(t))TS.client.ui.files.updateFileComment(t,n);if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(t)},teamFileCommentDeleted:function e(t,n){if(i(t))TS.ui.comments.removeFileComment(t,n,function(){if(TS.boot_data.feature_file_threads)f(t);TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"))});if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(t)},teamFileChanged:function e(t){if("files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==t.id)TS.client.ui.files.rebuildFilePreview(t);if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(t)},teamFileDeleted:function e(t){if("files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==t.id)TS.client.ui.files.showFileList();if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.resetFileCommentsGroup(t)},memberChanged:function e(t){var n=TS.files.getFileById(TS.model.previewed_file_id);if(!n||!i(n)||!t.id)return;_(n.comments).filter({user:t.id}).map(_.partial(TS.client.ui.files.updateFileComment,n)).value()},storeLastCommentInputForPreviewedFile:function e(t){if(!TS.model.previewed_file_id)return;TS.storage.storeLastCommentInput(TS.model.previewed_file_id,t)},bindFileUI:function e(){$("#file_list_heading").bind("click.show_menu",function(e){e.preventDefault();TS.menu.file.startWithFileFilter(e)});$("#file_list_clear_filter").bind("click.clear_filter",function(e){e.stopPropagation();TS.view.files.clearFilter()});$("#file_list_toggle_all").bind("click.toggleList",function(){TS.client.ui.files.toggleFileList("all")});$("#file_list_toggle_user").bind("click.toggleList",function(e){if(e.isDefaultPrevented())return;var t=$("#file_list").data("filter-user");if(t)TS.client.ui.files.toggleFileList(t);else TS.client.ui.files.toggleFileList(TS.model.user.id)});$("#file_list_toggle_users").bind("click.show_menu",function(e){e.preventDefault();TS.menu.file.startWithFileMemberPromiseFilter(e)})},showFileList:function e(){if(!TS.client.ui.files._displayFileList())return;$("#search_tabs").hide();TS.client.flexDisplaySwitched("files")},filterFileList:function e(t){if("all"===t){TS.model.active_file_list_filter=t;TS.view.files.clearFilter()}else if("user"===t){TS.view.files.clearFilter();TS.client.ui.files.toggleFileList(TS.model.user.id)}else if(TS.interop.utility.looksLikeMemberId(t))TS.client.ui.files.toggleFileList(t);else{TS.model.active_file_list_filter=t;TS.view.file_list_heading=TS.model.file_list_type_map[t];TS.model.file_list_types=[t];TS.view.files.filterSet();$("#file_list_clear_filter").removeClass("hidden")}},toggleFileList:function e(t){var i=$("#file_list");var n=$("#file_list_toggle_all");var a=$("#file_list_toggle_user");var r=$("#file_list_toggle_users");var s=TS.i18n.t("Just You","files")();if(i.data("list")==t)return;i.data("list",t);if("all"===t){TS.model.active_file_list_member_filter="all";a.removeClass("active").find("a").text(s);r.removeClass("active");n.addClass("active");i.data("filter-user",TS.model.user.id)}else{var o=TS.members.getMemberById(t);if(o){TS.model.active_file_list_member_filter=t;n.removeClass("active");a.addClass("active");r.addClass("active");if(o.id==TS.model.user.id)a.find("a").text(s);else a.find("a").text(TS.members.getPrefCompliantMemberName(o));i.data("filter-user",t)}else TS.error(t+" is not valid?")}TS.view.files.filterSet()},submitFileComment:function e(t){var i=$("#file_comment_form #file_comment");var n=TS.utility.contenteditable.value(i);var a=TS.format.cleanMsg(n);if(!$.trim(a)){TS.sounds.play("beep");return}var r=TS.model.previewed_file_id;var s=i.closest("[data-model-ob-id]").attr("data-model-ob-id");if(TS.ui.fs_modal_file_viewer.is_showing)r=TS.ui.fs_modal_file_viewer.getCurrentFileId();var o=TS.files.getFileById(r);if(!o){TS.error("no file to submit comment");return}var l=TS.ui.needToBlockAtChannelKeyword(n,o);if(l){TS.generic_dialog.alert(TS.i18n.t("<p>A Team Owner has restricted the use of <strong>{keyword}</strong> messages.</p>","files")({keyword:_.escape(l)}));return}if(!t){var d=o.channels.concat(o.groups);var c=d.filter(function(e){return TS.ui.needToShowAtChannelWarning(e,n)});if(c.length>0){TS.ui.at_channel_warning_dialog.startInFlexPane(o,c,n);return}}TS.utility.contenteditable.clear($("#file_comment_form #file_comment"));TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment"));if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())$("#file_comment_form #file_comment").trigger("keyup");if(TS.ui.fs_modal_file_viewer.is_showing&&$("#file_comment").closest("#fs_modal").length)TS.clog.track("FILE_FULLSCREEN_COMMENT_ADD",{});TS.files.addComment(r,a,s,function(e,t,i){if(e)TS.storage.storeLastCommentInput(i.file,"");else{alert("error: comment not added to file");if(i.file==TS.model.last_previewed_file_id){TS.utility.contenteditable.value($("#file_comment_form #file_comment"),TS.storage.fetchLastCommentInput(i.file));if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())$("#file_comment_form #file_comment").trigger("keyup")}}})},rebuildFilePreviewAndCommentsIncludingMember:function e(t){var i={member:t,for_message:true};$("#col_flex .message_current_status.color_"+t.id).replaceWith(TS.templates.current_status(i))},appendFileComment:function e(t,i){var n=$(".file_comments_"+t.id);var a=TS.members.getPotentiallyUnknownMemberById(i.user);n.append(TS.templates.builders.buildCommentHTML({file:t,comment:i,show_comment_actions:true,member:a}));TS.utility.makeSureAllLinksHaveTargets(n);if(i.user==TS.model.user.id){var r;if(TS.boot_data.feature_file_threads)r=$("#file_reply_container");else r=$("#file_comment_submit_btn");r.scrollintoview({offset:"bottom",px_offset:-50,duration:0})}if(TS.boot_data.feature_file_threads)f(t);var s;if(TS.boot_data.feature_share_mention_comment_cleanup)s=$(".file_comments_scroller");else s=$("#file_preview_scroller");TS.ui.utility.updateClosestMonkeyScroller(s)},updateFileComment:function e(t,i){var n=TS.members.getPotentiallyUnknownMemberById(i.user);var a=$('.comment[data-comment-id="'+i.id+'"]');if(!a.length)return;a.replaceWith(TS.templates.builders.buildCommentHTML({file:t,comment:i,show_comment_actions:true,member:n}));a.each(function(){TS.utility.makeSureAllLinksHaveTargets($(this))});TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"))},validateFiles:function e(t,i,n){if(!t)return;i=!!i;var a=[];var r=0;var s=0;var o=false;var l=false;var d={};var c=[];function u(e){s=Math.max(0,s+e)}function m(){a=[];s=0;r=0;o=false;l=false}if(!TS.client.ui.resetFiles)TS.client.ui.resetFiles=m;function f(){if(!o)if(a.length){o=true;TS.client.ui.file_dropped_sig.dispatch(a,i)}}function h(){if(l)return false;if(r>0&&(a.length>=s||s<=0)){l=true;if(c.length)v(t,function(){if(n)n(a,f);else f()});else if(n)n(a,f);else f()}}function g(e){a.push(e)}function p(e){e.onerror=null;e.onload=null;return null}function S(e,t){var i;var n;n={isFile:null,isDirectory:null};if(e.size<16384&&window.FileReader){i=new FileReader;i.onload=function(e){i=p(e.currentTarget);n.isFile=true;t(n)};i.onerror=function(e){i=p(e.currentTarget);n.isDirectory=true;t(n)};try{i.readAsDataURL(e)}catch(e){i=p(i);n.isDirectory=true;t(n)}}else t(n)}function T(e,t,i){var n;var a;var r;var s;var o;a=false;o=e.name||t.name;if(!o)return false;r=o.lastIndexOf(".");if(-1!==r)s=o.substr(r);if(s)n=d[s]&&d[s].enabled?d[s]:null;if(t&&(t.isFile||t.isDirectory)){if(t.isDirectory||t.isFile&&n&&n.applyToFile){a=true;return i(a)}a=false;return i(a)}S(e,function(e){if(e.isDirectory)a=true;else if(n&&n.applyToFile)a=true;return i(a)})}function v(e,t){var i;var n;var a;var s;var o;var l;var d;var u;var m;if(c.length){a=[];d="";m="";for(i=0,n=c.length;i<n;i+=1)a.push("<li><strong>"+_.escape(c[i].name)+"</strong></li>");if(c.length>1){o=c.length===r?TS.i18n.t("All files unsupported","files")():TS.i18n.t("Some files unsupported","files")();d="<ul>"+a.join("\n")+"</ul>"}else if(1===c.length)o=TS.i18n.t("File unsupported","files")();s=r-c.length;if(c.length>1)u=TS.i18n.t("<p>Try uploading a .zip version of these files instead.","files")();else if(1===c.length)u=TS.i18n.t("<p>Try uploading a .zip version of this file instead.","files")();if(s>1)m=TS.i18n.t("<p>(Don’t worry, your other files are next.)</p>","files")();else if(1===s)m=TS.i18n.t("<p>(Don’t worry, your other file is next.)</p>","files")();if(1===c.length)l=TS.i18n.t("<p>Sorry, <strong>{excluded_file}</strong> is a type of file not supported by Slack</p>","files")({excluded_file:_.escape(c[0].name)});else if(c.length===r)l=TS.i18n.t("<p>Sorry, none of those file types are supported by Slack.</p>","files")();else l=TS.i18n.t("<p>Sorry, some of those file types are not supported by Slack.</p>","files")();TS.generic_dialog.start({title:o,body:l+d+u+m,show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();if(t)t()}})}return c.length}function b(e){r=e.length;u(e.length);var t;var i;var n;var a;for(var s=0;s<e.length;s+=1){t=e[s];n=t;a=t;if(t.isFile||t.isDirectory){i=t;a=t}if(t.getAsEntry){i=t.getAsEntry();a=i}else if(t.webkitGetAsEntry){i=t.webkitGetAsEntry();a=i}if("function"===typeof t.getAsFile)n=t.getAsFile();else if(File&&t instanceof File)n=t;if(!a||!n)u(-1);(function(e,t){T(e,t,function(i){if(i){if(t.name)c.push(t);else c.push(e);u(-1);h()}else{if(0===e.size)u(-1);else g(e);h()}})})(n,a)}}b(t);h()},bindUploadUI:function e(){if(!TS.client.ui.files.$upload)TS.client.ui.files.$upload=$("#file_upload");$(".file_upload_btn").bind("click.file_menu",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.menu.file.startWithNewFileOptions(e,$(this));return false});TS.client.ui.files.$upload.bind("change",function(){if(window.desktop&&desktop.app&&desktop.app.focusWebView)desktop.app.focusWebView();if(!$(this).val())return;var e=$(this)[0].files;if(e){if(!e.length)return;TS.view.filesSelected(e);TS.client.ui.files.$upload.val("")}});$("body").bind("drop",function(e){var t;var i;window.focus();e.preventDefault();$("body").removeClass("drop-target");if(TS.boot_data.feature_take_profile_photo)if($("body").find("#edit_member_profile_container").length>0){i=e.originalEvent.dataTransfer;if(i)t=i.files||i.items;if(!t)return;TS.ui.edit_member_profile.handleDrop(t);return}if(TS.client.ui.checkForEditing(e))return;if("disable_all"===TS.model.team.prefs.disable_file_uploads){TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("At the request of your administrator, file uploads have been disabled on this workspace.","files")():TS.i18n.t("At the request of your administrator, file uploads have been disabled on this team.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});return}var n=e&&e.shiftKey;var a=TS.shared.getActiveModelOb();if(a&&a.is_general&&!TS.members.canUserPostInGeneral()){TS.generic_dialog.start({title:TS.i18n.t("Can’t share in #{channel_name}","files")({channel_name:a.name}),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("To keep things tidy, your Workspace Owners have set limits on sharing files and sending messages in #<strong>{channel_name}</strong>.","files")({channel_name:a.name}):TS.i18n.t("To keep things tidy, your Team Owners have set limits on sharing files and sending messages in #<strong>{channel_name}</strong>.","files")({channel_name:a.name}),show_cancel_button:false,go_button_text:TS.i18n.t("OK","files")()});return false}if(a&&TS.shared.isModelObOrgShared(a)&&!TS.permissions.members.canPostInChannel(a)){TS.generic_dialog.start({title:TS.i18n.t('Cannot Post To #{channel_name}<ts-icon class="ts_icon_org_shared_channel"></ts-icon>',"files")({channel_name:a.name}),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('An Owner of your workspace has limited who can post to <strong>#{channel_name}<ts-icon class="ts_icon_shared_channel"></ts-icon></strong>. Nothing personal! You can share your file in another channel.',"files")({channel_name:a.name}):TS.i18n.t('An Owner of your team has limited who can post to <strong>#{channel_name}<ts-icon class="ts_icon_shared_channel"></ts-icon></strong>. Nothing personal! You can share your file in another channel.',"files")({channel_name:a.name}),show_cancel_button:false,go_button_text:TS.i18n.t("Okay!","files")()});return false}if(TS.model.archive_view_is_showing&&TS.client.archives.getCurrentModelOb().is_archived)n=false;i=e.originalEvent.dataTransfer;if(i)t=i.files||i.items;if(!t)return;TS.client.ui.files.validateFiles(t,n)});$("#drop-zone").unbind("click.dismiss").bind("click.dismiss",function(){$("body").removeClass("drop-target")});$(window).draghover().on({draghoverstart:function e(t,i,n){if(window.winssb)TS.info("draghoverstart winssb_file:"+n);if(TS.model.ui.is_mouse_down)return;var a=false;if(i&&i.originalEvent&&i.originalEvent.dataTransfer&&i.originalEvent.dataTransfer.types){var r=i.originalEvent.dataTransfer.types;for(var s=0;s<r.length;s+=1)if("files"===r[s].toLowerCase()){a=true;break}}if(!a)a=!!n;if(!a)return;if(TS.boot_data.feature_take_profile_photo)if($("body").find("#edit_member_profile_container").length>0){$("body").addClass("drop-target");TS.ui.edit_member_profile.handleDrag(true);return}if($("body").hasClass("file_snippet"))return;if("disable_all"===TS.model.team.prefs.disable_file_uploads)return;if(TS.msg_edit.editing)return false;var o=TS.shared.getActiveModelOb();if(o&&TS.channels.isChannelRequired(o)&&!TS.permissions.members.canPostInChannel(o))return false;$("body").addClass("drop-target");if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.deactivate()},draghoverend:function e(){$("body").removeClass("drop-target");if(TS.boot_data.feature_take_profile_photo)if($("body").find("#edit_member_profile_container").length>0){TS.ui.edit_member_profile.handleDrag(false);return}if(TS.ui.fs_modal.is_showing)TS.ui.fs_modal.activate()}})}});var e=null;var t=null;Object.defineProperty(TS.client.ui.files,"$file_btn",{get:function e(){delete TS.client.ui.files.$file_btn;TS.client.ui.files.$file_btn=$("#primary_file_button");return TS.client.ui.files.$file_btn}});var i=function e(t){var i="files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==t.id;var n=t.id===TS.ui.fs_modal_file_viewer.getCurrentFileId();return i||n};var n=function e(t){$(".file_comments_container").hideWithRememberedScrollTop();$(".file_details_container").unhideWithRememberedScrollTop();s(t);$(".file_details_scroller").scrollTop(0)};var a=function e(t,i){$(".file_details_container").hideWithRememberedScrollTop();$(".file_comments_container").unhideWithRememberedScrollTop();o(t,i);$(".file_comments_scroller").scrollTop(0)};var r=function e(t){$(".file_comment_tip").html(TS.templates.builders.makeFileCommentHelpHTML(t))};var s=function e(t){var i=$.extend(TS.files.getFileDetailsMetaTemplateArguments(t),TS.files.getFileTemplateArguments(t));if(i.video_height)i.video_height=TS.model.native_video_embed_height_flexpane;var n=TS.templates.file_details_meta(i);var a=$(".file_details_scroller").find(".file_details_meta");a.html(n);TS.utility.makeSureAllLinksHaveTargets(a);if("space"===t.mode)TS.utility.attachments.unfurlPlaceholders(a);TS.files.createFileCommentsGroup(t);var r=TS.templates.file_details_share_to(t);var s=$(".file_details_scroller").find(".file_details_share_to");s.html(r);TS.utility.makeSureAllLinksHaveTargets(s);TS.model.last_previewed_file_id=t.id;TS.ui.utility.updateClosestMonkeyScroller($(".file_details_scroller"))};var o=function e(t,i){TS.files.createFileCommentsGroup(t);var n=jQuery.extend(true,{},t);var a=n._comments_grouped[i];n.comments=a.comments;var r={file:n,comment_group:a,c_id:i};$.extend(r,TS.files.getFileTemplateArguments(t));var s=$(".file_comments_scroller");var o=TS.templates.file_comments(r);var l=s.find(".file_comments");l.html(o);$(".back_from_file_comments").attr("data-file-id",n.id);s.attr("data-model-ob-id",i);var d=s.data("monkeyScroll");if(d)d.updateFunc()};var l=function e(t){var i=$("#file_reply_container");i.empty();i.append(TS.ui.replies.getReplyInputAvatarHTML());TS.ui.inline_msg_input.make(i,{placeholder:TS.i18n.t("Reply...","threads")(),complete_member_specials:false,complete_cmds:true,in_thread:true,onSubmit:function e(i,n){if(!TS.model.ms_connected)return;if(TS.utility.msgs.shouldSendSlashCommand(n));else{u("");TS.files.addComment(t,n,null,function(e){if(e)TS.storage.storeLastCommentInput(t,"");else c(n)})}},getMsgDivForEditing:function e(){},onTextChange:function e(n){var a=TS.ui.replies.getReplyInputValueForStorage(n);TS.storage.storeLastCommentInput(t,a);var r=$("#file_preview_scroller")[0];TS.ui.replies.maybeScrollReplyInputToBottomOfScroller(r);TS.ui.replies.checkReplyInputLengthAndUpdate(i)}});TS.ui.replies.bindReplyInputFocusEvents(i);d(t,i);var n=TS.storage.fetchLastCommentInput(t);if(n)c(n)};var d=function e(t,i){if(!t||0===i.length)return;var n=false;i.append(TS.templates.reply_broadcast_buttons({label_id:t,view:"convo",can_post_back_to_channel:n}));var a=i.find(".reply_broadcast_label_container, .reply_send");a.mousedown(function(e){e.preventDefault();m(i)}).click(function(){m(i)})};var c=function e(t,i){var n=$("#file_reply_container .message_input");TS.utility.populateInput(n,t,t.length);if(i)TS.storage.storeLastCommentInput(i,t)};var u=function e(t){c("",t);$("#file_reply_container .reply_broadcast_toggle").attr("checked",false)};var m=function e(t){var i=t.find(".message_input");TS.utility.contenteditable.focus(i)};var f=function e(t){var i=$("#file_preview_head_section .convo_flexpane_divider");var n=_.get(t,"comments.length")||0;TS.ui.replies.updateFlexpaneThreadDivider(i,n)};var h=function e(t,i,n){if(!TS.boot_data.feature_file_threads)return;var a;if("file_share_msg"===i&&n)a=n;else if(t.channels&&t.channels.length)a=_.first(t.channels);else if(t.groups&&t.groups.length)a=_.first(t.groups);return a};var g=function e(t){t.addClass("hidden")}})()},4363:function(e,t){(function(){"use strict";TS.registerModule("client.ui.flex",{onStart:function e(){TS.client.flexpane_display_switched_sig.add(u);function t(){TS.client.ui.flex.bindFlexUI()}if(TS.has_pri[g])TS.log(g,"deferring UI bind until login_sig");TS.client.login_sig.add(t)},bindFlexUI:function e(){var t=$("#client_header");$("#col_flex").delegate(".close_flexpane","click",function(){if(TS.model.ui_state.flex_visible){if("search"===TS.model.ui_state.flex_name)TS.clog.track("SEARCH_CLOSE",{});else if("whats_new"===TS.model.ui_state.flex_name)TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"close_flexpane",step:TS.client.whats_new.getNewestID()});TS.client.ui.flex.hideFlex()}});t.delegate("#flex_menu_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.menu.startWithFlexMenu(e);TS.client.downloads.maybeShowFlexMenuProgBar();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_flex_menu_button"}}})});t.delegate("#details_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;if("whats_new"===TS.model.ui_state.flex_name)TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"details_toggle",step:TS.client.whats_new.getNewestID()});l("details");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_details_button"}}})});t.delegate("#recent_mentions_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;l("mentions");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_activity_button"}}})});t.delegate("#stars_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;l("stars");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_stars_button"}}})});t.delegate("#channel_members_toggle_count","click",function(e){d(e);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_members_count_button"}}})});t.delegate("#pinned_item_count","click",function(e){c(e);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_pins_count_button"}}})});t.delegate("#whats_new_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.clog.track("WHATSNEW_ACTION",{action:"open_pane_badged",trigger:"whats_new_toggle",step:TS.client.whats_new.getNewestID()});$("#client-ui").removeClass("whats_new_showing");l("whats_new")})},cleanupFlexExcluding:function e(t){if("files"!==t){TS.view.files.cleanList();TS.client.ui.files.cleanFilePreview()}if("team"!==t){TS.client.ui.flex._unregisterCurrentStatusInput();var i=TS.SearchableMemberList.get("team_directory");if(i)i.destroy()}if("stars"!==t)TS.view.cleanStars();if("mentions"!==t)TS.view.cleanMentions();if("search"!==t)TS.search.view.cleanResults();if("groups"!==t){$("#user_groups_list_wrapper").longListView("setHidden",true);if(TS.view.user_groups_members_list_lazyload){TS.view.user_groups_members_list_lazyload.detachEvents();TS.view.user_groups_members_list_lazyload=null}}},toggleFlex:function e(){if(TS.model.ui_state.flex_visible)TS.client.ui.flex.hideFlex();else if(!TS.model.ui.active_tab_id){var t=TS.model.ui_state.prev_flex_name||TS.model.default_flex_name;var i=TS.model.ui_state.prev_flex_extra;TS.client.ui.flex.setFlexStateFromHistory(t,i)}else{var n="list"===TS.model.ui.active_tab_id;TS.client.ui.flex.showFlex(n);TS.client.flexDisplaySwitched(TS.model.ui.active_tab_id||"",TS.model.ui.last_flex_extra||"")}},hideFlex:function e(t,i){TS.client.ui.flex.cleanupFlexExcluding();if(TS.model.ui_state.flex_visible)if("details"===TS.model.ui_state.flex_name){if(!t)TS.model.ui_state.details_tab_active=false}else if(TS.model.ui_state.details_tab_active&&!TS.client.activeChannelIsHidden()){TS.client.ui.flex.openFlexTab("details",i);return}var n=function e(){$("#"+TS.model.ui_state.flex_name+"_tab").removeClass("active");TS.model.ui.last_flex_extra=TS.model.flex_extra_in_url;TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").removeClass("flex_pane_showing")});TS.model.ui_state.flex_visible=false;TS.model.ui.active_tab_id=null;TS.view.resizeManually("TS.client.ui.flex.hideFlex");if(TS.model.ui.scrolled_to_msg_ts){TS.client.ui.scrollMsgsSoMsgIsInView(TS.model.ui.scrolled_to_msg_ts,false,true,200);TS.model.ui.scrolled_to_msg_ts=null}TS.client.flex_pane.stopLocalTimeInterval();$(".messages_banner").removeClass("flex_pane_showing");TS.client.flexDisplaySwitched("","",i,t);TS.client.ui.flex.adjustIFramesInSpecialFlexPanes();if(document.activeElement&&$(document.activeElement).closest("#col_flex").length>0)TS.view.focusMessageInput();if(!TS.utility.contenteditable.supportsTexty())TS.client.ui.$msg_input.trigger("autosize").trigger("autosize-resize")};if("list"===TS.model.ui.active_tab_id)$("#flex_contents").transition({opacity:0},100,n);else n()},last_window_width_diff:392,last_window_width_diff_default:392,showFlex:function e(t,i){var n=TS.client.ui.areMsgsScrolledToBottom();if(TS.client.activeChannelIsHidden()||!n)TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").addClass("flex_pane_showing")});else $("#client-ui").addClass("flex_pane_showing");TS.model.ui_state.flex_visible=true;TS.storage.storeUIState(TS.model.ui_state);if(!i)TS.view.resizeManually("TS.client.ui.flex.showFlex");if(n)TS.client.ui.instaScrollMsgsToBottom(false);$(".messages_banner").addClass("flex_pane_showing");if(t)$("#flex_contents").css("opacity",0).transition({opacity:100},150);else $("#flex_contents").css("opacity",100);if("files"===TS.model.ui.active_tab_id&&""!==TS.model.ui.last_flex_extra)TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"),true);if("downloads"===TS.model.ui.active_tab_id)TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"),true);if("team"===TS.model.ui.active_tab_id&&!TS.model.previewed_member_id)TS.client.flex_pane.startLocalTimeInterval();if("files"===TS.model.ui.active_tab_id||!TS.model.ui.active_tab_id&&"files"===TS.model.default_flex_name)TS.view.files.maybeRebuildList();else if("search"===TS.model.ui.active_tab_id)TS.search.search_filter_set_sig.dispatch();if("team"===TS.model.ui.active_tab_id)window.setTimeout(function(){TS.view.maybeRebuildUserGroupList()},1);TS.client.ui.flex.adjustIFramesInSpecialFlexPanes();if(!TS.utility.contenteditable.supportsTexty())TS.client.ui.$msg_input.trigger("autosize").trigger("autosize-resize")},_displayFlexTab:function i(a,r){var s=$("#"+a+"_tab");if(!s.length)return false;if(!TS.model.ui_state.flex_visible)TS.client.ui.flex.showFlex(false,true);if(TS.isPartiallyBooted()){e=a;t=r;n();return true}if("stars"===a){if(TS.model.user&&TS.model.user.stars&&!TS.stars.fetched_once){$("#member_stars_list").html(o);TS.stars.fetchUserStarredItems()}else if(TS.model.user.stars&&TS.model.user.stars.length)TS.view.rebuildStars(true)}else if("downloads"===a)TS.client.downloads.maybeBuild();else if("mentions"===a){if(TS.model.user&&TS.model.user.mentions&&!TS.mentions.fetched_once){TS.view.rebuildMentionsLoading();TS.mentions.fetchMentions()}else if(TS.model.user.mentions&&TS.model.user.mentions.length)TS.view.rebuildMentionsImmediately(true)}else if("files"===a)TS.view.files.unHideList();else if("team"===a)TS.client.flex_pane.startLocalTimeInterval();else if("details"===a)TS.model.ui_state.details_tab_active=true;else if("groups"===a)$("#user_groups_list_wrapper").longListView("setHidden",false);if("team"!==a)TS.client.flex_pane.stopLocalTimeInterval();TS.client.ui.flex.cleanupFlexExcluding(a);$("#flex_contents > .panel").removeClass("active");s.addClass("active");if(!TS.utility.contenteditable.isActiveElement(TS.search.input))s.find(".heading").focus();TS.model.ui.active_tab_id=a;TS.model.ui.active_tab_ts=Date.now();if("search"===a)TS.ui.utility.updateClosestMonkeyScroller($("#search_results"));if(!r)TS.view.resizeManually("TS.client.ui.flex._displayFlexTab flex_name:"+a);TS.client.ui.flex.adjustIFramesInSpecialFlexPanes();return true},adjustIFramesInSpecialFlexPanes:function e(){if(!TS.boot_data.special_flex_panes)return;var t=TS.model.ui.active_tab_id;var i;var n;var a;_.forOwn(TS.boot_data.special_flex_panes,function(e){if(TS.has_pri[g])TS.log(g,"special_flex_pane: "+t);n=$("#"+e.flex_name+"_tab");if(!n.length)return;a=n.find("iframe");if(!a.length)return;i="about:blank";if(TS.model.ui_state.flex_visible&&e.flex_name===t)i=a.data("src");if(a.attr("src")===i)return;if(TS.has_pri[g])TS.log(g,"loading src: "+i);a.attr("src",i)})},openFlexTab:function e(t,i){if(!TS.client.ui.flex._displayFlexTab(t))return;var n;if("files"===t)n=TS.model.previewed_file_id;else if("team"===t){n=TS.model.previewed_member_name;if(!n)n=TS.model.previewed_user_group_id}else if("search"===t)n=TS.search.last_search_query;TS.client.flexDisplaySwitched(t,n,i)},setFlexStateFromHistory:function e(t,i,n){if(TS.isPartiallyBooted()){a=arguments;r();return}if(!t){if(TS.model.ui_state.flex_name||n)TS.client.ui.flex.hideFlex(true);return}i=i||"";var s=TS.model.ui_state.flex_extra||"";if(!n&&t==TS.model.ui_state.flex_name&&i==s)return;if("list"===t)t="files";if(!TS.client.ui.flex._displayFlexTab(t))return;if("files"===t)TS.client.ui.files.showFilesFromHistory(i);else if("team"===t)TS.client.ui.showTeamFromHistory(i);else if("search"===t)TS.client.ui.showSearchFromHistory(i);else if("convo"===t&&i)TS.client.ui.showRepliesFromHistory(i);else if("apps"===t)TS.client.ui.showAppsFromHistory(i);else TS.client.flexDisplaySwitched(t,null,false,true)},openConversationFlex:function e(t,i){var n=t.id+"-"+i;var a=!TS.model.ui_state.flex_visible||"convo"!==TS.model.ui_state.flex_name||TS.model.ui_state.flex_extra!=n;if(!a)return;TS.client.ui.flex._displayFlexTab("convo");TS.client.flexDisplaySwitched("convo",n)},openAppProfileFlex:function e(t){var i=t;TS.client.ui.flex._displayFlexTab("apps");TS.client.flexDisplaySwitched("apps",i)},rebuildMsgCurrentStatusIncludingMember:function e(t){var i=TS.model.ui_state.flex_name;if("mentions"===i||"stars"===i){var n=$("#col_flex");var a={member:t,for_message:true};_.each(TS.model.user[i],function(e){if(TS.utility.msgs.memberSentMessage(t,e.message)){var i=n.find('ts-message[data-ts="'+e.message.ts+'"] .message_current_status');i.replaceWith(TS.templates.current_status(a))}})}else if("files"===i)TS.client.ui.files.rebuildFilePreviewAndCommentsIncludingMember(t)},registerCurrentStatusInput:function e(){TS.client.ui.flex._unregisterCurrentStatusInput();TS.client.ui.flex._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#member_preview_container"),has_presets_menu:true,onEscape:h,onSave:h,onError:h});$(".current_status_cover").on("click.current_status",f);$(".current_status_clear_icon_cover").on("click.current_status",function(e){e.stopPropagation();if(TS.client.ui.flex._current_status_input)TS.client.ui.flex._current_status_input.clearCurrentStatus()})},_unregisterCurrentStatusInput:function e(){if(TS.client.ui.flex._current_status_input){TS.client.ui.flex._current_status_input.destroy();TS.client.ui.flex._current_status_input=null}$(".current_status_cover").off(".current_status");$(".current_status_clear_icon_cover").off(".current_status")}});var e;var t;var i=function i(){e=void 0;t=void 0};var n=_.once(function(){var n=function n(){var a=e;var r=t;i();if(!TS.model.ui_state.flex_visible||!TS.model.ui_state.flex_name)return;if(!a)return;TS.client.ui.flex._displayFlexTab(a,r)};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(n);else TS.ms.connected_sig.addOnce(n)});var a;var r=_.once(function(){var e=function e(){var t=a;a=void 0;return TS.client.ui.flex.setFlexStateFromHistory.apply(window,t)};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(e);else TS.ms.connected_sig.addOnce(e)});var s=TS.i18n.t("Loading...","flexpane")();var o='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+s+'" /><br />'+s+"</div>";var l=function e(t){if(TS.model.ui_state.flex_visible&&TS.model.ui_state.flex_name===t)TS.client.ui.flex.hideFlex();else TS.client.ui.flex.openFlexTab(t)};var d=function e(t){if(TS.client.ui.shouldIgnoreClick(t))return false;TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showMembersSection();$("#channel_page_scroller .channel_page_members").highlight(null,"channel_page_members_highlighter")};var c=function e(t){if(TS.client.ui.shouldIgnoreClick(t))return false;TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showPinsSection();$("#channel_page_scroller .channel_page_pinned_items").highlight(null,"channel_page_members_highlighter")};var u=function e(){var t=TS.model.ui_state.flex_visible;var i=TS.model.ui_state.flex_name;var n=TS.shared.getActiveModelOb();m(n);if("team"!==i||!TS.model.ui_state.flex_extra){TS.model.previewed_member_id=null;TS.model.previewed_member_name=null;TS.model.previewed_user_group_id=null}if(!t)return;var a=$("#details_toggle");var r=a.find(".ts_tip_tip");var s=$("#recent_mentions_toggle");var o=$("#stars_toggle");if(n&&"details"===i){a.addClass("active");if(n.is_im||n.is_mpim)r.text(TS.i18n.t("Hide Conversation Details","flexpane")());else if(n.is_group||n.is_channel)r.text(TS.i18n.t("Hide Channel Details","flexpane")());if(!$("#client-ui").hasClass("details_showing"))TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").addClass("details_showing")})}else if("mentions"===i){s.addClass("active");s.find(".ts_tip_tip").text(TS.i18n.t("Hide Activity","flexpane")())}else if("stars"===i){o.addClass("active");o.find(".ts_tip_tip").text(TS.i18n.t("Hide Starred Items","flexpane")())}};var m=function e(t){var i=$("#details_toggle .ts_tip_tip");if($("#client-ui").hasClass("details_showing"))TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").removeClass("details_showing")});$(".channel_header_icon.active").removeClass("active");if(t)if(t.is_im||t.is_mpim)i.text(TS.i18n.t("Show Conversation Details","flexpane")());else i.text(TS.i18n.t("Show Channel Details","flexpane")());$("#recent_mentions_toggle .ts_tip_tip").text(TS.i18n.t("Show Activity","flexpane")());$("#stars_toggle .ts_tip_tip").text(TS.i18n.t("Show Starred Items","flexpane")())};var f=function e(){$(".current_status_container").addClass("active");if(TS.client.ui.flex._current_status_input)TS.client.ui.flex._current_status_input.focus()};var h=function e(t){var i=t&&(t.text||t.emoji);if(i){$(".current_status_cover .current_status").html(TS.format.formatCurrentStatus(t.text,void 0,{stop_animations:true,prevent_copy_paste:false}));$(".current_status_cover .current_status_emoji_cover").html(TS.format.formatCurrentStatus(t.emoji,void 0,{stop_animations:true,transform_missing_emoji:true,ignore_emoji_mode_pref:"as_text"===TS.model.prefs.emoji_mode}))}$(".current_status_container").toggleClass("with_status_set",!!i);$(".current_status_container").removeClass("active")};var g=82})()},4364:function(e,t){(function(){"use strict";TS.registerModule("client.stats",{start_collecting_sig:new signals.Signal,stop_collecting_sig:new signals.Signal,initial_time_period_collection_finished_sig:new signals.Signal,onStart:function t(){TS.client.login_sig.addOnce(function(){S();if(TS.utility.enableFeatureForUser(e)||c||d){g();if(c||d);else setInterval(g,a)}if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(1))_.each(TS.boot_data,function(e,t){if(0===t.indexOf("feature_"))TS.metrics.count(t+(e?"_on":"_off"))});if(window.PerformanceObserver)try{var t=new window.PerformanceObserver(function(e){_.each(e.getEntries(),function(e){if("longtask"===e.entryType){if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.store(e.entryType,e.duration);if(TS.utility.enableFeatureForUser(5))TS.clog.track("PERF_LONGTASKS",{elapsed_time:e.duration})}})});if(window.PerformanceLongTaskTiming)t.observe({entryTypes:["longtask"]})}catch(e){TS.console.logError(e,"perf_observer","client_error",true)}})},isEnabled:function e(){return c&&"1"===TS.qs_args.client_stats||!!o},isCollectingInitialTimePeriodStats:function e(){return!!s}});var e=50;var t=1;var i=1;var n=6e4;var a=6e5;var r=6e5;var s;var o;var l;var d=!!TS.has_pri[y];var c=TS.qs_args.hasOwnProperty("client_stats");var u="rb_all";var m="rb_all_but";var f="rb_msgs";var h="up_member";var g=function e(){var t=!!o;var a;if(c||d){a="1"==TS.qs_args.client_stats||d;if(TS.has_pri[y])TS.log(y,"client.stats: enabled? "+a+" set by "+(d?"user in debug prefs":"query parameter"))}else a=TS.utility.enableFeatureForUser(i);if(TS.has_pri[y])TS.log(y,"client.stats: enabled now? "+t+"; should be enabled? "+a);if(a===t)return;if(a){l={};l[u]=0;l[m]=0;l[f]=0;l[h]=0;o=setInterval(p,n);TS.client.ui.did_rebuild_all_sig.add(T);TS.client.ui.did_rebuild_all_but_msgs_sig.add(v);TS.client.msg_pane.did_rebuild_msgs_sig.add(b);TS.members.member_was_upserted_sig.add(w);TS.client.stats.start_collecting_sig.dispatch()}else{l=void 0;clearInterval(o);o=void 0;TS.client.ui.did_rebuild_all_sig.remove(T);TS.client.ui.did_rebuild_all_but_msgs_sig.remove(v);TS.client.msg_pane.did_rebuild_msgs_sig.remove(b);TS.members.member_was_upserted_sig.remove(w);TS.client.stats.stop_collecting_sig.dispatch()}};var p=function e(){_.each(l,function(e,t){if(TS.has_pri[y])TS.log(y,"client.stats: "+t+" = "+e);TS.metrics.store("cs_"+t,e,{allow_zero:true,is_count:true});l[t]=0})};var S=function e(){var i=TS.boot_data.feature_webapp_always_collect_initial_time_period_stats||TS.utility.enableFeatureForUser(t);if(!i)return;if(TS.has_pri[y])TS.log(y,"Will collect additional stats for the first "+_.round(r/6e4,1)+" minutes of this session");TS._count_bytes_received=true;TS._bytes_received=0;var n=0;var a=function e(){n+=1};TS.members.member_was_upserted_sig.add(a);s=setTimeout(function(){s=void 0;TS.info("Received "+TS._bytes_received+" bytes in the first "+_.round(r/6e4,2)+" minutes of the session");TS.metrics.count("client_session_bytes_received",TS._bytes_received);TS.metrics.count("client_total_members_loaded",_.filter(TS.model.members,function(e){return _.isUndefined(e.is_unknown)||!_.get(e,"is_unknown")}).length);TS.metrics.count("client_total_member_upserts",n);TS.metrics.count("initial_beachballs",TS.client.stats.responsiveness.getTotalBeachballCount());TS.metrics.count("initial_stutters",TS.client.stats.responsiveness.getTotalStutterCount());TS._count_bytes_received=false;TS.members.member_was_upserted_sig.remove(a);TS.client.stats.initial_time_period_collection_finished_sig.dispatch()},r)};var T=function e(){l[u]+=1};var v=function e(){l[m]+=1};var b=function e(){l[f]+=1};var w=function e(){l[h]+=1};var y=1991})()},4365:function(e,t){(function(){"use strict";TS.registerModule("client.stats.responsiveness",{onStart:function t(){TS.client.login_sig.addOnce(function(){if(TS.client.isEnhancedDebuggingEnabled())return;if(!_.isFunction(window.requestAnimationFrame)){TS.warn("Unable to install beachball detector without requestAnimationFrame");return}if(!window.performance){TS.warn("Unable to install beachball detector without performance");return}TS.client.stats.start_collecting_sig.add(d);TS.client.stats.stop_collecting_sig.add(function(){c();u()});if(TS.client.stats.isEnabled()||TS.client.stats.isCollectingInitialTimePeriodStats()){d();TS.client.stats.initial_time_period_collection_finished_sig.add(function(){if(!TS.client.stats.isEnabled())u()})}window.addEventListener("sleep",function(){if(e)u()})})},isEnabled:function t(){return!!e},getTotalBeachballCount:function e(){return a},getTotalStutterCount:function e(){return r}});var e=false;var t;var i;var n;var a=0;var r=0;var s=100;var o=1e3;var l=300;function d(){e=true;i=0;t=[];n=0;var d=performance.now();var c=0;var _;var u=function u(){if(!e)return;var m=performance.now();var f=m-d;d=m;if(f>o){i+=1;a+=1}else if(f>s){n+=1;r+=1}if(0===c)_=m;c+=1;if(c===l){var h=(m-_)/1e3;var g=Math.floor(c/h);c=0;if(TS.debug_widget&&TS.debug_widget.isVisible())TS.debug_widget.setFrameRate(g);t.push(g)}requestAnimationFrame(u)};requestAnimationFrame(u)}function c(){TS.metrics.count("stutters",n);TS.metrics.count("beachballs",i);if(!_.isEmpty(t)){var e=_.min(t);var a;var r=t.sort();var s=Math.floor(r.length/2);if(r.length%2===1)a=r[s];else a=(r[s-1]+r[s])/2;TS.metrics.store("fps_min",e);TS.metrics.store("fps_median",a)}n=void 0;i=void 0;t=void 0}function u(){e=false}})()},4366:function(e,t){(function(){"use strict";var e=10;var t=10;var i=100;var n=100;var a=33;var r=100;TS.registerComponent("SearchableMemberList",{_constructor:function e(t){this.id=t.id;this.triggered_by_user_action=t.triggered_by_user_action;this.$_container=t.$container;this.$_long_list_view;this.$_search_bar;this.$_search_input;this.$_clear_icon;this.$_filter_input;this._current_filter="everyone";this._current_query_for_display="";this._current_query_for_match="";this._next_marker="";this._have_all_members=false;this._members=[];this._model_ob_id=t.model_ob_id;this._filter_counts={};this._suppress_presence=t.suppress_presence||false;this._show_filter_bar=!_.isUndefined(t.show_filter_bar)?t.show_filter_bar:!this._model_ob_id;this._compact_results=!_.isUndefined(t.compact_results)?t.compact_results:!!this._model_ob_id;this._prevent_member_click_handler=t.prevent_member_click_handler||false;this._approx_item_height=this._compact_results?30:89;this._long_list_view_height=0;this._long_list_view_items_height=0;this._long_list_view_initial_height=null;this._fetch_page_p=null;if(!this._suppress_presence)this._presence_list=new TS.PresenceList;this._resize_sig_handler=null;this.member_clicked_sig=new signals.Signal},destroy:function e(){if(this._resize_sig_handler)TS.view.resize_sig.remove(this._resize_sig_handler);if(this._maybeSetupFilterInputDebounced){TS.members.joined_team_sig.remove(this._maybeSetupFilterInputDebounced,this);TS.members.changed_deleted_sig.remove(this._maybeSetupFilterInputDebounced,this)}this.$_container.off();if(this.$_long_list_view)this.$_long_list_view.off();if(this.$_search_input)this.$_search_input.off();if(this.$_clear_icon)this.$_clear_icon.off();if(this.$_filter_input)this.$_filter_input.off();if(this.$_long_list_view&&this.$_long_list_view.length&&$.data(this.$_long_list_view.get(0),"TS-longListView"))this.$_long_list_view.longListView("destroy");if(this.$_search_bar)this.$_search_bar.remove();if(!this._suppress_presence)this._presence_list.clear()},showInitial:function e(){var t=this;if(!this._prevent_member_click_handler)this.$_container.delegate(".team_list_item","click",TS.members.view.onTeamDirectoryItemClick);this.$_long_list_view=this.$_container.find(".searchable_member_list_scroller");this._showLoadingState();this._fetchPage().then(function(e){t._hideLoadingState();t._processPage(e);TS.utility.rAF(function(){t._updatePresenceListForVisibleMembers()});t._setupLongListView();t._maybeSetupSearchBar();return null});var i="channel_membership_dialog"===this.id?"channel_membership_dialog_scroller":"team_list_scroller";TS.metrics.count(i+"_initialized")},maybeRerenderLongListView:function e(){if(this.$_long_list_view&&this._members)this.$_long_list_view.longListView("setItems",this._members,true,true)},_fetchPage:function e(){if(this._fetch_page_p)return this._fetch_page_p;var t=this;var i=this._buildQueryParams();this._fetch_page_p=TS.members.fetchAndUpsertMembersWithQuery(i).then(function(e){t._fetch_page_p=null;t._next_marker=e.next_marker;if(!e.next_marker)t._have_all_members=true;return e.objects||e});return this._fetch_page_p},_buildQueryParams:function e(){var n={count:this._current_query_for_match?i:t,index:TS.members.shouldDisplayRealNames()?"users_by_realname":"users_by_name"};if(TS.boot_data.feature_localization)n.locale=TS.i18n.locale();var a;if(TS.boot_data.feature_shared_channels_client)a=TS.utility.strLooksLikeATeamId(this._current_filter);if(a)n.external_team=this._current_filter;else n.filter=this._current_filter;if(this._current_query_for_match){n.query=this._current_query_for_match;n.search_profile_fields=true}else n.marker=this._next_marker;if(this._model_ob_id)n.channels=[this._model_ob_id];else if(TS.model.user.is_restricted)n.channels=_.map(TS.shared.getAllModelObsForUser(),function(e){return e.is_im?e.user:e.id});return n},_processPage:function e(t){this._members=_.union(this._members,t)},_updatePresenceListForVisibleMembers:function e(){if(this._suppress_presence)return;if(this._presence_list&&this.$_long_list_view&&this.$_long_list_view.longListView){var t=this.$_long_list_view.longListView("getCurrentItemsInView")||[];var i=_.map(t,"id");if(i.length){this._presence_list.clear();this._presence_list.add(i)}}},_fetchProcessAndDisplayPage:function e(){var t=this;return this._fetchPage().then(function(e){t._processPage(e);t._maybeHideNoResultsState();if(t._members.length>0)t.$_long_list_view.longListView("setItems",t._members,true,true);else t._showNoResultsState();return null}).then(function(){TS.utility.rAF(function(){t._updatePresenceListForVisibleMembers();t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();t._recursivelyFillLongListViewToHeight()});return null})},_maybeSetupSearchBar:function t(){var i=this;if(this.$_search_bar)return;return TS.flannel.fetchMemberCounts().then(function(t){if(t.everyone>=e){i.$_long_list_view.before(TS.templates.team_search_bar());i.$_search_bar=i.$_container.find(".searchable_member_list_search_bar");i.$_search_input=i.$_search_bar.find(".searchable_member_list_input");i.$_filter_input=i.$_search_bar.find(".searchable_member_list_filter");i._setupSearchInput();i._maybeSetupFilterInput()}return null})},_setupSearchInput:function e(){var t=this;this.$_search_bar.find(".searchable_member_list_search.loading").replaceWith(TS.templates.team_search_bar_input(this._generateFilterSearchBarTemplateArgs()));this.$_search_input=this.$_search_bar.find(".searchable_member_list_input");this.$_clear_icon=this.$_container.find(".icon_close");this.$_search_input.bind("keyup.searchable_member_list",this._handleSearchKeyUp.bind(this));this.$_container.delegate(".searchable_member_list_filter","click",this._handleFilterSelect.bind(this));this.$_clear_icon.bind("click",function(){t._reset();Promise.resolve().then(function(){t.$_search_input.focus();return null})});if(this.triggered_by_user_action)this.$_search_input.focus()},_maybeSetupFilterInput:function e(){var t=this;if(!this.$_filter_input)return;if(!this._show_filter_bar){t.$_filter_input.remove();t.$_filter_input=null;return}return TS.flannel.fetchMemberCounts().then(function(e){t._filter_counts=e;t.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(t._generateFilterSearchBarTemplateArgs()));t.$_filter_input=t.$_search_bar.find(".searchable_member_list_filter");if(!t._maybeSetupFilterInputDebounced){var i=1e3;var n={trailing:true};t._maybeSetupFilterInputDebounced=_.debounce(function(){return t._maybeSetupFilterInput.apply(t,arguments)},i,n)}TS.members.joined_team_sig.add(t._maybeSetupFilterInputDebounced,t);TS.members.changed_deleted_sig.add(t._maybeSetupFilterInputDebounced,t)})},_maybeSetupFilterInputDebounced:null,_setupLongListView:function e(){var t=this;this.$_long_list_view.longListView({items:this._members,approx_item_height:this._approx_item_height,approx_divider_height:this._approx_divider_height,calcItemHeight:function e(t){return t.outerHeight()},makeElement:function e(){return $(TS.templates.team_list_item({is_channel_membership:t._model_ob_id,is_long_list_view:true}))},renderItem:function e(i,n){i.toggleClass("deleted",true===n.deleted).data("member-id",n.id).data("item",n);if(t._compact_results)i.html(TS.templates.channel_page_member_row({member:n,lazy:false,suppress_presence:t._suppress_presence}));else i.html(TS.templates.team_list_item_member_details({member:n,is_long_list_view:true}));TS.utility.makeSureAllLinksHaveTargets(i)}});this.$_long_list_view.delegate("li").on("click",function(e){if(t._prevent_member_click_handler)e.preventDefault();t.member_clicked_sig.dispatch(e,TS.members.getMemberById($(e.target).parents(".team_list_item").find("[data-member-id]").data("memberId")))});this._resize_sig_handler=_.throttle(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();if(!t._long_list_view_initial_height)t._long_list_view_initial_height=t._long_list_view_height},a);TS.view.resize_sig.add(this._resize_sig_handler);this.$_long_list_view.on("scroll",_.debounce(function(e){t._updatePresenceListForVisibleMembers();if(t._current_query_for_match)return;var i=t._long_list_view_items_height-($(e.target).scrollTop()+t._long_list_view_height);if(i<n)t._fetchProcessAndDisplayPage()},r));TS.utility.rAF(function(){TS.view.resizeManually("TS.SearchableMemberList.showInitial");t._recursivelyFillLongListViewToHeight()})},_recursivelyFillLongListViewToHeight:function e(){var t=this;if(this._current_query_for_match)return;if(this._long_list_view_items_height<=this._long_list_view_height&&!this._have_all_members)this._fetchProcessAndDisplayPage().then(function(){t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height()})},_reset:function e(){this._members=[];this._current_query_for_match="";this._current_query_for_display="";this._current_filter="everyone";this._next_marker="";this.$_search_input.val("");this.$_clear_icon.addClass("hidden");this._have_all_members=false;this._maybeHideNoResultsState();this.$_long_list_view.scrollTop(0);if(this.$_filter_input){this.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(this._generateFilterSearchBarTemplateArgs()));this.$_filter_input=this.$_container.find(".searchable_member_list_filter")}this.$_long_list_view.height(this._long_list_view_initial_height);this._fetchProcessAndDisplayPage()},_showLoadingState:function e(){this.$_long_list_view.before(TS.templates.infinite_spinner({color:"white",size:"medium"}))},_hideLoadingState:function e(){this.$_container.find(".infinite_spinner").remove()},_showNoResultsState:function e(){var t=this.$_container.find(".no_results");if(t.length>0)t.remove();var i=this;var n={query:this._current_query_for_display,everyone_filter_selected:"everyone"===this._current_filter,members_filter_selected:this._current_filter.match(/members/),admins_filter_selected:this._current_filter.match(/admins/),restricted_filter_selected:this._current_filter.match(/guests/),deactivated_filter_selected:"deactivated"===this._current_filter,free_team:!TS.model.team.plan,user_is_admin:TS.model.user.is_admin};if(TS.features.isEnabled("retire_team_site_directory"))n.bots_filter_selected=this._current_filter.match(/bots/);var a=TS.templates.team_searchable_no_results(n);this.$_long_list_view.hide().before(a);if(TS.model.user.is_admin&&!TS.model.team.plan&&this._current_filter.match(/guests/))TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"team_directory",action:"impression"}}});this.$_container.delegate(".clear_members_filter","click",function(){i._reset()});if("everyone"!==this._current_filter&&""!==this._current_query_for_match){var r=this._current_filter;this._current_filter="everyone";this._fetchPage().then(function(e){i._current_filter=r;if(e.length>0){i.$_container.find(".no_results").after(TS.templates.team_other_matches_heading({query:i._current_query_for_display}));i.$_long_list_view.longListView("setItems",e,true,true);i.$_long_list_view.show();TS.utility.rAF(function(){i._long_list_view_height=i.$_long_list_view.height();i._long_list_view_items_height=i.$_long_list_view.find(".list_items").height()})}return null})}},_maybeHideNoResultsState:function e(){var t=this.$_container.find(".no_results");if(0==t.length)return;var i=this.$_container.find(".other_matches");if(i)i.remove();t.remove();this.$_long_list_view.show()},_handleSearchKeyUp:function e(t){var i=$(t.target).val();if(i.trim().toLocaleLowerCase()!==this._current_query_for_match){if(this._fetch_page_p){this._fetch_page_p.cancel();this._fetch_page_p=null}if(!this._suppress_presence)this._presence_list.clear();this._members=[];this._next_marker="";this._have_all_members=false;this._current_query_for_display=i;this._current_query_for_match=i.trim().toLocaleLowerCase();this._fetchProcessAndDisplayPage();this.$_long_list_view.scrollTop(0);this.$_clear_icon.toggleClass("hidden",!i.trim())}},_handleFilterSelect:function e(t){t.preventDefault();var i=this;TS.menu.startWithSearchableMemberListFilter(t,this._filter_counts,function(e){var t=$(e.target).closest("[data-filter]");if(!t.length)return;if(i._fetch_page_p){i._fetch_page_p.cancel();i._fetch_page_p=null}if(!i._suppress_presence)i._presence_list.clear();i._have_all_members=false;i._members=[];i._next_marker="";i._current_filter=t.data("filter");i._fetchProcessAndDisplayPage();i.$_long_list_view.scrollTop(0);i.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(i._generateFilterSearchBarTemplateArgs()));i.$_filter_input=i.$_container.find(".searchable_member_list_filter")})},_generateFilterSearchBarTemplateArgs:function e(){var t=this._current_filter;var i={everyone_filter_selected:"everyone"===t,deactivated_filter_selected:"deactivated"===t};if(TS.boot_data.page_needs_enterprise){_.merge(i,{org_name:TS.model.team.enterprise_name,team_name:TS.model.team.name,org_members_filter_selected:"org_members"===t,org_admins_filter_selected:"org_admins"===t,org_restricted_filter_selected:"org_guests"===t,team_members_filter_selected:"members"===t,team_admins_filter_selected:"admins"===t,team_restricted_filter_selected:"guests"===t});if(TS.features.isEnabled("retire_team_site_directory"))_.merge(i,{org_bots_filter_selected:"org_bots"===t,team_bots_filter_selected:"bots"===t})}else{_.merge(i,{members_filter_selected:"members"===t,admins_filter_selected:"admins"===t,restricted_filter_selected:"guests"===t});if(TS.features.isEnabled("retire_team_site_directory"))_.merge(i,{bots_filter_selected:"bots"===t})}_.each(this._filter_counts,function(e,t){i[t+"_count"]=e});if(TS.features.isEnabled("retire_team_site_directory")){i.bots_count=i.bots_count||0;i.org_bots_count=i.org_bots_count||0}if(TS.boot_data.feature_shared_channels_client){var n=[];_.each(this._filter_counts.external_teams,function(e,i){n.push({external_team_filter_selected:t===i,external_team_count:e,external_team_name:TS.teams.getTeamNameById(i)})});_.merge(i,{ext_teams:n})}return i},test:function n(){var a={};Object.defineProperty(a,"MINIMUM_MEMBERS_FOR_SEARCH",{get:function t(){return e},set:function t(i){e=i}});Object.defineProperty(a,"FETCH_PAGE_SIZE",{get:function e(){return t},set:function e(i){t=i}});Object.defineProperty(a,"FETCH_PAGE_SIZE_SEARCH",{get:function e(){return i},set:function e(t){i=t}});return a}})})()},4367:function(e,t){(function(){"use strict";TS.registerModule("client.ui.user_groups",{onStart:function t(){TS.client.login_sig.addOnce(e)},clearUserGroupFilter:function e(){var t=n.find("#user_group_filter");var a=t.find("input.member_filter");var r=t.find(".icon_close");i=void 0;TS.view.rebuildUserGroupList();setTimeout(function(){a.focus()},0);a.val("");r.addClass("hidden")},getUserGroupQuery:function e(){return i}});var e=function e(){n=$("#user_groups_container");n.html(TS.templates.user_groups_flexpane_tab({can_user_edit_user_groups:TS.permissions.members.canEditUserGroups(),can_user_create_and_delete_user_groups:TS.permissions.members.canCreateAndDeleteUserGroups()}));t()};var t=function e(){var t=n.find("#user_group_filter");var a=t.find("input.member_filter");var r=t.find(".icon_close");a.bind("keyup update-user-group-filter",function(){i=a.val().trim().toLocaleLowerCase();TS.view.rebuildUserGroupList();r.toggleClass("hidden",!i.trim())});n.delegate("#user_groups_list .clear_members_filter","click",function(){TS.client.ui.user_groups.clearUserGroupFilter()});r.bind("click",TS.client.ui.user_groups.clearUserGroupFilter)};var i;var n})()},4368:function(e,t){(function(){"use strict";TS.registerModule("client.msg_input",{$input:$(),tabcomplete_completions:{},onStart:function r(){e=$("#snippet_prompt");t=e.find(".warning");i=e.find("#snippet_prompt_character_count");n=$("#notification_bar");a=$("#chat_input_tab_ui");TS.channels.renamed_sig.add(TS.client.msg_input.setPlaceholder);TS.groups.renamed_sig.add(TS.client.msg_input.setPlaceholder);TS.members.changed_current_status_sig.add(TS.client.msg_input.setPlaceholder);TS.members.changed_name_sig.add(TS.client.msg_input.setPlaceholder);TS.members.changed_real_name_sig.add(TS.client.msg_input.setPlaceholder);TS.prefs.display_real_names_override_changed_sig.add(TS.client.msg_input.setPlaceholder);TS.prefs.team_display_real_names_changed_sig.add(TS.client.msg_input.setPlaceholder);TS.client.login_sig.add(TS.client.msg_input.onLogin)},onLogin:function e(){var t=TS.client.ui.files.$file_btn.width();TS.client.msg_input.$input.data("tab_complete_ui_x_offset",t)},bind:function e(t){TS.client.msg_input.$input=t;if(TS.utility.contenteditable.supportsTexty()){var i=_.throttle(function(e){var i=TS.utility.contenteditable.value(t);p(i);v(i);b(i);if(TS.model.prefs.msg_preview)A(i);if("silent"===e)return;if(i.trim())TS.client.msg_input.storeLastMsgForActiveModelOb(i);else TS.client.msg_input.storeLastMsgForActiveModelOb("")},100);var n={modules:{clipboard:{onPaste:function e(i){var n=false;if(TS.ui.paste.supportsUploadOnPaste())if(!(TS.model.is_FF&&bowser.version<50)&&i.clipboardData){n=TS.ui.paste.detectImageFromEvent(i);if(n)TS.utility.contenteditable.blur(t)}else n=true;if(!n){i.stopPropagation();return TS.utility.contenteditable.paste(t,i)}return n}},msginput:{onLeftWhenEmpty:function e(){TS.utility.contenteditable.blur(t);$("#primary_file_button").click()},onUpArrowCmd:function e(){y(o.up,true)},onUpArrow:function e(){y(o.up,false)},onDownArrow:function e(){y(o.down,false)}},tabcomplete:{appendMenu:function e(t){document.querySelector("#messages_container").appendChild(t)},positionMenu:function e(t){t.style.bottom=0;t.style.left="62px";t.style.right="20px";t.style.top="auto";TS.utility.rAF(function(){if(t.offsetTop<0)t.style.top=0;t=null})}}},placeholder:t.data("placeholder"),onEnter:function e(i){var n=TS.model.is_mac&&i.shiftKey&&i.metaKey||(TS.model.is_win||TS.model.is_lin)&&i.shiftKey&&i.ctrlKey;if(n){TS.client.msg_input.startSnippet();return false}if(!TS.client.ui.cal_key_checker.prevent_enter)B(t);return false},onTextChange:function e(t){m();O();i(t)}};if(TS.boot_data.feature_keyboard_navigation)n.attributes={tabindex:1};TS.utility.contenteditable.create(t,n);if(TS.boot_data.feature_texty_mentions)$("#msg_form .msg_mentions_button").removeClass("hidden").on("click",c)}TS.utility.contenteditable.enable(t);if(!TS.utility.contenteditable.supportsTexty())t.TS_tabComplete({complete_cmds:true,complete_channels:true,complete_user_groups:true,complete_emoji:true,complete_member_specials:true,no_tab_out:true,onMemberComplete:function e(t){if(-1===["@everyone","@channel","@here"].indexOf(t)){var i=TS.shared.getActiveModelOb();if(!TS.client.msg_input.tabcomplete_completions[i.id])TS.client.msg_input.tabcomplete_completions[i.id]=[];if(-1===TS.client.msg_input.tabcomplete_completions[i.id].indexOf(t))TS.client.msg_input.tabcomplete_completions[i.id].push(t)}},onComplete:function e(i,n){TS.utility.populateInput(t,i,n);TS.client.msg_input.storeLastMsgForActiveModelOb(TS.utility.contenteditable.value(t))},ui_initer:TS.ui.msg_tab_complete.start,suspended:true,sort_by_membership:true,include_self:!!TS.boot_data.feature_name_tagging_client});if(!TS.utility.contenteditable.supportsTexty())g();if(!TS.utility.contenteditable.supportsTexty())t.on("textchange",d);t.on("keydown.msg_input",function(e){if(TS.utility.contenteditable.supportsTexty())return;var i=Date.now();var n=TS.utility.contenteditable.value(t);var r=$.trim(n);b(n);if(TS.client.ui.keyPressIsValidForGotoNextOpenChannelOrIM(e)){e.preventDefault();if(TS.model.profiling_keys)TS.model.addProfilingKeyTime("input keydown",Date.now()-i);return}if(e.which==o.enter&&e.metaKey&&e.shiftKey)TS.client.msg_input.startSnippet();else if(e.which==o.enter&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){if(e.which==o.enter&&e.metaKey)TS.client.msg_input.startSnippet();else if(""!==r&&!TS.client.ui.cal_key_checker.prevent_enter){if(a.length&&!a.hasClass("hidden")&&TS.model.prefs.tab_ui_return_selects){e.preventDefault();return}if(TS.model.prefs.enter_is_special_in_tbt&&TS.utility.isCursorWithinTBTs(t))return;B(t,e)}e.preventDefault();if(TS.model.profiling_keys)TS.model.addProfilingKeyTime("input keydown",Date.now()-i);return}else if(e.which==o.enter&&!TS.model.is_mac&&e.shiftKey&&!e.altKey&&e.ctrlKey)TS.client.msg_input.startSnippet();else{if(e.which==o.shift);else if(e.which==o.enter&&(e.ctrlKey||e.altKey)){if(!TS.model.is_mac||TS.model.is_FF||TS.model.is_electron||TS.model.is_chrome_desktop){var s=t.getCursorPosition();TS.utility.contenteditable.value(t,n.substr(0,s)+"\n"+n.substr(s));t.trigger("autosize").trigger("autosize-resize");t.setCursorPosition(s+1)}}else if(TS.model.prefs&&TS.model.prefs.enter_is_special_in_tbt&&e.which==o.enter&&e.shiftKey&&TS.utility.isCursorWithinTBTs(t))B(t,e);if(a.length&&!a.hasClass("hidden")){if(TS.model.is_our_app&&TS.model.is_electron)if(e.which==o.up||e.which==o.left||e.which==o.down||e.which==o.right)e.preventDefault()}else if(TS.client.ui.shouldEventTriggerMaybeEditLast(e,t))TS.client.ui.maybeEditLast(e);else if(""==n&&!e.altKey&&!TS.utility.cmdKey(e)&&e.which==o.left){e.preventDefault();TS.menu.file.startWithNewFileOptions(e,$("#primary_file_button"));t.blur()}else if(w(e,n))TS.chat_history.onArrowKey(e,TS.client.msg_input.$input)}if(TS.model.profiling_keys)TS.model.addProfilingKeyTime("input keydown",Date.now()-i)})},setOffline:function e(){TS.client.msg_input.$input.addClass("offline");P()},setOnline:function e(){TS.client.msg_input.$input.removeClass("offline");O()},resized:function e(t,i){var n=Date.now();if(!TS.client.ui.$emo_menu)TS.client.ui.$emo_menu=$(".emo_menu");if(TS.boot_data.feature_initial_scroll_position){if(TS.client.ui.areMsgsScrolledToBottom(50))TS.client.ui.instaScrollMsgsToBottom()}else TS.view.resizeManually("TS.client.msg_input.resized original:"+t+" height:"+i);if(TS.model.is_FF&&!TS.utility.contenteditable.supportsTexty()){var a=$("#footer").outerHeight();if(a>=115){TS.client.ui.$msg_input.removeClass("with-emoji-menu");TS.client.ui.$emo_menu.addClass("hidden")}else if(a<96){TS.client.ui.$msg_input.addClass("with-emoji-menu");TS.client.ui.$emo_menu.removeClass("hidden")}}if(TS.model.profiling_keys)TS.model.addProfilingKeyTime("inputResized "+t+" "+i,Date.now()-n)},storeLastMsgForActiveModelOb:function e(t){var i=TS.shared.getActiveModelOb();if(TS.model.input_history_index>-1)if(TS.model.input_history[TS.model.input_history_index]!=t)TS.chat_history.resetPosition("storeLastMsgInputForActive "+t);if(!i)return;if(i.last_msg_input==t)return;i.last_msg_input=t;i.has_draft=!!t;TS.storage.storeLastMsgInput(i.id,i.last_msg_input)},populate:function e(t){TS.utility.populateInput(TS.client.ui.$msg_input,t);if(!TS.utility.contenteditable.supportsTexty()){TS.client.msg_input.storeLastMsgForActiveModelOb(t);TS.client.msg_input.$input.trigger("autosize").trigger("autosize-resize")}},populateWithLast:function e(){var t=TS.shared.getActiveModelOb();if(!t)return;var i=TS.model.ms_logged_in_once||TS.format.hasOnlyValidMemberIds(t.last_msg_input);if(!i)return;TS.chat_history.resetPosition("populateChatInputWithLast");l[t.id]=t.last_msg_input;if(TS.utility.contenteditable.supportsTexty()){var n=TS.client.msg_input.$input;TS.utility.contenteditable.deserialize(n,t.last_msg_input);TS.view.prefs.toggleSpellcheck();TS.utility.contenteditable.focus(n);TS.utility.contenteditable.setCursorAtEnd(n);m()}else{TS.client.ui.$msg_input.TS_tabComplete("suspend");TS.client.msg_input.populate(t.last_msg_input);TS.client.ui.$msg_input.TS_tabComplete("unsuspend");TS.client.ui.$msg_input.TS_tabComplete("changeoption","member_prefix_required",t.is_slackbot_im)}},startSnippet:function e(){var t=s;TS.ui.snippet_dialog.startCreate(TS.utility.contenteditable.value(TS.client.ui.$msg_input),t);TS.view.clearMessageInput();s=false},createSnippetFromPrompt:function e(){if(r){s=true;TS.client.msg_input.startSnippet()}},removePrecedingAtSign:function e(){if(!TS.boot_data.feature_texty_mentions)return;var t=TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input);var i=t.start>0?TS.utility.contenteditable.getTextForRange(TS.client.msg_input.$input,t.start-1,1):"";if(TS.boot_data.feature_name_tagging_client&&TS.utility.contenteditable.getFormats(TS.client.msg_input.$input,t.start).slackmention)return;if("@"===i)TS.utility.contenteditable.deleteText(TS.client.msg_input.$input,t.start-1,1)},setPlaceholder:function e(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,E());if(!TS.utility.contenteditable.supportsTexty())TS.client.msg_input.$input.trigger("autosize").trigger("autosize-resize")},test:function e(){return{_maybeHandleReactionCmdInMsgInput:C,_maybeShareFilesInMessage:M,_shareFiles:I,_shouldOnArrowKey:w}}});var e;var t;var i;var n;var a;var r;var s=false;var o=TS.utility.keymap;var l={};var d=function e(){var t=Date.now();var i=TS.utility.contenteditable.value(TS.client.msg_input.$input);var n=TS.format.cleanMsg(i);TS.client.msg_input.storeLastMsgForActiveModelOb(i);if(TS.model.profiling_keys)TS.model.addProfilingKeyTime("input textchange",Date.now()-t);p(n);v(n);f+=1;if(""===n){h=0;f=0}O();if(TS.utility.contenteditable.supportsTexty())m();if(TS.model.prefs.msg_preview)A(i)};var c=function e(){var t=TS.utility.contenteditable.getFormats(TS.client.msg_input.$input);var i=TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input);if(i.start>0&&t.slackmention&&i.start<TS.utility.contenteditable.getLength(TS.client.msg_input.$input)&&TS.utility.contenteditable.getFormats(TS.client.msg_input.$input,i.start+1).slackmention){TS.utility.contenteditable.focus(TS.client.msg_input.$input);return}var n=" @";var a=i.start>0?TS.utility.contenteditable.getTextForRange(TS.client.msg_input.$input,i.start-1,1):"";if("@"===a){n="@";TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input,i.start-1,1)}if(0===i.start||a.match(/\s/))n="@";TS.utility.contenteditable.focus(TS.client.msg_input.$input);TS.utility.contenteditable.insertTextAtCursor(TS.client.msg_input.$input,n,false)};var u=0;var m=function e(){var t=TS.client.msg_input.$input.height();if(t!==u){TS.utility.rAF(function(){TS.client.ui.files.$file_btn.height(t);TS.client.ui.files.$file_btn.height("")});TS.client.msg_input.resized(u,t);u=t}};var f=0;var h=0;var g=function e(){var t=.66;var i;if(TS.channels&&TS.channels.switched_sig)TS.channels.switched_sig.add(function(){h=0;f=0});TS.client.msg_input.$input.autosize({boxOffset:18,placeholder:false,callback:function e(){h+=1;TS.client.msg_input.resized.apply(this,arguments);var n=TS.utility.contenteditable.displayValue(TS.client.msg_input.$input);if(""===n){h=0;f=0}else if(!i&&n&&n.length>20&&f>20&&h>5&&h/f>t){var a=document.querySelectorAll("#msgs_div .message").length+" messages in current channel. Resize vs. change count: "+h+" / "+f+" ("+h/f+")";TS.logError(a,"Excessive message input resize events","Message Input Error");i=true}}})};var p=function a(o){var l;var d=TS.utility.contenteditable.supportsTexty()?TS.format.cleanMsg(o):o;if(TS.features.isEnabled("message_input_byte_limit"))l=TS.utility.msgs.charsOverLimit(d);else l=d.length-TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH;var c=l>0;i.text(TS.i18n.t("Your message is {diff_count, plural, =1{# character}other{# characters}} too long.","msg_input")({diff_count:l}));if(c&&!r){t.removeClass("hidden");e.removeClass("hidden");n.addClass("showing_snippet_prompt");r=true}else if(!c&&r){e.addClass("hidden");n.removeClass("showing_snippet_prompt");r=false;s=false}};var S;var T;var v=function e(t){if(!S)S=$("#special_formatting_text");var i=t.length>2;if(i&&!T){S.addClass("showing");T=true}else if(!i&&T){S.removeClass("showing");T=false}};var b=function e(t){var i=TS.shared.getActiveModelOb();if(t&&0!==t.indexOf("/")&&t.trim().length)TS.typing.userStarted(i);else TS.typing.userEnded(i)};var w=function e(t,i){if(t.shiftKey||t.altKey||t.metaKey||t.ctrlKey)return false;var n=TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input);if(0===n.length)if(t.which==o.up&&n.start<1)return true;else if(t.which==o.down&&n.end>=i.length)return true;return false};var y=function e(t,i){if(!TS.client.ui.isUserAttentionOnChat())return;var n=jQuery.Event("keydown",{altKey:false,shiftKey:false,which:t});if(i)if(TS.model.is_mac)n.metaKey=true;else n.ctrlKey=true;var a=TS.client.msg_input.$input;var r=TS.utility.contenteditable.displayValue(a);if(TS.client.ui.shouldEventTriggerMaybeEditLast(n,a))TS.client.ui.maybeEditLast(n);else if(w(n,r))TS.chat_history.onArrowKey(n,a)};var k="";var A=function e(t){var i;if("/me "===t.substr(0,4)&&t.length>4)i="<i>"+TS.format.formatDefault(TS.format.cleanMsg(t.substr(3)))+"</i>";else if("/shrug "===t.substr(0,7))i=TS.format.formatDefault(TS.format.cleanMsg(t.substr(6)))+" ¯\\_(ツ)_/¯";else if("/"===t.substr(0,1))i="";else i=TS.format.formatDefault(TS.format.cleanMsg(t));i=i||(TS.model.prefs.msg_preview_persistent?"&nbsp;":"");var n=i!=k;k=i;if(n)TS.client.ui.$msg_preview_msg.html(i);if(i&&!TS.model.msg_preview_showing){TS.model.msg_preview_showing=true;TS.client.ui.$msg_preview.removeClass("hidden");TS.client.msg_input.$input.data("$tab_complete_ui_y_positioner",TS.client.ui.$msg_preview)}else if(!i&&TS.model.msg_preview_showing){TS.model.msg_preview_showing=false;TS.client.ui.$msg_preview.addClass("hidden");TS.client.msg_input.$input.data("$tab_complete_ui_y_positioner",null)}else if(!n)return;var a=TS.view.last_preview_height;TS.view.measureMsgPreview();var r=TS.view.last_preview_height;if(a!=r)if(TS.boot_data.feature_initial_scroll_position){if(TS.client.ui.areMsgsScrolledToBottom(50))TS.client.ui.instaScrollMsgsToBottom()}else TS.view.resizeManually();if(TS.ui.msg_tab_complete.isShowing())TS.ui.msg_tab_complete.positionUI()};var C=function e(t){var i;var n=TS.shared.getActiveModelOb();var a=TS.utility.msgs.getDisplayedMsgs(n.msgs);if(a.length)i=_(a).take(5).find(function(e){return!e.is_ephemeral&&!e.no_display});var r=TS.client.ui.maybeHandleReactionCmd(i,t,function(){TS.chat_history.add($.trim(t));TS.view.clearMessageInput()});return r};var M=function e(t,i,n){var a=TS.utility.findUrls(t);var r=a.map(TS.utility.getFileIDFromURL);var s=_.compact(r.map(TS.files.getFileById));var o=[];var l=[];s.forEach(function(e){if(TS.files.isFilePrivate(e)&&e.bot_id)o.push(e);else if(i&&i.is_im&&e.user===i.user)o.push(e);else if(TS.files.isFilePrivate(e)&&e.user===TS.model.user.id)o.push(e);else if(TS.files.isFilePrivate(e)&&e.user!==TS.model.user.id)l.push(e)});if(!o.length&&!l.length){n(false);return}if(o.length&&l.length)x(l,t,i,function(){I(o,t,i,n)});else if(o.length)I(o,t,i,n);else if(l.length)x(l,t,i,n)};var I=function e(t,i,n,a){var r=t[0];var s=t.slice(1);var o=true;var l="";TS.files.shareFile(r.id,n.id,l,o,function(){if(s.length>0)e(s,i,n,a);else a(true)})};var x=function e(t,i,n,a){TS.files.reShareConfirmation(t,function(){I(t,i,n,a)})};var E=function e(){var t=TS.shared.getActiveModelOb();if(!t||!TS.permissions.members.canPostInModelOb(TS.model.user,t)||!t.is_im&&!t.is_mpim&&!t.is_channel&&!t.is_group)return"";var i;var n;if(t.is_self_im){i=TS.i18n.t("Message yourself","msg_input")();if(TS.boot_data.feature_texty){n=TS.members.getMemberCurrentStatusForDisplay(t.user,{stop_animations:true});if(n)i+=" "+n}}else{var a;if(t.is_im){a=TS.members.getPrefCompliantMemberNameById(t.user,false,true);if(TS.boot_data.feature_texty)a=_.escape(a);if(TS.boot_data.feature_texty){n=TS.members.getMemberCurrentStatusForDisplay(t.user,{stop_animations:true});if(n)a+=" "+n}}else if(t.is_mpim)a=TS.mpims.getDisplayName(t,false,false,3);else if(t.is_group)a=t.name;else if(t.is_channel)a="#"+t.name;if(!t.is_im&&TS.boot_data.feature_texty)a=_.escape(a);i=TS.i18n.t("Message {msg}","msg_input")({msg:a})}return i};var B=function t(i,n){var a=TS.client.stats&&TS.client.stats.isEnabled();if(a)TS.metrics.mark("msg_input_try_to_submit");var r=TS.format.cleanMsg(TS.utility.contenteditable.value(i));var s;if(TS.features.isEnabled("message_input_byte_limit"))s=TS.utility.msgs.charsOverLimit(r)>0;else s=r.length>TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH;if(s){e.highlight(600,"",null,0);if(n)n.preventDefault();return}var o=function e(){var t=TS.utility.contenteditable.value(i);if(TS.view.submit()){TS.chat_history.resetPosition("enter key");var n=TS.utility.members.getUsernamesMentionedInString(t);var a=TS.shared.getActiveModelOb();var r=TS.client.msg_input.tabcomplete_completions&&TS.client.msg_input.tabcomplete_completions[a.id]?TS.client.msg_input.tabcomplete_completions[a.id]:[];if(!n.length)return;if(l[a.id])n=_.difference(n,TS.utility.members.getUsernamesMentionedInString(l[a.id]));var s=n.filter(function(e){return-1===r.indexOf(e)&&(TS.members.getMemberByName(e)||TS.user_groups.getUserGroupsByHandle(e))});TS.clog.track("MSG_SUBMITTED_MENTIONS",{num_mentions:s.length});if(TS.client.msg_input.tabcomplete_completions[a.id])delete TS.client.msg_input.tabcomplete_completions[a.id];if(l[a.id])delete l[a.id]}else if(!TS.model.is_msg_rate_limited)TS.client.ui.addOrFlashEphemeralBotMsg({channel:TS.model.active_cid,icons:{emoji:":electric_plug:"},username:"connectbot",text:TS.i18n.t("Hmm, your computer seems to be *offline*, so sending messages won’t work at the moment.","msg_input")(),ephemeral_type:"disconnected_feedback"})};if(C(r))return;M(r,TS.shared.getActiveModelOb(),function(){o()})};var D;var F=1e4;var P=function e(){if(D)return;var t=TS.client.ui.$messages_input_container||TS.client.msg_input.$input;t.addClass("pretend-to-be-online");D=setTimeout(function(){t.removeClass("pretend-to-be-online")},F)};var O=function e(){if(!D)return;var t=TS.client.ui.$messages_input_container||TS.client.msg_input.$input;t.removeClass("pretend-to-be-online");clearTimeout(D);D=void 0}})()},4369:function(e,t){(function(){"use strict";TS.registerModule("client.channel_pane",{$scroller:$("#channels_scroller"),$unread_nav:$(".channels_nav_unread"),$threads_nav:$("#col_channels .all_threads"),$app_space_nav:$("#col_channels .app_space"),onStart:function t(){e=new TS.PresenceList;i=new TS.PresenceList;a=TS.utility.enableFeatureForUser(5);if(TS.useReactSidebar()){var n=document.getElementById("col_channels_react_root");TS.interop.mountChannelSidebar(n)}else{TS.client.login_sig.add(s);TS.members.members_for_user_changed_sig.addOnce(TS.client.channel_pane.rebuild.bind(TS.client.channel_pane,"ims"));TS.client.channel_pane.$scroller.delegate("li a","dragstart",o)}},rebuild:function e(){if(TS.useReactSidebar())return;var t="channel_sidebar_rebuild";if(a)TS.metrics.mark(t+"_mark");TS.client.channel_pane.rebuildFooter();var i;for(var n=0;n<arguments.length;n+=1){i=arguments[n];if("starred"===i)E();else if("channels"===i)D();else if("ims"===i){P();if(TS.apps.isAppSpaceEnabled())R()}else if("apps"===i)R();else TS.error("unknown channel_pane section:"+i)}if(a)TS.metrics.measureAndClear(t,t+"_mark")},rebuildFooter:function e(){if(TS.boot_data.feature_prev_next_button){$("#col_channels_footer").empty();if(!$("#history_nav_btn").length){$("#col_channels_footer").append('<div id="history_nav_btn" class="clearfix"></div>');$("#history_nav_btn").html(TS.templates.builders.buildHistoryNavBtnHtml());TS.client.channel_pane.updateFooterUI()}Q()}else L()},updateFooterUI:function e(){var t=$("#left_arrow_btn");var i=$("#right_arrow_btn");var n=$("#quickswitcher_btn");g();if(1===TS.model.nav_history.length){m(t);m(i)}else if(0===TS.model.nav_current_index){m(t);f(i)}else if(TS.model.nav_current_index===TS.model.nav_history.length-1){m(i);f(t)}else{f(t);f(i)}f(n)},updateQuickSwitcherBtnVisibility:function e(){var t=$("#quick_switcher_btn");if(TS.model.prefs.no_omnibox_in_channels){if(t.hasClass("hidden"))return}else if(!t.hasClass("hidden"))return;t.toggleClass("hidden",!!TS.model.prefs.no_omnibox_in_channels);Q()},getSortedList:function e(){return U()},makeSureActiveChannelIsInView:function e(){if(TS.model.unread_view_is_showing)return;M()},checkScrolledAtAll:TS.utility.immediateDebounce(function(){if(TS.useReactSidebar())return;if(TS.client.channel_pane.$scroller.scrollTop()<=0){TS.client.channel_pane.$scroller.removeClass("has_scrolled");r=false}else if(!r){TS.client.channel_pane.$scroller.addClass("has_scrolled");r=true}}),openChannelBrowser:function e(){if(!d())return TS.sounds.play("beep");T()},openChannelBrowserToSharedChannels:function e(){if(!d())return TS.sounds.play("beep");TS.model.ui_state.channel_browser_show_which_channels="ext_shared";T()},openCreateChannelDialog:function e(){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;if(!d())return TS.sounds.play("beep");v()},openDMBrowser:function e(){if(!d())return TS.sounds.play("beep");p()},openAppsBrowser:function e(){if(!d())return TS.sounds.play("beep");S()},getStarredListCount:function e(){return x().length}});var e;var t=[];var i;var n=[];var a=false;var r=false;var s=function e(){if(TS.has_pri[82])TS.log(82,"UI bind on login_sig");c()};var o=function e(t){var i=false;if(TS.boot_data.feature_arugula){var n=t.target.dataset?t.target.dataset.dragMeta:null;if(t&&t.originalEvent.dataTransfer&&n){t.originalEvent.dataTransfer.effectAllowed="link";t.originalEvent.dataTransfer.setData("x-slack/channel-drag-json",n);i=true}}if(!i)t.preventDefault()};var l=function e(){if(!TS.model.ms_connected&&!TS.model.change_channels_when_offline)return false;return true};var d=function e(){if(!l())return false;return true};var c=function e(){$(".new_channel_btn").on("click",function(e){e.stopPropagation();TS.client.channel_pane.openCreateChannelDialog()});$("#direct_messages_header, .new_dm_btn").on("click",function(e){e.stopPropagation();TS.client.channel_pane.openDMBrowser()});$("#apps_header, .add_apps_btn").on("click",function(e){e.stopPropagation();if(!d())return TS.sounds.play("beep");S(e)});$("#channels_header").on("click",function(){TS.client.channel_pane.openChannelBrowser()});TS.client.channel_pane.$unread_nav.on("click",function(e){e.preventDefault();if(TS.client.ui.checkForEditing(e))return;TS.client.unread.showUnreadView()});TS.client.channel_pane.$threads_nav.on("click",function(e){e.preventDefault();if(TS.client.ui.checkForEditing(e))return;TS.client.threads.showThreadsView()});TS.client.channel_pane.$scroller.find(".section_holder ul").on("click",function(e){if(TS.view.maybeFollowLink(e))return;e.preventDefault();e.stopPropagation();if(!l())return TS.sounds.play("beep");if(TS.client.ui.checkForEditing(e))return TS.sounds.play("beep");var t=$(e.target);var i=t.closest(".member").find(".im_name");var n=i.data("member-id");var a=t.closest(".group_name");var r=a.data("group-id");var s=t.closest(".channel_name");var o=s.data("channel-id");var c=t.closest(".mpim").find(".mpim_name");var _=c.data("mpim-id");var u=t.attr("href");if(n)if(t.hasClass("im_close")){var m=TS.ims.getImByMemberId(n);TS.client.ui.maybePromptForClosingIm(m.id)}else{if(!d())return TS.sounds.play("beep");TS.ims.startImByMemberId(n)}else if(r)if(t.hasClass("group_close"))TS.client.ui.maybePromptForClosingGroup(r);else{if(!d())return TS.sounds.play("beep");TS.groups.displayGroup({id:r,path:u})}else if(o){if(!d())return TS.sounds.play("beep");TS.channels.displayChannel({id:o,channel_path:u})}else if(_){if(t.hasClass("mpim_close")){TS.mpims.closeMpim(_);return}if(!d())return TS.sounds.play("beep");TS.mpims.displayMpim({id:_,path:u})}})};var u=function e(){var t=TS.channels.getUnarchivedChannelsForUser().length;var i=TS.groups.getUnarchivedGroups().length;var n=t+i;var a=$(".channel_list_header_label");if(a.length){var r=a.attr("aria-label")||"";a.attr("aria-label",r.replace("[0]",n))}};var m=function e(t){t.off();t.children("div.ts_tip_tip").addClass("hidden");t.addClass("disabled")};var f=function e(t){var i=t.selector;if("#left_arrow_btn"===i)t.off().on("click",function(){if(TS.onboarding.inOnboarding())return false;TS.client.nav_history.setDirection(TS.utility.keymap.left);window.history.go(-1)});else if("#right_arrow_btn"===i)t.off().on("click",function(){if(TS.onboarding.inOnboarding())return false;TS.client.nav_history.setDirection(TS.utility.keymap.right);window.history.go(1)});else if("#quickswitcher_btn"===i)t.off().on("click",function(){if(TS.onboarding.inOnboarding())return false;TS.ui.jumper.start()});t.children("div.ts_tip_tip").removeClass("hidden");t.removeClass("disabled")};var h=function e(t){if(null===t)return"";else if("All Unreads"===t||"Threads"===t||"Apps"===t)return t;return TS.shared.getDisplayNameForModelOb(TS.shared.getModelObById(t))};var g=function e(){var t={type:"ts_icon_arrow_large_left",name:"Previous",mac_or_pc:TS.model.is_mac?"⌘":"Alt",prev_or_next:"ts_icon_arrow_left_medium"};var i={type:"ts_icon_arrow_large_right",name:"Next",mac_or_pc:TS.model.is_mac?"⌘":"Alt",prev_or_next:"ts_icon_arrow_right_medium"};var n=TS.model.nav_current_index;var a=TS.model.nav_history;var r=a.length;var s=null;var o=null;if(0===r)TS.error("No navigation history yet!!!");else if(1===r){s=a[n].id;o=a[n].id}else if(n===r-1)s=a[n-1].id;else if(0===n)o=a[n+1].id;else{s=a[n-1].id;o=a[n+1].id}t.name=h(s);i.name=h(o);$("#left_arrow_btn").html(TS.templates.footer_tool_tip(t));$("#right_arrow_btn").html(TS.templates.footer_tool_tip(i))};var p=function e(){TS.ui.im_browser.start();$("#direct_messages_header, .channels_list_new_btn").tooltip("hide")};var S=function e(){TS.ui.apps_browser.start();$("#apps_header, .channels_list_new_btn").tooltip("hide")};var T=function e(){TS.ui.channel_browser.start();$("#channels_header").find(".channel_list_header_label").tooltip("hide")};var v=function e(){TS.ui.new_channel_modal.start();$(".channels_list_new_btn").tooltip("hide")};var b=function e(t){if(t.is_im)return TS.ims.getDisplayNameOfUserForImLowerCase(t);if(t.is_mpim)return TS.mpims.getDisplayNameLowerCase(t);return t._name_lc};var w=function e(t){var i="";var n={model_ob:t};if(t.is_im){n.member=TS.members.getMemberById(t.user);n.color_names=false;n.show_close_link=true;i=TS.templates.member(n)}else if(t.is_mpim&&t.is_group)i=TS.templates.mpim(n);else if(t.is_group)i=TS.templates.group(n);else i=TS.templates.channel(n);return i};var y=function e(){var t=TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups();$(".new_channel_btn").toggleClass("hidden",!t)};var k=function e(t,i){if(t.is_slackbot_im)return-1;if(i.is_slackbot_im)return 1;if(t.is_self_im)return-1;if(i.is_self_im)return 1;var n=t.is_mpim?TS.mpims.getDisplayNameLowerCase(t):TS.ims.getDisplayNameOfUserForImLowerCase(t);var a=i.is_mpim?TS.mpims.getDisplayNameLowerCase(i):TS.ims.getDisplayNameOfUserForImLowerCase(i);return TS.i18n.sorter(n,a)};var A=function e(t,i){var n=b(t);var a=b(i);var r=!t.is_im&&TS.notifs.isCorGMuted(t.id)?"Z":"";var s=!i.is_im&&TS.notifs.isCorGMuted(i.id)?"Z":"";if(TS.model.prefs.separate_private_channels){if(t.is_channel)n=r+"A"+n;else if(t.is_group&&!t.is_mpim)n=r+"B"+n;else if(t.is_slackbot_im)n=r+"C"+n;else if(t.is_self_im)n=r+"D"+n;else n=r+"E"+n;if(i.is_channel)a=s+"A"+a;else if(i.is_group&&!i.is_mpim)a=s+"B"+a;else if(i.is_slackbot_im)a=s+"C"+a;else if(i.is_self_im)a=s+"D"+a;else a=s+"E"+a}else{if(t.is_channel||t.is_group&&!t.is_mpim)n=r+"A"+n;else if(t.is_slackbot_im)n=r+"B"+n;else if(t.is_self_im)n=r+"C"+n;else n=r+"D"+n;if(i.is_channel||i.is_group&&!i.is_mpim)a=s+"A"+a;else if(i.is_slackbot_im)a=s+"B"+a;else if(i.is_self_im)a=s+"C"+a;else a=s+"D"+a}return TS.i18n.sorter(n,a)};var C=function e(t,i){var n=t._name_lc;var a=i._name_lc;if(TS.model.prefs.separate_private_channels){n=(t.is_channel?"a":"z")+n;a=(i.is_channel?"a":"z")+a}return TS.i18n.sorter(n,a)};var M=function e(){if(TS.useReactSidebar())return;I()};var I=function e(){var t;if(TS.model.threads_view_is_showing)t=TS.client.channel_pane.$scroller.find(".all_threads");else t=TS.client.channel_pane.$scroller.find(".section_holder ul li.active");if(!t.length)return;t.scrollintoview({offset:"top",px_offset:50,scroller:TS.client.channel_pane.$scroller})};var x=function e(){var t=TS.channels.getChannelsForUser();var a=TS.model.groups;var r=TS.model.ims;var s=[];var o=[];var l;var d;var c;var u;var m;for(l=0;l<t.length;l+=1){d=t[l];if(!d.is_starred)continue;var f=TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==d.id;if(d.is_member||d.was_archived_this_session||f)o.push(d)}for(l=0;l<a.length;l+=1){c=a[l];if(!c.is_starred)continue;if(c.is_archived&&!c.was_archived_this_session)continue;o.push(c)}for(l=0;l<r.length;l+=1){u=r[l];if(!u.is_starred)continue;m=TS.members.getMemberById(u.user);if(!m){TS.warn('Expected member "'+u.user+'" to exist, but it does not!');continue}if(m.deleted)continue;if(!u.is_open&&!u.unread_cnt)continue;o.push(u);s.push(m.id)}if(s.length!==n.length||_.intersection(s,n).length!==s.length){i.clear();i.add(s)}n=s;var h=TS.model.mpims;var g;for(l=0;l<h.length;l+=1){g=h[l];if(!g.is_starred)continue;if(!g.is_open&&!g.unread_cnt)continue;o.push(g)}o.sort(A);return o};var E=function e(){var t=x();var i="";$("#starred_div").toggleClass("hidden",!t.length);t.forEach(function(e){i+=w(e)});$("#starred-list").html(i);if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller($("#starred-list"));TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()};var B=function e(){var t=TS.channels.getChannelsForUser();var i;var n=[];var a=[];var r=TS.model.groups;var s=[];var o=[];for(var l=0;l<t.length;l+=1){i=t[l];var d=TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==i.id;if(i.is_starred)continue;if(i.is_mpim)continue;if(i.is_member||i.was_archived_this_session||d)if(TS.notifs.isCorGMuted(i.id))a.push(i);else n.push(i)}$.each(r,function(e,t){var i=TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==t.id;if(t.is_archived&&!t.was_archived_this_session&&!i)return;if(t.is_starred)return;if(TS.notifs.isCorGMuted(t.id))o.push(t);else s.push(t)});var c=n.concat(s);var _=a.concat(o);c.sort(C);_.sort(C);return c.concat(_)};var D=function e(){var t=B();var i=t.length;y();if(TS.model.user.is_restricted)if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups()&&0===i){$("#channels").addClass("hidden");return}$("#channels").removeClass("hidden");if(!TS.model.user.is_ultra_restricted){var n=$("#channels_header");var a=!TS.model.user.is_restricted;n.find(".channel_list_header_label").tooltip("destroy");n.toggleClass("hoverable",a);if(a)n.find(".channel_list_header_label").tooltip({placement:"top-left",container:"body",delay:{show:400,hide:150}})}var r="";t.forEach(function(e){r+=w(e)});$("#channel-list").html(r);u();if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller($("#channel-list"));TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()};var F=function i(){var n=[];var a=TS.channels.getAllVisibleMpimsForUser();var r=[];TS.members.getMembersForUser().forEach(function(e){var t=TS.ims.getImByMemberId(e.id);if(e.deleted&&!(TS.client.archives.getCurrentModelOb()===t))return;if(!t||!t.is_open&&!t.unread_cnt)return;if(TS.apps.isAppSpaceEnabled())if(e.is_app_user||e.is_bot)return;if(t.is_starred&&!e.deleted)return;n.push(t)});var s=_.map(n,"user");if(s.length!==t.length||_.intersection(s,t).length!==s.length){e.clear();e.add(s)}t=s;a=a.filter(function(e){if(!e.is_open&&!e.unread_cnt)return false;if(e.is_starred)return false;if(TS.notifs.isCorGMuted(e.id)){r.push(e);return false}return true});var o=n.concat(a);o.sort(k);r.sort(k);return o.concat(r)};var P=function e(){var t=F();var i="";t.forEach(function(e){i+=w(e)});$("#im-list").html(i);$("#direct_messages").removeClass("hidden");if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller($("#im-list"));TS.ui.admin_invites.maybeShowInviteLink();TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()};var O=function e(){var t=[];TS.members.getMembersForUser().forEach(function(e){var i=TS.ims.getImByMemberId(e.id);if(e.deleted&&!(TS.client.archives.current_model_ob===i))return;if(!i||!i.is_open&&!i.unread_cnt)return;if(!e.is_app_user&&!e.is_bot)return;if(i.is_starred&&!e.deleted)return;t.push(i)});t.sort(k);return t};var R=function e(){if(!TS.apps.isAppSpaceEnabled())return;var t=O();var i="";t.forEach(function(e){i+=w(e)});$("#apps-list").html(i);$("#app_messages").removeClass("hidden")};var U=function e(){return x().concat(B(),F())};var Q=function e(){var t=TS.model.prefs.no_omnibox_in_channels;if(TS.boot_data.feature_prev_next_button)t=t&&TS.model.prefs.prev_next_btn;var i=$("#channel_scroll_down");$("#col_channels_footer").toggleClass("hidden",t);i.toggleClass("no_sidebar_footer",!!t);var n=!!TS.boot_data.feature_initial_scroll_position;TS.view.resizeManually("TS.client.channel_pane _updateChannelPaneFooterVisibility",n)};var L=function e(){$("#quick_switcher_btn").off().html(TS.templates.builders.buildQuickSwitcherBtnHtml()).on("click",function(){if(TS.onboarding.inOnboarding())return false;TS.ui.jumper.start();TS.clog.track("QUICKSWITCHER_ACTION",{click_target:"quick_switcher_btn",trigger:"quick_switcher_btn",action:"opened"});return TS.client.channel_pane.updateQuickSwitcherBtnVisibility()});TS.client.channel_pane.updateQuickSwitcherBtnVisibility()}})()},4370:function(e,t){(function(){"use strict";TS.registerModule("client.channel_header",{onStart:function e(){i=new TS.PresenceList;TS.members.presence_changed_sig.add(s);TS.members.changed_deleted_sig.add(r);TS.dnd.dnd_statuses_changed_sig.add(g);TS.prefs.muted_channels_changed_sig.add(T);TS.groups.member_left_sig.add(c);TS.groups.member_joined_sig.add(c);TS.groups.topic_changed_sig.add(w);TS.groups.converted_to_shared_sig.add(y);TS.channels.member_left_sig.add(c);TS.channels.member_joined_sig.add(c);TS.channels.member_joined_sig.add(P);TS.channels.topic_changed_sig.add(w);TS.channels.joined_sig.add(v);TS.channels.converted_to_shared_sig.add(y);TS.pins.pinned_status_changed_sig.add(o);TS.pins.pinned_message_changed_sig.add(o);TS.pins.pinned_message_deleted_sig.add(o);TS.pins.pins_fetched_sig.add(o);TS.channels.joined_sig.add(p);TS.channels.left_sig.add(p);TS.stars.channel_unstarred_sig.add(S);TS.client.threads.reply_count_changed.add(E);t=$("#client_header .channel_header .messages_header");t.bind("mouseover mouseenter",function(e){$("#topic_inline_edit").toggleClass("inline_edit_hover",!!$(e.target).is("#topic_inline_edit"))});if(TS.boot_data.feature_global_nav)TS.client.login_sig.add(TS.client.channel_header.loggedIn)},loggedIn:function e(){if(TS.boot_data.feature_global_nav){$("#global_nav_user_menu_btn").html(TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user,36,false,true)).on("click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return false;TS.menu.startWithTeamAndUser(e);e.stopPropagation()});$("#global_nav_back").on("click",function(){window.history.go(-1)});$("#global_nav_forward").on("click",function(){window.history.go(1)})}},test:function e(){var i={_getHiddenChannelJoinAlertMessage:R};Object.defineProperty(i,"_$header",{get:function e(){return t},set:function e(i){t=i}});return i},start:function a(){e=TS.shared.getActiveModelOb();if(!e&&!TS.client.activeChannelIsHidden()){TS.warn("TS.client.channel_header.start cannot find channel, im, or group.");return}var r;var s;var l=false;var d;var c=false;var h=false;var g=false;var S;var b;var w;var y;i.clear();if(e){if(e.is_im){S=e;b=TS.members.getMemberById(S.user);r=true;i.add(b.id)}else if(e.is_mpim){w=e;s=true;i.add(w.members)}else if(e.is_channel||e.is_group){g=true;if(TS.model.user.is_restricted&&(!e.topic||!e.topic.value))g=false}l=TS.shared.isModelObShared(e);d=e.shared_team_ids;c=TS.shared.isModelObOrgShared(e);if(TS.apps.isAppSpaceEnabled()&&_.get(b,"is_bot"))h=true;y=e.name}var x={is_shared:l,is_org_shared:c,name:y,member:b,is_dm_or_mpdm:r||s,show_topic:g,mpim:w,details_showing:$("#client-ui").hasClass("details_showing"),all_unreads:{is_showing:TS.model.unread_view_is_showing,has_new_messages:TS.model.unread_view_is_showing&&TS.client.unread.new_messages_in_channels.length,messages_loaded:TS.client.unread.messages_loaded,total_unread_count:TS.client.unread.getTotalMessagesCount(),sort_order:TS.client.unread.getSortOrder()},threads:{is_showing:TS.model.threads_view_is_showing},is_app:h,shared_team_ids:d};t.html(TS.templates.channel_header(x));if(TS.model.active_im_id){f();if(!TS.boot_data.feature_name_tagging_client)m(b)}u();o();v();n();p();T();k();C();A();I();M()},updateChannelHeaderInfo:function e(i){t.find("#channel_header_info").html(i)},clearUnreadPinState:function e(){d(false);$("#pinned_item_count .pin_count_new_pin_message").empty()},setActiveTab:function e(i){if(!_.isString(i))return;var n=t.find('[data-target="'+i+'"]');t.find(".channel_header__tab").removeClass("--active");n.addClass("--active")},hideTab:function e(i){if(!_.isString(i))return;var n=t.find('[data-target="'+i+'"]');n.addClass("hidden")}});var e;var t;var i;var n=function e(){TS.client.ui.rebuildMemberListToggle()};var a=function t(i,a){if(!TS.model.ms_connected)return;if(!i)return;if(e){var r=TS.membership.getUserChannelMembershipStatus(i.id,e);var s=r.is_known&&!r.is_member;if(a&&!s)n()}h(i)};var r=function e(t){var i=true;a(t,i)};var s=function e(t){var i=false;a(t,i)};var o=function t(){if(!e)return;var i=$("#pinned_item_count");var n=i.closest(".channel_header_info_item");var a=$("#pinned_item_count_count");var r=e.pinned_items_count;if(!e.has_pins)if(e.is_channel)a.text(TS.i18n.number(0,"client"));else n.addClass("hidden");else if(!r)a.text("");else{a.text(TS.i18n.number(r,"client"));if(!e.is_channel)n.removeClass("hidden")}};var l=function e(t){var i=$("#channel_members_toggle_count .channel_members_icon");if(i.length)i.toggleClass("is_filled",t)};var d=function e(t){var i=$("#pinned_item_count .pinned_count_icon");if(0===i.length)return;i.toggleClass("is_filled",t)};var c=function t(i){if(!e||!i||e.id!==i.id)return;n()};var u=function t(){if(e.is_mpim||e.is_im)return;var i;if(e.is_group||e.is_private){i='<i class="ts_icon ts_icon_lock"></i>';$("#channel_title").prepend(i)}else if(e.is_channel){i="#";$("#channel_title").prepend(i)}};var m=function e(t){var i=TS.members.getPrefCompliantMemberName(t);var n=$("#channel_header_info .channel_header_member_alt_name");var a=n.closest(".channel_header_info_item");if(i!==t.profile.real_name){$("#im_title").prepend("@");a.addClass("hidden");return}var r=i!==t.profile.real_name&&t.profile.real_name;var s=r||t.name&&"@"+t.name;if(s){n.text(s);a.removeClass("hidden")}};var f=function e(){var t=$("#channel_header_info .channel_header_member_status");var i=TS.ims.getImById(TS.model.active_im_id);var n=TS.members.getMemberById(i.user);var a=TS.templates.makeMemberPresenceStateClass(n);var r=TS.templates.makeMemberPresenceDomClass(n.id);var s=TS.templates.makeMemberDomId(n);t.addClass(a).addClass(r).addClass(s);h(n)};var h=function i(n){if(!TS.model.active_im_id)return;var a=TS.ims.getImById(TS.model.active_im_id);if(n!=TS.members.getMemberById(a.user))return;var r=false;var s;if(TS.shared.isModelObOrgShared(e)){r=true;s=t.find(".ts_icon_shared_channel");s.removeClass("away")}var o;var l=$("#im_title");l.removeClass("away");if("active"===n.presence)o=TS.i18n.t("active","client")();else if("away"===n.presence){o=TS.i18n.t("away","client")();l.addClass("away");if(r)s.addClass("away")}else o=n.presence;if(n.is_restricted)if(n.is_ultra_restricted)o=TS.i18n.t("Single-Channel Guest","client")();else o=TS.i18n.t("Multi-Channel Guest","client")();if(TS.dnd.isMemberInDnd(n))o=TS.i18n.t("notifications snoozed","client")();$("#header_status_message").html(o)};var g=function e(t){if(!t||!t.length)return;if(TS.model.active_im_id){var i=TS.ims.getImById(TS.model.active_im_id);var n=TS.members.getMemberById(i.user);var a=_.map(t,"id");var r=a.indexOf(n.id);if(r>-1)h(n)}};var p=function t(){if(!e)return;var i="";if(TS.model.active_im_id){var n=TS.ims.getImById(TS.model.active_im_id);if(n)i=TS.templates.builders.buildStarWithTip("im",n)}else if(TS.model.active_channel_id){var a=e.is_member||e.is_archived&&e.is_starred;if(a)i=TS.templates.builders.buildStarWithTip("channel",e)}else if(TS.model.active_group_id)i=TS.templates.builders.buildStarWithTip("group",e);else if(TS.model.active_mpim_id)i=TS.templates.builders.buildStarWithTip("mpim",e);$("#star_container").html(_.trim(i))};var S=function t(i){if(!e||!i||e.id!==i.id)return;if(e.is_archived)p()};var T=function t(){if(!e)return;if(TS.client.activeChannelIsHidden())return;if(TS.model.active_im_id)return;var i=['<button type="button" class="btn_unstyle mute_btn ts_tip ts_tip_bottom ts_tip_lazy"',' title="'+TS.i18n.t("Unmute","client")()+'"',">",'<i class="ts_icon ts_icon_bell_slash ts_icon_inherit muted_icon"></i>',"</button>"].join("");var n=$("#mute_container");var a="muted";var r=$("#channel_name");var s=TS.notifs.isCorGMuted(e.id);if(s){n.html(i);r.addClass(a);$(".mute_btn").bind("click",function(){TS.notifs.muteOrUnmuteCorG(e.id)})}else{n.empty();r.removeClass(a)}};var v=function i(){if(!e)return;var n=(e.is_member||e.is_group)&&!TS.model.user.is_ultra_restricted&&!TS.model.user.is_restricted&&(!TS.channels.isChannelRequired(e)||TS.members.canUserPostInGeneral());var a=$("#channel_topic_text");var r=e.topic&&e.topic.value?TS.utility.formatTopicOrPurpose(e.topic.value,true):"";a.html(TS.utility.removeLinksFromTabFlow(r));if(n){$("#topic_inline_edit").addClass("inline_edit_editable");var s=e.is_group?"group-id":"channel-id";a.data(s,e.id);a.data("inline-edit-unformatted",e.topic.value)}b();var o=t.find("#topic_inline_edit");o.on("click",function(){TSSSB.call("updateNoDragRegion",{id:"channel-topic",width:o.outerWidth(),height:o.outerHeight(),top:o.offset().top,left:o.offset().left})})};var b=function e(){var t=TS.model;if(t.is_IE)$("#topic_inline_edit").addClass("in_ie")};var w=function e(){var i=document.getElementById("topic_inline_edit");var n=!TS.boot_data.feature_name_tagging_client&&i&&i.contains(document.activeElement);if(TS.ui.inline_edit.containsActiveElement(t))return;TS.client.channel_header.start();if(n)$("#topic_inline_edit .inline_edit_inner").focus()};var y=function e(){TS.client.channel_header.start()};var k=function t(){if(!e)return;x();if(TS.model.active_im_id){var i=TS.ims.getImById(TS.model.active_im_id);var n=TS.members.getMemberById(i.user);TS.client.msg_pane.maybeSetupCalls(n)}else if(TS.model.active_channel_id||TS.model.active_group_id)TS.client.msg_pane.maybeSetupCalls();else if(TS.model.active_mpim_id){var a=TS.mpims.getMpimById(TS.model.active_mpim_id);TS.client.msg_pane.maybeSetupCalls(false,a)}$(".channel_calls_button").addClass("blue_on_hover")};var A=function e(){if(TS.model.unread_view_is_showing){$("#channel_header_unread_refresh").on("click",function(){TS.client.unread.reload()});if(TS.model.unread_view_is_showing)t.on("click",".channel_header_info_sort_order",TS.menu.startWithAllUnreadsSortOrderMenu)}};var C=function t(){if(TS.client.activeChannelIsHidden())return;if(TS.onboarding.inOnboarding())return false;var i=$("#channel_actions_toggle, #channel_name");if(e.is_im){var n=TS.ims.getImById(TS.model.active_im_id);i.on("click.channel_actions",function(e){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}});if(n)TS.menu.member.startWithMember(e,n.user,false,false,true)})}else if(e.is_channel||e.is_mpim)i.on("click.channel_actions",function(t){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}});TS.menu.channel.startWithChannel(t,e.id)});else if(e.is_group)i.on("click.channel_actions",function(t){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}});TS.menu.group.startWithGroup(t,e.id)})};var M=function e(){if(TS.boot_data.feature_name_tagging_client)$("#edit_topic_trigger, #edit_topic_container").click(function(e){if("a"===e.target.tagName.toLowerCase())return;TS.ui.channel_topic_dialog.start()})};var I=function e(){if(!TS.apps.isAppSpaceEnabled())return;TS.client.ui.app_space.verifyTabs();$('[data-action="toggleAppSpaceView"]').on("click",function(){var e=$(this).data("target");TS.client.ui.app_space.toggleView(e)})};var x=function e(){$(".channel_calls_button").remove()};var E=function e(t){var i=$("#channel_header_info.threads_channel_header_info");var n;if(!t)n=TS.i18n.t("No new replies","threads")();else n=TS.i18n.t("{new_reply_count,plural,=1{{new_reply_count} new reply}other{{new_reply_count} new replies}}","threads")({new_reply_count:t});i.text(n)};var B=5e3;var D={};var F;var P=function e(t,i,n){if(n){D[t.id]=D[t.id]||[];D[t.id].push(i.name);O()}};var O=function e(){var t=$("#channel_members_toggle_count");var i=TS.model.active_channel_id;var n=D[i]||[];var a=0===n.length;var r=_.isEqual(n,[TS.model.user.name]);if(a||r)return;var s=R(n);TS.tips.updateTipTitle(t,s);if(F)clearTimeout(F);else l();F=setTimeout(function(){l();TS.client.ui.rebuildMemberListToggle();D={};F=null},B)};var R=function e(t){if(_.isEmpty(t))return"";var i=t.slice(0,3).map(function(e){return"@"+e});if(t.length>3)i.push("others");return TS.i18n.t("{num_member_names, plural, =1{{first_member_name} has joined the channel} =2{{first_member_name} and {second_member_name} have joined the channel} other{{members} have joined the channel}}","jobs")({num_member_names:i.length,first_member_name:i[0],second_member_name:i[1],members:TS.i18n.listify(i).join("")})}})()},4371:function(e,t){(function(){"use strict";TS.registerModule("ui.channel_topic_dialog",{onStart:function e(){},start:function i(){var n='<div id="topic_dialog_input_container"></div>\n\t\t\t\t<label for="channel_topic_validation"></label>';TS.generic_dialog.start({backdrop_click_to_dismiss:true,body:n,dialog_class:"channel_topic_dialog",go_button_text:TS.i18n.t("Done","channel_topic_dialog")(),onShow:e,onGo:t})},test:function e(){return{}}});var e=function e(){var t=$("#generic_dialog.channel_topic_dialog");var i=t.find("#topic_dialog_input_container");var n=[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members];TS.ui.inline_msg_input.make(i,{aria_label:TS.i18n.t("Add a topic","channel_topic_dialog")(),complete_member_specials:false,no_emo:false,placeholder:TS.i18n.t("Add a topic","channel_topic_dialog")(),onEnter:TS.generic_dialog.go,onEscape:TS.generic_dialog.cancel,completers:n,autocomplete_below_input:true,onTextChange:function e(){TS.ui.validation.validate(i)}});var a=i.find(".message_input");var r=TS.shared.getActiveModelOb().topic.value;var s=TS.utility.unformatTopicOrPurpose(r);TS.utility.contenteditable.value(a,s);a.attr("data-validation","maxlength=250");a.attr("data-validation-for","channel_topic_validation");a.addClass("no_validation_padding");TS.generic_dialog.div.on("shown",function e(){TS.generic_dialog.div.off("shown",e);TS.utility.contenteditable.focus(a);TS.utility.contenteditable.setCursorAtEnd(a)})};var t=function e(){var t=$("#topic_dialog_input_container .message_input");if(!TS.ui.validation.validate(t))return false;var i=TS.shared.getActiveModelOb();var n=TS.utility.contenteditable.value(t);var a=TS.format.cleanMsg(n);if(a===i.topic.value)return;if(i.is_channel)TS.channels.setTopic(i.id,n);else if(i.is_group)TS.groups.setTopic(i.id,n)}})()},4372:function(e,t){(function(){"use strict";TS.registerModule("client.flex_pane",{onStart:function e(){o.init();$("#flex_contents").delegate("div.file_list_item","dragstart",t)},startLocalTimeInterval:function e(){clearInterval(a);a=setInterval(r,6e4);r()},stopLocalTimeInterval:function e(){clearInterval(a)},maybeFetchFileList:function t(){if(!TS.model.team)return;if(!TS.model.ui_state||!TS.model.ui_state.flex_visible||"files"!==TS.model.ui_state.flex_name||TS.model.ui_state.flex_extra)return;var a=(_.isArray(TS.model.file_list_types)&&TS.model.file_list_types||["all"]).sort().join(",");var r=$("#file_list").data("list");var s;if("all"===r){s=i("team",a);if(!e[s]){e[s]=true;TS.files.fetchTeamFiles(a,n)}return}var o=$("#file_list").data("filter-user")||"";if(!o)return;s=i(o,a);if(!e[s]){e[s]=true;TS.files.fetchMemberFiles(o,a,n)}}});var e={};var t=function e(t){var i=false;if(TS.boot_data.feature_arugula){var n=t.target.dataset?t.target.dataset.dragMeta:null;if(t&&t.originalEvent.dataTransfer&&n){t.originalEvent.dataTransfer.effectAllowed="link";t.originalEvent.dataTransfer.setData("x-slack/file-drag-json",n);i=true}}if(!i)t.preventDefault()};var i=function e(t,i){t=t||"team";i=i||"all";return t+"_"+i};var n=function t(n,a,r){if(!n){delete e[i(r.user,r.types)];return}TS.view.files.throttledRebuildList()};var a;var r=function e(){TS.utility.throttle.method(s,"view_tz_labels",1e3)};var s=function e(){var t;var i=$(".timezone_label");var n=[];i.each(function(e,i){i=$(i);t=TS.members.getMemberById(i.data("member-id"));if(!t){n.push("");return}var a=t&&t.tz?t.tz:"America/Los_Angeles";var r=TS&&TS.boot_data&&TS.boot_data.dst_offsets&&TS.boot_data.dst_offsets[t.tz]&&TS.boot_data.dst_offsets[t.tz].tz_offset?TS.boot_data.dst_offsets[t.tz].tz_offset:-25200;n.push(TS.interop.datetime.memberLocalTime(Date.now(),{timeZone:a,timeZoneOffset:r,do24hrTime:TS.utility.date.do24hrTime()}));t=null;i=null});i.each(function(e,t){t=$(t);t.find(".timezone_value").text(n[e]);t=null});i=null};var o=function(){var e;var t;var i;var n=500;var a=3e3;var r=400;var s=300;var o;var l=function t(a){TS.view.rebuildMentions();if(!a)return;clearTimeout(i);i=setTimeout(function(){if(e)return;c()},n)};var d=function e(){$(".flex_header").append('<div id="rxn_toast_div" class="hidden ts_tip ts_tip_bottom"></div>');o=$("#rxn_toast_div");o.on("click",function(){var e="mentions";if(!TS.model.ui_state.flex_visible||TS.model.ui_state.flex_name!==e)TS.client.ui.flex.openFlexTab(e);m()});o.on("mouseenter",function(){$("html").unbind("mousemove.rxn_toast");u()});o.on("mouseleave",function(){_()})};var c=function t(){var i=TS.rxns.getNextRxnRecordThatNeedsAlert();if(!i)return;if(!i.emoji)return TS.error("rxn_record.emoji missing");if(!Object.keys(i.emoji).length)return TS.error("rxn_record.emoji is empty");e=i;var n=TS.rxns.need_alerts[i.rxn_key];if(!n)TS.error("WTF no since");var a=0;var r;var l;Object.keys(i.emoji).forEach(function(e){i.emoji[e].forEach(function(t){if(t.was_toasted)return;if(t.when<n)return;t.rxn_source=i.source;a+=1;if(!r||t.when<r.when){r=t;l=e}})});if(!l){TS.error("WTF no emoji_name");TS.dir(0,i,"rxn_record")}if(r)r.was_toasted=true;else{TS.error("oldest_who_when is undefined.");return}if(1==a)delete TS.rxns.need_alerts[i.rxn_key];var d=TS.shared.getModelObById(r.rxn_source);var c;if(d.is_im)c=TS.i18n.t("Direct Message","flex_pane")();else if(d.is_group&&d.is_mpim)c=TS.mpims.getDisplayName(d,false);else if(d.is_group||d.is_private)c=d.name;else if(d.is_channel)c="#"+d.name;var u=TS.members.getPrefCompliantMemberNameById(r.id,true);var m='<span class="ts_tip_tip"><span>&nbsp;&nbsp;'+u+"&nbsp;&nbsp;</span><br><span>"+c+"</span></span>";var f=TS.emoji.graphicReplace(":"+l+":");if(i.url)f='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+i.url+');"></span>';f+=m;var h=o.css("top");var g=-(50+o.height());var p=o.find(".ts_tip_tip").outerWidth()>150?"ts_tip_rightish":"";o.html(f).removeClass("hidden");o.addClass(p).css({opacity:0,top:g}).transition({opacity:1,top:h},s);_();$("#client-ui").addClass("rxn_toasting");$("html").bind("mousemove.rxn_toast",_)};var _=function e(){clearTimeout(t);t=setTimeout(m,a)};var u=function e(){clearTimeout(t);o.css("opacity",1)};var m=function e(){u();o.transition({opacity:0},r);$("html").unbind("mousemove.rxn_toast");t=setTimeout(function(){o.addClass("hidden");$("#client-ui").removeClass("rxn_toasting");f()},r+1)};var f=function t(){e=null;c()};return{init:function e(){d();TS.rxns.rxn_records_changed_sig.add(TS.utility.throttleFunc(l,100,true))}}}()})()},4373:function(e,t){(function(){"use strict";TS.registerModule("client.msg_pane",{last_render_time:null,last_rendered_msg:null,last_in_stream_msg:null,dont_check_unreads_til_switch:false,date_change_timer:null,new_msgs_bar_showing:false,did_rebuild_msgs_sig:new signals.Signal,onStart:function e(){g=new TS.PresenceList;TS.team.team_email_domain_changed_sig.add(x,TS.client.msg_pane);TS.team.team_domain_changed_sig.add(x,TS.client.msg_pane);TS.team.team_name_changed_sig.add(x,TS.client.msg_pane);TS.prefs.team_auth_mode_changed_sig.add(x,TS.client.msg_pane);TS.prefs.team_allow_calls_changed_sig.add(F,TS.client.msg_pane);TS.prefs.team_calling_app_name_changed_sig.add(F,TS.client.msg_pane);TS.utility.calls.started_platform_call_sig.add(D,TS.client.msg_pane);TS.members.changed_admin_perms_sig.add(x,TS.client.msg_pane);TS.prefs.dtop_notif_changed_sig.add(Q);TS.prefs.team_perms_pref_changed_sig.add(Q);TS.prefs.muted_channels_changed_sig.add(Q);TS.ui.growls.permission_changed_sig.add(Q);TS.channels.converted_to_shared_sig.add(b);TS.groups.converted_to_shared_sig.add(b);TS.channels.shared_teams_updated_sig.add(w);TS.groups.shared_teams_updated_sig.add(w);if(TS.client&&TS.client.highlights){TS.client.highlights.updated_sig.add(TS.client.msg_pane.maybeRenderHighlightedMessages);TS.client.highlights.feedback_submitted_sig.add(TS.client.msg_pane.maybeRenderHighlightedMessageFeedback)}TS.client.msg_pane.initDateChange();if(bowser&&bowser.msie&&bowser.version<11&&h)h+=" hidden"},initDateChange:function e(){var t=15;if(!TS.client.msg_pane.date_change_timer)TS.client.msg_pane.date_change_timer=window.setInterval(function(){TS.utility.throttle.method(TS.client.msg_pane.checkForDateChange,"date_change_check",1e3)},6e4*t)},checkForDateChange:function e(){if(TS.model&&TS.model.active_cid&&TS.client.msg_pane.last_render_time&&TS.client.msg_pane.last_render_time.getDay()!==(new Date).getDay())TS.client.msg_pane.rebuildMsgsWithReason("TS.client.msg_pane.checkForDateChange")},rebuildChannelMembersList:function e(){if(TS.members.is_in_bulk_upsert_mode){if(!a){a=true;TS.members.batch_upserted_sig.addOnce(function(){a=false;TS.client.msg_pane.rebuildChannelMembersList()})}return}TS.client.ui.rebuildMemberListToggle()},rebuildMsgsWithReason:function e(t,i){if(TS.useReactMessages())return;if(i){if(TS.utility.enableFeatureForUser(10))TS.statsd.count("client_msgs_rebuild_throttled");if(!_.isEmpty(S)&&t)S+=", ";S+=t;T+=1;if(p)return;k(S);p=true;setTimeout(function(){if(T>1){k(S);TS.metrics.count("rebuild_msgs_with_reason_throttles",T)}p=false;S="";T=0},1e3)}else k(t)},setInitialScrollPosition:function e(t){if(TS.useReactMessages())return;if(!TS.model.prefs)return;var i=TS.shared.getActiveModelOb();if(TS.model.prefs.start_scroll_at_oldest)if(i.unread_cnt){TS.client.ui.instaScrollMsgsToBottom(false);TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()}else if(t>0){if(TS.client.ui.$msgs_scroller_div.length)TS.client.ui.$msgs_scroller_div[0].scrollTop=t}else TS.client.ui.instaScrollMsgsToBottom(false);else TS.client.ui.instaScrollMsgsToBottom(false);i._has_auto_scrolled=true},displayTitle:function e(){TS.client.channel_header.start()},clearUnreadDivider:function e(){if(!TS.client.ui.$msgs_unread_divider)return;if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.clearUnreadDivider: removing TS.client.ui.$msgs_unread_divider");TS.client.ui.$msgs_unread_divider.remove();TS.client.ui.$msgs_unread_divider=null;$(".day_container.unread_day_container").removeClass("unread_day_container")},hideMessageContainer:function e(){c.addClass("hidden");u.addClass("hidden")},showMessageContainer:function e(){c.removeClass("hidden");u.removeClass("hidden")},hideCenterWorkspace:function e(){m.addClass("hidden")},showCenterWorkspace:function e(){m.removeClass("hidden")},maybeHideNewMsgsBar:function e(t){var i=true;TS.client.msg_pane.maybeClearNewMsgsTimer(null,i);if(!TS.model.prefs.mark_msgs_read_immediately){if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.maybeHideNewMsgsBar: no mark_read_immediately pref - hiding now");TS.client.msg_pane.hideNewMsgsBar()}else{if(t&&("esc"===t||"clicked"===t)){if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.maybeHideNewMsgsBar: hiding immediately because reason = "+t);TS.client.msg_pane.hideNewMsgsBar();return}var n=TS.shared.getActiveModelOb();if(n&&!n._temp_unread_cnt&&!n.unread_cnt){if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.maybeHideNewMsgsBar: no _temp_ or unread_cnt - setting a timer to hide new msgs bar for "+n.id);TS.client.msg_pane.maybeStartNewMsgsTimer(n)}}},clearUnreadDividerAndHideNewMsgsBar:function e(t){TS.client.msg_pane.clearUnreadDivider();TS.client.msg_pane.maybeHideNewMsgsBar(t)},maybeClearUnreadDivider:function e(t,i){if(!t||!i)return;if(!t.unread_cnt&&i.user&&i.user==TS.model.user.id){if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.maybeClearUnreadDivider: clearing because you sent a message in "+t.id+" and unread_cnt = "+t.unread_cnt);TS.client.msg_pane.clearUnreadDivider();TS.utility.msgs.maybeClearPrevLastRead()}},assignLastReadMsgDiv:function e(t){var i;if(!t)return;if(!t.msgs.length)return;var n=t._prev_last_read||t.last_read;i=TS.utility.msgs.getMsg(n,t.msgs);if(i&&!TS.utility.msgs.isMsgHidden(i)&&!TS.utility.msgs.isMsgRolledUp(i)){o=TS.client.msg_pane.getCanonicalDivForMsg(n);return}var a=TS.utility.msgs.getOldestValidTs(t);if(n>a){i=TS.utility.msgs.getDisplayedMsgBeforeTS(n,t.msgs);if(i)o=TS.client.msg_pane.getCanonicalDivForMsg(i.ts);else{o=null;TS.error("nulling out _$last_read_msg_div because we could not find a message to use #1")}}else o=null},insertUnreadDivider:function e(){if(TS.client.ui.$msgs_unread_divider)return;var t=TS.shared.getActiveModelOb();if(!t){TS.error("insertUnreadDivider no channel, no im, no group");return}if(TS.model.seen_onboarding_this_session&&t.id==TS.model.welcome_model_ob.id||!TS.client.msg_pane.last_in_stream_msg){C();return}var i=false;var n;if(!TS.model.ui.is_window_focused)TS.client.msg_pane.clearUnreadDivider();if(TS.model.ui.is_window_focused)n=t._prev_last_read||t.last_read;else n=t.last_read;var a=TS.client.msg_pane.is_rebuilding;if(t.unread_cnt&&TS.client.msg_pane.last_in_stream_msg&&!TS.client.msg_pane.dont_check_unreads_til_switch)if(a||!TS.model.ui.is_window_focused){if(TS.has_pri[K])TS.log(K,"TS.view.addMsg() on "+t.id+": inserting red line because is_rebuild, or window not focused.")}else if(TS.model.ui.is_window_focused){var r=TS.client.ui.isMsgInView(TS.client.msg_pane.last_in_stream_msg.ts);if(r){if(t.is_im){if(TS.has_pri[K])TS.log(K,"TS.view.addMsg() on "+t.id+": clearing red line because new msg is in view.");TS.client.msg_pane.clearUnreadDivider()}TS.utility.msgs.maybeClearPrevLastRead();i=true}else if(TS.has_pri[K])TS.log(K,"TS.view.addMsg() on "+t.id+": inserting red line because new msg is out of view.")}if(TS.notifs.isCorGMuted(t.id)){if(TS.has_pri[K])TS.log(K,"insertUnreadDivider(): "+t.id+" is muted - exiting");return}if("0000000000.000000"===n){if(TS.has_pri[K])TS.log(K,"insertUnreadDivider(): "+t.id+" last_read is zero ("+n+") - not inserting.");i=true}if(o){var s=TS.client.msg_pane.getCanonicalDivForMsg(t.last_read);if(s){var l=s.nextAll();if(l.length>0){var d=_.every(l,function(e){return $(e).hasClass("hidden")});if(d)i=true}}}if((!i||TS.boot_data.feature_scrollback_half_measures)&&(t.unread_cnt&&n<TS.client.msg_pane.last_in_stream_msg.ts||n<TS.client.msg_pane.last_in_stream_msg.ts)){var c=TS.templates.messages_unread_divider();var u=false;if(TS.boot_data.feature_scrollback_half_measures&&i)u=true;if(o&&o.length)o.after(c);else{var m=TS.utility.msgs.getOldestValidTs(t);if(n>m){var f=TS.utility.msgs.getDisplayedMsgAfterTS(n,t.msgs);var h;if(f)h=TS.client.msg_pane.getCanonicalDivForMsg(f.ts);if(h&&h.length)h.before(c);else TS.client.ui.$msgs_div.find(".message").last().before(c)}else{TS.client.ui.$msgs_div.find(".message").first().before(c);if(TS.boot_data.feature_scrollback_half_measures)u=true}}TS.client.ui.$msgs_unread_divider=$("#msgs_unread_divider");TS.client.ui.$msgs_unread_divider.data("last_read_ts",n);if(u)TS.client.ui.$msgs_unread_divider.addClass("invisible");if(t.unread_cnt)$(".unread_divider").removeClass("no_unreads");else $(".unread_divider").addClass("no_unreads");if((TS.client.ui.$msgs_unread_divider.next(".day_divider").length||TS.client.ui.$msgs_unread_divider.is(":last-child"))&&!u){TS.client.ui.$msgs_unread_divider.addClass("adjacent_to_date");TS.client.ui.$msgs_unread_divider.closest(".day_container").next(".day_container").addClass("unread_day_container")}}var g=t._temp_unread_cnt||t.unread_cnt;var p=t._temp_last_read||t.last_read;if(p<TS.client.msg_pane.last_in_stream_msg.ts&&g){C();var S=$("#messages_unread_status");if(TS.client.ui.isUnreadDividerInView()){S.addClass("quiet no_jump");S.off("click mouseenter mouseleave");S.click(function(e){e.preventDefault();TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.clicked)})}else{S.removeClass("quiet no_jump");S.off("click mouseenter mouseleave");S.click(function(e){e.preventDefault();TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()})}TS.client.msg_pane.showNewMsgsBar();TS.client.msg_pane.startNewMsgsTimer();S=null}C()},updateEndMarker:function n(){var a=TS.shared.getActiveModelOb();if(!a){TS.error("updateEndMarker no channel, no im, no group");return}g.clear();var r=$("#end_display_meta");var s=$("#end_display_padder");var o=$("#end_display_div");var l=$("#end_display_msg_lim");var d=$("#end_display_msg_lim_bottom_margin");var c=$("#end_div");var u=$("#end_display_status");var m=$("#channel_meta");var f=$("#group_meta");var h=TS.boot_data.team_limit_ts>0;var p="";var S=false;var T;var v;if(a.history_fetch_failed)p=TS.i18n.t('Retrieving history failed. <a onclick="TS.client.ui.doLoadScrollBackHistory(true)">Try again?</a>',"client")();else if(a.history_is_being_fetched)p=TS.i18n.t("Retrieving history...","client")();else{T=TS.utility.msgs.getOlderMsgsStatus(a);if(1==TS.qs_args.test_is_limited&&!T.more)T.is_limited=true;if(T.more){if(!(TS.model.seen_onboarding_this_session&&a.id==TS.model.welcome_model_ob.id))p='<a onclick="TS.client.ui.doLoadScrollBackHistory(true)">'+TS.i18n.t("And more...","client")()+"</a>"}else if(!TS.onboarding.shouldShowFirstWelcome())S=true}if(a.is_slackbot_im)v=35;else if(a.is_mpim||a.is_im)v=33;else if(a.is_channel||a.is_group)v=34;if(h&&T&&T.is_limited&&S&&!a.is_slackbot_im&&!t){i=true;var b;var w=$("#msg_lim_header_btn");var y=$("#msg_lim_header_btn_treatment");e=TS.experiment.getGroup("msg_lim_notifs_headers_copy");$("#slackbot_meta").addClass("hidden");r.addClass("hidden");s.addClass("hidden");m.addClass("hidden");f.addClass("hidden");$("#im_meta").addClass("hidden");$(".not_limited_copy").addClass("hidden");$(".msg_lim_header_copy").addClass("hidden");$(".msg_lim_cta_btn").addClass("hidden");if(a.is_im||a.is_mpim){if("show_question_learn_more"===e||"show_question_see_pricing_plans"===e)$(".msg_lim_dm_h1_treatment").removeClass("hidden");else $(".msg_lim_dm_h1_control").removeClass("hidden");$(".msg_lim_channel_h2").addClass("hidden");$(".msg_lim_dm_h2").removeClass("hidden")}else if(a.is_channel||a.is_group){var k=TS.templates.builders.makeChannelPrefix(a);$(".channel_name_msg_lim").html(k+a.name);if("show_question_learn_more"===e||"show_question_see_pricing_plans"===e)$(".msg_lim_channel_h1_treatment").removeClass("hidden");else $(".msg_lim_channel_h1_control").removeClass("hidden");$(".msg_lim_channel_h2").removeClass("hidden")}if("show_question_see_pricing_plans"===e){b=y.attr("href");b=TS.utility.url.setQueryStringValue(b,"ui_element",v);b=decodeURIComponent(b).substr(1);y.attr("href",b);y.data("data-clog-ui-element",v);y.removeClass("hidden")}else{b=w.attr("href");b=TS.utility.url.setQueryStringValue(b,"ui_element",v);b=decodeURIComponent(b).substr(1);w.attr("href",b);w.data("data-clog-ui-element",v);w.removeClass("hidden")}d.css("min-height","30px");d.removeClass("hidden");o.addClass("msg_lim_styling");o.removeClass("not_msg_lim_styling");l.removeClass("hidden");c.addClass("end_div_msg_lim");c.css("margin-top","0");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:v}}})}else if(S){r.removeClass("hidden");l.addClass("hidden");c.removeClass("end_div_msg_lim");d.addClass("hidden");if(i){o.removeClass("msg_lim_styling");o.addClass("not_msg_lim_styling")}c.css("margin-top","auto");if(a.is_channel||a.is_group){var A=TS.interop.datetime.toCalendarDateOrNamedDay(a.created);var C=TS.interop.datetime.toDateObject(a.created);var M;if(TS.interop.datetime.isYesterday(C)||TS.interop.datetime.isToday(C))M=$.trim(A.toLowerCase());else M=TS.i18n.t("on {date}","client")({date:A});var I=TS.members.getPotentiallyUnknownMemberById(a.creator);var E;var B;var D;var F;var P;var O;var R;if(a.is_mpim){m.addClass("hidden");f.addClass("hidden");$("#im_meta").removeClass("hidden");$("#slackbot_meta").addClass("hidden");L(a)}else if(a.is_group){m.addClass("hidden");f.removeClass("hidden");$("#im_meta").addClass("hidden");$("#slackbot_meta").addClass("hidden");E=false;B=true;$(".group_meta_name").html(TS.templates.builders.makeGroupLink(a,E,B));$(".group_meta_name").find("a").addClass("ocean_teal").bind("click",function(e){e.preventDefault();TS.menu.group.startWithGroup(e,$(e.target).data("group-id"))});if(TS.boot_data.page_needs_enterprise){var U=f.find(".group_meta_shared_info");D=f.find(".end_action_integration").parent();if(a.is_org_shared){O={model_ob:a};if(a.is_global_shared)O.all_teams=true;else{P=3;O.and_more_number=a.shared_team_ids.length-P;O.more_teams=a.shared_team_ids.slice(P);O.teams_shared_with=_.map(a.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)})}F=TS.templates.shared_channels_channel_meta_info(O);U.html(F).removeClass("hidden");D.addClass("hidden")}else{U.empty().addClass("hidden");D.removeClass("hidden")}}if(TS.boot_data.feature_i18n_channel_meta)$("#group_created_meta").html(TS.templates.channel_created({creator:{is_self:I&&I.is_self,user:I?new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(I)):false},date:M,shared:O||false,private:true}));else{if(I&&I.is_self)$("#group_creator_name").html("You");else $("#group_creator_name").html(I?TS.templates.builders.makeMemberPreviewLink(I):"Unknown");$("#group_create_date").html(M)}$("#group_meta_archived_parent").addClass("hidden");if(a.parent_group){var Q=TS.groups.getGroupById(a.parent_group);if(Q){$("#group_meta_archived_parent").removeClass("hidden");$("#group_meta_archived_parent_link").attr("href","/archives/"+Q.id).text(Q.name)}}if(a.purpose.value){$("#group_meta_purpose_container").removeClass("hidden");$("#group_meta_purpose").html(TS.utility.formatTopicOrPurpose(a.purpose.value));$("#group_meta_purpose_prompt").addClass("hidden");$(".end_action_purpose").closest("li").addClass("hidden")}else{$("#group_meta_purpose_container").addClass("hidden");$(".end_action_purpose").closest("li").removeClass("hidden")}}else if(a.is_channel){m.removeClass("hidden");f.addClass("hidden");$("#im_meta").addClass("hidden");$("#slackbot_meta").addClass("hidden");E=false;B=true;$(".channel_meta_name").html(TS.templates.builders.makeChannelLink(a,E,B));$(".channel_meta_name").find("a").bind("click",function(e){e.preventDefault();TS.menu.channel.startWithChannel(e,$(e.target).data("channel-id"))});if(TS.boot_data.page_needs_enterprise){var H=m.find(".channel_meta_shared_info");D=m.find(".end_action_integration").parent();if(a.is_org_shared){O={model_ob:a};P=3;if(a.is_global_shared)O.all_teams=true;else{O.and_more_number=a.shared_team_ids.length-P;O.more_teams=a.shared_team_ids.slice(P);O.teams_shared_with=_.map(a.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)})}F=TS.templates.shared_channels_channel_meta_info(O);H.html(F).removeClass("hidden");D.addClass("hidden")}else{H.empty().addClass("hidden");D.removeClass("hidden")}}if(TS.boot_data.feature_i18n_channel_meta)$("#channel_created_meta").html(TS.templates.channel_created({creator:{is_self:I&&I.is_self,user:I?new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(I)):false},date:M,shared:O||false}));else{if(I&&I.is_self)$("#channel_creator_name").html("You");else $("#channel_creator_name").html(I?TS.templates.builders.makeMemberPreviewLink(I):"Unknown");$("#channel_create_date").html(M)}if(a.purpose.value){$("#channel_meta_purpose_container").removeClass("hidden");$("#channel_meta_purpose").html(TS.utility.formatTopicOrPurpose(a.purpose.value));$("#channel_meta_purpose_prompt").addClass("hidden");$(".end_action_purpose").closest("li").addClass("hidden")}else{$("#channel_meta_purpose_container").addClass("hidden");$(".end_action_purpose").closest("li").removeClass("hidden")}}$(".end_action_purpose").off("click").on("click.show_purpose_dialog",function(){TS.ui.purpose_dialog.start(a.name,a)});if(TS.apps.permissions.areXoxaAppsInstalled())$(".end_action_integration").off("click").on("click",function(e){e.preventDefault();TS.ui.apps_browser.startAddApps()});else $(".end_action_integration").attr("href","/apps/new?channel="+a.id);$(".end_action_invite").off("click").on("click.show_invite_dialog",function(){TS.ui.channel_invite_modal.startInviteToChannelModal(a.id)});x()}else if(a.is_slackbot_im){m.addClass("hidden");f.addClass("hidden");$("#im_meta").addClass("hidden");$("#slackbot_meta").removeClass("hidden");R=TS.members.getPotentiallyUnknownMemberById(a.user);var N=TS.model.team.prefs.compliance_export_start||0;var G=N&&!!TS.model.team.prefs.compliance_export_start;$("#slackbot_meta").html(TS.templates.slackbot_badge({member:R,compliance_exports_enabled_for_team:G,compliance_export_start:N}))}else{m.addClass("hidden");f.addClass("hidden");$("#im_meta").removeClass("hidden");$("#slackbot_meta").addClass("hidden");R=TS.members.getPotentiallyUnknownMemberById(a.user);if(R){g.add(R.id);$("#im_meta").html(TS.templates.dm_badge({member:R,model_ob:a,compliance_exports_enabled_for_team:!!TS.model.team.prefs.compliance_export_start,compliance_export_start:TS.model.team.prefs.compliance_export_start||0,show_bot_about_link:TS.apps.isAppSpaceEnabled()&&R.is_bot}));$("[data-bot_about_link]").on("click",function(){TS.client.ui.app_space.toggleView("about");TS.clog.track("APP_SPACE_ABOUT_CLICKED",{about_clicked_from_bot_dm:true})})}}}else{r.addClass("hidden");l.addClass("hidden");c.removeClass("end_div_msg_lim");d.addClass("hidden")}if(h&&T&&T.is_limited&&a.is_slackbot_im&&t){i=true;var j=!!window.navigator.userAgent.match("Trident");e=TS.experiment.getGroup("msg_lim_notifs_headers_copy");if(j){d.css("min-height","55px");d.removeClass("hidden")}if("show_question_learn_more"===e)$("#slackbot_msg_lim_learn_more").removeClass("hidden");else if("show_question_see_pricing_plans"===e)$("#slackbot_msg_lim_see_pricing_plans").removeClass("hidden");else $("#slackbot_msg_lim_control").removeClass("hidden");$(".msg_lim_copy").removeClass("hidden");$(".not_limited_copy").addClass("hidden");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:v}}})}else{$(".msg_lim_copy").addClass("hidden");c.removeClass("wave");$(".not_limited_copy").removeClass("hidden")}if(p){u.removeClass("hidden");u.html(p)}else u.addClass("hidden")},clearBlueBarTimer:function e(){var i=TS.shared.getActiveModelOb();if(i)if(i.is_slackbot_im)t=true;else t=false;if(!d)return;if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.clearBlueBarTimer: clearing timer of "+d);clearTimeout(d);d=null},maybeClearNewMsgsTimer:function e(t,i){if(!l)return;var n=TS.shared.getActiveModelOb();if(!i&&t&&t.id!==n.id)return;if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.maybeClearNewMsgsTimer: clearing _onNewMsgsTimer of "+l);clearTimeout(l);l=null},maybeStartNewMsgsTimer:function e(t){if(l){if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.maybeClearNewMsgsTimer: NOT clearing msgs timer because one already exists of "+l);return}var i=TS.shared.getActiveModelOb();if(t&&t.id!==i.id){if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.maybeClearNewMsgsTimer: NOT starting a new timer because related_model_ob "+t.id+" !== "+i.id);return}if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.maybeClearNewMsgsTimer: starting _onNewMsgsTimer while on "+i.id);TS.client.msg_pane.startNewMsgsTimer()},startNewMsgsTimer:function e(){if(l){if(TS.has_pri[z])TS.log(z,"startNewMsgsTimer: clearing _new_msgs_tim of "+l);clearTimeout(l);l=null}l=setTimeout(I,1500);if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.startNewMsgsTimer: set timer ID = "+l+" while on "+TS.shared.getActiveModelOb().id)},showNewMsgsBar:function e(){if(TS.client.activeChannelIsHidden())return;var t=TS.shared.getActiveModelOb();if(t&&TS.notifs.isCorGMuted(t.id)){if(TS.has_pri[z])TS.log(z,"insertUnreadDivider(): "+t.id+" is muted - exiting");return}if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.showNewMsgsBar");C();$("#messages_unread_status").removeClass(h);TS.client.msg_pane.new_msgs_bar_showing=true;TS.client.msg_pane.topMessagesBannerShown()},hideNewMsgsBar:function e(t){if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.hideNewMsgsBar");TS.client.msg_pane.clearBlueBarTimer();if(!t&&TS.model.prefs.mark_msgs_read_immediately){var i=TS.shared.getActiveModelOb();if(i&&(i._temp_unread_cnt||i.unread_cnt)){if(TS.has_pri[z])TS.log(z,"TS.client.msg_pane.hideNewMsgsBar: NOT hiding because read state pref is mark_msgs_read_immediately, and the model still has some unreads. _temp_unread_cnt = "+i._temp_unread_cnt+", unread_cnt = "+i.unread_cnt);TS.client.msg_pane.maybeStartNewMsgsTimer(i);return}}$("#messages_unread_status").addClass(h);TS.client.msg_pane.new_msgs_bar_showing=false;TS.client.msg_pane.topMessagesBannerHidden()},checkUnreads:function e(){if(TS.useReactMessages())return;if(!TS.client.ui.isUserAttentionOnChat()||TS.model.archive_view_is_showing||TS.client.activeChannelIsHidden())return;var t=TS.shared.getActiveModelOb();if(!t)return;if(!TS.model.prefs)return;if(!t.unread_cnt){if(o&&o.length)TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed);C();return}if(TS.client.msg_pane.dont_check_unreads_til_switch){C();return}var i;var n=true;var a=t.unreads;var r=false;var s=TS.notifs.isCorGMuted(t.id);var l=TS.model.prefs.mark_msgs_read_immediately;if(TS.boot_data.feature_scrollback_half_measures&&l&&TS.model.prefs.start_scroll_at_oldest&&!t.is_limited)if(TS.shared.lastReadIsOlderThanCurrentHistory(t)){l=false;N(t)}if(l)n=true;else if(s)n=true;else if(r)for(var d=0;d<a.length;d+=1){i=a[d];if(TS.model.client.reads.indexOf(i)>-1);else if(TS.client.ui.isMsgInView(i))TS.model.client.reads.push(i);else{var c=TS.utility.msgs.getMsg(i,t.msgs);if(!c||TS.utility.msgs.isMsgHidden(c))TS.model.client.reads.push(i);else n=false}}else if(TS.shared.getOldestUnreadTsForId(t.id)){var _=TS.shared.getOldestUnreadTsForId(t.id);n=TS.client.ui.isMsgInView(_);if(TS.has_pri[W])TS.log(W,"checkUnreads "+t.id+": oldest_unread_ts = "+_+", isMsgInView (all_unreads_are_seen) = "+n)}else if(TS.has_pri[W])TS.log(W,"checkUnreads "+t.id+": no oldest_unread_ts?");if(!t.is_im&&!t.is_mpim){var u="checkUnreads "+t.id+": NOT MARKING most recent as read because ";if(!t._history_fetched_since_last_connect){if(TS.has_pri[W])TS.log(W,u+"!_history_fetched_since_last_connect.");n=false}else if(TS.shared.didDeferMessageHistoryById(t.id)){if(TS.has_pri[W])TS.log(W,u+"did_defer_initial_msg_history.");n=false}else if(t.history_is_being_fetched){if(TS.has_pri[W])TS.log(W,u+"history_is_being_fetched.");n=false}}if(TS.has_pri[W])TS.log(W,"checkUnreads "+t.id+": all_unreads_are_seen = "+n+", last_read_msg_div = "+(o&&o.length)+", last_read = "+t.last_read);if(n&&(o&&o.length||!parseInt(t.last_read,10)||l||s))if(!l){if(TS.has_pri[W])TS.log(W,"checkUnreads "+t.id+": All unreads are seen. Marking as viewed.");TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed)}else{if(TS.has_pri[W])TS.log(W,"Maybe marking most recent read msg in active because viewed: "+t.id);if(t.history_is_being_fetched){if(TS.has_pri[W])TS.log(W,"NOT MARKING most recent as read because history being fetched")}else if(TS.client.msg_pane.new_msgs_bar_showing){if(TS.has_pri[W])TS.log(W,"NOT MARKING most recent as read because new msgs bar is showing.");if(l){if(!t._mark_most_recent_read_timer){if(TS.has_pri[W])TS.log(W,"Setting a timer to mark "+t.id+" as read.");t._mark_most_recent_read_timer=window.setTimeout(function(){t._mark_most_recent_read_timer=null;A(t);t=null},500)}TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed);TS.client.msg_pane.maybeStartNewMsgsTimer(t)}}else{if(TS.has_pri[W])TS.log(W,"Marking most recent read msg in active because viewed: "+t.id);TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed)}}C()},getCanonicalDivForMsg:function e(t){if(TS.client.ui.$msgs_div.find("ts-conversation").length){var i=TS.client.ui.$msgs_div.find('ts-message[data-ts="'+t+'"]').not("ts-relatives ts-message");if(1==i.length)return i;return i.filter(":not(ts-conversation) > ts-message")}return TS.client.ui.$msgs_div.find("#"+TS.templates.makeMsgDomId(t))},getDivsForMsg:function e(t){if(TS.client.ui.$msgs_div.find("ts-conversation").length)return TS.client.ui.$msgs_div.find('ts-message[data-ts="'+t+'"]');return TS.client.msg_pane.getCanonicalDivForMsg(t)},getDivForArchiveMsg:function e(t){return TS.client.archives.$archives_msgs_div.find("#"+TS.templates.makeMsgDomId(t))},topMessagesBannerShown:function e(){if(c.hasClass("has_top_messages_banner"))return;c.toggleClass("has_top_messages_banner",v().length>0)},topMessagesBannerHidden:function e(){if(!c.hasClass("has_top_messages_banner"))return;c.toggleClass("has_top_messages_banner",v().length>0)},cleanMsgDiv:function e(){},addMaybeClick:function e(t,i){if(!t)return;i=_.isFunction(i)?i:_.noop;f[t]=i},maybeClick:function e(t){var i=$(t).data("maybe-click");if(f[i])f[i]()},areCallsEnabled:function e(){return TS.utility.calls.isEnabled()},maybeSetupCalls:function e(t,i){var n;var a;if(!i)i=TS.shared.getActiveModelOb();if(i&&TS.shared.isModelObShared(i)&&"Slack"===TS.model.team.prefs.calling_app_name)return;if(!TS.model.team.prefs.allow_calls)return;if(TS.model.active_im_id){if(t&&!t.is_bot&&!t.is_slackbot&&!t.is_self&&TS.client.msg_pane.areCallsEnabled()){n={is_dm:true,id:TS.model.active_im_id};a={dm_member:t,name:TS.members.getPrefCompliantMemberName(t,false,true)};O(n,a)}}else if(TS.model.active_channel_id||TS.model.active_group_id){i=TS.shared.getActiveModelOb();var r=!TS.channels.isChannelRequired(i)||TS.permissions.members.canPostInChannel(TS.model.user);if(TS.client.msg_pane.areCallsEnabled()&&r){if(TS.model.active_channel_id)n={id:TS.model.active_channel_id};else n={id:TS.model.active_group_id};O(n)}}else if(TS.model.active_mpim_id)if(TS.client.msg_pane.areCallsEnabled()){a={names:TS.mpims.getDisplayName(i)};n={is_dm:false,is_mpdm:true,id:TS.model.active_mpim_id};O(n,a)}},setUnreadPoint:function e(t){var i=TS.shared.getActiveModelOb();var n=TS.utility.msgs.getMarkMsgTSForUnreadPoint(t,i.msgs,i);if(!n)return false;if(TS.model.active_channel_id)TS.channels.markReadMsg(TS.model.active_channel_id,n,TS.model.marked_reasons.back);else if(TS.model.active_im_id)TS.ims.markReadMsg(TS.model.active_im_id,n,TS.model.marked_reasons.back);else if(TS.model.active_group_id)TS.groups.markReadMsg(TS.model.active_group_id,n,TS.model.marked_reasons.back);else if(TS.model.active_mpim_id)TS.mpims.markReadMsg(TS.model.active_mpim_id,n,TS.model.marked_reasons.back);else return false;TS.model.client.reads.length=0;TS.client.markLastReadsWithAPI();if(TS.has_pri[z])TS.log(z,"setUnreadPoint for "+i.id+": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()");TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();if(TS.has_pri[W])TS.log(W,"setUnreadPoint for "+i.id+" - marking dont_check_unreads_til_switch = true.");TS.client.msg_pane.dont_check_unreads_til_switch=true;TS.utility.msgs.maybeClearPrevLastRead();TS.client.msg_pane.insertUnreadDivider();return true},maybeResetUnreadsCheck:function e(t){if(!TS.client.msg_pane.dont_check_unreads_til_switch)return;var i=TS.shared.getActiveModelOb();if(t&&i&&i.id==t.id){if(TS.has_pri[G])TS.log(G,"resetting dont_check_unreads_til_switch, so unread / banner fade work can be re-done on current model_ob.");TS.client.msg_pane.dont_check_unreads_til_switch=false}},maybeInsertUnreadDividerAndNewMsgsBar:function e(t){if(!t)return;var i=TS.shared.getActiveModelOb();if(!i||t.id!==i.id)return;if(TS.has_pri[j])TS.log(j,"channelUnreadCountChanged: "+t.id+" - unread count changed for active model_ob of "+i.id);if(!t.unread_cnt){if(TS.has_pri[j])TS.log(j,"channelUnreadCountChanged: "+t.id+" - unread_cnt is 0. Maybe starting new msgs timer.");TS.client.msg_pane.startNewMsgsTimer();return}if(!TS.model.ui.is_window_focused){if(TS.has_pri[j])TS.log(j,"channelUnreadCountChanged: "+t.id+" - window is not in focus, so removing and re-inserting unread divider so it can be updated.");TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();TS.utility.msgs.maybeClearPrevLastRead()}else if(TS.model.prefs&&!TS.model.prefs.mark_msgs_read_immediately&&TS.client.ui.$msgs_unread_divider&&!TS.client.ui.isUnreadDividerInView()){if(TS.has_pri[j])TS.log(j,"channelUnreadCountChanged: "+t.id+" - window is in focus, BUT, unread divider is not in view - clearing existing state, will show in new position.");TS.client.msg_pane.clearUnreadDivider();TS.utility.msgs.maybeClearPrevLastRead()}TS.client.msg_pane.insertUnreadDivider();if(TS.model.ui.is_window_focused){if(TS.has_pri[j])TS.log(j,"channelUnreadCountChanged: "+t.id+" - NOT showing new msgs bar because window is in focus.")}else{if(TS.has_pri[j])TS.log(j,"channelUnreadCountChanged: "+t.id+" - showing new msgs bar.");TS.client.msg_pane.showNewMsgsBar()}},maybeResetAndAutoScroll:function e(t){},setCallButtonState:function e(t){var i=TS.utility.calls.isMultiPartyEnabled();if(TS.utility.calls.isEnabled()&&"Slack"!==TS.model.team.prefs.calling_app_name)i=true;var n=true;if(!i&&TS.utility.calls.isCurrentContextMultiParty())n=false;$(".call_icon").toggleClass("call_window_offline",!(t&&n))},maybeRenderHighlightedMessages:function e(t){var i=TS.shared.getActiveModelOb();if(t[i.id])_.each(t[i.id],function(e,t){var n=TS.utility.msgs.getMsgByProp("ts",t,i.msgs);if(!n)return;if(e.show_recap||e.is_leaving_feedback||e.left_feedback)TS.utility.msgs.replaceMsg(i,n,false,true)})},maybeRenderHighlightedMessageFeedback:function e(t){var i=TS.shared.getActiveModelOb();if(!i)return;if(t[i.id])_.each(t[i.id],function(e,t){var n=TS.utility.msgs.getMsgByProp("ts",t,i.msgs);if(!n)return;if("positive"===e.feedback)TS.client.ui.$msgs_div.find('ts-message[data-ts="'+n.ts+'"] .sli_briefing__feedback_controls').addClass("gave_positive_feedback");else if(e.is_leaving_feedback||e.left_feedback)TS.utility.msgs.replaceMsg(i,n,false,true)})}});var e;var t=false;var i=false;var n=0;var a=false;var r;var s;var o;var l;var d;var c=$("#messages_container");var u=$("#footer");var m=$("#center_workspace_container");var f={};var h="no_pointer_events no_opacity";var g;var p=false;var S="";var T=0;function v(){return c.find(".messages_banner:not(.messages_banner_bottom)").filter(":visible").filter(function(){var e=$(this);return!("hidden"===e.css("visibility")||e.hasClass("no_opacity"))})}var b=function e(){TS.client.msg_pane.updateEndMarker()};var w=function e(){TS.client.msg_pane.updateEndMarker()};var y=function e(t){};var k=function e(i){TS.metrics.mark("_rebuildMsgs");if(TS.useReactMessages())return;var n=TS.shared.getActiveModelOb();if(n)if(n.is_slackbot_im)t=true;else t=false;if(!n)return;if(TS.utility.enableFeatureForUser(10))TS.statsd.count("client_msgs_rebuild");TS.client.msg_pane.is_rebuilding=true;var a;if(TS.msg_edit.editing&&TS.msg_edit.editing_in_msg_pane)a=TS.msg_edit.pauseEditing();if(TS.has_pri[K])TS.log(K,"rebuilding msgs for "+TS.model.active_cid);TS.model.ui.msgs_are_auto_scrolling=false;if(TS.has_pri[z])TS.log(z,"rebuildMsgs(), "+n.id+", reason: "+(i||"not specified"));if(TS.has_pri[z])TS.log(z,"rebuildMsgs(), "+n.id+": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()");TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();var o;var l=-1;var d="";TS.client.msg_pane.last_render_time=new Date;TS.client.msg_pane.last_rendered_msg=null;TS.client.msg_pane.last_in_stream_msg=null;l=n.scroll_top;o=n.msgs;var c;var u;var m;var f;var h=[];var g;if(TS.boot_data.feature_initial_scroll_position&&n.id===s)g=TS.client.ui.areMsgsScrolledToBottom(0);if(!TS.boot_data.feature_initial_scroll_position)TS.client.ui.$msgs_div.empty();if(!o)d="-";else{if(!o.length)d="";var p=[];var S=0;var T=_.reject(o,TS.utility.msgs.isMsgHidden);for(var v=T.length-1;v>-1;v-=1){if(!c||!TS.utility.msgs.isMsgHidden(c))u=c;c=T[v];if(TS.utility.msgs.isMsgHidden(c))continue;var b=TS.utility.msgs.msgRollUpWorker(v,c,T,p);if("continue"===b){c=u;continue}else if("swap"===b){c=p[0];p.length=0}S+=1;var w=U(c,u);if(w){if(u)d+="</div></div>";d+='<div class="day_container">';d+=TS.templates.messages_day_divider({ts:c.ts});d+='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(c.ts)+'" data-ts="'+c.ts+'">'}if(TS.boot_data.feature_message_replies_inline&&(TS.utility.msgs.msgHasReplies(c)||TS.ui.thread.isMessageBeingConvertedToThread(n.id,c)))try{f=TS.ui.thread.makeInlineThread(n.id,c.ts);if(f){h.push(f);d+=TS.ui.thread.buildThreadHTML(f,{inline:true,expanded:TS.ui.thread.isThreadExpanded(n.id,c.ts)})}}catch(e){if(!e.message)e.message="";TS.warn("Problem building inline thread "+c.ts+": "+JSON.stringify(e.message))}else d+=TS.templates.builders.msgs.buildHTML({msg:c,model_ob:n,prev_msg:u,container_id:"msgs_div",enable_slack_action_links:true});if(0===v)d+="</div></div>";if(!c.is_pending){TS.client.msg_pane.last_in_stream_msg=c;if(!TS.utility.msgs.isMsgHidden(c))TS.client.msg_pane.last_rendered_msg=c}}var y=20;var k=true;if(TS.boot_data.page_needs_enterprise)if(S&&S<y&&TS.has_pri[K])TS.log(K,"rebuildMsgs(): Enterprise case: Loading more history, message "+S+" < min_count of "+y);if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): "+o.length+" msgs, of which "+S+" were counted as visible.");if(!TS.isPartiallyBooted()&&o.length&&S<y&&k)if(r&&s==n.id);else{r=true;var A=function e(){r=false;TS.channels.switched_sig.remove(e);TS.groups.switched_sig.remove(e);TS.ims.switched_sig.remove(e);TS.mpims.switched_sig.remove(e)};TS.channels.switched_sig.addOnce(A);TS.groups.switched_sig.addOnce(A);TS.ims.switched_sig.addOnce(A);TS.mpims.switched_sig.addOnce(A);if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): loading more history because count is < "+y);if(TS.model.prefs.start_scroll_at_oldest&&!n.is_im){if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): loading scrollback, AND, resetting _has_auto_scrolled so we scroll to oldest again when more history loads.");m=true}TS.client.ui.doLoadScrollBackHistory(true)}s=n.id}TS.client.ui.$msgs_div.html(d);if(TS.boot_data.feature_message_replies_inline)_.forEach(h,function(e){if(!TS.ui.thread.isThreadExpanded(n.id,e.root_msg.ts))return;var t=TS.client.ui.$msgs_div.find('ts-thread[data-ts="'+e.ts+'"]');TS.ui.thread.renderReplyInput(t,e)});TS.utility.makeSureAllLinksHaveTargets(TS.client.ui.$msgs_div);TS.client.msg_pane.assignLastReadMsgDiv(n);TS.client.msg_pane.insertUnreadDivider();if(!TS.isPartiallyBooted())E();TS.client.msg_pane.updateEndMarker();TS.attachment_actions.select.decorateNewElements();if(TS.boot_data.feature_initial_scroll_position){if(g)TS.client.ui.instaScrollMsgsToBottom(false)}else{TS.client.ui.instaScrollMsgsToBottom(false);if(-1==l||void 0===l||TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest&&n.unread_cnt){var C=TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest;if(C&&n.unread_cnt&&TS.client.msg_pane.new_msgs_bar_showing&&!n._has_auto_scrolled){if(!TS.model.ui.is_window_focused){if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): NOT resetting and applying auto-scroll on "+n.id+", because window is not in focus.");return}if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): resetting has_auto_scrolled on "+n.id+" and forcing first unread to scroll into view, because new msgs bar is still up and unread_cnt = "+n.unread_cnt);l=-1;M(n)}if(!n._has_auto_scrolled||!TS.client.ui.isUserAttentionOnChat()||TS.client.activeChannelIsHidden()){if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): insta-scrolling to bottom(false) and then first unread into view because of last_scroll_top = -1 or undefined (actual: "+l+") OR (pref to scroll AND unread), where unread_cnt = "+n.unread_cnt);TS.client.ui.instaScrollMsgsToBottom(false);if(TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest)TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView(function(){});if(!n.is_im&&!m)(function(e){TS.utility.rAF(function(){var t=TS.shared.getActiveModelOb();if(!t||t.id!==e.id)return;if(TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest){TS.client.ui.instaScrollMsgsToBottom(false);TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView(function(){})}if(e.msgs.length){if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): marking has_auto_scrolled because !is_im and has msgs");e._has_auto_scrolled=true}else{if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): NOT marking has_auto_scrolled because no msgs yet");e._has_auto_scrolled=false}e=null})})(n)}}else{if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): insta-scrolling to last_scroll_top of "+l);TS.client.ui.instaScrollMsgsToPosition(l,false)}}if(!TS.boot_data.feature_initial_scroll_position&&m&&n._has_auto_scrolled){if(TS.has_pri[K])TS.log(K,"rebuildMsgs(): resetting scroll state due to pending history call");l=-1;M(n)}if(a)TS.msg_edit.resumeEditing(a);d=null;o=null;n=null;TS.client.msg_pane.is_rebuilding=false;TS.client.msg_pane.did_rebuild_msgs_sig.dispatch();if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.measure("client_msg_pane_rebuild_msgs","_rebuildMsgs")};var A=function e(t){if(!t)return;if(!t._temp_unread_cnt&&!t._temp_last_read)return;if(TS.has_pri[G])TS.log(G,"_clearTempReadState: Nulling _temp_unread_cnt and _temp_last_read on "+t.id);t._temp_unread_cnt=null;t._temp_last_read=null};var C=function e(){if(!TS.client.ui.$msgs_unread_divider)return;var t=TS.shared.getActiveModelOb();TS.utility.msgs.maybeCalcUnreadCnts(t);if(TS.has_pri[z])TS.log(z,"_updateNewMsgsDisplay: "+t.id+", unread_cnt = "+t.unread_cnt);y(t);var i=t._temp_unread_cnt||t.unread_cnt;var n=t._temp_last_read||t.last_read;if(i){var a=TS.utility.msgs.getOldestValidTs(t);var r=i;var s="";if(n<a&&r>10){s="+";r=10*Math.floor(r/10)}var o;var l=TS.client.ui.$msgs_unread_divider.data("last_read_ts");if(!l){if(TS.has_pri[z])TS.log(z,"_updateNewMsgsDisplay: "+t.id+" - No last_read_ts - no unread divider? Trying _prev_last_read ("+t._prev_last_read+") || model_ob.last_read ("+t.last_read+")");l=t._prev_last_read||t.last_read;if(!l){if(TS.has_pri[z])TS.log(z,"_updateNewMsgsDisplay: "+t.id+" - Still no last_read_ts - exiting.");return}}var d=TS.utility.msgs.getDisplayedMsgAfterTS(l,t.msgs);if(d)o=d.ts;else o=l;var c={shortenMonth:false,excludeYear:true};var _=TS.interop.datetime.toCalendarDateOrNamedDay(o,c);var u=TS.interop.datetime.toDateObject(o);var m;var f;if(!TS.interop.datetime.isToday(u))if(TS.interop.datetime.isYesterday(u))m=TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time} {date_string}","client");else m=TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time} on {date_string}","client");else m=TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time}","client");f=m({unread_message_count:r,plus:s,time:TS.interop.datetime.toTime(o,{do24hrTime:TS.utility.date.do24hrTime()}),date_string:_});$("#new_msg_info").html(f);TS.ui.a11y.saveUnreadCountMessage(t,f)}else if(TS.client.msg_pane.new_msgs_bar_showing){if(TS.has_pri[z])TS.log(z,"_updateNewMsgsDisplay: "+t.id+", unread_cnt = "+i+" - maybe starting new msgs timer.");TS.client.msg_pane.maybeStartNewMsgsTimer()}};var M=function e(t){if(!t)return;if(!TS.model.prefs||!TS.model.prefs.start_scroll_at_oldest)return;t._has_auto_scrolled=false;TS.model.ui.msgs_are_auto_scrolling=false;t.scroll_top=-1};var I=function e(){var t=TS.shared.getActiveModelOb();if(!t)return;if(TS.has_pri[z])TS.log(z,"_onNewMsgsTimer: current model is "+t.id+", unread_cnt = "+t.unread_cnt+", timer ID = "+l);l=null;if(!t.unread_cnt)if(TS.model.prefs.mark_msgs_read_immediately&&!TS.model.prefs.start_scroll_at_oldest&&!d){var i=1500;d=setTimeout(function(){if(TS.has_pri[z])TS.log(z,"_onNewMsgsTimer: calling TS.client.msg_pane.hideNewMsgsBar() after "+i+" msec");d=null;TS.client.msg_pane.hideNewMsgsBar();$(".unread_divider").addClass("no_unreads")},i)}else{if(t.history_is_being_fetched){if(TS.has_pri[z])TS.log(z,"_onNewMsgsTimer: not hiding new msgs bar because history is being fetched for current model_ob ("+t.id+")");return TS.client.msg_pane.startNewMsgsTimer()}if(TS.has_pri[z])TS.log(z,"_onNewMsgsTimer: calling TS.client.msg_pane.hideNewMsgsBar() immediately");TS.client.msg_pane.hideNewMsgsBar();$(".unread_divider").addClass("no_unreads")}else{if(TS.model.prefs.mark_msgs_read_immediately&&!t.history_is_being_fetched){if(TS.has_pri[z])TS.log(z,"_onNewMsgsTimer: checking unreads (with intent to mark as read) and exiting, because not fetching history and unread_cnt = "+t.unread_cnt);TS.client.msg_pane.checkUnreads();return}if(TS.has_pri[z])TS.log(z,"_onNewMsgsTimer: re-starting new msgs timer because unread_cnt = "+t.unread_cnt);TS.client.msg_pane.startNewMsgsTimer()}};var x=function e(){var t=TS.shared.getActiveModelOb();if(!t){TS.error("updateEndMarker no channel, no im, no group");return}var i=$(".end_action_slack_invite");var n=i.parent();var a=$(".end_action_invite").parent();if(t.is_general){var r;if("normal"===TS.model.team.prefs.auth_mode&&TS.model.team.email_domain){var s=location.hostname.replace(/[^.]*/,_.escape(TS.model.team.domain));r=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('<i class="ts_icon ts_icon_user ts_icon_inherit"></i> Send <a class="underline ts_tip ts_tip_top" href="https://{hostname}/signup">this link<span class="copied_ok ts_tip_tip hidden">Copied!</span></a> to invite people to your workspace',"client")({hostname:s}):TS.i18n.t('<i class="ts_icon ts_icon_user ts_icon_inherit"></i> Send <a class="underline ts_tip ts_tip_top" href="https://{hostname}/signup">this link<span class="copied_ok ts_tip_tip hidden">Copied!</span></a> to your team to invite them',"client")({hostname:s});if(TS.clipboard.canWriteText())i.off("click").html(r).find("a").on("click",function(e){e.preventDefault();var t;var i=$(".copied_ok");var n="https://"+s+"/signup";TS.clipboard.writeText(n);i.removeClass("hidden");if(t)window.clearTimeout(t);t=window.setTimeout(function(){i.addClass("hidden")},2e3)})}else if(TS.model.user.is_admin){r=TS.i18n.t('<a><i class="ts_icon ts_icon_user ts_icon_inherit"></i> Invite people to <strong>{teamname}</strong></a>',"client")({teamname:_.escape(TS.model.team.name)});i.off("click").on("click.show_admin_invite_modal",TS.ui.admin_invites.start).html(r)}n.toggleClass("hidden",!r);a.toggleClass("hidden",!!r)}else{n.addClass("hidden");a.removeClass("hidden")}};var E=function e(){if(n>0||!!TS.model.team.plan||TS.onboarding.inOnboarding())return;var t;var i;var a;var r=false;var s=$("#notification_banner");var o=Math.floor(Date.now()/1e3);var l=TS.model.team.prefs.limit_reached_ts/1e6;var d=$("#msg_lim_banner_btn_learn").attr("href");n+=1;var c=TS.model.team.approaching_msg_limit;var _=TS.model.prefs.growth_msg_limit_approaching_cta_count>0;if(c&&!_){TS.client.ui.$msgs_div.addClass("hide_day_dividers_for_notif_banner");$("#notification_banner img").attr({src:"/img/emoji_2016_06_08/apple/231b.png",alt:"sand hourglass emoji"});t=63;d=d+"&ui_step="+t;$("#msg_lim_banner_btn_learn").attr("href",d);$("#notification_banner h1").addClass("hidden");$("#msg_limit_h1_approaching").removeClass("hidden");$("#msg_limit_h2_approaching").removeClass("hidden");s.removeClass("hidden");r=true}else if(l>0){var u=TS.model.prefs.growth_msg_limit_reached_cta_count>0;var m=TS.model.prefs.growth_msg_limit_long_reached_cta_count>0;var f=TS.interop.datetime.addDays(l,7);var h=o>=l&&o<=f;if(h&&!u){TS.client.ui.$msgs_div.addClass("hide_day_dividers_for_notif_banner");$("#notification_banner img").attr({src:"/img/emoji_2016_06_08/apple/1f3c1.png",alt:"chequered flag emoji"});t=64;d=d+"&ui_step="+t;$("#msg_lim_banner_btn_learn").attr("href",d);$("#notification_banner h1").addClass("hidden");$("#msg_limit_h1_reached").removeClass("hidden");$("#msg_limit_h2_reached").removeClass("hidden");s.removeClass("hidden");r=true}else if(!m){var g=false;var p=false;var S=false;var T=TS.model.prefs.growth_msg_limit_reached_cta_last_ts;var v=TS.interop.datetime.addDays(T,30);var b=TS.interop.datetime.addDays(l,30);var w=TS.interop.datetime.addDays(l,37);if(b>0&&w>0)g=b<=o&&o<=w;else if(v>0)S=o>=v;p=S||g;if(p){TS.client.ui.$msgs_div.addClass("hide_day_dividers_for_notif_banner");$("#notification_banner img").attr({src:"/img/emoji_2016_06_08/apple/1f680.png",alt:"rocket emoji"});t=65;d=d+"&ui_step="+t;$("#msg_lim_banner_btn_learn").attr("href",d);$("#notification_banner h1").addClass("hidden");$("#msg_limit_h1_long_reached").removeClass("hidden");$("#msg_limit_h2_long_reached").removeClass("hidden");i=TS.model.team.messages_count-1e4;if(i>9&&i<100)i=10*Math.floor(i/10);else if(i>100&&i<=999999){i=100*Math.floor(i/100);i=TS.utility.numberWithCommas(i)}else if(i>999999)i=TS.utility.number.formatNumberWithAbbreviation(i,{precision:3});$(".num_msgs_beyond_limit").html(i);s.removeClass("hidden");r=true}}}if(r){TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:t,action:"impression"}}});a={63:{growth_msg_limit_approaching_cta_ts:o,growth_msg_limit_approaching_cta_count:TS.model.prefs.growth_msg_limit_approaching_cta_count+1},64:{growth_msg_limit_reached_cta_last_ts:o,growth_msg_limit_reached_cta_count:TS.model.prefs.growth_msg_limit_reached_cta_count+1},65:{growth_msg_limit_long_reached_cta_last_ts:o,growth_msg_limit_long_reached_cta_count:TS.model.prefs.growth_msg_limit_long_reached_cta_count+1}};$("#msg_lim_banner_btn_learn, #msg_lim_banner_btn_skip").click(function(e){TS.client.ui.$msgs_div.removeClass("hide_day_dividers_for_notif_banner");s.addClass("hidden");var i;var n;var r=e.toElement.id;if("msg_lim_banner_btn_learn"===r){i="click";n="pricing_button"}else if("msg_lim_banner_btn_skip"===r){i="close";n="skip_for_now_button"}TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:t,action:i,ui_element:n}}});TS.prefs.setMultiPrefsByAPI(a[t])})}};var B=false;var D=function e(t){B=t.is_loading;F()};var F=function e(){P();if(TS.model.team.prefs.allow_calls)TS.client.msg_pane.displayTitle()};var P=function e(){$(".channel_calls_button").remove()};var O=function e(t,i){i=i||{};var n=TS.shared.getActiveModelOb();if(!n)return;if(!TS.permissions.members.canPostInChannel(n))return;var a=TS.utility.calls.isCallWindowReady()||!TS.utility.calls.platformHasCallsCode();var r=TS.utility.calls.isMultiPartyEnabled();if(TS.utility.calls.isEnabled()&&"Slack"!==TS.model.team.prefs.calling_app_name)r=true;var s=n.is_channel&&!n.is_member;var o=true;if(!r&&TS.utility.calls.isCurrentContextMultiParty())o=false;var l=a&&o&&!s;var d="Slack"!==TS.model.team.prefs.calling_app_name;var c=["call_icon"];if(!l)c.push("call_window_offline");if(i.is_dm_user_offline)c.push("away");if(t.is_dm)if(i.hasOwnProperty("dm_member"))c.push(TS.templates.makeMemberDomIdById(i.dm_member.id));if(TS.client.msg_pane.areCallsEnabled()){var _=$("#channel_calls_container");var u;var m;if(s)u=TS.i18n.t("Join this channel to start a call","client")();else if(o)if(t.is_dm||t.is_mpdm)if(i.is_dm_user_offline)u=TS.i18n.t("{name} is currently offline and unreachable","client")({name:i.name});else{if(t.is_mpdm)m=i.names;else m=i.name;if(d)u=TS.i18n.t("Call {call_name} with {calling_app_name}","client")({call_name:m,calling_app_name:TS.model.team.prefs.calling_app_name});else u=TS.i18n.t("Call {call_name}","client")({call_name:m})}else if(d)u=TS.i18n.t("Start a call with {calling_app_name}","client")({calling_app_name:TS.model.team.prefs.calling_app_name});else u=TS.i18n.t("Start a call","client")();else if(t.is_mpdm)u=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Only paid workspaces can call from group conversations.","client")():TS.i18n.t("Only paid teams can call from group conversations.","client")();else u=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Only paid workspaces can start calls from channels.","client")():TS.i18n.t("Only paid teams can start calls from channels.","client")();var f="";f+=TS.templates.menu_call_button({is_platform_call_loading:B,button_classes:"voice_call",tip_text:u,icon_classes:c.concat("ts_icon_phone").join(" ")});_.html(f);_.removeClass("hidden");if(t.id&&o)$(".channel_calls_button.voice_call").on("click.video_call",function(){if(s)return;var e="Slack"!==TS.model.team.prefs.calling_app_name;TS.clog.track("CALLS_START_VOICE_BUTTON_CLICKED",{is_platform_call:e,calling_app_id:TS.model.team.prefs.calling_app_id});TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_calls_button"}}});if(e)TS.utility.calls.launchPlatformCalls(t);else TS.utility.calls.startCallInModelOb(t)});if(o&&!d)R()}};var R=function e(){if(TS.model.prefs.in_interactive_mas_migration_flow&&TS.model.is_our_app&&TS.model.is_mac&&!TS.model.is_mas_or_ws){TS.coachmark.start(TS.coachmarks.coachmarks.calls_interactive_mas_migration);TS.model.prefs.in_interactive_mas_migration_flow=false;TS.prefs.setPrefByAPI({name:"in_interactive_mas_migration_flow",value:false});return}var t=Date.now()-new Date(1e3*TS.model.user.created)>6048e5;if(t&&TS.model.seen_welcome_2)if(TS.model.supports_screen_sharing&&TS.utility.calls.isPaidTeam())TS.experiment.loadUserAssignments().then(function(){if("enabled"===TS.experiment.getGroup("calls_ss")&&"disabled"!==TS.experiment.getGroup("calls_coachmarks_ss")&&TS.model.is_our_app)if(!TS.model.prefs.seen_calls_ss_main_coachmark&&!TS.model.prefs.seen_calls_ss_window_coachmark&&!TS.utility.isAppVersionBefore("2.5.2")){TS.coachmark.start(TS.coachmarks.coachmarks.calls_ss_main);TS.model.prefs.seen_calls_ss_main_coachmark=true;TS.prefs.setPrefByAPI({name:"seen_calls_ss_main_coachmark",value:true})}})};var U=function e(t,i){if(!i)return true;return!TS.utility.msgs.areMsgsSameDay(t,i)};var Q=function e(){var t=TS.shared.getActiveModelOb();if(!t.is_mpim)return;L(t)};var L=function e(t){var i=TS.notifs.isCorGMuted(t.id);var n=TS.notifs.getCalculatedCorGNotifySetting(t.id);var a=TS.ui.growls.checkPermission();var r=false===a&&TS.ui.growls.no_notifications;var s=false===a&&"denied"===TS.ui.growls.getPermissionLevel();var o=false===a&&TS.ui.growls.shouldShowPermissionButton();var l;var d={members:TS.mpims.getMembersInDisplayOrder(t),model_ob:t,is_shared:TS.shared.isModelObShared(t),compliance_exports_enabled_for_team:!!TS.model.team.prefs.compliance_export_start,compliance_export_start:TS.model.team.prefs.compliance_export_start||0,desktop_setting:n,is_muted:i,desktop_notifs_enabled:a,notifications_impossible:r,notifications_not_allowed:s,notifications_not_yet_allowed:o};$("#im_meta").html(TS.templates.dm_badge(d));l=$(".mpim_notif_prefs");l.find(".more_options").on("click",function(){TS.ui.channel_prefs_dialog.start(t.id)});l.find("#notifications_muted_cb").on("change",function(){if(TS.notifs.isCorGMuted(t.id))TS.notifs.muteOrUnmuteCorG(t.id)});l.find("#no_notifications_cb").on("change",function(){if(TS.model.prefs.all_channels_loud)TS.notifs.makeCorGDTopEverything(t.id);else TS.notifs.makeCorGDTopMentions(t.id);TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})});l.find("#all_notifications_rd").on("change",function(){TS.notifs.makeCorGDTopEverything(t.id);TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})});l.find("#mentions_rd").on("change",function(){TS.notifs.makeCorGDTopMentions(t.id);TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})})};var H=false;var N=function e(t){if(!t.is_channel)return;if(H)return;TS.metrics.count("banner_not_cleared");H=true;TS.channels.switched_sig.addOnce(function(){H=false})};var G=58;var j=99;var W=142;var K=888;var z=999})()},4374:function(e,t){(function(){"use strict";TS.registerModule("client.downloads",{onStart:function e(){TS.client.login_sig.add(g)},updateDownloadsView:function e(t){if(TS.useReactDownloads()&&TS.interop&&TS.interop.redux)TS.redux.dispatch(TS.interop.redux.features.downloads.syncDownloads(t))},startDownload:function e(t,i){if(!TS.model.supports_downloads)return false;if(!t)return false;if(!Q(t))return false;var n=V(Q(t));var a=i||!!n;var r=0;if(a){if("downloads"!==TS.model.ui.active_tab_id||!TS.model.ui_state.flex_visible)r=TS.model.ui_state.flex_visible?100:300;TS.client.ui.flex.openFlexTab("downloads")}if(TS.useReactDownloads()){TSSSB.call("startDownload",{id:t.id,url:Q(t)});return true}if(n){if("canceled"===n.state||"failed"===n.state)w(n.token);setTimeout(z,r,n.token);return true}return S(t)},downloadWithTokenDidSelectFilepath:function e(t,i){var n=a[t];if(!n){TS.error("downloadWithTokenDidSelectFilepath: no download for token: "+t);return}n.file_path=i;R(n)},downloadWithTokenProgress:function e(t,i){var n=a[t];if(!n){TS.error("downloadWithTokenProgress: no download for token: "+t);return}var r=j(n);n.progress=i;var s=K(n.token);if(!s.length)TS.error("downloadWithTokenProgress: no $dl found for token: "+n.token);var o=Math.max(.02,Math.min(1,n.progress));s.find(".download_progress_bar").css("width",100*o+"%");s.find(".download_estimate").text(W(n));if(1==n.progress)R(n,"completed");else if(r&&n.progress>0){s.find(".partial_size").html(TS.utility.convertFilesize(n.progress*r.size)+" of "+TS.utility.convertFilesize(r.size));F()}else if(-1!=n.progress)TS.error("downloadWithTokenProgress: bad dl: ",n)},downloadWithTokenDidFinish:function e(t){var i=a[t];if(!i){TS.error("downloadWithTokenDidFinish: no download for token: "+t);return}R(i,"completed")},downloadWithTokenDidFailWithReasonAndCode:function e(t,i){var n=a[t];if(!n){TS.error("downloadWithTokenDidFailWithReasonAndCode: no download for token: "+t);return}TS.generic_dialog.alert(TS.i18n.t("Download failed: {reason}","downloads")({reason:i}));I()},downloadMetadataChanged:function t(){if(!e)return;e=false;I()},maybeBuild:function e(){if(!TS.model.supports_downloads)return;if(TS.useReactDownloads()){var i=React.createElement(TS.interop.redux.downloadsView,{},null);var n=React.createElement(TS.interop.redux.provider,{store:TS.redux.getStoreInstance()},i);ReactDOM.render(n,r[0],function(){var e=_.get(window,"desktop.downloads.update");if(e)e.call(window.desktop.downloads)})}else{$("#downloads_scroller .monkey_scroll_hider").css("width","auto");if(t)return;t=true;if(TS.model.ms_logged_in_once)p()}},maybeShowFlexMenuProgBar:function e(){if(!TS.model.supports_downloads)return;L()},addIndividualDownload:function e(t,i){u=t;m=i;N(u)},removeIndividualDownload:function e(){u=$();m=""}});var e=false;var t=false;var i=false;var n=[];var a={};var r=$("#downloads_tab");var s=$("#downloads_scroller");var o=$("#downloads_empty");var l=$("#downloads_tab_clear");var d=$("#downloads_shift_hint");var c;var u=$();var m;var f=[];var h=20;var g=function e(){c=$(".flex_menu_download_circle");if(!TS.model.supports_downloads)return;if(t)p();N(c)};var p=function e(){if(!TS.model.supports_downloads)return;if(TS.useReactDownloads())throw new Error("Legacy _build called");if(i)return;i=true;o.html(TS.emoji.graphicReplace(o.html()));var t=function e(t){return $(t).closest(".download_item").data("token")};s.on("click.dl","a.download_cancel_link",function(e){e.stopPropagation();T(t(e.target))});s.on("click.dl",".download_item.completed",function(e){e.stopPropagation();var i=t(e.target);if(e.shiftKey)b(i);else v(i)});s.on("click.dl",".download_item.canceled, .download_item.failed",function(e){e.stopPropagation();w(t(e.target))});s.on("click.dl","i.download_remove_link",function(e){e.stopPropagation();y(t(e.target))});s.on("click",'[data-action="load_more"]',function(e){e.preventDefault();J()});$(document).on("keydown",function(e){if(e.which===TS.utility.keymap.shift)r.addClass("shift_key")});$(document).on("keyup",function(){r.removeClass("shift_key")});TS.ui.window_focus_changed_sig.add(function(){r.removeClass("shift_key")});l.on("click.dl",k);r.addClass("supports_open_file");M()};var S=function e(t){var i=TSSSB.call("startDownload",Q(t));if(!i){TS.error('startDownload called with url: "'+Q(t)+'" but I got no token');return false}a[i]={token:i,progress:0,state:"in_progress",href:Q(t),http_status:null,file_path:Q(t),file_exists:false,mime_type:"",start_ts:Date.now()/1e3,dl_start_ts:Date.now()/1e3,end_ts:0,base64_png:""};n.push(a[i]);A();P(a[i]);x();setTimeout(z,50,i);return true};var T=function e(t){var i=TSSSB.call("cancelDownloadWithToken",t);if(false===i){TS.error("_cancelDownload with token: "+t+" failed");return}O(t,"canceled")};var v=function e(t){var i=TSSSB.call("revealDownloadWithToken",t);if(false===i)TS.error("_showDownload with token: "+t+" failed")};var b=function e(t){var i=false;var n=a[t];if(n)i=TSSSB.call("openFileAtPath",n.file_path);if(false===i)TS.error("_openDownload with token: "+t+" failed")};var w=function e(t){var i=TSSSB.call("retryDownloadWithToken",t);if(false===i){TS.error("_retryDownload with token: "+t+" failed");return}var n=a[t];n.dl_start_ts=Date.now()/1e3;O(t,"in_progress")};var y=function t(i){var n=TSSSB.call("pruneTokensFromHistory",JSON.stringify([i]));if(false===n)TS.error("_removeDownload with token: "+i+" failed");if(window.winssb)e=true;else I()};var k=function t(i){if(!i&&Y("in_progress")){TS.generic_dialog.start({title:TS.i18n.t("Clear all downloads","downloads")(),body:"<p>"+TS.i18n.t("You have an active download. Are you sure you want to clear them all?","downloads")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, clear them all","downloads")(),onGo:function e(){t(true)}});return}if(false===TSSSB.call("pruneTokensFromHistory",JSON.stringify(Object.keys(a))))TS.error("_removeAllDownloads with tokens: "+JSON.stringify(Object.keys(a))+" failed");if(window.winssb)e=true;else M()};var A=function e(){n.sort(function e(t,i){if(t.start_ts<i.start_ts)return 1;if(t.start_ts>i.start_ts)return-1;return 0})};var C=function e(){var t=TSSSB.call("metadataForDownloads");var i=_.cloneDeep(a);n.length=0;if(t){a=JSON.parse(t);_.forOwn(a,function(e,t){e.token=t;e.start_ts=parseFloat(e.start_ts);if(e.start_ts>9999999999)e.start_ts/=1e3;if(i[t]){if(!e.hasOwnProperty("progress"))e.progress=i[t].progress;e.dl_start_ts=i[t].dl_start_ts}else e.dl_start_ts=e.start_ts;n.push(e)})}A()};var M=function e(){if(TS.useReactDownloads())throw new Error("Legacy render called");C();x();E();L()};var I=function e(){if(TS.useReactDownloads())throw new Error("Legacy update called");C();x();D();L()};var x=function e(){if(n.length){s.removeClass("hidden");o.addClass("hidden");d.removeClass("hidden");l.toggleClass("hidden",n.length<2)}else{s.empty().addClass("hidden");o.removeClass("hidden");l.addClass("hidden");d.addClass("hidden")}};var E=function e(){var t=_.take(n,h);var i=B(t);if(t.length<n.length)i+=TS.templates.downloads_load_more();s.html(i);TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"))};var B=function e(t){var i="";_.forEach(t,function(e){i+=U(e)});return i};var D=function e(){var t;if(!n.length){L();return}var i=n;var r=s.find(".download_item:last").attr("data-token");if(r){var o=_.findIndex(n,{token:r});if(o>=0)i=_.take(n,o+1)}_.forEach(i,function(e){t=K(e.token);if(t.length)R(e);else P(e)});var l=0;s.find(".download_item").each(function(e,i){l+=1;t=$(i);if(t.hasClass("hidden_with_fade_out_and_shrink"))return;if(a[t.data("token")])return;t.css("height",t.outerHeight()+"px");setTimeout(function(e){return function(){e.addClass("hidden_with_fade_out_and_shrink")}}(t),0)});if(l)setTimeout(function(){TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"))},550)};var F=function e(){if(u.length&&m)H();L()};var P=function e(t){if(!t){TS.error("_addDlDiv: no dl passed");return}s.prepend(U(t));TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"));F()};var O=function e(t,i){var n=a[t];if(!n){TS.error("_updateDownloadByToken: no download for token: "+t);return}R(n,i)};var R=function e(t,i){if(!t){TS.error("_updateDownload: no dl passed");return}if(i)t.state=i;if("completed"===t.state)t.progress=1;else if("in_progress"===t.state);else t.progress=0;F(i);var n=K(t.token);if(!n.length){TS.error("no $dl found for token: "+t.token);return}if(n.hasClass("hidden_with_fade_out_and_shrink"))return;n.replaceWith(U(t));TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"))};var U=function e(t){var i=j(t);if(!i&&!t.tried_fetch){t.tried_fetch=true;var n=new RegExp(TS.utility.regexpEscape(TS.model.team.id)+"-F[A-Z0-9]+");var r=t.href.match(n);var s;var o;var l=_.isString(t.href)&&t.href.substr(0,t.href.lastIndexOf("/")||t.href.length)+"/[redacted]"||"[invalid]";if((!r||!r.length)&&TS.boot_data.page_needs_enterprise){var d="T"+TS.model.enterprise.id.substr(1);n=new RegExp(TS.utility.regexpEscape(d)+"-F[A-Z0-9]+");r=t.href.match(n);if(r&&r.length)TS.warn("_buildItem: no file found matching TS.model.team.id of "+TS.model.team.id+", found with enterprise ID "+TS.model.enterprise.id+" + E->T ("+d+")")}if(r&&r.length){s=r[0];o=s.split("-")[1];TS.warn("_buildItem: fetching file for dl.href: "+l);X(o,function(){t=a[t.token];if(!t)return;R(t)})}else TS.error("_buildItem: no file id found in dl.href: "+l+". TS.model.team.id = "+TS.model.team.id+(TS.boot_data.page_needs_enterprise?", TS.model.enterprise.id = "+TS.model.enterprise.id:", no enterprise ID."))}var c="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";var u;var m;var f=0;var h=0;var g;if(i){c=i.thumb_160||i.thumb_80;u=i.filetype||null;m=i.pretty_type||null;g=i.name||null;f=i.size;if("in_progress"===t.state&&t.progress)h=t.progress*f}var p=t&&t.file_path&&t.file_path.split(/\/|\\/)&&t.file_path.split(/\/|\\/).reverse();var S=p&&p[0];if(!S)TS.warn("_buildItem: no file_path found in dl.file_path"+t.file_path);var T={item:t,img_src:c,filetype:u,pretty_type:m,name:S||g,size:f,partial_size:h,estimate:W(t),debug:JSON.stringify(a,null,2),perc:"completed"===t.state?100:100*Math.max(.02,t.progress)};if(!T.name)TS.warn("_buildItem: file name is empty or undefined in template_args.name"+T.name);return TS.templates.download_item(T)};var Q=function e(t){return t.url_private_download};var L=function e(){var t=0;var i=0;_.forOwn(a,function(e){if("in_progress"!==e.state)return;if(isNaN(e.progress))return;if(e.progress>=1)return;var n=j(e);if(!n)return;if(!n.size)return;t+=n.size;i+=n.size*Math.max(0,e.progress)});if(t){var n=G(i,t);c.circleProgress({value:n}).addClass("shown_with_fade_in");$("#downloads_menu_progress").removeClass("hidden").find(".download_progress_bar").css("width",100*n+"%")}else{c.removeClass("shown_with_fade_in");$("#downloads_menu_progress").addClass("hidden")}};var H=function e(){var t;var i=0;var n=0;_.forOwn(a,function(e){if("in_progress"!==e.state)return;if(isNaN(e.progress))return;if(e.progress>=1)return;t=j(e);if(!t)return;if(t.id===m){if(t.size){i+=t.size;n+=t.size*Math.max(0,e.progress)}return false}});if(i&&t){var r=G(n,t.size);u.circleProgress({value:r}).addClass("shown_with_fade_in")}else u.removeClass("shown_with_fade_in")};var N=function e(t){t.circleProgress({value:0,size:9,animation:false,fill:{gradient:["#50acf4","#41a6f5"]},emptyFill:"rgba(211,211,211,1)",thickness:2,lineCap:"round",startAngle:Math.PI/-2})};var G=function e(t,i){var n=t/i;return Math.max(.06,Math.min(1,n))};var j=function e(t){return TS.files.getFileByDownloadUrlPrivate(t.href)};var W=function e(t){if(!t)return"";if("in_progress"!==t.state)return"";if(t.progress>=1)return"";if(-1==t.progress)return"";if(!t.progress)return"";if(t.progress<.02)return"...";var i=Date.now()/1e3-t.dl_start_ts;var n=i*(1/t.progress);var a=n-i;return TS.i18n.t("{seconds}s remaining","downloads")({seconds:Math.ceil(a)})};var K=function e(t){return s.find('[data-token="'+t+'"]')};var z=function e(t){var i=K(t);i.scrollintoview({duration:100,offset:"center_vertical",complete:function e(){i.highlight(3e3,"download_item_highlighter",null,0)}})};var V=function e(t){return q("href",t)};var Y=function e(t){return q("state",t)};var q=function e(t,i){if(!t)return null;if(!i&&0!==i)return null;for(var a=0;a<n.length;a+=1)if(n[a][t]==i)return n[a];return null};var J=function e(){var t=s.find(".download_item:last");var i=t.attr("data-token");if(!t.length||!i){Z();return}var a=_.findIndex(n,{token:i});var r=_(n).drop(a+1).take(h).value();var o=B(r);t.after(o);var l=_.includes(r,_.last(n));if(l)Z()};var Z=function e(){s.find(".downloads_load_more").remove()};var X=function e(t,i){f.push({id:t,callback:i});ee()};var ee=_.debounce(function(){var e=f;f=[];if(!e||!e.length)return;if(1===e.length){var t=e[0];TS.files.fetchFileInfo(t.id,t.callback)}else{var i=_.map(e,"id");TS.files.fetchMultipleFiles(i,function(t){if(!t)return;_.forEach(e,function(e){var t=TS.files.getFileById(e.id);if(t)e.callback(e.id,t)})})}},10)})()},4375:function(e,t){(function(){"use strict";TS.registerModule("client.whats_new",{onStart:function e(){TS.client.login_sig.add(l);TS.prefs.whats_new_read_changed_sig.add(g);TS.client.flexpane_display_switched_sig.add(u)},updateIcon:function e(){T()},getNewestID:function e(){return i}});var e=$("#whats_new_updates");var t=$("#what_new_read_cb");var i=-1;var n=0;var a;var r=false;var s=false;var o=Math.round(Date.now()/1e3);var l=function n(){r=true;e.find(".whats_new_content").each(function(){var e=$(this);if(!e.hasClass("html"))e.html(TS.format.formatNoHighlightsNoInlineImgs(e.html()))});i=e.children().first().data("whats-new-id")||i;g();t.bind("change",function(){c(!!$(this).prop("checked"))});d()};var d=function t(){e.find("a.whats_new_content").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"heading_link",page_url:$(this).attr("href"),step:i})});e.find("div.whats_new_description").find("a").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"description_link",page_url:$(this).attr("href"),step:i})});e.find("a.whats_new_more").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"read_more_link",page_url:$(this).attr("href"),step:i})})};var c=function e(t){var n=-1;if(t){n=i||Math.floor(Date.now()/1e3);TS.clog.track("WHATSNEW_ACTION",{action:"opt_in",step:i,trigger:"checkbox_whats_new"})}else TS.clog.track("WHATSNEW_ACTION",{action:"opt_out",step:i,trigger:"checkbox_whats_new"});TS.prefs.onPrefChanged({name:"whats_new_read",value:n});TS.prefs.setPrefByAPI({name:"whats_new_read",value:n});g()};var _=function e(){if(-1==TS.model.prefs.whats_new_read)return;TS.prefs.onPrefChanged({name:"whats_new_read",value:i});TS.prefs.setPrefByAPI({name:"whats_new_read",value:i});n=0};var u=function e(){if(!r)return;var t=TS.model.ui_state.flex_name;if(!TS.model.ui_state.flex_visible||"whats_new"!==t){s=false;return}s=true;h();m()};var m=function e(){if(!s){clearTimeout(a);return}if(b())return;a=setTimeout(function(){_()},1e3)};var f=function t(){n=0;e.children().each(function(){var e=$(this);var t=e.data("whats-new-id");if(t&&TS.model.prefs.whats_new_read<t)n+=1})};var h=function t(){e.children().each(function(){var e=$(this);var t=e.data("whats-new-id");if(t&&TS.model.prefs.whats_new_read<t)e.find(".ts_icon_presence_online").removeClass("hidden");else e.find(".ts_icon_presence_online").addClass("hidden")})};var g=function e(){f();m();S();p();T()};var p=function e(){t.prop("checked",-1!==TS.model.prefs.whats_new_read)};var S=function e(){if(b()||!v()||w())$("#client-ui").removeClass("whats_new_showing");else{var t=n>9?"9+":n;$("#whats_new_toggle").addClass("exp_expanding");if(n>1){$("#whats_new_toggle").find(".num_only").removeClass("hidden").text(t);$("#whats_new_toggle").find(".num_updates").removeClass("hidden").text(TS.i18n.t("{num_updates} Updates","whats_new")({num_updates:t}))}else{$("#whats_new_toggle").find(".num_only").addClass("hidden");$("#whats_new_toggle").find(".num_updates").addClass("hidden")}$("#client-ui").addClass("whats_new_showing");TS.clog.track("WHATSNEW_ACTION",{action:"do_badge",trigger:i,step:i})}};var T=function e(){var t=$("#whats_new_count");if(n&&v()){t.removeClass("hidden");t.text(n<10?n:"9+")}else t.addClass("hidden")};var v=function e(){return-1!==TS.model.prefs.whats_new_read&&false!==TS.model.team.prefs.whats_new_badges};var b=function e(){return TS.model.prefs.whats_new_read>=i};var w=function e(){var t=691200;return o-i>=t}})()},4376:function(e,t){(function(){"use strict";TS.registerModule("client.history_prefetch",{addToHistoryFetchQueue:function t(i){if(!i)return;if(!e)e=[];if(-1!==e.indexOf(i))return false;e.push(i);return true},processHistoryFetchQueue:function t(){if(e._being_processed||!e.length)return false;r();s();o();l();if(TS.has_pri[c]){var i=[];_.each(e,function(e){i.push(e)});TS.log(c,"pre-loading history for "+e.length+(1===e.length?" item: ":" items: ")+i.join(", "))}e.being_processed=true;if(e.length>1)TS.api.callFuncWhenApiQisEmpty(function(){d();d()});else TS.api.callFuncWhenApiQisEmpty(d);return true},resetHistoryFetchQueue:function t(){e=[];n=[]}});var e=[];var t=20;var i=40;var n=[];var a;var r=function e(){if(n.length)return;if(TS.frecency&&!a){var t=TS.frecency.getExisting("jumper");a=t&&t.getMostCommon()}if(!a){TS.warn('WTF no TS.frecency module? or no "jumper" frecency?');return}n=a.filter(function(e){return e.score>=i}).map(function(e){return e.id})};var s=function t(){if(!n.length)return;var i;for(var a=n.length-1;a>=0;a-=1){i=e.indexOf(n[a]);if(-1!==i)e.unshift(e.splice(i,1)[0])}};var o=function t(){var i=_.filter(e,function(e){var t=TS.shared.getModelObById(e);return t&&(t.is_im||t.is_mpim)});i.reverse();_.each(i,function(t){var i=e.indexOf(t);e.unshift(e.splice(i,1)[0])})};var l=function i(){var n=0;for(var a=0,r=e.length;a<r;a+=1){var s=TS.shared.getModelObById(e[a]);if(s&&!s.is_im&&!s.is_mpim){n=a;if(TS.has_pri[c])TS.log(c,"queued "+n+" required IM/MPIM item(s) for pre-fetch: "+e.slice(0,a).join(", "));break}}var o=e.length;e.length=Math.min(e.length,t+n);if(o!==e.length&&TS.has_pri[c])TS.log(c,"truncated history fetch queue from "+o+" to "+e.length+(n?", including "+n+" required IM/MPIM item(s)":""))};var d=function t(){if(!e||!e.length){if(TS.has_pri[c])TS.log(c,"_processHistoryFetchQueue: done.");e.being_processed=false;return}var i=e.shift();var n=TS.shared.getModelObById(i);if(!n){TS.warn('_processHistoryFetchQueue: could not find model_ob for id "'+i+'"');return}var a=TS.shared.getControllerForModelOb(n);if(!a){TS.warn("_processHistoryFetchQueue: could not find controller for model_ob");return t()}TS.shared.maybeFetchHistory(n);if(n.history_is_being_fetched)a.history_fetched_sig.addOnce(function(e){if(TS.has_pri[c])TS.log(c,'fetched history for "'+e.id+'"');TS.api.callFuncWhenApiQisEmpty(function(){window.setTimeout(t,250+250*Math.random())})});else{if(TS.has_pri[c])TS.log(c,'_processHistoryFetchQueue: no history fetch started for "'+n.id+'" - assuming up to date.');t()}};var c=58})()},4377:function(e,t){var i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("client.traces",{onStart:function e(){TS.client.login_sig.add(l,TS.client.traces,1)},canTrace:function e(){return!!(TS.boot_data.feature_perfectrics&&_.get(window,"desktop.stats.startTraceRecord")&&_.get(window,"desktop.stats.stopTraceRecord"))},startTrace:function e(t,i){if(!TS.client.traces.canTrace())return T();if(h())return T(o);o=g(t,i);s=o.delay(f(t)).finally(function(){p()}).catch(_.noop);return T(o)},maybeTrace:function e(t,i){if(!TS.client.traces.canTrace())return T();if(!S())return T();if(h())return T(o);TS.storage.storeLastTraceTS();return TS.client.traces.startTrace(t,i)},stopTrace:function e(){if(!TS.client.traces.canTrace())return;if(!h())return;o.finally(function(){s.cancel()}).catch(_.noop)},test:function e(){var e={};Object.defineProperty(e,"_getTraceIdentifier",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(e,"_getTraceEndpoint",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(e,"_getTraceToken",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(e,"_getSafeTraceMetadata",{get:function e(){return m},set:function e(t){m=t}});Object.defineProperty(e,"_getSafeTracePeriod",{get:function e(){return f},set:function e(t){f=t}});Object.defineProperty(e,"_traceInFlight",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(e,"_promiseToStartTrace",{get:function e(){return g},set:function e(t){g=t}});Object.defineProperty(e,"_promiseToStopTrace",{get:function e(){return p},set:function e(t){p=t}});Object.defineProperty(e,"_longEnoughSinceLastAutomatedTrace",{get:function e(){return S},set:function e(t){S=t}});Object.defineProperty(e,"_getExternalPromise",{get:function e(){return T},set:function e(t){T=t}});Object.defineProperty(e,"_trace_p",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(e,"_start_trace_p",{get:function e(){return o},set:function e(t){o=t}});return e}});var e=1e3;var t=1*e;var n=60*e;var a=20*e;var r=86400*e;var s;var o;var l=function e(){};var d=function e(){return[_.get(TS.model,"user.team_id")||_.get(TS.boot_data,"team_id"),_.get(TS.model,"user.id")||_.get(TS.boot_data,"user_id"),Date.now(),performance.now()].join("_")};var c=function e(){return _.get(TS.model,"async_api_url")+"profiling.addTrace"};var u=function e(){return _.get(TS.model,"api_token")};var m=function e(t){function n(e,t){_.each(e,function(a,r){if(r===t)delete e[r];else if(a===t)e[r]="(redacted)";else if("object"===("undefined"===typeof a?"undefined":i(a)))n(a,t)})}n(t,u());return t};var f=function i(r){r=parseInt(r,10);return _.isNaN(r)?a:_.clamp(r*e,t,n)};var h=function e(){return!!s&&s.isPending()};var g=function e(t,i){var n=d();return Promise.resolve(window.desktop.stats.startTraceRecord({identifier:n,endpoint:c(),token:u(),metadata:_.assign({},m(i),{identifier:n,duration:f(t)})}))};var p=function e(){return Promise.resolve(window.desktop.stats.stopTraceRecord())};var S=function e(){return Date.now()-TS.storage.fetchLastTraceTS()>r};var T=function e(t){if(!t)return Promise.resolve();return new Promise(function(e){t.then(function(t){return e(t)})})}})()},4378:function(e,t){(function(){"use strict";TS.registerModule("key_triggers",{onStart:function e(){if(TS.boot_data.special_flex_panes)_.forOwn(TS.boot_data.special_flex_panes,function(e){if(e.keycode)(function(e,t){TS.key_triggers[e.toString()]={func:function e(){TS.client.ui.flex.openFlexTab(t)}}})(e.keycode,e.flex_name)})},220:{isDisabled:function e(t){var i=$(t.target).closest("#reply_container").length>0;var n=$(t.target).closest(".reply_input_container").length>0;var a=i||n;return!a&&TS.client.activeChannelIsHidden()},shift_optional:false,func:function e(t){var i=TS.shared.getActiveModelOb();if(!i)return;var n=$(t.target).closest("#reply_container.has_focus").length>0;var a=$(t.target).closest(".reply_input_container.has_focus").length>0;var r=$(".message--focus");var s;if(n){var o=_.clone(TS.ui.replies.getActiveMessages());s=_.reverse(o);t.target=$("#reply_container")}else if(a){var l=$(".reply_input_container.has_focus");var d=TS.client.ui.threads.getThreadFromEl(l);var c=d.replies&&d.replies.length?_.clone(d.replies):_.clone(d.root_msg);c=_.dropRightWhile(d.replies,function(e){return e.ts>d.max_visible_ts});s=_.reverse(c);t.target=l}else{s=TS.utility.msgs.getDisplayedMsgs(i.msgs);t.target=TS.client.ui.$msg_input}if(r.length&&TS.boot_data.feature_keyboard_navigation){r.find(".btn_msg_action.ts_icon_small_reaction").click();return}var u=_(s).take(5).find(function(e){return!e.is_ephemeral});if(!u)return;if(u._jl_rolled_up_in){u=TS.utility.msgs.getMsg(u._jl_rolled_up_in,i.msgs);if(!u)return}var m=TS.rxns.getRxnKeyByMsgType(u);var f=TS.utility.msgs.getMsgActions(u,i);if(!f||!f.add_rxn&&!f.add_file_rxn&&!f.add_file_comment_rxn){TS.sounds.play("beep");return}var h=function e(){var i=$(t.target).find("textarea").addBack();i.focus()};TS.ui.react_emoji_menu.start({e:t,rxn_key:m,callback:h})}},77:{isDisabled:function e(){return TS.model.is_chrome_desktop||TS.model.is_chrome_mobile},func:function e(){if(TS.model.ui_state.flex_visible&&"mentions"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex();else TS.client.ui.flex.openFlexTab("mentions")}},83:{shift_optional:true,func:function e(t){if(TS.boot_data.feature_star_shortcut&&t.altKey)TS.stars.toggleStar();else if(t.shiftKey)if(TS.model.ui_state.flex_visible&&"stars"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex();else TS.client.ui.flex.openFlexTab("stars")}},85:{isDisabled:function e(t){return!!t.altKey||TS.client.activeChannelIsHidden()},no_shift:true,func:function e(){TS.client.ui.files.$upload.trigger("click")}},69:{isDisabled:function e(){return!!TS.model.is_FF},func:function e(){if(TS.model.ui_state.flex_visible&&"team"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex();else{TS.client.ui.flex.openFlexTab("team");TS.client.ui.showTeamList()}}},65:{isDisabled:function e(){if(!TS.client.unread.isEnabled())return true;return false},func:function e(){if(TS.model.unread_view_is_showing)TS.client.unread.reloadIfPendingMessages();else TS.client.unread.showUnreadView()}},73:{isDisabled:function e(t){if(!TS.model.is_our_app)return true;if(window.loadSettings&&window.loadSettings.devMode)return true;if(t.altKey)return true;if(TS.client.activeChannelIsHidden())return true;return false},func:function e(){if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex();else TS.client.ui.flex.openFlexTab("details")}},70:{isDisabled:function e(t){return!(TS.model.is_our_app||TS.model&&TS.model.prefs&&TS.model.prefs.f_key_search||TS.boot_data.feature_focus_mode&&t.altKey)},no_shift:true,func:function e(t){if(TS.boot_data.feature_focus_mode&&t.altKey)TS.ui.focus_mode.start();else{if(!TS.client.ui.isUserAttentionOnChat())return false;TS.clog.track("SEARCH_OPEN",{open_method:"key"});var i;if(!TS.client.activeChannelIsHidden())i="in:"+TS.shared.getActiveModelOb().name+" ";TS.search.setInputVal(i)}}},74:{isDisabled:function e(){return!TS.environment.is_apple_webkit},no_shift:true,func:_.noop},75:{isDisabled:function e(t){return t.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model||!TS.model.is_our_app&&!TS.model.prefs.k_key_omnibox},no_shift:true,func:function e(){if(TS.model.prefs.no_omnibox_in_channels)TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut_no_btn",action:"opened"});TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut",action:"opened"});if(TS.model.prefs.k_key_omnibox_auto_hide_count<5)TS.prefs.setPrefByAPI({name:"k_key_omnibox_auto_hide_count",value:TS.model.prefs.k_key_omnibox_auto_hide_count+1});TS.ui.jumper.start()}},76:{isDisabled:function e(t){if(!t.metaKey&&!t.altKey&&!t.shiftKey&&t.ctrlKey&&TS.model.is_mac){t.preventDefault();t.stopPropagation()}return t.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model},shift_optional:false,func:function e(){TS.ui.channel_browser.start()}},84:{isDisabled:function e(t){return t.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model||!TS.model.is_our_app},no_shift:true,func:function e(){if(TS.model.prefs.no_omnibox_in_channels)TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut_no_btn",action:"opened"});TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut",action:"opened"});if(TS.model.prefs.k_key_omnibox_auto_hide_count<5)TS.prefs.setPrefByAPI({name:"k_key_omnibox_auto_hide_count",value:TS.model.prefs.k_key_omnibox_auto_hide_count+1});TS.ui.jumper.start()}},188:{isDisabled:function e(){if(!TS.model.is_mac)return true;if(!TS.model.active_im_id)return false;return true},shift_optional:false,func:function e(){TS.ui.channel_prefs_dialog.start(TS.model.active_cid)}}})})()},4379:function(e,t){(function(){"use strict";TS.registerModule("search.view",{latest_msg_search_results:null,added_to_history_last_ms:0,search_results_lazy_load:null,last_terms:"",filter_delay_ms:6e4,onStart:function e(){TS.search.search_filter_set_sig.add(TS.search.view.renderResults,TS.search.view);TS.search.search_filetype_filter_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_sort_set_sig.add(s);TS.prefs.messages_theme_changed_sig.add(TS.search.view.messagesThemeChanged,TS.search.view);TS.search.message_search_results_fetched_sig.add(a);TS.search.file_search_results_fetched_sig.add(r);if(TS.client){$("#flexpane_tabs a").bind("click.setSearchFilter",function(){if("files"===$(this).data("tab-id")||$(this).data("filetype"))TS.search.setFilter("files");else TS.search.setFilter("messages")});$("#search_results_items").bind("click.view",function(e){if(0===$(e.target).closest("A").length)return;if(1==$(e.target).closest(".file_list_item").length)TS.search.view.maybeLogSearchInteraction("files")});$("#search_tabs").html(TS.templates.search_tabs({messages_count:0,files_count:0,show_all_tab:TS.search.sliFileSearchIsEnabled()}));$("#search_clear").bind("click.switch_to_files",function(){if("files"===TS.search.filter&&TS.model.ui_state.flex_visible)setTimeout(function(){TS.search.view.switchBackToFiles()},50)});$("#search_results").scroll(function(){n();if(TS.menu.search_filter_is_showing)TS.menu.end()});if(!TS.boot_data.feature_texty_search){var t=$("#search_terms");t.on("click",function(){if(!TS.search.view.searchIsVisible())t.select()});t.on("keyup",function(e){if(e.which==TS.utility.keymap.esc)if(TS.boot_data.feature_keyboard_navigation){if(!$(".search_menu").is(":visible"))t.blur()}else t.blur()});t.on("blur",TS.search.autocomplete.maybeLogSearchInputBlur)}if(TS.search.sliFileSearchIsEnabled())$("#search_tab").addClass("feature_sli_file_search");TS.client.login_sig.add(TS.search.view.loggedIn,TS.search.view)}if(TS.web){TS.web.login_sig.add(TS.search.view.loggedIn,TS.search.view);TS.search.all_search_results_fetched_sig.add(TS.search.view.updateHistory,TS.search.view);TS.search.search_filter_set_sig.add(TS.search.view.updateHistory,TS.search.view);$(window).bind("popstate",function(e){TS.search.view.onPopState(e.originalEvent)})}},loggedIn:function e(){if(TS.client)if("timestamp"===TS.search.sort)$("#search_sort_timestamp").addClass("active");else if("model"===TS.search.sort&&$("#search_sort_model").length)$("#search_sort_model").addClass("active");else $("#search_sort_score").addClass("active");if(TS.web){if(TS.boot_data.filter)TS.search.setFilter(TS.boot_data.filter);if(TS.boot_data.query)TS.search.searchAll(TS.search.truncateQuery(TS.boot_data.query))}},pageMessagesForward:function e(){var t=TS.search.results[TS.search.query];if(!t.messages||TS.search.view.current_messages_page+1>t.messages.paging.pages)return;TS.search.view.current_messages_page+=1;TS.search.view.renderResults();if(TS.search.separateMessagesAndFiles()&&TS.search.view.current_messages_page<=t.messages.paging.page)return;$("#search_results_team").addClass("hidden");if(TS.search.view.current_messages_page<t.messages.paging.page)return;if(TS.search.separateMessagesAndFiles())TS.search.getNextPageOfMessageResults(TS.search.query,TS.search.query_string,TS.search.view.current_messages_page);else TS.search.getNextPageOfSearchResults(TS.search.query,TS.search.query_string,TS.search.view.current_messages_page+1)},pageMessagesBack:function e(){if(TS.search.view.current_messages_page-1<1)return;TS.search.view.current_messages_page-=1;TS.search.view.renderResults()},pageFilesForward:function e(){var t=TS.search.results[TS.search.query];if(!t.files||TS.search.view.current_files_page+1>t.files.paging.pages)return;TS.search.view.current_files_page+=1;TS.search.view.renderResults();if(TS.search.separateMessagesAndFiles()&&TS.search.view.current_files_page<=t.files.paging.page)return;$("#search_results_team").addClass("hidden");if(TS.search.view.current_files_page<t.files.paging.page)return;if(TS.search.separateMessagesAndFiles())TS.search.getNextPageOfFileResults(TS.search.query,TS.search.query_string,TS.search.view.current_files_page);else TS.search.getNextPageOfSearchResults(TS.search.query,TS.search.query_string,TS.search.view.current_files_page+1)},pageFilesBack:function e(){if(TS.search.view.current_files_page-1<1)return;TS.search.view.current_files_page-=1;TS.search.view.renderResults()},searchFetched:function e(t,i){if(1==i.page){TS.search.view.current_messages_page=1;TS.search.view.current_files_page=1;TS.search.view.waiting_on_page=-1;TS.search.view.renderResults();TS.search.view.messageSearchResultsFetched(t,i);TS.search.view.searchMembers()}else if(i.page==TS.search.view.waiting_on_page)TS.search.view.renderResults()},waiting_on_page:-1,waiting_on_messages_page:-1,waiting_on_files_page:-1,current_messages_page:1,current_files_page:1,renderResults:function n(a){if(i)return;if(a)e=null;TS.search.view.updateOptions();if(!TS.search.results[TS.search.query])return;var r=TS.search.results[TS.search.query];var s="";var l=[];var d;var c=false;var u=false;var m=false;var f=true;var h=TS.i18n.t("Loading","search")();if("messages"===TS.search.filter){if(r.messages&&r.messages.matches){var g=r.messages.pages[TS.search.view.current_messages_page-1];if(g)l=r.messages.matches.slice(g.start,g.count)}if(!l.length)if(TS.search.separateMessagesAndFiles())TS.search.view.waiting_on_messages_page=TS.search.view.current_messages_page;else TS.search.view.waiting_on_page=TS.search.view.current_messages_page;if(!TS.search.sliFileSearchIsEnabled()){m=(_.get(r,"modules.channel_facets")||_.get(r,"modules.user_facets"))&&TS.sli_search_facets&&TS.sli_search_facets.isEnabled()&&1==TS.search.view.current_messages_page;if(m)s+=TS.sli_search_facets.render(r.modules.channel_facets,r.modules.user_facets);u=_.get(r,"modules.experts")&&TS.sli_expert_search&&TS.sli_expert_search.isEnabled()&&1==TS.search.view.current_messages_page;if(u)s+=TS.sli_expert_search.render(TS.search.query,TS.search.query_string_for_display,r.modules.experts,r.modules.channels);c="timestamp"===TS.search.sort&&r.messages.modules&&r.messages.modules.score&&r.messages.modules.score.top_results&&1==TS.search.view.current_messages_page;if(c){var p=r.messages.modules.score.debug||{};s+=TS.templates.search_top_results_message_results({results:r.messages.modules.score.top_results,page:r.messages.modules.score.top_results,module_name:"score_top_results",module_order:r.messages.modules.score.order,show_feedback:r.show_feedback,for_search_display:true,debug:p})}}if(c||u)s+='<div class="search_module_header"><p><span>'+TS.i18n.t("All Results","search")()+"</span></p></div>";if(l.length)s+=TS.templates.search_message_results({results:r,page:l,current_page:TS.search.view.current_messages_page,paging_html:r.messages&&f?new Handlebars.SafeString(TS.templates.messages_search_paging({current_page:TS.search.view.current_messages_page,pages:r.messages.paging.pages})):"",module_order:r.messages.order||0,is_enterprise:TS.boot_data.page_needs_enterprise,search_global:!TS.model.prefs.search_only_current_team,show_feedback:r.show_feedback});else if(!r.messages||r.messages.total>0){var S=TS.i18n.t("loading page {page_num}...","search")({page_num:TS.search.view.current_messages_page});s+='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+h+'" /><br />'+S+"</div>"}else s=TS.templates.search_results_none({query_string:TS.emoji.maybeGetLocalizedEmojiString(TS.search.query_string_for_display),filter:"messages",error:r.error});if(TS.boot_data.team_limit_ts>0){$("#search_results_message_limit").removeClass("hidden");$("#search_results_team").addClass("no_margin");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"search_pane",action:"impression",ui_element:"message_search_link_top"}}})}$("#search_results_file_limit").addClass("hidden")}else if("files"===TS.search.filter){$("#search_tabs").slideDown(500);d=(TS.search.view.current_files_page-1)*TS.search.per_page;if(r.files&&r.files.matches)l=r.files.matches.slice(d,d+TS.search.per_page);if(!l.length)if(TS.search.separateMessagesAndFiles())TS.search.view.waiting_on_files_page=TS.search.view.current_files_page;else TS.search.view.waiting_on_page=TS.search.view.current_files_page;if(l.length){var T=f?TS.templates.files_search_paging({current_page:TS.search.view.current_files_page,pages:r.files.paging.pages}):"";var v={for_search:true,is_enterprise:TS.boot_data.page_needs_enterprise};$.each(l,function(e,t){s+=TS.templates.builders.fileHTML(t,v)});s+=T}else if(!r.files||r.files.total>0){var b=TS.i18n.t("loading page {page_num}...","search")({page_num:TS.search.view.current_files_page});s+='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+h+'" /><br />'+b+"</div>"}else s+=TS.templates.search_results_none({query_string:TS.emoji.maybeGetLocalizedEmojiString(TS.search.query_string_for_display),filter:"files",error:r.error,filetype:TS.search.filetype,filetype_label:TS.model.file_list_type_map[TS.search.filetype]});$("#search_results_file_limit").removeClass("hidden");$("#search_results_message_limit").addClass("hidden")}else if(TS.search.sliFileSearchIsEnabled()&&"all"===TS.search.filter&&TS.boot_data.feature_sli_file_search){m=(_.get(r,"modules.channel_facets")||_.get(r,"modules.user_facets"))&&TS.sli_search_facets&&TS.sli_search_facets.isEnabled()&&1==TS.search.view.current_messages_page;if(m)s+=TS.sli_search_facets.render(r.modules.channel_facets,r.modules.user_facets);u=_.get(r,"modules.experts")&&TS.sli_expert_search&&TS.sli_expert_search.isEnabled()&&1==TS.search.view.current_messages_page;if(u)s+=TS.sli_expert_search.render(TS.search.query,TS.search.query_string_for_display,r.modules.experts,r.modules.channels);c=r.messages.modules&&r.messages.modules.score&&r.messages.modules.score.top_results&&1==TS.search.view.current_messages_page;if(c){s+='<div class="search_module_header search_module_header--with_more_link">\n\t\t\t\t\t<p>'+TS.i18n.t("Top Messages","search")()+'</p>\n\t\t\t\t\t<a href="#" class="search_module_header__more_link" onclick="TS.search.setFilter(\'messages\'); return false;">\n\t\t\t\t\t\t'+TS.i18n.t("{count, plural, =1 {# more} other {# more}} ","search")({count:r.messages.total-r.messages.modules.score.top_results.length})+' <ts-icon class="ts_icon_chevron_right"></ts-icon>\n\t\t\t\t\t</a>\n\t\t\t\t</div>';s+=TS.templates.search_top_results_message_results({results:r.messages.modules.score.top_results,page:r.messages.modules.score.top_results,module_name:"score_top_results",module_order:r.messages.modules.score.order,show_feedback:false,hide_footer:true,for_search_display:true,show_separated_messages:true,debug:r.messages.modules.score.debug||{}})}if(r.files&&r.files.matches&&r.files.matches.length){s+='<div class="search_module_header search_module_header--with_more_link">\n\t\t\t\t\t<p>'+TS.i18n.t("Top Files","search")()+'</p>\n\t\t\t\t\t<a href="#" class="search_module_header__more_link" onclick="TS.search.setFilter(\'files\'); return false;">\n\t\t\t\t\t\t'+TS.i18n.t("{count, plural, =1 {# more} other {# more}} ","search")({count:r.files.total-3})+' <ts-icon class="ts_icon_chevron_right"></ts-icon>\n\t\t\t\t\t</a>\n\t\t\t\t</div>';var w=_.take(r.files.matches,3);_.each(w,function(e){var t=TS.shared.getModelObById(e.channels[0]);s+='<div class="search_message_result search_message_result--file">\n\t\t\t\t\t\t<div class="search_message_result__channel">'+TS.templates.builders.makeChannelLink(t)+"</div>\n\t\t\t\t\t\t"+TS.templates.builders.fileHTML(e,{for_search:true,is_enterprise:TS.boot_data.page_needs_enterprise})+"\n\t\t\t\t\t</div>"})}if(r.messages.matches.length){var y=_.take(r.messages.matches,5);s+='<div class="search_module_header search_module_header--with_more_link">\n\t\t\t\t\t<p>'+TS.i18n.t("{count, plural, =1 {# Result} other {# Results}}","search")({count:r.messages.total})+"</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t"+TS.templates.search_top_results_message_results({results:y,page:y,module_name:"all_messages",module_order:4,show_feedback:false,hide_footer:true,for_search_display:true,show_separated_messages:true,debug:{}})+'\n\t\t\t\t\t<p class="search_module_footer__more_link">\n\t\t\t\t\t\t<a href="#" class="search_module_footer__more_link" onclick="TS.search.setFilter(\'messages\'); return false;">\n\t\t\t\t\t\t\t'+TS.i18n.t("View more","search")()+' <ts-icon class="ts_icon_chevron_right"></ts-icon>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</p>'}}$("#search_results_items").find(".search_jump_maybe").tooltip("destroy");$("#search_results_items").html(s);if(TS.search.sliFileSearchIsEnabled())$("#search_results").removeClass("all messages files").addClass(TS.search.filter);if(TS.view)TS.utility.makeSureAllLinksHaveTargets($("#search_results_items"));else TS.utility.makeSureAllExternalLinksAreRefererSafe($("#search_results_items"));$("#search_results_items").find(".search_jump_maybe").tooltip({delay:{show:450,hide:150},container:"body",placement:"left"});if(TS.client){try{i=true;TS.search.view.showResults()}finally{i=false}$("#search_results").scrollTop(0);TS.client.ui.checkInlineImgsAndIframes("search")}if(TS.search.view.search_results_lazy_load&&TS.search.view.search_results_lazy_load.detachEvents)TS.search.view.search_results_lazy_load.detachEvents();$("#search_results_container").find(".lazy").lazyload({container:$("#search_results"),throttle:200});if("messages"===TS.search.filter){o(r);if(e)$("#search_results").scrollTop(e)}else if(t)$("#search_results").scrollTop(t)},showResults:function e(){var t=TS.model.ui.active_tab_id;var i=TS.model.previewed_file_id;if(!TS.model.ui_state.flex_visible||"search"!==TS.model.ui_state.flex_name)TS.client.ui.flex.openFlexTab("search");TS.clog.track("SEARCH_OPEN",{open_method:"search_box",click_module_name:TS.search.filter,click_module_position:0,request_id:"messages"===TS.search.filter?TS.search.last_request_id:TS.search.last_files_request_id});if("messages"===TS.search.filter){$("#search_tabs").show();$(".search_sort_container").show()}else if("files"===TS.search.filter){$("#search_tabs").slideDown(500);$(".search_sort_container").hide();if("files"===t&&!i&&TS.model.active_file_list_filter!==TS.search.filetype)TS.search.setFiletypeFilter(TS.model.active_file_list_filter)}else if(TS.search.sliFileSearchIsEnabled()&&"all"===TS.search.filter)$(".search_sort_container").hide()},maybeRebuildResults:function e(){var t=$("#search_message_results");if(!t.length||!t.children().length)TS.search.search_filter_set_sig.dispatch()},cleanResults:function e(){if(TS.search.view.search_results_lazy_load&&TS.search.view.search_results_lazy_load.detachEvents)TS.search.view.search_results_lazy_load.detachEvents();$("#search_results_team").empty();$("#search_results_items").empty()},clearFiletypeFilter:function e(){TS.search.setFiletypeFilter("all")},maybeResetSearch:function e(){if(!TS.search.view.searchIsVisible())TS.search.setSort("timestamp",true)},searchIsVisible:function e(){return TS.model.ui_state.flex_visible&&"search"===TS.model.ui_state.flex_name},updateOptions:function e(){var t={search_filter:TS.search.filter,sort_filter:TS.search.sort,search_only_my_channels:TS.model.prefs.search_only_my_channels,menu_is_showing:TS.menu.search_filter_is_showing};var i=TS.search.results[TS.search.query];var n=TS.i18n.t("everything","search")();var a=TS.model.prefs.search_only_my_channels;var r=TS.model.prefs.search_exclude_bots;var s=TS.model.prefs.search_only_current_team;var o=false;if(i&&i.ignored_exclude_bots_pref&&i.messages&&i.messages.total>0)o=true;var l="";if(o){var d=m(TS.search.query_string);l=TS.i18n.listify(d)}var c="messages"===TS.search.filter?"messages":"files";if(a&&r)if(o)if("messages"===c)n=TS.i18n.t("only channels I have joined, messages from {names}","search")({names:l});else n=TS.i18n.t("only channels I have joined, files from {names}","search")({names:l});else n=TS.i18n.t("only channels I have joined, no bots or integrations","search")();else if(a&&!r)if("messages"===c)n=TS.i18n.t("only messages from channels I have open","search")();else n=TS.i18n.t("only files from channels I have open","search")();else if(!a&&r)if(o)if("messages"===c)n=TS.i18n.t("messages from {names}","search")({names:l});else n=TS.i18n.t("files from {names}","search")({names:l});else if("messages"===c)n=TS.i18n.t("only messages from people","search")();else n=TS.i18n.t("only files from people","search");if(TS.boot_data.page_needs_enterprise){var _=TS.model.enterprise.name;var u={org_bots_allchannels:TS.i18n.t("everything I can access in {org_name}","search")({org_name:_}),org_bots_openchannels:TS.i18n.t("only messages from channels I have open in {org_name}","search")({org_name:_}),org_nobots_allchannels:TS.i18n.t("only messages from people in {org_name}","search")({org_name:_}),org_nobots_openchannels:TS.i18n.t("messages from people in all channels I have open in {org_name}","search")({org_name:_}),noorg_bots_allchannels:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("everything in this workspace","search")():TS.i18n.t("everything on this team","search")(),noorg_bots_openchannels:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("only messages from channels I have open in this workspace","search")():TS.i18n.t("only messages from channels I have open on this team","search")(),noorg_nobots_allchannels:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("only messages from people in this workspace","search")():TS.i18n.t("only messages from people on this team","search")(),noorg_nobots_openchannels:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("messages from people, in only channels I have open, in this workspace","search")():TS.i18n.t("messages from people, in only channels I have open, on this team","search")()};if(!s&&!a&&!r)n=u.org_bots_allchannels;else if(!s&&a&&!r)n=u.org_bots_openchannels;else if(!s&&!a&&r)n=u.org_nobots_allchannels;else if(!s&&a&&r)n=u.org_nobots_openchannels;else if(s&&!a&&!r)n=u.noorg_bots_allchannels;else if(s&&a&&!r)n=u.noorg_bots_openchannels;else if(s&&!a&&r)n=u.noorg_nobots_allchannels;else if(s&&a&&r)n=u.noorg_nobots_openchannels}t.include_text=n;var f=TS.templates.search_options(t);$("#search_options").html(f);if(TS.search.results[TS.search.query]){var h=i&&i.initial_messages_total?i.initial_messages_total:0;var g=i&&i.initial_files_total?i.initial_files_total:0;$("#search_tabs").html(TS.templates.search_tabs({messages_count:TS.i18n.number(h),files_count:TS.i18n.number(g),show_all_tab:TS.search.sliFileSearchIsEnabled()}))}if("files"===TS.search.filter){$("#search_heading").html(TS.templates.search_files_heading({filetype:TS.search.filetype,filetype_label:TS.model.file_list_type_map[TS.search.filetype],show_feedback:"model"===TS.experiment.getGroup("search_feedback"),user_id:TS.boot_data.user_id,team_id:TS.boot_data.team_id}));$("#search_file_list_heading").bind("click.show_menu",function(e){e.preventDefault();TS.menu.file.startWithFileFilter(e,true)});$("#search_file_list_clear_filter").bind("click.clear_filter",function(e){e.stopPropagation();TS.search.view.clearFiletypeFilter()})}else $("#search_heading").html(TS.i18n.t("Search Results","search")());$(".search_filter_menu_target").click(TS.menu.startWithSearchFilter)},switchBackToFiles:function e(){if(TS.search.results[TS.search.query]){var t=(Date.now()-TS.search.results[TS.search.query]._time_of_search)/1e3;if(t<60){TS.client.ui.files.filterFileList(TS.search.filetype);if(TS.search.member)TS.client.ui.files.toggleFileList(TS.search.member.id);else TS.client.ui.files.toggleFileList("all")}else{TS.client.ui.files.filterFileList("all");TS.client.ui.files.toggleFileList("all")}}$("#search_tabs").slideUp(250,function(){setTimeout(function(){TS.client.ui.files.showFileList()},100)})},searchMembers:function e(){var t=$("#search_results_team");var i=new RegExp("\\b"+TS.utility.regexpEscape(TS.search.query_string_for_display)+"\\b","i");t.removeClass("hidden");var n=TS.search.query.toLowerCase();var a=TS.search.query_string_for_display.toLowerCase();var r=TS.members.getMembersForUser();var s=$.grep(r,function(e){if(!e.deleted){if(TS.boot_data.feature_name_tagging_client)return e._name_lc==a||e._display_name_lc==a||e.profile.real_name_normalized&&i.test(e.profile.real_name_normalized)||e._real_name_lc&&e._real_name_lc==a;return e._name_lc==a||e.profile.real_name_normalized&&i.test(e.profile.real_name_normalized)||e._real_name_lc&&e._real_name_lc==a}});if(0===s.length){var o=/from:@?(\S+)/gi;if(TS.boot_data.feature_more_texty_search)o=/from:<@([^>]+)>/gi;var l;var d;do{if(TS.boot_data.feature_more_texty_search)l=o.exec(TS.search.query);else l=o.exec(n);if(l&&l.length>1)for(d=0;d<r.length;d+=1)if(!r[d].deleted)if(TS.boot_data.feature_more_texty_search){if(r[d].id===l[1]){s.push(r[d]);break}}else if(r[d]._name_lc===l[1]){s.push(r[d]);break}}while(l)}if(s.length>0)t.html(TS.templates.search_team_results({matches:s}));else t.empty()},updateHistory:function e(){var t={filter:TS.search.filter,query:TS.search.query,channel_id:null,member_id:null};if(TS.search.channel)t.channel_id=TS.search.channel.id;if(TS.search.group)t.group_id=TS.search.group.id;if(TS.search.member)t.member_id=TS.search.member.id;var i="/search/";i+=TS.search.filter;i+="?q="+encodeURIComponent(TS.search.query);if(TS.qs_args)for(var n in TS.qs_args)if(TS.qs_args.hasOwnProperty(n))if("q"!==n)i+="&"+n+"="+TS.qs_args[n];if(i===window.location.pathname+window.location.search)window.history.replaceState(t,null,i);else window.history.pushState(t,null,i)},onPopState:function e(t){var i=t.state;if(!i)return;if(i.filter)TS.search.setFilter(i.filter);if(i.channel_id)TS.search.channel=TS.channels.getChannelById(i.channel_id);else TS.search.channel=null;if(i.group_id)TS.search.group=TS.groups.getGroupById(i.group_id);else TS.search.group=null;if(i.member_id)TS.search.member=TS.members.getMemberById(i.member_id);else TS.search.member=null;TS.search.searchAll(i.query)},messageSearchResultsFetched:function e(t,i){TS.search.view.latest_msg_search_results=t;var n=Date.now();var a=n-TS.search.view.added_to_history_last_ms;var r=a<5e3;TS.search.view.added_to_history_last_ms=n;if(TS.client)TS.client.flexDisplaySwitched("search",i.query_string,r)},search_interactions_logged:{},maybeLogSearchInteraction:function e(t){var i=TS.search.last_search_query;if(!i)return;if(TS.search.view.search_interactions_logged[t+"__"+i])return;TS.search.view.search_interactions_logged[t+"__"+i]=true;TS.search.saveSearch({type:t,terms:i})},messagesThemeChanged:function e(){if("search"===TS.model.ui_state.flex_name)TS.search.view.renderResults()},msgHasExtracts:function e(t){if(t.extracts&&t.extracts.length>0)return true;var i;if(t.attachments)for(var n=0;n<t.attachments.length;n+=1){i=t.attachments[n];if(i.extracts&&Object.keys(i.extracts).length>0)return true}return false},resultHasExtracts:function e(t){return TS.search.view.msgHasExtracts(t)||t.previous&&TS.search.view.msgHasExtracts(t.previous)||t.previous_2&&TS.search.view.msgHasExtracts(t.previous_2)||t.next&&TS.search.view.msgHasExtracts(t.next)||t.next_2&&TS.search.view.msgHasExtracts(t.next_2)},determineMessageResultType:function e(t,i){if(TS.search.view.msgHasExtracts(t[i]))return"extract";if(i-1>=0)if(TS.search.view.msgHasExtracts(t[i-1]))return"context";if(i+1<t.length)if(TS.search.view.msgHasExtracts(t[i+1]))return"context";return"extra"},getMatchForSearchResult:function e(t){var i=t.closest(".search_message_result");if(!i.length)return null;var n=i.data("channel");var a=""+i.data("ts");var r;var s=i.data("module-name");if("score_top_results"===s)r=TS.search.getMatchByQueryAndChannelAndTsAndModule(true,TS.search.view.latest_msg_search_results.query,n,a,"score");else r=TS.search.getMatchByQueryAndChannelAndTs(TS.search.view.latest_msg_search_results.query,n,a);return r},firstResultWithExtracts:function e(t){return f(t)},toggleExtractsForMatch:function e(t,i){var n=$(t.target);var a=i.match;var r=n.closest(".search_message_result");var s=r.data("module-name")||"";var o=r.data("module-order")||0;var l=n.closest("ts-message");var _=l.data("iid")||"";var u={click_target_type:a.extracts_expanded?"collapse":"expand",click_position:i.index,click_user_id:a.user,click_channel_id:a.channel.id,click_timestamp:a.ts,click_module_name:s,click_module_position:o,click_sort:TS.search.sort};var m=n.closest("ts-message");if(m.length){u.click_target_user_id=m.data("memberId");u.click_target_timestamp=""+m.data("ts")}if(TS.search.last_request_id)u.request_id=TS.search.last_request_id;if(_)u.click_iid=_;TS.clog.track("SEARCH_CLICK",u);if(a.extracts_expanded)c(a,n.closest(".search_result_with_extract, .search_result_for_context, .search_result_for_extra_context"));else d(a,n.closest(".search_result_with_extract, .search_result_for_context, .search_result_for_extra_context"))}});var e;var t;var i=false;var n=function i(){if("search"!==TS.model.ui_state.flex_name)return;TS.client.ui.checkInlineImgsAndIframes("search");if("files"===TS.search.filter)t=$("#search_results").scrollTop();else e=$("#search_results").scrollTop()};n=_.debounce(n,250);var a=function t(i,n){e=null;if(1==n.page){TS.search.view.current_messages_page=1;TS.search.view.waiting_on_messages_page=-1;if("messages"===TS.search.filter||TS.search.sliFileSearchIsEnabled()&&"all"===TS.search.filter){TS.search.view.renderResults();TS.search.view.messageSearchResultsFetched(i,n);if("messages"===TS.search.filter)TS.search.view.searchMembers()}else TS.search.view.updateOptions()}else if(n.page==TS.search.view.waiting_on_messages_page)if("messages"===TS.search.filter)TS.search.view.renderResults()};var r=function e(i,n){t=null;if(1==n.page){TS.search.view.current_files_page=1;TS.search.view.waiting_on_files_page=-1;if("files"===TS.search.filter){TS.search.view.renderResults();TS.search.view.messageSearchResultsFetched(i,n);TS.search.view.searchMembers()}else TS.search.view.updateOptions()}else if(n.page==TS.search.view.waiting_on_files_page)if("files"===TS.search.filter)TS.search.view.renderResults()};var s=function e(t){if("timestamp"===TS.search.sort){$("#search_sort_timestamp").addClass("active");$("#search_sort_score").removeClass("active");$("#search_sort_score").removeClass("flash");$("#search_sort_model").removeClass("active")}else if("model"===TS.search.sort&&"model"===TS.experiment.getGroup("search_ranking")){$("#search_sort_timestamp").removeClass("active");$("#search_sort_score").removeClass("active");$("#search_sort_score").removeClass("flash");$("#search_sort_model").addClass("active")}else{$("#search_sort_timestamp").removeClass("active");$("#search_sort_score").addClass(t?"active flash":"active");$("#search_sort_model").removeClass("active")}};var o=function e(t){if(!t.messages)return;var i=[];t.messages.matches.forEach(function(e){e._dom_id=TS.templates.makeMsgDomIdInSearch(e.ts,e);i.push(e);["previous_2","previous","next","next_2"].forEach(function(t){if(e[t]){e[t].channel=e.channel;e[t]._main=e;e[t]._dom_id=TS.templates.makeMsgDomIdInSearch(e[t].ts,e);i.push(e[t])}})});if(_.has(t.messages,"modules.score.top_results"))_.forEach(t.messages.modules.score.top_results,function(e){e._dom_id=TS.templates.makeMsgDomIdInSearchTopResults(e.ts,e,"sort_top_results");e._dom_container_id="search_module_results";i.push(e)});if(!TS.model.prefs.full_text_extracts){var n={};i.forEach(function(e){if(TS.boot_data.page_needs_enterprise){var t=TS.utility.msgs.allUnknownUsersInMessage(e);if(t.length)t.forEach(function(t){if(!n[t])n[t]=e})}l(i,e,false)});if(_.keys(n).length)TS.members.ensureMembersArePresent(_.keys(n)).then(function(){_.keys(n).forEach(function(e){var t=n[e];l(i,t,true)})})}};var l=function e(t,i,n){if(_.isUndefined(n))n=false;var a;var r;if(!TS.search.view.msgHasExtracts(i))return;var s=i._dom_container_id?"#"+i._dom_container_id:"#search_message_results";if(i._main&&i._main.ts&&!i._dom_container_id)s+=' [data-ts="'+i._main.ts+'"]';s+=" #"+i._dom_id;a=$(s);if(0===a.length)return;r=TS.templates.search_message_extracts({message:i});if(n)a.find(".message_body.extract_content").replaceWith(r);else a.find(".message_body").before(r)};var d=function e(t,i){t.extracts_expanded=true;var n=i.closest(".search_message_result");var a=n.data("module-name");var r;if("score_top_results"===a)r=$("#search_results_items").find("#"+TS.templates.makeMSRDomIdWithModule(t,a));else r=$("#search_results_items").find("#"+TS.templates.makeMSRDomId(t));u(r,i)};var c=function e(t,i){t.extracts_expanded=false;var n=i.closest(".search_message_result");var a=n.data("module-name");var r;if("score_top_results"===a)r=$("#search_results_items").find("#"+TS.templates.makeMSRDomIdWithModule(t,a));else r=$("#search_results_items").find("#"+TS.templates.makeMSRDomId(t));var s=true;u(r,i,s)};var u=function e(t,i,n){TS.ui.utility.preventElementFromScrolling(i,function(){t.toggleClass("extracts_expanded",!n)})};var m=function e(t){var i=/from:@?(\S+)/gi;if(TS.boot_data.feature_more_texty_search)i=/from:<(@[^>]+)>/gi;var n=/bot:?(\S+)/gi;var a=[];var r;var s;do{r=i.exec(t);if(r&&r.length>1)if(TS.boot_data.feature_more_texty_search){var o=r[1].split("|");a.push(o[1])}else a.push(r[1])}while(r);do{s=n.exec(t);if(s&&s.length>1)a.push(s[1])}while(s);return a};var f=function e(t){var i=[t.previous_2,t.previous,t,t.next,t.next_2];var n;for(var a=0;a<i.length;a+=1){n=i[a];if(!n)continue;if(n.extracts&&n.extracts.length)return n}return t}})()},4380:function(e,t){(function(){"use strict";TS.registerModule("search.autocomplete",{last_input_blur_logged:"",input_events:{},onStart:function t(){TS.search.search_dispatched_sig.add(TS.search.autocomplete.startSpinner,TS.search.autocomplete);TS.search.all_search_results_fetched_sig.add(u);TS.search.message_search_results_fetched_sig.add(H);TS.search.file_search_results_fetched_sig.add(N);if(TS.client){TS.search.search_channel_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete);TS.search.search_group_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete);TS.search.search_member_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete);TS.client.flexpane_display_switched_sig.add(G);if(!TS.boot_data.feature_texty_search)TS.client.login_sig.add(function(){if(!TS.utility.contenteditable.isEmpty(e,true))TS.search.autocomplete.setUpMenu()})}if(TS.web)TS.search.quick_search_results_fetched_sig.add(TS.search.autocomplete.stopSpinner,TS.search.autocomplete);TS.search.autosuggest_search_results_fetched_sig.add(c);TS.search.autocomplete.bindUI();d()},search:function i(n,a){if(!TS.boot_data.feature_texty_search)j("preventMenuOnNextFocus");TS.utility.contenteditable.value(e,n);TS.utility.contenteditable.focus(e);if(!TS.boot_data.feature_texty_search)e.removeClass("placeholder");if(a)t.submit()},bindUI:function n(){t=$("#header_search_form");i=$("#search_container");e=$("#search_terms");if(!TS.boot_data.feature_texty_search)e.one("focus",TS.search.autocomplete.setUpMenu);TS.search.autocomplete.bindForm()},setUpMenu:_.once(function(){var t=b();if(TS.boot_data.feature_texty_search)e.autocomplete({append_to:"#header_search_form",data:t,registerInputEvents:function e(t){TS.search.autocomplete.input_events=t}});else{e.highlighter({modifiers:t.modifiers});e.autocomplete({append_to:"#header_search_form",data:t})}}),triggerInputEvent:function e(t,i){if(!t)return;if(!_.isFunction(TS.search.autocomplete.input_events[t])){TS.warn('TS.search.autocomplete: input event "'+t+'" not found');return}TS.search.autocomplete.input_events[t](i)},onInputFocus:function t(){if(!TS.utility.contenteditable.isEmpty(e,true)){if("search"!==TS.model.ui_state.flex_name)j("preventMenuOnNextFocus");if(TS.search.searchSessionExpired())TS.search.view.maybeResetSearch();else{TS.search.view.showResults();TS.search.view.maybeRebuildResults()}}if(!TS.boot_data.feature_texty_search)TS.utility.contenteditable.setCursorAtEnd(e)},bindForm:function i(){var n=$("#client-ui");var a=false;var r;var s=false;var l=false;if(TS.client){t.bind("submit",function(){r=!TS.utility.contenteditable.isEmpty(e,true);if(r){o(true);if(!TS.boot_data.feature_texty_search)e.trigger("change")}return false});if(!TS.boot_data.feature_texty_search)e.bind("focus",TS.search.autocomplete.onInputFocus)}n.on("transitionend",function(){if(a!==s||TS.model.ui_state.flex_visible!==l){s=a;l=TS.model.ui_state.flex_visible;d()}});$("#search_clear").bind("click.clear_input",function(){TS.search.autocomplete.clearInput()}).bind("mousedown.clear_input",function(e){e.preventDefault()});if(!TS.boot_data.feature_texty_search){e.bind("focus.set_cursor",function(){e.setCursorPosition(e.val().length)});e.bind("keyup change focus blur",function(){if($(this).val())t.addClass("active");else t.removeClass("active")});e.bind("focus",function(){n.addClass("search_focused");a=true}).bind("blur",function(){n.removeClass("search_focused");a=false})}},maybeLogSearchInputBlur:function e(){var t=TS.search.last_search_query;if(!t)return;if(TS.search.autocomplete.last_input_blur_logged==t)return;TS.search.autocomplete.last_input_blur_logged=t;TS.search.saveSearch({terms:t})},clearInput:function t(){l();TS.utility.contenteditable.clear(e);if(!TS.boot_data.feature_texty_search)e.trigger("change");j("hide");j("preventMenuOnNextFocus");TS.utility.contenteditable.focus(e)},updateInput:function t(){if(TS.search.query){TS.utility.contenteditable.value(e,TS.search.query_string);if(!TS.boot_data.feature_texty_search)e.trigger("change")}},startSpinner:function e(){clearTimeout(a);a=setTimeout(function(){if(!$("#search_spinner").length){t.find(".icon_search").addClass("hidden");var e=$("#header_search_form .icon_search");var i=TS.templates.loading_indicator({id:"search_spinner"});e.after(i)}},200)},stopSpinner:function e(){clearTimeout(a);$("#search_spinner").remove();t.find(".icon_search").removeClass("hidden");if(n)n.stop()}});var e;var t;var i;var n;var a;var r;var s="";var o=function t(i){l();var n=TS.utility.contenteditable.value(e).trim();if(!i&&n===TS.search.query_string)return;if(s===n){TS.search.view.showResults();return}if(""===n){if("files"===TS.search.filter)TS.search.view.switchBackToFiles()}else if(n.length>=2||i){s=n;TS.search.searchAll(n)}};var l=function e(){clearTimeout(TS.search.autocomplete.key_tim)};var d=_.throttle(function(){if(!i)return;TSSSB.call("updateNoDragRegion",{id:"search",width:i.outerWidth(),height:i.outerHeight(),top:i.offset().top,left:i.offset().left})},250);var c=function e(t,i){var n=i.query;var a=t.suggestions;var s=r;if(!s)return;s(n,a)};var u=function e(){s=null;TS.search.autocomplete.stopSpinner()};var m=[TS.i18n.t("monday","search_menu")(),TS.i18n.t("tuesday","search_menu")(),TS.i18n.t("wednesday","search_menu")(),TS.i18n.t("thursday","search_menu")(),TS.i18n.t("friday","search_menu")(),TS.i18n.t("saturday","search_menu")(),TS.i18n.t("sunday","search_menu")(),TS.i18n.t("yesterday","search_menu")(),"monday","tuesday","wednesday","thursday","friday","saturday","sunday","yesterday"];var f=[TS.i18n.t("january","search_menu")(),TS.i18n.t("february","search_menu")(),TS.i18n.t("march","search_menu")(),TS.i18n.t("april","search_menu")(),TS.i18n.t("may","search_menu")(),TS.i18n.t("june","search_menu")(),TS.i18n.t("july","search_menu")(),TS.i18n.t("august","search_menu")(),TS.i18n.t("september","search_menu")(),TS.i18n.t("october","search_menu")(),TS.i18n.t("november","search_menu")(),TS.i18n.t("december","search_menu")(),"january","february","march","april","may","june","july","august","september","october","november","december"];var h=[TS.i18n.t("today","search_menu")(),TS.i18n.t("week","search_menu")(),TS.i18n.t("month","search_menu")(),TS.i18n.t("year","search_menu")(),"today","week","month","year"];var g=m.concat(h,f);var p=function e(t){return L(t)};var S=function e(t){return L(t,true)};var T=[{modifier:"after:",name:TS.i18n.t("after:","search")(),keywords:m.concat(f),dynamic_keywords:[p],keyword_placeholder:TS.i18n.t("a date","search")()},{modifier:"before:",name:TS.i18n.t("before:","search")(),keywords:g,dynamic_keywords:[S],keyword_placeholder:TS.i18n.t("a date","search")()},{modifier:"during:",name:TS.i18n.t("during:","search")(),keywords:g,dynamic_keywords:[p],keyword_placeholder:TS.i18n.t("a month or year","search")()},{modifier:"from:",name:TS.i18n.t("from:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.boot_data.feature_teams_to_workspaces?TS.boot_data.feature_more_texty_search?TS.i18n.t("@workspace member","search")():TS.i18n.t("workspace member","search")():TS.boot_data.feature_more_texty_search?TS.i18n.t("@team member","search")():TS.i18n.t("team member","search")()},{modifier:"to:",name:TS.i18n.t("to:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.i18n.t("a channel, group or direct message","search")()},{modifier:"has:",name:TS.i18n.t("has:","search")(),keywords:[TS.i18n.t("star","search")(),TS.i18n.t("pin","search")(),TS.i18n.t("link","search")(),TS.i18n.t("reaction","search")()],keyword_placeholder:TS.i18n.t("star, pin, link, or reaction","search")()},{modifier:"in:",name:TS.i18n.t("in:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.i18n.t("a channel, group or direct message","search")()},{modifier:"on:",name:TS.i18n.t("on:","search")(),keywords:g,dynamic_keywords:[p],keyword_placeholder:TS.i18n.t("a date","search")()}];var v;var b=function e(){if(!v){v={modifiers:T,modifiers_by_name:{},users:function e(){return TS.members.getMembersForUser()},usersStarred:function e(){var t=[];var i;TS.model.ims.forEach(function(e){if(e.is_slackbot_im||!e.is_open)return;i=TS.members.getMemberById(e.user);if(!i||i.deleted||i.is_self)return;if(e.is_starred)t.push(e)});t.sort(w);return t.map(function(e){return TS.members.getMemberById(e.user)})},usersOpen:function e(){var t=[];var i;TS.model.ims.forEach(function(e){if(e.is_slackbot_im||!e.is_open)return;i=TS.members.getMemberById(e.user);if(!i||i.deleted||i.is_self)return;if(!e.is_starred)t.push(e)});t.sort(w);return t.map(function(e){return TS.members.getMemberById(e.user)})},channels:function e(){return TS.channels.getChannelsForUser()},channelsOpen:function e(){var t=TS.channels.getChannelsForUser();var i=[];var n;var a;for(n=0;n<t.length;n+=1){a=t[n];if(a.is_starred)continue;if(a.is_archived)continue;if(!a.is_member)continue;i.push(a)}i.sort(y);return i},groups:function e(){return TS.model.groups},groupsOpen:function e(){var t=TS.model.groups;var i=[];var n;var a;for(a=0;a<t.length;a+=1){n=t[a];if(n.is_archived)continue;if(n.is_starred)continue;i.push(n)}i.sort(y);return i},conversationsStarred:function e(){var t=[];var i=v.usersStarred();var n=[];TS.channels.getChannelsForUser().forEach(function(e){if(!e.is_archived&&e.is_starred&&e.is_member)t.push(e)});TS.model.groups.forEach(function(e){if(!e.is_archived&&e.is_starred)n.push(e)});var a=t.concat(i,n);a.sort(TS.client.channel_pane.modelObSortByStarredOrder);return a},history:function e(t,i){t=t||"";r=i;TS.search.searchSuggest(t)},deleteHistoryItem:function e(t){if(TS.boot_data.feature_more_texty_search)t=TS.format.texty.convertContentsStringForSearch(t);TS.api.call("search.delete",{terms:t})},triggerSearch:function e(){o(true)},triggerDelayedSearch:function e(t){TS.search.autocomplete.key_tim=setTimeout(function(){o()},t||3e3)},cancelSearch:function e(){l()},openProfile:function e(t){TS.client.ui.previewMember(t)},openBotProfile:function e(t,i){TS.apps.promiseToGetFullAppProfile(t,i).then(function(e){TS.client.ui.app_profile.openWithApp(e,t,i)})}};v.modifiers.forEach(function(e){e.keyword_testers=[];if(e.keywords.length>0){var t=new RegExp("^("+e.keywords.join("|")+")$","i");e.keyword_testers=[function(e){return t.test(e)}]}switch(e.modifier){case"from:":e.keyword_testers.push(k);e.keyword_testers.push(M);break;case"before:":e.keyword_testers.push(function(e){return L(e,true)});break;case"after:":case"during:":case"on:":e.keyword_testers.push(L);break;case"in:":case"to:":e.keyword_testers.push(k);e.keyword_testers.push(A);e.keyword_testers.push(C);e.keyword_testers.push(I);e.keyword_placeholder=TS.i18n.t("channel or direct message","search")()}v.modifiers_by_name[e.modifier]=e;v.modifiers_by_name[e.name]=e;v.modifiers_by_name[TS.i18n.deburr(e.name)]=e})}return v};var w=function e(t,i){var n=TS.ims.getDisplayNameOfUserForImLowerCase(t);var a=TS.ims.getDisplayNameOfUserForImLowerCase(i);if(n>a)return 1;if(a>n)return-1;return 0};var y=function e(t,i){var n=t._name_lc;var a=i._name_lc;if(n<a)return-1;if(n>a)return 1;return 0};var k=function e(t){if("@"===t.charAt(0))t=t.substring(1);return TS.members.getMemberByName(t)};var A=function e(t){if("#"===t.charAt(0))t=t.substring(1);return TS.channels.getChannelByName(t)};var C=function e(t){return TS.groups.getGroupByName(t)};var M=function e(t){var i=B().name_map;t=_.toLower(t);return i[t]};var I=function e(t){if(-1===t.indexOf(","))return false;var i=t.split(",");return _.every(i,function(e){if("@"===e.charAt("0"))e=e.substring(1);return!!TS.members.getMemberByName(e)})};var x;var E=0;var B=function e(){if(Date.now()-E>3e4){var t={};var i=[];TS.model.bots.forEach(function(e){var n=_.toLower(e.name);if(!e.deleted&&!t[n]&&"slackbot"!==n){t[n]=true;i.push(e)}});x={bots:i,name_map:t}}return x};var D=/^(\d\d?)[-/](\d\d?)[-/](\d\d\d\d)$/;var F=/^(\d\d\d\d)[-/](\d\d?)[-/](\d\d?)$/;var P=/^(\d\d)[-/](\d\d?)[-/](\d\d?)$/;var O=/^\d\d\d\d$/;var R=/^(\d\d\d\d)[-/](\d\d?)$/;var U=1900;var Q=2999;var L=function e(t,i){var n;var a;var r;var s;var o=new Date;if(O.test(t)){n=parseInt(t,10);if(!i&&n>o.getFullYear())return false;if(n<U)return false;if(i&&n>Q)return false;return true}s=D.exec(t);if(s){n=s[3];a=s[1];r=s[2]}s=!n&&F.exec(t);if(s){n=s[1];a=s[2];r=s[3]}s=!n&&P.exec(t);if(s){n=s[1];a=s[2];r=s[3]}s=!n&&R.exec(t);if(s){n=s[1];a=s[2];r="1"}if(!n)return false;n=parseInt(n,10);a=parseInt(a,10);r=parseInt(r,10);if(n<1||a<1||r<1)return false;if(n<100)n+=2e3;if(!i&&n>o.getFullYear())return false;if(n<U)return false;if(i&&n>Q)return false;if(a>12)return false;if(!i&&n===o.getFullYear()&&a>o.getMonth()+1)return false;if(r>31)return false;if(!i&&n===o.getFullYear()&&a===o.getMonth()+1&&r>o.getDate())return false;if(r>30&&(4===a||6===a||9===a||11===a))return false;if(2===a&&r>29)return false;if(2===a&&29===r)if(n%4!==0)return false;else if(n%100!==0)return true;else if(n%400!==0)return false;return true};var H=function e(){if("messages"===TS.search.filter)TS.search.autocomplete.stopSpinner()};var N=function e(){if("files"===TS.search.filter)TS.search.autocomplete.stopSpinner()};var G=function e(){if(!TS.model.ui_state.flex_visible||"search"!==TS.model.ui_state.flex_name)l()};var j=function t(){TS.search.autocomplete.setUpMenu();e.autocomplete.apply(e,arguments)}})()},4381:function(e,t){(function(){"use strict";TS.registerModule("ui.purpose_dialog",{div:null,showing:false,model_ob:null,onStart:function e(){},onKeydown:function e(t){if(t.which==TS.utility.keymap.enter){if(t.shiftKey)return;TS.ui.purpose_dialog.go();t.preventDefault()}else if(t.which==TS.utility.keymap.esc)TS.ui.purpose_dialog.cancel()},start:function e(t,i){if(TS.client.ui.checkForEditing())return;TS.ui.purpose_dialog.model_ob=i;TS.ui.purpose_dialog.is_group=TS.ui.purpose_dialog.model_ob.is_group;if(!TS.ui.purpose_dialog.div)TS.ui.purpose_dialog.build();var n=TS.ui.purpose_dialog.div;var a=TS.templates.purpose_dialog({model_ob:TS.ui.purpose_dialog.model_ob,is_group:TS.ui.purpose_dialog.is_group});n.empty();n.html(a);if(TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()){var r=n.find("#purpose_input");TS.utility.contenteditable.create(r,{modules:{tabcomplete:{positionMenu:function e(t){t.style.width=r.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,r)},searchOptions:{complete_member_specials:false},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members]}},onEnter:function e(t){if(t.shiftKey)return true;TS.ui.purpose_dialog.go();return false},onEscape:function e(){TS.ui.purpose_dialog.cancel()},onTextChange:function e(){TS.client.channel_page.updatePurposeTooLongWarning(r)}});TS.utility.contenteditable.enable(r);TS.utility.contenteditable.value(r,TS.utility.unformatTopicOrPurpose(TS.ui.purpose_dialog.model_ob.purpose.value))}n.find(".dialog_cancel").click(TS.ui.purpose_dialog.cancel);n.find(".dialog_go").click(TS.ui.purpose_dialog.go);n.modal("show")},go:function e(){if(!TS.ui.purpose_dialog.showing){TS.error("not showing?");return}var t=TS.ui.purpose_dialog.div;var i=t.find("#purpose_input");if(TS.client.channel_page.isPurposeTooLong(i))return;var n=_.trim(TS.utility.contenteditable.value(i));if(TS.ui.purpose_dialog.is_group)TS.groups.setPurpose(TS.ui.purpose_dialog.model_ob.id,n);else TS.channels.setPurpose(TS.ui.purpose_dialog.model_ob.id,n);t.modal("hide")},cancel:function e(){TS.ui.purpose_dialog.div.modal("hide")},end:function e(){TS.model.dialog_is_showing=false;TS.ui.purpose_dialog.showing=false;if(!(TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()))$(window.document).unbind("keydown",TS.ui.purpose_dialog.onKeydown)},build:function e(){$("body").append('<div id="purpose_dialog" class="modal hide fade"></div>');TS.ui.purpose_dialog.div=$("#purpose_dialog");var t=TS.ui.purpose_dialog.div;t.on("hide",function(e){if(e.target!=this)return;TS.ui.purpose_dialog.end();t.removeAttr("data-qa")});t.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.purpose_dialog.showing=true});t.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){TS.utility.contenteditable.focus(t.find("#purpose_input"));if(!(TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()))$(window.document).bind("keydown",TS.ui.purpose_dialog.onKeydown);t.attr("data-qa","purpose_dialog_ready")},100)})}})})()},4382:function(e,t){(function(){"use strict";TS.registerModule("ui.growls",{no_notifications:false,permission_changed_sig:new signals.Signal,onStart:function e(){TS.ui.growls.updateTotalUnreadDisplaysSSBThrottled=TS.utility.throttleFunc(TS.ui.growls.updateTotalUnreadDisplaysSSB,500,true);TS.channels.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.channels.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.groups.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.groups.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.ims.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.ims.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.mpims.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.mpims.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);else TS.ms.connected_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.prefs.mac_ssb_bullet_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.client.threads.threads_unread_changed.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls);TS.ui.window_focus_changed_sig.add(TS.ui.growls.windowFocusChanged,TS.ui.growls);if(window.macgap);else if(window.Notification||window.webkitNotifications);else if(window.winssb);else{TS.ui.growls.no_notifications=true;return}TS.channels.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls);TS.groups.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls);TS.mpims.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls);TS.ims.message_received_sig.add(TS.ui.growls.imMessageReceived,TS.ui.growls)},shouldShowPermissionButton:function e(){if(TS.ui.growls.no_notifications)return false;if(TS.ui.growls.checkPermission())return false;if("denied"===TS.ui.growls.getPermissionLevel())return false;return true},checkPermission:function e(){if(TS.ui.growls.no_notifications)return false;if(window.macgap)return true;if(window.winssb)return true;return"granted"===TS.ui.growls.getPermissionLevel()},perm_map:{0:"granted",1:"default",2:"denied"},getPermissionLevel:function e(){if(TS.ui.growls.no_notifications)return"na";if(window.macgap)return"na";if(window.winssb)return"na";if(window.webkitNotifications&&window.webkitNotifications.checkPermission)return TS.ui.growls.perm_map[window.webkitNotifications.checkPermission()];else if(window.Notification)return window.Notification.permission},promptForPermission:function e(t){if(TS.ui.growls.no_notifications){if(t)t(false,-9999999);return}var i=function e(){if(t)t(TS.ui.growls.checkPermission(),TS.ui.growls.getPermissionLevel());TS.ui.growls.permission_changed_sig.dispatch(TS.ui.growls.checkPermission(),TS.ui.growls.getPermissionLevel())};if(window.webkitNotifications&&window.webkitNotifications.requestPermission&&window.webkitNotifications.checkPermission)window.webkitNotifications.requestPermission(i);else if(window.Notification)window.Notification.requestPermission(i)},show:function e(t,i,a,r){r=r||{};var s=r.msg;var o=r.channelId;var l=r.subtitle;var d=r.launchUri;var c=r.soundUrl;var _=TS.sounds.filenameForSoundName(r.sound_name||"new_message");var u=r.imageUri;var m=r.avatarImage;if(TS.utility.calls.isScreenSharing()&&!r.is_call_notification)return;if(!TS.ui.growls.checkPermission())return;var f;if(window.winssb){f={title:t,subtitle:l,content:i,launchUri:d,imageUri:u,channel:o||"",msg:s&&s.ts||"",avatarImage:m,ssbFilename:_};if(s&&s.thread_ts)f.thread_ts=s.thread_ts;TSSSB.call("notify",f);n(o,s)}else if(window.macgap){var h=function e(){window.focus();if(TS.boot_data.feature_focus_mode)if(TS.ui.focus_mode.is_in_focus_mode)TS.ui.focus_mode.end();if(a)a()};if(window.macgap.growl)window.macgap.growl.notify({title:t,content:i,onclick:h,channel:o||""});else if(window.macgap.notice)TSSSB.call("notify",{title:t,subtitle:l,content:i,soundUrl:c,ssbFilename:_,onclick:h,channel:o||"",msg:s&&s.ts||""})}else{var g;if(window.webkitNotifications)g=window.webkitNotifications.createNotification(TS.boot_data.img.app_icon,t,i);else if(window.Notification)g=new Notification(t,{body:i,icon:TS.boot_data.img.app_icon,tag:"tag_"+(s?s.id||s.ts||Date.now():Date.now())});if(!g)return;try{g.onclick=function(){window.focus();if(TS.boot_data.feature_focus_mode)if(TS.ui.focus_mode.is_in_focus_mode)TS.ui.focus_mode.end();if(a)a();if(this.cancel)this.cancel();else if(this.close)this.close()}}catch(e){}var p=function e(){setTimeout(function(){if(g.cancel)g.cancel();else if(g.close)g.close()},i&&i.length>80?1e4:5e3)};if(g)try{g.onshow=p;setTimeout(p,1e3)}catch(e){p()}if(g.show)g.show()}},updateTotalUnreadDisplays:function e(t,i){if(window.macgap||window.winssb)if(i&&true===i)TS.ui.growls.updateTotalUnreadDisplaysSSBThrottled();else TS.ui.growls.updateTotalUnreadDisplaysSSB();if(TS.model.all_unread_highlights_cnt)TS.view.changeUnreadStatus("mentions");else if(TS.model.all_unread_cnt)TS.view.changeUnreadStatus("unreads");else TS.view.changeUnreadStatus("")},updateTotalUnreadDisplaysSSBThrottled:_.noop,updateTotalUnreadDisplaysSSB:function e(){var t=TS.model.all_unread_highlights_cnt;var i=TS.model.all_unread_cnt;if(TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts){if(TS.model.all_unread_highlights_cnt_to_exclude){if(TS.has_pri[a])TS.log(a,"updateTotalunreadDisplaysSSB: TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude);t=Math.max(0,t-TS.model.all_unread_highlights_cnt_to_exclude)}if(TS.model.all_unread_cnt_to_exclude){if(TS.has_pri[a])TS.log(a,"updateTotalunreadDisplaysSSB: TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude);i=Math.max(0,i-TS.model.all_unread_cnt_to_exclude)}}if(TS.has_pri[a])TS.log(a,"TSSSB.call('setBadgeCount') - all_unread_highlights_cnt = "+t+", all_unread_cnt = "+i+", bullet = "+((window.macgap||window.winssb?!!TS.model.prefs.mac_ssb_bullet:false)?"true":"false"));TSSSB.call("setBadgeCount",{all_unread_highlights_cnt:t,all_unread_cnt:i,bullet:window.macgap||window.winssb?!!TS.model.prefs.mac_ssb_bullet:false})},getGrowlableTxtFromFile:function e(t){if(!t||!t.file)return;var i=true;return TS.templates.builders.msgs.buildFileShareMetaText(t,i)},getGrowlableTxtFromAttachments:function e(t){for(var i=0;i<t.length;i+=1){var n=t[i];if(n.fallback)return n.fallback;else if(n.text)return n.text;else if(n.pretext)return n.pretext;else if(n.footer)return n.footer}return null},no_growl_subtypes:["channel_leave","channel_join","group_leave","group_join"],channelOrGroupMessageReceived:function t(i,n){if(!n){TS.error("no msg?");return}if(n.no_display)return;if(!i){TS.error("no channel/group?");return}e(i,n).then(function(){TS.ui.growls.growlChannelOrGroupMessage(i,n,true)})},growlChannelOrGroupMessage:function e(t,i,n,r){if(!i){TS.error("no msg?");return}if(i.no_display)return;if(!t){TS.error("no channel/group?");return}var s=TS.notifs.canCorGHaveChannelMentions(t.id);var o;var l;var d=true;var c=false;if(TS.utility.msgs.isMsgReply(i)){var _=TS.replies.getSubscriptionState(t.id,i.thread_ts);d=_&&_.subscribed;c=!d}if(s){var u="away"===TS.model.user.presence;if(TS.utility.msgs.isMsgReply(i))u=u||!d;o=TS.utility.msgs.msgContainsMention(i,u,c);if(o)TS.mentions.maybeUpdateMentions()}else{l=TS.utility.msgs.getMsgMentionData(i,c);o=l.non_channel_mentions;if(l.mentions)TS.mentions.maybeUpdateMentions()}if(!r&&i.subtype&&-1!=TS.ui.growls.no_growl_subtypes.indexOf(i.subtype))return;var m=TS.notifs.isCorGMuted(t.id);var f=TS.utility.msgs.msgCanCountAsUnread(i);var h=i._hidden_reply;var g=(f||h)&&o;var p=TS.ui.growls.containsCmd(i.text);var S=TS.notifs.getCalculatedCorGNotifySetting(t.id);if(!r&&"bot_message"===i.subtype&&"everything"!==S&&!o)return;if(n&&f&&!TS.model.ui.is_window_focused)if(g&&-1==document.title.indexOf("!"))document.title="! "+document.title;else if(!m&&-1==document.title.indexOf("*"))document.title="* "+document.title;if(!r&&"nothing"===S)return;if(TS.utility.msgs.isMsgReply(i)&&!r&&"everything"===S&&!d)S="mentions";if(!TS.ui.growls.checkPermission())return;var T=(t.id==TS.model.active_channel_id||t.id==TS.model.active_group_id||t.id==TS.model.active_mpim_id)&&!h&&!TS.client.activeChannelIsHidden();var v=i.thread_ts&&t.id===TS.ui.replies.activeConvoModelId()&&i.thread_ts===TS.ui.replies.activeConvoThreadTs();var b=false;if(g)b=true;if(h&&d&&TS.model.prefs.threads_everything&&"nothing"!==S)b=true;if("everything"===S)b=true;if(b&&(T||v)&&TS.model.ui.is_window_focused&&!p)b=false;if(b&&!s&&l&&l.mentions&&!l.non_channel_mentions)b=false;if(b&&(i.user==TS.model.user.id||i.comment&&i.comment.user==TS.model.user.id))b=false;if(b&&i.no_notifications)b=false;if(b&&m)if(TS.utility.msgs.isMsgReply(i)){if(!d)b=false}else b=false;if(b&&TS.dnd.isMemberInDnd(TS.model.user)&&!i._ignore_dnd)b=false;if(TS.shared.isModelObOrgShared(t)){var w=TS.shared.isRelevantTeamForSharedModelOb(t);if(!w){if(TS.has_pri[a]&&TS.model.is_our_app)TS.log(a,"Shared channel "+t.id+" is not relevant; suppressing notification.");b=false}else if(TS.pri)if(TS.model.is_our_app&&TS.has_pri[a])TS.log(a,"Shared channel "+t.id+" is relevant; allowing notification.")}if(TS.boot_data.feature_stop_loud_channel_mentions&&(b||r)){var y=TS.permissions.members.canMsgMentionChannelIfMention(i.text,t.id,i.user);if(!y){TS.log(67,"preventing over-size channel mention by "+i.user+" with ts = "+i.ts+" in "+t.id);return}}if(!b&&!r)return;var k=TS.ui.growls.extractFromNameFromCorGMessage(i);var A=function e(){if(i.thread_ts&&i.ts!=i.thread_ts){TS.ui.replies.openConversation(t,i.thread_ts,i.ts);return}if(TS.boot_data.feature_focus_mode)if(TS.ui.focus_mode.is_in_focus_mode)TS.ui.focus_mode.end();if(t.is_channel)TS.channels.displayChannel({id:t.id});else if(t.is_mpim)TS.mpims.displayMpim({id:t.id});else TS.groups.displayGroup({id:t.id})};var C=TS.ui.growls.extractTxtFromMsg(i,true);C=C.replace(":simple_smile:",":)");var M="";if(k)M=TS.model.prefs.no_text_in_notifications?TS.i18n.t("a message from {name}","growl")({name:k}):k+": ";M+=C;TS.ui.growls.maybeBounceDockIcon();var I;var x;var E="#"+t.name;if(t.is_mpim)E=TS.mpims.getDisplayName(t);if(TS.getOtherAccountsCount()>0&&(TS.ui.growls.canSpeak()||window.winssb))if(TS.model.supports_growl_subtitle){I=TS.model.team.name;x=E}else I=TS.i18n.t("[{team_domain}] in {channel}","growl")({team_domain:TS.model.team.domain,channel:E});else I=TS.i18n.t("New message in {channel}","growl")({channel:E});var $=TS.ui.growls.getProfileImageFromUserId(i.user);TS.utility.calls.getCallActive().then(function(e){var n="new_message";if(e)n="none";else if(!TSSSB.call("shouldAttachSoundToNotification")){TS.sounds.play("new_message");n="none"}TS.ui.growls.show(I,TS.format.formatNotification(M,i),A,{msg:i,channelId:t.id,subtitle:x,sound_name:n,launchUri:TS.ui.growls.getLaunchUriForChannel(t.id,i.ts),imageUri:TS.ui.growls.getAttachmentUri(i),avatarImage:$})})},getLaunchUriForChannel:function e(t,i){return t?"slack://channel?id="+t+"&message="+i+"&team="+TS.model.team.id:null},getAttachmentUri:function e(t){var i=t.attachments&&t.attachments.length>0&&t.attachments[0].image_url;return i&&TS.model.prefs.expand_inline_imgs?t.attachments[0].image_url:null},canSpeak:function e(){if(window.macgap&&macgap.app&&macgap.app.speakStringWithVoiceAndRateAndCallback)return true;return false},imMessageReceived:function t(i,n){if(!n){TS.error("no msg?");return}if(n.no_display)return;e(i,n).then(function(){TS.ui.growls.growlImMessage(i,n,true)})},growlImMessage:function e(t,i,n,r){if(!i){TS.error("no msg?");return}if(i.no_display)return;if(n&&!TS.model.ui.is_window_focused&&-1==document.title.indexOf("!"))document.title="! "+document.title;if(!r&&!TS.model.prefs.growls_enabled)return;if(!TS.ui.growls.checkPermission())return;var s=false;var o=t.id===TS.model.active_im_id&&!TS.client.activeChannelIsHidden();var l=TS.utility.msgs.isMsgReply(i);var d=l&&t.id===TS.ui.replies.activeConvoModelId()&&i.thread_ts===TS.ui.replies.activeConvoThreadTs();var c=true;if(l){var _=TS.replies.getSubscriptionState(t.id,i.thread_ts);c=_&&_.subscribed}if(!TS.model.ui.is_window_focused)s=true;if(!s&&!o&&!d)s=true;if(!s&&o&&l&&!d)s=true;if(s&&l&&!c)s=false;if(i.user==TS.model.user.id||i.comment&&i.comment.user==TS.model.user.id)s=false;var u=TS.templates.builders.getBotName(i);if(i.no_notifications)s=false;if(s&&TS.dnd.isMemberInDnd(TS.model.user)&&!i._ignore_dnd)s=false;if(TS.shared.isModelObOrgShared(t)){var m=TS.shared.isRelevantTeamForSharedModelOb(t);if(!m){if(TS.has_pri[a])TS.log(a,"Shared channel "+t.id+" is not relevant; suppressing notification.");s=false}else if(TS.pri)if(TS.has_pri[a])TS.log(a,"Shared channel "+t.id+" is relevant; allowing notification.")}if(!s&&!r)return;var f=function e(){if(i.thread_ts&&i.ts!=i.thread_ts){TS.ui.replies.openConversation(t,i.thread_ts);return}if(TS.boot_data.feature_focus_mode)if(TS.ui.focus_mode.is_in_focus_mode)TS.ui.focus_mode.end();TS.ims.startImByMemberId(t.user)};var h=u||TS.ims.getDisplayNameOfUserForIm(t);var g=TS.ui.growls.extractTxtFromMsg(i,true);g=g.replace(":simple_smile:",":)");var p="";p+=g;TS.ui.growls.maybeBounceDockIcon();var S;var T;if(TS.getOtherAccountsCount()>0&&(TS.ui.growls.canSpeak()||window.winssb))if(TS.model.supports_growl_subtitle){S=TS.model.team.name;T=h;if(i._ignore_dnd)T=TS.i18n.t("{name} is trying to reach you","growl")({name:h})}else if(i._ignore_dnd)S=TS.i18n.t("{name} is trying to reach you","growl")({name:h});else S=TS.i18n.t("[{team_domain}] from {name}","growl")({team_domain:TS.model.team.domain,name:h});else if(i._ignore_dnd)S=TS.i18n.t("{name} is trying to reach you","growl")({name:h});else S=TS.i18n.t("New message from {name}","growl")({name:h});var v=TS.ui.growls.getProfileImageFromUserId(t.user);TS.utility.calls.getCallActive().then(function(e){var n="new_message";if(e)n="none";else if(!TSSSB.call("shouldAttachSoundToNotification")){TS.sounds.play("new_message");n="none"}TS.ui.growls.show(S,TS.format.formatNotification(p,i),f,{msg:i,channelId:t.id,subtitle:T,sound_name:n,launchUri:TS.ui.growls.getLaunchUriForChannel(t.id,i.ts),imageUri:TS.ui.growls.getAttachmentUri(i),avatarImage:v})})},extractFromNameFromCorGMessage:function e(t){var i=TS.members.getMemberById(t.user);return(i?TS.members.getPrefCompliantMemberName(i):t.user)||TS.templates.builders.getBotName(t)||""},getProfileImageFromUserId:function e(t){if(!t)return null;var i=TS.members.getMemberById(t);if(!i||!i.profile)return null;var n=i.profile.image_512||i.profile.image_192;if(n&&n.match(/^\//))n="https://"+window.location.hostname+n;return n},extractTxtFromMsg:function e(t,i){if(i&&TS.model.prefs.no_text_in_notifications)return"";var n=t.type+" "+t.subtype+" "+TS.i18n.t("(message missing text)","growl")();if(t.file&&("file_share"===t.subtype||"file_mention"===t.subtype||"file_reaction"===t.subtype))n=TS.ui.growls.getGrowlableTxtFromFile(t);else if(t.text)n=t.text;else if(t.attachments&&t.attachments.length)n=TS.ui.growls.getGrowlableTxtFromAttachments(t.attachments)||n;return n},containsCmd:function e(t){var i=t&&TS.model.everyone_regex.test(t);var n=t&&TS.model.channel_regex.test(t);var a=t&&TS.model.group_regex.test(t);return i||n||a},windowFocusChanged:function e(t){if(t)if(("!"===document.title.charAt(0)||"*"===document.title.charAt(0))&&TS.model.active_cid)document.title=document.title.slice(2);if(!t&&TS.model.all_unread_highlights_cnt&&TS.model.prefs&&"long"===TS.model.prefs.mac_ssb_bounce)setTimeout(TS.ui.growls.maybeBounceDockIcon,100)},maybeBounceDockIcon:function e(){var t;if(window.macgap)t=window.macgap;else if(window.winssb&&TS.model.is_mac)t=window.winssb;if(!t)return;if(!t.dock)return;if(!TS.model.prefs.mac_ssb_bounce)return;if("long"===TS.model.prefs.mac_ssb_bounce){if(t.dock.bounceIndefinitely)t.dock.bounceIndefinitely()}else if(t.dock.bounceOnce)t.dock.bounceOnce()},maybeGetThreadTsForLastNotification:function e(n){if(!i()||!t)return null;var a=t.c_id;if(a===n)return t.thread_ts;return null},showTestNotification:function e(t,i,n,a){a=a||{};if(TSSSB.call("shouldAttachSoundToNotification")){var r=TS.sounds.soundForName("new_message");if(r){a.ssbFilename=r.ssbFilename;a.soundUrl=r.url}}else TS.sounds.play("new_message");if(TS.model.prefs.no_text_in_notifications)i=null;TS.ui.growls.show(t,i,n,a)}});var e=function e(t,i){if(!TS.utility.msgs.isMsgReply(i))return Promise.resolve();var n=TS.replies.getSubscriptionState(t.id,i.thread_ts);if(n)return Promise.resolve();return TS.replies.promiseToGetSubscriptionState(t.id,i.thread_ts).then(function(){n=TS.replies.getSubscriptionState(t.id,i.thread_ts);if(!n)throw new Error("promiseToGetSubscriptionState resolved but subscription is missing for "+i.thread_ts)})};var t=null;var i=function e(){if(!TS.model.is_our_app||!TS.model.is_electron)return false;var t=TS.model.mac_ssb_version||TS.model.win_ssb_version;if(!t||t>=2.4)return false;return true};var n=function e(n,a){if(!i())return;if(!n||!a||!TS.utility.msgs.isMsgReply(a)){t=null;return}t={c_id:n,ts:a.ts,thread_ts:a.thread_ts}};var a=67})()},4383:function(e,t){(function(){"use strict";TS.registerModule("chat_history",{onStart:function e(){TS.model.input_history=TS.storage.fetchInputHistory()},add:function e(t){if(TS.model.prefs&&!TS.model.prefs.arrow_history&&(!t||0!==t.indexOf("/")))return;var i=TS.model.input_history;var n=i.indexOf(t);if(-1!=n)i.splice(n,1);if(i.length&&""===i[0])i.splice(0,1);i.unshift(t);TS.storage.storeInputHistory(i);if(TS.boot_data.feature_tinyspeck){TS.log(23,"(TS-ONLY log)",t);TS.dir(23,"(TS-ONLY log)",i)}},resetPosition:function e(){TS.model.input_history_index=-1},onArrowKey:function e(t,i){if(TS.model.prefs&&!TS.model.prefs.arrow_history)return;if(!TS.model.input_history.length)return;var n;if(TS.utility.contenteditable.supportsTexty())n=TS.utility.contenteditable.value(i);else n=i.val();if(TS.model.input_history_index<0){TS.chat_history.add(n);TS.model.input_history_index+=1}if(t.which==TS.utility.keymap.up){TS.model.input_history_index+=1;if(TS.model.input_history_index>=TS.model.input_history.length){TS.model.input_history_index=TS.model.input_history.length-1;return}}else if(t.which==TS.utility.keymap.down){TS.model.input_history_index-=1;if(TS.model.input_history_index<0){TS.model.input_history_index=-1;return}}else return;var a=TS.model.input_history[TS.model.input_history_index];t.preventDefault();if(TS.utility.contenteditable.supportsTexty())TS.utility.contenteditable.deserialize(TS.client.ui.$msg_input,a);else TS.utility.populateInput(TS.client.ui.$msg_input,a);if(t.which==TS.utility.keymap.up)if(TS.utility.contenteditable.supportsTexty())TS.utility.contenteditable.cursorPosition(i,0);else TS.utility.setCursorPosition(i,0);else if(!TS.utility.contenteditable.supportsTexty())TS.utility.contenteditable.setCursorAtEnd(i)},getCommands:function e(){if(!_.isArray(TS.model.input_history))return;return TS.model.input_history.filter(function(e){return e&&0===e.indexOf("/")})}})})()},4384:function(e,t){(function(){"use strict";TS.registerModule("ui.channel_prefs_dialog",{showing:false,onStart:function e(){TS.prefs.push_changed_sig.add(l);TS.prefs.dtop_notif_changed_sig.add(r);TS.prefs.team_perms_pref_changed_sig.add(n);TS.prefs.muted_channels_changed_sig.add(o)},start:function t(i){if(!e)u();if(TS.ui.channel_prefs_dialog.showing)return;TS.ui.channel_prefs_dialog.renderOptions(e,i);e.modal("show");e.find(".dialog_cancel").click(c);e.find(".dialog_go").click(d)},renderOptions:function e(i,n,s){var d=TS.shared.getModelObById(n);if(!d||d.is_im){alert(n+" ???");return}var c="";var _="";var u=false;if(d.is_mpim){u=true;_=TS.mpims.getDisplayName(d)}else if(d.is_channel){c="channel";_="#"+d.name;_+=TS.templates.builders.maybeMakeSharedIcon(d)}else if(d.is_group){c="group";_=d.name}t=n;var m=TS.templates.channel_prefs_dialog({c_or_g:c,is_mpim:u,display_name:new Handlebars.SafeString(_),show_one_suppressed_cb:true,show_two_suppressed_cbs:false,is_muted:TS.notifs.isCorGMuted(n),model_ob:d,embedded:s});i.html(m);l();r();a();o();$("#notifications_not_working").addClass("hidden");$("#notifications_impossible").addClass("hidden");$("#notifications_not_yet_allowed").addClass("hidden");$("#notifications_not_enabled").addClass("hidden");$("#notifications_not_allowed").addClass("hidden");$("#notifications_working").removeClass("hidden");if(TS.ui.growls.shouldShowPermissionButton()){$("#notifications_working").addClass("hidden");$("#notifications_not_working").removeClass("hidden");$("#notifications_not_yet_allowed").removeClass("hidden")}else if(!TS.ui.growls.checkPermission()){$("#notifications_working").addClass("hidden");$("#notifications_not_working").removeClass("hidden");if(TS.ui.growls.no_notifications)$("#notifications_impossible").removeClass("hidden");else if("denied"===TS.ui.growls.getPermissionLevel())$("#notifications_not_allowed").removeClass("hidden")}},showMainPrefs:function e(t){c();setTimeout(function(){TS.ui.prefs_dialog.start(t)},500)}});var e=null;var t=null;var i=function e(t){if(!TS.ui.channel_prefs_dialog.showing)return;if(t.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")){d();t.preventDefault()}}else if(t.which==TS.utility.keymap.esc)c()};var n=function e(t){if("who_can_at_channel"!==t&&"who_can_at_everyone"!==t&&"who_can_post_general"!==t)return;r();l();a()};var a=function e(){if(!t)return;var i=$("#single_suppressed_cb");var n=$("#single_suppressed_label");var a=$("#single_suppressed_disabled_explain");var r=$("#single_suppressed_div");var o=$("#single_suppressed_disabled_explain_tip_link");var l=TS.notifs.hasUserSuppressedCorGChannelMentionsById(t)||TS.notifs.hasUserSuppressedCorGPushChannelMentions(t);var d=TS.notifs.getCalculatedCorGPushNotifySetting(t);var c=TS.notifs.getCalculatedCorGNotifySetting(t);var _="mentions"===d||"mentions"===c;s(l,"both",_,i,n,a,r,o);if(!_)return;if("mentions"===d&&"everything"===c){$("#single_suppressed_mobile_qualifier").removeClass("hidden");$("#single_suppressed_desktop_qualifier").addClass("hidden")}else if("mentions"===c&&"everything"===d){$("#single_suppressed_desktop_qualifier").removeClass("hidden");$("#single_suppressed_mobile_qualifier").addClass("hidden")}else{$("#single_suppressed_desktop_qualifier").addClass("hidden");$("#single_suppressed_mobile_qualifier").addClass("hidden")}if("mentions"===d)$("#single_suppressed_mobile_disclaimer").removeClass("hidden");else $("#single_suppressed_mobile_disclaimer").addClass("hidden")};var r=function e(){if(!t)return;var i=TS.notifs.getCalculatedCorGNotifySetting(t);$("#all_everything_default").addClass("hidden");$("#all_mentions_default").addClass("hidden");$("#all_nothing_default").addClass("hidden");if(TS.model.prefs.growls_enabled&&TS.model.prefs.all_channels_loud)$("#all_everything_default").removeClass("hidden");else if(TS.model.prefs.growls_enabled)$("#all_mentions_default").removeClass("hidden");else $("#all_nothing_default").removeClass("hidden");$('input:radio[name="channel_loud_rd"]').filter('[value="'+i+'"]').prop("checked",true);$('input:radio[name="channel_loud_rd"]').unbind("change").bind("change",function(){var i=$(this).val();if("everything"===i)TS.notifs.makeCorGDTopEverything(t);else if("mentions"===i)TS.notifs.makeCorGDTopMentions(t);else TS.notifs.makeCorGDTopNothing(t);if(TS.boot_data.feature_channel_alert_words)TS.ui.inline_saver.show({target:"[data-notification-table-header]"});TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")});e();a()});var n=$("#suppressed_cb");var r=$("#suppressed_label");var o=$("#suppressed_disabled_explain");var l=$("#suppressed_span");var d=$("#suppressed_disabled_explain_tip_link");var c="mentions"===i;s(TS.notifs.hasUserSuppressedCorGChannelMentionsById(t),"at_channel_suppressed_channels",c,n,r,o,l,d);a()};var s=function e(i,n,a,r,s,o,l,d){if(!t)return;if(a)l.removeClass("hidden");else l.addClass("hidden");var c=TS.channels.getChannelById(t)||TS.groups.getGroupById(t)||TS.mpims.getMpimById(t);var _=TS.model.team.prefs;var u=false;if("admin"===_.who_can_at_channel||"owner"===_.who_can_at_channel)u=true;else if(c.is_general&&("admin"===_.who_can_at_everyone||"owner"===_.who_can_at_everyone||"admin"===_.who_can_post_general||"owner"===_.who_can_post_general))u=true;if(u){s.addClass("subtle_silver");s.css("cursor","default");o.removeClass("hidden");$("#single_suppressed_mobile_disclaimer").addClass("hidden");r.prop("disabled",true);r.prop("checked",false);var m="C"===t.charAt(0)?"channel":"group";var f;if("group"===m)f=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("A Workspace Owner has restricted the use of <b>{channel}</b> to admins and/or owners. These notifications cannot be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel")}):TS.i18n.t("A Team Owner has restricted the use of <b>{channel}</b> to admins and/or owners. These notifications cannot be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel")});else if(c.is_general)f=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("A Workspace Owner has restricted who can post to general and/or restricted the use of <b>{channel}</b> and/or <b>{everyone}</b> to admins and/or owners. These notifications can not be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel"),everyone:TS.templates.builders.atLabel("everyone")}):TS.i18n.t("A Team Owner has restricted who can post to general and/or restricted the use of <b>{channel}</b> and/or <b>{everyone}</b> to admins and/or owners. These notifications can not be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel"),everyone:TS.templates.builders.atLabel("everyone")});else f=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("A Workspace Owner has restricted the use of <b>{channel}</b> to admins and/or owners. These notifications cannot be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel")}):TS.i18n.t("A Team Owner has restricted the use of <b>{channel}</b> to admins and/or owners. These notifications cannot be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel")});d.tooltip("destroy").attr("title",f).tooltip({html:true,container:"#channel_prefs_dialog"})}else{s.removeClass("subtle_silver");s.css("cursor","");o.addClass("hidden");r.prop("disabled",false);r.prop("checked",i);r.unbind("change").bind("change",function(){var e=!!$(this).prop("checked");if("both"===n||"at_channel_suppressed_channels"===n){if(e)TS.notifs.makeCorGSuppressed(t);else TS.notifs.makeCorGNOTSuppressed(t);TS.prefs.setPrefByAPI({name:"at_channel_suppressed_channels",value:TS.model.at_channel_suppressed_channels.join(",")})}if("both"===n||"push_at_channel_suppressed_channels"===n){if(e)TS.notifs.makeCorGPushSuppressed(t);else TS.notifs.makeCorGNOTPushSuppressed(t);TS.prefs.setPrefByAPI({name:"push_at_channel_suppressed_channels",value:TS.model.push_at_channel_suppressed_channels.join(",")})}if(TS.boot_data.feature_channel_alert_words)TS.ui.inline_saver.show({target:"[data-muting-options-header]"})})}};var o=function e(){if(!t)return;var i=TS.notifs.isCorGMuted(t);var n=$("#muting_cb");var a=$("#non_muting_prefs");var r=$("#muting_info");n.prop("checked",i);n.unbind("change").bind("change",function(){TS.notifs.muteOrUnmuteCorG(t);if(TS.boot_data.feature_channel_alert_words)TS.ui.inline_saver.show({target:"[data-muting-options-header]"})});if(i){a.slideUp(150);r.removeClass("hidden")}else{a.slideDown(150);r.addClass("hidden")}};var l=function e(){if(!t)return;var i=TS.notifs.getCalculatedCorGPushNotifySetting(t);$("#all_push_everything_default").addClass("hidden");$("#all_push_mentions_default").addClass("hidden");$("#all_push_nothing_default").addClass("hidden");if(TS.model.prefs.push_everything)$("#all_push_everything_default").removeClass("hidden");else if(TS.model.prefs.push_mention_alert)$("#all_push_mentions_default").removeClass("hidden");else $("#all_push_nothing_default").removeClass("hidden");$('input:radio[name="channel_push_loud_rd"]').filter('[value="'+i+'"]').prop("checked",true);$('input:radio[name="channel_push_loud_rd"]').unbind("change").bind("change",function(){var i=$(this).val();if("everything"===i)TS.notifs.makeCorGPushEverything(t);else if("mentions"===i)TS.notifs.makeCorGPushMentions(t);else TS.notifs.makeCorGPushNothing(t);if(TS.boot_data.feature_channel_alert_words)TS.ui.inline_saver.show({target:"[data-notification-table-header]"});TS.prefs.setMultiPrefsByAPI({push_loud_channels:TS.model.push_loud_channels.join(","),push_mention_channels:TS.model.push_mention_channels.join(","),push_loud_channels_set:TS.model.push_loud_channels_set.join(",")});e();a()});var n=$("#push_suppressed_cb");var r=$("#push_suppressed_label");var o=$("#push_suppressed_disabled_explain");var l=$("#push_suppressed_span");var d=$("#push_suppressed_disabled_explain_tip_link");var c="mentions"===i;s(TS.notifs.hasUserSuppressedCorGPushChannelMentions(t),"push_at_channel_suppressed_channels",c,n,r,o,l,d);a()};var d=function t(){if(!TS.ui.channel_prefs_dialog.showing){TS.error("not showing?");return}e.modal("hide")};var c=function t(){e.modal("hide")};var _=function e(){t=null;TS.model.dialog_is_showing=false;TS.ui.channel_prefs_dialog.showing=false;$(window.document).unbind("keydown",i)};var u=function t(){$("body").append('<div id="channel_prefs_dialog" class="modal hide fade"></div>');e=$("#channel_prefs_dialog");e.on("hide",function(e){if(e.target!=this)return;_()});e.on("hidden",function(t){if(t.target!=this)return;e.remove();e=null});e.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.channel_prefs_dialog.showing=true});e.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){$(window.document).bind("keydown",i)},100)})}})()},4385:function(e,t){(function(){"use strict";TS.registerModule("ui.upload_dialog",{div:null,filesQ:[],file:null,showing:false,last_share_cb_checked:null,selection:null,onStart:function e(){},onKeydown:function e(t){if(!TS.ui.upload_dialog.showing)return;if(t.which==TS.utility.keymap.enter){if("TEXTAREA"!==TS.utility.getActiveElementProp("NODENAME")){if(n)TS.ui.upload_dialog.cancel();else TS.ui.upload_dialog.go();t.preventDefault()}}else if(t.which==TS.utility.keymap.esc)TS.ui.upload_dialog.cancel();else if(t.which==TS.utility.keymap.tab)if($(document.activeElement).hasClass("dialog_go")){t.preventDefault();TS.ui.upload_dialog.div.find(".title_input").focus()}},shouldShowConfirmation:function e(){return!n&&TS.utility.contenteditable.getLength(TS.ui.upload_dialog.div.find("#file_comment_textarea"))>400},showConfirmation:function e(){var t=TS.ui.upload_dialog.div;var i=t.find(".modal-footer-confirm");t.find(".upload_actions").addClass("hidden");i.removeClass("hidden");i.find(".dialog_cancel").focus();n=true},start:function e(t){if(!t||!t.length){TS.info("no files");return}var i=0;var n;for(var a=0;a<t.length;a+=1){n=t[a];if(n.size>TS.model.upload_file_size_limit_bytes)continue;i+=1;TS.ui.upload_dialog.filesQ.push(n)}if(i<t.length){var r="";if(1==t.length)r=TS.i18n.t("That file is too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)});else if(!i)r=TS.i18n.t("All of those file are too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)});else r=TS.i18n.t("We’ll upload what we can, but one or more of those files is too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)});alert(r)}if(!i)return;if(!TS.ui.upload_dialog.div)TS.ui.upload_dialog.build();if(!TS.ui.upload_dialog.showing)TS.ui.upload_dialog.pullFromQ(true)},startWithCommentFromChatInput:function t(i){e=TS.utility.contenteditable.value(TS.client.ui.$msg_input);TS.ui.upload_dialog.start(i);TS.view.clearMessageInput()},pullFromQ:function e(t){if(TS.ui.upload_dialog.filesQ.length){TS.ui.upload_dialog._startWithFile(TS.ui.upload_dialog.filesQ.shift(),t);return true}if(TS.client.ui.resetFiles)TS.client.ui.resetFiles();else if(TS.console&&TS.console.warn)TS.console.warn(8675309,"TS.client.ui.resetFiles undefined");return false},_startWithFile:function e(t,n){i=false;TS.ui.upload_dialog.file=t;var l=TS.templates.file_upload_dialog({filename:TS.files.makeFileNameFromFile(t),title:r(t),has_name:!!t.name,sharing_html:TS.templates.builders.buildFileSharingControls(t,null,s(),null,TS.ui.upload_dialog.selection),over_storage_limit:TS.model.team.over_storage_limit,more_in_queue:TS.ui.upload_dialog.filesQ.length>0,file_retention_type:parseInt(TS.model.team.prefs.file_retention_type,10),file_retention_duration:TS.interop.datetime.daysToYearsPretty(TS.model.team.prefs.file_retention_duration)});var d=TS.ui.upload_dialog.div;d.html(l);var c=function e(t){$("#upload_image_preview").removeClass("hidden").find("img").attr("src",t)};if("string"===typeof t)c("data:image/png;base64,"+t);else if(window.FileReader)try{if(EXIF){var _=new FileReader;_.onload=function(e){var t=EXIF.readFromBinaryFile(e.target.result);if(t.Orientation&&"number"===typeof t.Orientation&&1!==t.Orientation)$("#upload_image_preview").find("img").addClass("orientation_"+t.Orientation)};_.readAsArrayBuffer(t)}var u=new FileReader;u.onload=function(e){var t=e.target.result;if(0!==t.indexOf("data:image/"))return;c(t)};u.onloadstart=function(e){if(e.total>33554432){TS.info("skipping image preview for large file: "+e.total);u.abort()}};u.readAsDataURL(t)}catch(e){TS.info(e)}var m=$("#file_comment_textarea");TS.ui.comments.bindInput(m,TS.ui.upload_dialog.go);if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty())TS.utility.contenteditable.value(m,s());else m.autogrow();m=null;var f=TS.ui.upload_dialog.showing;d.modal("show");if(TS.ui.upload_dialog.filesQ.length)d.find(".file_count").text(TS.i18n.t(" (and {num_files_remaining, number} more…)","upload_dialog")({num_files_remaining:TS.ui.upload_dialog.filesQ.length}));if(n){var h=!TS.client.activeChannelIsHidden();d.find("#share_cb").prop("checked",h)}else d.find("#share_cb").prop("checked",true===TS.ui.upload_dialog.last_share_cb_checked);d.find(".modal-header > .close").click(o);d.find(".dialog_cancel_all").click(TS.ui.upload_dialog.cancelAll);d.find(".dialog_cancel").click(TS.ui.upload_dialog.cancel);d.find(".dialog_go").click(TS.ui.upload_dialog.go);var g=!n&&TS.ui.upload_dialog.selection?TS.ui.upload_dialog.selection:null;TS.ui.file_share.bindFileShareDropdowns(void 0,void 0,g);TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField();var p="TS-lazyFilterSelect";d.find(".lfs_input_container").attr("tabindex","0");if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())d.find("#file_comment_textarea").attr("tabindex","0");d.find("#select_share_channels").data(p).instance.onKeyDown=function(e){if(e.which==TS.utility.keymap.tab){e.preventDefault();if(e.shiftKey)d.find("#share_cb").focus();else TS.utility.contenteditable.focus(d.find("#file_comment_textarea"))}};if(f)a(d)},go:function e(){if(i){TS.info("TS.ui.upload_dialog.go stopped because already uploading");return false}if(!TS.ui.upload_dialog.showing){TS.error("not showing?");return}if(!TS.ui.upload_dialog.file){TS.error("no file?");return}if(TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var t=TS.ui.upload_dialog.div;var n=!!t.find("#share_cb").prop("checked");TS.ui.upload_dialog.last_share_cb_checked=!!n;TS.ui.upload_dialog.selection=$("#share_model_ob_id").val();var a=n?TS.ui.upload_dialog.selection:null;var r=TS.format.cleanMsg(TS.utility.contenteditable.value($("#file_comment_textarea")));if(""===$.trim(r))r="";var s=t.find(".filename_input").val();var o=t.find(".title_input").val();if(TS.ui.upload_dialog.file.is_dropbox||TS.ui.upload_dialog.file.is_box){var d=TS.ui.upload_dialog.file.link;TS.shared.getShareModelObId(a,function(e){TS.files.upload({link:d,filename:s,title:o,channels:e,initial_comment:r,is_dropbox:TS.ui.upload_dialog.file.is_dropbox,is_box:TS.ui.upload_dialog.file.is_box});if(a)l(a)})}else{var c=TS.ui.upload_dialog.file;TS.shared.getShareModelObId(a,function(e){TS.files.upload({file:c,filename:s,title:o,channels:e,initial_comment:r});if(a)l(a)})}i=true;TS.ui.upload_dialog.maybeGoAway()},maybeGoAway:function t(){e="";if(!TS.ui.upload_dialog.pullFromQ()){TS.ui.upload_dialog.div.modal("hide");TS.ui.upload_dialog.selection=null;return true}return false},cancel:function t(){if(TS.ui.upload_dialog.shouldShowConfirmation()){TS.ui.upload_dialog.showConfirmation();return}TS.ui.upload_dialog.selection=$("#share_model_ob_id").val();var i=e;var a=TS.ui.upload_dialog.maybeGoAway();if(i)TS.client.msg_input.populate(i);if(a&&i)setTimeout(TS.view.focusMessageInput,10);n=false},cancelAll:function e(){TS.ui.upload_dialog.filesQ=[];TS.ui.upload_dialog.cancel()},end:function t(){TS.model.dialog_is_showing=false;TS.ui.upload_dialog.showing=false;TS.ui.upload_dialog.file=null;e="";n=false;TS.ui.comments.unbindInput($("#file_comment_textarea"));TS.ui.upload_dialog.div.empty();$(window.document).unbind("keydown",TS.ui.upload_dialog.onKeydown)},build:function e(){$("body").append('<div id="upload_dialog" class="modal hide fade" data-keyboard="false" data-backdrop="static"></div>');TS.ui.upload_dialog.div=$("#upload_dialog");var t=TS.ui.upload_dialog.div;t.on("hidden",function(e){if(e.target!=this)return;TS.ui.upload_dialog.end()});t.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.upload_dialog.showing=true});t.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){a(t);$(window.document).bind("keydown",TS.ui.upload_dialog.onKeydown)},100)})}});var e="";var t=50;var i=false;var n=false;var a=function i(n){if(e&&e.length>t){TS.utility.contenteditable.focus(n.find("#file_comment_textarea"));TS.utility.contenteditable.cursorPosition(n.find("#file_comment_textarea"),0,1e5)}else n.find("#upload_file_title").focus().select()};var r=function i(n){if(e&&e.length<=t)return e;return TS.files.makeFileTitleFromFile(n)};var s=function i(){if(e&&e.length>t)return e;return""};var o=function e(t){t.preventDefault();TS.ui.upload_dialog.cancelAll()};var l=function e(t){if(TS.channels.getChannelById(t))TS.channels.displayChannel({id:t});else if(TS.ims.getImByMemberId(t))TS.ims.startImByMemberId(t);else if(TS.mpims.getMpimById(t))TS.mpims.displayMpim({id:t});else if(TS.groups.getGroupById(t))TS.groups.displayGroup({id:t});else TS.error("no valid shared channel/im/mpim/group to display")}})()},4386:function(e,t){(function(){"use strict";TS.registerModule("ui.snippet_dialog",{editor:null,text_from_input:null,edit_file_id:null,div:null,showing:false,onStart:function e(){},startCreate:function e(t){if(TS.ui.snippet_dialog.showing)return;TS.ui.snippet_dialog.showing=true;TS.ui.snippet_dialog.text_from_input=t||null;TS.ui.snippet_dialog.edit_file_id=null;TS.ui.snippet_dialog.start(t,null,TS.model.prefs.last_snippet_type||"text")},startEdit:function e(t){if(TS.ui.snippet_dialog.showing)return;var i=TS.files.getFileById(t);if(!i)return;TS.files.fetchFileInfo(t,function(e,i){TS.ui.snippet_dialog.edit_file_id=t;TS.ui.snippet_dialog.text_from_input=null;TS.ui.snippet_dialog.start(i.content,i.title,i.filetype)})},start:function r(s,o,l){i=s||"";t=o||"";n=l||"";if(!window.CodeMirror){if(e);else{e=true;TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror","/js/libs/codemirror.js")).done(function(){TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror_addon_simple","/js/libs/codemirror/addon/simple.js")).done(function(){TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror_load","/js/codemirror_load.js")).done(function(){TS.ui.snippet_dialog.start(s,o,l)})})})}return}if(!TS.ui.snippet_dialog.div)TS.ui.snippet_dialog.build();var d={codemirror_types:TS.boot_data.codemirror_types,wrap_lines:TS.model.prefs.snippet_editor_wrap_long_lines};if(TS.ui.snippet_dialog.edit_file_id)d.is_edit=true;else{d.is_edit=false;d.sharing_html=TS.templates.builders.buildFileSharingControls()}var c=TS.templates.snippet_dialog(d);var u=TS.ui.snippet_dialog.div;u.html(c);u.modal("show");u.find(".modal-footer-action > .cancel, .modal-header > .close").click(TS.ui.snippet_dialog.cancelPrompt);u.find(".dialog_cancel").click(TS.ui.snippet_dialog.cancel);u.find(".dialog_cancel_decline").click(TS.ui.snippet_dialog.cancelDecline);u.find(".dialog_go").click(TS.ui.snippet_dialog.go);TS.ui.snippet_dialog.editor=CodeMirror.fromTextArea(document.getElementById("client_file_snippet_textarea"),{lineNumbers:true,matchBrackets:true,indentUnit:4,indentWithTabs:true,enterMode:"keep",tabMode:"shift",viewportMargin:10,autofocus:false,lineWrapping:TS.model.prefs.snippet_editor_wrap_long_lines});$("#client_file_snippet_select").change(function(){CodeMirror.switchSlackMode(TS.ui.snippet_dialog.editor,$(this).val());TS.prefs.setPrefByAPI({name:"last_snippet_type",value:$(this).val()})}).change();$("#client_file_wrap_cb").bind("change",function(){var e=$(this).is(":checked");TS.ui.snippet_dialog.editor.setOption("lineWrapping",e);TS.prefs.setPrefByAPI({name:"snippet_editor_wrap_long_lines",value:e})});var m=false;if(TS.ui.snippet_dialog.edit_file_id){TS.ui.snippet_dialog.editor.setValue(s);if(o)o=TS.format.unFormatMsg(o);$("#client_file_snippet_title_input").val(o||"")}else{TS.ui.snippet_dialog.editor.setValue(s||"");$("#client_file_snippet_title_input").val("");TS.ui.file_share.bindFileShareDropdowns();TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField();m=!!s}var f=$("#file_comment_textarea");TS.ui.comments.bindInput(f,TS.ui.snippet_dialog.go);if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())f.autogrow();$("#client_file_snippet_select").val(l).trigger("change");setTimeout(function(){if(m)$("#client_file_snippet_title_input").focus();else TS.ui.snippet_dialog.editor.focus();TS.ui.snippet_dialog.editor.refresh()},350);$(window.document).on("keydown",TS.ui.snippet_dialog.onKeyDown);$(window.document).on("keyup",a);TS.ui.snippet_dialog.editor.on("change",a)},go:function e(){if(!TS.ui.snippet_dialog.showing){TS.error("not showing?");return}var t=TS.ui.snippet_dialog.editor.getValue();if(!$.trim(t))return;if(TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var i=TS.emoji.maybeGetCanonicalEmojiString($("#client_file_snippet_title_input").val());if(TS.ui.snippet_dialog.edit_file_id)TS.api.call("files.edit",{file:TS.ui.snippet_dialog.edit_file_id,title:i,content:t,filetype:$("#client_file_snippet_select").val()});else{var n=!!$("#share_cb").prop("checked");var a=n?$("#share_model_ob_id").val():null;var r=TS.format.cleanMsg(TS.utility.contenteditable.value($("#file_comment_textarea")));var s=$("#client_file_snippet_select").val();if(""===$.trim(r))r="";TS.shared.getShareModelObId(a,function(e){TS.files.upload({text:t,title:i,filetype:s,channels:e,initial_comment:r});if(TS.client){var n=TS.shared.getModelObById(e);if(!n)return;TS.client.displayModelOb(n)}})}TS.ui.snippet_dialog.div.modal("hide");TS.ui.snippet_dialog.end()},cancelPrompt:function e(a){if(a){a.preventDefault();a.stopPropagation()}var r=TS.ui.snippet_dialog;var s=TS.emoji.maybeGetCanonicalEmojiString($("#client_file_snippet_title_input").val());var o=TS.ui.snippet_dialog.editor.getValue();var l=$("#client_file_snippet_select").val();if(TS.ui.snippet_dialog.edit_file_id){if(TS.emoji.maybeGetCanonicalEmojiString(t)===s&&i===o&&n===l)return r.cancel()}else if(!o&&!s)return r.cancel();var d=TS.ui.snippet_dialog.div;d.find(".modal-footer-confirm").removeClass("hidden");d.find(".modal-footer-action").addClass("hidden")},cancelDecline:function e(){var t=TS.ui.snippet_dialog.div;t.find(".modal-footer-confirm").addClass("hidden");t.find(".modal-footer-action").removeClass("hidden")},cancel:function e(t){if(t)t.preventDefault();if(TS.ui.snippet_dialog.text_from_input){TS.client.msg_input.populate(TS.ui.snippet_dialog.editor.getValue());TS.ui.snippet_dialog.text_from_input=""}setTimeout(TS.view.focusMessageInput,10);TS.ui.snippet_dialog.end();TS.ui.snippet_dialog.div.modal("hide")},end:function e(){$(window.document).off("keydown",TS.ui.snippet_dialog.onKeyDown);$(window.document).off("keyup",a);TS.model.dialog_is_showing=false;TS.ui.snippet_dialog.showing=false;TS.ui.comments.unbindInput($("#file_comment_textarea"));if(TS.ui.snippet_dialog.editor&&TS.ui.snippet_dialog.editor.cleanup)TS.ui.snippet_dialog.editor.cleanup();TS.ui.snippet_dialog.editor=null;TS.ui.snippet_dialog.div.empty()},onKeyDown:function e(t){var i=TS.ui.snippet_dialog;if(t.which==TS.utility.keymap.esc){if(i.div.find(".modal-footer-confirm").is(":visible"))i.cancelDecline();else i.cancelPrompt();t.preventDefault()}else if(t.which==TS.utility.keymap.enter)if(!TS.utility.isFocusOnInput()||!document.activeElement||"client_file_snippet_title_input"===TS.utility.getActiveElementProp("id")){if(i.div.find(".modal-footer-confirm").is(":visible"))i.cancel();else i.go();t.preventDefault()}},build:function e(){$("body").append('<div id="snippet_dialog" class="modal hide fade" data-backdrop="static" data-keyboard="false"></div>');TS.ui.snippet_dialog.div=$("#snippet_dialog");var t=TS.ui.snippet_dialog.div;t.on("hidden",function(e){if(e.target!=this)return;TS.ui.snippet_dialog.end()});t.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.snippet_dialog.showing=true})}});var e=false;var t="";var i="";var n="";var a=function e(){var t=TS.ui.snippet_dialog;var i=t.editor.getValue();if($.trim(i))t.div.find(".ts_tip").addClass("ts_tip_hide");else t.div.find(".ts_tip").removeClass("ts_tip_hide")}})()},4387:function(e,t){(function(){"use strict";TS.registerModule("view.overlay",{onStart:function t(){e=$("#msgs_overlay_div");$(window.document).keydown(function(e){if(!TS.model.overlay_is_showing)return;if(e.which==TS.utility.keymap.enter||e.which==TS.utility.keymap.esc)if(i)i();else s(true)})},startWithJoinedSharedChannel:function e(t){$("#col_messages").append("<div class='shared_channels_join_modal_overlay transparent'></div>");var i=$(".shared_channels_join_modal_overlay");i.html(TS.templates.channel_shared_join_overlay({channel:t,source_team:TS.model.team,inviter:TS.members.getMemberById(t.inviter),shared_team:TS.teams.getTeamById(t.shared_team_ids[0])}));TS.utility.rAF(function(){i.removeClass("transparent");TS.client.ui.$msgs_div.addClass("hide_day_divider_labels")});var n=function e(){i.addClass("transparent");TS.client.ui.$msgs_div.removeClass("hide_day_divider_labels");i.on("transitionend",function(){i.remove()})};i.find("button").on("click",function(){t.needs_invited_message=false;n()});TS.channels.switched_sig.add(n);l(t.id,"joined")},startWithJoinedChannel:function a(o){r();t=true;e.html(TS.templates.channel_join_overlay({invited:false,channel:o}));i=function e(){o.needs_joined_message=false;s(true);i=null};n($("#channel_joined"));l(o.id,"joined")},startWithInvitedChannel:function a(o){r();t=true;var d={invited:true,channel:o};if(TS.boot_data.page_needs_enterprise&&o.is_shared)if(o.is_global_shared)d.teams_shared_with=TS.model.enterprise_teams;else d.teams_shared_with=_.map(o.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)});e.html(TS.templates.channel_join_overlay(d));i=function e(){o.needs_invited_message=false;s(true);i=null};n($("#channel_joined"));l(o.id,"invited")},startWithCreatedChannel:function a(o){r();t=true;var d={channel:o,name_for_url:o.id};if(TS.boot_data.page_needs_enterprise&&o.is_shared)if(o.is_global_shared)d.teams_shared_with=TS.model.enterprise_teams;else d.teams_shared_with=_.map(o.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)});e.html(TS.templates.channel_create_overlay(d));i=function e(){o.needs_created_message=false;s(true);i=null};e.find("a.invite_link").bind("click.invite_and_clear_overlay",function(e){TS.ui.channel_invite_modal.startInviteToChannelModal(o.id);i(e)});n($("#channel_created"));l(o.id,"created")},startWithInvitedGroup:function a(o){r();t=true;e.html(TS.templates.group_join_overlay({invited:true,group:o}));i=function e(){o.needs_invited_message=false;s(true);i=null};n($("#group_joined"));l(o.id,"invited")},startWithCreatedGroup:function a(o){r();t=true;e.html(TS.templates.group_create_overlay({group:o,name_for_url:o.id}));$(window).trigger("resize");i=function e(){o.needs_created_message=false;s(true);i=null};n($("#group_created"));l(o.id,"created")},startWithGrowlPromptDisplay:function i(){r();t=true;var n=e;n.html(TS.templates.growl_prompt_overlay({}));n.find(".prompt_allow").bind("click",a);n.find(".prompt_cancel_forever").bind("click",function(){window.createCookie("no_growl_prompt","1",3650);$("#growl_prompt_div").addClass("hidden");s()});n.find(".see-apps").bind("click",function(){window.createCookie("no_growl_prompt","1",.5);$("#growl_prompt_div").addClass("hidden");s()});n.find(".prompt_cancel").bind("click",function(){$("#growl_prompt_div").addClass("hidden");s()});n.find(".prompt_test").bind("click",function(){$("#growl_prompt_div").addClass("hidden");TS.sounds.play("new_message");TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("What do you know? It works.","prefs")())});if(TS.ui.growls.no_notifications)$("#growl_prompt_overlay_impossible").removeClass("hidden");else $("#growl_prompt_overlay_start").removeClass("hidden")},fadeInAndOut:function e(){r();s()},cancelFromSendingMessage:function e(){if(!TS.model.overlay_is_showing)return;if(i)i();else s(true)}});var e=null;var t=false;var i=null;var n=function t(n){e.find("a.btn").bind("click.clear_overlay",i);n.wrap('<div id="overlay_wrapper">');$("#overlay_wrapper").monkeyScroll()};var a=function e(){$("#growl_prompt_overlay_start").addClass("hidden");$("#growl_prompt_overlay_tell_to_allow").removeClass("hidden");TS.ui.growls.promptForPermission(function(e,t){$("#growl_prompt_overlay_tell_to_allow").addClass("hidden");if("granted"===t&&e){$("#growl_prompt_overlay_success").removeClass("hidden");TS.prefs.setPrefByAPI({name:"growls_enabled",value:true})}else if("default"===t)$("#growl_prompt_overlay_start").removeClass("hidden");else if("denied"===t)$("#growl_prompt_overlay_disallowed").removeClass("hidden");else alert("huh allowed:"+e+" permission_level:"+t)})};var r=function t(i){if(TS.model.overlay_is_showing)return;e.stop();e.empty();e.removeClass("hidden");TS.client.ui.$msgs_div.addClass("hide_day_divider_labels");if(i){e.css("opacity",0);e.transition({opacity:1},250)}else e.css("opacity",1);TS.model.overlay_is_showing=true};var s=function i(n){var a=TS.model.overlay_is_showing;TS.model.overlay_is_showing=false;var r=e.find("#no_joined_overlays_cb");if(r.length&&r.prop("checked"))TS.prefs.setPrefByAPI({name:"no_joined_overlays",value:true});var s=e.find("#no_created_overlays_cb");if(s.length&&s.prop("checked"))TS.prefs.setPrefByAPI({name:"no_created_overlays",value:true});TS.client.ui.$msgs_div.removeClass("hide_day_divider_labels");e.transition({opacity:0},250,function(){o()});if(t){t=false;TS.view.showInterstitialAfterChannelOrImShown()}if(a&&n)TS.client.msg_pane.checkUnreads()};var o=function t(){e.addClass("hidden");TS.model.overlay_is_showing=false};var l=function e(t,i){TS.clog.track("CHANNEL_OVERLAY_SHOWN",{channel_id:t,channel_type:t.charAt(0),join_action:i})}})()},4388:function(e,t){(function(){"use strict";TS.registerModule("ui.invite",{showInviteMembersPreSelected:function t(i,n,a){if(!n||!n.length){TS.warn("showInviteMembersPreSelected requires a non-empty array of preselected ids to invite to a group, ignoring...");return}e(i,n,a)},showInviteMemberToChannelDialog:function e(t){var i=TS.members.getMemberById(t);var n=TS.channels.getChannelsUserIsIn();var a=true;var r=true;if(TS.model.user.is_ultra_restricted)TS.generic_dialog.start({title:TS.i18n.t("Invite {name} to a channel","channel_invite")({name:TS.members.getPrefCompliantMemberName(i,a)}),body:TS.i18n.t("You are not allowed to invite other members to channels.","channel_invite")(),show_cancel_button:false});else if(i.is_ultra_restricted)TS.generic_dialog.start({title:TS.i18n.t("Invite {name} to a channel","channel_invite")({name:TS.members.getPrefCompliantMemberName(i,a)}),body:TS.i18n.t("{name} cannot be invited to any new channels.","channel_invite")({name:TS.members.getPrefCompliantMemberName(i,a)}),show_cancel_button:false});else if(i.is_restricted&&!TS.model.user.is_admin)TS.generic_dialog.start({title:TS.i18n.t("Invite {name} to a channel","channel_invite")({name:TS.members.getPrefCompliantMemberName(i,a)}),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Only a Workspace Admin can invite {name} into new channels.","channel_invite")({name:TS.members.getPrefCompliantMemberName(i,a)}):TS.i18n.t("Only a Team Admin can invite {name} into new channels.","channel_invite")({name:TS.members.getPrefCompliantMemberName(i,a)}),show_cancel_button:false});else TS.generic_dialog.start({title:TS.i18n.t("Invite {name} to a channel","channel_invite")({name:TS.members.getPrefCompliantMemberName(i,a)}),body:TS.templates.channel_invite_list({channels:n,name:TS.members.getPrefCompliantMemberName(i,a,r)}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Invite","channel_invite")(),ladda:true,onGo:function e(){var t=$("#select_invite_channels").lazyFilterSelect("value");if(!t[0])return false;var n=t[0].id;TS.api.call("channels.invite",{channel:n,users:i.id})},onShow:function e(){var i={width:"230px",display:"inline-block"};$("#select_invite_channels").hide().lazyFilterSelect({filter:function e(t,i){if(!t||!t.name)return false;var n=t.name.toLowerCase();var a=i.toLowerCase();while("#"===a[0])a=a.slice(1,a.length);if(n.indexOf(a)>-1)return true;return false},onItemAdded:function e(i){TS.generic_dialog.div.find(".warning_already_member").addClass("hidden");if(!_.get(i,"id"))return;TS.generic_dialog.startLadda();TS.membership.ensureChannelMembershipIsKnownForUsers(i.id,[t]).then(function(){var e=TS.membership.getUserChannelMembershipStatus(t,i).is_member;if(e){TS.generic_dialog.div.find(".warning_already_member").removeClass("hidden");TS.generic_dialog.stopLadda();TS.generic_dialog.div.find(".dialog_go").addClass("disabled")}else TS.generic_dialog.stopLadda()})},placeholder_text:TS.i18n.t("Select a channel","channel_invite")(),css:i,classes:"select_invite_channels",data:n,template:function e(t){var i="#"+_.escape(t.name);i+=TS.templates.builders.maybeMakeSharedIcon(t);return new Handlebars.SafeString(i)}});$("#generic_dialog").find(".modal-body").css("overflow","visible")}})}});var e=function e(t,i,n){var a=TS.groups.getGroupById(t)||TS.channels.getChannelById(t);if(!a)return;var r=TS.shared.getControllerForModelOb(a);var s=a.is_group?"groups":"channels";var o;var l=function e(t){if(n&&_.isFunction(r.removeMsg))r.removeMsg(a.id,TS.utility.msgs.getMsg(n,a.msgs));if(t){_.chunk(i,30).forEach(function(e){TS.api.call(s+".invite",{channel:a.id,force:true,users:e.join(",")})});return true}if(_.isFunction(r.createChild))r.createChild(a.id,i,function(e,t){if(!e){var i=TS.i18n.t("Sorry! Something went wrong. Please try again.","channel_invite")();if(t&&"restricted_action"===t.error)i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>You don’t have permission to create new private channels.</p><p>Talk to your Workspace Owner.</p>","channel_invite")():TS.i18n.t("<p>You don’t have permission to create new private channels.</p><p>Talk to your Team Owner.</p>","channel_invite")();else TS.error(t.error+" error occurred during TS."+s+".createChild");setTimeout(function(){TS.generic_dialog.alert(i)},500)}})};var d=_.map(i,function(e){return TS.members.getPrefCompliantMemberName(TS.members.getMemberById(e),true)});o=TS.i18n.listify(d).join("");TS.ui.fs_modal.start({title:TS.i18n.t("Invite {who} to {model_ob}","channel_invite")({who:o,model_ob:TS.model.group_prefix+a.name}),body:TS.templates.group_member_invite_list(),show_cancel_button:false,show_go_button:true,go_button_text:TS.i18n.t("Yes, show channel history","channel_invite")(),show_secondary_go_button:true,secondary_go_button_text:TS.i18n.t("No, start a new channel","channel_invite")(),secondary_go_button_class:"btn_info",onGo:function e(){var t=true;return l(t)},onSecondaryGo:function e(){var t=false;return l(t)},onEnd:function e(){$(".modal-body").css("overflow-y","auto")}});$("#select_invite_group_members").hide().lazyFilterSelect();$("#select_invite_group_members_holder").css("min-height",235);$(".modal-body").css("overflow-y","visible")}})()},4389:function(e,t){(function(){"use strict";TS.registerModule("ui.banner",{show_hide_sig:new signals.Signal,onStart:function e(){TS.client.login_sig.add(TS.ui.banner.loggedIn,TS.ui.banner);TS.ui.growls.permission_changed_sig.add(TS.ui.banner.growlsPermissionChanged,TS.ui.banner)},loggedIn:function e(){var t=false;_.forOwn(TS.qs_args,function(e,i){var n=/^show_([\w_]+)_banner$/;if(n.test(i)&&"1"===e){var a=i.replace(n,"$1");if($("#"+a+"_banner").length>0){TS.ui.banner.show(a);t=true;return false}}});if(t)return;var n="nothing"===TS.notifs.getGlobalNotificationSetting();var a=!TS.model.is_iOS&&!TS.ui.growls.no_notifications&&TS.ui.growls.shouldShowPermissionButton()&&"denied"!==TS.ui.growls.getPermissionLevel()&&"1"!=window.readCookie("no_growl_banner")&&!n;if(a){TS.ui.banner.show("notifications");return}var r=TS.model.mac_version&&TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8")<=0;var s=TS.model.is_our_app&&TS.model.is_mac&&r;var o=i();var l=TS.model.is_mac&&"macgap"in window&&!o&&!TS.model.prefs.no_macelectron_banner;var d=TS.model.is_mac&&!r&&!TS.model.mac_ssb_version&&!TS.model.prefs.no_macssb1_banner;var c=TS.model.is_win_7_plus&&!TS.model.win_ssb_version&&!TS.model.prefs.no_winssb1_banner;if(s){TS.ui.banner.show("macssb_osx_deprecated");return}if(l){TS.ui.banner.show("macelectron2");return}if(d){TS.ui.banner.show("macssb1");return}if(c)TS.ui.banner.show("winssb1")},showSSBUpdateBanner:function e(i,n,a){if(t&&TS.utility.compareSemanticVersions(i,t)<=0)return;t=i;var r=$("#ssb_new_version_available_banner");if(!r.length)return;r.find(".old_version_number").text(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch);r.find(".new_version_number").text(i);r.find(".can_update").toggleClass("hidden",!n);r.find(".can_not_update").toggleClass("hidden",n);r.find(".update_link").off("click").on("click",function(e){e.preventDefault();TSSSB.call("quitAndInstallUpdate")});r.find(".learn_link").attr("href",a);TS.ui.banner.show("ssb_new_version_available")},closeSSBUpdateBanner:function e(){TS.ui.banner.close()},growlsPermissionChanged:function e(t,i){if("default"!==i)TS.ui.banner.close()},growlsPermissionPrompt:function e(){TS.ui.growls.promptForPermission(function(e,t){if("granted"===t&&e){TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("Nice, notifications are enabled!","prefs")());if(!TS.model.prefs.growls_enabled){TS.prefs.setPrefByAPI({name:"growls_enabled",value:true});TS.model.prefs.growls_enabled=true}}})},show:function t(i){i=i||e;e=i;var n=TS.client.ui.$banner;n.removeClass("hidden");$("body").addClass("banner_showing");n.css("display","block");n.children(".banner").addClass("hidden");TS.ui.banner.show_hide_sig.dispatch("show");var a=false;var r;if("no_banner"===i){$("#notifications_banner").addClass("hidden");$("#notifications_dismiss_banner").addClass("hidden")}else if("notifications_dismiss"===i){$("#notifications_dismiss_banner").removeClass("hidden");n.unbind("click").bind("click",function(){TS.ui.banner.close();TS.ui.banner.show("no_banner")});a=true;r="recommend_desktop_notifications_banner"}else if("notifications"===i){$("#notifications_banner").removeClass("hidden");n.unbind("click").bind("click",function(e){if(0===$(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.growlsPermissionPrompt();else{$("#notifications_banner").addClass("hidden");TS.ui.banner.show("notifications_dismiss");return}TS.ui.banner.close()});a=true;r="enable_desktop_notifications_banner"}else if("macelectron2"===i){$("#macelectron2_banner").removeClass("hidden");n.unbind("click").bind("click",function(e){if($(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.onClickedMacElectronLink(this,true);else if(!$(e.target).hasClass("update_link")){var t=$(this).find(".update_link");t.click()}});TS.prefs.setPrefByAPI({name:"no_macelectron_banner",value:true});a=true;r="mac_electron2_banner"}else if("macssb1"===i){$("#macssb1_banner").removeClass("hidden");n.unbind("click").bind("click",function(e){if($(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.onClickedMacSSB1Link(this,true);else if(!$(e.target).hasClass("apps_page_link")){var t=$(this).find(".apps_page_link");TS.utility.openInNewTab(t.attr("href"),t.attr("target"));t.click()}});a=true;r="mac_ssb1_banner"}else if("winssb1"===i){$("#winssb1_banner").removeClass("hidden");n.unbind("click").bind("click",function(e){if($(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.onClickedWinSSB1Link(this,true);else if(!$(e.target).hasClass("apps_page_link")){var t=$(this).find(".apps_page_link");TS.utility.openInNewTab(t.attr("href"),t.attr("target"));t.click()}});a=true;r="win_ssb1_banner"}else if("macssb_osx_deprecated"===i){$("#macssb_osx_deprecated_banner").removeClass("hidden");n.unbind("click").bind("click",function(){TS.ui.banner.close()});a=true;r="mac_ssb_osx_deprecated_banner"}else if("ssb_new_version_available"===i){var s=$("#ssb_new_version_available_banner");s.removeClass("hidden");s.find('a[data-action="dismiss_banner"]').unbind("click").bind("click",function(){TS.ui.banner.close();TSSSB.call("closeAllUpdateBanners")});a=true;r="ssb_new_version_available_banner"}else{var o=n.find("#"+i+"_banner");if(!o.length){TS.error("Tried to show a banner called "+i+", but can’t find an element with that as its ID");return}o.removeClass("hidden");o.find('a[data-action="dismiss_banner"]').unbind("click").bind("click",function(){TS.ui.banner.close()});a=true;r="generic_banner"}if(a)TS.clog.track("BANNER_ACTION",{contexts:{ui_context:{action:"impression",ui_element:r}}});TS.view.resizeForBanner("TS.ui.banner.show")},onClickedMacElectronLink:function e(t,i){TS.ui.banner.close();var n=$(t);if(!n.closest(".banner").hasClass("hidden"))TS.clog.track("BANNER_ACTION",{click_target:"get_mac_electron_banner",trigger:n.parent().attr("id"),page_url:n.attr("href"),action:i?"banner_dismiss":"banner_click",contexts:{ui_context:{action:i?"close":"click",ui_element:"mac_electron2_banner"},referring_ui_context:{ui_element:n.parent().attr("id")}}})},onClickedMacSSB1Link:function e(t,i){TS.ui.banner.close();TS.prefs.setPrefByAPI({name:"no_macssb1_banner",value:true});var n=$(t);if(!n.closest(".banner").hasClass("hidden"))TS.clog.track("BANNER_ACTION",{click_target:"get_mac_ssb_banner",page_url:n.attr("href"),action:i?"banner_dismiss":"banner_click",contexts:{ui_context:{action:i?"close":"click",ui_element:"mac_ssb1_banner"}}})},onClickedWinSSB1Link:function e(t,i){TS.ui.banner.close();TS.prefs.setPrefByAPI({name:"no_winssb1_banner",value:true});var n=$(t);if(!n.closest(".banner").hasClass("hidden"))TS.clog.track("BANNER_ACTION",{click_target:"get_win_ssb_banner",page_url:n.attr("href"),action:i?"banner_dismiss":"banner_click",contexts:{ui_context:{action:i?"close":"click",ui_element:"win_ssb1_banner"}}})},closeNagAndSetCookie:function e(){TS.ui.banner.close();window.createCookie("no_growl_banner","1",3650)},closeNagAndOpenPrefs:function e(){TS.ui.banner.close();setTimeout(function(){TS.ui.prefs_dialog.start("notifications")},500)},close:function e(){var t=TS.client.ui.$banner;t.slideUp(200,function(){t.addClass("hidden");$("body").removeClass("banner_showing");var e=TS.client&&TS.client.ui.areMsgsScrolledToBottom();TS.view.resizeForBanner("TS.ui.banner.close");TS.ui.banner.show_hide_sig.dispatch("hide");if(e)TS.client.ui.instaScrollMsgsToBottom(false)})}});var e="notifications";var t;function i(){if(!("macgap"in window))return false;try{return"1"===TSSSB.call("isAppStoreBuild")}catch(e){TS.logError(e,"macgap.app.isAppStoreBuild() failed","macgap error");return false}}})()},4390:function(e,t){(function(){"use strict";TS.registerModule("newxp",{onboarding:{cancel:{step_name:"onboarding_cancelled",pref_name:"onboarding_cancelled",show:"#unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",hide:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #in_skip_messaging",unstyle:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function e(){return new Promise(function(){$("#end_display_onboarding").on("click.cancel_onboarding",".skip_tutorial_link",o)}).finally(function(){TS.view.unAdjustForWelcomeSlideShow();TS.client.ui.$msg_input.focus();d(TS.newxp.onboarding.cancel);TS.client.ui.slowScrollMsgsToBottom();$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding").on("click.take_onboarding",l);$("#end_display_onboarding").off("click.cancel_onboarding");return TS.prefs.setPrefByAPI({name:"onboarding_cancelled",value:true})})}},loading:{step_name:"onboarding_loading",pref_name:"",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container, #pre_skip_messaging",hide:"#banner, #in_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function e(){return new Promise(function(){TS.view.adjustForWelcomeSlideShow();d(TS.newxp.onboarding.loading)})}},start:{step_name:"onboarding_start",pref_name:"seen_onboarding_start",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging",hide:"#in_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function e(){return new Promise(function(e){TS.view.adjustForWelcomeSlideShow();d(TS.newxp.onboarding.start);$("#explore_btn_container > .btn").on("click",function(){TS.metrics.mark("onboarding_btn_click");TS.clog.track("GROWTH_ONBOARDING",{action:"onboarding_btn_click",step:s})});$("#explore_btn_container > .btn").on("click.start_onboarding",e)}).then(function(){return TS.prefs.setPrefByAPI({name:"seen_onboarding_start",value:true})}).finally(function(){$("#explore_btn_container > .btn").off("click.start_onboarding");return TS.prefs.setPrefByAPI({name:"seen_welcome_2",value:true})})}},complete:{step_name:"onboarding_complete",pref_name:"seen_onboarding_complete",show:"#star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header, .coachmark_got_it",hide:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #in_skip_messaging, #unskip_messaging",unstyle:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function e(){return Promise.resolve().then(function(){d(TS.newxp.onboarding.complete);$("#end_display_onboarding").off("click.cancel_onboarding");$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding");TS.client.ui.slowScrollMsgsToBottom();TS.client.ui.$msg_input.focus();if(TS.ims.message_received_sig.has(T,TS.newxp))TS.ims.message_received_sig.remove(T,TS.newxp);return TS.prefs.setPrefByAPI({name:"newxp_slackbot_step",value:"A2"})})}},slackbot:{step_name:"onboarding_slackbot_conversation",pref_name:"seen_onboarding_slackbot_conversation",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #in_skip_messaging",hide:"#explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",unstyle:"#client_body",promiseTo:function e(){var t=null;var i=function e(t,i,n){if(p(i,n))t()};return Promise.resolve().then(function(){d(TS.newxp.onboarding.slackbot);TS.view.unAdjustForWelcomeSlideShow();TS.view.focusMessageInput();$("#footer_overlay").css("opacity",0);TS.ims.message_received_sig.add(S,TS.newxp)}).delay(400*$("#footer_overlay").css("opacity")).then(function(){$("#footer_overlay").addClass("hidden");TS.client.ui.slowScrollMsgsToBottom()}).then(function(){if(!TS.model.prefs.onboarding_slackbot_conversation_step)return Promise.resolve();if(a)return Promise.resolve();return new Promise(function(e){t=i.bind(null,e);TS.ims.message_received_sig.add(t,TS.newxp);return TS.prefs.setPrefByAPI({name:"greeting_step",value:"go"})}).finally(function(){TS.ims.message_received_sig.remove(t,TS.newxp)})}).then(function(){if(TS.model.prefs.onboarding_slackbot_conversation_step>1)return Promise.resolve();return new Promise(function(e){t=i.bind(null,e);TS.ims.message_received_sig.add(t,TS.newxp);TS.metrics.measure("sending_api_call_to_queue_slackbot","onboarding_btn_click");TS.metrics.mark("onboarding_api_call");return TS.prefs.setPrefByAPI({name:"greeting_step",value:"start"})}).then(function(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"Type something");return TS.prefs.setPrefByAPI({name:"onboarding_slackbot_conversation_step",value:1})}).finally(function(){TS.metrics.measure("received_first_slackbot_msg_from_onboarding_button","onboarding_btn_click");TS.metrics.measure("received_first_slackbot_msg_from_api_call","onboarding_api_call");TS.metrics.clearMarks("onboarding_btn_click");TS.metrics.clearMarks("onboarding_api_call");TS.ims.message_received_sig.remove(t,TS.newxp)})}).then(function(){var e=Promise.resolve().then(function(){var e=TS.model.prefs.onboarding_slackbot_conversation_step>1?0:3e4;return Promise.delay(e).then(function(){return new Promise(function(e){t=i.bind(null,e);TS.ims.message_received_sig.add(t,TS.newxp);return TS.prefs.setPrefByAPI({name:"intro_step",value:"notyping_1"})}).then(function(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"Type something");TS.client.ui.$msg_input.addClass("onboarding");TS.client.ui.files.$file_btn.addClass("onboarding");return TS.prefs.setPrefByAPI({name:"onboarding_slackbot_conversation_step",value:2})}).delay(2e3).finally(function(){TS.ims.message_received_sig.remove(t,TS.newxp);TS.client.ui.$msg_input.removeClass("onboarding");TS.client.ui.files.$file_btn.removeClass("onboarding")})})}).delay(6e5).then(function(){return new Promise(function(e){t=i.bind(null,e);TS.ims.message_received_sig.add(t,TS.newxp);return TS.prefs.setPrefByAPI({name:"intro_step",value:"notyping_2"})}).then(function(){o();r.cancel()}).finally(function(){TS.ims.message_received_sig.remove(t,TS.newxp)})});var n=function e(t,i,n){if(p(i,n)&&-1!=n.text.indexOf("Let me show you a couple things about Slack"))t()};var a=function t(i,n){if(g(i,n))e.cancel()};var r=new Promise(function(e){TS.ims.message_received_sig.add(a,TS.newxp);n=n.bind(null,e);TS.ims.message_received_sig.add(n,TS.newxp);return TS.prefs.setPrefByAPI({name:"greeting_step",value:"expecting"})}).then(function(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"");return TS.prefs.setMultiPrefsByAPI({onboarding_slackbot_conversation_step:10,seen_onboarding_slackbot_conversation:true})}).finally(function(){TS.ims.message_received_sig.remove(n,TS.newxp);TS.ims.message_received_sig.remove(a,TS.newxp)});return Promise.any([r,e]).finally(function(){if(r)r.cancel();if(e)e.cancel()})}).finally(function(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"");TS.client.ui.$msg_input.removeClass("onboarding");TS.client.ui.files.$file_btn.removeClass("onboarding");TS.ims.message_received_sig.remove(S,TS.newxp);TS.ims.message_received_sig.add(T,TS.newxp);setTimeout(function(){if(TS.ims.message_received_sig.has(T,TS.newxp))TS.ims.message_received_sig.remove(T,TS.newxp)},18e4);return TS.prefs.setMultiPrefsByAPI({intro_step:"",greeting_step:""})})}},channels:{step_name:"onboarding_channels",pref_name:"seen_onboarding_channels",show:"#active_channel_name_overlay, #in_skip_messaging, .coachmark_next_tip",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#col_channels_footer",promiseTo:function e(){var t=$("#starred_div, #direct_messages, #channel_list_invites_link, #quick_switcher_btn");return new Promise(function(e){TS.client.ui.$msg_input.blur();d(TS.newxp.onboarding.channels);TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.channels,{resolve:e,reject:o}));t.addClass("translucent")}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_channels",value:true});return null}).finally(function(){t.removeClass("translucent")})}},direct_messages:{step_name:"onboarding_direct_messages",pref_name:"seen_onboarding_direct_messages",show:"#active_channel_name_overlay, #in_skip_messaging",show_member:".coachmark_got_it",show_admin:".coachmark_next_tip",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging",hide_member:".coachmark_next_tip",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#col_channels_footer",promiseTo:function e(){var t=$("#starred_div, #channels, #channel_list_invites_link, #quick_switcher_btn");return new Promise(function(e){d(TS.newxp.onboarding.direct_messages);TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.direct_messages,{resolve:e,reject:o}));t.addClass("translucent")}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_direct_messages",value:true});return null}).finally(function(){t.removeClass("translucent")})}},invites:{step_name:"onboarding_invites",pref_name:"seen_onboarding_invites",show:"#active_channel_name_overlay, #in_skip_messaging, .coachmark_got_it",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging, .coachmark_next_tip",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#quick_switcher_btn",promiseTo:function e(){var t=$("#starred_div, #channels, #direct_messages");return new Promise(function(e){d(TS.newxp.onboarding.invites);TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.invites,{resolve:e,reject:o}));t.addClass("translucent")}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_invites",value:true});return null}).finally(function(){t.removeClass("translucent")})}},recent_mentions:{step_name:"onboarding_recent_mentions",pref_name:"seen_onboarding_recent_mentions",promiseTo:function e(){var t;var i;return new Promise(function(e,n){t=$("#recent_mentions_toggle");y(t);i=t.find(".starburst");A(TS.coachmark.start.bind(null,$.extend({},TS.coachmarks.coachmarks.recent_mentions,{resolve:e,reject:n.bind(null,new Error("Click-tick onboarding cancelled"))})),t,i)}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_recent_mentions",value:true});return null}).finally(function(){C(t,i);k(t)})}},starred_items:{step_name:"onboarding_starred_items",pref_name:"seen_onboarding_starred_items",promiseTo:function e(){var t;var i;return new Promise(function(e,n){t=$("#stars_toggle");y(t);i=t.find(".starburst");A(TS.coachmark.start.bind(null,$.extend({},TS.coachmarks.coachmarks.starred_items,{resolve:e,reject:n.bind(null,new Error("Click-tick onboarding cancelled"))})),t,i)}).then(function(){TS.prefs.setPrefByAPI({name:"seen_onboarding_starred_items",value:true});return null}).finally(function(){C(t,i);k(t)})}}},onStart:function e(){},inOnboarding:function t(){return e},startOnboarding:function e(){if(TS.model.seen_welcome_2)return;I();if(TS.model.seen_welcome_2)return;if(M())TS.ims.startImByMemberName("slackbot");if(TS.model.prefs.onboarding_cancelled){d(TS.newxp.onboarding.cancel);$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding").on("click.take_onboarding",l);$("#end_display_onboarding").removeClass("hidden")}else{TS.model.seen_onboarding_this_session=true;r=!TS.client.ui.$banner.hasClass("hidden");d(TS.newxp.onboarding.loading);l()}},cancelOnboarding:function e(){if(!TS.onboarding.shouldShowFirstWelcome())$("#end_display_onboarding").addClass("hidden");o()},getCurrentStepName:function e(){return s},test:function e(){return{deferredCancel:o,startOnboarding:l,goToStep:d,getBaseSteps:c,getUserSteps:u,composeUserOnboarding:m,composeCancelOnboarding:f,acceptIMMessage:g,isSlackbot:p,onSkipOrStop:S,restartOnGo:T,waitAllOrCancel:v,enableScrollFadeOut:b,disableScrollFadeOut:w,addClickTickStarburst:y,removeClickTickStarburst:k,addClickTickInteractions:A,removeClickTickInteractions:C,shouldDirectToSlackbotForOnboarding:M}}});var e=false;var t=null;var i=null;var n=null;var a=false;var r=false;var s="";var o=function e(){if(i){i.finally(function(){if(i.isCancelled()&&n)n.cancel()});i.cancel()}else if(n)n.cancel()};var l=function e(){o();if(TS.model.ui_state.flex_visible)TS.client.ui.flex.hideFlex();if(TS.model.prefs.onboarding_cancelled)TS.prefs.setPrefByAPI({name:"onboarding_cancelled",value:false});TS.prefs.onPrefChanged({name:"onboarding_cancelled",value:false});b();i=m();n=f();if(!TS.model.user.is_restricted&&!t)t=h();$("#end_display_onboarding").removeClass("hidden")};var d=function e(t){s=t.step_name;$(t.show).removeClass("hidden");$(t.hide).addClass("hidden");$(t.style).addClass("onboarding");$(t.unstyle).removeClass("onboarding");if(TS.ui.admin_invites.canInvite()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26){$(t.hide_admin).addClass("hidden");$(t.show_admin).removeClass("hidden")}else{$(t.hide_member).addClass("hidden");$(t.show_member).removeClass("hidden")}TS.clog.track("GROWTH_ONBOARDING",{action:"enter_step",step:s})};var c=function e(){var t=["start","slackbot","channels","direct_messages","complete"];if(TS.ui.admin_invites.canInvite()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26)t.splice(4,0,"invites");return t};var u=function e(){return c().filter(function(e){return!TS.model.prefs[TS.newxp.onboarding[e].pref_name]})};var m=function t(){e=true;return TS.experiment.loadUserAssignments().then(function(){var t;u().forEach(function(e){t=!t?TS.newxp.onboarding[e].promiseTo():t.then(TS.newxp.onboarding[e].promiseTo)});if(t){if(!i)TS.client.ui.$banner.addClass("hidden");TS.ui.banner.close();t.finally(function(){e=false;if(r){TS.ui.banner.show();TS.client.ui.$banner.removeClass("hidden")}if(t.isCancelled())return;TS.model.seen_welcome_2=true;$("#end_display_onboarding").addClass("hidden");TS.client.msg_pane.updateEndMarker();w()})}else e=false;return t})};var f=function e(){return TS.newxp.onboarding.cancel.promiseTo()};var h=function e(){var t=["recent_mentions","starred_items"].filter(function(e){return!TS.model.prefs[TS.newxp.onboarding[e].pref_name]}).map(function(e){return TS.newxp.onboarding[e].promiseTo()});return v(t)};var g=function e(t,i){return t.id==TS.model.active_im_id&&TS.members.getMemberById(t.user).is_slackbot&&i&&TS.members.getMemberById(i.user).is_self};var p=function e(t,i){return t&&i&&t.user==i.user&&TS.members.getMemberById(t.user).is_slackbot};var S=function e(t,i){if(p(t,i)&&-1!=i.text.indexOf("Okay, we can skip this conversation"))o()};var T=function e(t,i){if(p(t,i)&&-1!=i.text.indexOf("Lovely, where were we? Ah, yes...")){TS.ims.message_received_sig.remove(e,TS.newxp);if(TS.model.prefs.onboarding_cancelled&&TS.onboarding.shouldShowFirstWelcome()){l();a=true}}};var v=function e(t){return Promise.all(t).then(_.noop,function(){t.forEach(function(e){e.cancel()})})};var b=function e(){var t=$("#onboarding_fade_out_mask").removeClass("hidden");TS.client.ui.$msgs_scroller_div.on("scroll.onboarding",function(){if(TS.client.ui.$msgs_scroller_div[0].scrollTop>300){if(!t.hasClass("hidden"))t.addClass("hidden")}else if(t.hasClass("hidden"))t.removeClass("hidden")})};var w=function e(){TS.client.ui.$msgs_scroller_div.off("scroll.onboarding");$("#onboarding_fade_out_mask").addClass("hidden")};var y=function e(t){t.append($("<div class='starburst_wrapper'><span class='starburst'></span></div>"))};var k=function e(t){t.find("> .starburst_wrapper").remove()};var A=function e(t,i,n,a,r){i=i||$();n=n||$();r=r||i;a=a||n;i.on("mouseenter.onboarding",function(){if(r.hasClass("onboarding"))return;n.css("opacity",1);if(t)t()}).on("mouseleave.onboarding",function(){if(i.hasClass("onboarding"))return;if(TS.coachmark.is_showing&&TS.coachmark.is_small){TS.coachmark.end();n.css("opacity",0)}}).addClass("jquery_hover");if(a!=n)a.css("height",i.outerHeight(true)).css("width",i.outerWidth(true));a.on("click.onboarding",function(e){if(e)e.stopPropagation();TS.coachmark.expand()})};var C=function e(t,i,n){i=i||$();n=n||i;t.off("mouseenter.onboarding mouseleave.onboarding").removeClass("jquery_hover");n.off("click.onboarding")};var M=function e(){return!TS.onboarding.shouldShowFirstWelcome()&&!TS.model.prefs.onboarding_cancelled};var I=function e(){var t=TS.onboarding.shouldShowFirstWelcome();var i=!t&&(TS.model.prefs.onboarding_cancelled||TS.model.prefs.seen_onboarding_start)||t&&(TS.model.prefs.onboarding_cancelled||TS.model.prefs.seen_onboarding_start)&&!TS.model.seen_onboarding_this_session;if(i){TS.model.seen_welcome_2=true;TS.client.msg_pane.updateEndMarker()}}})()},4391:function(e,t){(function(){"use strict";TS.registerModule("onboarding",{onStart:function e(){if(!TS.client)return;TS.client.login_sig.add(TS.onboarding.onLogin,TS.onboarding,-1);TS.prefs.seen_welcome_2_changed_sig.add(TS.onboarding.setSeenWelcome2)},onLogin:function e(){if(void 0!==TS.boot_data.prefs_seen_welcome_2)TS.model.seen_welcome_2=TS.boot_data.prefs_seen_welcome_2;else TS.onboarding.setSeenWelcome2();TS.onboarding.startOnboarding()},setSeenWelcome2:function e(){TS.model.seen_welcome_2=TS.model.prefs.seen_welcome_2},startOnboarding:function e(){if(TS.model.prefs.quests_enabled)TS.quests.startOnboarding();else TS.newxp.startOnboarding()},cancelOnboarding:function e(){if(TS.model.prefs.quests_enabled)TS.quests.cancelOnboarding();else TS.newxp.cancelOnboarding()},inOnboarding:function e(){if(TS.model.prefs.quests_enabled)TS.quests.inOnboarding();else TS.newxp.inOnboarding()},shouldShowFirstWelcome:function e(){if(TS.boot_data.incremental_boot_data&&(false===_.get(TS.boot_data.incremental_boot_data,"self.prefs.seen_welcome_2",void 0)||false===TS.boot_data.prefs_seen_welcome_2))return true;if(TS.model&&TS.model.seen_welcome_2)return false;if(!(TS.model&&TS.model.welcome_model_ob&&TS.model.welcome_model_ob.id))return false;var t=TS.shared.getActiveModelOb();if(!t)return false;if(t.id==TS.model.welcome_model_ob.id)return true;return false}})})()},4392:function(e,t){(function(){"use strict";TS.registerModule("quests",{quest_assigned_sig:new signals.Signal,onStart:function e(){},inOnboarding:function t(){return e},startOnboarding:function e(){var i={only_active:false};TS.api.call("quests.list",i,function(e,i){if(e)t(i.user_quests);else TS.quests.quest_assigned_sig.add(t)})},cancelOnboarding:function e(){}});var e=false;var t=function e(t){var i=t.shift();TS.info(i);TS.ui.onboarding_dialog.start()}})()},4393:function(e,t){(function(){"use strict";TS.registerModule("ui.msg_tab_complete",{$input:null,onStart:function e(){},start:function t(i){if(e)return;e=true;TS.ui.msg_tab_complete.$input=i;i.tab_complete_ui({id:"chat_input_tab_ui"})},positionUI:function t(){if(!e)return;TS.ui.msg_tab_complete.$input.tab_complete_ui("positionUI")},isShowing:function t(){return e&&TS.ui.msg_tab_complete.$input.tab_complete_ui("isShowing")}});var e=false})()},4394:function(e,t){(function(){"use strict";TS.registerModule("typing",{started_sig:new signals.Signal,ended_sig:new signals.Signal,onStart:function e(){t=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.typing.getTypingByKey);i=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.typing.getNumberOfRecords);n=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.typing.getTyperIdsInChannel);a=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.typing.getAllTyping)},test:function e(){return{getNumberOfRecords:i}},maybeStartTimer:function t(){if(e)return;e=setInterval(TS.typing.checkMap,1e3)},userStarted:function e(i){if(!TS.model.ms_connected)return;if(!i)return;var n=TS.model.user;var a=i.id+"_"+n.id;if(t(a))return;var r={type:"typing",channel:i.id};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.send(r);else TS.ms.send(r);TS.typing.memberStarted(i,TS.model.user)},memberStarted:function e(i,n){var a=i.id+"_"+n.id;var s=Date.now();var o=!t(a);var l=TS.interop.redux.features.typing.updateTyping({key:a,started:s,model_ob_id:i.id,member_id:n.id,member_is_self:n.is_self});TS.redux.dispatch(l);if(o){TS.typing.started_sig.dispatch(i,n);if(TS.has_pri[r])TS.log(r,"added "+a)}else if(TS.has_pri[r])TS.log(r,"updated "+a);TS.typing.maybeStartTimer()},userEnded:function e(t){if(!t)return;var i=TS.model.user;TS.typing.memberEnded(t,i)},memberEnded:function e(t,i){var n=t.id+"_"+i.id;TS.typing.expungeMember(t,i);if(TS.has_pri[r])TS.log(r,"removed "+n)},expungeMember:function e(t,i){var n=t.id+"_"+i.id;var a=TS.interop.redux.features.typing.clearTyping({key:n});TS.redux.dispatch(a);TS.typing.ended_sig.dispatch(t,i)},checkMap:function t(){var n=Date.now();var s=0;var o=a();var l=TS.interop.redux.features.typing.removeOldTypingRecords({now:n});TS.redux.dispatch(l);var d=a();var c=_.difference(Object.keys(o),Object.keys(d));c.forEach(function(e){var t=o[e];var i=TS.members.getMemberById(t.member_id);var n=TS.redux.channels.getEntityById(t.model_ob_id);TS.typing.ended_sig.dispatch(n,i);if(TS.has_pri[r])TS.log(r,"removed "+e+" after it exceeded its maximum duration")});s=i();if(s<1){clearTimeout(e);e=null}},getTypersInChannel:function e(t){var i=_.map(n(t),TS.members.getMemberById);i.sort(function(e,t){if(TS.members.getPrefCompliantMemberNameLowerCase(e)<TS.members.getPrefCompliantMemberNameLowerCase(t))return-1;if(TS.members.getPrefCompliantMemberNameLowerCase(e)>TS.members.getPrefCompliantMemberNameLowerCase(t))return 1;return 0});return i}});var e=null;var t;var i;var n;var a;var r=47})()},4395:function(e,t){(function(){"use strict";TS.registerModule("ui.channel_options_dialog",{div:null,showing:false,c_id:null,ladda:null,preselected_section:null,params:null,onKeydown:function e(t){if(!TS.ui.channel_options_dialog.showing)return;if(t.which===TS.utility.keymap.esc)TS.ui.channel_options_dialog.cancel()},start:function e(t,i,n){TS.ui.channel_options_dialog.ladda=null;TS.ui.channel_options_dialog.c_id=t;TS.ui.channel_options_dialog.preselected_section=i;TS.ui.channel_options_dialog.params=n;r()},go:function e(){if(!TS.ui.channel_options_dialog.showing){TS.error("not showing?");return}var t=TS.ui.channel_options_dialog.div;t.modal("hide")},cancel:function e(){TS.ui.channel_options_dialog.div.modal("hide")},end:function e(){TS.ui.channel_options_dialog.c_id=null;TS.model.dialog_is_showing=false;TS.ui.channel_options_dialog.showing=false;TS.ui.channel_options_dialog.params=null;$(window.document).unbind("keydown",TS.ui.channel_options_dialog.onKeydown)},build:function e(){$("body").append('<div id="channel_options_dialog" class="modal hide fade"></div>');TS.ui.channel_options_dialog.div=$("#channel_options_dialog");var t=TS.ui.channel_options_dialog.div;t.on("hide",function(e){if(e.target!=this)return;TS.ui.channel_options_dialog.end()});t.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.channel_options_dialog.showing=true});t.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){$(window.document).bind("keydown",TS.ui.channel_options_dialog.onKeydown)},100)})},addTempEphemeralFeedback:function e(t){TS.client.ui.addOrFlashEphemeralBotMsg({text:t})},startWithChannelOption:function e(t,i,n,a,r){w(t);b(i);k(n);c=a;TS.ui.fs_modal.showBackButton();S(true);if(r)x()},showAllOptions:function e(){v()}});var e;var t;var i;var n;var a="all";var r=function e(){a="all";var t=TS.shared.getModelObById(TS.ui.channel_options_dialog.c_id);if(!t){var i=TS.i18n.t("Oops! No channel found???","channel_options")();TS.generic_dialog.alert('<p class="no_bottom_margin">'+i+"</p>");return}var n=t.is_private||t.is_group;var r=false;if(!n&&!t.is_general&&!t.is_im&&TS.model.user.is_admin&&!t.is_org_default)r=TS.permissions.members.canCreateGroups();var l=false;if(!TS.channels.isChannelRequired(t)){var c=true;if(TS.boot_data.page_needs_enterprise&&t.is_org_shared)if(!TS.permissions.members.canManageOrgSharedChannels()&&!TS.model.user.enterprise_user.is_owner||t.is_org_default)c=false;if(c)l=t.is_channel&&TS.permissions.members.canArchiveChannels()||t.is_group&&TS.permissions.members.canArchiveChannels()&&!TS.model.user.is_restricted}var _=!TS.channels.isChannelRequired(t)&&t.is_channel&&TS.model.user.is_admin&&!t.is_org_default;var u=false;if(TS.boot_data.page_needs_enterprise&&t.is_org_shared&&!t.is_im&&TS.permissions.members.canManageOrgSharedChannels())u=true;else if(!t.is_im&&(TS.model.user.is_admin||t.creator===TS.model.user.id))u=true;var m=false;if(!TS.model.user.is_ultra_restricted&&(!t.is_general||TS.members.canUserPostInGeneral())&&!t.is_im)m=true;var f=false;if(""!==TS.model.team.plan&&(TS.model.user.is_owner||true==n||t.is_im)&&TS.model.team.prefs.allow_retention_override)f=true;var h=false;if(TS.boot_data.page_needs_enterprise&&t.is_org_shared&&!t.is_im&&TS.permissions.members.canManageOrgSharedChannels())h=true;var g=false;if(TS.boot_data.page_needs_enterprise&&!t.is_shared&&!t.is_im&&!t.is_general)if(TS.permissions.members.canCreateConvertOrgSharedChannels())g=true;var p=false;if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels){g=false;if(TS.boot_data.page_needs_enterprise)p=TS.permissions.members.canCreateConvertOrgSharedChannels()}var S=TS.shared.isModelObShared(t)&&TS.boot_data.feature_disconnecting_shared_channels;var T={name:new Handlebars.SafeString(o(t)),model_ob:t,show_convert_btn:r,show_archive_btn:l,show_delete_btn:_,show_rename_btn:u,show_purpose_btn:m,show_data_retention_link:f,show_convert_to_shared_btn:g,show_manage_posting_privilege_btn:h,show_share_channel_btn:!t.is_shared&&TS.permissions.members.canRequestSharedChannel()&&!t.is_general,show_export_btn:TS.permissions.members.canExportMessageHistory(t),show_manage_teams:p,show_disconnect_btn:S};var v=TS.i18n.t("Additional Options for #{channel_name}","channel_options")({channel_name:t.name});var b={title:v,body_template_html:TS.templates.channel_options_dialog(T),onShow:s,onCancel:d,modal_class:"channel_options_modal"};TS.ui.fs_modal.start(b)};var s=function a(){var r=TS.shared.getModelObById(TS.ui.channel_options_dialog.c_id);TS.ui.channel_options_dialog.div=$(".channel_options_modal");e=TS.ui.channel_options_dialog.div.find('.channel_options_section[data-section="options"]');t=TS.ui.channel_options_dialog.div.find('.channel_options_section[data-section="option"]');i=TS.ui.channel_options_dialog.div.find('.channel_options_section[data-section="review"]');n=TS.ui.channel_options_dialog.div.find(".channel_options_buttons");e.on("click",".channel_option_item",function(){var e=$(this).data("action");if(!TS.ui.channel_options_dialog.preselected_section)h();switch(e){case"channel_archive_btn":F(r);break;case"channel_delete_btn":R(r);break;case"channel_disconnect_btn":O(r);break;case"group_archive_btn":P(r);break;case"channel_convert_btn":U(r);break;case"shared_channel_convert_btn":Q(r);break;case"manage_teams_btn":h();te(r);break;case"channel_rename_btn":ae(r);break;case"channel_purpose_btn":re(r);break;case"data_retention_btn":Ie(r);break;case"posting_privilege_btn":Ce(r);break;case"export_history_btn":se(r);break;case"share_channel_btn":TS.ui.share_channel_dialog.start({model_ob:r})}});TS.ui.channel_options_dialog.div.find(".option_cancel").on("click",function(){if(TS.ui.channel_options_dialog.preselected_section)TS.ui.fs_modal.close();else v()});TS.ui.channel_options_dialog.div.find(".option_review").on("click",f);TS.ui.channel_options_dialog.div.find(".option_go").on("click",m);if(TS.ui.channel_options_dialog.preselected_section)switch(TS.ui.channel_options_dialog.preselected_section){case"archive":if(r.is_group)e.find('[data-action="group_archive_btn"]').click();else e.find('[data-action="channel_archive_btn"]').click();break;case"delete":e.find('[data-action="channel_delete_btn"]').click();break;case"export":e.find('[data-action="export_history_btn"]').click();break;case"convert_private":e.find('[data-action="channel_convert_btn"]').click();break;case"convert_shared":e.find('[data-action="shared_channel_convert_btn"]').click();break;case"rename":e.find('[data-action="channel_rename_btn"]').click();break;case"purpose":e.find('[data-action="channel_purpose_btn"]').click();break;case"retention":e.find('[data-action="data_retention_btn"]').click();break;case"posting_privilege":e.find('[data-action="posting_privilege_btn"]').click();break;case"manage_teams":e.find('[data-action="manage_teams_btn"]').click()}};var o=function e(t){var i;if(t.is_channel||t.is_group)i=TS.templates.builders.makeChannelPrefix(t)+_.escape(t.name);else return"";var n=TS.templates.builders.maybeMakeSharedIcon(t);return"<strong>"+i+n+"</strong>"};var l=function e(){if(TS.ui.channel_options_dialog.ladda)return;TS.ui.channel_options_dialog.ladda=Ladda.create(TS.ui.channel_options_dialog.div.find(".option_go")[0])};var d=function e(){h(true)};var c=_.noop;var u=_.noop;var m=function e(){c()};var f=function e(){u()};var h=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(g);TS.ui.fs_modal.showBackButton()}};var g=function e(){if("option"===a)v();else if("review"===a){S();D()}};var p=function r(){a="all";t.hide();n.hide();i.hide();e.show()};var S=function r(s,o){a="option";e.hide();n.show();i.hide();t.show();if(s){if(!o)o="go";E();if("go"===o)B();else D();l()}};var T=function r(){a="review";e.hide();t.hide();n.show();i.show();B();l()};var v=function e(){h(true);A(false);C(false);p()};var b=function e(i){t.find(".channel_options_header").html(i)};var w=function e(i){t.find(".channel_option_content").html(i)};var y=function e(t){i.find(".channel_options_review_content").html(t)};var k=function e(t){n.find(".option_go .ladda-label").text(t)};var A=function e(t){if(void 0===t)t=false;n.find(".option_go").toggleClass("btn_danger",t)};var C=function e(t){if(!t)t=false;n.find(".option_go").toggleClass("disabled",t)};var M=function e(t){if(!t)t=false;n.find(".option_review").toggleClass("disabled",t)};var I=function e(t){n.find(".option_review").text(t)};var x=function e(){n.addClass("hidden")};var E=function e(){n.removeClass("hidden")};var B=function e(){n.find(".option_review").addClass("hidden");n.find(".option_go").removeClass("hidden")};var D=function e(){n.find(".option_go").addClass("hidden");n.find(".option_review").removeClass("hidden")};var F=function e(t){var i;if(t.is_channel||t.is_group)i=TS.i18n.t("Archive {channel_name}","channel_options")({channel_name:o(t)});else i=TS.i18n.t("Archive <strong>this conversation</strong>","channel_options")();b(i);var n=new Handlebars.SafeString(o(t));var a={name:n};w(TS.templates.channel_option_archive(a));k(TS.i18n.t("Yes, archive the channel","channel_options")());c=function e(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();TS.api.call("channels.archive",{channel:t.id},function(e,t){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();if(e){if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}TS.ui.fs_modal.close();return}var i=TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","channel_options")();if("last_ra_channel"===t.error)if(TS.model.user.is_admin)i=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channel_options")();else i=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to.","channel_options")();else if("restricted_action"===t.error)i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>You don’t have permission to archive channels.</p><p>Talk to your Workspace Owner.</p>","channel_options")():TS.i18n.t("<p>You don’t have permission to archive channels.</p><p>Talk to your Team Owner.</p>","channel_options")();else if("already_archived"===t.error)i=TS.i18n.t("This channel was already archived.","channel_options")();else if("cant_archive_general"===t.error)i=TS.i18n.t("This channel cannot be archived.","channel_options")();setTimeout(TS.generic_dialog.alert,500,i)})};S(true,"go")};var P=function e(t){var i;if(t.is_channel||t.is_group)i=TS.i18n.t("Archive {channel_name}","channel_options")({channel_name:o(t)});else i=TS.i18n.t("Archive <strong>this conversation</strong>","channel_options")();b(i);var n=new Handlebars.SafeString(o(t));var a={name:n};w(TS.templates.channel_option_archive(a));k(TS.i18n.t("Yes, archive the channel","channel_options")());c=function e(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();TS.api.call("groups.archive",{channel:t.id},function(e,t){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();if(e){TS.ui.fs_modal.close();return}var i;if("last_ra_channel"===t.error)if(TS.model.user.is_admin)i=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channel_options")();else i=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to.","channel_options")();else if("already_archived"===t.error)i=TS.i18n.t("This channel was already archived.","channel_options")();else if("restricted_action"===t.error)i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>You don’t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channel_options")():TS.i18n.t("<p>You don’t have permission to archive private channels.</p><p>Talk to your Team Owner.</p>","channel_options")();else i=TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","channel_options")();setTimeout(TS.generic_dialog.alert,500,i)})};S(true,"go")};var O=function e(t){if(TS.boot_data.feature_disconnecting_shared_channels){var i=TS.i18n.t("Disconnect {channel_name}","channel_options")({channel_name:o(t)});b(i);var n=TS.i18n.t("Disconnect shared channel","channel_options")();if(t.is_group)n=TS.i18n.t("Disconnect shared channel","channel_options")();k(n);c=function e(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();TS.api.call("channels.disconnectShared",{channel:t.id},function(e){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();if(e){TS.ui.fs_modal.close();TS.client.activeChannelDisplayGoneAway()}})};S(true,"go")}};var R=function e(i){var n=TS.i18n.t("Delete {channel_name}","channel_options")({channel_name:o(i)});b(n);var a=new Handlebars.SafeString(o(i));var r={name:a};w(TS.templates.channel_option_delete_channel(r));k(TS.i18n.t("Delete Channel","channel_options")());A(true);C(true);t.find("#delete_channel_cb").on("change",function(){C(!this.checked)});t.find("#archive_channel_alt").on("click",function(e){e.preventDefault();A(false);C(false);F(i)});c=function e(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();TS.api.call("channels.delete",{channel:i.id},function(e,t){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();if(e){TS.ui.fs_modal.close();TS.client.activeChannelDisplayGoneAway();return}var i=TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","channel_options")();if("cant_delete_general"===t.error)i=TS.i18n.t("Sorry, you can’t delete this channel","channel_options")();else if("compliance_exports_prevent_deletion"===t.error)i=TS.i18n.t("Sorry, you can’t delete this channel because compliance exports are enabled","channel_options")();else if("not_supported"===t.error)i=TS.i18n.t("Sorry, you can’t delete external shared channels just yet","channel_options")();setTimeout(TS.generic_dialog.alert,500,i)})};S(true,"go")};var U=function e(t){var i;if(t.is_channel||t.is_group)i=TS.i18n.t("Convert {channel_name} to a private channel?","channel_options")({channel_name:o(t)});else i=TS.i18n.t("Convert <strong>this conversation</strong> to a private channel?","channel_options")();b(i);var n=new Handlebars.SafeString(o(t));if(TS.boot_data.feature_channel_options_review_stage)w(TS.templates.channel_option_convert({name:n}));else w(TS.templates.channel_conversion_dialog({name:_.escape(t.name)}));k(TS.i18n.t("Yes, convert the channel","channel_options")());c=function e(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();TS.api.call("channels.convertToGroup",{channel:t.id},function(e,t){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();if(e){TS.ui.fs_modal.close();return}var i;if("restricted_action"===t.error)i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>You don’t have permission to create private channels.</p><p>Talk to your Workspace Owner.</p>","channel_options")():TS.i18n.t("<p>You don’t have permission to create private channels.</p><p>Talk to your Team Owner.</p>","channel_options")();else if("last_ra_channel"===t.error)i=TS.i18n.t("<p>Sorry, you can’t convert this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to convert the channel.</p>","channel_options")();else if("name_taken"===t.error)i=TS.i18n.t('<p>Converting this channel failed because of a naming collision, which should never happen, but did. Please <a href="/help/requests/new">let us know</a> this happened.</p>',"channel_options")();else i=TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","channel_options")();setTimeout(TS.generic_dialog.alert,500,i)})};S(true,"go")};var Q=function e(i){var n;if(i.is_channel||i.is_group)n=TS.i18n.t("Convert {channel_name} to a shared channel?","channel_options")({channel_name:o(i)});else n=TS.i18n.t("Convert <strong>this conversation</strong> to a shared channel?","channel_options")();b(n);var a={name:_.escape(i.name),purpose:_.escape(i.purpose.value)};if(TS.boot_data.page_needs_enterprise)a.enterprise_info=TS.model.enterprise;w(TS.templates.shared_channel_conversion_dialog(a));k(TS.i18n.t("Convert to shared channel","channel_options")());c=function e(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();var n=t.find(".convert_to_shared");var a;var r=TS.ui.validation.validate(n.find('[name="channel_name"]'));if(!r){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();C(true);return}n.find('[type="radio"][name="share_with"]').each(function(e,t){if(t.checked){a=$(t);return false}});var s={channel_id:i.id};if("all"===a.val())s.all_teams=true;else{var o=$('[name="domains"]').data("TS-lazyFilterSelect").value();o=o.map(function(e){return e.team.domain}).join(",");s.target_domains=o}var l=n.find('[name="channel_name"]').val().trim();s.channel_name=l;var d=n.find('[name="purpose"]').val().trim();s.purpose=d;var c=TS.shared.getActiveModelOb();var _=c.is_group?"enterprise.groups.createShared":"enterprise.channels.createShared";TS.api.call(_,s,function(e,t){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();if(e){TS.ui.fs_modal.close();return}var i;if("restricted_action"===t.error)i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>You don’t have permission to create private channels.</p><p>Talk to your Workspace Owner.</p>","channel_options")():TS.i18n.t("<p>You don’t have permission to create private channels.</p><p>Talk to your Team Owner.</p>","channel_options")();else if("last_ra_channel"===t.error)i=TS.i18n.t("<p>Sorry, you can’t convert this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to convert the channel.</p>","channel_options")();else if("name_taken"===t.error)i=TS.i18n.t("<p>Sorry, it looks like this channel name is used elsewhere in {org_name}.</p><p>You can try changing the channel name and try again.</p>","channel_options")({org_name:TS.model.enterprise.name});else i=TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","channel_options")();setTimeout(TS.generic_dialog.alert,500,i)})};S(true,"go");W()};var L=325;var H;var N=false;var G;var j=function e(){var i=t.find(".convert_to_shared");var n=false;var a=$('[type="radio"][name="share_with"]:checked').val();if("specific"===a){var r=0===i.find('[name="domains"]').val().trim().length;if(r)n=true}if(N)n=true;return n};var W=function e(){var i=t.find(".convert_to_shared");i.on("change",'[type="radio"][name="share_with"]',function(){var e=$(this);var t=e.val();var n="specific"===t;i.find(".specific_team").toggleClass("hidden",!n);C(j())});if(TS.useReactLFS()){var n=document.getElementById("convert_to_shared_teams_picker");var a=true;var r=TS.boot_data.page_needs_enterprise?_.filter(TS.model.enterprise_teams,function(e){return e.id!==TS.model.team.id}):[];TS.ui.team_picker.make(n,{teams:r,onValueChange:function e(t){var n=t.map(function(e){return e.team.domain}).join(",");i.find('[name="domains"]').val(n)}},a)}else i.find('[name="domains"]').each(function(e,t){var i=$(t);var n=TS.boot_data.page_needs_enterprise?_.filter(TS.model.enterprise_teams,function(e){return e.id!==TS.model.team.id}):[];TS.ui.team_picker.make(i,{teams:n});i.on("change",function(){var e=TS.ui.team_picker.value(i).map(function(e){return e.team.domain}).join(",");i.val(e)})});i.on("change",'[name="domains"]',function(){C(j())});i.on("click",".current_channel_name a",function(e){e.preventDefault();i.find(".current_channel_name").addClass("hidden");i.find(".change_channel_name").removeClass("hidden")});i.on("click",".current_channel_purpose a",function(e){e.preventDefault();i.find(".current_channel_purpose").addClass("hidden");i.find(".change_channel_purpose").removeClass("hidden")});var s=i.find('[name="channel_name"]');s.on("focus",function(){$(".validation_message").remove()});s.on("input paste change blur",function(e){e.preventDefault();e.stopPropagation();$(".validation_message").remove();$('label[for="channel_name"]').removeClass("validation_warning");$(this).removeClass("validation_warning");if(H){clearTimeout(H);H=null}var t=function e(){if(G&&G.isPending()){H=setTimeout(e.bind(this),L);return}K();C(true);var t=TS.ui.validation.validate($(this));if(t){var i=$(this);var n=i.val().trim();G=TS.api.callImmediately("enterprise.nameTaken",{name:n,ignore_local_team:true},function(e,t){if(!e){K(true,false);N=true;TS.generic_dialog.alert(TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","channel_options")())}else{if(t.name_taken){K(true,false);N=true;C(true);var a=TS.i18n.t('"{new_name}" is already taken by a channel, username, or user group.',"channel_options")({new_name:_.escape(n)});TS.ui.validation.showWarning(i,a,{});return}K(true,true);N=false;C(j())}}).catch(function(){G=null;K(true,false)})}else{K(true);N=true}};H=setTimeout(t.bind(this),L)})};var K=function e(i,n){if(!i)i=false;if(!n)n=false;t.find(".input_wrapper .spinner").toggleClass("hidden",i);if(n)Y(!i)};var z;var V=1e3;var Y=function e(i){if(z){clearTimeout(z);z=null}if(!i)i=false;t.find(".input_wrapper .available").toggleClass("hidden",i);if(!i)z=setTimeout(function(){t.find(".input_wrapper .available").addClass("hidden")},V)};var q=[];var J;var Z;var X;var ee;if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels){Z=TS.i18n.t("Review Changes","channel_options")();X=TS.i18n.t("Save Changes","channel_options")();ee=TS.i18n.t("Done","channel_options")()}var te=function e(i){q=[];J=null;if(!i.is_org_shared){q=[TS.model.team.id];J=[TS.model.team.id]}if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels){b(TS.i18n.t("Manage access to {channel_name}","channel_options")({channel_name:o(i)}));var n=TS.i18n.t("Fetching channel settings","channel_options")();w(TS.templates.channel_option_manage_teams({loading_text:n}));I(Z);k(X);u=function e(){y(TS.templates.channel_option_review({description:"MANAGE TEAMS"}));T()};c=function e(){var n={channel_id:i.id};if(!i.is_org_shared)if(1===q.length&&q[0]===TS.model.team.id)TS.ui.fs_modal.close();else ie(i.name).then(function(e){if(e);});else{var a=t.find('[type="radio"][name="share_with"]:checked').val();var r="specific"===a;if(r){var s;if(TS.useReactLFS())s=q;else s=TS.ui.team_picker.value(t.find('[name="domains"]'));s=s.map(function(e){return e.team.id});n.team_ids=s.join(",");n.all_teams=false}else n.all_teams=true;TS.api.callImmediately("enterprise.channels.setShared",n).then(function(e){if(e.data.ok)TS.ui.fs_modal.close()})}};S(false);if(i.is_org_shared)TS.api.callImmediately("enterprise.channels.getOriginatingTeam",{channel_id:i.id}).then(function(e){J=e.data.team.id;w(TS.templates.channel_option_manage_teams({hide_loading_overlay:true,model_ob:i}));S(true,"review");ne(i)});else{J=TS.model.team.id;w(TS.templates.channel_option_manage_teams({hide_loading_overlay:true,model_ob:i}));k(ee);S(true,"go");ne(i)}}};var ie=function e(t){return TS.api.callImmediately("enterprise.nameTaken",{name:t,ignore_local_team:true}).then(function(e){if(!e.data.ok)return false;return!e.data.name_taken})};var ne=function e(i){var n;t.on("change",'[type="radio"][name="share_with"]',function(){var e=$(this);var i=e.val();var a="specific"===i;t.find(".specific_team").toggleClass("hidden",!a);var r=false;if(a)if(TS.useReactLFS())r=0===q.length;else r=!(t.find('[name="domains"]').val().trim().length>0);if(a)if(_.isEqual(q,n)){k(ee);B()}else{k(X);D()}else{k(X);D()}M(r)});if(TS.useReactLFS()){var a=TS.model.enterprise_teams;if(i.is_global_shared)n=_(TS.model.enterprise_teams).map("id").value();else if(i.is_org_shared)n=i.shared_team_ids;else n=[TS.model.team.id];var r=document.getElementById("manage_teams_team_picker");var s=true;TS.ui.team_picker.make(r,{teams:a,preselected_ids:n,disabled_ids:J?[J]:[],onValueChange:function e(t){q=t;M(!(t.length>0));if(_.isEqual(n,t)){k(ee);B()}else{k(X);D()}}},s)}else t.find('[name="domains"]').each(function(e,t){var a=$(t);var r=TS.model.enterprise_teams;if(i.is_global_shared)n=_(TS.model.enterprise_teams).map("id").value();else if(i.is_org_shared)n=i.shared_team_ids;else n=[TS.model.team.id];TS.ui.team_picker.make(a,{teams:r,preselected_ids:n,disabled_ids:J?[J]:[]});a.on("change",function(){var e=TS.ui.team_picker.value(a).map(function(e){return e.team.domain});q=e;a.val(e.join(","));if(_.isEqual(n,e)){k(ee);B()}else{k(X);D()}})});if(!TS.useReactLFS())t.on("change",'[name="domains"]',function(){var e=$(this);var t=e.val().trim();M(0===t.length)})};var ae=function e(i){if(TS.model.user.is_restricted)return;b(TS.i18n.t("Rename this channel","channel_options")());var n;if(_.isObject(TS.ui.channel_options_dialog.params))n=TS.ui.channel_options_dialog.params.name;if(!n)n=i.name||"";var a=TS.utility.cleanChannelName(n);w(TS.templates.channel_option_rename_channel({title:a}));var r=TS.i18n.t("Rename channel","channel_options")();if(i.is_group)r=TS.i18n.t("Rename private channel","channel_options")();k(r);var s;var o;c=function e(){s=t.find(".title_input").val().trim();o=i.is_channel?"channels.rename":"groups.rename";if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();if(s===i.name){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();TS.ui.fs_modal.close();return}TS.api.call(o,{name:s,channel:i.id,validate:true}).then(function(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();TS.ui.fs_modal.close()}).catch(function(e){var t=e.data.error;var i=TS.ui.validation.getErrorMessage(t,{maxlength:22,name:s});if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();return TS.ui.validation.showWarning(TS.ui.channel_options_dialog.div.find(".title_input"),i,{custom_for:"channel_create_title"})})};S(true,"go")};var re=function e(i){b(TS.i18n.t("Set channel purpose","channel_options")());w(TS.templates.channel_option_purpose({model_ob:i,is_group:i.is_group}));if(TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()){var n=t.find("#purpose_input");TS.utility.contenteditable.create(n,{modules:{tabcomplete:{positionMenu:function e(t){t.style.width=n.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,n)},searchOptions:{complete_member_specials:false},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members]}},onEnter:function e(t){if(t.shiftKey)return true;m();return false},onEscape:function e(){return false},onTextChange:function e(){TS.client.channel_page.updatePurposeTooLongWarning(n)}});TS.utility.contenteditable.enable(n);TS.utility.contenteditable.value(n,TS.utility.unformatTopicOrPurpose(i.purpose.value))}k(TS.i18n.t("Update purpose","channel_options")());var a;var r;c=function e(){a=t.find("#purpose_input");r=_.trim(TS.utility.contenteditable.value(a));if(TS.client.channel_page.isPurposeTooLong(a))return;if(i.is_group)TS.groups.setPurpose(i.id,r);else TS.channels.setPurpose(i.id,r);TS.ui.fs_modal.close()};S(true,"go")};var se=function e(t){if(!TS.permissions.members.canExportMessageHistory(t))return;var i;if(t.is_mpim)i=TS.i18n.t("Export message history for <strong>this conversation</strong>","channel_options")();else i=TS.i18n.t("Export message history for {channel_name}","channel_options")({channel_name:o(t)});b(i);w(TS.templates.channel_option_export_history());k(TS.i18n.t("Export","channel_options")());c=function e(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();var i="channels.export";if(t.is_group)i="groups.export";else if(t.is_im)i="im.export";TS.api.call(i,{channel:t.id}).then(function(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();TS.ui.fs_modal.close()})};S(true,"go")};var oe="1.";var le="0.";var de={};var ce={count:100,include_dangling:1,items:[]};var _e=false;var ue;var me;var fe={user:[],subteam:[]};var he=function e(){var i=t.find("[name=who_can_post]:checked");var n=i.val();var a="";var r="";var s="";if(TS.boot_data.feature_channel_options_review_stage){if("ra"===n)a=new Handlebars.SafeString(TS.i18n.t("<strong>Everyone</strong> will be able to post in this channel.","channel_options")());else if("regular"===n)a=new Handlebars.SafeString(TS.i18n.t("<strong>Everyone except guests</strong> will be able to post in this channel.","channel_options")());else if("admin"===n)a=TS.boot_data.feature_teams_to_workspaces?new Handlebars.SafeString(TS.i18n.t("<strong>Only Org Admins and Owners, and Workspace Admins and Owners</strong> will be able to post in this channel.","channel_options")()):new Handlebars.SafeString(TS.i18n.t("<strong>Only Org Admins and Owners, and Team Admins and Owners</strong> will be able to post in this channel.","channel_options")());else if("multi"===n)a=TS.boot_data.feature_teams_to_workspaces?new Handlebars.SafeString(TS.i18n.t("<strong>Org Admins and Owners, and Workspace Admins and Owners</strong> will be able to post in this channel.","channel_options")()):new Handlebars.SafeString(TS.i18n.t("<strong>Org Admins and Owners, and Team Admins and Owners</strong> will be able to post in this channel.","channel_options")());if(TS.boot_data.feature_default_shared_channels){var o=t.find("[name=can_thread]").is(":checked");if(o)r=new Handlebars.SafeString(TS.i18n.t("Additionally, <strong>anyone in this channel</strong> will be able to add threaded replies to messages in this channel.","channel_options")())}s=TS.i18n.t("Please note that these changes may take some time to complete.","channel_options")()}return{description:a,additional_copy:r,note:s}};var ge=function e(i,n){var a;var r=t.find(i+":checked").val();var s=[];if("multi"===r){s=t.find(n).lazyFilterSelect("value");if(s.length)r="owner";else r="admin"}a="type:"+r;if(s.length)s.forEach(function(e){if(e.member)a+=",user:"+e.member.id;else if(e.user_group)a+=",subteam:"+e.user_group.id});return a};var pe=function e(i){var n="";var a=t.find(i).is(":checked");if(a)n="type:all";return n};var Se=function e(t){var i=_.merge({},t);if(!i.type)i.type=["ra"];if(i.type&&"owner"===i.type[0])if(i.user&&i.user.length||i.subteam&&i.subteam.length)i.type[0]="multi";else i.type[0]="admin";if(TS.boot_data.feature_default_shared_channels){var n=TS.shared.getModelObById(TS.ui.channel_options_dialog.c_id);if(n.is_org_default&&("ra"===i.type[0]||"regular"===i.type[0]))i.type=["admin"]}return i};var Te=function e(t){var i=_.merge({},t);if(_.isUndefined(i.type))return false;return"all"===i.type[0]};var ve=function e(t,i){if("@"===t.charAt(0))t=t.substring(1);var n=[be(de,fe,t,i),we(ce,fe,t,i)];return Promise.all(n).then(function(e){var t={_replace_all_items:true,items:[]};var i=e[0];var n=e[1];if(n._items.length)t.items.push({label:TS.i18n.t("User Groups","channel_options")(),children:n._items});if(i.items.length)t.items.push({label:TS.i18n.t("Members","channel_options")(),children:i.items});return t})};var be=function e(t,i,n){if(t.query!==n)t=_.merge(t,{query:n,include_org:TS.boot_data.page_needs_enterprise,include_slackbot:false,include_self:true,full_profile_filter:true,include_bots:false,all_of_org:true,org_team_ids:[]});return Promise.resolve(t).then(function(e){var t=i.user||[];return TS.members.ensureMembersArePresent(t).then(function(){return TS.members.promiseToSearchMembers(e).then(function(e){var i=[];if(""===e.query)i=TS.members.getMembersForUser();else i=e.items;e.items=i.map(function(e){if(e.member&&"undefined"!==typeof e.preselected)return e;return{member:e,lfs_id:oe+e.id,preselected:t&&t.indexOf(e.id)>-1}});return e})})})};var we=function e(t,i,n){if(t._query!==n){t._query=n;t.include_enterprise=true}var a=[{type:"is",value:"group"},{type:"is",value:"group_local"}];var r=n.split(" ");r.forEach(function(e){if(""===e)return;a.push({type:"fuzzy",value:e})});t.query=JSON.stringify({type:"and",clauses:a});var s=i.subteam||[];return TS.user_groups.ensureUserGroupsArePresent(s).then(function(){return TS.api.callImmediately("search.enterprise",t).then(function(e){t.num_new=e.data.items.length||0;if(!e.data.items.length)return Promise.resolve({_items:[]});var i=[];if(""===t._query)i=TS.user_groups.getActiveUserGroups(true)||[];i=_(i).concat(e.data.items).uniqBy(function(e){return e.id}).map(function(e){if(e.user_group&&"undefined"!==typeof e.preselected)return e;return{user_group:e,lfs_id:le+e.id,preselected:s&&s.indexOf(e.id)>-1}}).value();t._items=i;TS.user_groups.startBatchUpsert();e.data.items.forEach(function(e){TS.user_groups.upsertUserGroup(e)});TS.user_groups.finishBatchUpsert();return t})})};var ye={placeholder_text:TS.i18n.t("Search","channel_options")(),approx_item_height:38,template:function e(t){var i="";if(t.member)i=TS.templates.enterprise_member_profile_name({member:t.member});else if(t.user_group)i=TS.templates.enterprise_member_profile_name({user_group:t.user_group});return new Handlebars.SafeString(i)},tokenTemplate:function e(t){var i="";if(t.member)i=TS.templates.enterprise_member_token_sc({member:t.member});else if(t.user_group)i=TS.templates.enterprise_member_profile_name({user_group:t.user_group});return new Handlebars.SafeString(i)},tokenClass:function e(t){if(t.member)return"lfs_token lfs_token_members";else if(t.user_group)return"lfs_token lfs_token_user_groups";return"lfs_token"},noResultsTemplate:function e(t){if(!t)return TS.i18n.t("No match found","channel_options")();return TS.i18n.t("No match found for <strong>{query}</strong>","channel_options")({query:_.escape(t)})}};var ke=_.assign({},ye,{data_promise:ve,onItemAdded:function e(t){if(t.member){fe.user.push(t.member.id);fe.user=_.uniq(fe.user)}else if(t.user_group){fe.subteam.push(t.user_group.id);fe.subteam=_.uniq(fe.subteam)}C(!fe.user.length&&!fe.subteam.length)},onItemRemoved:function e(t){if(t.member)fe.user=fe.user.filter(function(e){return e!==t.member.id});else if(t.user_group)fe.subteam=fe.subteam.filter(function(e){return e!==t.user_group.id});C(!fe.user.length&&!fe.subteam.length)}});var Ae=function e(){var i=t.find("[name=who_can_post]:checked").val();if(!_e&&"multi"===i){t.find("#lfs_channel_posting").hide().lazyFilterSelect(ke);_e=true}};var Ce=function e(t){ue=null;fe={subteam:[],user:[]};_e=false;var i;if(t.is_channel||t.is_group)if(TS.boot_data.feature_channel_options_review_stage)i=TS.i18n.t("Manage posting permissions for {channel_name}","channel_options")({channel_name:o(t)});else i=TS.i18n.t("Manage posting privileges for {channel_name}","channel_options")({channel_name:o(t)});else if(TS.boot_data.feature_channel_options_review_stage)i=TS.i18n.t("Manage posting permissions for <strong>this conversation</strong>","channel_options")();else i=TS.i18n.t("Manage posting privileges for <strong>this conversation</strong>","channel_options")();b(i);var n=TS.i18n.t("Fetching channel settings","channel_options")();w(TS.templates.channel_options_posting_privileges({loading_text:n}));if(TS.boot_data.feature_channel_options_review_stage)I(TS.i18n.t("Review","channel_options")());if(TS.boot_data.feature_channel_options_review_stage)k(TS.i18n.t("Set posting permissions","channel_options")());else k(TS.i18n.t("Save Changes","channel_options")());u=function e(){y(TS.templates.channel_option_review(he()));T()};c=function e(){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();var i=ge("[name=who_can_post]","#lfs_channel_posting");var n={who_can_post:i};if(TS.boot_data.feature_default_shared_channels){var a=pe("[name=can_thread]");n.can_thread=a}var r={prefs:JSON.stringify(n),channel_id:t.id};TS.api.callImmediately("channels.prefs.set",r,function(e,t){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();if(!e){var i=TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","channel_options")();TS.generic_dialog.alert(i);TS.error("Failed with error: "+t.error);return}TS.ui.fs_modal.close()})};S();x();var a=[TS.api.callImmediately("channels.prefs.get",{pref_name:"who_can_post",channel_id:t.id})];if(TS.boot_data.feature_default_shared_channels)a.push(TS.api.callImmediately("channels.prefs.get",{pref_name:"can_thread",channel_id:t.id}));Promise.all(a).then(function(e){ue=e[0].data.pref_value;if(ue.user)fe.user=ue.user;if(ue.subteam)fe.subteam=ue.subteam;var i={who_can_post:Se(ue),hide_loading_overlay:true};if(TS.boot_data.feature_default_shared_channels){i.channel_is_org_default=t.is_org_default||false;me=e[1].data.pref_value;i.can_thread=Te(me)}else i.channel_is_org_default=false;w(TS.templates.channel_options_posting_privileges(i));Me();Ae();E();if(TS.boot_data.feature_channel_options_review_stage)D();else B()})};var Me=function e(){t.find("[name=who_can_post]").on("change",function(){var e=$(this).val();t.find(".lfs_channel_posting_selector").toggleClass("hidden","multi"!==e);if("multi"===e){C(true);Ae()}else C(false)})};var Ie=function e(i){var n;if((i.is_channel||i.is_group)&&!i.is_mpim)n=TS.i18n.t("Edit retention policy for {channel_name}","channel_options")({channel_name:o(i)});else n=TS.i18n.t("Edit retention policy for <strong>this conversation</strong>","channel_options")();b(n);var a=xe();w(a);if(TS.boot_data.feature_channel_options_review_stage){I(TS.i18n.t("Review","channel_options")());k(TS.i18n.t("Set Policy","channel_options")())}else k(TS.i18n.t("Save Settings","channel_options")());x();var r;var s;u=function e(){r=t.find('select[name="retention_type"]').val();s=t.find("#retention_duration").val();if(null===r||null===s)return;var n;if("1"===s)n=TS.i18n.t("Retain all messages for {duration, plural, =1 {{duration} day} other {{duration} days}}","channel_options")({duration:s});else{var a;var l;if(i.is_private||i.is_group){a=TS.model.team.prefs.group_retention_type;l=TS.model.team.prefs.group_retention_duration}else{a=TS.model.team.prefs.retention_type;l=TS.model.team.prefs.retention_duration}switch(parseInt(a,10)){case 1:n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Use workspace preference, which is to keep all messages and keep edit and deletion logs.","channel_options")():TS.i18n.t("Use team preference, which is to keep all messages and keep edit and deletion logs.","channel_options")();break;case 2:n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Use workspace preference, which is to keep messages and logs, but only for {duration, plural, =1 {{duration} day} other {{duration} days}}.","channel_options")({duration:l}):TS.i18n.t("Use team preference, which is to keep messages and logs, but only for {duration, plural, =1 {{duration} day} other {{duration} days}}.","channel_options")({duration:l});break;default:n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Use workspace preference, which is to keep all messages.","channel_options")():TS.i18n.t("Use team preference, which is to keep all messages.","channel_options")()}}if(TS.boot_data.feature_channel_options_review_stage)y(TS.templates.channel_option_review({description:new Handlebars.SafeString(TS.i18n.t("You’ve selected the following retention policy for {channel_name}:","channel_options")({channel_name:o(i)})),additional_copy:n}));T()};c=function e(){if(null===r||null===s)return;if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.start();function n(e,n){if(TS.ui.channel_options_dialog.ladda)TS.ui.channel_options_dialog.ladda.stop();if(!e){TS.error("failed onDataRetentionChanged");if("invalid_duration"===n.error)t.find(".invalid_duration_error").removeClass("hidden");else TS.generic_dialog.alert(TS.i18n.t('<p class="no_bottom_margin">Oops! Something went wrong. Please try again.</p>',"channel_options")());return}var a="";if(i.is_im)a=TS.i18n.t("Message retention settings updated for your direct messages with @{username}.","channel_options")({username:i.name});else if(i.is_mpim)a=TS.i18n.t("Message retention settings updated for your direct messages with {display_name}.","channel_options")({display_name:i._display_name});else a=TS.i18n.t("Message retention settings updated for #{channel_name}.","channel_options")({channel_name:i.name});TS.ui.channel_options_dialog.addTempEphemeralFeedback(a);TS.ui.fs_modal.close()}if(i.is_channel)TS.channels.setDataRetention(i.id,r,s,n);else if(i.is_mpim)TS.mpims.setDataRetention(i.id,r,s,n);else if(i.is_im)TS.ims.setDataRetention(i.id,r,s,n);else TS.groups.setDataRetention(i.id,r,s,n)};S();if(TS.boot_data.feature_channel_options_review_stage)D();else B();if(i.is_channel)TS.channels.getDataRetention(i.id,Ee);else if(i.is_im)TS.ims.getDataRetention(i.id,Be);else if(i.is_mpim)TS.mpims.getDataRetention(i.id,Be);else TS.groups.getDataRetention(i.id,$e)};var xe=function e(){var t=cdn_url+"/9c217/img/loading_hash_animation_@2x.gif";var i=TS.i18n.t("loading...","channel_options")();return'<div class="loading_hash_animation large_margin"><img src="'+t+'" alt="Loading" /><br />'+i+"</div>"};var Ee=function e(t,i){if(t)De("channel",i.retention.retention_type,i.retention.retention_duration);else Fe("channel",i)};var $e=function e(t,i){if(t)De("group",i.retention.retention_type,i.retention.retention_duration);else Fe("group",i)};var Be=function e(t,i){if(t)De("conversation",i.retention.retention_type,i.retention.retention_duration);else Fe("conversation",i)};var De=function e(i,n,a){var r=TS.model.team.prefs.retention_type;var s=TS.model.team.prefs.retention_duration;if("group"===i){r=TS.model.team.prefs.group_retention_type;s=TS.model.team.prefs.group_retention_duration;i="channel"}else if("conversation"===i){r=TS.model.team.prefs.dm_retention_type;s=TS.model.team.prefs.dm_retention_duration}var o=TS.templates.channel_data_retention_dialog({model_type:i,retention_type:n,retention_duration:a,team_type:r,team_duration:s});w(o);t.find('select[name="retention_type"]').change(function(){t.find(".invalid_duration_error").addClass("hidden");if(1!==parseInt(this.value,10)){t.find("#team_retention_pref").removeClass("hidden");t.find("#retention_duration_container, #retention_duration_warning").addClass("hidden")}else{t.find("#team_retention_pref").addClass("hidden");t.find("#retention_duration_container, #retention_duration_warning").removeClass("hidden");var e=t.find("#retention_duration");if(0===e.val())e.val("");e.focus()}}).change();t.find("#retention_duration").change(function(){t.find(".invalid_duration_error").addClass("hidden")}).change();E();if(TS.boot_data.feature_channel_options_review_stage)D();else B()};var Fe=function e(t,i){var n;if("no_perms"===i.error||"is_archived"===i.error||"not_paid"===i.error){if("group"===t)t="channel";n='<p class="no_bottom_margin">'+TS.i18n.t("Sorry! You can’t change the retention duration for this {type, select, channel {channel} group {private channel} other {conversation}}.","channel_options")({type:t});n+="</p>"}else n='<p class="no_bottom_margin">'+TS.i18n.t("Oops! Something went wrong. Please try again.","channel_options")()+"</p>";w(n)}})()},4396:function(e,t){(function(){"use strict";TS.registerModule("ui.share_channel_dialog",{start:function e(t){l=!_.get(t,"model_ob");o=_.throttle(p,1e3);if(l)c(t);else u(t)},showApproveRequestDialog:function e(t){var i={invite:[t.invite_id]};TS.api.call("channels.sharedInviteInfo",i,function(e,t){if(e){var i={inviter:t.invite.user,team:t.invite.team,channel_name:t.invite.channel_name,custom_message:t.invite.custom_message};d.invite_id=t.invite.id;d.channel_id=t.invite.channel;var n=TS.templates.channel_share_dialog_request(i);TS.ui.fs_modal.start({body_template_html:n,onShow:y})}})},test:function e(){var t={_generateTemplateArgs:A,_handleSubmitCreate:m,_handleSuccess:h,_handleError:g,_validateShare:S,_generateAttachment:k,$_modal_content:n,_ladda:s,_is_new_channel:l,$_buttons:r};Object.defineProperty(t,"_generateTemplateArgs",{get:function e(){return A},set:function e(t){A=t}});Object.defineProperty(t,"_handleSubmitCreate",{get:function e(){return m},set:function e(t){m=t}});Object.defineProperty(t,"_handleSuccess",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(t,"_handleError",{get:function e(){return g},set:function e(t){g=t}});Object.defineProperty(t,"_validateShare",{get:function e(){return S},set:function e(t){S=t}});Object.defineProperty(t,"_generateAttachment",{get:function e(){return k},set:function e(t){k=t}});Object.defineProperty(t,"_ladda",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(t,"$_modal_content",{get:function e(){return n},set:function e(t){n=t}});Object.defineProperty(t,"_is_new_channel",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(t,"$_buttons",{get:function e(){return r},set:function e(t){r=t}});return t}});var e;var t;var i;var n;var a={};var r={};var s;var o;var l;var d={};var c=function e(t){var i=A(t);var o=TS.templates.channel_share_dialog(i);TS.ui.fs_modal.start({body_template_html:o,onShow:function e(){n=$(".share_channel_modal_contents");a.channel_name=n.find("#channel_create_title");a.email_address=n.find("#email_address");a.team_url=n.find("#team_url");a.custom_message=n.find("#custom_message");r.cancel=n.find(".cancel_share");r.submit=n.find(".submit");s=Ladda.create(r.submit[0]);w()},onShowComplete:function e(){a.channel_name.focus().val(a.channel_name.val())}})};var u=function e(t){var i=A(t);var a=TS.templates.channel_share_dialog(i);var o=TS.templates.channel_share_dialog_go_label(i);var l=TS.templates.channel_share_dialog_heading(i);var d=true;TS.ui.channel_options_dialog.startWithChannelOption(a,l,o,_.noop,d);n=TS.ui.channel_options_dialog.div;r.cancel=n.find(".cancel_share");r.submit=n.find(".submit");s=Ladda.create(r.submit[0]);if(TS.permissions.members.canCreateSharedChannel())T();else v()};var m=function e(t){s.start();n.find(".error").remove();var i={target_domain:t.target_domain,email:t.email};if(t.custom_message)i.custom_message=t.custom_message;if(t.model_ob)i.channel=t.model_ob.id;else if(t.channel_name)i.channel_name=t.channel_name;return S(i).then(function(){return TS.api.call("channels.inviteShared",i)}).then(h,g)};var f=function e(){s.start();var t={invite_id:d.invite_id};var i=a.channel_name.val().trim();if(i)t.channel_name=i;var n=a.invite_people.lazyFilterSelect("value");n=_.map(n,"member.id");return TS.api.call("channels.acceptSharedInvite",t).then(function(e){TS.ui.fs_modal.close();TS.channels.displayChannel({id:e.data.channel.id});if(n.length)TS.api.call("channels.invite",{channel:e.data.channel.id,users:n.join(",")})}).then(null,g)};var h=function e(t){if(l){TS.ui.fs_modal.close();TS.channels.displayChannel({id:t.data.channel})}else{var i=TS.templates.channel_share_dialog_content();var a=TS.templates.channel_share_dialog_heading({email:"fake@acme-corp.com"});var r=TS.templates.channel_share_dialog_go_label({email:true});TS.ui.channel_options_dialog.startWithChannelOption(i,a,r,TS.ui.fs_modal.close);n.find(".option_cancel").addClass("hidden");s.stop();TS.ui.fs_modal.hideBackButton();TS.log("shared_channels_connection",t)}};var g=function e(t){if(!t.ok){s.stop();n.find(".information").after(TS.templates.channel_share_dialog_error({is_generic_error:true,response:t.data}))}TS.log("shared_channels_connection",t.data)};var p=function n(){if(l)if(!_.isEmpty(a.channel_name.val())&&!_.isEmpty(a.email_address.val())&&!_.isEmpty(a.team_url.val()))r.submit.removeAttr("disabled");else r.submit.attr("disabled","disabled");else{if(i.lazyFilterSelect("value").length>0&&!TS.utility.contenteditable.isEmpty(e)){t.html(k(TS.utility.contenteditable.value(e)));s.enable();return}if(t.children().length>0)t.empty();s.disable()}};var S=function e(t){return TS.api.call("api.test",{channel:t.model_ob?t.model_ob.id:t.channel_name,target_domain:t.target_domain,email:t.email,custom_message:t.custom_message})};var T=function e(){r.cancel.click(TS.ui.channel_options_dialog.showAllOptions);r.submit.click(function(){m({model_ob:TS.shared.getActiveModelOb(),target_domain:n.find("#team_url").val(),email:n.find("#email_address").val(),custom_message:n.find("#custom_message").val()})})};var v=function e(){if(!TS.boot_data.feature_shared_channels_client)return;TS.ui.im_browser.start({is_admin_only_mode:true,title:TS.i18n.t("Find a Team Admin to help","shared_channels")(),subtitle:TS.i18n.t("Only Team Admins are able to create new shared channels and send invitations to other teams. If you’d like to share a channel with another team, you’ll need to ask an admin from the list below for help.","shared_channels")(),submit_callback:b})};var b=function e(){if(!TS.boot_data.feature_shared_channels_client)return;TS.client.ui.addEphemeralBotMsg({text:TS.i18n.t("Things your admin will need:\n• A quick explanation of who you’re hoping to share the channel with, and why\n• The email address of the person on the other team who you wish to send the invitation to\n• The Slack URL of the other team. Your admin will need this to send the invitation as well.","shared_channels")()})};var w=function e(){a.privacy=$(".share_channel_modal_contents #channel_public_private_toggle");a.privacy.togglify();a.privacy.bind("change",function(){if(a.privacy.is(":checked")){n.find(".private_channel_item").addClass("hidden");n.find(".public_channel_item").removeClass("hidden")}else{n.find(".public_channel_item").addClass("hidden");n.find(".private_channel_item").removeClass("hidden")}}).trigger("change");n.find("input").on("keyup",o);r.cancel.click(function(){TS.ui.new_channel_modal.startInContainer(n)});r.submit.click(function(){m({channel_name:a.channel_name.val(),target_domain:a.team_url.val(),email:a.email_address.val(),custom_message:a.custom_message.val()})})};var y=function e(){n=$(".share_channel_modal_contents");a.privacy=$("#channel_public_private_toggle");a.channel_name=$("#channel_create_title");a.invite_people=$("#invite_members_container");r.cancel=n.find('[data-action="cancel"]');r.submit=n.find('[data-action="submit"]');a.privacy.togglify();s=Ladda.create(r.submit[0]);a.privacy.bind("change",function(){if(a.privacy.is(":checked")){n.find(".private_channel_item").addClass("hidden");n.find(".public_channel_item").removeClass("hidden")}else{n.find(".public_channel_item").addClass("hidden");n.find(".private_channel_item").removeClass("hidden")}}).trigger("change");var t=TS.boot_data.feature_shared_channels_client?TS.i18n.t("Find people...","share_channels")():null;TS.ui.people_picker.make($("#invite_members_container"),{include_self:false,include_slackbot:false,include_bots:false,only_local_team:true,placeholder_text:t});r.cancel.click(function(){d={};TS.ui.fs_modal.close()});r.submit.click(f)};var k=function e(t){var i={type:"message",ts:TS.interop.datetime.makeTsStamp(),user:TS.model.user.id,text:TS.format.cleanMsg(t)};return TS.templates.builders.formatMessageAsAttachment(i)};var A=function e(t){return{model_ob:t?t.model_ob:null,can_create_shared_channel:TS.permissions.members.canCreateSharedChannel(),show_heading:l,title:t?t.title:null,is_new_channel:l,is_private:t?t.is_private:null,channel_name:t&&t.model_ob?TS.templates.builders.makeChannelPrefix(t.model_ob)+_.escape(t.model_ob.name):null,inviter:TS.model.user,team:TS.model.team}}})()},4397:function(e,t){(function(){"use strict";TS.registerModule("ui.channel_manage_teams_dialog",{div:null,c_id:null,ladda:null,teams_to_share_with:[],start:function t(i){TS.ui.channel_manage_teams_dialog.c_id=i;e()},addTempEphemeralFeedback:function e(t){TS.client.ui.addOrFlashEphemeralBotMsg({text:t})}});var e=function e(){var n=TS.shared.getModelObById(TS.ui.channel_manage_teams_dialog.c_id);if(!n||n.is_im){TS.log(1337,"No model_ob found for channel id :"+TS.ui.channel_manage_teams_dialog.c_id);var a=TS.i18n.t("Oops! No channel found???","channel_manage_teams")();TS.generic_dialog.alert('<p class="no_bottom_margin">'+a+"</p>");return}var r=n.is_channel?"channel":"group";var s={c_or_g:r,model_ob:n};var o={body_template_html:TS.templates.channel_manage_teams_dialog(s),onShow:t,onCancel:i,modal_class:"channel_manage_teams_modal"};TS.ui.fs_modal.start(o)};var t=function e(){TS.ui.channel_manage_teams_dialog.div=$(".channel_manage_teams_modal");var t=TS.shared.getModelObById(TS.ui.channel_manage_teams_dialog.c_id);TS.ui.channel_manage_teams_dialog.div.find(".dialog_cancel").on("click",n);TS.ui.channel_manage_teams_dialog.div.find(".dialog_go").on("click",a);TS.ui.channel_manage_teams_dialog.div.on("change",'[type="radio"][name="share_with"]',function(){var e=$(this);var t=e.val();var i="specific"===t;TS.ui.channel_manage_teams_dialog.div.find(".specific_team").toggleClass("hidden",!i);var n=false;if(i)if(TS.useReactLFS())n=0===TS.ui.channel_manage_teams_dialog.teams_to_share_with.length;else n=!(TS.ui.channel_manage_teams_dialog.div.find('[name="domains"]').val().trim().length>0);r(n)});if(TS.useReactLFS()){var i=_.filter(TS.model.enterprise_teams,function(e){return e.id!==TS.model.team.id});var s;if(t.is_global_shared)s=_(TS.model.enterprise_teams).map("id").filter(function(e){return e!==TS.model.team.id}).value();else s=t.shared_team_ids.filter(function(e){return e!==TS.model.team.id});var o=document.getElementById("manage_teams_team_picker");var l=true;TS.ui.team_picker.make(o,{teams:i,preselected_ids:s,restrict_preselected_item_removal:true,disabled_ids:s,onValueChange:function e(t){TS.ui.channel_manage_teams_dialog.teams_to_share_with=t;r(!(t.length>0))}},l)}else TS.ui.channel_manage_teams_dialog.div.find('[name="domains"]').each(function(e,i){var n=$(i);var a=_.filter(TS.model.enterprise_teams,function(e){return e.id!==TS.model.team.id});var r;if(t.is_global_shared)r=_(TS.model.enterprise_teams).map("id").filter(function(e){return e!==TS.model.team.id}).value();else r=t.shared_team_ids.filter(function(e){return e!==TS.model.team.id});TS.ui.team_picker.make(n,{teams:a,preselected_ids:r,restrict_preselected_item_removal:true,disabled_ids:r});n.on("change",function(){var e=TS.ui.team_picker.value(n).map(function(e){return e.team.domain}).join(",");n.val(e)})});if(!TS.useReactLFS())TS.ui.channel_manage_teams_dialog.div.on("change",'[name="domains"]',function(){var e=$(this);var t=e.val().trim();r(0===t.length)})};var i=function e(){};var n=function e(){TS.ui.fs_modal.close()};var a=function e(){var t=TS.shared.getModelObById(TS.ui.channel_manage_teams_dialog.c_id);var i=true;var n={channel_id:t.id};var a=TS.ui.channel_manage_teams_dialog.div.find('[type="radio"][name="share_with"]:checked').val();var r="specific"===a;if(r){var s;if(TS.useReactLFS())s=TS.ui.channel_manage_teams_dialog.teams_to_share_with;else s=TS.ui.team_picker.value(TS.ui.channel_manage_teams_dialog.div.find('[name="domains"]'));s=s.filter(function(e){return false===e.preselected}).map(function(e){return e.team.id});if(0===s.length)i=false;n.team_ids=s.join(",")}else n.all_teams=true;if(i)TS.api.callImmediately("enterprise.channels.addToShared",n).then(function(){TS.ui.fs_modal.close()});else TS.ui.fs_modal.close();return false};var r=function e(t){if(!t)t=false;TS.ui.channel_manage_teams_dialog.div.find(".dialog_go").toggleClass("disabled",t)}})()},4398:function(e,t){(function(){"use strict";TS.registerModule("ui.at_channel_warning_dialog",{$div:null,showing:false,onKeydown:function e(t){if(!TS.ui.at_channel_warning_dialog.showing)return;switch(t.which){case TS.utility.keymap.esc:TS.ui.at_channel_warning_dialog.cancel();break;case TS.utility.keymap.enter:t.preventDefault();TS.ui.at_channel_warning_dialog.go()}},start:function n(a,r,s,o,l,d){if(!TS.ui.at_channel_warning_dialog.$div)TS.ui.at_channel_warning_dialog.build();if(TS.ui.at_channel_warning_dialog.showing)return;var c=TS.ui.at_channel_warning_dialog.$div;e=l;t=a;var _=TS.format.cleanMsg(r);var u="";if(TS.model.everyone_regex.test(_))u=TS.templates.builders.atLabel("everyone");else if(TS.model.channel_regex.test(_))u=TS.templates.builders.atLabel("channel");else if(TS.model.group_regex.test(_))u=TS.templates.builders.atLabel("group");if(s<i){TS.ui.at_channel_warning_dialog.go();return}var m=TS.templates.at_channel_warning_dialog({keyword:u,member_count:s,timezone_count:o});c.html(m);if(d)c.addClass("fullsize");else c.removeClass("fullsize");c.modal("show");TS.ui.a11y.saveCurrentFocusAndFocusOnElement(c);c.find(".dialog_cancel").click(TS.ui.at_channel_warning_dialog.cancel);c.find(".dialog_go").click(TS.ui.at_channel_warning_dialog.go);$(window).bind("resize",TS.ui.at_channel_warning_dialog.position);TS.ui.at_channel_warning_dialog.position();TS.prefs.setPrefByAPI({name:"last_seen_at_channel_warning",value:Date.now()})},startInMessagePane:function e(t,i,a){var r=TS.shared.getModelObById(t);if(!r||r.is_im)return;var s=n(r);var o=function e(){TS.view.clearMessageInput();TS.shared.sendMsg(t,i,a)};var l=TS.client.ui.$msg_input;var d=true;TS.client.msg_input.populate(i);s.then(function(e){TS.ui.at_channel_warning_dialog.start(l,i,e.member_count,e.timezone_count,o,d)})},startInFlexPane:function e(t,i,a){if(!t){TS.error("no file to warn about!");return}var r=function e(){var t=true;TS.client.ui.files.submitFileComment(t)};var s=$("#file_comment_form #file_comment");var o=false;var l=n(t);l.then(function(e){TS.ui.at_channel_warning_dialog.start(s,a,e.member_count,e.timezone_count,r,o)})},position:function e(){var i=TS.ui.at_channel_warning_dialog.$div;var n=t.offset();i.css({top:n.top-i.height()-8,left:n.left})},go:function t(){TS.ui.at_channel_warning_dialog.$div.modal("hide");e()},cancel:function e(){TS.ui.at_channel_warning_dialog.$div.modal("hide");TS.ui.a11y.restorePreviousFocus()},end:function e(){TS.model.dialog_is_showing=false;TS.ui.at_channel_warning_dialog.showing=false;$(window.document).unbind("keydown",TS.ui.at_channel_warning_dialog.onKeydown);$(window).unbind("resize",TS.ui.at_channel_warning_dialog.position)},build:function e(){$("body").append('<div id="at_channel_warning_dialog" class="modal hide fade"></div>');TS.ui.at_channel_warning_dialog.$div=$("#at_channel_warning_dialog");var t=TS.ui.at_channel_warning_dialog.$div;t.on("hide",function(e){if(e.target!=this)return;TS.ui.at_channel_warning_dialog.end()});t.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.at_channel_warning_dialog.showing=true});t.on("shown",function(e){if(e.target!=this)return;setTimeout(function(){$(window.document).bind("keydown",TS.ui.at_channel_warning_dialog.onKeydown)},100)})}});var e=function e(){};var t;var i=5;var n=function e(t){var i=false;var n;var a={timezone_count:true,display_counts:true};if(t.is_group){n="groups.info";a.channel=t.id}else if(t.is_channel){n="channels.info";a.channel=t.id;a.no_members=true}else{i=true;n="files.info";a.file=t.id}return TS.api.call(n,a).then(function(e){var n;var a;if(i){n=_.get(e,"data.display_counts.display_counts")||1;a=e.data.timezone_count}else{n=(t.is_group?_.get(e,"data.group.display_counts.display_counts"):_.get(e,"data.channel.display_counts.display_counts"))||1;a=t.is_group?e.data.group.timezone_count:e.data.channel.timezone_count}n-=1;return{member_count:n,timezone_count:a}}).catch(function(){return{member_count:0,timezone_count:1}})}})()},4399:function(e,t){(function(){"use strict";TS.registerModule("client.archives",{current_model_ob:null,not_member:false,$scroller:$("#archive_msgs_scroller_div"),$archives_msgs_div:$("#archives_msgs_div"),msgs_are_auto_scrolling:false,active_highlight_count:0,msgs_scrolled_sig:new signals.Signal,onStart:function e(){if(TS.useReactMessages()){y();t=$();return}TS.shared.msg_sent_sig.add(B);TS.channels.joined_sig.add(M);TS.groups.unarchived_sig.add(I);TS.channels.unarchived_sig.add(x);TS.channels.archived_sig.add(E);TS.channels.message_removed_sig.add(D);TS.channels.message_changed_sig.add(F);TS.groups.message_removed_sig.add(D);TS.groups.message_changed_sig.add(F);TS.ims.message_removed_sig.add(D);TS.ims.message_changed_sig.add(F);TS.mpims.message_removed_sig.add(D);TS.mpims.message_changed_sig.add(F);var i=_.throttle(P,1e3);TS.view.members.unknown_resolution_rebuild_sig.add(i);if(!TS.environment.supports_custom_scrollbar)TS.client.archives.$scroller.monkeyScroll({always_show:true});t=$("#monkey_scroll_wrapper_for_archive_msgs_scroller_div");t.addClass("hidden");$("#archives_return").addClass("hidden").removeClass("warning").find(".cancel_archives").addClass("hidden");y()},start:function _(h){if(TS.useReactMessages())return;var T=TS.shared.getActiveModelOb();$("#archives_end_div_msg_lim").addClass("hidden");if(!T){TS.warn("WTF no model_ob in TS.client.archives.start()");return}if(TS.client.archives.getCurrentModelOb())if(T.id==TS.client.archives.getCurrentModelOb().id){if(h&&h==i){if(T._archive_msgs&&TS.utility.msgs.getMsg(h,T._archive_msgs))C(i);return}if(h){if(T._archive_msgs&&TS.utility.msgs.getMsg(h,T._archive_msgs)){i=h;C(i);return}}else{TS.info("no change requested in TS.client.archives.start()");return}}else w();var y=TS.i18n.t("Loading...","archives")();TS.client.archives.$archives_msgs_div.html('<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+y+'" /><br />'+y+"</div>");u=T.id+(h||"");i=h||null;TS.client.archives.current_model_ob=T;e=TS.shared.getHistoryApiMethodForModelOb(T);TS.client.archives.not_member=T.is_channel&&(!T.is_member||T.is_archived)||T.is_group&&T.is_archived;T.never_needs_joined_msg=true;S(TS.client.archives.getCurrentModelOb());$("#client-ui").addClass("archive_view_is_showing");t.removeClass("hidden");TS.client.archives.$scroller.removeClass("hidden");var k={channel:T.id,count:50,_showing_id:u,ignore_replies:true,include_pin_count:true};n=false;a=false;r=0;s=0;o=null;l=null;d=false;c=false;b();v();var A=function e(t,n,a){if(!t){if(a._showing_id!=u)return false;w();if("channel_not_found"===n.error){TS.error("Tried opening channel archives for an invalid channel!",n,a);return}TS.client.archives.start(null,true)}if(!p(t,n,a))return;if(s!=r)return;var o=TS.utility.msgs.getMsg(i,T._archive_msgs);if(o&&TS.utility.msgs.isMsgReply(o)){TS.ui.replies.openConversation(T,o.thread_ts,o.ts);if(!T.is_channel||T.is_member){w();return}}m();var d=TS.client.archives.$scroller;var c=function e(){TS.client.archives.msgs_are_auto_scrolling=true;d.scrollTop(d[0].scrollHeight);TS.client.archives.msgs_are_auto_scrolling=false;var t=i;var n=true;if(!o){var a=TS.utility.msgs.getDisplayedMsgAfterTS(i,T._archive_msgs);if(a&&a.ts)t=a.ts;n=false}if(i)TS.client.ui.scrollMsgsSoMsgIsInView(t,false,n)};c();if(l)return;if(TS.client.archives.$archives_msgs_div.find(".message").length>=20)return;var _=true;f(function(){c()},_)};if(i){var M={channel:T.id,count:50,oldest:i,inclusive:true,_showing_id:u,ignore_replies:true,include_pin_count:true};k.latest=i;k.count=25;r=2;TS.api.callImmediately(e,M,A);TS.api.callImmediately(e,k,A).then(function(e){if(e&&true===e.data.is_limited&&T)T.is_limited=true})}else{r=1;setTimeout(function(){if(!TS.model.archive_view_is_showing)return;if(i)return;TS.api.callImmediately(e,k,A).then(function(){g(k)})},20)}if(!i&&T.was_archived_this_session){T.was_archived_this_session=false;if(T.is_channel){TS.channels.calcUnreadCnts(T,true);TS.channels.markMostRecentReadMsg(T,TS.model.marked_reasons.none_qualify)}else{TS.groups.calcUnreadCnts(T,true);TS.groups.markMostRecentReadMsg(T,TS.model.marked_reasons.none_qualify)}T.was_archived_this_session=true}TS.model.archive_view_is_showing=true;if(TS.client.archives.not_member){TS.client.channel_pane.rebuild("starred","channels");if(!T.is_group){var I={channel:T.id,no_members:true};TS.api.callImmediately("channels.info",I,function(e,t){if(!TS.model.archive_view_is_showing)return;if(!e){TS.warn("WTF, bad API rsp? error:"+t.error);return}if(!t.channel){TS.warn("WTF, no channel?");return}var i=TS.channels.upsertChannel(t.channel);if(i.id!=TS.client.archives.getCurrentModelOb().id)return;TS.channels.data_updated_sig.dispatch(i)})}}TS.view.resizeManually("TS.client.archives started")},getCurrentModelOb:function e(){return TS.client.archives.current_model_ob},maybeHandleArchiveLink:function e(t,i){if(!TS.client)return false;if(!t||!t.length)return false;if(!t.is("a"))return false;var n=t.prop("href");if(!n)return false;var a=TS.utility.normalizeDevHost(n);var r=TS.utility.getPathFromSlackUrl(a);var s=TS.utility.getTeamFromSlackUrl(a);if(!r)return;var o=-1!==a.indexOf("?")&&TS.utility.url.queryStringParse(a.split("?")[1]);if("1"===_.get(o,"force-browser"))return false;var l={messages:true,archives:true}[r[0]];if(l){if(r.length<2)return false;var d=decodeURIComponent(r[1]);if(!d)return false;if(TS.boot_data.feature_cross_team_deeplink&&s!==TS.model.team.domain){if(window.desktop&&window.desktop.teams&&window.desktop.teams.findTeamIdForSubdomain){var c=desktop.teams.findTeamIdForSubdomain(s);if(!c)return false;var u=r[2]&&r[2].replace("p","").replace(/(\d{10})(\d{6})/,"$1.$2");var m=o&&o.thread_ts;var f={team:c,id:d};if(u)f.message=u;if(m)f.thread_ts=m;var h="slack://channel"+TS.utility.url.queryStringEncode(f);var g=document.createElement("iframe");g.src=h;document.body.appendChild(g);setTimeout(function(){g.remove()},1e3);return true}return false}var p=TS.shared.getModelObById(d)||TS.ims.getImByUsername(d)||TS.channels.getChannelByName(d)||TS.groups.getGroupByName(d)||TS.mpims.getMpimByName(d);if(!p){var S=TS.members.getMemberByName(d);if(S){TS.ims.startImByMemberId(S.id);return true}}if(2==r.length||!r[2]){if(p.is_channel)TS.channels.displayChannel({id:p.id});else if(p.is_mpim)TS.mpims.displayMpim({id:p.id});else if(p.is_group)TS.groups.displayGroup({id:p.id});else TS.ims.startImById(p.id);return p.id==TS.model.active_cid}var T=r[2];if(!T)return false;if(0!==T.indexOf("p"))return false;if(17!=T.length)return false;T=T.replace("p","");if(isNaN(T))return false;var v=T.substr(0,10)+"."+T.substr(10);var b;if(p.id==TS.model.active_cid)if(t.hasClass("timestamp"))if(0!==t.closest("#msgs_div").length||0!==t.closest("#archives_msgs_div").length){b=TS.templates.makeMsgDomId(v);if(0!==t.closest("#"+b).length)return true}var w;if(o&&o.thread_ts){if(!isNaN(o.thread_ts)&&-1===o.thread_ts.indexOf(".")&&o.thread_ts.length>10)o.thread_ts=o.thread_ts.substr(0,10)+"."+o.thread_ts.substr(10,6);if(/^\d+\.\d+$/.test(o.thread_ts))w=o.thread_ts}if(w&&w!==v){if(t.hasClass("timestamp"))if(0!==t.closest("#convo_container").length){b=TS.templates.makeMsgDomIdInConversation(v);if(0!==t.closest("#"+b).length)return true}TS.ui.replies.openConversation(p,w,v,i);return true}return TS.client.ui.tryToJump(p.id,v,w)}return false},onMsgsScroll:function e(){if(!TS.model.archive_view_is_showing)return;TS.utility.throttle.method(k,"ts_archives_on_msgs_scroll",250)},maybeLoadScrollBackHistory:function e(){if(TS.client.archives.active_highlight_count||TS.model.ui.is_mouse_down)return;if(s!=r)return;if(n){TS.info("_scrolled_to_bottom _all_loaded_bottom:"+o);if(!o)h()}else if(a){TS.info("_scrolled_to_top _all_loaded_top:"+l);if(!l)f()}},loadMoreBottom:function e(){if(!TS.model.archive_view_is_showing)return;if(!o)h()},loadMoreTop:function e(){if(!TS.model.archive_view_is_showing)return;if(!l)f()},tryToJoin:function e(){if(!TS.model.archive_view_is_showing)return;if(!TS.client.archives.getCurrentModelOb())return;if(!TS.client.archives.getCurrentModelOb().is_channel)return;if(TS.client.archives.getCurrentModelOb().is_archived)return;$("#footer_archives_action_button").trigger("click")},userWantsToCancel:function e(){if(!TS.model.archive_view_is_showing)return;var t=TS.client.archives.getCurrentModelOb();if(t.is_group&&t.is_archived)TS.client.ui.maybePromptForClosingGroup(t.id);else{if(t.was_archived_this_session)t.was_archived_this_session=false;TS.client.archives.cancel()}},cancel:function e(t){if(!TS.model.archive_view_is_showing)return;var i=(TS.client.archives.not_member||TS.ims.isImWithDeletedMember(TS.client.archives.getCurrentModelOb()))&&!t;w(i)},rebuildMsg:function e(t){if(!TS.model.archive_view_is_showing||!TS.client.archives.getCurrentModelOb())return;if(!t)return;var i=TS.client.archives.$archives_msgs_div.find("#"+TS.templates.makeMsgDomId(t.ts));if(!i.length)return;var n=TS.client.archives.getCurrentModelOb();var a=TS.utility.msgs.getPrevDisplayedMsg(t.ts,n._archive_msgs);var r=TS.templates.builders.msgs.buildHTML({msg:t,model_ob:n,prev_msg:a,container_id:"archives_msgs_div",enable_slack_action_links:false});i.replaceWith(r);TS.utility.makeSureAllExternalLinksAreRefererSafe(i)},adjustFooterForArchiveView:function e(t){TS.model.archive_view_is_showing=true;TS.client.archives.current_model_ob=t;$("#client-ui").addClass("archive_view_is_showing");TS.client.archives.not_member=t.is_channel&&(!t.is_member||t.is_archived)||t.is_group&&t.is_archived;S(t)},unAdjustFooterForArchiveView:function e(){TS.model.archive_view_is_showing=false;T();TS.client.archives.current_model_ob=null;$("#client-ui").removeClass("archive_view_is_showing")}});var e="";var t=null;var i=null;var n=false;var a=false;var r=0;var s=0;var o=null;var l=null;var d=false;var c=false;var u=false;var m=function e(){TS.metrics.mark("_displayMsgs");var t=TS.client.archives.getCurrentModelOb();if(!t)return;var i=t._archive_msgs;var n=TS.client.archives.$archives_msgs_div;n.empty();var a;var r;var s;var d=TS.boot_data.team_limit_ts>0;var c;if(t){s=TS.utility.msgs.getOlderMsgsStatus(t);c=s.is_limited||s.more}var u=[];var m;var f;var h="";var g=_.reject(i,TS.utility.msgs.isMsgHidden);for(var p=g.length-1;p>-1;p-=1){if(!m||!TS.utility.msgs.isMsgHidden(m))f=m;m=g[p];if(TS.utility.msgs.isMsgHidden(m))continue;var S=TS.utility.msgs.msgRollUpWorker(p,m,g,u);if("continue"===S){m=f;continue}else if("swap"===S){m=u[0];u.length=0}if(!f||!TS.utility.msgs.areMsgsSameDay(m,f)){if(f)h+="</div></div>";h+='<div class="day_container">';h+=TS.templates.messages_day_divider({ts:m.ts});h+='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(m.ts)+'" data-ts="'+m.ts+'">'}h+=TS.templates.builders.msgs.buildHTML({msg:m,model_ob:t,prev_msg:f,container_id:"archives_msgs_div",enable_slack_action_links:false});if(0===p)h+="</div></div>"}n.html(h);TS.utility.makeSureAllExternalLinksAreRefererSafe(n);var T=!o;$("#archives_bottom_div").toggleClass("hidden",!T);$("#archives_return").toggleClass("hidden",!T);if(d&&l&&c&&!t.is_self_im){var v=$("#archive_msg_lim_btn");var b=$("#archive_msg_lim_btn_treatment");var w=TS.experiment.getGroup("msg_lim_notifs_headers_copy");$(".msg_lim_header_copy").addClass("hidden");if(t.is_im||t.is_mpim||t.is_slackbot_im){if("show_question_learn_more"===w||"show_question_see_pricing_plans"===w)$(".msg_lim_dm_h1_treatment").removeClass("hidden");else $(".msg_lim_dm_h1_control").removeClass("hidden");$(".msg_lim_dm_h2").removeClass("hidden")}else if(t.is_channel||t.is_group){var y=TS.templates.builders.makeChannelPrefix(t);$(".channel_name_msg_lim").html(y+t.name);if("show_question_learn_more"===w||"show_question_see_pricing_plans"===w)$(".msg_lim_channel_h1_treatment").removeClass("hidden");else $(".msg_lim_channel_h1_control").removeClass("hidden");$(".msg_lim_channel_h2").removeClass("hidden")}if(t.is_slackbot_im)r=35;else if(t.is_mpim||t.is_im)r=33;else if(t.is_channel||t.is_group)r=34;if("show_question_see_pricing_plans"===w){a=b.attr("href");a=TS.utility.url.setQueryStringValue(a,"ui_element",r);a=decodeURIComponent(a).substr(1);b.attr("href",a);b.data("data-clog-ui-element",r);b.removeClass("hidden")}else{a=v.attr("href");a=TS.utility.url.setQueryStringValue(a,"ui_element",r);a=decodeURIComponent(a).substr(1);v.attr("href",a);v.data("data-clog-ui-element",r);v.removeClass("hidden")}$("#archives_end_div_msg_lim").removeClass("hidden");TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:r}}})}else $("#archives_top_div").removeClass("hidden");TS.client.archives.msgs_are_auto_scrolling=true;k();TS.client.archives.msgs_are_auto_scrolling=false;TS.ui.utility.updateClosestMonkeyScroller(TS.client.archives.$scroller);A();if(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))TS.metrics.measure("client_archives_display_msgs","_displayMsgs")};var f=function t(i,n){c=true;b();var a=TS.client.archives.getCurrentModelOb();var s=a._archive_msgs[a._archive_msgs.length-1].ts;r+=1;var o={channel:a.id,latest:s,count:parseInt(TS.model.subsequent_msgs_cnt/2,10),_showing_id:u,ignore_replies:true};TS.api.callImmediately(e,o,function(e,t,a){if(!p(e,t,a))return;c=false;b();m();if(s&&!n)TS.client.ui.scrollMsgsSoMsgIsInView(s,true,false);if(i)i()})};var h=function t(){d=true;v();var i=TS.client.archives.getCurrentModelOb();var n=i._archive_msgs[0].ts;r+=1;var a={channel:i.id,oldest:n,count:parseInt(TS.model.subsequent_msgs_cnt/2,10),_showing_id:u,ignore_replies:true};TS.api.callImmediately(e,a,function(e,t,i){if(!p(e,t,i))return;d=false;v();m();if(n)TS.client.ui.scrollMsgsSoMsgIsInView(n,false,false,0)})};var g=function e(t){var i=TS.client.archives.getCurrentModelOb();if(!TS.model.archive_view_is_showing)return;if(t._showing_id!=u)return;if(!i.is_archived)return;var n=TS.utility.msgs.getMostRecentValidTs(i);var a=TS.utility.msgs.getMostRecentValidTs({msgs:i._archive_msgs});var r=n&&a&&n>a;if(r){TS.info("Message history is not most recent; get more.");o=false;h()}};var p=function e(t,n,a){if(!TS.model.archive_view_is_showing)return false;if(a._showing_id!=u)return false;var r=TS.client.archives.getCurrentModelOb();var d=r._archive_msgs;var c=[];var _;var m=false;var f;var h;var g=d&&d.length?d[0]:"";if(g&&!TS.client.msg_pane.getDivForArchiveMsg(g.ts).length)g=null;if(n.messages)for(h=0;h<n.messages.length;h+=1){f=n.messages[h].ts;if(!d||!TS.utility.msgs.getMsg(f,d)){_=n.messages[h];c.push(TS.utility.msgs.processImsgFromHistory(_,r.id))}if(!TS.client.archives.not_member&&!r.is_im&&!m&&TS.utility.msgs.getMsg(f,r.msgs))m=true}r._archive_msgs=d?c.concat(d):c;if(m){c=[];for(h=0;h<r._archive_msgs.length;h+=1)if(!TS.utility.msgs.getMsg(r._archive_msgs[h].ts,r.msgs)){_=r._archive_msgs[h];c.push(_)}TS.utility.msgs.setMsgs(r,c.concat(r.msgs));TS.client.msg_pane.rebuildMsgsWithReason("archive _onHistory");var p;var S;if(g)S=TS.client.archives.$scroller.scrollTop();else p=i;var T=true;w(false,T);if(g)TS.client.ui.$msgs_scroller_div.scrollTop(S);else if(p){var y=TS.utility.msgs.getMsg(p,r.msgs);if(y&&TS.utility.msgs.isMsgReply(y)){TS.ui.replies.openConversation(r,y.thread_ts,y.ts);return false}var k=true;if(!y){var A=TS.utility.msgs.getDisplayedMsgAfterTS(p,r.msgs);if(A&&A.ts)p=A.ts;k=false}TS.client.ui.scrollMsgsSoMsgIsInView(p,false,k)}return false}TS.utility.msgs.sortMsgs(r._archive_msgs);if(a.latest){l=!n.has_more;b()}else if(a.oldest){o=!n.has_more;v()}else{l=a.count!=n.messages.length;b();o=true;v()}s+=1;return true};var S=function e(t){var i=t.is_channel?"#":"";var n="";if(t.is_channel)n='<ts-icon class="ts_icon_bold_hash_small"></ts-icon>';else if(t.is_group)n='<ts-icon class="ts_icon_lock"></ts-icon>';var a="";a+=TS.templates.builders.maybeMakeSharedIcon(t);$("#footer_archives_action_button").addClass("btn_outline");var r=TS.ims.isImWithDeletedMember(t);if(TS.client.archives.not_member||r){var s;var o;$("#footer_msgs").addClass("hidden");$("#footer").css("height","auto");$("#footer_archives").removeClass("hidden no_tip");if(t.is_archived&&!t.is_im){if(1===t.is_moved)s=TS.i18n.t("You are viewing <strong>{hash}{channel_name}{shared}</strong>, a moved channel","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(t.name,25)),shared:a});else s=TS.i18n.t("You are viewing <strong>{hash}{channel_name}{shared}</strong>, an archived channel","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(t.name,25)),shared:a});o=TS.i18n.t('<strong aria-label="return">Esc</strong> to close',"archives")();$("#footer_archives_text").html(s);$("#footer_archives_action_button").text(TS.i18n.t("Close Channel","archives")());$("#footer_archives_action_tip").html('<span class="tiny dialog_cancel_hint">'+o+"</span>")}else if(r){s=TS.i18n.t('<ts-icon class="ts_icon_archive"></ts-icon> You are viewing the archives of a deactivated account',"archives")();$("#footer_archives").addClass("no_tip");$("#footer_archives_text").html(s);$("#footer_archives_action_button").text(TS.i18n.t("Close","archives")());$("#footer_archives_action_tip").html("")}else{s=TS.i18n.t("You are viewing a preview of <strong>{hash}{channel_name}{shared}</strong>","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(t.name,25)),shared:a});o=TS.i18n.t('<strong aria-label="return">Return <span class="return_char">&crarr;</span></strong> to join',"archives")();$("#footer_archives_text").html(s);$("#footer_archives_action_button").text(TS.i18n.t("Join Channel","archives")()).removeClass("btn_outline");$("#footer_archives_action_tip").html('<span class="tiny dialog_cancel_hint">'+o+"</span>")}TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")}else TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,TS.i18n.t("You are viewing the archives of {hash}{channel_name}","archives")({hash:i,channel_name:t.name}))};var T=function e(){$("#footer_msgs").removeClass("hidden");$("#footer").css("height","");$("#footer_archives").addClass("hidden");$("#archives_bottom_div").addClass("hidden");$("#archives_top_div").addClass("hidden");$("#archives_return").addClass("hidden").removeClass("warning");TS.client.archives.$scroller.addClass("hidden");TS.client.msg_input.setPlaceholder();TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div)};var v=function e(){var t;if(d)t=TS.i18n.t("retrieving history...","archives")();else if(o)if(i)t="&nbsp;";else t="";else t='<a onclick="TS.client.archives.loadMoreBottom()">'+TS.i18n.t("and more...","archives")()+"</a>";$("#archives_bottom_div").html(t)};var b=function e(){var t;if(c)t=TS.i18n.t("retrieving history...","archives")();else if(l)t=TS.i18n.t("~FIN~","archives")();else t='<a onclick="TS.client.archives.loadMoreTop()">'+TS.i18n.t("and more...","archives")()+"</a>";$("#archives_top_div").html(t)};var w=function n(a,r){if(!TS.model.archive_view_is_showing)return;if(a&&!TS.client.archives.previous_model_ob)TS.client.archives.previous_model_ob=TS.channels.getGeneralChannel()||TS.ims.getImByMemberId("USLACKBOT");TS.client.archives.$archives_msgs_div.empty();TS.ui.utility.updateClosestMonkeyScroller(TS.client.archives.$scroller);t.addClass("hidden");var s=false;if(TS.client.archives.getCurrentModelOb()){TS.client.archives.getCurrentModelOb()._archive_msgs=void 0;if(TS.client.archives.not_member)s=true}i=null;TS.client.archives.current_model_ob=null;e="";TS.model.archive_view_is_showing=false;if(s)TS.client.channel_pane.rebuild("starred","channels");$("#client-ui").removeClass("archive_view_is_showing");T();TS.view.resizeManually("TS.client.archives ended");if(TS.boot_data.feature_initial_scroll_position&&!a&&!r)TS.client.msg_pane.setInitialScrollPosition(-1);if(!TS.boot_data.feature_initial_scroll_position&&!r&&TS.model.prefs.start_scroll_at_oldest&&TS.shared.getActiveModelOb().unread_cnt)setTimeout(TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView,100);else TS.client.msg_pane.checkUnreads();if(a){var o=TS.client.archives.previous_model_ob;delete TS.client.archives.previous_model_ob;if(o.is_channel)TS.channels.displayChannel({id:o.id});else if(o.is_mpim)TS.mpims.displayMpim({id:o.id});else if(o.is_group)TS.groups.displayGroup({id:o.id});else TS.ims.startImById(o.id)}};var y=function e(){$("#footer_archives_action_button").bind("click",function(){if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var e=TS.client.archives.getCurrentModelOb();if(e.is_channel)if(e.is_archived)TS.channels.closeArchivedChannel(e.id);else TS.channels.joinById(e.id,function(){TS.shared.maybeFetchHistory(e);TS.client.msg_pane.maybeSetupCalls()});else if(e.is_im){TS.ims.closeIm(e.id);w(true)}else TS.shared.closeArchivedChannel(e.id)});TS.client.archives.$scroller.scroll(function(){TS.client.archives.onMsgsScroll()});$("#archives_return .archives_return__link-column__link").bind("click",function(){if(TS.client.archives.not_member)if(o)TS.client.ui.slowScrollMsgsToBottom();else{w();TS.client.archives.start()}else w()});TS.client.ui.$msg_input.bind("textchange",function(){if(!TS.model.archive_view_is_showing)return;if(TS.client.archives.not_member)return;var e=$(this);if(""===e.val())$("#archives_return").removeClass("warning");else $("#archives_return").addClass("warning")})};var k=function e(){if(!TS.model.archive_view_is_showing)return;TS.client.archives.msgs_scrolled_sig.dispatch();var t;a=false;n=false;if(TS.client.ui.areMsgsScrolledToBottom(0)){t=-1;n=true}else{t=TS.client.archives.$scroller[0].scrollTop;if(0===t)a=true}var i=TS.client.ui.areMsgsScrolledToBottom(50);$("#archives_return").find(".cancel_archives").toggleClass("hidden",!!i&&o);if(TS.client.archives.msgs_are_auto_scrolling)return;TS.client.ui.checkInlineImgsAndIframes("archives");TS.client.archives.maybeLoadScrollBackHistory()};var A=function e(){var t=TS.client.archives.$scroller.find(".message");var i=[];if(t.length){var n={shortenMonth:true};i.push(TS.interop.datetime.toCalendarDate(t.eq(0).data("ts"),n));if(t.length>1){var a=TS.interop.datetime.toCalendarDate(t.eq(t.length-1).data("ts"),n);if(a!=i[0])i.push(a)}$("#archives_return_date").text(i.join(" - "))}};var C=function e(t){if(TS.client.archives.getCurrentModelOb()){var i=TS.client.archives.getCurrentModelOb();var n=TS.utility.msgs.getMsg(t,i._archive_msgs);if(n&&TS.utility.msgs.isMsgReply(n)){TS.ui.replies.openConversation(i,n.thread_ts,n.ts);return}}TS.client.ui.scrollMsgsSoMsgIsInView(t,false,true)};var M=function e(t){if(!TS.model.archive_view_is_showing)return;if(t.id!=TS.client.archives.getCurrentModelOb().id)return;TS.client.archives.not_member=false;TS.client.archives.cancel();TS.client.ui.instaScrollMsgsToBottom(false)};var I=function e(t){if(!TS.model.archive_view_is_showing)return;if(t.id!=TS.client.archives.getCurrentModelOb().id)return;TS.client.archives.not_member=false;TS.client.archives.cancel();TS.client.ui.instaScrollMsgsToBottom(false)};var x=function e(t){if(!TS.model.archive_view_is_showing)return;if(t.id!=TS.client.archives.getCurrentModelOb().id)return;S(TS.client.archives.getCurrentModelOb())};var E=function e(t){if(!TS.model.archive_view_is_showing)return;if(t.id!=TS.client.archives.getCurrentModelOb().id)return;S(TS.client.archives.getCurrentModelOb())};var B=function e(t){if(!TS.model.archive_view_is_showing)return;if(TS.client.archives.not_member)return;if(t.id!=TS.client.archives.getCurrentModelOb().id)return;TS.client.archives.cancel()};var D=function e(t,i){if(!TS.model.archive_view_is_showing)return;if(!i)return;if(t.id!=TS.client.archives.getCurrentModelOb().id)return;var n=TS.client.msg_pane.getDivForArchiveMsg(i.ts);if(!n.length)return;m()};var F=function e(t,i){if(!TS.model.archive_view_is_showing)return;if(!i)return;if(t.id!=TS.client.archives.getCurrentModelOb().id)return;var n=TS.client.msg_pane.getDivForArchiveMsg(i.ts);if(!n.length)return;m()};var P=function e(){if(!TS.model.archive_view_is_showing)return;var t=TS.client.archives.getCurrentModelOb();if(TS.shared.getActiveModelOb()!=t)return;var i=TS.client.archives.$scroller.scrollTop();m(t,t._archive_msgs);TS.client.archives.msgs_are_auto_scrolling=true;TS.client.archives.$scroller.scrollTop(i);TS.client.archives.msgs_are_auto_scrolling=false}})()},4400:function(e,t){(function(){"use strict";TS.registerModule("client.channel_page",{onStart:function e(){k=new TS.PresenceList;TS.client.login_sig.add(U);TS.client.flexpane_display_switched_sig.add(H);if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(N);else TS.ms.connected_sig.add(N);TS.channels.data_updated_sig.add(j);TS.channels.switched_sig.add(G);TS.channels.purpose_changed_sig.add(K);TS.channels.member_left_sig.add(ee);TS.channels.member_joined_sig.add(X);TS.channels.renamed_sig.add(q);TS.channels.left_sig.add(de);TS.channels.joined_sig.add(ce);TS.channels.topic_changed_sig.add(z);TS.channels.converted_to_shared_sig.add(V);TS.channels.shared_teams_updated_sig.add(W);TS.groups.switched_sig.add(G);TS.groups.purpose_changed_sig.add(K);TS.groups.member_left_sig.add(Z);TS.groups.member_joined_sig.add(J);TS.groups.renamed_sig.add(q);TS.groups.left_sig.add(de);TS.groups.topic_changed_sig.add(z);TS.groups.converted_to_shared_sig.add(V);TS.groups.shared_teams_updated_sig.add(W);TS.ims.switched_sig.add(G);TS.mpims.switched_sig.add(G);TS.members.presence_changed_sig.add(te);TS.members.changed_name_sig.add(ie);TS.members.changed_profile_sig.add(ie);TS.members.changed_current_status_sig.add(ie);TS.members.changed_account_type_sig.add(ie);TS.members.changed_deleted_sig.add(ne);TS.view.members.unknown_resolution_rebuild_sig.add(ie);TS.view.members.unknown_resolution_rebuild_sig.add(function(){if(!_e())return;var e=TS.shared.getActiveModelOb();ve(e)});TS.membership.membership_counts_need_refetch_sig.add(me);TS.prefs.display_real_names_override_changed_sig.add(ae);TS.prefs.team_display_real_names_changed_sig.add(ae);TS.prefs.push_changed_sig.add(Y);TS.prefs.dtop_notif_changed_sig.add(Y);TS.prefs.team_perms_pref_changed_sig.add(Y);TS.prefs.muted_channels_changed_sig.add(Y);TS.ui.growls.permission_changed_sig.add(Y);TS.files.channel_files_fetched_sig.add(re);TS.files.team_file_added_sig.add(se);TS.files.team_file_deleted_sig.add(se);TS.files.team_file_changed_sig.add(se);TS.files.team_file_comment_edited_sig.add(oe);TS.pins.pinned_status_changed_sig.add(le);TS.pins.pinned_message_changed_sig.add(le);TS.pins.pinned_message_deleted_sig.add(le);TS.pins.pins_fetched_sig.add(le);TS.view.members.unknown_resolution_rebuild_sig.add(function(){ye(TS.shared.getActiveModelOb())});if(TS.boot_data.feature_app_permissions_api_site)TS.apps.permissions.app_resource_membership_changed_sig.add(Ge);if(TS.boot_data.feature_app_permissions_api_site)TS.apps.permissions.xoxa_apps_installed_sig.add(function(){if(!_e())return;fe()});TS.client.channel_page.initUI();B();TS.view.resize_sig.add(ke)},initUI:function _(){S=TS.storage.fetchChannelPageState();if(!S.expanded_sections)S.expanded_sections={about:false,insights:false,pinned_items:false,members:false,shared_files:false,notif_prefs:false,apps:false};T=S.expanded_sections;e=$("#details_tab");e.append(TS.templates.channel_page_empty_state({state:S}));t=e.find("#channel_page_scroller");s=e.find(".conversation_details");i=e.find(".channel_page_about .section_content.channel_purpose");n=e.find(".channel_page_pinned_items .section_content.pinned_items");a=e.find(".channel_page_member_tabs");r=e.find(".channel_page_member_lists");o=e.find(".channel_page_shared_files .section_content");l=e.find(".channel_page_notif_prefs .section_content");d=e.find(".channel_page_notif_prefs .channel_page_notif_prefs_mute_state");m=e.find('[data-js="channel_page_apps_list"]');if(TS.boot_data.feature_sli_channel_insights){c=e.find(".c-channel_insights");u=e.find('[data-js="sli_channel_insights_section"]')}},showAboutSection:function e(){if(!T.about)F("about");t.find(".channel_page_about").scrollintoview({offset:"top",px_offset:50})},showPinsSection:function e(){if(T.members)F("members");if(T.shared_files)F("shared_files");if(!T.pinned_items)F("pinned_items");t.find(".channel_page_pinned_items").scrollintoview({offset:"top",px_offset:50})},showMembersSection:function e(){if(T.pinned_items)F("pinned_items");if(T.shared_files)F("shared_files");if(!T.members)F("members");t.find(".channel_page_members").scrollintoview({offset:"top",px_offset:50})},showMemberSectionAndHighlight:function e(){TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showMembersSection();$("#channel_page_scroller .channel_page_members").highlight(null,"channel_page_members_highlighter")},showFilesSection:function e(){if(T.members)F("members");if(T.pinned_items)F("pinned_items");if(!T.shared_files)F("shared_files");t.find(".channel_page_shared_files").scrollintoview({offset:"top",px_offset_:50})},showNotifPrefsSection:function e(){if(!T.notif_prefs)F("notif_prefs");t.find(".channel_page_notif_prefs").scrollintoview({offset:"top",px_offset_:50})},showAppsSection:function e(){if(!T.apps)F("apps");t.find('[data-js="channel_page_apps"]').scrollintoview({offset:"top",px_offset_:50})},pinnedItemHtml:function e(t,i){try{var n={item:t,model_ob:i,can_remove:TS.pins.canUserPinHere(i)};if("message"===t.type){var a=t.message;var r=TS.members.getPotentiallyUnknownMemberById(a.user);var s=TS.utility.msgs.shouldHaveBotLabel(a,r);var o;var l;if(s){var d=TS.bots.getBotInfoByMsg(a);if(d){o=d.app_id;l=d.bot_id}}n.is_message=true;n.member=r;n.permalink=TS.utility.msgs.constructMsgPermalink(i,t.message.ts,t.message.thread_ts);n.is_bot=s;n.is_reply=a.thread_ts&&a.thread_ts!=a.ts;n.is_broadcast=TS.boot_data.feature_new_broadcast&&"thread_broadcast"===a.subtype;n.app_id=o;n.bot_id=l}else if("file"===t.type)n.is_file=true;else if("file_comment"===t.type)n.is_comment=true;return TS.templates.channel_page_pinned_item(n)}catch(e){TS.info("Problem in pinnedItemHtml:"+e);return""}},clearUnreadPinState:function e(){$(".pinned_item").removeClass("unread_pin")},highlightPinnedItemForRemoval:function e(t){var i=Ve(t);i.addClass("delete_mode")},unHighlightPinnedItemForRemoval:function e(t){var i=Ve(t);i.removeClass("delete_mode")},isPurposeTooLong:function e(t){return TS.utility.contenteditable.getLength(t)>TS.model.channel_purpose_max_length},updatePurposeTooLongWarning:function e(t){var i=TS.client.channel_page.isPurposeTooLong(t);$(t).parent().find(".too_long_warning").toggleClass("hidden",!i);return!i},test:function e(){var t={initEvents:B,rebuildChannelPage:fe,rebuildChannelDetails:ve,rebuildPinnedItems:ye,rebuildMembersTabs:Me,rebuildMemberLists:Be,generateMemberListTemplateArgs:Ee,SEE_ALL_MEMBERS_DIALOG_THRESHOLD:M,MAX_SIDEBAR_MEMBERS_COUNT:I};Object.defineProperty(t,"_will_rebuild_count_templates_after_promise_resolves",{get:function e(){return Ce},set:function e(t){Ce=t}});Object.defineProperty(t,"_expanded_sections",{get:function e(){return T},set:function e(t){T=t}});Object.defineProperty(t,"_renderMemberList",{get:function e(){return $e},set:function e(t){$e=t}});return t}});var e;var t;var i;var n;var a;var r;var s;var o;var l;var d;var c;var u;var m;var f=false;var h=false;var g=false;var p;var S;var T;var v=[];var b={};var w={};var y=10;var k;var A;var C;var M=50;var I=20;var x=6e4;var E=2e4;var B=function n(){e.on("click",".invite_link",function(){var e=TS.shared.getActiveModelOb();TS.ui.channel_invite_modal.startInviteToChannelModal(e.id)});e.on("click",".find_files_link",function(){var e=TS.shared.getActiveModelOb();TS.search.setInputVal("in:"+(e.is_channel&&!e.is_private?"#":"")+e.name);TS.search.setFilter("files");TS.search.submitSearch()});e.on("click",".leave_link",function(){var e=TS.shared.getActiveModelOb();if(e.is_channel)TS.channels.leave(e.id);else if(e.is_group)TS.groups.leave(e.id)});e.on("click",".member_preview_link[data-member-id]",function(e){e.preventDefault();var t=$(this).data("member-id");TS.menu.member.startWithMember(e,t)});e.on("click",".section_header",function(e){var t=$(e.target).closest("[data-section-name]");var i=t.data("section-name");if(!i)return;if("members"===i&&!T.members)return TS.client.channel_page.showMembersSection();if("pinned_items"===i&&!T.pinned_items)return TS.client.channel_page.showPinsSection();if("shared_files"===i&&!T.shared_files)return TS.client.channel_page.showFilesSection();F(i)});e.on("click keydown",".edit_purpose, .purpose_cancel",function(e){if("click"===e.type)P();else if(e.which==TS.utility.keymap.enter)P()});e.on("click keydown",".purpose_done",function(e){if("click"===e.type)O();else{if(e.which==TS.utility.keymap.enter)O();if(e.which==TS.utility.keymap.tab){e.preventDefault();e.stopImmediatePropagation();i.find(".purpose_cancel").focus()}}});if(TS.boot_data.feature_app_permissions_api_site){e.on("click","[data-app-user-id]",function(e){var t=$(e.currentTarget);var i=t.data("app-user-id");var n=TS.members.getMemberById(i);if(n)if($(e.target).is('[data-action="remove_app"]'))TS.apps.permissions.removeAppOrBotFromActiveResource(n);else{var a=_.get(n,"profile.bot_id");if(a)TS.menu.app.startWithApp(e,a).then(function(){TS.menu.positionAt(t,-320,0)})}});e.on("click",'[data-js="channel_page_apps_add"]',function(){TS.ui.apps_browser.startAddApps()})}if(!(TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty())){e.on("keydown","#channel_purpose_input",function(e){if(e.which==TS.utility.keymap.enter&&!e.shiftKey&&!e.altKey)O();if(e.which==TS.utility.keymap.esc)P()});e.on("focus","#channel_purpose_input",function(){i.find("#channel_purpose_input").autosize()})}e.on("click",".pinned_item .remove_pin",function(e){var t=TS.shared.getActiveModelOb();var i=$(this).closest(".pinned_item");var n=i.data("ts");var a=i.data("comment-id");var r=i.data("file-id");var s=i.data("type");if("message"===s)TS.pins.unPinMessage(n.toString(),t);else if("file"===s)TS.pins.unPinFile(r,t);else if("file_comment"===s)TS.pins.unPinFileComment(a,r,t);e.preventDefault()});e.on("click",".pinned_item .pin_metadata",function(e){if(TS.client.archives.maybeHandleArchiveLink($(this)))e.preventDefault()});e.on("click",".pinned_item",function(e){if(e.isDefaultPrevented()||$(e.target).is("a"))return;e.preventDefault();var t=$(this).data("type");var i=TS.shared.getActiveModelOb();var n=$(this).data("ts");var a=$(this).data("file-id");var r=$(this).attr("data-thread-ts");var s=$(this).data("is-broadcast");var o="channel_page";if(i.is_im||i.is_mpim)o="im_page";else if(i.is_group)o="group_page";if("message"===t)if(r&&r!=n&&!s)TS.ui.replies.openConversation(i,r,n,o);else if(TS.boot_data.feature_new_broadcast)TS.view.displayMsgInModelOb(i,n);else TS.client.ui.tryToJump(i.id,n.toString());else if("file"===t||"file_comment"===t)TS.client.ui.files.previewFile(a,o)});e.on("click",".view_all_files_link",function(){TS.clog.track("SEARCH_OPEN",{open_method:"files"});var e=TS.shared.getActiveModelOb();TS.search.setInputVal("in:"+(e.is_channel&&!e.is_private?"#":"")+e.name);TS.search.setFilter("files");TS.search.submitSearch()});e.on("click",".edit_notif_prefs_btn",function(){var e=TS.shared.getActiveModelOb();TS.ui.channel_prefs_dialog.start(e.id)});e.on("click",".add_someone",function(e){e.preventDefault();var t=TS.shared.getActiveModelOb();var i=t.is_channel||t.is_group&&!t.is_mpim;if(i)TS.ui.channel_invite_modal.startInviteToChannelModal(t.id);else if(t.is_mpim)TS.ui.im_browser.startWithMpim(t)});e.on("click",".creator_link",function(){var e=TS.shared.getActiveModelOb();var t=e.created;var i=e.msgs[e.msgs.length-1];var n=Math.floor(i.ts);if(n<=t){var a=TS.utility.msgs.getDisplayedMsgAfterTS(t,e.msgs);if(a)TS.client.ui.scrollMsgsSoMsgIsInView(a.ts,false,true)}else D(t,e)});t.on("scroll",_.debounce(function(){if(!_e())return;A=t.scrollTop()},100))};var D=function e(t,i){var n=TS.shared.getHistoryApiMethodForModelOb(i);var a={channel:i.id,oldest:t,count:1,inclusive:1,ignore_replies:true,include_pin_count:true};TS.api.call(n,a).then(function(e){var t;if(e.data.messages.length<1){t=i._archive_msgs[0].ts;TS.client.archives.start(t)}else{t=e.data.messages[0].ts;if(TS.utility.msgs.getMsg(t,i.msgs))TS.client.ui.scrollMsgsSoMsgIsInView(t,false,true);else TS.client.archives.start(t)}return true}).catch(function(){return TS.warn("Couldn’t find creation message at "+t+" in channel: "+i.id)})};var F=function e(i){var n=TS.shared.getActiveModelOb();var a=t.find('.channel_page_section[data-section-name="'+i+'"]');if(0===a.length)return;if(T[i]){T[i]=false;if("about"===i)Se(n);if("pinned_items"===i)Ae();if("members"===i)Pe();if("shared_files"===i)Ue(n);if("notif_prefs"===i)we();if("apps"===i)He();if("insights"===i)nt();a.removeClass("expanded")}else{T[i]=true;a.addClass("expanded");if("about"===i)ve(n);if("about"===i&&(n.is_im||n.is_mpim))pe(n);if("pinned_items"===i)ye(n);if("members"===i)Be(n);if("shared_files"===i)Re(n);if("notif_prefs"===i)be(n);if("apps"===i)Le(n);if("insights"===i)it(n)}TS.storage.storeChannelPageState(S);TS.ui.utility.updateClosestMonkeyScroller(t);ze()};var P=function e(){i.find(".edit_purpose_label, #channel_purpose_input, .purpose_done, .purpose_cancel, .purpose_label, .channel_purpose_section .channel_purpose_text").toggleClass("hidden");var t=i.find("#channel_purpose_input");if(i.find("#channel_purpose_input").hasClass("hidden")){$("#channel_purpose_input + .too_long_warning").addClass("hidden");TS.utility.contenteditable.blur(t);i.find(".purpose_done, .purpose_cancel").blur()}else{var n=TS.shared.getActiveModelOb();TS.utility.contenteditable.value(t,TS.utility.unformatTopicOrPurpose(n.purpose.value));TS.utility.contenteditable.focus(t)}};var O=function e(){var t=TS.shared.getActiveModelOb();var n=i.find("#channel_purpose_input");var a=_.trim(TS.utility.contenteditable.value(n));if(TS.client.channel_page.isPurposeTooLong(n))return;if(t.purpose.value===a){P();return}if(t.is_group)TS.groups.setPurpose(t.id,a);else if(t.is_channel)TS.channels.setPurpose(t.id,a);P()};var R=function e(t){var i=TS.shared.getActiveModelOb();var n=t.channels;if(i.is_group)n=t.groups;else if(i.is_im)n=t.ims;return-1!==n.indexOf(i.id)};var U=function e(){f=true};var Q=function e(){if(C)clearInterval(C)};var L=function e(){Q();C=setInterval(Fe,x)};var H=function e(t){var i=TS.model.ui_state.flex_name;if(!i||"details"===t&&"details"!==i){he();g=false;if("details"===t){var n=TS.shared.getActiveModelOb();var a=n&&n.id?{channel_id:n.id,channel_type:n.id.charAt(0),is_member:n.is_member}:{};TS.clog.track("FLEXPANE_CHANNEL_DETAILS_CLOSE",a)}return}if(!g&&"details"===i){g=true;fe();var r=TS.shared.getActiveModelOb();var s=r&&r.id?{channel_id:r.id,channel_type:r.id.charAt(0),is_member:r.is_member}:{};TS.clog.track("FLEXPANE_CHANNEL_DETAILS_OPEN",s)}};var N=function e(){if(h){b={};if(!_e())return;fe()}else h=true};var G=function e(){if(!f)return;Ce=false;var t=TS.shared.getActiveModelOb();if(!t)return;A=null;if("details"===TS.model.ui_state.flex_name)fe()};var j=function e(t){if(!ue(t))return;if("details"===TS.model.ui_state.flex_name)fe()};var W=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();ve(i)};var K=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();ve(i)};var z=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();ve(i)};var V=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();ve(i)};var Y=function e(){if(!_e())return;var t=TS.shared.getActiveModelOb();be(t)};var q=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();ge(i);ve(i)};var J=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();ve(i);Me(i);if(T.members)Fe()};var Z=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();ve(i);Me(i);if(T.members)Fe()};var X=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();Me(i);if(T.members)Fe()};var ee=function e(t){if(!_e())return;if(!ue(t))return;var i=TS.shared.getActiveModelOb();Me(i);if(T.members)Fe()};var te=function e(t){var i=true;ie(t,i)};var ie=function e(t,i){if(!TS.model.ms_connected)return;if(!t||"undefined"===typeof t.id)return;if(!_e())return;var n=TS.shared.getActiveModelOb();if(n){var a=TS.membership.getUserChannelMembershipStatus(t.id,n);var r=a.is_known?a.is_member:true;if(r){var s=!i;if(s)Me(n);if(T.members)Fe()}if(n.creator&&n.creator===t.id)ve(n)}};var ne=function e(){if(!_e())return;var t=TS.shared.getActiveModelOb();Me(t);if(T.members)Fe()};var ae=function e(){if(!_e())return;var t=TS.shared.getActiveModelOb();Be(t)};var re=function e(t){if(!_e())return;var i=TS.shared.getActiveModelOb();if(!i||!t||i.id!==t)return;delete w[i.id];if(!i.is_channel||i.is_member)b[i.id]=true;Re(i)};var se=function e(t){if(!_e())return;var i=TS.shared.getActiveModelOb();if(!i)return;if(t.pinned_to&&-1!==t.pinned_to.indexOf(i.id))ye(i);if(R(t))Re(i)};var oe=function e(t,i){if(!_e())return;var n=TS.shared.getActiveModelOb();if(!n)return;if(i.pinned_to&&-1!==i.pinned_to.indexOf(n.id))ye(n)};var le=function e(t){if(!_e())return;if(!ue(t))return;ye(t)};var de=function e(t){delete b[t.id];if(_e()&&TS.model.user.is_restricted)ve(TS.shared.getActiveModelOb())};var ce=function e(t){if(!_e())return;if(ue(t))fe();else if(TS.model.user.is_restricted)ve(TS.shared.getActiveModelOb())};var _e=function e(){return g};var ue=function e(t){var i=TS.shared.getActiveModelOb();if(!i||!t||i.id!==t.id)return false;return true};var me=function e(){var t=TS.shared.getActiveModelOb();Me(t);if(T.members)Be(t)};var fe=function e(){he();var i=TS.shared.getActiveModelOb();if(i.is_im||i.is_mpim){if(i.is_im)$("#details_tab").addClass("dm_info_pane");else $("#details_tab").removeClass("dm_info_pane");if(i.is_mpim)$("#details_tab").addClass("mpim_info_pane");else $("#details_tab").removeClass("mpim_info_pane");pe(i)}else $("#details_tab").removeClass("dm_info_pane mpim_info_pane");if(TS.apps.permissions.areXoxaAppsInstalled()){$("#details_tab").toggleClass("app_dm_info_pane",TS.apps.isCurrentModelViewAnApp());Qe=null}$('[data-js="channel_page_apps"]').toggleClass("hidden",!TS.apps.permissions.areXoxaAppsInstalled());ge(i);ve(i);ye(i);Me(i);Be(i);Re(i);be(i);if(TS.boot_data.feature_sli_channel_insights&&TS.client.ui.channel_insights.isEnabled())it(i);if(TS.apps.permissions.areXoxaAppsInstalled())Le(i);L();if(!TS.environment.supports_custom_scrollbar){var n=t.data("monkeyScroll");if(n)TS.ui.utility.updateClosestMonkeyScroller(t);else t.monkeyScroll()}ze();if(A)t.scrollTop(A)};var he=function e(){We();Ae();xe();Pe();Se();Ue();we();at();if(TS.apps.permissions.areXoxaAppsInstalled())He();Q()};var ge=function e(t){var i;if(t.is_channel&&!t.is_mpim||!t.is_channel&&t.is_group&&!t.is_mpim){$("#channel_page_title").text(TS.i18n.t("Channel Details","client")());var n='<span class="channel_name overflow_hidden"><span class="overflow_ellipsis">';n+=TS.templates.builders.makeChannelPrefix(t);n+=_.escape(t.name);n+="</span>";n+=TS.templates.builders.maybeMakeSharedIcon(t);n+="</span>";i=TS.i18n.t("About {formatted_channel_name}","client")({formatted_channel_name:n})}else i='<span class="overflow_ellipsis">'+TS.i18n.t("About this conversation","client")()+"</span>";$("#details_tab_header").html(i)};var pe=function e(t){Se();if(t.is_mpim)return;var i=TS.members.getPotentiallyUnknownMemberById(t.user);k.add(i.id);s.html(TS.templates.channel_page_conversation_details({member:i}));TS.client.flex_pane.startLocalTimeInterval();Oe("about")};var Se=function e(){Oe("about");k.clear();s.empty();TS.client.flex_pane.stopLocalTimeInterval()};var Te=function e(t){var i=TS.membership.getMembershipCounts(t);if(i.promise)if(!Ce){if(TS.has_pri[et])TS.log(et,"Channel member counts ("+t.id+"): Will rebuild member tabs after we get counts from API");Ce=true;i.promise.then(function(){if(t.id===TS.shared.getActiveModelOb().id){if(TS.has_pri[et])TS.log(et,"Channel member counts ("+t.id+"): Got counts from API, rebuilding member tabs now");Me(t);if(TS.shared.isModelObShared(t)){if(TS.has_pri[et])TS.log(et,"Channel member counts ("+t.id+"): Got counts from API, rebuilding channel details now");ve(t)}}else if(TS.has_pri[et])TS.log(et,"Channel member counts ("+t.id+"): Got counts from API, but active model object has changed, so not rebuilding member tabs")}).finally(function(){Ce=false})}var n=_.get(i,"counts.member_count");var a=_.get(i,"counts.restricted_member_count");var r;if(!i.counts)r="waiting for initial data";else if(i.promise)r="using provisional data while waiting for API response";else r="have up-to-date data";if(TS.has_pri[et])TS.log(et,"Channel member counts ("+t.id+"): Rebuilding count templates: "+r+"; member count = "+n+"; restricted member count = "+a);return i};var ve=function e(t){if(t.is_im||t.is_mpim)return;var n={model_ob:t,show_set_purpose:(t.is_member||t.is_group)&&!TS.model.user.is_ultra_restricted&&(!TS.channels.isChannelRequired(t)||TS.members.canUserPostInGeneral()),show_edit_purpose_or_topic:(t.is_member||t.is_group)&&!TS.model.user.is_ultra_restricted&&!TS.model.user.is_restricted&&(!TS.channels.isChannelRequired(t)||TS.members.canUserPostInGeneral())};if(TS.boot_data.page_needs_enterprise&&(t.is_channel||t.is_group)&&t.is_org_shared&&t.is_global_shared){n.is_globally_shared=true;n.enterprise_org_name=TS.model.enterprise.name;n.enterprise_org_icon=TS.model.enterprise.icon}var a=TS.members.getPotentiallyUnknownMemberById(t.creator);if(a&&a.is_self)n.creator_name=TS.i18n.t("you","channel_pages")();else if(a&&a.is_unknown){n.is_member_unknown=true;n.unknown_member_token=new Handlebars.SafeString(TS.templates.unknown_member())}else if(a)n.creator_name=TS.members.getPrefCompliantMemberName(a);else n.creator_name=TS.i18n.t("unknown","channel_pages")();var r=t.msgs&&t.msgs.length&&_.get(t,["msgs",t.msgs.length-1,"ts"],"");n.permalink=r&&TS.utility.msgs.constructMsgPermalink(t,r)||"javascript:void(0)";var s=TS.interop.datetime.toDateObject(t.created);if(TS.interop.datetime.isToday(s))n.days_since_creation=0;else if(TS.interop.datetime.isYesterday(s))n.days_since_creation=1;n.creation_date=1e3*t.created;if(TS.boot_data.page_needs_enterprise&&t.is_org_shared&&t.shared_team_ids)n.teams_shared_with=_.map(t.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)}).filter(function(e){return e});else if(TS.shared.isModelObShared(t)){var o=0;var l=Te(t);n.is_loading_members=!l.counts||!_.isObject(l.counts.teams_member_count);n.shared_teams=_.map(t.shared_team_ids,function(e){var t=TS.teams.getTeamById(e)||{id:e};t.member_count=_.get(l,["counts","teams_member_count",e]);o+=t.member_count;return t});var d=_.clone(TS.model.team);d.member_count=_.get(l,["counts","member_count"])-o;n.shared_teams.push(d)}i.html(TS.templates.channel_page_details(n)).removeClass("hidden");if(TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()){var c=$("#channel_purpose_input");TS.utility.contenteditable.create(c,{modules:{tabcomplete:{positionMenu:function e(t){t.style.width=c.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,c)},searchOptions:{complete_member_specials:false},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members]}},onEnter:function e(t){if(t.shiftKey)return true;O();return false},onEscape:function e(){P()},onTextChange:function e(){TS.client.channel_page.updatePurposeTooLongWarning(c)}});TS.utility.contenteditable.enable(c);TS.utility.contenteditable.value(c,TS.utility.unformatTopicOrPurpose(t.purpose.value));c.on("keydown",function(e){if(e.which===TS.utility.keymap.up||e.which===TS.utility.keymap.down)e.stopPropagation()})}Oe("about");if(TS.boot_data.feature_sli_channel_insights)if(_.invoke(TS,"client.ui.channel_insights.isEnabled")&&"channel"===TS.shared.getTypeForModelOb(t)&&tt){$(".channel_page_insights").removeClass("hidden");tt=false}};var be=function e(t){we();if(t.is_im)return;var i=t.id;var n=TS.notifs.isCorGMuted(i);var a=TS.ui.growls.checkPermission();var r=false===a&&TS.ui.growls.no_notifications;var s=false===a&&"denied"===TS.ui.growls.getPermissionLevel();var o=false===a&&TS.ui.growls.shouldShowPermissionButton();var c=TS.notifs.getCalculatedCorGNotifySetting(i);var _=TS.notifs.getCalculatedCorGPushNotifySetting(i);var u="everything"===c;var m="mentions"===c;var f="nothing"===c;var h="everything"===_;var g="mentions"===_;var p="nothing"===_;var S={model_ob:t,is_muted:n,desktop_notifs_enabled:a,notifications_impossible:r,notifications_not_allowed:s,notifications_not_yet_allowed:o,desktop_everything:u,desktop_mentions:m,desktop_nothing:f,push_everything:h,push_mentions:g,push_nothing:p};l.html(TS.templates.channel_page_notif_prefs(S));d.html(TS.templates.channel_page_notif_prefs_mute_state({is_muted:n}));Oe("notif_prefs")};var we=function e(){Oe("notif_prefs");l.empty()};var ye=function e(t){Ae();var i=t.pinned_items;var a=t.pinned_items_count;var r="";var s=false;if(T.pinned_items&&!qe(t)){Je(t);s=true}if(a>0)$("#pinned_items_title").text(TS.i18n.t("{pinned_items_count, plural, =1 {# Pinned Item} other {# Pinned Items}}","channel_pages")({pinned_items_count:a}));else $("#pinned_items_title").text(TS.i18n.t("Pinned Items","channel_pages")());if(!T.pinned_items)return;if(i&&i.length>0)i.forEach(function(e){if(e.file&&e.file.is_deleted)return;Ye(e);r+=TS.client.channel_page.pinnedItemHtml(e,t)});else if(!s)r=TS.templates.channel_page_empty_pinned_items({model_ob:t});else r=TS.templates.infinite_spinner({color:"white",size:"medium"});n.toggleClass("loading",!!s);r=TS.format.replaceHighlightMarkers(r);n.html(r);Oe("pinned_items");ke()};var ke=function e(){if(!_e())return;if(!T.pinned_items)return;TS.utility.rAF(function(){var e=n.find(".pinned_item");e.each(function(){var e=$(this);if("message"!==e.data("type"))return;var t=e.find(".pinned_message_text");var i=e.find(".pin_truncate_fade");if(t[0].scrollHeight>t[0].clientHeight+3)i.removeClass("hidden");else i.addClass("hidden")});e.find(".pinned_message_text").addClass("hide_scroll")})};var Ae=function e(){Oe("pinned_items");n.empty()};var Ce;var Me=function e(t){var i;var n;var a;var r;if(t.is_im)return;var s=Te(t);i=!s.counts;n=null;a=_.get(s,"counts.member_count");r=_.get(s,"counts.restricted_member_count");Ie(t,i,a,n,r)};var Ie=function e(t,i,n,r,s){xe();var o={model_ob:t,member_count:n,online_count:r,restricted_count:s,show_restricted_members:s>0,is_loading_members:i};a.html(TS.templates.channel_page_member_tabs(o))};var xe=function e(){a.empty()};var Ee=function e(t,i,n){var a;var r=[];var s=i||t.members;for(var o=0;o<s.length;o+=1){a=TS.members.getMemberById(s[o]);if(a)if(TS.boot_data.page_needs_enterprise){if(t.is_shared){if(!a.deleted)r.push(a)}else if(a.enterprise_user&&a.enterprise_user.teams&&a.enterprise_user.teams.length&&a.enterprise_user.teams.indexOf(TS.model.team.id)>-1)r.push(a)}else if(!a.deleted)r.push(a)}var l=TS.membership.getMembershipCounts(t);var d=_.get(l,"counts.member_count");if(d<=M)r.sort(TS.members.memberSorterByActiveWithBotsLast);var c={model_ob:t};if(_.isUndefined(n))n=d<=M;if(n)c.members=r;else{c.members=r.slice(0,I);c.show_more_members_link=true;c.total_member_count=d}c.show_channel_invite_link=TS.permissions.members.canUserInviteToChannel(t);c.all_members=r;return c};var $e=function e(t,i,n,a){var s=Ee(t,i,a);if(n)Pe();k.add(_.map(s.members,"id"));r.html(TS.templates.channel_page_member_lists(s));r.find("#see_all_members").on("click",function(e){e.preventDefault();TS.client.channel_page.members_dialog.show(t,s.all_members,s.total_member_count)});Oe("members");je()};var Be=function e(t,i){if(t.is_im)return;var n=TS.channels.backfills.isBackfilling(t.id);if(!i||n)Pe();if(!T.members)return;if(!i||n)r.addClass("loading").html(TS.templates.infinite_spinner({color:"white",size:"medium"}));if(n){TS.client.ui.rebuildMemberListToggle();return}var a=Math.max(I,M);var s={count:a,channels:[t.id],present_first:true,index:TS.members.shouldDisplayRealNames()?"users_by_realname":"users_by_name",filter:"everyone"};if(TS.boot_data.feature_localization)s.locale=TS.i18n.locale();var o=[TS.members.fetchAndUpsertMembersWithQuery(s)];var l=TS.membership.getMembershipCounts(t);if(l.promise)o.push(l.promise);Promise.all(o).then(function(e){var n=e[0];if(TS.shared.getActiveModelOb().id!==t.id)return;var a=TS.membership.getMembershipCounts(t);var r=_.get(a,"counts.member_count");var s=r<=M;var o=s?M:I;var l=_.map(n.objects,"id").slice(0,o);$e(t,l,i,s);return null}).catch(function(){if(TS.has_pri[et])TS.log(et,"Flannel error: failed to fetch all members for channel "+t.id);TS.logError("failed to fetch all members for channel "+t.id,"Flannel error");r.removeClass("loading");r.html('<div class="align_center subtle_silver">'+TS.i18n.t("Oops, something went wrong.","client")()+' <a href="#">'+TS.i18n.t("Try again","client")()+"</a></div>");r.find("a").click(function(i){i.preventDefault();e(t)})})};var De=function e(){var t=TS.shared.getActiveModelOb();var i=true;Be(t,i)};var Fe=_.throttle(De,E);var Pe=function e(){Oe("members");k.clear();We();r.empty()};var Oe=function e(i){var n=310;var a=t.find('.channel_page_section[data-section-name="'+i+'"]');var r=_.sum(a.children(":visible").map(function(e,t){return $(t).outerHeight(true)}).toArray());clearTimeout(a.data("animate"));if(T[i])a.css({"max-height":r,height:""}).data("animate",setTimeout(function(){if(T[i])a.css("max-height","none")},n));else a.css({"max-height":r,height:r}).data("animate",setTimeout(function(){a.css("max-height","").data("animate",setTimeout(function(){if(!T[i])a.css("height","")},n))},10))};var Re=function e(t){Ue();var i=false;var n="";var a;if(T.shared_files&&!Ze(t)){Xe(t);i=true}if(!T.shared_files)return;if(i)n=TS.templates.infinite_spinner({color:"white",size:"medium"});o.toggleClass("loading",!!i);if(n){o.html(n);Oe("shared_files");return}for(var r=0;r<TS.model.files.length;r+=1){a=TS.model.files[r];if(a.is_deleted)continue;if(R(a))if(v.length<y){v.push(a);n+=TS.templates.builders.fileHTML(a)}}if(v.length>=y)if(t.is_im){var s=TS.members.getPotentiallyUnknownMemberById(t.user);n+=TS.templates.channel_page_view_all_files_link({model_ob:t,member:s})}else n+=TS.templates.channel_page_view_all_files_link({model_ob:t});if(n)o.html(n);else o.html(TS.templates.channel_page_empty_shared_files({model_ob:t}));Oe("shared_files");je()};var Ue=function e(){Oe("shared_files");v=[];o.empty()};var Qe=null;var Le=function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled())return;He();if(TS.apps.isCurrentModelViewAnApp())return;if(!Qe)Ne();if(!T.apps)return;m.html(TS.templates.infinite_spinner({color:"white",size:"medium"}));Oe("apps");TS.apps.permissions.promiseToGenerateAppAndBotListForResource(t.id).then(function(e){Qe=e.length;Ne(Qe);m.html(TS.templates.channel_page_apps_list({apps:e}));Oe("apps")})};var He=function e(){Oe("apps");m.empty()};var Ne=function e(t){var i=t?TS.i18n.t("{app_count, plural, =1 {# App} other {# Apps}}","channel_pages")({app_count:t}):TS.i18n.t("Apps","channel_pages")();$("[data-js=channel_page_apps_title]").text(i)};var Ge=function e(t){if(!_e())return;if(!ue(t))return;Le(t)};var je=function e(){We();p=t.find(".lazy").lazyload({container:t});ze()};var We=function e(){if(p&&p.detachEvents){p.detachEvents();p=null}};var Ke;var ze=function e(){TS.utility.cancelRAF(Ke);Ke=TS.utility.rAF(function(){t.trigger("resize-immediate")})};var Ve=function e(t){var i;if("message"===t.type)i=n.find('.pinned_item[data-type="message"][data-ts="'+t.message.ts+'"]');else if("file"===t.type)i=n.find('.pinned_item[data-type="file"][data-file-id="'+t.file.id+'"]');else if("file_comment"===t.type)i=n.find('.pinned_item[data-type="file_comment"][data-comment-id="'+t.comment.id+'"]');return i};var Ye=function e(t){if("file_comment"!==t.type)return;var i=TS.files.getFileCommentById(t.file,t.comment.id);t.comment=i};var qe=function e(t){if(false===t.has_pins)return true;return TS.pins.havePinsBeenFetched(t)};var Je=function e(t){if(TS.pins.arePinsCurrentlyBeingFetched(t))return;TS.pins.fetchPins(t)};var Ze=function e(t){return!!b[t.id]};var Xe=function e(t){if(w[t.id])return;w[t.id]=true;TS.files.fetchChannelFiles(t.id,function(e){delete w[t.id];if(!e)return;b[t.id]=true},y)};var et=1989;var tt=true;var it=function e(t){if("channel"===TS.shared.getTypeForModelOb(t))if(TS.client.ui.channel_insights.last_details_response&&TS.client.ui.channel_insights.last_details_response.channel===t.id){u.html(TS.client.ui.channel_insights.renderInsightsSection(TS.client.ui.channel_insights.last_details_response.response));Oe("insights")}else{u.html(TS.client.ui.channel_insights.renderLoadingState());Oe("insights");TS.api.call("channels.insights",{channel:t.id,modules:"highlights,top_files,top_contributors,top_reaction_emojis,similar_channels,activity"}).then(function(e){return TS.client.ui.channel_insights.ensureChannelMemberCounts(e)}).then(function(e){u.html(TS.client.ui.channel_insights.renderInsightsSection(e));TS.client.ui.channel_insights.last_details_response={channel:t.id,response:e}}).catch(function(e){TS.error(e);u.html(TS.client.ui.channel_insights.renderEmptyState())})}else{u.html(TS.client.ui.channel_insights.renderEmptyState());Oe("insights")}};var nt=function e(){Oe("insights");if(u)u.html("")};var at=function e(){if(c)c.addClass("hidden")}})()},4401:function(e,t){(function(){"use strict";TS.registerModule("client.channel_page.members_dialog",{show:l,updateMembers:d,isShowing:o,test:function e(){var t={updateMembersInDialog:d};Object.defineProperty(t,"filterMembersInDialog",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(t,"getFilter",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(t,"members",{get:function e(){return i},set:function e(t){i=t}});return t}});var e;var t;var i;var n="all_members_dialog";function a(e){$(window.document).bind("keydown",r);var t=new TS.SearchableMemberList({$container:$("#channel_membership_dialog_container"),id:"channel_membership_dialog",model_ob_id:e.id,triggered_by_user_action:true});t.showInitial()}var r=function e(t){if(t.which==TS.utility.keymap.esc)if(""===TS.generic_dialog.div.find("input").val())TS.generic_dialog.cancel()};var s=function e(){TS.generic_dialog.cancel()};function o(){if(!TS.generic_dialog.is_showing)return false;return TS.generic_dialog.current_setting.dialog_class==n}function l(o,l,d){var c=TS.templates.channel_page_all_members_dialog();var u=TS.i18n.t("{member_count, number} members in {channel_name}","channel_pages")({member_count:_.isUndefined(d)?l.length:d,channel_name:TS.shared.getDisplayNameForModelOb(o)});i=l;TS.generic_dialog.start({dialog_class:n,title:u,body:c,cancel_button_text:TS.i18n.t("Close","channel_pages")(),hide_footer:true,show_cancel_button:true,show_go_button:false,backdrop_click_to_dismiss:true,onShow:function e(){a(o)},onEnd:function n(){var a=TS.SearchableMemberList.get("channel_membership_dialog");if(a)a.destroy();TS.generic_dialog.div.remove();TS.generic_dialog.div=void 0;e=void 0;t=void 0;i=void 0;TS.menu.member.member_item_click_sig.remove(s);$(window.document).unbind("keydown",r)}})}function d(e){if(!o())return;i=e;var t=c();var n=true;u(t,n)}function c(){var e=TS.generic_dialog.div.find("#all_members_filter input");return _.toString(e.val()).toLowerCase().trim()}function u(n,a){if(a)e=void 0;if(n&&n===e)return;if(t&&e&&n&&_.includes(n,e))t=TS.utility.members.filterMembersByQuery(t,n);else t=TS.utility.members.filterMembersByQuery(i,n);e=n;var r=true;var s=TS.generic_dialog.div.find("#all_members_container");s.longListView("setItems",t,r);s.toggleClass("invisible",!t.length);TS.generic_dialog.div.find("#all_members_no_matches").toggleClass("hidden",t.length>0);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(s)})}})()},4402:function(e,t){(function(){"use strict";TS.registerModule("ui.channel_browser",{onStart:function e(){TS.channels.list_fetched_sig.add(p);TS.view.members.unknown_resolution_rebuild_sig.add(S)},start:function e(){if(TS.model.user.is_ultra_restricted)return;if(TS.client.ui.checkForEditing())return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var t="channel_browser_show";var i="start_channel_browser_show";TS.metrics.mark(i);var n=TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups();var a;if(TS.model.user.is_restricted)a=TS.i18n.t("Browse channels","channel_browser")();else{var r;var s;r=_.reject(TS.redux.channels.dangerouslyGetChannelsForUser(),"is_archived").length;s=_.reject(TS.redux.channels.dangerouslyGetGroups(),"is_archived").length;a=TS.i18n.t("Browse all {channel_count, number} channels","channel_browser")({channel_count:r+s})}var o;var l;if(TS.model.ui_state){o=TS.model.ui_state.channel_browser_show_which_channels;l=TS.model.ui_state.sort_channel_browser_by}else{o="all";l="name"}var d=TS.templates.channel_browser({show_which_channels_selected:o,sort_by_selected:l,can_create:n,title:a});TS.ui.fs_modal.start({body_template_html:d,onShow:m,onEnd:h,modal_class:"fs_modal_internal_scroll"});TS.metrics.measureAndClear(t,i)},test:function e(){return{onShow:m,onEnd:h,channelsListFetched:p,filterList:w,sortChannels:C}}});var e=false;var t=false;var i=null;var n=null;var a;var r;var s;var o;var l;var d;var c;var u;var m=function t(){e=true;r=$("#channel_browser");s=r.find("#channel_list_container");o=r.find("#channel_browser_filter");l=r.find("#channel_browser_sort");u=r.find("#show_which_channels");c=$("#new_channel_container");x();if(TS.model.ui_state&&TS.model.ui_state.sort_channel_browser_by)l.find('option[value="'+TS.model.ui_state.sort_channel_browser_by+'"]').prop("selected",true);if(TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels)){if(b({},TS.model.ui_state.channel_browser_show_which_channels)){TS.model.ui_state.channel_browser_show_which_channels="all";TS.storage.storeUIState(TS.model.ui_state)}u.find('option[value="'+TS.model.ui_state.channel_browser_show_which_channels+'"]').prop("selected",true)}g();if(f()){a=false;TS.channels.fetchList()}else p()};var f=function e(){if(!a)return true;return _.some(TS.model.channels,function(e){return!e.is_member&&void 0==e.num_members})};var h=function a(){e=false;t=false;i=null;n=null;TS.kb_nav.end();if(r)r.remove();r=null;s=null;o=null;l=null;u=null;if(c)c.remove();c=null;E();TS.ui.new_channel_modal.end()};var g=function i(){var n={classes:"show_which_channels_selector",onItemAdded:function i(n){if(!e||!t)return;var a;var r;if(TS.useReactLFS())r=n.value;else{a=$(n);r=a.val()}if(TS.model.ui_state){TS.model.ui_state.channel_browser_show_which_channels=r;TS.storage.storeUIState(TS.model.ui_state)}if("archived"===r)if(TS.useReactLFS())f();else{l.lazyFilterSelect("update",_.toArray(l.children()).filter(function(e){return"members_low"!==e.value&&"members_high"!==e.value}));if("members_low"===TS.model.ui_state.sort_channel_browser_by||"members_high"===TS.model.ui_state.sort_channel_browser_by)l.lazyFilterSelect("setValue","name")}else if(TS.useReactLFS())f();else l.lazyFilterSelect("update");w(r)},template:function e(t){if(TS.useReactLFS())return t.label;var i=$(t);return new Handlebars.SafeString(i.text())},tokenTemplateSingle:function e(t){if(TS.useReactLFS())return TS.interop.lazyFilterSelect.channelBrowserShowWhichChannelsToken(t);var i=$(t);var n=TS.i18n.t('<span class="greigh">Show:</span> {value}',"channel_browser")({value:i.text()});return new Handlebars.SafeString(n)},listItemClass:function e(){return"capitalize"}};if(TS.useReactLFS()){var a=document.getElementById("show_which_channels_react");var c=TS.ui.lazy_filter_select.convertHTMLDataToRLFSData(u);n=_.assign({},n,{items:_.concat([],c),tokenTemplate:n.tokenTemplateSingle,single:true,styling:"small",onListShown:function e(){TS.ui.lazy_filter_select.is_list_open=true;TS.kb_nav.pause(true)},onListHidden:function e(){TS.ui.lazy_filter_select.is_list_open=false;TS.kb_nav.pause(false)}});TS.interop.mountLazyFilterSelect(a,n);u.hide()}else u.hide().lazyFilterSelect(n);var m={classes:"channel_browser_sort",onItemAdded:function i(n){if(!e||!t)return;var a;var r;if(TS.useReactLFS())r=n.value;else{a=$(n);r=a.val()}if(TS.model.ui_state){TS.model.ui_state.sort_channel_browser_by=r;TS.storage.storeUIState(TS.model.ui_state)}C(r);var s=null;if(TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels))s=TS.model.ui_state.channel_browser_show_which_channels;w(s)},template:function e(t){if(TS.useReactLFS())return t.label;var i=$(t);return new Handlebars.SafeString(i.text())},tokenTemplateSingle:function e(t){if(TS.useReactLFS())return TS.interop.lazyFilterSelect.channelBrowserSortByToken(t);var i=$(t);var n=TS.i18n.t('<span class="greigh">Sort:</span> {value}',"channel_browser")({value:i.text()});return new Handlebars.SafeString(n)}};function f(e){if(!e){e=TS.ui.lazy_filter_select.convertHTMLDataToRLFSData(l);if(TS.model.ui_state&&TS.model.ui_state.channel_browser_show_which_channels&&"archived"===TS.model.ui_state.channel_browser_show_which_channels){e=e.filter(function(e){return"members_low"!==e.value&&"members_high"!==e.value});if("members_low"===TS.model.ui_state.sort_channel_browser_by||"members_high"===TS.model.ui_state.sort_channel_browser_by)e=e.map(function(e){e.preselected="name"===e.value;return e})}}var t=document.getElementById("channel_browser_sort_react");$(t).html("");m=_.assign({},m,{items:_.concat([],e),tokenTemplate:m.tokenTemplateSingle,single:true,styling:"small"});TS.interop.mountLazyFilterSelect(t,m)}if(TS.useReactLFS()){f();l.hide()}else l.hide().lazyFilterSelect(m);s.on("click",".channel_browser_row",function(e){F($(this),e)});o.on("textchange",function(){if(!e||!t)return;var i=null;if(TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels))i=TS.model.ui_state.channel_browser_show_which_channels;w(i)}).on("keydown",function(e){if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()});d.on("click",".about_channels",function(e){e.preventDefault();TS.ui.fs_modal.close();setTimeout(function(){TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.channels,{ui_click:true}))},500)});r.on("click",".new_channel",B);r.on("click",".clear_filter_icon",function(){o.val("").trigger("textchange").focus()})};var p=function r(){a=true;if(!e||t)return;var d;var c;d=TS.redux.channels.dangerouslyGetChannelsForUser();c=TS.redux.channels.dangerouslyGetGroups();n=_.concat(d,c);n=_.reject(n,function(e){return e.is_mpim});if(TS.model.ui_state&&TS.model.ui_state.sort_channel_browser_by)C(TS.model.ui_state.sort_channel_browser_by);else C(l.val());i=n;s.empty();v();var u=null;if(TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels))u=TS.model.ui_state.channel_browser_show_which_channels;w(u);if(0===i.length)k();_.defer(function(){o.focus()})};var S=function e(i){if(!t)return;var n=function e(){s.longListView("getCurrentVisibleItemsInView").forEach(function(e){if(e.creator===i.id)s.longListView("itemUpdatedById",e.id)})};if(s.longListView("isScrolling"))s.longListView("getCurrentVisibleItemsInViewSignal").addOnce(n);else n()};var T=function e(t,i){var n=[];if(t.length>0){n.push({is_divider:true,name:TS.i18n.t("Channels you can join","channel_browser")()});n=n.concat(t)}if(i.length>0){n.push({is_divider:true,name:TS.i18n.t("Channels you belong to","channel_browser")()});n=n.concat(i)}return n};var v=function e(){s.longListView({items:i,approx_item_height:60,preserve_dom_order:true,approx_divider_height:35,pin_dividers:true,makeElement:function e(t){var i=$(TS.templates.channel_browser_row({is_shared:TS.boot_data.feature_shared_channels_client}));t.$icon=i.find(".channel_browser_type_icon");t.$name=i.find(".channel_browser_channel_name");t.$creator=i.find(".channel_browser_created_by");t.$date=i.find(".channel_browser_created_on");t.$purpose=i.find(".channel_browser_channel_purpose");t.$external_shared_channels_icon=i.find(".shared_channels_icon");t.$member_count=i.find(".channel_browser_member_count");t.$open=i.find(".channel_browser_open");t.$preview=i.find(".channel_browser_preview");t.$joined=i.find(".channel_browser_joined");t.$shared_channel_icon=i.find(".shared_channel_icon");t.$teams=i.find(".channel_browser_teams");return i},makeDivider:function e(){return $("<div>").addClass("channel_browser_divider")},renderItem:function e(t,i,n){if(TS.shared.isModelObOrgShared(i)){n.$shared_channel_icon.removeClass("hidden");n.$external_shared_channels_icon.addClass("hidden")}else if(TS.shared.isModelObShared(i)){n.$external_shared_channels_icon.removeClass("hidden");n.$shared_channel_icon.addClass("hidden")}else{n.$external_shared_channels_icon.addClass("hidden");n.$shared_channel_icon.addClass("hidden")}if(i.is_group)n.$icon.removeClass("ts_icon_channel_pane_hash ts_icon_archived_channel").addClass("ts_icon_lock");else if(i.is_archived)n.$icon.removeClass("ts_icon_lock ts_icon_channel_pane_hash").addClass("ts_icon_archived_channel");else n.$icon.removeClass("ts_icon_lock ts_icon_archived_channel").addClass("ts_icon_channel_pane_hash");n.$name.text(i.name);var a=s.longListView("isScrolling");var r=TS.members.getMemberById(i.creator,a);if(r){n.$creator.removeClass("hidden");n.$creator.find(".channel_browser_creator_name").text(TS.members.getPrefCompliantMemberName(r))}else n.$creator.addClass("hidden");n.$date.text(TS.interop.datetime.toCalendarDate(i.created));var o=I(i);n.$member_count.text(o);if(i.purpose&&i.purpose.value){var l=TS.utility.formatTopicOrPurpose(i.purpose.value);l=l.replace(/<a .*?>(.*?)<\/a>/g,"$1");n.$purpose.removeClass("hidden").html(l)}else n.$purpose.text("").addClass("hidden");var d=i.is_member||i.is_group;if(d){n.$open.removeClass("hidden");n.$preview.addClass("hidden");n.$joined.removeClass("hidden")}else{n.$open.addClass("hidden");n.$preview.removeClass("hidden");n.$joined.addClass("hidden")}if(i.is_group){t.removeClass("channel_link").removeAttr("data-channel-id");t.addClass("group_link").attr("data-group-id",i.id)}else{t.removeClass("group_link").removeAttr("data-group-id");t.addClass("channel_link").attr("data-channel-id",i.id)}if(TS.boot_data.feature_shared_channels_client&&TS.shared.isModelObShared(i)){var c=TS.templates.shared_channel_list_team_icon({model_ob:i});n.$teams.html(c);if(!n.$teams.parent().length)t.append(n.$teams)}else n.$teams.remove()},renderDivider:function e(t,i){t.text(i.name)},calcItemHeight:function e(t){return t.outerHeight()}});if(!TS.environment.supports_custom_scrollbar)s.monkeyScroll();t=true;TS.kb_nav.start(s.find(".list_items"),".channel_browser_row",s,{use_data_ordering:true,px_offset:35,scrollToStartImmediately:function e(){s.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){s.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){F($(this),e)})};var b=function e(t,i){if("all"===i)return!t.is_archived;if("local"===i)return!t.is_shared&&!t.is_archived;if("org_shared"===i)return t.is_org_shared&&!t.is_archived;if("ext_shared"===i)return t.is_shared&&!t.is_org_shared&&!t.is_archived;if("archived"===i)return t.is_archived;if("private"===i)return t.is_group&&!t.is_archived;return true};var w=function e(a){if(!a)a="all";var r="channel_browser_search";var l="start_channel_browser_search";TS.metrics.mark(l);var d=$.trim(o.val());var c;var u;if(""!==d)if(-1!==d.indexOf("#")){d=d.replace("#","","g");d=$.trim(d)}if(d){o.closest(".channel_browser_filter_container").addClass("active");i=y(n,d,a)}else{o.closest(".channel_browser_filter_container").removeClass("active");i=n.filter(function(e){return b(e,a)})}if("archived"!==a&&"private"!==a){var m=_.partition(i,function e(t){return t.is_member||t.is_group});u=m[0];c=m[1];i=T(c,u)}if(t)s.longListView("setItems",i);if(0===i.length)k(d);else A();s.scrollTop(0);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(s)});if(d)TS.kb_nav.highlightFirstItem();else TS.kb_nav.clearHighlightedItem();TS.metrics.measureAndClear(r,l)};var y=function e(t,i,n){if(!n)n="all";i=TS.i18n.deburr(TS.utility.regexpEscape(i)).toLocaleLowerCase();var a=new RegExp(i,"i");var r=-1;var s;var o=t.filter(function(e,t){var o=b(e,n);s=e.name_normalized||e.name.toLocaleLowerCase();if(s===i&&o){r=t;return false}var l=s.match(a);return l&&o});if(-1!==r)o.unshift(t[r]);return o};var k=function e(t){var i=$("#channel_browser_empty");var n=i.find(".channel_browser_empty_message");if(t)n.html(TS.i18n.t("No matches found for <strong>{query}</strong>","channel_browser")({query:TS.utility.truncateAndEscape(t,50)}));else n.text(TS.i18n.t("No channels","channel_browser")());i.removeClass("hidden")};var A=function e(){var t=$("#channel_browser_empty");t.addClass("hidden")};var C=function e(t){M(n,t)};var M=function e(t,i){var n=["name","creator","created","members_high","members_low"];var a="name";if(-1!==n.indexOf(i))a=i;if("name"===a)t.sort(function(e,t){if(e._name_lc>t._name_lc)return 1;if(t._name_lc>e._name_lc)return-1;return 0});else if("creator"===a)t.sort(function(e,t){var i;var n;i=TS.members.getMemberById(e.creator);n=TS.members.getMemberById(t.creator);if(i&&n){if(i._name_lc>n._name_lc)return 1;if(n._name_lc>i._name_lc)return-1;return 0}else if(i&&!n)return-1;else if(!i&&n)return 1;return 0});else if("created"===a)t.sort(function(e,t){if(e.created<t.created)return 1;if(t.created<e.created)return-1;return 0});else if("members_high"===a)t.sort(function(e,t){var i=I(e);var n=I(t);if(i<n)return 1;if(n<i)return-1;return 0});else if("members_low"===a)t.sort(function(e,t){var i=I(e);var n=I(t);if(i>n)return 1;if(n>i)return-1;return 0})};var I=function e(t){return t.num_members||_.get(t,"active_members.length")||0};var x=function e(){d=$(TS.templates.channel_browser_footer()).appendTo("#fs_modal")};var E=function e(){if(d)d.remove();d=null};var B=function e(){var t=$.trim(o.val());TS.ui.new_channel_modal.startInContainer(c,t);r.addClass("hidden");$("#fs_modal").removeClass("fs_modal_internal_scroll");c.removeClass("no_opacity");d.addClass("hidden");TS.ui.fs_modal.bindBackButton(D);TS.ui.fs_modal.showBackButton()};var D=function e(){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton();c.addClass("no_opacity");$("#fs_modal").addClass("fs_modal_internal_scroll");r.removeClass("hidden");d.removeClass("hidden");TS.ui.new_channel_modal.end();o.focus();if(t)s.longListView("resizeImmediately");TS.ui.utility.updateClosestMonkeyScroller(s)};var F=function e(t,i){if(t.hasClass("channel_link")){var n=t.data("channel-id");var a=TS.channels.getChannelById(n);if(a)TS.clog.track("CHANNELBROWSER_SELECT",{item_id:n,item_type:n.charAt(0),is_member:a.is_member});TS.view.onChannelReferenceClick(i,n)}else{var r=t.data("group-id");TS.clog.track("CHANNELBROWSER_SELECT",{item_id:r,item_type:r.charAt(0)});TS.view.onGroupReferenceClick(i,r)}TS.ui.fs_modal.close()}})()},4403:function(e,t){(function(){"use strict";TS.registerModule("ui.im_browser",{onStart:function e(){o=new TS.PresenceList},start:function e(t){t=t||{};if(TS.client.ui.checkForEditing())return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}l=!!t.is_admin_only_mode;m=t.submit_callback;r=[];s={};if(t.preselected_ids)t.preselected_ids.forEach(function(e){var t=TS.members.getMemberById(e);if(!t)return;if(t.is_self)return;if(t.deleted)return;if(t.is_slackbot)return;if(-1!==r.indexOf(t))return;r.push(t);s[t.id]=true});var i=TS.templates.im_browser({is_admin_only_mode:l,title:t.title,subtitle:t.subtitle,team_name:TS.model.team.name,preselected:r,reached_maximum:r.length===S});TS.ui.fs_modal.start({body_template_html:i,onShow:T,onEnd:v,modal_class:"fs_modal_internal_scroll"})},startWithMpim:function e(t,i){if(!t)return;var n=t.members.concat(i);TS.ui.im_browser.start({preselected_ids:n})},test:function e(){return{onShow:T,onEnd:v,getLastMsg:k}},getRecentDMList:function e(){return b()}});var e;var t;var i;var n;var a;var r;var s={};var o;var l=false;var d;var c;var u=false;var m=null;var f=null;var h=null;var g=64;var p=24;var S=8;var T=function i(){e=$("#im_browser");t=$("#im_list_container");if(!r)r=[];q();y();var n=e.find(".im_browser_go")[0];if(n)c=Ladda.create(n);t.on("click",".im_browser_row",function(e){if(0!==$(e.target).closest("a").length)return;Q($(this))});e.on("input","#im_browser_filter",function(){C()});e.on("keydown","#im_browser_filter",function(e){var t=$("#im_browser_filter").val();if(e.which===TS.utility.keymap.del&&""===t){H();return}if(e.which===TS.utility.keymap.enter&&""===t){e.preventDefault();if(!TS.kb_nav.getHighlightedItem())O();return}if(e.which===TS.utility.keymap.esc){TS.ui.fs_modal.close();return}if(r.length>=S)e.preventDefault()});e.on("focus","#im_browser_filter",function(){$("#im_browser_tokens").addClass("active")}).on("blur","#im_browser_filter",function(){$("#im_browser_tokens").removeClass("active")});e.on("click","#im_browser_tokens",function(e){var t=$(e.target).closest(".member_token");if(t.length)L(t);else{if($(e.target).closest("#im_browser_filter").length)return;$("#im_browser_filter").focus()}});e.on("click",".im_browser_go:not(.disabled)",function(){O()});e.on("click",".create_private_channel",function(e){e.preventDefault();J()});setTimeout(function(){$("#im_browser_filter").focus()},0)};var v=function d(){if(e)e.remove();e=null;t=null;i=null;n=null;l=false;a=null;r=null;s={};c=null;u=false;m=null;if(f)f.cancel();h=null;TS.kb_nav.end();TS.ui.new_channel_modal.end();o.clear()};var b=function e(){var t=TS.members.getActiveMembersWithSelfAndSlackbot();var i=TS.channels.getAllVisibleMpimsForUser();var n=t.map(function(e){return{id:e.id,model_ob:TS.ims.getImByMemberId(e.id),member:e}});var r=n;if(i&&i.length>0){var s=i.map(function(e){return{id:e.id,model_ob:e,members:TS.mpims.getMembersInDisplayOrder(e)}});r=n.concat(s)}r.sort(z);a=r;return a};var w=function i(){f=TS.searcher.search("",ne({initial:true}));f.then(function(i){var n=_.map(i.members,function(e){return{id:e.id,model_ob:TS.ims.getImByMemberId(e.id),member:e}});var r=_.map(i.mpims,function(e){return{id:e.id,model_ob:e,members:TS.mpims.getMembersInDisplayOrder(e)}});var s=_.concat(n,r);s.sort(z);a=s;t.longListView("setItems",a);e.addClass("showing_recent");e.removeClass("filter_active no_filter_matches");K()});return f};var y=function e(){var i;w();i=[];t.longListView({items:i,approx_item_height:g,preserve_dom_order:true,makeElement:function e(){return $('<div class="im_browser_row"></div>')},renderItem:function e(t,i){t.data("row_id",i.id);var n=i.model_ob;t.toggleClass("multiparty",!!(n&&n.is_mpim));t.toggleClass("disabled",!!s[i.id]);var a={item:i,model_ob:n,slackbot_msg:d};if(i.members){if(i.members.length>0)a.member_one=i.members[0];if(i.members.length>1)a.member_two=i.members[1]}else if(i.member&&i.member.is_self)a.is_self=true;a.secondary_name=null;if(n&&n.is_mpim)a.display_name=TS.mpims.getDisplayName(n);else if(TS.boot_data.feature_name_tagging_client){a.display_name=TS.members.getPrefCompliantMemberName(i.member);a.secondary_name=TS.members.getMemberSecondaryName(i.member);if(i.member.profile.title)a.title=i.member.profile.title}else{a.display_name=TS.members.getPrefCompliantMemberName(i.member);if(i.member.profile.title)a.title=i.member.profile.title;if(i.member.profile.real_name&&i.member.name!==i.member.profile.real_name)if(a.display_name===i.member.profile.real_name)a.secondary_name=i.member.name;else a.secondary_name=i.member.profile.real_name}var r="";var o="";var l=n&&k(n);var c;var u=false;if(l){var m=l.comment?TS.members.getMemberById(l.comment.user):TS.members.getMemberById(l.user);if(m){if(m.id===TS.model.user.id){r=TS.i18n.t("You","im_browser")()+": ";u=true}else{r=_.escape(A(m));r+=": "}if(l.file&&("file_share"===l.subtype||"file_mention"===l.subtype||"file_reaction"===l.subtype))c=ie(l);else{c=TS.format.formatNoHighlightsNoSpecialsNoInlineImgs(l.text,l);c=c.replace(/<a .*?>(.*?)<\/a>/g,"$1")}r+=c;if(u&&!n.is_slackbot_im)o+='<i class="ts_icon ts_icon_angle_arrow_up_left ts_icon_inherit"></i>';o+=TS.interop.datetime.toTimeAgo(l.ts)}}else if(n){var f=TS.shared.getLatestMsgTs(n);if(f)o+=TS.interop.datetime.toTimeAgo(f)}if(r)a.last_msg=new Handlebars.SafeString(r);if(o)a.last_msg_time=new Handlebars.SafeString(o);if(n&&n.unread_cnt>0){var h=i.model_ob.unread_cnt;if(h>10)h="9+";a.unread_cnt=h}t.html(TS.templates.im_browser_row(a))}});if(t.longListView("getCurrentItemsInView")){TS.utility.rAF(function(){var e=t.longListView("getCurrentItemsInView");o.clear();o.add(_.map(e,"id"))});t.longListView("getCurrentItemsInViewSignal").add(function(e){o.clear();o.add(_.map(e,"id"))})}if(!TS.environment.supports_custom_scrollbar)t.monkeyScroll();TS.kb_nav.start(t.find(".list_items"),".im_browser_row",t,{use_data_ordering:true,no_blur:true,scrollToStartImmediately:function e(){t.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){t.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){Q($(this));e.preventDefault()});if(r.length&&TS.boot_data.page_needs_enterprise)C();else W()};var k=function e(t){return TS.shared.getLastMsg(t)};var A=function e(t){if(TS.members.shouldDisplayRealNames())if(t.profile&&t.profile.first_name)return t.profile.first_name;return t.name};var C=function e(){var t=$("#im_browser_filter").val();return F(t)};var M=function e(){x();B()};var I=function e(){E();D()};var x=function e(){var t=document.getElementById("im_browser_spinner");if(t&&t.classList)t.classList.remove("hidden")};var E=function e(){var t=document.getElementById("im_browser_spinner");if(t&&t.classList)t.classList.add("hidden")};var B=function e(){if(!n){n=$("#monkey_scroll_wrapper_for_im_list_container");i=$("<div>",{class:"monkey_scroll_mask"});n.append(i);return}i.removeClass("hidden")};var D=function e(){if(i)i.addClass("hidden")};var F=function i(n){TS.metrics.mark("im_browser_search_start");h=n;M();if(f)f.cancel();var s=!!r.length;if(!n)TS.kb_nav.clearHighlightedItem();if(!n&&!s){var o=a;e.addClass("showing_recent");e.removeClass("filter_active no_filter_matches");t.longListView("setItems",o);t.scrollTop(0);if(0===o.length)W(n);else K();I();return}f=TS.searcher.search(n,ne());f.then(function(i){i=i.map(function(e){var t=e.model_ob;e.id=t.id;if(t.is_mpim)e.members=TS.mpims.getMembersInDisplayOrder(t);else e.member=t;return e});i=_(i).partition("model_ob.deleted").reverse().flatten().value();e.toggleClass("filter_active",!!n).removeClass("showing_recent");t.longListView("setItems",i);t.scrollTop(0);if(0===i.length){W(n);e.addClass("no_filter_matches");TS.kb_nav.clearHighlightedItem()}else{K();e.removeClass("no_filter_matches");if(n)TS.kb_nav.highlightFirstItem()}I();TS.metrics.measureAndClear("im_browser_search_searcher","im_browser_search_start")})};var P=function e(t){var i=r.every(function(e){return-1!==t.members.indexOf(e.id)});if(!i)return false;if(r.length===t.members.length-1)return false;var n=TS.mpims.getMembersInDisplayOrder(t);var a=n.some(function(e){if(-1!==r.indexOf(e))return false;return!e.is_self});if(!a)return false;return true};var O=function e(){if(!r.length)return;if(1===r.length){if(c)c.start();TS.ims.promiseToStartImByMemberId(r[0].id).then(function(){if(m)m.call();TS.ui.fs_modal.close();return null}).finally(function(){if(c)c.stop();return null});return}if(!TS.permissions.members.canCreateMpims())return;c.start();R(r,function(e){if(c)c.stop();if(!e.ok){if(e.error)TS.error("Could not open MPIM: "+e.error);return}if(m)m.call();TS.ui.fs_modal.close()})};var R=function e(t,i){var n=t.map(function(e){return e.id});n=n.join(",");var a="mpim.open";if(TS.boot_data.feature_shared_channels_beta)a="conversations.open";return TS.api.call(a,{users:n}).then(function(e){var t;if(e.data.channel)t=e.data.channel;else if(e.data.group)t=e.data.group;if(t.is_channel){t=TS.channels.upsertChannel(t);if(t.is_mpim)TS.channels.displayChannel({id:t.id});else TS.error("no mpim?!?")}else if(t.is_group){t=TS.mpims.upsertMpim(t);if(t)TS.mpims.displayMpim({id:t.id});else TS.error("no mpim?!?")}if(i)i(e.data);return null}).catch(function(){TS.error("failed to open the mpim");return null})};var U=function e(t){var i=t.data("row_id");if(TS.interop.utility.looksLikeMemberId(i))TS.ims.startImByMemberId(i);else TS.mpims.displayMpim({id:i});TS.ui.fs_modal.close()};var Q=function e(t){if(r.length===S)return;if(!TS.permissions.members.canCreateMpims())return U(t);var i=t.data("row_id");if(h)TS.ui.frecency.record({id:i},h);if(i===TS.model.user.id||"USLACKBOT"===i)return U(t);var n=[];if(TS.interop.utility.looksLikeMemberId(i)){var a=TS.members.getMemberById(i);if(!a)return;if(a.deleted)return U(t);if(-1!==r.indexOf(a))return;r.push(a);s[a.id]=true;n.push(a)}else{var o=TS.shared.getModelObById(i);if(!o.is_mpim)return;var l=TS.mpims.getMembersInDisplayOrder(o);if(_.some(l,"deleted")){U(t);return}l.forEach(function(e){if(-1!==r.indexOf(e))return;r.push(e);s[e.id]=true;n.push(e)})}N(n)};var L=function e(t){var i=t.data("member-id");var n=[];r=r.filter(function(e){if(i===e.id)n.push(e);return e.id!==i});delete s[i];N(n)};var H=function e(){if(!r.length)return;var t=r.pop();delete s[t.id];N([t])};var N=function i(n){G();if(r.length)e.find(".im_browser_go").removeClass("disabled");else e.find(".im_browser_go").addClass("disabled");if(r.length>=S)e.addClass("reached_maximum");else e.removeClass("reached_maximum");if(n)n.forEach(function(e){t.longListView("itemUpdatedById",e.id)});j();te();TS.kb_nav.clearHighlightedItem();t.longListView("resizeImmediately")};var G=function t(){var i=S;var n=Math.max(0,i-r.length);var a=e.find(".remaining_participant_hint");if(n)a.text(TS.i18n.t("You can add {num_remaining, plural, =1 {# more person} other {# more people}}","im_browser")({num_remaining:n}));else a.text(TS.i18n.t("You have reached the maximum number of participants","im_browser")())};var j=function t(){var i=$("#im_browser_filter").val();$("#im_browser_tokens").replaceWith(TS.templates.im_browser_tokens({members:r}));var n=$("#im_browser_filter");if(!i&&TS.boot_data.page_needs_enterprise)n.focus();else n.val("").trigger("input").focus();e.removeClass("filter_active")};var W=function e(t){var i=$("#im_browser_empty");var n=i.find(".im_browser_empty_message");if(t)n.html(TS.i18n.t("No one found matching <strong>{query}</strong>","im_browser")({query:TS.utility.truncateAndEscape(t,50)}));else n.empty();i.removeClass("hidden");$("#monkey_scroll_wrapper_for_im_list_container").addClass("hidden")};var K=function e(){var t=$("#im_browser_empty");t.addClass("hidden");$("#monkey_scroll_wrapper_for_im_list_container").removeClass("hidden")};var z=function e(t,i){var n=TS.shared.sorterByLastMsg(t.model_ob,i.model_ob);if(0!==n)return n;return V(t,i)};var V=function e(t,i){var n;var a;if(t.member)n=[t.member];else n=t.members||[];if(i.member)a=[i.member];else a=i.members||[];if(n.length!==a.length){if(1===n.length)return-1;if(1===a.length)return 1}return Y(n,a,0)};var Y=function e(t,i,n){var a=t[n];var r=i[n];if(a&&r){var s=TS.members.memberSorterByName(a,r);if(0!==s)return s;return e(t,i,n+1)}if(r)return-1;if(a)return 1;return 0};var q=function e(){var t=[TS.i18n.t("Yay! You’re here. What can I do for you?","im_browser")(),TS.i18n.t("Hello, What’s up?","im_browser")(),TS.i18n.t("How can I help today?","im_browser")(),TS.i18n.t("Hi hi! How can I help?","im_browser")(),TS.i18n.t("You’re here! What can I do to help?","im_browser")(),TS.i18n.t("You rang?","im_browser")()];d=t[Math.round(Math.random()*(t.length-1))]};var J=function t(){if(!TS.permissions.members.canCreateGroups())return;var i=$("#new_channel_container");var n=Object.keys(s);TS.ui.new_channel_modal.startInContainer(i,"",false,n);e.addClass("hidden");$("#fs_modal").removeClass("fs_modal_internal_scroll");i.removeClass("hidden");TS.ui.fs_modal.bindBackButton(Z);TS.ui.fs_modal.showBackButton()};var Z=function i(){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton();var n=$("#new_channel_container");n.addClass("hidden");$("#fs_modal").addClass("fs_modal_internal_scroll");e.removeClass("hidden");TS.ui.new_channel_modal.end();t.longListView("resizeImmediately");TS.ui.utility.updateClosestMonkeyScroller(t)};var X=function t(i){ee();e.prepend(i);e.addClass("showing_alert")};var ee=function t(){$("#im_browser_alert").remove();e.removeClass("showing_alert")};var te=function e(){if(u){ee();u=false}if(TS.model.user.is_restricted)return;if(r.length<2)return;var t=r.filter(function(e){return e.is_restricted});if(0===t.length)return;var i=1===t.length&&t[0];var n=i&&i.is_ultra_restricted;var a=TS.templates.im_browser_ra_alert({members:t,member:i,is_ura:n});X(a);u=true};var ie=function e(t){if(!t||!t.file)return"";var i=true;var n=TS.templates.builders.msgs.buildFileShareMetaText(t,i);var a=t.file;var r=a.title?a.title:a.name;return n+": "+r};var ne=function e(t){t=t||{};if(l){var i={members:{include_self:false,only_admins:true},limit:p};if(!t.initial)i.sort={frecency:true,allow_empty_query:true};return i}if(t.initial)return{members:{include_slackbot:true,include_self:true},mpims:true};var n=!!r.length;return{members:{include_slackbot:!n,include_self:!n,include_deleted:!n},mpims:true,limit:p,filter:function e(t){t.mpims=_.filter(t.mpims,P);return t},sort:{allow_empty_query:true}}}})()},4404:function(e,t){(function(){"use strict";TS.registerModule("ui.channel_invite_modal",{startInviteToChannelModal:function e(i,n){if(TS.isPartiallyBooted())return;var a=TS.shared.getModelObById(i);if(!a){TS.error("TS.ui.channel_invite_modal.startInviteToChannelModal no channel or group found with id "+i);return}t=a;n=n||[];u=n.map(function(e){m[e]=true;return TS.model.getMemberById(e)});var r={channel_name:a.name,is_private:!!a.is_group||!!a.is_private,is_shared:TS.shared.isModelObShared(a),is_org_shared:TS.shared.isModelObOrgShared(a),async_data:true,shared_team_ids:a.shared_team_ids,preselected:u};var s=TS.templates.channel_invite_modal(r);TS.ui.fs_modal.start({body_template_html:s,onShow:p,onEnd:S,modal_class:"fs_modal_internal_scroll"});if(TS.model.user.is_admin){var o=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('Or, <a class="do_admin_invite" data-channel-id="{channel_id}">invite a new person to your workspace</a>',"channel_modal")({channel_id:i}):TS.i18n.t('Or, <a class="do_admin_invite" data-channel-id="{channel_id}">invite a new person to your team</a>',"channel_modal")({channel_id:i});var l='<div class="channel_modal_footer">'+o+"</div>";$("#channel_invite_modal").append(l)}}});var e;var t;var i=true;var n=true;var a=false;var r;var s;var o;var l;var d;var c;var u=[];var m={};var f={};var h=TS.boot_data.feature_shared_channels_client?58:64;var g;var p=function i(){e=$("#channel_invite_modal");e.on("click",".no_create_channel",function(){n=false;v()});e.on("click",".yes_show_history",function(){n=true;v()});e.on("click",".do_admin_invite",function(){TS.ui.fs_modal.close();var e=$(this).data("channel-id");setTimeout(function(){TS.ui.admin_invites.start({initial_channel_id:e})},500)});if(t.is_channel)b()};var S=function _(){e=null;t=null;i=true;n=true;a=false;r=null;s=null;o=null;l=null;d=null;c=null;u=[];m={};if(f._searcher_p)f._searcher_p.cancel();f={};TS.kb_nav.end();$(window).off("resize",W)};var T=function e(){if(!u.length)return;if(n||t.is_channel){var i=t.is_group?"groups.invite":"channels.invite";_.chunk(Object.keys(m),30).forEach(function(e){TS.api.call(i,{channel:t.id,force:true,users:e.join(",")})});TS.ui.fs_modal.close()}else{if(o)o.start();var a=Object.keys(m);TS.groups.createChild(t.id,a,function(e,t){if(o)o.stop();if(!e){if(t&&"restricted_action"===t.error){var i=TS.i18n.t("You don’t have permission to create new private channels.","channel_modal")();if(!TS.permissions.members.canArchiveChannels())i=TS.i18n.t("You don’t have permission to archive channels.","channel_modal")();var n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Talk to your Workspace Owner.","channel_modal")():TS.i18n.t("Talk to your Team Owner.","channel_modal")();setTimeout(function(){TS.generic_dialog.alert("<p>"+i+"</p><p>"+n+"</p>")},500)}else alert("failed! "+t.error);return}TS.ui.fs_modal.close()})}};var v=function t(){$("#private_channel_invite_step_one").addClass("hidden");$("#channel_invite_container").removeClass("hidden");e.find(".channel_invite_filter_container").removeClass("hidden");b()};var b=function e(){I();j()};var w=function e(){k();C()};var y=function e(){A();M()};var k=function e(){var t=document.getElementById("channel_invite_spinner");if(t&&t.classList)t.classList.remove("hidden")};var A=function e(){var t=document.getElementById("channel_invite_spinner");if(t&&t.classList)t.classList.add("hidden")};var C=function e(){if(!c){c=$("#monkey_scroll_wrapper_for_channel_invite_container");d=$("<div>",{class:"monkey_scroll_mask"});c.append(d);return}d.removeClass("hidden")};var M=function e(){if(d)d.addClass("hidden")};var I=function t(){l=$("#channel_invite_container");l.longListView({items:[],approx_item_height:h,preserve_dom_order:true,makeElement:function e(){return $('<div class="channel_invite_row"></div>')},renderItem:function e(t,i){t.data("member-id",i.id);t.toggleClass("disabled",!!(m[i.id]||i.invite_exception_reason));t.html(TS.templates.channel_invite_member({member:i.member,invite_exception_reason:i.invite_exception_reason}))}});l.monkeyScroll();O();l.on("click",".channel_invite_row",function(e){U($(e.currentTarget))});e.on("keydown","#channel_invite_filter",function(e){var t=$(e.currentTarget).val();if(e.which===TS.utility.keymap.del&&""===t){L();return}if(e.which===TS.utility.keymap.enter&&""===t){if(!TS.kb_nav.getHighlightedItem())T();return}if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()}).on("input",function(e){K();E($(e.target).val().trim()).then(D).then(P)});e.on("focus","#channel_invite_filter",function(){$("#channel_invite_tokens").addClass("active")}).on("blur","#im_browser_filter",function(){$("#channel_invite_tokens").removeClass("active")});e.on("click","#channel_invite_tokens",function(e){var t=$(e.target).closest(".member_token");if(t.length)Q(t);else $("#channel_invite_filter").focus()});setTimeout(function(){TS.kb_nav.start(l.find(".list_items"),".channel_invite_row",l,{use_data_ordering:true,no_blur:true,scrollToStartImmediately:function e(){l.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){l.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){U($(this));e.preventDefault()});$("#channel_invite_filter").focus()});E("").then(D).then(P)};var x=function e(){if(!t.is_shared||!f||!f.include_org||!TS.model.enterprise||TS.model.enterprise_teams.length===f.org_team_ids.length)return Promise.resolve(false);var i={query:f.query,include_org:f.include_org,include_slackbot:f.include_slackbot,include_self:f.include_self,max_api_results:1,org_team_ids:_(TS.model.enterprise_teams).map("id").xor(f.org_team_ids).value()};return TS.members.promiseToSearchMembers(i).then(function(e){return Promise.resolve(!!e.num_found)})};var E=function e(i){w();var n=i;if("@"===i.charAt(0))n=i.substring(1);if(f.query!==n){f.query=n;if(TS.boot_data.feature_channel_invite_modal_cannot_join)f.include_org=!!TS.boot_data.page_needs_enterprise||!!t.is_shared;else f.include_org=!!t.is_shared;f.include_slackbot=false;f.include_self=false;f.not_member_of=[t.id];if(t.is_shared){var a;if(t.is_global_shared)a=_.map(TS.model.enterprise_teams,"id");else a=t.shared_team_ids||[];f.org_team_ids=a}f.scroll_mark=0;f.query_for_display=i;l.off("scroll.filter")}return TS.members.promiseToSearchMembers(f)};var B=function e(t,i,n){var a=_.map(n,"id");var r=i||TS.model.user.is_admin;if(TS.model.user.is_ultra_restricted&&!r)return Promise.resolve([]);return TS.membership.ensureChannelMembershipIsKnownForUsers(t.id,a).then(function(){var e=_(n).map(function(e){if(e.is_ultra_restricted)return;if(e.is_slackbot)return;if(e.is_self)return;if(e.deleted)return;if(e.is_app_user)return;if(!r&&e.is_restricted&&!t.is_group)return;var i=TS.membership.getUserChannelMembershipStatus(e.id,t);if(!i.is_member)if(TS.permissions.channels.canMemberJoinChannel(t,e))return e;if(TS.boot_data.feature_channel_invite_modal_cannot_join)return e;return}).compact().uniq().value();return e})};var D=function e(i){var n;var r;var s=[];s.push(B(t,true,i.items));if(!TS.model.user.is_admin)s.push(B(t,false,i.items));return Promise.all(s).then(function(t){if(t.length){n=t[0];if(2===t.length)r=t[1];else r=n}a=r.length!=n.length;O();if(!i.query);if(r.length!=i.items.length){i.num_new-=i.items.length-r.length;i.items=r}if(!i.num_new&&i.num_found&&i.num_remaining)return E(i.query).then(e);return Promise.resolve(i)})};var F=function e(t){if(!g){var i=TS.frecency&&TS.frecency.getExisting("jumper");g=i&&i.getMostCommon()}if(!g){TS.warn("WTF no frecency module? Sorting alphabetically.");t.sort(function e(t,i){if(t.name<i.name)return 1;if(t.name>i.name)return-1;return 0});return t}_.each(t,function(e){var t=_.find(g,{id:e.id});e.score=t&&parseInt(t.score,10)||0});t.sort(function e(t,i){if(t.score<i.score)return 1;if(t.score>i.score)return-1;return 0});return t};var P=function e(i){var n=i.items.map(function(e){if(!TS.boot_data.feature_channel_invite_modal_cannot_join)return{id:e.id,member:e};var i=TS.membership.getUserChannelMembershipStatus(e.id,t);var n=i.is_member;var a;var r;if(n)r=false;else r=TS.permissions.channels.canMemberJoinChannel(t,e);if(n)a=TS.i18n.t("(Already in this channel)","channel_modal")();else if(!r){var s=_.get(e,"enterprise_user.teams",[]);if(-1===s.indexOf(TS.model.team.id))a=TS.i18n.t("(Not a member of this workspace)","channel_modal")();else a=TS.i18n.t("(Cannot join this channel)","channel_modal")()}return{id:e.id,member:e,invite_exception_reason:a}});if(TS.boot_data.feature_channel_invite_modal_cannot_join){var a=[];var r=[];_.each(n,function(e){if(e.invite_exception_reason)r.push(e);else a.push(e)});r=F(r);a=F(a);n=a.concat(r)}l.longListView("setItems",n);if(i._is_new)l.scrollTop(0);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(l)});if(i._is_new)l.on("scroll.filter",function(){var t=l.scrollTop()+l.height()+h;if(t<=i.scroll_mark)return;var n=l.find(".list_items").height();if(t>n&&f._searcher_p&&f._searcher_p.isResolved()){E(i.query).then(D).then(e);i.scroll_mark=t}});if(n.length){G();y()}else return x().then(function(e){N(i.query_for_display,e);y()});if(i.query&&"@"!==i.query&&0!==n.length){if(i._is_new)TS.kb_nav.highlightFirstItem()}else TS.kb_nav.clearHighlightedItem()};var O=function t(){if(a)if(!e.find(".ra_not_appear_warning").length){var i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Multi-channel guests may not appear below. Ask a Workspace Admin to invite them.","channel_modal")():TS.i18n.t("Multi-channel guests may not appear below. Ask a Team Administrator to invite them.","channel_modal")();var n='<p class="mini subtle_silver no_bottom_margin ra_not_appear_warning">'+i+"</p>";e.find(".kb_nav_label").after(n)}};var R=function e(){var t=$("#channel_invite_filter");var i=t.val();$("#channel_invite_tokens").replaceWith(TS.templates.channel_invite_tokens({members:u,async_data:true}));t=$("#channel_invite_filter");if(!i)t.focus();else t.val("").trigger("input").focus()};var U=function e(t){var i=t.data("member-id");var n=[];var a=TS.members.getMemberById(i);if(!a)return;if(TS.boot_data.feature_channel_invite_modal_cannot_join&&t.hasClass("disabled"))return;if(m[i])return;u.push(a);m[i]=true;n.push(a);H(n)};var Q=function e(t){var i=t.data("member-id");var n=_.remove(u,function(e){return e.id===i});delete m[i];H(n)};var L=function e(){if(!u.length)return;var t=u.pop();delete m[t.id];H([t])};var H=function t(i){if(i)i.forEach(function(e){l.longListView("itemUpdatedById",e.id)});R();K();e.find(".invite_go").toggleClass("disabled",!u.length);l.longListView("resizeImmediately")};var N=function e(n,a){var r=$("#filter_invite_empty");var s=r.find(".filter_invite_empty_message");if(i)if(n){var o={query:n};if(t.is_shared&&a){var l;if(t.is_global_shared)l=_.map(TS.model.enterprise_teams,"name");else l=_.map(t.shared_team_ids,function(e){var t=TS.enterprise.getTeamById(e);return t.name});o.teams=l}s.html(TS.templates.channel_invite_no_results(o))}else s.empty();else s.html(TS.templates.channel_invite_no_results());r.removeClass("hidden");$("#monkey_scroll_wrapper_for_channel_invite_container").addClass("hidden")};var G=function e(){var t=$("#filter_invite_empty");t.addClass("hidden");$("#monkey_scroll_wrapper_for_channel_invite_container").removeClass("hidden")};var j=function t(){var i=$("#channel_invite_container");if(r){var n=i.find(".lfs_input_container");n.wrap("<div></div>");n.attr("style","max-width: 85%").addClass("inline_block").addClass("no_padding");n.after(TS.templates.channel_modal_go_button({class_name:"invite_go",label:TS.i18n.t("Invite","channel_modal")()}))}K();var a=e.find(".invite_go");o=Ladda.create(a[0]);a.on("click",T)};var W=function e(){$("#channel_invite_container").lazyFilterSelect("recomputeHeight")};var K=function t(){var i=$("#channel_invite_container");if(r){var n=r.lazyFilterSelect("value");var a=i.find(".enter_to_go_label");if(s.val())a.addClass("hidden");else if(n&&n.length>0)a.removeClass("hidden");else a.addClass("hidden")}else{var o=e.find(".return_hint");if($("#channel_invite_filter").val())o.addClass("hidden");else if(u.length)o.removeClass("hidden");else o.addClass("hidden")}}})()},4405:function(e,t){(function(){"use strict";TS.registerModule("ui.prefs_dialog",{onStart:function e(){G();TS.client.login_sig.add(b);TS.prefs.sidebar_theme_changed_sig.add(ue);TS.prefs.dtop_notif_changed_sig.add(te);TS.prefs.read_changed_sig.add(de);TS.prefs.display_real_names_override_changed_sig.add(re);TS.prefs.team_display_real_names_changed_sig.add(re);TS.prefs.tz_changed_sig.add(pe);if(TS.boot_data.feature_localization)TS.prefs.locale_changed_sig.add(Se);TS.members.changed_tz_sig.add(ge);TS.team.team_plan_changed_sig.add(he);a=TS.qs_args.prefs_last_section||a;TS.prefs.email_alerts_changed_sig.add(te);TS.prefs.push_changed_sig.add(te);te=_.throttle(te,1e3);TS.prefs.time24_changed_sig.add(Z)},start:function e(t,i){w(t,i)}});var e=false;var t=null;var i=null;var n=null;var a="notifications";var r=null;var s=0;var o=false;var l=false;var d=false;var c=false;var u=false;var m=false;var f=[];var h="validation_error";var g;var p;var S;var T;var v=false;var b=function e(){l=TS.model.mac_ssb_version&&TS.model.mac_ssb_version>=.32||TS.model.win_ssb_version&&TS.model.is_mac;d=TS.model.win_ssb_version&&TS.model.is_win;c=TS.model.lin_ssb_version&&TS.model.is_lin;o=TS.model.prefs.sidebar_theme&&("custom_theme"===TS.model.prefs.sidebar_theme||"cotton_theme"===TS.model.prefs.sidebar_theme||"eco_theme"===TS.model.prefs.sidebar_theme);v=TS.boot_data.feature_react_sidebar&&TS.boot_data.feature_sli_channel_priority&&""!==TS.model.team.plan;if(TS.environment.isSSBAndAtLeastVersion("2.8.0")&&TS.boot_data.feature_configurable_spellchecker)u=true};var w=function s(o,_){o=o||a;if(!TS.model.ms_logged_in_once||!TS.model.prefs||$("body").hasClass("loading")||TS.ui.fs_modal.is_showing)return;if(!r)r=TS.templates.prefs_nav({show_mac_ssb_prefs:l,show_win_ssb_prefs:d,show_lin_ssb_prefs:c,show_labs_prefs:TS.boot_data.feature_tinyspeck});e=true;var u={title:y(),body_template_html:"",sidebar_html:r,onShow:k,onCancel:A,modal_class:"fs_modal_header fs_modal_sidebar prefs_modal"};u.onGo=De;TS.ui.fs_modal.start(u);t=$("#fs_modal");i=t.find(".contents");n=$("#fs_modal_sidebar");n.find("a").on("click",function(){C($(this).data("section"))});if(!TS.environment.supports_custom_scrollbar)t.find(".contents_container").monkeyScroll();g=be();S={};C(o);if(_)setTimeout(function(){t.find(_).scrollintoview({offset:"bottom",px_offset:-100}).highlight()},1e3);x();$("#col_channels").addClass("prefs_open")};var y=function e(){return TS.i18n.t("Your preferences for {team_name}","prefs")({team_name:TS.model.team.name})};var k=function e(){};var A=function a(){$("#col_channels").removeClass("prefs_open");f=[];e=false;t=null;i=null;n.find("a").off("click");n=null};var C=function e(r){if(m)_e();var s=M(r);a=r;n.find("a").removeClass("is_active").end().find('a[data-section="'+r+'"]').addClass("is_active");i.html(s);I(r);setTimeout(function(){if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(i);t.find(".contents_container").scrollTop(0)},0);m="sidebar"===r;if("notifications"===r)_.each(f,function(e){ee(e)})};var M=function e(t){var i;var n={};switch(t){case"notifications":var a=TS.model.prefs.highlight_words||"";a=a.replace(/,/g,", ").replace(/ {2}/g," ");n={notification_sounds:TS.boot_data.notification_sounds,member:TS.model.user,highlight_words:a,team_prefs:TS.model.team.prefs,time24:TS.model.prefs.time24,show_mac_ssb_prefs:l,show_win_ssb_prefs:d,has_tz:!!TS.model.prefs.tz,tz_guess:!TS.model.prefs.tz&&F()};n.new_msg_snd_label=Te(TS.model.prefs.new_msg_snd);i=TS.templates.prefs_notifications_new(n);break;case"win_ssb":case"lin_ssb":i=TS.templates.prefs_win_lin_ssb({show_lin_ssb_prefs:c,show_auto_launch_pref:TS.environment.isSSBAndAtLeastVersion("2.8.0")||!TSSSB.call("isAppStoreBuild")});break;case"language_region":n={user_locale:TS.i18n.locale(),languages:TS.model.prefs.locales_enabled,timezones:window.timezones_list(),user_tz:TS.model.user.tz};i=TS.templates.prefs_language_region(n);break;case"messages_media":var r="";if(TS.model.prefs.preferred_skin_tone&&"1"!==TS.model.prefs.preferred_skin_tone)r=":skin-tone-"+TS.model.prefs.preferred_skin_tone+":";n={inline_img_byte_limit:TS.model.inline_img_byte_limit,clean_theme:"light_with_avatars"===TS.model.prefs.messages_theme,compact_theme:"dense"===TS.model.prefs.messages_theme,thumbs_up_name_with_skin_tone_modifier:":thumbsup:"+r,should_use_local_lato_2:TS.boot_data.should_use_local_lato_2,messages_theme:TS.model.prefs.messages_theme,show_time24_pref:!TS.boot_data.feature_localization||"en-US"===TS.i18n.locale(),enable_email_forwarding:TS.boot_data.feature_email_forwarding&&!TS.model.user.is_restricted&&!TS.model.user.is_ultra_restricted};i=TS.templates.prefs_messages_media(n);break;case"sidebar":if(TS.model.prefs.sidebar_theme_custom_values&&"undefined"!==TS.model.prefs.sidebar_theme_custom_values){n.theme=JSON.parse(TS.model.prefs.sidebar_theme_custom_values);n.show_customization_ui=o;n.show_customization_ui=o}n.show_separate_shared_channels_pref=TS.boot_data.feature_shared_channels_client&&TS.boot_data.feature_react_sidebar;n.cmd_key=TS.model.is_mac?TS.i18n.t("Cmd","keys")():TS.i18n.t("Ctrl","keys")();n.cmd_key_label=TS.model.is_mac?TS.i18n.t("Command","keys")():TS.i18n.t("Control","keys")();n.is_app_space_enabled=TS.apps.isAppSpaceEnabled()&&TS.boot_data.feature_i18n_app_space;n.show_sidebar_sort_pref=v;i=TS.templates.prefs_sidebar(n);break;case"search":i=TS.templates.prefs_search(le());break;case"read_state_tracking":i=TS.templates.prefs_read_state_tracking({short_key_name:TS.model.is_mac?"Option":"Alt"});break;case"a11y":i=function(){var e=TS.model.is_electron&&(TSSSB.env.mac_ssb_version>2.5||2.5===TSSSB.env.mac_ssb_version&&2===TSSSB.env.mac_ssb_version_minor||TSSSB.env.lin_ssb_version>2.5||2.5===TSSSB.env.lin_ssb_version&&2===TSSSB.env.lin_ssb_version_minor||TSSSB.env.win_ssb_version>2.5||2.5===TSSSB.env.win_ssb_version&&2===TSSSB.env.win_ssb_version_minor);n={zoom_pref_enabled:TSSSB.supports_zoom_api,zoom_pref_70_supported:e};return TS.templates.prefs_a11y(n)}();break;case"advanced":var s=false;var m="";var f=[];if(TS.model.is_our_app){s=window.TSSSB&&TSSSB.call("hasPreference","PrefSSBFileDownloadPath");if(TSSSB.env.mac_ssb_version&&TSSSB.env.mac_ssb_version<2)s=false;if(s)m=TSSSB.call("getPreference","PrefSSBFileDownloadPath");if(u)f=window.desktop.spellCheckingHelper.getDictionaries()}n.show_app_download_path=s;n.app_download_path=m;n.show_language_select=u;n.available_dictionaries=f;n.show_console_whitelist=true;var h=_.get(TS.model.prefs,"client_logs_pri","");n.user_facing_pris=_(Object.keys(TS.boot_data.client_logs)).filter(function(e){var t=TS.boot_data.client_logs[e];var i=true;if(!_.isUndefined(t.features)){var n=t.features;if(!_.isArray(t.features))n=n.split(",");var a=0;n.forEach(function(e){if(0!==e.indexOf("feature_"))e="feature_"+e;if(TS.boot_data[e])a+=1});i=a===n.length}return!_.isUndefined(t.user_facing)&&t.user_facing&&i}).map(function(e){var t=_.merge({},TS.boot_data.client_logs[e]);t.selected=h.indexOf(e)>-1;if(t.name)t.name=t.name.replace(/[_-]/g," ");return t}).value();n.client_logs_pri_all_selected=h.indexOf("all")>-1;i=TS.templates.prefs_advanced(n);break;case"labs":n={show_electron_prefs:TS.model.is_electron};i=TS.templates.prefs_labs(n);break;default:TS.error("This isn't the Prefs HTML builder you're looking for: "+t);return}return i};var I=function e(t){switch(t){case"notifications":E();te();if(l){z();fe()}if(d)V();X();break;case"win_ssb":case"lin_ssb":q();J();break;case"language_region":O();break;case"messages_media":R();re();$("#dont_obey_inline_img_limit_cb").prop("disabled",!TS.model.prefs.expand_inline_imgs);break;case"sidebar":W();ue();ce();break;case"search":U();break;case"read_state_tracking":Q();de();break;case"a11y":L();break;case"advanced":j();break;case"labs":K();break;default:TS.error("This isn't the Prefs UI binding you're looking for: "+t)}};var x=function e(){i.on("change",'input[type="checkbox"][data-inline-saver], input[type="radio"][data-inline-saver], input[type="file"], select[data-inline-saver]',function(){TS.ui.inline_saver.show({target:$(this).data("inline-saver")})});var t=1e3;i.on("input",'input[type="text"][data-inline-saver], textarea[data-inline-saver]',TS.utility.debounce(function(){var e=$(this);if(e.hasClass(h))return;TS.ui.inline_saver.show({target:e.data("inline-saver")})},t))};var E=function e(){$(".growls_stuff").addClass("hidden");$("#growls_permission_link").on("click",ae);$("#growls_test").on("click",function(){TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("What do you know? It works.","prefs")())}).addClass("hidden");if(TS.ui.growls.shouldShowPermissionButton())$("#growls_permission_div").removeClass("hidden");else if(TS.ui.growls.checkPermission()){$("#growls_allowed_div").removeClass("hidden");$("#growls_test").removeClass("hidden")}else if(TS.ui.growls.no_notifications)$("#growls_impossible_div").removeClass("hidden");else if("denied"===TS.ui.growls.getPermissionLevel())$("#growls_disallowed_div").removeClass("hidden");$('input:radio[name="notifications_rd"]').on("change",function(){var e=$(this).val();TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{desktop_notifications:e.toString()}});var t={};if("all"===e){t.all_channels_loud=true;t.growls_enabled=true}else if("mentions"===e){t.all_channels_loud=false;t.growls_enabled=true}else{t.all_channels_loud=false;t.growls_enabled=false}if(!g){if("all"===e)e="everything";else if("mentions"===e)e="mentions";else if("never"===e)e="nothing";_.assign(t,ye(e))}_.assign(TS.model.prefs,t);TS.prefs.setMultiPrefsByAPI(t);TS.prefs.dtop_notif_changed_sig.dispatch()});$("#no_text_in_notifications_cb").on("change",function(){var e=!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"no_text_in_notifications",value:e});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{no_text_in_notifications:e.toString()}})});var i;$('input:radio[name="sound_option_rd"]').on("change",function(){i=$(this).val();TS.sounds.play(i,{ignore_mute:true});TS.prefs.setPrefByAPI({name:"new_msg_snd",value:i})});$(".sound_option").find("ts-icon").on("click",function(e){i=$(this).siblings("input").val();TS.sounds.play(i,{ignore_mute:true});e.preventDefault();e.stopPropagation()});$("#mute_sounds_cb").prop("checked",true===TS.model.prefs.mute_sounds);$("#mute_sounds_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.mute_sounds=e;TS.prefs.setPrefByAPI({name:"mute_sounds",value:e});te();TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{mute_sounds:e.toString()}})});$("#threads_everything_cb").prop("checked",true===TS.model.prefs.threads_everything);$("#threads_everything_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.threads_everything=e;TS.prefs.setPrefByAPI({name:"threads_everything",value:e});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{threads_everything:e.toString()}})});var n=1e3;t.find("#highlight_words_input").on("input",TS.utility.debounce(oe,n));if(TS.model.win_ssb_version||TS.model.lin_ssb_version){var a=$("#highlight_words_input").attr("placeholder");var r=true;$("#highlight_words_input").on("textchange",function(){if($(this).val()&&r){$(this).attr("placeholder","");r=false}else if(!$(this).val()&&!r){$(this).attr("placeholder",a);r=true}})}$("#dnd_enabled").prop("checked",!!TS.model.prefs.dnd_enabled);$("#dnd_start_hour, #dnd_end_hour").prop("disabled",!TS.model.prefs.dnd_enabled).closest("label").toggleClass("disabled",!TS.model.prefs.dnd_enabled);var s=B();$("#dnd_enabled").on("change",function(){var e=$(this).is(":checked");if(e)$("#dnd_start_hour, #dnd_end_hour").prop("disabled",false).closest("label").removeClass("disabled");else $("#dnd_start_hour, #dnd_end_hour").prop("disabled",true).closest("label").addClass("disabled");s.dnd_enabled=e;TS.prefs.setMultiPrefsByAPI(s);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{dnd_enabled:e.toString()}})});var o=D($("#dnd_start_hour"),s.dnd_start_hour);o.prop("selected",true);var l=D($("#dnd_end_hour"),s.dnd_end_hour);l.prop("selected",true);$("#dnd_start_hour").on("change",function(){s.dnd_start_hour=$(this).val();TS.prefs.setMultiPrefsByAPI(s);$("#dnd_end_hour option").each(function(){return $(this).prop("disabled",false)});var e=D($("#dnd_end_hour"),s.dnd_start_hour);e.prop("disabled",true)});$("#dnd_end_hour").on("change",function(){s.dnd_end_hour=$(this).val();TS.prefs.setMultiPrefsByAPI(s);$("#dnd_start_hour option").each(function(){return $(this).prop("disabled",false)});var e=D($("#dnd_start_hour"),s.dnd_end_hour);e.prop("disabled",true)});o=D($("#dnd_start_hour"),s.dnd_end_hour);o.prop("disabled",true);l=D($("#dnd_end_hour"),s.dnd_start_hour);l.prop("disabled",true);$("#confirm_dnd_tz_guess").click(function(){if($(this).hasClass("disabled"))return;if(!window.timezones_guess)return;var e=window.timezones_guess();TS.prefs.setPrefByAPI({name:"tz",value:e});$(this).addClass("disabled")});$('#global_prefs_container [data-action="your_keywords_jump"]').click(function(e){e.preventDefault();$("#prefs_highlight_words").scrollintoview({offset:"bottom",px_offset:-100}).highlight()});$("#change_notification_sound").click(function(e){TS.menu.startWithSoundsMenu(e,function(e){TS.sounds.play(e,{ignore_mute:true});var t=TS.prefs.setPrefByAPI({name:"new_msg_snd",value:e});TS.ui.inline_saver.show({target:"#prefs_sounds_and_appearance",promise:t});var i=Te(e);$("#selected_new_msg_snd").text(i);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{new_msg_snd:e}})})});$("#new_msg_snd_none_cb").on("change",function(){var e=$(this).is(":checked");var t;if(e){t=S.new_msg_snd||"knock_brush.mp3";$("#selected_new_msg_snd").text(Te(t));$("#select_new_msg_snd").removeClass("hidden")}else{S.new_msg_snd=TS.model.prefs.new_msg_snd;t="none";$("#select_new_msg_snd").addClass("hidden")}TS.prefs.setPrefByAPI({name:"new_msg_snd",value:t});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{new_msg_snd:t}})});$("#email_alerts_cb").on("change",function(){var e=$(this).is(":checked");if(e)TS.model.prefs.email_alerts=S.email_alerts||"instant";else{S.email_alerts=TS.model.prefs.email_alerts;TS.model.prefs.email_alerts="none"}TS.prefs.setPrefByAPI({name:"email_alerts",value:TS.model.prefs.email_alerts});te();TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{email_alerts:TS.model.prefs.email_alerts}})});$("#change_email_alerts").on("click",function(e){TS.menu.startWithGeneric(e,[{value:"instant",label:TS.i18n.t("Once every 15 minutes","prefs")()},{value:"hourly",label:TS.i18n.t("Once an hour","prefs")()}],function(e){var t=TS.prefs.setPrefByAPI({name:"email_alerts",value:e});TS.ui.inline_saver.show({target:"#prefs_notifs_delay",promise:t});TS.model.prefs.email_alerts=e;te();TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{email_alerts:TS.model.prefs.email_alerts}})})});$("#mobile_specific_settings select").on("change",function(){var e=$(this).val();we(e);TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{mobile_notifications:e}})});$("#mobile_different_settings_cb").on("change",function(){g=$(this).is(":checked");$("#mobile_specific_settings").toggleClass("hidden",!g);if(!g&&be()){var e=TS.notifs.getGlobalNotificationSetting();we(e)}TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{use_different_mobile_settings:g.toString()}})});$("#push_idle_wait_select").on("change",function(){var e=$(this).val();var t=TS.prefs.setPrefByAPI({name:"push_idle_wait",value:e});TS.ui.inline_saver.show({target:"#prefs_notifs_delay",promise:t});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{push_idle_wait:e.toString()}})});$(".global_notification_block").on("click",function(e){if(e.isDefaultPrevented())return;if($(e.target).closest("label, input").length)return;$(this).find("input").prop("checked",true).trigger("change")});$("#channel_specific_overrides").on("click",'[data-action="reset_channel_to_defaults"]',function(e){var t=$(this).closest(".channel_overrides_row");var i=t.attr("data-cid");if(!i)return;e.preventDefault();Ie(i);Ae()});$("#channel_specific_overrides").on("click",'[data-action="open_channel_overrides"]',function(e){if(e.isDefaultPrevented())return;var t=$(this).attr("data-cid");if(!t)return;xe();$e(t)});$('#global_prefs_container [data-action="add_channel_override"]').on("click",function(){xe();Ee()});$("#channel_prefs_container").on("click",'[data-action="proceed_to_channel_options"]',function(){var e=$("#channel_override_picker").lazyFilterSelect("value")[0];var t=_.get(e,"model_ob.id");if(!t)return;$e(t)});$("#global_prefs_container").on("click",'[data-action="highlight_channel_overrides"]',function(e){e.preventDefault();$("#prefs_channel_overrides").scrollintoview({offset:"top",px_offset:50}).highlight()});if(TS.boot_data.feature_localization)$('#global_prefs_container [data-action="show_time_zone"]').on("click",function(e){e.preventDefault();var t=$(this).closest(".contents_container");var i=function e(){C("language_region");setTimeout(function(){$(".prefs_tz").highlight()},500)};if(0===t.scrollTop())i();else $(this).closest(".contents_container").animate({scrollTop:0}).queue(function(e){setTimeout(i,250);e()})})};var B=function e(){return{dnd_enabled:TS.model.prefs.dnd_enabled,dnd_start_hour:TS.model.prefs.dnd_start_hour||TS.model.team.prefs.dnd_start_hour||"22:00",dnd_end_hour:TS.model.prefs.dnd_end_hour||TS.model.team.prefs.dnd_end_hour||"08:00"}};var D=function e(t,i){var n=t.find("option").filter(function(){var e=$(this).attr("value");var t=e===i;if(!t)t=e==="0"+i;return t});if(!n.length){n=$('<option data-custom-time="true">');n.val(i);if(TS.utility.date.do24hrTime())n.text(i);else{var a=ne(i);n.text(a)}var r=t.find("option").filter(function(){var e=$(this).attr("value");return e>i});if(r.length)r.filter(":first").before(n);else t.append(n)}return n};var F=function e(){if(!window.timezones_guess||!window.timezones_list)return null;var t=window.timezones_guess();var i=window.timezones_list();var n=_.find(i,function(e){if(2===e.length)return e[1]===t;return false});if(n)return n[0];return null};var P=function e(t){TS.utility.disableElement($("#jumbomoji_cb"),t);$("#jumbomoji_pref").toggleClass("jumbomoji_pref_disabled",t)};var O=function e(){i.find('[name="lang"]').on("change",function(){var e=$(this).val();var t=TS.i18n.locale();var n=TS.i18n.localesEnabled()[e];if(e===t)return;TS.generic_dialog.start({title:TS.i18n.t("Change language to {lang}?","prefs")({lang:n}),body:"<p>"+TS.i18n.t("Are you sure you want to change the language you use with Slack?","prefs")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Change to {lang}","prefs")({lang:n}),onGo:function i(){if(e!==t){window.createCookie("i18n_locale",e,365,"slack.com");T=true;TS.prefs.setPrefByAPI({name:"locale",value:e},function(){TS.reload(null,"prefs dialog change: locale -> "+e)})}},onCancel:function n(){if(e!==t)i.find('[name="lang"]').val(t)}})});i.find('[name="tz"]').on("change",function(){var e=$(this).val();var t=TS.model.user.tz;if(e!==t)TS.prefs.setPrefByAPI({name:"tz",value:e})})};var R=function e(){$('input:radio[name="messages_theme_select"]').filter('[value="'+TS.model.prefs.messages_theme+'"]').prop("checked",true);$('input:radio[name="messages_theme_select"]').on("change",function(){$(".prefs_messages_theme_preview").toggleClass("hidden");var e=$(this).val();P("dense"===e);TS.prefs.setPrefByAPI({name:"messages_theme",value:e})});$("#show_typing_cb").prop("checked",true===TS.model.prefs.show_typing).removeClass("hidden");$("#show_typing_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"show_typing",value:!!$(this).prop("checked")})});$("#display_real_names_override_cb").on("change",function(){var e=!!$(this).prop("checked");var t;if(TS.model.team.prefs.display_real_names)t=e?0:-1;else t=e?1:0;TS.prefs.setPrefByAPI({name:"display_real_names_override",value:t})});$("#time24_cb").prop("checked",true===TS.model.prefs.time24);$("#time24_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"time24",value:!!$(this).prop("checked")});Z()});$("#hide_hex_swatch_cb").prop("checked",false===TS.model.prefs.hide_hex_swatch);$("#hide_hex_swatch_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"hide_hex_swatch",value:!e})});$("#load_lato_2_cb").prop("checked",true===TS.model.prefs.load_lato_2);$("#load_lato_2_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.load_lato_2=e;TS.prefs.setPrefByAPI({name:"load_lato_2",value:e},function(){TS.reload(null,"prefs dialog change: load_lato_2 -> "+e)})});$('input:radio[name="emoji_mode_select"]').filter('[value="'+TS.model.prefs.emoji_mode+'"]').prop("checked",true);$('input:radio[name="emoji_mode_select"]').on("change",function(){TS.prefs.setPrefByAPI({name:"emoji_mode",value:$(this).val()})});$("#jumbomoji_cb").prop("checked",true===TS.model.prefs.jumbomoji);$("#jumbomoji_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"jumbomoji",value:e});TS.prefs.onPrefChanged({name:"jumbomoji",value:e})});$("#convert_emoticons_cb").prop("checked",true===TS.model.prefs.convert_emoticons);$("#convert_emoticons_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"convert_emoticons",value:e})});$("#expand_internal_inline_imgs_cb").prop("checked",true===TS.model.prefs.expand_internal_inline_imgs);$("#expand_internal_inline_imgs_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"expand_internal_inline_imgs",value:!!$(this).prop("checked")})});$("#expand_inline_imgs_cb").prop("checked",true===TS.model.prefs.expand_inline_imgs);$("#expand_inline_imgs_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"expand_inline_imgs",value:e});TS.model.prefs.expand_inline_imgs=e;$("#dont_obey_inline_img_limit_cb").prop("disabled",!TS.model.prefs.expand_inline_imgs)});$("#dont_obey_inline_img_limit_cb").prop("checked",false===TS.model.prefs.obey_inline_img_limit);$("#dont_obey_inline_img_limit_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.obey_inline_img_limit=!e;TS.prefs.setPrefByAPI({name:"obey_inline_img_limit",value:!e})});$("#expand_non_media_attachments_cb").prop("checked",true===TS.model.prefs.expand_non_media_attachments);$("#expand_non_media_attachments_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"expand_non_media_attachments",value:!!$(this).prop("checked")})});if(TS.boot_data.feature_email_forwarding&&!TS.model.user.is_restricted&&!TS.model.user.is_ultra_restricted){var t=$(".prefs_modal");var i=$("#forwarding_address");Ladda.bind("#get_forwarding_email_cb");TS.api.call("users.emailtoken.get").then(function(e){return Promise.resolve(e.data.email_address)}).catch(function(){return Promise.resolve(false)}).then(function(e){$(".prefs_email_forwarding").replaceWith(TS.templates.prefs_email_forwarding({existing_forwarding_email:e}));i=$("#forwarding_address");if(e)i.select()});t.on("click","#get_forwarding_email_cb",function(){$("#get_forwarding_email_cb").removeClass("btn_outline");TS.api.call("users.emailtoken.create").then(function(e){Ladda.stopAll();$(".prefs_email_forwarding").replaceWith(TS.templates.prefs_email_forwarding({existing_forwarding_email:e.data.email_address}));i=$("#forwarding_address");i.select()})});t.on("focus, click","#forwarding_address",function(e){e.target.select()});t.on("click","#copy_forwarding_email_cb",function(e){TS.clipboard.writeText(TS.i18n.t("Send to Slack <{address}>","prefs")({address:i.val()}));TS.tips.updateTipTitle($(e.target),TS.i18n.t("Copied!","prefs"));$(e.target).mouseleave(function(){setTimeout(function(){TS.tips.updateTipTitle($(e.target),TS.i18n.t("Copy email address","prefs"))},500)});i.select()});t.on("click","#disable_forwarding_email_cb",function(e){e.preventDefault();TS.generic_dialog.start({title:TS.i18n.t("This address will be permanently deleted","prefs")(),body:TS.i18n.t("<p>The address <strong>{existing_forwarding_email}</strong> will no longer work. If you’d like, you can always request a new forwarding address.","prefs")({existing_forwarding_email:i.val()}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Disable Address","prefs")(),go_button_class:"btn_danger",onGo:function e(){TS.api.call("users.emailtoken.delete").then(function(){$(".prefs_email_forwarding").replaceWith(TS.templates.prefs_email_forwarding({existing_forwarding_email:false}));Ladda.bind("#get_forwarding_email_cb")})}})})}};var U=function e(){$("#search_channel_exclusion").lazyFilterSelect({placeholder_text:TS.i18n.t("Pick channels to exclude...","prefs")()}).on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"search_exclude_channels",value:e?e.join(","):""})}).hide()};var Q=function e(){$('input:radio[name="read_rd"]').on("change",function(){var e=$(this).val();TS.prefs.setReadStateTrackingPref(e);de()})};var L=function e(){var t=$("#a11y_animations");t.prop("checked",true===TS.model.prefs.a11y_animations);t.on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"a11y_animations",value:e})});H=TSSSB.call("getZoom");var i=TS.ui.a11y.zoomLevelToPercent(H);N(i);$('input:radio[name="a11y_font_size_select"]').on("change",function(){var e=$(this).val();H=TS.ui.a11y.zoomPercentToLevel(e);TSSSB.call("setZoom",H)})};var H;var N=function e(t){$('input:radio[name="a11y_font_size_select"]').filter('[value="'+t+'"]').prop("checked",true)};var G=function e(){if(!(TS.client&&TSSSB.supports_zoom_api))return;TS.ui.a11y.zoom_level_changed_sig.add(function(e){var t=e.zoom_level;var i=H==t;if(!i){H=t;N(TS.ui.a11y.zoomLevelToPercent(H))}var n=TS.ui.a11y.zoomLevelToPercent(t);var a="normal"===n?"100":n;var r=i?"PREF":"OTHER";var s={a11y_zoom_level:a,a11y_zoom_set_origin:r};TS.clog.track("PREF_USER_CLIENT_UPDATE",s)})};var j=function e(){$("#webapp_spellcheck_cb").prop("checked",true===TS.model.prefs.webapp_spellcheck).removeClass("hidden");$("#webapp_spellcheck_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"webapp_spellcheck",value:!!$(this).prop("checked")})});if(u){$("select#spellchecker_languages").prop("disabled",true!==TS.model.prefs.webapp_spellcheck);$("#webapp_spellcheck_cb").on("change",function(){$("select#spellchecker_languages").prop("disabled",!$(this).prop("checked"))});$("select#spellchecker_languages").on("change",function(){var e=null;if("automatic"!==$(this).val())e=$(this).val();TSSSB.call("setPreference",{name:"spellcheckerLanguage",value:e})})}if(!TS.boot_data.feature_name_tagging_client){$("#require_at_cb").prop("checked",true===TS.model.prefs.require_at).removeClass("hidden");$("#require_at_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"require_at",value:!!$(this).prop("checked")})})}$("#enter_is_special_in_tbt_cb").prop("checked",true===TS.model.prefs.enter_is_special_in_tbt);$("#enter_is_special_in_tbt_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"enter_is_special_in_tbt",value:!!$(this).prop("checked")})});$("#arrow_history_cb").prop("checked",true===TS.model.prefs.arrow_history);$("#arrow_history_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"arrow_history",value:e})});t.find('[data-action="select_ssb_download_path"]').on("click",function(){var e=TSSSB.call("getPreference","PrefSSBFileDownloadPath")||"";var i={type:"openDirectory",title:TS.i18n.t("Select a download location","prefs")(),defaultPath:e};TSSSB.call("showOpenDialog",{options:i,callback:function e(i){if(!i)return;var n=i[0];TSSSB.call("setPreference",{name:"PrefSSBFileDownloadPath",value:n});t.find("#app_download_path_input").val(n);TS.ui.inline_saver.show({target:t.find("#prefs_download_location")})}})});$("#pagekeys_handled_cb").prop("checked",true===TS.model.prefs.pagekeys_handled).removeClass("hidden");$("#pagekeys_handled_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"pagekeys_handled",value:!!$(this).prop("checked")})});$("#f_key_search_cb").prop("checked",true===TS.model.prefs.f_key_search).removeClass("hidden");$("#f_key_search_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"f_key_search",value:!!$(this).prop("checked")})});$("#k_key_omnibox_cb").prop("checked",true===TS.model.prefs.k_key_omnibox).removeClass("hidden");$("#k_key_omnibox_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"k_key_omnibox",value:!!$(this).prop("checked")})});if(TS.boot_data.feature_prev_next_button){$("#prev_next_btn").prop("checked",true===TS.model.prefs.prev_next_btn).removeClass("hidden");$("#prev_next_btn").on("change",function(){TS.prefs.setPrefByAPI({name:"prev_next_btn",value:!!$(this).prop("checked")})})}$("#ask_after_away_cb").prop("checked",true===TS.model.prefs.confirm_user_marked_away);$("#ask_after_away_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.confirm_user_marked_away=e;TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:e})});$("#enable_chan_suggestions").prop("checked",true===TS.model.prefs.overloaded_message_enabled);$("#enable_chan_suggestions").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"overloaded_message_enabled",value:e})});$("#allow_calls_to_set_current_status").prop("checked",true===TS.model.prefs.allow_calls_to_set_current_status);$("#allow_calls_to_set_current_status").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"allow_calls_to_set_current_status",value:e})});$("#ls_disabled_cb").prop("checked",true===TS.model.prefs.ls_disabled);$("#ls_disabled_cb").bind("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.ls_disabled=e;TS.storage.setDisabled(TS.model.prefs.ls_disabled);TS.prefs.setPrefByAPI({name:"ls_disabled",value:e},function(){TS.reload(null,"prefs dialog change: ls_disabled -> "+e)})});$("#ss_emojis_cb").prop("checked",true!==TS.model.prefs.ss_emojis);$("#ss_emojis_cb").bind("change",function(){var e=!$(this).prop("checked");TS.model.prefs.ss_emojis=e;TS.prefs.setPrefByAPI({name:"ss_emojis",value:e},function(){TS.reload(null,"prefs dialog change: ss_emojis -> "+e)})});$("#enhanced_debugging_cb").prop("checked",true===TS.model.prefs.enhanced_debugging);$("#enhanced_debugging_cb").bind("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.enhanced_debugging=e;TS.prefs.setPrefByAPI({name:"enhanced_debugging",value:e},function(){TS.reload(null,"prefs dialog change: enhanced_debugging -> "+e)})});$("#flannel_server_pool").val(TS.model.prefs.flannel_server_pool);$("#flannel_server_pool").on("change",function(){var e=$(this).val();var t=TS.model.prefs.flannel_server_pool;if(!_.includes(["production","canary","random"],e)){TS.error("Tried to set an invalid value ('"+e+"') for `flannel_server_pool` pref");return}TS.prefs.setPrefByAPI({name:"flannel_server_pool",value:e},function(){TS.log(1989,"Flannel: canary pref changed from "+t+" to "+e);if(TS.isSocketManagerEnabled())TS.interop.SocketManager.disconnect();else TS.ms.disconnect()})});$("#client_logs_pri").hide().lazyFilterSelect({placeholder_text:TS.i18n.t("Select logs to enable...","prefs")(),tokenClass:function e(){return"capitalize"},listItemClass:function e(){return"capitalize"}}).on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"client_logs_pri",value:e?e.join(","):""})});var i=Math.random();if("U024BE7LV"===TS.model.user.id)$("#emo_bear").attr("src","/img/emo_bear2.gif?"+i);else $("#emo_bear").attr("src","/img/emo_bear.gif?"+i);$("#surprise_me").on("change",function(){$("#surprise").fadeIn(150,function(){setTimeout(function(){$("#surprise").fadeOut(500,function(){i=Math.random();if("U024BE7LV"===TS.model.user.id)$("#emo_bear").attr("src","/img/emo_bear2.gif?"+i);else $("#emo_bear").attr("src","/img/emo_bear.gif?"+i);$("#surprise_me").prop("checked",false)})},2400)})});if(TS.boot_data.feature_show_jumper_scores){$("#show_jumper_scores").prop("checked",true===TS.model.prefs.show_jumper_scores);$("#show_jumper_scores").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"show_jumper_scores",value:e})})}};var W=function e(){$('input:radio[name="pr_sidebar"]').filter('[value="'+TS.model.prefs.sidebar_behavior+'"]').prop("checked",true);$('input:radio[name="pr_sidebar"]').on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"sidebar_behavior",value:e});TS.prefs.onPrefChanged({name:"sidebar_behavior",value:e})});if(TS.boot_data.feature_react_sidebar&&TS.boot_data.feature_sli_channel_priority){var i=$("#channel_sort_select");var n={default:"Alphabetically (default)",priority:"Scientifically (sorted based on how you use Slack)"};_.each(n,function(e,t){i.append('<option value="'+t+'">'+e+"</option>")});var a=_.get(n,TS.model.prefs.channel_sort)?TS.model.prefs.channel_sort:"default";i.val(a);i.on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"channel_sort",value:e});TS.prefs.onPrefChanged({name:"channel_sort",value:e})})}$("#separate_private_channels_cb").prop("checked",true===TS.model.prefs.separate_private_channels);$("#separate_private_channels_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"separate_private_channels",value:e})});$("#separate_shared_channels_cb").prop("checked",true===TS.model.prefs.separate_shared_channels);$("#separate_shared_channels_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"separate_shared_channels",value:e})});$("#enable_unread_view").prop("checked",true===TS.model.prefs.enable_unread_view);$("#enable_unread_view").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.seen_unread_view_coachmark=true;TS.prefs.setMultiPrefsByAPI({enable_unread_view:e,seen_unread_view_coachmark:true});TS.prefs.onPrefChanged({name:"enable_unread_view",value:e})});$("#no_omnibox_in_channels_cb").prop("checked",false===TS.model.prefs.no_omnibox_in_channels).removeClass("hidden");$("#no_omnibox_in_channels_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"no_omnibox_in_channels",value:!e})});t.find('input:radio[name="sidebar_theme_rd"]').on("change",function(){var e=$(this).val();var t=TS.sidebar_themes.default_themes[e];me(e,t)});t.find("input.color_hex").on("textchange",function(){var e=$.trim($(this).val());if(!e.match(TS.prefs.hex_regex)){clearTimeout(s);return}if(0!==e.indexOf("#"))e="#"+e;$(this).prev(".color_swatch").css("background-color",e).data("hex",e);clearTimeout(s);s=setTimeout(function(){var e="custom_theme";var i={column_bg:t.find('input[name="color_column_bg_hex"]').val(),menu_bg:t.find('input[name="color_menu_bg_hex"]').val(),active_item:t.find('input[name="color_active_item_hex"]').val(),active_item_text:t.find('input[name="color_active_item_text_hex"]').val(),hover_item:t.find('input[name="color_hover_item_hex"]').val(),text_color:t.find('input[name="color_text_color_hex"]').val(),active_presence:t.find('input[name="color_active_presence_hex"]').val(),badge:t.find('input[name="color_badge_hex"]').val()};$.each(i,function(e,t){if("#"!==t[0])i[e]="#"+t});me(e,i)},250)});t.find("#sidebar_theme_custom").on("textchange",function(){var e=$(this);setTimeout(function(){var t=$.trim(e.val());var i=t.replace(/ /g,"").split(",");var n=true;$.each(i,function(e,t){if(!t.match(TS.prefs.hex_regex))n=false});if(!n){clearTimeout(s);return}var a={column_bg:i[0],menu_bg:i[1],active_item:i[2],active_item_text:i[3],hover_item:i[4],text_color:i[5],active_presence:i[6],badge:i[7]};$.each(a,function(e,t){if("#"!==t[0])a[e]="#"+t});clearTimeout(s);s=setTimeout(function(){me("custom_theme",a)},250)},0)});t.find(".color_swatch").on("click.show_picker",function(e){e.stopPropagation();var i=$(this);var n=i.next("input");t.find(".color_swatch.selected").removeClass("selected").find(".colpick").addClass("hidden");var a=i.data("hex").replace("#","");i.colpick({flat:true,layout:"hex",color:a,submit:0,onChange:function e(a,r){i.css("background-color","#"+r).data("hex","#"+r);n.val("#"+r);clearTimeout(s);s=setTimeout(function(){var e="custom_theme";var i={column_bg:t.find('input[name="color_column_bg_hex"]').val(),menu_bg:t.find('input[name="color_menu_bg_hex"]').val(),active_item:t.find('input[name="color_active_item_hex"]').val(),active_item_text:t.find('input[name="color_active_item_text_hex"]').val(),hover_item:t.find('input[name="color_hover_item_hex"]').val(),text_color:t.find('input[name="color_text_color_hex"]').val(),active_presence:t.find('input[name="color_active_presence_hex"]').val(),badge:t.find('input[name="color_badge_hex"]').val()};me(e,i)},500)}}).colpickSetColor(a);t.on("click.hide_colpick",function(){t.find(".color_swatch.selected").removeClass("selected").find(".colpick").addClass("hidden")});i.addClass("selected").find(".colpick").removeClass("hidden")});$("#customize_theme_toggle").on("click",function(){$("#customize_theme_info").addClass("hidden");$("#prefs_themes_customize").removeClass("hidden");o=true})};var K=function e(){$("#full_text_extracts_cb").prop("checked",true===TS.model.prefs.full_text_extracts);$("#full_text_extracts_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.full_text_extracts=e;TS.prefs.setPrefByAPI({name:"full_text_extracts",value:e})});$("#msg_preview_cb").prop("checked",true===TS.model.prefs.msg_preview);$("#msg_preview_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"msg_preview",value:e});$("#msg_preview_persistent_cb").prop("disabled",!e);TS.prefs.onPrefChanged({name:"msg_preview",value:e})});$("#msg_preview_persistent_cb").prop("checked",true===TS.model.prefs.msg_preview_persistent);$("#msg_preview_persistent_cb").prop("disabled",!TS.model.prefs.msg_preview);$("#msg_preview_persistent_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"msg_preview_persistent",value:e});TS.prefs.onPrefChanged({name:"msg_preview_persistent",value:e})});$("#measure_css_usage_cb").prop("checked",true===TS.model.prefs.measure_css_usage);$("#measure_css_usage_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"measure_css_usage",value:e});TS.prefs.onPrefChanged({name:"measure_css_usage",value:e})});if(TS.model.is_electron){$("#show_memory_instrument_cb").prop("checked",true===TS.model.prefs.show_memory_instrument);$("#show_memory_instrument_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"show_memory_instrument",value:e});TS.prefs.onPrefChanged({name:"show_memory_instrument",value:e})})}$("#react_msg_pane_cb").prop("checked",true===TS.boot_data.feature_react_messages);$("#react_msg_pane_cb").on("change",function(){var e=!!$(this).prop("checked");var t=function t(){TS.prefs.setPrefByAPI({name:"use_react_messages",value:e}).then(function(){TS.reload()})};if(e)TS.generic_dialog.start({title:"Are you sure?",body:"The React Message Pane is a work in progress. You should not enable it unless you are prepared to put up with bugs. Are you sure you want to turn it on?",show_cancel_button:true,onGo:t,onCancel:function e(){$("#react_msg_pane_cb").prop("checked",false)}});else t()})};var z=function e(){$("#mac_ssb_bounce_cb").prop("checked",!!TS.model.prefs.mac_ssb_bounce);$("#mac_ssb_bounce_short_cb").prop("checked","long"!==TS.model.prefs.mac_ssb_bounce);$("#mac_ssb_bounce_cb").on("change",function(){var e=!!$(this).prop("checked");var t=!!$("#mac_ssb_bounce_short_cb").prop("checked");TS.model.prefs.mac_ssb_bounce="";if(e)TS.model.prefs.mac_ssb_bounce=t?"short":"long";TS.prefs.setPrefByAPI({name:"mac_ssb_bounce",value:TS.model.prefs.mac_ssb_bounce});fe()});$("#mac_ssb_bounce_short_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"mac_ssb_bounce",value:e?"short":"long"})});$("#mac_ssb_bullet_cb").prop("checked",true===TS.model.prefs.mac_ssb_bullet);$("#mac_ssb_bullet_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"mac_ssb_bullet",value:e})})};var V=function e(){if(window.TSSSB&&TSSSB.call("hasPreference","windowFlashBehavior")){Y();$("#winssb_flash_window_cb").on("change",function(){var e=$(this).is(":checked");var t=e?"always":"never";TSSSB.call("setPreference",{name:"windowFlashBehavior",value:t});Y()});$("#winssb_flash_window_only_inactive_cb").on("change",function(){var e=$(this).is(":checked");var t=e?"idle":"always";TSSSB.call("setPreference",{name:"windowFlashBehavior",value:t});Y()})}else{$("#winssb_flash_window_heading").addClass("hidden");$("#winssb_flash_window_choices").addClass("hidden")}if(window.TSSSB&&!TS.environment.isSSBAndAtLeastVersion("2.7.0")&&TSSSB.call("hasPreference","notifyPosition")){var t=TSSSB.call("getPreference","notifyPosition");$("#winssb_notify_corner").val(t.corner);$("#winssb_notify_corner").on("change",function(){var e=$(this).val();var t=$("#winssb_notify_display").val();TSSSB.call("setPreference",{name:"notifyPosition",value:{corner:e,display:t}})});$("#winssb_notify_display").val(t.display);$("#winssb_notify_display").on("change",function(){var e=$("#winssb_notify_corner").val();var t=$(this).val();TSSSB.call("setPreference",{name:"notifyPosition",value:{corner:e,display:t}})})}else{$("#winssb_notify_prefs_heading").addClass("hidden");$("#winssb_notify_position").addClass("hidden")}};var Y=function e(){var t=TSSSB.call("getPreference","windowFlashBehavior");if("never"===t){$("#winssb_flash_window_cb").prop("checked",false);$("#winssb_flash_window_only_inactive_cb").prop("checked",false).prop("disabled",true)}else if("idle"===t){$("#winssb_flash_window_cb").prop("checked",true);$("#winssb_flash_window_only_inactive_cb").prop("checked",true).prop("disabled",false)}else{$("#winssb_flash_window_cb").prop("checked",true);$("#winssb_flash_window_only_inactive_cb").prop("checked",false).prop("disabled",false)}};var q=function e(){$("#winssb_launch_on_start_cb").prop("checked",TSSSB.call("getPreference","launchOnStartup"));$("#winssb_launch_on_start_cb").on("change",function(){var e=!!$(this).prop("checked");TSSSB.call("setPreference",{name:"launchOnStartup",value:e})});$("#winssb_run_from_tray_cb").prop("checked",TSSSB.call("getPreference","runFromTray"));$("#winssb_run_from_tray_cb").on("change",function(){var e=!!$(this).prop("checked");TSSSB.call("setPreference",{name:"runFromTray",value:e});J()});if(window.TSSSB&&TSSSB.call("hasPreference","useHwAcceleration")){$("#winssb_disable_hw_acceleration_cb").prop("checked",!TSSSB.call("getPreference","useHwAcceleration"));$("#winssb_disable_hw_acceleration_cb").on("change",function(){var e=!$(this).prop("checked");TSSSB.call("setPreference",{name:"useHwAcceleration",value:e})})}else{$("#winssb_disable_hw_acceleration_pref").addClass("hidden");$("#winssb_disable_hw_acceleration_note").addClass("hidden")}};var J=function e(){var t=true;if(window.TSSSB&&TSSSB.call("hasPreference","windowFlashBehavior")){var i=TSSSB.call("getPreference","windowFlashBehavior");if("never"!==i&&"idle"!==i&&TSSSB.call("getPreference","runFromTray"))t=false}$("#winssb_flash_warning").toggleClass("hidden",t)};var Z=function e(){$(".message_theme_preview .timestamp").text(TS.interop.datetime.toTime(window.moment().unix(),{do24hrTime:TS.utility.date.do24hrTime(),includeMeridiem:!TS.utility.date.do24hrTime()}))};var X=function e(){t.find(".section_rollup").on("click",function(e){var t=$(e.target);var n=$(this);var a=n.attr("id");if(t.closest(".section_rollup_header").length){n.toggleClass("is_active");if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(i)}else if(!n.hasClass("is_active")){n.toggleClass("is_active");if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(i)}if(n.hasClass("is_active")){f.push(a);f=_.uniq(f)}else _.remove(f,function(e){return e===a})})};var ee=function e(t){var i=$("#"+t);if(i.length)i.addClass("is_active")};var te=function i(){if(!e)return;var n=ie();if("never"!==n)if(!TS.ui.growls.checkPermission())n="never";$("#growls_test").css("visibility","");var a=$('input:radio[name="notifications_rd"]').filter('[value="'+n+'"]').prop("checked",true);$(".global_notification_block.selected").removeClass("selected");a.closest(".global_notification_block").addClass("selected");var r=TS.templates.builders.buildNonDefaultNotificationBlock("margin-left");if(r){$(".non_default").removeClass("hidden");$("#non_default_html").html(r);$("#no_non_default").addClass("hidden")}else{$(".non_default").addClass("hidden");$("#no_non_default").removeClass("hidden")}$("#non_default_tip_link").tooltip("destroy").attr("title",TS.templates.builders.buildNonDefaultNotificationBlock("align_left")).tooltip({html:true});$('input:radio[name="sound_option_rd"]').each(function(){if($(this).val()==TS.model.prefs.new_msg_snd)$(this).attr("checked",true)});if(TS.model.prefs.mute_sounds){t.find('input:radio[name="sound_option_rd"]').attr("disabled","disabled");t.find("label.sound_option").addClass("disabled")}else{t.find('input:radio[name="sound_option_rd"]').removeAttr("disabled");t.find("label.sound_option").removeClass("disabled")}var s="never"===n;var o="nothing"===ve();var l=s&&o;$("#new_msg_snd_settings").toggleClass("disabled",!!TS.model.prefs.mute_sounds);$("#new_msg_snd_none_cb").prop("checked","none"!==TS.model.prefs.new_msg_snd);$("#select_new_msg_snd").toggleClass("hidden","none"===TS.model.prefs.new_msg_snd||s);$("#email_alerts_cb").prop("checked","none"!==TS.model.prefs.email_alerts);$("#select_email_alerts, #email_alerts_info").toggleClass("hidden","none"===TS.model.prefs.email_alerts);if("instant"===TS.model.prefs.email_alerts)$("#email_alerts_current").html(TS.i18n.t("once every 15 minutes","prefs")());else if("hourly"===TS.model.prefs.email_alerts)$("#email_alerts_current").html(TS.i18n.t("once an hour","prefs")());$("#mobile_different_settings_cb").prop("checked",g);$("#mobile_specific_settings").toggleClass("hidden",!g);$("#mobile_specific_settings").find('option[value="'+ve()+'"]').prop("selected",true);$("#push_idle_wait_select").find('option[value="'+TS.model.prefs.push_idle_wait+'"]').prop("selected",true);$("#no_text_in_notifications_cb").prop("checked",true!==TS.model.prefs.no_text_in_notifications);$("#threads_everything_cb").prop("checked",!!TS.model.prefs.threads_everything&&!l);$("#no_notifications_warning").toggleClass("hidden","never"!==n);var d=["#threads_everything_cb","#no_text_in_notifications_cb","#dnd_enabled","#dnd_start_hour","#dnd_end_hour","#push_idle_wait_select"].join(", ");$(d).prop("disabled",l).closest("label").toggleClass("disabled",l);var c=["#new_msg_snd_none_cb","#mac_ssb_bounce_cb","#mac_ssb_bounce_short_cb","#winssb_flash_window_cb","#winssb_flash_window_only_inactive_cb","#winssb_notify_corner","#winssb_notify_display"].join(", ");$(c).prop("disabled",s).closest("label").toggleClass("disabled",s);var u=Ce();if(_.size(u)>0)$("#channel_overrides_callout").removeClass("hidden").html(TS.templates.prefs_channel_overrides_callout({count:_.size(u)}));else $("#channel_overrides_callout").addClass("hidden");ke()};var ie=function e(){var t="all";if(!TS.model.prefs.growls_enabled)t="never";else if(!TS.model.prefs.all_channels_loud)t="mentions";return t};var ne=function e(t){var i=/(\d?\d):(\d\d)/.exec(t);if(!i)return t;var n=parseInt(i[1],10);var a=i[2];var r="AM";if(n>12){r="PM";n-=12}else if(0==n)n=12;else if(12==n)r="PM";return n+":"+a+" "+r};var ae=function e(){$("#growls_permission_div").addClass("hidden");$("#growls_instructions_div").removeClass("hidden");TS.ui.growls.promptForPermission(function(e,t){TS.info("callback called allowed:"+e+" permission_level:"+t);$("#growls_instructions_div").addClass("hidden");if("granted"===t&&e){$("#growls_allowed_div").removeClass("hidden").find(".desktop_notifications_title").addClass("kelly_green").text(TS.i18n.t("Desktop Notifications enabled!","prefs")());$("#growls_test").removeClass("hidden");if(!TS.model.prefs.growls_enabled){TS.prefs.setPrefByAPI({name:"growls_enabled",value:true});TS.model.prefs.growls_enabled=true}te()}else if("default"===t)$("#growls_permission_div").removeClass("hidden");else if("denied"===t)$("#growls_disallowed_div").removeClass("hidden");else alert("huh allowed:"+e+" permission_level:"+t)})};var re=function t(){if(!e)return;var i=$("#display_real_names_override_cb");i.prop("checked",TS.members.shouldDisplayRealNames());if(TS.model.team.prefs.display_real_names){$("#display_real_names_default").removeClass("hidden");$("#display_usernames_default").addClass("hidden")}else{$("#display_real_names_default").addClass("hidden");$("#display_usernames_default").removeClass("hidden")}};var se=null;var oe=function e(){if(se)se.cancel();var t=$("#highlight_words_input");var i=t.parents("label");var n=TS.ui.validation.validate(t);i.toggleClass(h,!n);t.toggleClass(h,!n);if(!n)return;var a=$("#highlight_words_input").val();se=TS.prefs.saveHighlightWords(a);se.finally(function(){se=null})};var le=function e(){var t=[];var i=[];var n;var a=TS.channels.getChannelsForUser();a.sort(function e(t,i){var n=t._name_lc;var a=i._name_lc;if(n<a)return-1;if(n>a)return 1;return 0});_.forOwn(a,function(e){n=false;if(-1!=$.inArray(e.id,TS.model.search_exclude_channels))n=true;if(e.is_archived)i.push({search_channel_exclusion:n,channel:e});else t.push({search_channel_exclusion:n,channel:e})});return{active_channels:t,archived_channels:i}};var de=function t(){if(!e)return;var i=TS.prefs.getReadStateTrackingPref();$('input:radio[name="read_rd"]').filter('[value="'+i+'"]').prop("checked",true)};var ce=function e(){$("#fs_modal, #fs_modal_bg").addClass("show_sidebar");$("#fs_modal_bg").append('<div id="sidebar_overlay"></div>')};var _e=function e(){$("#fs_modal, #fs_modal_bg").removeClass("show_sidebar");$("#sidebar_overlay").remove();setTimeout(function(){TS.view.resizeManually()},TS.ui.fs_modal.transition_duration)};var ue=function i(n){if(!e)return;n=false!==n;if(TS.prefs.last_theme_selected_in_UI&&TS.model.prefs.sidebar_theme!==TS.prefs.last_theme_selected_in_UI)return;else if(TS.prefs.last_theme_selected_in_UI&&n)TS.prefs.last_theme_selected_in_UI=null;if("default"===TS.model.prefs.sidebar_theme)TS.model.prefs.sidebar_theme="default_theme";var a=TS.model.prefs.sidebar_theme;$('input:radio[name="sidebar_theme_rd"]').filter('[value="'+a+'"]').prop("checked",true);if(TS.model.prefs.sidebar_theme_custom_values&&"undefined"!==TS.model.prefs.sidebar_theme_custom_values){var r=JSON.parse(TS.model.prefs.sidebar_theme_custom_values);var s=$.map(r,function(e){return e});if(t){t.find('input[name="color_column_bg_hex"]').val(r.column_bg);t.find('input[name="color_menu_bg_hex"]').val(r.menu_bg);t.find('input[name="color_active_item_hex"]').val(r.active_item);t.find('input[name="color_active_item_text_hex"]').val(r.active_item_text);t.find('input[name="color_hover_item_hex"]').val(r.hover_item);t.find('input[name="color_text_color_hex"]').val(r.text_color);t.find('input[name="color_active_presence_hex"]').val(r.active_presence);t.find('input[name="color_badge_hex"]').val(r.badge);t.find('.color_swatch[data-theme-element="column_bg"]').css("background-color",r.column_bg).data("hex",r.column_bg);t.find('.color_swatch[data-theme-element="menu_bg"]').css("background-color",r.menu_bg).data("hex",r.menu_bg);t.find('.color_swatch[data-theme-element="active_item"]').css("background-color",r.active_item).data("hex",r.active_item);t.find('.color_swatch[data-theme-element="active_item_text"]').css("background-color",r.active_item_text).data("hex",r.active_item_text);t.find('.color_swatch[data-theme-element="hover_item"]').css("background-color",r.hover_item).data("hex",r.hover_item);t.find('.color_swatch[data-theme-element="text_color"]').css("background-color",r.text_color).data("hex",r.text_color);t.find('.color_swatch[data-theme-element="active_presence"]').css("background-color",r.active_presence).data("hex",r.active_presence);t.find('.color_swatch[data-theme-element="badge"]').css("background-color",r.badge).data("hex",r.badge);$("#sidebar_theme_custom").val(s.join(","))}}};var me=function e(t,i){var n=false;TS.prefs.last_theme_selected_in_UI=t;TS.prefs.setMultiPrefsByAPI({sidebar_theme:t,sidebar_theme_custom_values:JSON.stringify(i)});TS.model.prefs.sidebar_theme=t;TS.prefs.setSidebarThemeCustomValues(i);ue(n);TS.view.prefs.sidebarThemePrefChanged(n);TS.prefs.messages_theme_changed_sig.dispatch()};var fe=function e(){if(TS.model.prefs.mac_ssb_bounce)$("#mac_ssb_bounce_short_cb").prop("disabled",false);else $("#mac_ssb_bounce_short_cb").prop("disabled",true)};var he=function e(t){v=TS.boot_data.feature_react_sidebar&&TS.boot_data.feature_sli_channel_priority&&""!==t.plan};var ge=function t(i){if(!i.is_self)return;if(!e)return;$(".dnd_tz_label").text(TS.model.user.tz_label)};var pe=function t(){if(!e)return;if(TS.model.prefs.tz)$("#prefs_dnd").removeClass("tz_not_set")};var Se=function e(t){if(T){T=false;return}if(t===TS.model.prefs.locale){if(TS.generic_dialog.is_showing)TS.generic_dialog.cancel();return}var i=TS.i18n.localesEnabled()[t];if(window.desktop&&desktop.teams&&desktop.teams.setTeamLocale)desktop.teams.setTeamLocale(t);if(TS.generic_dialog.is_showing)TS.generic_dialog.end();TS.generic_dialog.start({title:TS.i18n.t("Switching to {lang}","prefs")({lang:i}),body:"<p>"+TS.i18n.t("Changing your language will take just a moment.","prefs")()+"</p>",show_cancel_button:false,onGo:function e(){window.createCookie("i18n_locale",i,365,"slack.com");TS.reload(null,"prefs dialog change: locale -> "+i)}})};var Te=function e(t){var i=TS.boot_data.notification_sounds;var n=_.find(i,{value:t});return n?n.label:""};var ve=function e(){var t=TS.notifs.getGlobalPushNotificationSetting();if("mentions"===t||"dm_and_mentions"===t||"dms"===t)t="mentions";return t};var be=function e(){var t=TS.notifs.getGlobalNotificationSetting();var i=ve();return t!==i};var we=function e(t){var i=ye(t);if(i){var n=TS.prefs.setMultiPrefsByAPI(i);TS.ui.inline_saver.show({target:"#prefs_send_notifications_for",promise:n})}};var ye=function e(t){var i={};switch(t){case"nothing":i.push_dm_alert=0;i.push_mention_alert=0;i.push_everything=0;break;case"mentions":i.push_dm_alert=1;i.push_mention_alert=1;i.push_everything=0;break;case"everything":i.push_dm_alert=1;i.push_mention_alert=1;i.push_everything=1;break;default:i=null}return i};var ke=function e(){var t=$("#channel_specific_overrides");t.longListView({items:[],approx_item_height:61,makeElement:function e(){return $('<div class="channel_overrides_row" data-action="open_channel_overrides"></div>')},renderItem:function e(t,i){t.attr("data-cid",i.id);t.html(TS.templates.prefs_channel_overrides({override:i}))},calcItemHeight:function e(t){return t.outerHeight()},preserve_dom_order:true,scrollable:t.closest(".contents_container")});Ae()};var Ae=function e(){var t=Ce();t=_.values(t);var i=_.reject(t,"channel.is_mpim");var n=_.filter(t,"channel.is_mpim");i=_.sortBy(i,"channel.name");n=_.sortBy(n,"channel.name");var a=i.concat(n);var r=$("#channel_specific_overrides");var s=true;r.longListView("setItems",a,s)};var Ce=function e(){var t=TS.notifs.getCorGsNotUsingGlobalNotificationSetting();var i=TS.notifs.getCorGsNotUsingGlobalPushNotificationSetting();var n={};var a=function e(t,i,a){t.forEach(function(e){var t=n[e.id];if(!t){t=Me(e);n[e.id]=t}t[i]=a})};a(t.everything,"desktop","everything");a(t.mentions,"desktop","mentions");a(t.nothing,"desktop","nothing");a(t.muted,"is_muted",true);a(t.suppressed,"is_suppressed",true);a(i.everything,"mobile","everything");a(i.mentions,"mobile","mentions");a(i.nothing,"mobile","nothing");return n};var Me=function e(t){var i={channel:t,id:t.id};return i};var Ie=function e(t){var i=TS.notifs.getGlobalNotificationSetting();if("everything"===i)TS.notifs.makeCorGDTopEverything(t);else if("mentions"===i)TS.notifs.makeCorGDTopMentions(t);else TS.notifs.makeCorGDTopNothing(t);var n=ve();if("everything"===n)TS.notifs.makeCorGPushEverything(t);else if("mentions"===n)TS.notifs.makeCorGPushMentions(t);else TS.notifs.makeCorGPushNothing(t);TS.notifs.makeCorGNOTPushSuppressed(t);TS.notifs.makeCorGNOTSuppressed(t);TS.notifs.makeCorGNOTMuted(t);TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(","),push_loud_channels:TS.model.push_loud_channels.join(","),push_mention_channels:TS.model.push_mention_channels.join(","),push_loud_channels_set:TS.model.push_loud_channels_set.join(","),at_channel_suppressed_channels:TS.model.at_channel_suppressed_channels.join(","),push_at_channel_suppressed_channels:TS.model.push_at_channel_suppressed_channels.join(","),muted_channels:TS.model.muted_channels.join(",")}).catch(function(){TS.error("Failed to reset to channel defaults: "+t)})};var xe=function e(){var t=$("#global_prefs_container");var i=$("#channel_prefs_container");if(!p)p=t.closest(".contents_container").scrollTop();n.addClass("hidden");t.addClass("hidden");i.removeClass("hidden");$("#channel_specific_overrides").longListView("setHidden",true);TS.ui.fs_modal.bindBackButton(Be);TS.ui.fs_modal.showBackButton()};var Ee=function e(){var t=$("#channel_prefs_container");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Add a Channel-Specific Notification Setting","prefs")());t.html(TS.templates.prefs_channel_picker());var i=function e(t){return TS.searcher.search(t,{channels:{include_archived:false,only_if_member:true},groups:{include_archived:false},mpims:true,sort:{allow_empty_query:true}}).then(function(e){e.all_items_fetched=true;_.forEach(e,function(e){e.lfs_id=e.model_ob.id});return e})};$("#channel_override_picker").lazyFilterSelect({single:true,placeholder_text:TS.i18n.t("Select or search","prefs")(),approx_item_height:30,tab_to_nav:true,no_default_selection:true,template:function e(t){return new Handlebars.SafeString(TS.templates.file_sharing_channel_row({item:t.model_ob}))},data_promise:i}).one("remove",function(){$(this).lazyFilterSelect("destroy")})};var $e=function e(t){var i=$("#channel_prefs_container");var n=TS.shared.getModelObById(t);if(!n)return;var a=TS.shared.getDisplayNameForModelOb(n);if(a.length>30)a=a.substring(0,30)+"...";a+=TS.templates.builders.maybeMakeSharedIcon(n);TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Notification Preferences: {channel_name}","prefs")({channel_name:new Handlebars.SafeString(a)}));var r=true;TS.ui.channel_prefs_dialog.renderOptions(i,t,r);i.find('[data-action="done"]').on("click",Be);i.find('[data-action="reset_channel_to_defaults"]').on("click",function(){Ie(t)})};var Be=function e(){var t=$("#global_prefs_container");var i=$("#channel_prefs_container");TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton();TS.ui.fs_modal.setHeaderTitle(y());n.removeClass("hidden");t.removeClass("hidden");i.addClass("hidden").empty();$("#channel_specific_overrides").longListView("setHidden",false);t.closest(".contents_container").scrollTop(p);p=0};var De=function e(){var t=$("#channel_prefs_container");if(!t.length||t.hasClass("hidden"))return true;var i=$("#channel_override_picker");if(i.length){var n=i.lazyFilterSelect("value")[0];var a=_.get(n,"model_ob.id");if(!a)return false;$e(a);return false}Be();return false}})()},4406:function(e,t){(function(){"use strict";TS.registerModule("ui.mpim_conversion_modal",{onStart:function e(){},startMpimConversionModal:function e(t){i=t;var s=TS.mpims.getMembersInDisplayOrder(i);var o=_.filter(s,{is_ultra_restricted:true});var l=TS.templates.mpim_conversion_modal({members:s,uras:o});TS.ui.fs_modal.start({body_template_html:l,onShow:n,onEnd:r,modal_class:"mpim_conversion_modal",onGo:a})},go:function n(){var a=e.find(".title_input").val();if(t)t.start();TS.mpims.convertToGroup(i,a,{validate_name:true}).then(function(){if(t)t.stop();TS.ui.fs_modal.close()}).catch(function(i){if(t)t.stop();var n=i.data.error;var r=TS.ui.validation.getErrorMessage(n,{maxlength:22,name:a});return TS.ui.validation.showWarning(e.find(".title_input"),r,{custom_for:"channel_create_title"})})}});var e;var t;var i;var n=function t(){e=$(".mpim_conversion_modal");e.on("click",".continue",function(){a()});e.find(".convert_mpim_go").click(TS.ui.mpim_conversion_modal.go);var i=e.find(".title_input");i.keydown(function(e){if(e.which===TS.utility.keymap.enter)TS.ui.mpim_conversion_modal.go();else if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()})};var a=function i(){if(!$("#conversion_step").hasClass("hidden")&&e.find(".title_input").val().length>1)return TS.ui.mpim_conversion_modal.go();$("#confirmation_step").addClass("hidden");$("#conversion_step").removeClass("hidden");t=Ladda.create(e.find(".convert_mpim_go")[0]);e.find(".title_input").focus();return false};var r=function e(){s()};var s=function n(){e=null;t=null;i=null}})()},4407:function(e,t){(function(){"use strict";TS.registerModule("ui.fs_modal_file_viewer",{start:function e(t){b=t;if(!b||!b.current_file_id&&!b.current_external_link){TS.error("Full screen file viewer modal requires something to show.");return}if(TS.ui.fs_modal_file_viewer.is_showing){TS.error("Full screen file viewer modal is already showing.");return}TS.files.team_file_comment_added_sig.add(he);TS.files.team_file_comment_deleted_sig.add(he);TS.files.team_file_deleted_sig.add(Ae);TS.files.team_file_changed_sig.add(L);TS.channels.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.channels.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.channels.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.members.changed_current_status_sig.add(TS.ui.fs_modal_file_viewer.updateCurrentStatusForMember,TS.ui.fs_modal_file_viewer);TS.ui.fs_modal.start(re());TS.ui.fs_modal_file_viewer.is_showing=true;V();me();fe();ue();ge();Te();_e("both");setTimeout(function(){se()},0)},getCurrentFileId:function e(){if(!TS.ui.fs_modal_file_viewer.is_showing)return false;if(b.current_file_id)return b.current_file_id;if(b.current_external_link)return b.current_external_link.getAttribute("data-src");return false},previous:function e(){if(t.find(".previous_btn:not([disabled])").length)de(-1)},next:function e(){if(t.find(".next_btn:not([disabled])").length)de(1)},updateGallery:function e(){if(TS.client.activeChannelIsHidden())return;setTimeout(function(){var e=$("#msgs_div").find(".file_viewer_link, .file_viewer_external_link, .thumbnail_link");if(e!==T){T=e;if(TS.model.pdf_viewer_enabled)Y();fe();ue()}},500)},updateCurrentStatusForMember:function e(t){if(!TS.ui.fs_modal_file_viewer.is_showing)return;var i={member:t,for_message:true};$(".aside_panel .message_current_status.color_"+t.id).replaceWith(TS.templates.current_status(i))},storeLastCommentInput:function e(){if(!t)return;if(!v||!v.file||!v.file.id)return;TS.storage.storeLastCommentInput(v.file.id,TS.utility.contenteditable.value(t.find("#file_comment")))},test:function e(){return{_generateTemplateArguments:ee,_shouldDisplayLargestThumb:X}},canClose:function e(){return F()}});var e=$("body");var t;var i;var n;var a;var r;var s;var o;var l;var d;var c;var u;var m;var f;var h;var g;var p;var S;var T;var v={index:0,aside_panel_showing:false};var b={};var w;var y=function e(){t=$(".fs_modal_file_viewer");i=t.find(".fs_modal_file_viewer_content");n=t.find(".viewer");k();s=n.find(".images");A();C()};var k=function e(){a=t.find(".fs_modal_file_viewer_header");r=a.find(".file_header_detailed")};var A=function e(){o=s.find(".scaled_image");l=s.find(".actual_pixel_image")};var C=function e(){d=t.find(".comment_btn");c=t.find(".aside_panel");u=t.find(".details_container");m=t.find(".comments_container");f=t.find(".shared_to_conversations");h=t.find(".file_comment_form_container")};var M=function e(){t=null;i=null;n=null;o=null;s=null;d=null;c=null;u=null;m=null;f=null;h=null;l=null;a=null;r=null;T=null;b.$el=null};var I=function e(){q();we();Q();TS.ui.inline_edit.end();J();ke();M();TS.ui.fs_modal_file_viewer.is_showing=false};var x=function e(){y();E();ye();if(v.is_pdf)w=new TS.ui.PdfViewer(s.find("#pdf_display"),v.file)};var E=function n(){t.on("click",".comment_btn, .aside_close_btn",H);t.on("click","#fs_modal_close_btn, .channel_link, .group_link, .file_preview_link",TS.ui.fs_modal.close);t.on("mousedown",".viewer",O);t.on("click",".viewer",R);t.on("click",".scaled_image",function(e){e.stopPropagation();W(e)});t.on("click",".actual_pixel_image",function(e){e.stopPropagation();K()});t.on("click",".previous_btn",function(e){e.stopPropagation();TS.ui.fs_modal_file_viewer.previous()});t.on("click",".next_btn",function(e){e.stopPropagation();TS.ui.fs_modal_file_viewer.next()});t.on("click",".file_comment_btn",function(e){var t=$(e.target);var i=t.closest("[data-model-ob-id]").attr("data-model-ob-id");ge(i)});t.on("click",".aside_back_btn",function(){ge(null)});e.on("keydown",D);TS.view.resize_sig.add(se);i.on("click.view",TS.view.onFilePreviewClick);if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())t.on("textchange","#file_comment",function(){TS.storage.storeLastCommentInput(v.file.id,$(this).val())});B()};var B=function e(){t.find(".scaled_image").on("error",function(){if(!s)return;s.addClass("broken_image")})};var D=function e(t){switch(t.which){case TS.utility.keymap.up:if(TS.utility.isFocusOnInput())return;if(!v.is_actual_pixel_image_shown)return;t.preventDefault();t.stopPropagation();z("up");break;case TS.utility.keymap.down:if(TS.utility.isFocusOnInput())return;if(!v.is_actual_pixel_image_shown)return;t.preventDefault();t.stopPropagation();z("down");break;case TS.utility.keymap.left:if(TS.utility.isFocusOnInput())return;t.preventDefault();t.stopPropagation();if(v.is_actual_pixel_image_shown)z("left");else TS.ui.fs_modal_file_viewer.previous();break;case TS.utility.keymap.right:if(TS.utility.isFocusOnInput())return;t.preventDefault();t.stopPropagation();if(v.is_actual_pixel_image_shown)z("right");else TS.ui.fs_modal_file_viewer.next();break;case TS.utility.keymap.space:if(TS.utility.isFocusOnInput())return;t.preventDefault();t.stopPropagation();j(t);break;case TS.utility.keymap.esc:U(t)}};var F=function e(){if(TS.ui.react_emoji_menu.is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.dialog_is_showing)return false;if(TS.utility.isTabCompleteShowing())return false;if(TS.ui.inline_edit.containsActiveElement(t))return false;return true};var P=true;var O=function e(){P=F()};var R=function e(t){if(!P)return;if($(t.target).closest(".control_btns").length)return;TS.ui.fs_modal.close()};var U=function e(t){if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()&&TS.utility.isFocusOnInput())return;if(!F())return;t.stopPropagation();t.preventDefault();if(v.is_actual_pixel_image_shown)K();else TS.ui.fs_modal.close()};var Q=function i(){t.off("click");e.off("keydown",D);TS.view.resize_sig.remove(se)};var L=function e(i){if(t.length&&v.file.id===i.id){var n=ee();var a=false;if(TS.ui.inline_edit.containsActiveElement(r))a=true;if(!a){r.replaceWith(TS.templates.file_header_detailed(n));k()}}};var H=function e(){if(v.aside_panel_showing)G();else N()};var N=function e(){d.addClass("active");i.addClass("aside_panel_active");v.aside_panel_showing=true;window.setTimeout(function(){p.focus()},250)};var G=function e(){d.removeClass("active");i.removeClass("aside_panel_active");v.aside_panel_showing=false;window.setTimeout(function(){d.blur()},250)};var j=function e(t){if(v.is_actual_pixel_image_shown)K();else W(t)};var W=function e(t){if(v.is_image_within_viewer)return false;var i=oe(t);n.addClass("show_actual_pixel");v.is_actual_pixel_image_shown=true;le(i)};var K=function e(){n.removeClass("show_actual_pixel");v.is_actual_pixel_image_shown=false;n.scrollLeft(0);n.scrollTop(0)};var z=function e(t){var i=n[0];if(!i)return;var a="up"===t||"down"===t;var r=a?"scrollTop":"scrollLeft";var s=25;if("up"===t||"left"===t)s*=-1;i[r]+=s};var V=function e(){if(TS.client.activeChannelIsHidden()){T=$();return}T=$("#msgs_div").find(".file_viewer_link, .file_viewer_external_link, .thumbnail_link");if(TS.model.pdf_viewer_enabled)Y()};var Y=function e(){T=T.filter(function(){var e=$(this);var t=e.attr("data-file-id");return!TS.files.fileIsPDF(t)})};var q=function e(){TS.files.team_file_comment_added_sig.remove(he);TS.files.team_file_comment_deleted_sig.remove(he);TS.files.team_file_deleted_sig.remove(Ae);TS.files.team_file_changed_sig.remove(L);TS.channels.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.channels.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.channels.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.ims.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.groups.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer);TS.mpims.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer)};var J=function e(){b.current_file_id=null;b.current_external_link=null;v.external_file_src=null;v.link_url=null;v.is_image_within_viewer=null;if(w){w.destroy();w=null}};var Z=function e(){if(b.current_file_id){v.file=TS.files.getFileById(b.current_file_id);v.member=TS.members.getMemberById(v.file.user);v.original_w=v.file.original_w;v.original_h=v.file.original_h;v.is_pdf=TS.model.pdf_viewer_enabled&&TS.files.fileIsPDF(v.file);TS.files.fetchFileInfo(v.file.id,function(){if(v.file&&v.file.comments&&v.file.comments.length)if(!TS.boot_data.feature_share_mention_comment_cleanup){var e=c||$();e.find(".comments").html(TS.templates.builders.buildComments(v.file))}})}else if(b.current_external_link){v.file={};v.model_ob=ie();v.msg=ne();v.member=ae(v.msg);v.link_url=b.current_external_link.getAttribute("data-link-url");v.external_file_src=b.current_external_link.getAttribute("data-src");v.original_w=b.current_external_link.getAttribute("data-width");v.original_h=b.current_external_link.getAttribute("data-height");v.rotation=b.current_external_link.getAttribute("data-rotation");v.content_type=b.current_external_link.getAttribute("data-content-type");v.is_pdf=false}else v.file={}};var X=function e(t){var i=false===TS.model.prefs.a11y_animations&&"gif"===t.filetype&&!t.deanimate_gif;var n="external"===t.mode;var a=t.image_exif_rotation>4;var r="tiff"===_.toLower(t.pretty_type);return i||n||a||r};var ee=function e(){var t=v.file.comments_count?v.file.comments_count:"";var i=!v.external_file_src||b.current_file_id;var n;if(i)n=TS.templates.builders.makeFileShareLabel(v.file);else n=TS.templates.builders.makeMessageShareLabelSafe(v.model_ob);var a=i?v.file.timestamp:v.msg&&v.msg.ts;var r=i?"file":"message";var s="message"===r?v.msg:v.file;var o="message"===r?v.model_ob:null;var l=v.file.id?TS.files.getFileActions(v.file):{};l.more=i;var d;if(!TS.boot_data.feature_name_tagging_client)if(i)d=TS.templates.inline_edit_file_title({file:v.file,actions:l});else d=TS.templates.builders.makeMessageLinkLabelSafe(v.link_url);if(TS.boot_data.feature_share_mention_comment_cleanup)TS.files.createFileCommentsGroup(v.file);var c={file:v.file,member:v.member,title:d,share_label:n,timestamp:a,star_type:r,star_ob:s,star_parent_ob:o,msg:v.msg,model_ob:v.model_ob,comments_count:t,is_aside_panel_active:!!v.aside_panel_showing,show_open_public_link:i&&!TS.model.team.prefs.disallow_public_file_urls,show_revoke_public_link:i&&!TS.model.team.prefs.disallow_public_file_urls&&TS.files.getFileActions(v.file).revoke_public_link,control_btns:b.show_control_btns,actions:l,link_url:v.link_url};if(TS.model.pdf_viewer_enabled&&v.is_pdf){c.file_is_pdf=true;c.control_btns=false;c.pdf_viewer_url=TS.boot_data.abs_root_url+"pdf-viewer?feature_pdf_viewer=1"}else{var _=te(v);var u=_.scaled;var m=_.actual_pixel;c.scaled_src=u;c.scaled_rotation=u===v.file.url_private&&v.file.image_exif_rotation;c.actual_pixel_src=m;c.actual_pixel_rotation=m===v.file.url_private&&v.file.image_exif_rotation}return c};var te=function e(t){var i=t.file.url_private;if(X(t.file))i=TS.files.getThumbSrcForFile(t.file,{max_size:1024});else if(false===TS.model.prefs.a11y_animations&&"gif"===t.file.filetype&&t.file.deanimate_gif)i=t.file.deanimate_gif;if(t.external_file_src){var n={};n.rotate=!!parseInt(t.rotation,10);if("image/svg+xml"===t.content_type){n.render_svg=true;n.width=t.original_w;n.height=t.original_h}i=TS.utility.getImgProxyURLWithOptions(t.external_file_src,n)}var a=i;if(t.file.thumb_1024&&!t.file.thumb_360_gif){var r=$(window).width()<t.file.thumb_1024_w||$(window).height()<t.file.thumb_1024_h;if(r)i=t.file.thumb_1024}return{scaled:i,actual_pixel:a}};var ie=function e(){var t=$(b.current_external_link);var i;if(t.closest(".search_message_result").length){var n=t.closest(".search_message_result").data("channel");i=TS.ims.getImById(n)||TS.channels.getChannelById(n)||TS.groups.getGroupById(n)||TS.mpims.getMpimById(n)}else if(t.closest("#messages_container").length)i=TS.shared.getActiveModelOb();return i||{}};var ne=function e(){var t=$(b.current_external_link).closest("ts-message").data("ts");var i=TS.utility.msgs.findMsg(t,v.model_ob.id);return i||{ts:t}};var ae=function e(t){if(!t)return false;return TS.members.getMemberById(t.user)};var re=function e(){Z();v.aside_panel_showing=false;var t="fs_modal_file_viewer";if(TS.boot_data.feature_share_mention_comment_cleanup)t+=" with_conversations";return $.extend({},{modal_class:t,modal_contents_container_class:"fs_modal_file_viewer_content",disable_default_controls:true,body_template_html:TS.templates.fs_modal_file_viewer(ee()),onShow:x,onEnd:I})};var se=function e(){v.is_image_within_viewer=null;if(!n)return;if(v.is_pdf)return;var t=n.width();var i=n.height();var a;var r;if(X(v.file)){var s=TS.files.getThumbSrcForFile(v.file,{max_size:1024});var d=_.invert(v.file)[s];if(d&&v.file){a=v.file[d+"_w"];r=v.file[d+"_h"]}}else{a=v.original_w;r=v.original_h}if(!a)a=l.width();if(!r)r=l.height();var c=a-t;var u=r-i;if(c<1&&u<1)v.is_image_within_viewer=true;if(v.is_image_within_viewer)o.addClass("no_zoom");else o.removeClass("no_zoom")};var oe=function e(t){if(t.pageX){var i={width:o.width(),height:o.height()};var n={x:t.pageX-o.offset().left,y:t.pageY-o.offset().top};return{x:n.x/i.width,y:n.y/i.height}}return{x:.5,y:.5}};var le=function e(t){var i={x:(l.width()-n.width())*t.x,y:(l.height()-n.height())*t.y};n.scrollLeft(i.x);n.scrollTop(i.y)};var de=function e(t){TS.ui.inline_edit.end();J();v.index+=t;if(T){var i=T.eq(v.index);b.current_file_id=i.data("file-id");if(i.hasClass("file_viewer_external_link")){b.current_external_link=i[0];if(v.aside_panel_showing&&!b.current_file_id)H()}ce();ye();B();_e(t)}};var ce=function e(){Z();var t=ee();var i=$(TS.templates.fs_modal_file_viewer_header(t));a.replaceWith(i);a=i;if(v.is_pdf){var n=$(TS.templates.fs_modal_file_viewer_content_pdf(t));s.replaceWith(n);s=n;w=new TS.ui.PdfViewer(s.find("#pdf_display"),v.file)}else{var r=$(TS.templates.fs_modal_file_viewer_content_image(t));s.replaceWith(r);s=r}A();ve();if(TS.boot_data.feature_share_mention_comment_cleanup)ge();else{var o=$(TS.templates.fs_modal_file_viewer_aside(t));c.replaceWith(o);c=o}C();be();ue();se()};var _e=function e(t){if("both"===t){e(1);t=-1}var i=v.index+t;if(!T||i<0||T.length<=i)return;var n=T.eq(i);var a=n.hasClass("file_viewer_external_link");var r={file:TS.files.getFileById(n.data("file-id"))||{},external_file_src:a?n.data("src"):void 0};if(TS.model.pdf_viewer_enabled&&TS.files.fileIsPDF(r.file))return;var s=te(r);var o=new Image;o.src=s.scaled};var ue=function e(){if(!t)return;var i=t.find(".control_btns");var n=t.find(".previous_btn");var a=t.find(".next_btn");if(1===T.length||0===T.length)i.addClass("hidden");else i.removeClass("hidden");n.attr("disabled",v.index<=0);a.attr("disabled",v.index>=T.length-1)};var me=function e(){var t={};T=T.filter(function(){var e=this.getAttribute("data-file-id")?this.getAttribute("data-file-id"):"";e+=this.getAttribute("data-src")?this.getAttribute("data-src"):"";if(t.hasOwnProperty(e))return false;t[e]=true;return true})};var fe=function e(){for(var t=0;t<T.length;t+=1)if(T[t].getAttribute("data-file-id")){if(T[t].getAttribute("data-file-id")===b.current_file_id){v.index=t;break}}else if(T[t].getAttribute("data-src")===v.external_file_src){v.index=t;break}};var he=function e(){if(!t)return;var i=v.file.comments&&v.file.comments.length;t.find(".comment_count").text(i||"")};var ge=function e(t){if(TS.boot_data.feature_share_mention_comment_cleanup){t=null!==t&&(t||b.$el.closest("[data-model-ob-id").attr("data-model-ob-id"));if(t)Se(t);else pe()}};var pe=function e(){TS.files.createFileCommentsGroup(v.file);f.replaceWith(TS.templates.shared_to_conversations(v.file));c.attr("data-model-ob-id","");h.addClass("hidden");u.unhideWithRememberedScrollTop();m.hideWithRememberedScrollTop()};var Se=function e(t){TS.files.createFileCommentsGroup(v.file);var i=jQuery.extend(true,{},v.file);var n=i._comments_grouped[t];i.comments=n.comments;var a=TS.shared.getModelObById(t);var r=a&&TS.shared.getDisplayNameForModelOb(a);var s=i.id?TS.files.getFileActions(i):{};var o={file:i,name:r,actions:s};m.html(TS.templates.fs_modal_file_viewer_comments(o));c.attr("data-model-ob-id",t);if(s.comment)h.removeClass("hidden");else h.addClass("hidden");m.unhideWithRememberedScrollTop();u.hideWithRememberedScrollTop()};var Te=function e(){ve();be()};var ve=function e(){p=$("#file_comment");g=$("#file_comment_form").detach();S=$("#file_edit_comment_form").detach()};var be=function e(){h.append(g);h.append(S);var t=TS.storage.fetchLastCommentInput(v.file.id);if(t)TS.utility.contenteditable.value(p,t);else TS.utility.contenteditable.clear(p);TS.utility.contenteditable.clearHistory(p)};var we=function e(){TS.ui.comments.onEndEdit();var t;if(TS.boot_data.feature_share_mention_comment_cleanup)t=$(".file_comments_scroller");else t=$("#file_preview_scroller");var i=$("#file_comment_form").detach();var n=$("#file_edit_comment_form").detach();t.append(i);t.append(n);if(v.file.id!==TS.model.last_previewed_file_id){var a=TS.storage.fetchLastCommentInput(TS.model.last_previewed_file_id);if(a)TS.utility.contenteditable.value($("#file_comment_form #file_comment"),a);else TS.utility.contenteditable.clear($("#file_comment_form #file_comment"));TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment"));if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())$("#file_comment_form #file_comment").trigger("keyup")}};var ye=function e(){TS.client.downloads.addIndividualDownload(t.find(".flex_menu_download_circle"),b.current_file_id)};var ke=function e(){TS.client.downloads.removeIndividualDownload()};var Ae=function e(){TS.ui.fs_modal.close(true)}})()},4408:function(e,t){(function(){"use strict";TS.registerComponent("ui.PdfViewer",{_constructor:function e(t,i){if(!i||!t||!t.length){TS.error("TS.ui.PdfViewer missing either the file or iframe");return}if(!TS.files.fileIsPDF(i)){TS.error("Non-PDF given to TS.ui.PdfViewer");return}TS.metrics.count("pdf_viewer_open");this.file=i;this.$iframe=t;this.$image_wrapper=this.$iframe.parent();this.$pdf_loading_spinner=$("#pdf_loading_spinner");var n=TS.boot_data.abs_root_url;if(_.endsWith(n,"/"))n=n.substring(0,n.length-1);this.iframe_origin=n;this.iframe_ready=false;this.addLoadingSpinner(this.$pdf_loading_spinner);this.loadData();this.boundOnMessage=this.onMessage.bind(this);$(window).on("message",this.boundOnMessage)},addLoadingSpinner:function e(t){t.removeClass("hidden").html(TS.templates.infinite_spinner({color:"blue",size:"medium",speed:"fast"}))},removeLoadingSpinner:function e(t){t.addClass("hidden")},destroy:function e(){if(this.xhr)this.xhr.abort();$(window).off("message",this.boundOnMessage)},loadData:function e(){this.xhr=new XMLHttpRequest;this.xhr.onload=this.onLoad.bind(this);this.xhr.onerror=this.onError.bind(this);this.xhr.open("GET",this.file.url_private_download);this.xhr.responseType="arraybuffer";this.xhr.withCredentials=true;this.xhr.send()},addFallBackImage:function e(){this.$image_wrapper.addClass("broken_image")},onError:function e(){TS.metrics.count("pdf_viewer_xhr_error");TS.warn("Error requesting PDF data!");this.removeLoadingSpinner(this.$pdf_loading_spinner);this.addFallBackImage()},onLoad:function e(){if(4===this.xhr.readyState&&200==this.xhr.status){this.buffer=new Uint8Array(this.xhr.response);if(this.iframe_ready)this.sendBuffer()}this.xhr=null},onMessage:function e(t){var i=t.origin||t.originalEvent.origin;if(!i)return;var n=t.data||t.originalEvent.data;if(_.includes(["pdf_iframe_ready","corrupt_pdf","close_file_viewer"],n)){if(i!==this.iframe_origin){TS.warn(n+" from unexpected origin: "+i);return}}else return;if("pdf_iframe_ready"===n){this.iframe_ready=true;this.$iframe.focus();if(this.buffer)this.sendBuffer()}else if("corrupt_pdf"===n){TS.metrics.count("pdf_viewer_corrupt_pdf");this.addFallBackImage()}else if("close_file_viewer"===n&&TS.ui.fs_modal_file_viewer.canClose())TS.ui.fs_modal.close()},sendBuffer:function e(){if(!TS.model.is_our_app)this.$iframe[0].contentWindow.postMessage(this.buffer,this.iframe_origin);else this.$iframe[0].contentWindow.postMessage(this.buffer,this.iframe_origin,[this.buffer.buffer]);this.removeLoadingSpinner(this.$pdf_loading_spinner)}})})()},4409:function(e,t){(function(){"use strict";TS.registerModule("ui.jumper",{is_showing:false,onStart:function e(){TS.client.login_sig.add(TS.ui.jumper.onLogin)},onLogin:function e(){c()},start:function e(){if(TS.isPartiallyBooted())return;if(TS.ui.jumper.is_showing)return;TS.metrics.mark("start_jumper_open");$(window.document).on("keydown.jumper",v);TS.tips.hideAll();i[0].classList.add("active");n.removeAttr("disabled");n.focus();TS.model.dialog_is_showing=true;TS.ui.jumper.is_showing=true;TS.metrics.measureAndClear("jumper_open","start_jumper_open");TS.searcher.search("",{members:E(),channels:true,groups:true,mpims:true}).then(function(e){if(!TS.ui.jumper.is_showing)return;t=B(e);f(t,"");return null})},end:function e(){u();i[0].classList.remove("active");$(window.document).off("keydown.jumper",v);TS.kb_nav.end();a.off("mousemove");n.blur();if(r)r.cancel();r=null;TS.model.dialog_is_showing=false;TS.ui.jumper.is_showing=false;TS.tips.unhideAll()},debugQuery:function e(t){TS.sorter.printTest(t,{prefer_exact_match:true,frecency:true})}});var e=24;var t=[];var i;var n;var a;var r;var s;var o;var l=200;var d=false;var c=function e(){var t=TS.templates.jumper();$("body").append(t);i=$("ts-jumper");n=i.find("input");a=i.find("ts-jumper-results");m();if(!TS.environment.supports_custom_scrollbar)a.monkeyScroll();s=TS.utility.debounceWithPromise(function(e,t){d=true;f(e,t)},l)};var u=function e(){n.val("");_.each(t,function(e){if(e.model_ob._jumper_previous_name_match)e.model_ob._jumper_previous_name_match=void 0});f(t,"");a.scrollTop(0);setTimeout(function(){TS.ui.utility.updateClosestMonkeyScroller(a)},0)};var m=function e(){n.on("input.search",function(){var e=_.trim(n.val());if(r)r.cancel();if(e){TS.metrics.mark("start_jumper_search");TS.metrics.mark("start_jumper_remote_search");I(e)}else u()});n.on("keydown",function(e){if(e.which!=TS.utility.keymap.enter)return;var t=a.find('[data-action="new_channel"]');if(t.length)M();e.stopPropagation()});i.on("click","[data-item-id]",function(){b($(this))});i.on("click",'[data-action="new_channel"]',M);i.on("click.end",function(e){if($(e.target).is("ts-jumper"))TS.ui.jumper.end()})};var f=function e(t,r){if(o)o.cancel();if(!r&&_.trim(n.val()).length>0)return;var s=h(t,r);var l="";var d=false;t=_.uniqBy(t,"model_ob.id");if(0==t.length){l=TS.utility.channels.getPermissibleChannelName(r);if(s)l=null}else d=g(t);var c=_.remove(t,function(e){return e.model_ob.deleted});var u={matches:t,query:r,deleted:c,disambiguate_mpims:d,show_new_channel_link:!!l,clean_name:l,show_extended_search:s,threads_has_unreads:TS.model.threads_has_unreads,threads_mention_count:TS.model.threads_mention_count,show_scores:TS.boot_data.feature_show_jumper_scores&&TS.model.prefs.show_jumper_scores};var m=TS.templates.jumper_results(u).trim();if(t.length||c.length||s)i.removeClass("empty_results");else i.addClass("empty_results");a.html(m).removeClass("show_deleted");if(1===c.length)a.addClass("show_deleted");T(t.concat(c));S();TS.ui.utility.updateClosestMonkeyScroller(a)};var h=function t(i,n){if(d){d=false;return true}if(TS.boot_data.should_use_flannel&&!!n&&i.length<e&&r&&!r.isResolved())o=s(i,n);return false};var g=function e(t){var i=false;if(TS.members.shouldDisplayRealNames()){var n=_.filter(t,"model_ob.is_mpim",true);if(n.length>1)i=true}return i};var p=function e(){a.addClass("show_deleted");var t=i.find("li.deleted").eq(0);if(t.length)TS.kb_nav.highlightItemWithKey(t,true)};var S=function e(){a.one("mousemove",function(){a.one("mousemove",function(){var e=a.find("ol")[0];if(e)e.classList.remove("no_pointer_events")})})};var T=function e(t){TS.kb_nav.end();TS.kb_nav.start(i.find("ol"),"li",i.find("ol"),{bindTo:n[0],allowTabHighlightWhenEmptyInput:true});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){b($(this));e.preventDefault()});if(t.length>0){var a=i.find("li:first");TS.kb_nav.highlightItemWithKey(a,true)}};var v=function e(t){if(!TS.ui.jumper.is_showing)return;if(t.which==TS.utility.keymap.tab)t.preventDefault();if(t.which==TS.utility.keymap.esc){TS.ui.jumper.end();t.preventDefault();t.stopPropagation()}else if(!t.altKey&&TS.utility.cmdKey(t)&&(75==t.which||TS.model.is_our_app&&84==t.which))if(!_.trim(n.val())){TS.ui.jumper.end();t.preventDefault()}else u()};var b=function e(t){if(!t)TS.warn("No $el for Jumper selection");var i=t.data("item-id");if(!i)TS.warn("No ID for Jumper selection");var a;if(t.data("item-team-id"))a=t.data("item-team-id");var r;var s=false;var o=_.trim(n.val());if("deleted_count"===i){p();return}if("G"===i.charAt(0))r=TS.shared.getModelObById(i);else if("C"===i.charAt(0))r=TS.channels.getChannelById(i);else if("V"===i.charAt(0))r=TS.model.getViewById(i);else{if(TS.boot_data.page_needs_enterprise){if(a)s=_.find(TS.boot_data.other_accounts,["id",i])}else s=_.find(TS.boot_data.other_accounts,["id",i]);if(s)r=s;else r=TS.members.getMemberById(i)}TS.ui.frecency.record(r,o);if(s)k(s);else if(r)y(r).then(function(){TS.ui.jumper.end()});else TS.error("Unknown jumper item "+i)};var w=function e(t){var i={item_id:t.id,item_type:t.id.charAt(0)};if(void 0!==t.is_member&&null!==t.is_member)i.is_member=t.is_member;TS.clog.track("QUICKSWITCHER_SELECT",i)};var y=function e(t){if(TS.boot_data.feature_tinyspeck)TS.info("jumper: promising to switch to "+t.id);if(t.is_channel){w(t);TS.channels.displayChannel({id:t.id});return Promise.resolve()}else if(t.is_mpim&&t.is_group){w(t);TS.mpims.displayMpim({id:t.id});return Promise.resolve()}else if(t.is_group&&!t.is_mpim){w(t);TS.groups.displayGroup({id:t.id});return Promise.resolve()}else if(t.is_view){w(t);TS.client.ui.showView(t.id);return Promise.resolve()}else if(t.presence){n.attr("disabled","disabled");w(t);var i=TS.ims.promiseToStartImByMemberId(t.id);var a=setTimeout(function(){A(TS.members.getPrefCompliantMemberName(t))},500);return i.then(function(){clearTimeout(a)},function(e){C();throw e})}return Promise.reject()};var k=function e(t){if(TSSSB.call("displayTeam",t.id)){TS.ui.jumper.end();return}A(t.team_name);TS.prefs.setPrefByAPI({name:TS.ui.frecency.isEnterprise()?"frecency_ent_jumper":"frecency_jumper",value:JSON.stringify(TS.model.frecency_jumper)}).finally(function(){window.location.href=t.team_url})};var A=function e(t){n.attr("disabled","disabled");a.html(TS.templates.jumper_switch_loading({name:t}));TS.ui.utility.updateClosestMonkeyScroller(a)};var C=function e(){n.removeAttr("disabled").trigger("input.search")};var M=function e(){var t=_.trim(n.val());TS.ui.jumper.end();TS.ui.new_channel_modal.start(t)};var I=function t(i){r=TS.searcher.search(i,{members:E(),channels:{include_archived:true},groups:{include_archived:true},mpims:true,teams:true,views:true,tiered:true,sort:true,limit:e}).then(function(e){f(e,i);TS.metrics.measureAndClear("jumper_results","start_jumper_search");return e.promise});r.then(function(e){var t=TS.kb_nav.getHighlightedItem();f(e,i);TS.metrics.measureAndClear("jumper_remote_results","start_jumper_remote_search");if(t){var n=t.data("item-id");var a=TS.kb_nav.getItemByItemId(n);if(a)TS.kb_nav.highlightItemWithKey(a,true)}})};var x=function e(t){var i=TS.shared.getActiveModelOb().id;return i&&i==t.id};var E=function e(){var t=[];if(TS.model.enterprise)t=_(TS.model.enterprise_teams).map("id").filter(function(e){return e!==TS.model.team.id}).value();return{include_org:true,include_slackbot:true,include_self:true,include_deleted:true,full_profile_filter:false,org_team_ids:t}};var B=function t(i){var n=[];var a=[];var r=[];var s=[];_.forEach(i.members,function(e){var t=TS.ims.getImByMemberId(e.id);if(t&&t.unread_cnt&&t.unread_cnt>0)n.push({model_ob:e,score:0});else if(t&&_.trim(t.last_msg_input)&&!x(t)&&!TS.ims.isImWithDeletedMember(t))r.push({model_ob:e,score:0})});_.forEach(i.mpims,function(e){if(e.unread_cnt&&e.unread_cnt>0)n.push({model_ob:e,score:0});else if(_.trim(e.last_msg_input)&&!x(e))r.push({model_ob:e,score:0})});_.forEach(i.groups,function(e){if(e.unread_highlight_cnt&&e.unread_highlight_cnt>0)n.push({model_ob:e,score:0});else if(e.unread_cnt&&e.unread_cnt>0&&!TS.notifs.isCorGMuted(e.id))a.push({model_ob:e,score:0});else if(_.trim(e.last_msg_input)&&!x(e)&&!e.is_archived)r.push({model_ob:e,score:0})});_.forEach(i.channels,function(e){if(e.unread_highlight_cnt&&e.unread_highlight_cnt>0)n.push({model_ob:e,score:0});else if(e.unread_cnt&&e.unread_cnt>0&&!TS.notifs.isCorGMuted(e.id))a.push({model_ob:e,score:0});else if(_.trim(e.last_msg_input)&&!x(e)&&!e.is_archived&&e.is_member)r.push({model_ob:e,score:0})});var o=_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"});if(TS.model.threads_mention_count&&o)n.push({model_ob:o,score:0});else if(TS.model.threads_has_unreads&&o)a.push({model_ob:o,score:0});s=n.concat(a,r);if(!s.length)if(i.channels.length+i.groups.length<10){_.forEach(i.channels,function(e){s.push({model_ob:e,score:0})});_.forEach(i.groups,function(e){s.push({model_ob:e,score:0})})}return s.slice(0,e)}})()},4410:function(e,t){(function(){"use strict";TS.registerModule("utility.box",{onStart:function e(){},launchPopup:function e(){if(!window.BoxSelect)return;var n;try{n=window.open;window.open=function(e,i,a){var r;var s;var o;var l;r=String(a).match(/width\D+(\d+)/);r=parseInt(r&&r[1]||590,10);s=String(a).match(/height\D+(\d+)/);s=parseInt(s&&s[1]||520,10);o=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-r)/2;l=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-s)/2;t=n(e,i,[a,"left="+o,"top="+l].join(","));return t};i().launchPopup();if(window.focus&&t)t.focus()}finally{window.open=n}},closePopup:function e(){if(window.BoxSelect)i().closePopup()},success:function e(t){if(window.BoxSelect)i().success(t)},cancel:function e(t){if(window.BoxSelect)i().cancel(t)},unregister:function e(){if(window.BoxSelect)i().unregister.apply(i(),arguments)},isBrowserSupported:function e(){if(window.BoxSelect)return i().isBrowserSupported()},test:function e(){return{getBoxSelect:i,setBoxSelect:n}}});var e;var t;var i=function t(){if(e)return e;e=new window.BoxSelect({clientId:TS.boot_data.box_app_key,linkType:"shared",multiselect:"true"});TS.utility.box.SUCCESS_EVENT_TYPE=e.SUCCESS_EVENT_TYPE;TS.utility.box.CANCEL_EVENT_TYPE=e.CANCEL_EVENT_TYPE;return e};var n=function t(i){e=i}})()},4411:function(e,t){var i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("ui.inline_edit",{onStart:function t(){var i="."+e+"_inner";var n=".ui_"+e+"_start";$(i).attr("tabindex",0);$(document).on("keydown"+n,i,function(e){if(m)return;if(!$(e.target).is(i))return;var t=13==e.keyCode||32==e.keyCode;if(!t)return;e.preventDefault();var n=h(e);TS.ui.inline_edit.start(n);f=true});$(document).on("focus",".inline_edit_inner",function(e){$(e.target).closest(".inline_edit").addClass("has_focus")});$(document).on("blur",".inline_edit_inner",function(e){$(e.target).closest(".inline_edit").removeClass("has_focus")});$(document).on("click"+n,i,function(e){var t=h(e);e.stopPropagation();TS.ui.inline_edit.start(t)})},start:function t(c,u){if(!c)return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var m=c.find("."+e+"_input");if(!m)return;if(a&&!c.is(a))TS.ui.inline_edit.end();var f=u||_.find(n,function(e){var t=c.data(e.data_attribute)||m.data(e.data_attribute);if(!t)return false;e.arguments={};e.arguments[e.argument_name_for_data_attribute]=t;return true});if("object"!==("undefined"===typeof f?"undefined":i(f)))return;s=f.method_name;o=f.value_name;l=f.arguments;if(!s||!o||"object"!==("undefined"===typeof l?"undefined":i(l)))return;var h="topic"===o?TS.utility.formatTopicOrPurpose:TS.format.formatNoSpecials;d=function e(t){return h(TS.utility.removeLinksFromTabFlow(t))};a=c;r=m;g()},end:function e(){p();v()},containsActiveElement:function e(t){if(!TS.ui.inline_edit.is_showing||!r||!r.length)return false;var i=document.activeElement;var n=$(i);if(!n.is(r))return false;if(t instanceof jQuery&&t[0])t=t[0];if(t.nodeType!==Node.ELEMENT_NODE)return false;return $.contains(t,i)},focus:function t(){a.find("."+e+"_inner").focus()}});var e="inline_edit";var t=["animationend","webkitAnimationEnd","MSAnimationEnd","oAnimationEnd"].join(".ui_"+e+" ")+".ui_"+e;var n=[{data_attribute:"file-id",method_name:"files.edit",value_name:"title",argument_name_for_data_attribute:"file"},{data_attribute:"group-id",method_name:"groups.setTopic",value_name:"topic",argument_name_for_data_attribute:"channel"},{data_attribute:"channel-id",method_name:"channels.setTopic",value_name:"topic",argument_name_for_data_attribute:"channel"}];var a;var r;var s;var o;var l;var d;var c;var u=true;var m=false;var f=false;var h=function t(i){var n=$(i.target);var a=n.closest("."+e);if(!a||!a.length)return;var r=n.closest("a[href]");if(r&&r.length)return;return a};var g=function i(){if(m)return;$(document).off(".ui_"+e).on("keydown.ui_"+e,k).on("mousedown.ui_"+e,A);a.off(".ui_"+e).on("blur.ui_"+e,"."+e+"_input",C).on(t,y);r.off(".ui_"+e).on("paste.ui_"+e,M);c=r.data("inline-edit-unformatted")||r.text();c=TS.format.unFormatMsg(c);r.text(c);a.addClass(e+"_editing");r.attr("contenteditable",true);r.focus();TS.ui.inline_edit.is_showing=true;m=true;I(r)};var p=function t(){if(!m)return;if(r)r.removeAttr("contenteditable");if(a)a.removeClass(e+"_editing");m=false;if(f){TS.ui.inline_edit.focus();f=false}};var S=function t(){u=false;p();a.addClass(e+"_updating").removeClass(e+"_done");var i=function t(){a.removeClass(e+"_updating")};var n=_.clone(l);var d=r[0].innerText;if(!d)d=$("<textarea/>").html(r.html().replace(/<br[^>]*>/,"\n")).text();n[o]=d;TS.api.call(s,n).then(function(){i();w.apply(null,arguments)}).catch(function(){i();b.apply(null,arguments)})};var T=function e(){if(!m)return;if(r)r.html(d(c));p();TS.ui.inline_edit.is_showing=false};var v=function t(){$(document).off(".ui_"+e);if(a)a.off(".ui_"+e);if(r)r.off(".ui_"+e);TS.ui.inline_edit.is_showing=false;m=false;u=true;c=null;l=null;o=null;s=null;r=null;a=null};var b=function t(){r.html(d(c));a.addClass(e+"_done "+e+"_error")};var w=function t(i){var n=i.data||{};if(!n.ok){b(i);return}var s=r.text();if(n.topic)s=n.topic;if(n.file&&n.file.title)s=n.file.title;r.data("inline-edit-unformatted",s);r.html(d(s));a.addClass(e+"_done "+e+"_success")};var y=function t(i){var n=i.originalEvent.animationName;if(n!==e+"_hide_done")return;a.removeClass(e+"_done "+e+"_error "+e+"_success");u=true;if(!m){p();TS.ui.inline_edit.is_showing=false}};var k=function t(i){var n="."+e+"_inner";if(!m)return;if($(i.target).is(n))return;switch(i.which){case TS.utility.keymap.esc:T(i);break;case TS.utility.keymap.enter:if(i.shiftKey||i.altKey)return;i.preventDefault();S()}};var A=function e(t){if(a[0]&&$.contains(a[0],t.target))u=false;else u=true};var C=function e(t){if(!m)return;if(u)T(t);else{r.focus();_.delay(I,0,r)}};var M=function e(t){if(!m)return;t=t.originalEvent||t;var i=window.clipboardData||t.clipboardData;var n=document.queryCommandSupported("insertText")||document.queryCommandSupported("insertHTML");if(document.queryCommandSupported("ms-pasteTextOnly")){t.preventDefault();window.document.execCommand("ms-pasteTextOnly",false)}else if(i&&n){var a=i.getData("text");if(""==a)a=i.getData("text/plain");if(""!==a){t.preventDefault();if(document.queryCommandSupported("insertText"))document.execCommand("insertText",false,a);else document.execCommand("insertHTML",false,_.escape(a))}}};var I=function e(t){if(t.length)t=t[0];var i=document.createRange();i.selectNodeContents(t);var n=window.getSelection();n.removeAllRanges();n.addRange(i)}})()},4412:function(e,t){(function(){"use strict";TS.registerModule("client.unread",{switched_sig:new signals.Signal,switched_away_sig:new signals.Signal,fetched_unreads_sig:new signals.Signal,marked_group_as_read_sig:new signals.Signal,marked_group_as_unread_sig:new signals.Signal,marked_all_as_read:new signals.Signal,marked_all_as_unread:new signals.Signal,new_messages_in_channels:[],messages_loaded:false,last_request_id:"",onStart:function e(){TS.prefs.enable_unread_view_changed_sig.add(C);TS.prefs.enable_unread_view_changed_sig.add(M);TS.channels.message_received_sig.add(v);TS.groups.message_received_sig.add(v);TS.ims.message_received_sig.add(v);TS.mpims.message_received_sig.add(v);TS.channels.message_changed_sig.add(b);TS.groups.message_changed_sig.add(b);TS.ims.message_changed_sig.add(b);TS.mpims.message_changed_sig.add(b);TS.channels.message_removed_sig.add(w);TS.groups.message_removed_sig.add(w);TS.ims.message_removed_sig.add(w);TS.mpims.message_removed_sig.add(w);TS.files.team_file_changed_sig.add(k);TS.channels.deleted_sig.add(A);TS.groups.deleted_sig.add(A);TS.client.login_sig.add(x);TS.client.login_sig.add(R);TS.prefs.all_unreads_sort_order_changed_sig.add(R)},isEnabled:function e(){return!!TS.model.prefs.enable_unread_view},shouldRecordMetrics:function t(){return!!e},debug:function e(t,i){h.push({msg:t,data:i});if(!TS.boot_data.feature_tinyspeck)return;TS.info("[ALL_UNREADS] "+t,i)},showUnreadView:function t(i,n,a){if(!TS.client.unread.isEnabled())return false;i=!!i;n=!!n;var r=n?false:i;var o=TS.client.unreadViewActivated(n,r);if(o)TS.client.unread.switched_sig.dispatch();else return false;if(TS.msg_edit.editing_in_msg_pane)TS.msg_edit.resetEditUI();u=a;e=TS.utility.enableFeatureForUser(1);if(e)TS.metrics.mark("unread_view_time_to_display");I();s=TS.interop.datetime.makeTsStamp(null,{padder:"0",uniqueNum:9});TS.client.ui.unread.showUnreadView();if(e)TS.metrics.count("unread_view_displayed");if(e)TS.metrics.mark("unread_view_time_spent");if(m){m=false;TS.metrics.count("unread_view_coachmark_conversion")}return true},destroyUnreadView:function t(){if(!TS.client.ui.unread.isUnreadViewDOMShowing())return;if(e)TS.metrics.measureAndClear("unread_view_time_spent","unread_view_time_spent");TS.client.ui.unread.destroyUnreadView();I();TS.client.unread.switched_away_sig.dispatch()},reloadIfPendingMessages:function e(){if(TS.client.unread.getTotalNewUnreadCount()>0&&TS.client.unread.new_messages_in_channels.length)TS.client.unread.reload()},reload:function e(){u=void 0;TS.client.ui.unread.removeEmptyState();I();TS.client.ui.unread.restart()},getGroup:function e(i){return _.find(t,{model_ob:{id:i}})},getAllGroups:function e(){return t},collapseGroup:function e(n,a){if(a)TS.api.call("unread.collapse",{channel:n.id});n.collapsed=true;n.hidden_msgs=n.msgs;n.msgs=[];if(o&&o.id===n.id){t=t.concat(i);TS.client.ui.unread.addMessageContainerGroups(i);F()}return n},expandGroup:function e(n,r){n.collapsed=false;if(r)TS.api.call("unread.expand",{channel:n.id});if(n.msgs.length>0){n.new_unread_msgs=n.msgs;n.new_unread_cnt=n.new_unread_msgs.length;n.msgs=[]}n.msgs=n.msgs.concat(n.hidden_msgs);T(n,"msgs");n.hidden_msgs=[];if(n.has_more){var s=_.findIndex(t,{id:n.id});i=t.splice(s+1);TS.client.ui.unread.removeMessageContainerGroup(_.map(i,"id"));o=n;l=a;a=false}return n},markGroupAsRead:function t(i,n){var a=null;i.previous_read_ts=i.model_ob.last_read;i.marked_as_read_cnt=i.total_unreads;i.marked_as_read=true;i.total_unreads=0;i.manually_marked_unread_msg=null;if(!n){TS.shared.markReadMsg(i.model_ob.id,TS.client.unread.getMarkerTS(i),a);if(e)TS.metrics.store("unread_view_mark_model_read",i.marked_as_read_cnt,{is_count:true})}TS.client.unread.marked_group_as_read_sig.dispatch(i);return i},markGroupAsUnread:function e(t){TS.shared.markReadMsg(t.model_ob.id,t.previous_read_ts,null);t.marked_as_read=false;t.manually_marked_unread_msg=null;n=t.id;t.total_unreads=t.marked_as_read_cnt;t.marked_as_read_cnt=0;TS.client.unread.marked_group_as_unread_sig.dispatch(t);return t},markAllAsRead:function i(){var n=true;var r={};var s=0;t.forEach(function(e){r[e.id]=TS.client.unread.getMarkerTS(e);TS.client.unread.markGroupAsRead(e,n);s+=e.msgs.length});if(e)TS.metrics.count("unread_view_mark_all_read");if(e)TS.metrics.store("unread_view_mark_all_read_count",s,{is_count:true});if(a){TS.api.call("unread.markRead",{markers:JSON.stringify(r)});TS.client.ui.unread.displayEmptyState(s);TS.client.unread.marked_all_as_read.dispatch()}else TS.api.call("unread.markRead",{markers:JSON.stringify(r)}).then(function(){if(!TS.model.unread_view_is_showing)return;TS.client.unread.reload();TS.client.unread.marked_all_as_read.dispatch()});var o={unread_count:s,request_id:TS.client.unread.last_request_id};TS.clog.track("UNREADS_MARK_ALL_AS_READ",o)},markAllAsUnread:function e(){t.forEach(function(e){TS.client.unread.markGroupAsUnread(e)});TS.client.ui.unread.removeEmptyState();TS.client.unread.marked_all_as_unread.dispatch(t);var i={request_id:TS.client.unread.last_request_id};TS.clog.track("UNREADS_MARK_ALL_AS_UNREAD",i)},getMarkerTS:function e(t){var i=TS.client.unread.getNewestMsgTs(t);if(!i||i<s)i=s;return i},updateGroupWithNewMessages:function e(t){if(t.new_unread_msgs){t.msgs=t.new_unread_msgs.concat(t.msgs);T(t,"msgs");t.total_unreads+=t.new_unread_cnt;t.new_unread_cnt=0;t.new_unread_msgs=[];t.marked_as_read=false;t.collapsed=false;TS.client.unread.new_messages_in_channels=_.without(TS.client.unread.new_messages_in_channels,t.id);TS.client.ui.unread.showOrHideRefreshButton()}return t},moveNewUnreadsOntoHiddenMsgs:function e(t){if(t.collapsed&&t.marked_as_read&&t.new_unread_msgs.length){t.hidden_msgs=t.new_unread_msgs;T(t,"msgs");t.new_unread_cnt=0;t.new_unread_msgs=[];t.msgs=[];t.total_unreads=t.hidden_msgs.length;t.marked_as_read=false;TS.client.unread.new_messages_in_channels=_.without(TS.client.unread.new_messages_in_channels,t.id);TS.client.ui.unread.showOrHideRefreshButton()}return t},getNewestMsgTs:function e(t){return t.msgs&&t.msgs.length?t.msgs[0].ts:null},promiseToGetMoreMessages:function t(){TS.client.unread.debug("promiseToGetMoreMessages");if(!u&&!n&&!TS.client.unread.getAllCurrentlyUnreadGroups().length){TS.client.unread.debug("DONE FETCHING: First fetch, not from boot, nothing in global model is unread, marking all msgs as fetched");a=true;p()}if(a){TS.client.unread.debug("NO FETCHING: All messages are fetched");return Promise.resolve({groups:[],has_more:false})}clearTimeout(c);c=setTimeout(function(){TS.client.ui.unread.displaySlowLoadingMessage()},5e3);r=new Promise(function(t,r){TS.experiment.loadUserAssignments().then(function(){var l=[];var d;if(n)if(e)TS.metrics.count("unread_view_scroll");if(o){var u=o.id;d={channel:o.id,oldest:TS.client.unread.getNewestMsgTs(o)||o.model_ob.last_read,latest:s,always_asc:true,ignore_replies:true,include_pin_count:true};TS.client.unread.debug("Backfilling using api_args: ",_.clone(d));TS.api.call(TS.shared.getHistoryApiMethodForModelOb(o.model_ob),d).then(function(e){clearTimeout(c);if(!TS.model.unread_view_is_showing)return;TS.client.unread.last_request_id=e.request_id;if(o||o.id!=u){var n={channels:[{channel_id:o.id,messages:e.data.messages,has_more:e.data.has_more}],channels_count:1,total_messages_count:null};if(!e.data.has_more)n.groups=i;var s=S(n,l);if(!e.data.has_more){F();s.has_more=!a}t(s)}else r(new Error("channels.history rejected because we are no longer backfilling or we are backfilling a different group"));return null}).catch(function(e){TS.console.logError(e,"all_unreads_fatal_error");clearTimeout(c);TS.client.ui.unread.displayFatalError()})}else{d={timestamp:s,sort:TS.client.unread.getSortOrder()};if(n){d.current_channel=n;var m=TS.client.unread.getGroup(n);if(m)if(m.collapsed){d.current_channel_timestamp=s;l.push(n)}else if(TS.client.unread.getNewestMsgTs(m))d.current_channel_timestamp=TS.client.unread.getNewestMsgTs(m)}if(e||TS.boot_data.feature_tinyspeck)TS.metrics.mark("unread_history_sort_marker");TS.client.unread.debug("Regular fetch using api_args: ",_.clone(d));TS.api.call("unread.history",d).then(function(i){if(e||TS.boot_data.feature_tinyspeck)TS.metrics.measureAndClear("unread_history_sort_"+d.sort,"unread_history_sort_marker");clearTimeout(c);if(!TS.model.unread_view_is_showing)return;TS.client.unread.last_request_id=i.request_id;if(o)r(new Error("unread.history rejected because we are now backfilling"));else t(S(i.data,l,!n));return null}).catch(function(e){TS.error(e);clearTimeout(c);TS.client.ui.unread.displayFatalError()})}return null})});return r},getMessage:function e(t,i){if(!TS.model.unread_view_is_showing)return null;var n;var a;n=TS.client.unread.getGroup(t.id);if(n)a=TS.utility.msgs.getMsg(i,n.msgs);if(!a&&TS.boot_data.feature_sli_briefing&&TS.highlights_briefing)a=TS.highlights_briefing.getMessageFromCache(t.id,i);if(a)return a;return null},getTotalMessagesCount:function e(){return t.reduce(function(e,t){return!t.marked_as_read?e+t.msgs.length:e},0)},getCurrentModelID:function e(){return n},areAllMessagesFetched:function e(){return a},getAllCurrentlyUnreadGroups:function e(){return TS.channels.getUnarchivedChannelsForUser().concat(TS.groups.getUnarchivedGroups(),TS.model.mpims,TS.model.ims).filter(function(e){return e.unread_cnt>0})},getTotalNewUnreadCount:function e(){var i=t.reduce(function(e,t){return t.new_unread_msgs?e+t.new_unread_msgs.length:e},0);if(d)i=Object.keys(d).reduce(function(e,t){return e+d[t].length},i);return i},moveActiveMarker:function e(i){var n=0;var a=_.findIndex(t,{active:true});if(-1!=a)n=i?a-1:a+1;if(n>=0&&t[n]){if(t[a])t[a].active=false;t[n].active=true;return t[n]}},setActiveGroup:function e(t){var i=TS.client.unread.getActiveGroup();if(i)i.active=false;t.active=true;return t},getActiveGroup:function e(){return _.find(t,{active:true})},getSortOrder:function e(){return f},getHighlightsForMessages:function e(t){_.map(t.channels,function(e){var t=TS.shared.getModelObById(e.channel_id);if(e.messages.length&&e.total_unreads>=10)TS.client.highlights.getHighlightsForMessages({channel:t,timestamps:_.map(e.messages,"ts"),channel_open_ts:s})})},test:function e(){var c={_current_model_ob_id:null,_processResp:S,_resetData:I,_messageReceived:v,_appendNewUnreadToGroup:y,_messageChanged:b,_messageRemoved:w,_toggleUnreadView:C,_groups:[],_all_messages_fetched:false,_more_messages_p:void 0,_init_timestamp:void 0};Object.defineProperty(c,"_processResp",{get:function e(){return S},set:function e(t){S=t}});Object.defineProperty(c,"_resetData",{get:function e(){return I},set:function e(t){I=t}});Object.defineProperty(c,"_current_model_ob_id",{get:function e(){return n},set:function e(t){n=t}});Object.defineProperty(c,"_groups",{get:function e(){return t},set:function e(i){t=i}});Object.defineProperty(c,"_all_messages_fetched",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(c,"_more_messages_p",{get:function e(){return r},set:function e(t){r=t}});Object.defineProperty(c,"_messageReceived",{get:function e(){return v},set:function e(t){v=t}});Object.defineProperty(c,"_messageChanged",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(c,"_messageRemoved",{get:function e(){return w},set:function e(t){w=t}});Object.defineProperty(c,"_appendNewUnreadToGroup",{get:function e(){return y},set:function e(t){y=t}});Object.defineProperty(c,"_toggleUnreadView",{get:function e(){return C},set:function e(t){C=t}});Object.defineProperty(c,"_init_timestamp",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(c,"_backfilling_for_group",{get:function e(){return o},set:function e(t){o=t}});Object.defineProperty(c,"_excluded_groups",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(c,"_orphan_new_msgs",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(c,"_direct_from_boot",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(c,"_sortAndDedupe",{get:function e(){return T},set:function e(t){T=t}});Object.defineProperty(c,"_backfilling_was_all_fetched",{get:function e(){return l},set:function e(t){l=t}});return c}});var e;var t=[];var i=[];var n=null;var a=false;var r;var s;var o=null;var l;var d={};var c;var u;var m=false;var f;var h=[];var g=[];var p=function e(){if(u)return;var t=TS.client.unread.getAllCurrentlyUnreadGroups();var i=[];t.forEach(function(e){if(-1===g.indexOf(e.id)&&TS.shared.getOldestUnreadTsForId(e.id)<s)i.push(e)});if(i.length>0){TS.metrics.count("unread_view_consistency_fail");TS.metrics.count("unread_view_consistency_fail_count",i.length);TS.client.unread.debug("Consistency check: Init timestamp",s);TS.client.unread.debug("Consistency check: Unread models",_.map(t,"id"));TS.client.unread.debug("Consistency check: Mismatched models: ",_.map(i,"id"));TS.client.unread.debug("Consistency check: Mismatched model timestamps: ",_.map(i,function(e){return TS.shared.getOldestUnreadTsForId(e.id)}));i.forEach(function(e){var t=TS.shared.getOldestUnreadTsForId(e.id);var i=e.msgs.filter(function(e){return e>=t});TS.client.unread.debug("Mismatch details",{id:e.id,oldest_unread_ts:t,mismatch_msg_cnt:i.length,msgs_details:_.map(_.take(i,10),function(e){return{type:e.type,subtype:e.subtype,ts:e.ts}})})});if(1===i.length&&TS.shared.getActiveModelOb()&&TS.shared.getActiveModelOb().id===i[0].id)TS.metrics.count("unread_view_consistency_fail_last_active");if(i.length>2)TS.logError(h,"all_unreads_consistency_debug")}};var S=function i(r,s,o){s=s||[];var l={groups:[],has_more:true};TS.info("Received unread view response: "+r.channels_count+" channels; "+r.total_messages_count+" total messages ("+(o?"first fetch":"subsequent fetch")+")");TS.client.unread.debug("Process response starting info:",{first_fetch:o,skip_channels:s,channels_count:r.channels_count,total_messages_count:r.total_messages_count,channels:r.channels.map(function(e){return{channel_id:e.channel_id,msg_count:e.messages?e.messages.length:null,collapsed:e.collapsed,total_unreads:e.total_unreads,has_more:e.has_more}})});if(o){if(e)TS.metrics.count("unread_view_fetched_channels_first",r.channels_count);if(e)TS.metrics.count("unread_view_fetched_messages_first",r.total_messages_count)}if(r.channels.length&&s.length)_.remove(r.channels,function(e){return-1!==s.indexOf(e.channel_id)});if(0===r.channels.length||1===r.channels.length&&!r.channels[0].has_more&&(!r.channels[0].messages||0===r.channels[0].messages.length)){a=true;l.has_more=false;TS.client.unread.debug("DONE FETCHING: API response had no messages",r.channels.length);p();return l}if(1===r.channels.length&&0===r.channels[0].messages.length&&r.channels[0].collapsed&&TS.client.unread.getGroup(r.channels[0].channel_id)&&TS.client.unread.getGroup(r.channels[0].channel_id).collapsed&&0===TS.client.unread.getGroup(r.channels[0].channel_id).msgs.length){a=true;l.has_more=false;TS.client.unread.debug("DONE FETCHING: Received only one collapsed group with zero messages");p();return l}var c=_.last(r.channels);var m=c.has_more;r.channels.forEach(function(e){n=e.channel_id;var i=TS.shared.getModelObById(n);var a=TS.client.unread.getGroup(n);var r=[];g.push(e.channel_id);if(a){r=e.messages.map(function(e){return TS.utility.msgs.processImsg(e,i.id)});r=a.msgs.concat(r);if(a.collapsed){a.hidden_msgs=a.hidden_msgs.concat(r);a.marked_as_read_cnt=a.hidden_msgs.length}else a.msgs=r;a.has_more=e.has_more;if(!a.has_more)a.total_unreads=r.filter(function(e){return!e.no_display}).length}else{if(!e.has_more&&!e.collapsed&&!e.messages.length){TS.warn("Received model_ob with no messages for unread view: "+n);TS.client.unread.debug("all_unreads_ignored_channel no msgs",{current_model_ob_id:n,unread_obj_id:e.channel_id,has_more:e.has_more,collapsed:!!e.collapsed,msg_count:e.messages.length});return}if(!(o&&u)&&0===i.unread_cnt){TS.client.unread.debug("all_unreads_ignored_channel model_ob has no unreads",{current_model_ob_id:n,unread_obj_id:e.channel_id,model_ob_id:i.id,model_ob_unread_cnt:i.unread_cnt,first_fetch:o,direct_from_boot:u});return}r=e.messages.map(function(e){return TS.utility.msgs.processImsg(e,i.id)});a={id:n,order:t.length,msgs:r,hidden_msgs:[],model_ob:i,marked_as_read:false,new_unread_cnt:0,collapsed:e.collapsed,total_unreads:e.total_unreads,has_more:e.has_more};if(!a.has_more)a.total_unreads=r.filter(function(e){return!e.no_display}).length;t.push(a)}if(!a.has_more&&d[a.id]){d[a.id].forEach(function(e){y(a,e)});delete d[a.id]}T(a,"msgs");TS.client.unread.messages_loaded=true;l.groups.push(a)});if(r.groups)r.groups.forEach(function(e){t.push(e);l.groups.push(e);m=e.has_more});if(!m){a=true;l.has_more=false}if(o&&t.length&&!TS.client.unread.getActiveGroup())t[0].active=true;TS.client.unread.debug("Process response, processed data",{has_more:l.has_more,touched_groups:l.groups.map(function(e){return{channel_id:e.id,has_more:e.has_more,msg_count:e.msgs.length,marked_as_read:e.marked_as_read,collapsed:e.collapsed}}),all_groups:t.map(function(e){return{channel_id:e.id,has_more:e.has_more,msg_count:e.msgs.length,marked_as_read:e.marked_as_read,collapsed:e.collapsed}})});if(!m){TS.client.unread.debug("DONE FETCHING: Last group has no more messages");p()}TS.client.unread.getHighlightsForMessages(r);return l};var T=function e(t,i){i=i||"msgs";TS.utility.msgs.sortMsgs(t[i]);t[i]=_.uniqBy(t[i],"ts");return t};var v=function e(t,i){if(!TS.model.unread_view_is_showing)return;if(TS.utility.msgs.isMsgHidden(i))return;if(i.is_ephemeral)return;if(i.user===TS.model.user.id)return;if(_.startsWith(i.subtype,"sh_room"))return;if(TS.utility.msgs.isMsgHidden(i))return;if(TS.utility.msgs.msgMightBeRolledUp(i))return;var n=t.is_channel&&t.is_archived||TS.notifs.isCorGMuted(t.id);if(!n&&TS.client.ui.unread.isFatalErrorDisplaying()){TS.client.unread.reload();return}var a=TS.client.unread.getGroup(t.id);if(a)TS.client.ui.unread.updateNewMessagesMessage(y(a,i));else if(!t.is_channel||!n){if(!d[t.id])d[t.id]=[];d[t.id].push(i)}if(!n)if(-1===_.indexOf(TS.client.unread.new_messages_in_channels,t.id))TS.client.unread.new_messages_in_channels.push(t.id);TS.client.ui.unread.showOrHideRefreshButton()};var b=function e(t,i){if(!TS.model.unread_view_is_showing)return;if(d[t.id]){var n=_.findIndex(d[t.id],{ts:i.ts});d[t.id].splice(n,1,TS.utility.msgs.processImsg(i,t.id))}var a=TS.client.unread.getGroup(t.id);if(!a)return;var r=_.findIndex(a.msgs,{ts:i.ts});var s=_.findIndex(a.new_unread_msgs,{ts:i.ts});if(s>=0)a.msgs.splice(s,1,TS.utility.msgs.processImsg(i,t.id));if(r>=0){a.msgs.splice(r,1,TS.utility.msgs.processImsg(i,t.id));TS.client.ui.unread.updateMsgs()}};var w=function e(t,i){if(!TS.model.unread_view_is_showing)return;if(d[t.id]){_.remove(d[t.id],{ts:i.ts});if(!d[t.id].length)delete d[t.id]}var n=TS.client.unread.getGroup(t.id);if(!n){if(!d[t.id])_.pull(TS.client.unread.new_messages_in_channels,t.id);TS.client.ui.unread.showOrHideRefreshButton();return}var a=_.findIndex(n.msgs,{ts:i.ts});var r=_.findIndex(n.new_unread_msgs,{ts:i.ts});if(r>=0){n.new_unread_msgs.splice(r,1);n.new_unread_cnt=n.new_unread_msgs.length;TS.client.ui.unread.updateNewMessagesMessage(n)}if(a>=0){n.msgs.splice(a,1);n.total_unreads-=1;if(0===n.msgs.length)A(n.model_ob);else TS.client.ui.unread.updateMsgs()}};var y=function e(t,i){var n=_.find(t.msgs,{ts:i.ts});if(n)return t;if(!t.first_new_unread_ts)t.first_new_unread_ts=i.ts;i=TS.utility.msgs.processImsg(i,t.id);if(!t.new_unread_msgs)t.new_unread_msgs=[];t.new_unread_msgs.push(i);T(t,"new_unread_msgs");t.new_unread_cnt=t.new_unread_msgs.length;return t};var k=function e(i){if(!TS.model.unread_view_is_showing)return;var n=_.intersection(_.map(t,"id"),i.channels.concat(i.ims,i.groups));if(!n.length)return;n.forEach(function(e){var t=TS.client.unread.getGroup(e);t.msgs.forEach(function(e){if(!i.is_deleted&&("file_share"===e.subtype||"file_mention"===e.subtype||"file_comment"===e.subtype)&&e.file&&e.file.id==i.id);else if(e.attachments&&e.attachments.length&&TS.inline_attachments.getAttachmentBySlackFileId(e.attachments,i.id));else return;if("hosted"===i.mode||"external"===i.mode)if(i.comments.length||!i.is_tombstoned)b(t.model_ob,e);else return;TS.client.ui.unread.rebuildMsgFile(e,i)})})};var A=function e(i){var a=TS.client.unread.getGroup(i.id);if(a){TS.client.ui.unread.removeMessageContainerGroup([i.id]);_.remove(t,{id:i.id});if(n===i.id){var r=_.last(t);if(r)n=r.id}TS.client.ui.unread.updateMsgs()}};var C=function e(){TS.client.ui.unread.toggleUnreadView();if(!TS.model.prefs.enable_unread_view&&TS.model.unread_view_is_showing){TS.client.displayModelOb(TS.shared.getActiveModelOb());TS.client.unread.destroyUnreadView()}};var M=function e(){TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{enable_unread_view:TS.model.prefs.enable_unread_view.toString()}})};var I=function e(){o=null;l=void 0;i=[];a=false;n=null;t=[];r=void 0;s=TS.interop.datetime.makeTsStamp(null,{padder:"0",uniqueNum:9});TS.client.unread.new_messages_in_channels=[];d={};if(c){clearTimeout(c);c=null}h=[];g=[]};var x=function e(){TS.channels.unread_changed_sig.add(D);TS.groups.unread_changed_sig.add(D);TS.ims.unread_changed_sig.add(D);TS.mpims.unread_changed_sig.add(D)};var E=function e(){TS.channels.unread_changed_sig.remove(D);TS.groups.unread_changed_sig.remove(D);TS.ims.unread_changed_sig.remove(D);TS.mpims.unread_changed_sig.remove(D)};var B=_.throttle(function(){P();var e=TS.model.all_unread_cnt>0&&TS.client.unread.getAllCurrentlyUnreadGroups().length>0;TS.client.ui.unread.updateChannelPaneUnreadState(e)},1e3);var D=function e(){if(TS.boot_data.feature_react_sidebar){P();var t=TS.model.all_unread_cnt>0&&TS.client.unread.getAllCurrentlyUnreadGroups().length>0;TS.redux.all_unreads.updateHasUnreads(t)}else B()};var F=function e(){if(o){i=[];o=null;a=l;l=void 0;TS.client.ui.unread.setMessageContainerHasMoreEnd(!a)}};var P=function e(){if(TS.client.unread.isEnabled()||TS.model.prefs.seen_unread_view_coachmark)return;if(TS.client.unread.isEnabled()||TS.model.prefs.seen_unread_view_coachmark){E();return}if(TS.model.all_unread_cnt>100){var t=TS.client.unread.getAllCurrentlyUnreadGroups();if(t.length>7){E();O()}}};var O=function e(){if(TS.client.unread.isEnabled())return;if(TS.model.prefs.seen_unread_view_coachmark)return;TS.model.prefs.seen_unread_view_coachmark=true;TS.prefs.setMultiPrefsByAPI({enable_unread_view:true,seen_unread_view_coachmark:true},function(){TS.metrics.count("unread_view_coachmark_displayed");m=true;$("#channels_scroller").scrollTop(0);TS.coachmark.start(TS.coachmarks.coachmarks.unread_view)});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{enable_unread_view:"true"}})};var R=function e(){if(TS.model.prefs.all_unreads_sort_order)f=TS.model.prefs.all_unreads_sort_order;else if(""!==TS.model.team.plan)f="priority";else f="alphabetical"}})()},4413:function(e,t){(function(){"use strict";TS.registerModule("client.ui.unread",{$channel_pane_item:$("#channels_scroller .all_unreads"),$scroller:$("#unread_msgs_scroller_div"),$loading_msg_container:null,$unread_msgs_div:null,$container:null,unread_groups:[],msgs_rendered_sig:new signals.Signal,started_sig:new signals.Signal,sli_link_briefings_and_unreads:void 0,onStart:function e(){TS.client.ui.unread.promise_to_get_briefings_experiment=TS.experiment.loadUserAssignments().then(function(){TS.client.ui.unread.sli_link_briefings_and_unreads=TS.experiment.getGroup("sli_link_briefings_and_unreads");TS.client.ui.unread.promise_to_get_briefings_experiment=null})},showUnreadView:function i(){TS.channels.renamed_sig.add(S);TS.groups.renamed_sig.add(S);TS.inline_file_previews.collapse_sig.add(k);TS.inline_file_previews.expand_sig.add(k);TS.inline_others.collapse_sig.add(k);TS.inline_others.expand_sig.add(k);TS.inline_audios.collapse_sig.add(k);TS.inline_audios.expand_sig.add(k);TS.inline_videos.collapse_sig.add(k);TS.inline_videos.expand_sig.add(k);TS.inline_room_previews.toggle_sig.add(k);TS.inline_imgs.expand_sig.add(k);TS.inline_imgs.collapse_sig.add(k);TS.inline_attachments.expand_sig.add(k);TS.inline_attachments.collapse_sig.add(k);if(TS.boot_data.feature_sli_briefing)TS.highlights_briefing.updated_sig.add(k);TS.client.highlights.updated_sig.add(TS.client.ui.unread.rebuildMsgsWithHighlights);TS.client.highlights.feedback_submitted_sig.add(TS.client.ui.unread.maybeRebuildMsgsWithHighlightsFeedback);if(TS.useReactSidebar())TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem("Vall_unreads"));TS.view.members.unknown_resolution_rebuild_sig.add(E);c=Date.now();f=false;$("#client-ui").addClass("unread_view_is_showing");if("details"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex(true);var a=true;TS.client.msg_pane.hideNewMsgsBar(a);TS.client.ui.unread.$scroller.html(TS.templates.unread_main());TS.client.ui.unread.$unread_msgs_div=$("#unread_msgs_div");h=true;TS.client.ui.unread.displayLoadingMessage();if(TS.environment.supports_custom_scrollbar)TS.client.ui.unread.$container=$("#unread_msgs_scroller_div");else{TS.client.ui.unread.$scroller.monkeyScroll();TS.client.ui.unread.$container=$("#monkey_scroll_wrapper_for_unread_msgs_scroller_div")}$("#footer").addClass("hidden");p();TS.view.resize_sig.add(p);TS.client.ui.unread.$unread_msgs_div.on("click.unread",".bottom_mark_all_read_btn",function(){TS.client.unread.markAllAsRead()});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_mark",function(e){var t=$(e.target).closest(".unread_group").data("model-id");var i=TS.client.unread.getGroup(t);if(!i||i.marked_as_read)return;TS.client.ui.unread.markGroupAsRead(t)});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_undo > a",function(e){TS.client.ui.unread.markGroupAsUnread($(e.target).closest(".unread_group").data("model-id"))});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_header_name .channel_link, .unread_group_header_name .mpim_link, .unread_group_header_name .internal_im_link",function(){if(TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_channel_navigation")});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_new",function(e){var t=TS.client.unread.getGroup($(e.target).closest(".unread_group").data("model-id"));if(t.collapsed){if(t.marked_as_read)TS.client.unread.moveNewUnreadsOntoHiddenMsgs(t);TS.client.ui.unread.expandGroup(t)}else TS.client.ui.unread.updateGroupWithNewMessages(t)});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_collapse_toggle",function(e){var t=TS.client.unread.getGroup($(e.target).closest(".unread_group").data("model-id"));if(t){var i={channel_id:t.id,channel_type:t.id[0]||"",request_id:TS.client.unread.last_request_id};if(t.collapsed){TS.client.ui.unread.expandGroup(t,{persist_state:true});TS.clog.track("UNREADS_EXPAND_GROUP",i)}else{var n=w(t);var a=n.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(t,a,{persist_state:true});TS.clog.track("UNREADS_COLLAPSE_GROUP",i)}}});o=false;$(window).on("keydown.unread",T);if(!TS.environment.supports_sticky_position){if($("body").hasClass("banner_showing"))A();TS.ui.banner.show_hide_sig.add(A);var r=new signals.Signal;n=_.throttle(y,16,{leading:true,trailing:false});TS.client.ui.unread.$scroller.on("scroll",n);r.add(k)}e={name:"unread",container:$("#unread_msgs_div"),scroller:$("#unread_msgs_scroller_div"),page_size:25,sections:[],has_more_beginning:false,has_more_end:false,updated_sig:r,promiseToLoadMoreAtEnd:function e(){return TS.client.ui.unread.promiseToShowNextPage()},buildMsgHTML:function e(i,n,a){var r=$(TS.templates.builders.msgs.buildHTML({msg_dom_id:TS.templates.makeMsgDomIdInUnreadView(i.ts),msg:i,model_ob:a.model_ob,prev_msg:n,container_id:"unread_msgs_div",enable_slack_action_links:true,hide_actions:false,from_all_unreads:true}));if(t)r.css("opacity",0);return r},buildSection:function e(t){return TS.templates.unread_group(C(t))},buildDayDivider:function e(i,n){var a=n.ts;var r=TS.interop.datetime.toDateObject(a);var s=TS.interop.datetime.isToday(r);var o=$(TS.templates.unread_day_divider({ts:a,is_today:s}));if(t)o.css("opacity",0);return o},updateCallback:function e(t){var i=TS.client.unread.getAllGroups().map(function(e){return e.manually_marked_unread_msg});t.added.forEach(function(e){if(!e.data("ts"))return;var t=e.data("ts");if(i.indexOf(t)>=0){var n=e.data("modelObId");x(t,n,e)}});TS.client.ui.unread.msgs_rendered_sig.dispatch(t)}};if(TS.boot_data.feature_sli_briefing)_.assign(e,{afterPageDown:function e(t){if(!t)TS.highlights_briefing.hideBriefing()},afterPageUp:function e(t){if(t)TS.highlights_briefing.showBriefing()}});TS.ui.message_container.register(e);g();TS.client.ui.unread.$scroller.attr("tabindex","-1");if(!TS.boot_data.feature_keyboard_navigation)TS.client.ui.unread.$scroller.get(0).focus();var s=true;TS.client.ui.rebuildAllButMsgs(s);TS.client.ui.unread.ensureSliLinkBriefingsAndUnreads().then(function(){if(!TS.client.ui.unread.sliLinkBriefingsAndUnreads())TS.client.ui.unread.promiseToShowNextPage().then(function(){if(TS.client.unread.shouldRecordMetrics())TS.metrics.measureAndClear("unread_view_time_to_display","unread_view_time_to_display");if(!TS.model.unread_view_is_showing)return;if(TS.client.unread.getAllGroups().length)I();else{var e;var t=true;TS.client.ui.unread.displayEmptyState(e,t)}});if(TS.client.ui.unread.sliLinkBriefingsAndUnreads())Promise.all([TS.client.ui.unread.promiseToShowNextPage(),TS.highlights_briefing.promiseToGetBriefing()]).then(function(e){var t=e[1];if(TS.client.unread.shouldRecordMetrics())TS.metrics.measureAndClear("unread_view_time_to_display","unread_view_time_to_display");if(!TS.model.unread_view_is_showing)return;if(TS.client.unread.getAllGroups().length){TS.highlights_briefing.showBriefingWithResponse(t);I()}else{var i;var n=true;TS.client.ui.unread.displayEmptyState(i,n)}})});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".message[data-ts]",function(e){if(e.altKey){var t=$(e.target).closest(".message");var i=t.data("ts");var n=$(e.target).closest(".message").data("modelObId");x(i,n,t)}});$(".channels_nav_unread").scrollintoview({offset:"top",px_offset:50,scroller:TS.client.channel_pane.$scroller});TS.clog.track("UNREADS_OPEN",{});TS.client.ui.unread.started_sig.dispatch()},promiseToShowNextPage:function e(){if(s&&s.isPending())return s;s=TS.client.unread.promiseToGetMoreMessages().then(function(e){if(!TS.model.unread_view_is_showing)return;u.unreads_page+=1;TS.client.ui.unread.updateHeaders(e.groups);TS.client.ui.unread.addMessageContainerGroups(e.groups);TS.client.ui.unread.setMessageContainerHasMoreEnd(!!e.has_more);p();M();if(l){var t=false;var i=TS.client.unread.getActiveGroup();var n=TS.client.unread.moveActiveMarker(t);v(n,i,{collapse_current_group:false});l=false}s=null;return null}).catch(function(e){TS.error(e)});return s},removeMessageContainerGroup:function t(i){e.sections=e.sections.filter(function(e){return-1===i.indexOf(e.id)});e.has_more_end=true;return e},addMessageContainerGroups:function t(i){_.forEach(i,function(t){var i=TS.client.unread.getGroup(t.id);var n=_.findIndex(e.sections,{id:i.id});if(-1===n)e.sections.push(i)})},updateHeaders:function t(i){_.forEach(i,function(t){var i=TS.client.unread.getGroup(t.id);var n=_.findIndex(e.sections,{id:i.id});if(-1!==n)TS.client.ui.unread.updateHeader(i)})},setMessageContainerHasMoreEnd:function t(i){e.has_more_end=i},restart:function t(){TS.client.ui.unread.showOrHideRefreshButton();TS.ui.message_container.cleanup(e);TS.client.ui.unread.$unread_msgs_div.empty();e.sections=[];e.has_more_end=false;TS.ui.message_container.register(e);h=true;TS.client.ui.unread.displayLoadingMessage();g();f=false;TS.client.ui.unread.promiseToShowNextPage().then(function(){if(!TS.model.unread_view_is_showing)return;if(TS.client.unread.getAllGroups().length)I();else{var e;var t=true;TS.client.ui.unread.displayEmptyState(e,t)}})},createLoadingMsgHTML:function e(){var t=$('<div class="unread_msgs_loading"><div class="unread_msgs_loading_msg"></div></div>');TS.client.ui.unread.$scroller.after(t);TS.client.ui.unread.$loading_msg_container=t},displayLoadingMessage:function e(t){if(!TS.client.ui.unread.$loading_msg_container)TS.client.ui.unread.createLoadingMsgHTML();TS.client.ui.unread.$loading_msg_container.removeClass("hidden");var i=TS.i18n.t("Loading messages...","unread")();var n=t||i;TS.client.ui.unread.$loading_msg_container.find(".unread_msgs_loading_msg").text(n)},hideLoadingMessage:function e(){TS.client.ui.unread.$loading_msg_container.addClass("hidden")},displaySlowLoadingMessage:function e(){if(!h)return;var t=TS.i18n.t("Still loading... sorry for the long wait!","unread")();TS.client.ui.unread.displayLoadingMessage(t)},isFatalErrorDisplaying:function e(){return $("#messages_container .unread_error_state").length},displayFatalError:function e(){TS.client.ui.unread.hideLoadingMessage();TS.client.ui.unread.$scroller.addClass("invisible");$("#messages_container .unread_empty_state_wrapper").remove();$("#messages_container").prepend(TS.templates.unread_error({emoji:new Handlebars.SafeString(TS.emoji.graphicReplace(":tropical_fish:",{jumbomoji:true}))}));$(".unread_error_state_refresh_button").on("click",function(){TS.client.unread.reload()});_.defer(function(){$("#messages_container .unread_empty_state").addClass("transitioning")})},displayEmptyState:function e(t,i){TS.client.ui.unread.hideLoadingMessage();TS.client.ui.unread.$scroller.addClass("invisible");$("#messages_container .unread_empty_state_wrapper").remove();$("#messages_container").prepend(TS.templates.unread_empty_state({line_one:r.line_one,line_two:r.line_two,emoji:r.emoji_url,marked_as_read_cnt:t}));_.defer(function(){$("#messages_container .unread_empty_state").addClass("transitioning");var e=$("#messages_container .unread_empty_state_undo");if(e.length){e.addClass("unread_empty_state_undo_visible");_.delay(function(){e.removeClass("unread_empty_state_undo_visible")},10300);$(".unread_empty_state_undo_action").one("click",function(){TS.client.unread.markAllAsUnread();TS.client.ui.unread.updateChannelHeader()})}});if(!i){m=true;_.delay(function(){m=false;TS.client.ui.unread.showOrHideRefreshButton()},2e3)}else m=false;TS.client.ui.unread.updateChannelHeader();TS.client.ui.unread.showOrHideRefreshButton()},removeEmptyState:function e(){$(window).off("keydown.unread_empty_state");$("#messages_container .unread_empty_state_wrapper").remove();$("#messages_container .unread_empty_state_undo").remove();TS.client.ui.unread.$scroller.removeClass("invisible");m=false},showOrHideRefreshButton:function e(){var t=TS.client.unread.getTotalNewUnreadCount();var i=$("#messages_container .unread_empty_state");var n=$(".unread_empty_state_refresh");if(t>0&&TS.client.unread.new_messages_in_channels.length)$("#channel_header_unread_refresh").removeClass("hidden");else{$("#channel_header_unread_refresh").addClass("hidden");if(n)n.remove()}if(t>0&&i.length&&TS.client.unread.new_messages_in_channels.length&&!i.hasClass("unread_error_state")){if(n.length>0)n.html($(TS.templates.unread_empty_state_refresh({unreads_count:t})).html());else{if(m)return;i.append(TS.templates.unread_empty_state_refresh({unreads_count:t}));i.addClass("faded");i.addClass("with_refresh");$(window).on("keydown.unread_empty_state",function(e){if(TS.model.unread_view_is_showing&&e.which==TS.utility.keymap.enter&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput())TS.client.unread.reload()})}$(".unread_empty_state_refresh_button").on("click",function(){TS.client.unread.reload()})}},destroyUnreadView:function t(){if(!TS.client.ui.unread.isUnreadViewDOMShowing())return;$(window).off("keydown.unread");if(s&&s.isPending())s.cancel();TS.client.ui.unread.$scroller.removeAttr("tabindex");var a=$("#client-ui");a.removeClass("unread_view_is_showing");TS.ui.message_container.cleanup(e);e=null;TS.client.ui.unread.removeEmptyState();TS.client.ui.unread.$unread_msgs_div.off("click.unread",".unread_group_mark");TS.client.ui.unread.$unread_msgs_div.off("click.unread",".unread_group_undo > a");if(!TS.environment.supports_sticky_position){TS.client.ui.unread.$scroller.off("scroll",n);TS.ui.banner.show_hide_sig.remove(A)}TS.client.ui.unread.$unread_msgs_div.empty();h=false;TS.client.ui.unread.hideLoadingMessage();$("#footer").removeClass("hidden");TS.view.resize_sig.remove(p);TS.channels.renamed_sig.remove(S);TS.groups.renamed_sig.remove(S);TS.client.ui.unread.unread_groups=null;i=null;var r=TS.client.ui.unread.getTrackingData();TS.clog.track("UNREADS_CLOSE",r);c=0;u={unreads_event_seq_id:0,unreads_elasped_time:0,unreads_page:0,unreads_page_message_index:0}},isUnreadViewDOMShowing:function e(){return $("#client-ui").hasClass("unread_view_is_showing")},collapseGroup:function e(t,i,n){n=_.extend({persist_state:false,add_classname:true,scroll_group:true},n||{});if(t.collapsed)return Promise.resolve(t);TS.client.unread.collapseGroup(t,n.persist_state);return new Promise(function(e){var a=w(t);var r=a.offset().top;a.addClass("collapsing");TS.client.ui.unread.updateHeader(t);i.animate({opacity:0},300,function(){a.removeClass("collapsing");if(n.add_classname)a.addClass("collapsed");TS.client.ui.unread.updateMsgs();if(n.scroll_group&&r<0)b(a);k();if(!TS.environment.supports_sticky_position)y();i.css("opacity",1);e(t)})})},expandGroup:function e(i,n){n=_.extend({persist_state:false},n||{});var a=w(i);if(!i.collapsed||a.hasClass("collapsing")||!a.hasClass("collapsed"))return Promise.resolve(i);return new Promise(function(e){TS.client.unread.expandGroup(i,n.persist_state);TS.client.ui.unread.updateHeader(i);a.removeClass("collapsed");a.removeClass("marked_as_read");a.removeClass("with_footer");t=true;TS.client.ui.unread.$unread_msgs_div.css("height",TS.client.ui.unread.$unread_msgs_div.height());var r=TS.client.ui.unread.updateMsgsWithFocus(a);t=false;if(s)s.then(function(){TS.client.ui.unread.$unread_msgs_div.css("height","auto")});else TS.client.ui.unread.$unread_msgs_div.css("height","auto");TS.client.ui.unread.updateNewMessagesMessage(i);r.added.forEach(function(e){e.animate({opacity:1},300)});k();if(!TS.environment.supports_sticky_position)y();e(i)})},markGroupAsRead:function e(t){var i=TS.client.unread.getGroup(t);if(!i)return;var n={channel_id:i.id,channel_type:i.id[0]||"",unread_count:i.total_unreads,request_id:TS.client.unread.last_request_id};TS.client.unread.markGroupAsRead(i);TS.clog.track("UNREADS_MARK_GROUP_AS_READ",n);TS.client.ui.unread.updateChannelHeader();var a=w(i);var r=a.find(".unread_group_msgs");if(i.new_unread_cnt<1)a.addClass("marked_as_read");if(r.length){if(!i.new_unread_cnt)M();if(i.collapsed)TS.client.ui.unread.updateHeader(i);else{var s={add_classname:i.new_unread_cnt<1};return TS.client.ui.unread.collapseGroup(i,r,s).then(function(e){if(e.new_unread_cnt>0)TS.client.ui.unread.updateGroupWithNewMessages(e);else TS.client.ui.unread.updateHeader(e)})}}else TS.client.ui.unread.updateMsgs();return Promise.resolve()},markGroupAsUnread:function e(t){var i=TS.client.unread.getGroup(t);if(!i)return;var n={channel_id:i.id,channel_type:i.id[0]||"",unread_count:i.marked_as_read_cnt,request_id:TS.client.unread.last_request_id};TS.client.unread.markGroupAsUnread(i);TS.clog.track("UNREADS_MARK_GROUP_AS_UNREAD",n);TS.client.ui.unread.expandGroup(i);TS.client.ui.unread.updateChannelHeader()},updateNewMessagesMessage:function e(t){if(t.has_more)return;var i=w(t);var n=i.find(".unread_group_footer");if(t.collapsed)TS.client.ui.unread.updateHeader(t);else if(t.new_unread_cnt>0&&t.new_unread_msgs){n.find(".unread_group_new_text").text(TS.i18n.t("{new_unread_cnt, plural, =1 {# new message} other {# new messages}}","all_unreads")({new_unread_cnt:t.new_unread_cnt}));i.addClass("with_footer")}else if(n)i.removeClass("with_footer")},updateHeader:function e(t){var i=w(t);i.find(".unread_group_header").html(TS.templates.unread_group_header(C(t)))},updateMsgs:function t(){return TS.ui.message_container.update(e)},updateMsgsWithFocus:function t(i){return TS.ui.message_container.updateWithFocus(e,i)},updateGroupWithNewMessages:function e(i){var n=w(i);var a=n.height();n.height(a);TS.client.unread.updateGroupWithNewMessages(i);t=true;var r=TS.client.ui.unread.updateMsgsWithFocus(n);t=false;n.css("height","auto");var s=n.height();n.removeClass("with_footer");n.height(a).animate({height:s,margin:0},300,function(){n.css("height","");n.css("margin","");r.added.forEach(function(e){e.animate({opacity:1},300)});k()});n.removeClass("collapsed").removeClass("marked_as_read");TS.client.ui.unread.updateHeader(i)},updateSidebarLink:function e(){if(TS.model.unread_view_is_showing){$("#channels_scroller li.active").removeClass("active");$('li[data-action="show_unread_view"]').addClass("active")}else $('li[data-action="show_unread_view"]').removeClass("active")},toggleUnreadView:function e(){if(TS.model.prefs.enable_unread_view){$(".channels_nav_unread").removeClass("hidden");$("#channels_nav").addClass("unread_enabled")}else{$(".channels_nav_unread").addClass("hidden");$(".all_unreads").removeClass("active");$("#channels_nav").removeClass("unread_enabled")}},updateChannelPaneUnreadState:function e(t){TS.client.ui.unread.$channel_pane_item.toggleClass("unread",t)},rebuildMsgFile:function e(t,i){var n=TS.client.ui.unread.$unread_msgs_div.find("#"+TS.templates.makeMsgDomIdInUnreadView(t.ts));if(!n||!n.length)return;var a=n.find(".file_container");if(!a||!a.length)return;var r={file:i,is_message:true,msg_dom_id:n.attr("id")};if("post"===i.mode||"space"===i.mode)a.replaceWith(TS.templates.file_post(r));else if("snippet"===i.mode)a.replaceWith(TS.templates.file_snippet(r));else if("email"===i.mode)a.replaceWith(TS.templates.file_email(r));else if("arugula"===i.mode)a.replaceWith(TS.templates.file_arugula(r));else return TS.warn("Trying to rebuild message file, but cannot rebuild "+i.mode);TS.utility.makeSureAllLinksHaveTargets(n);TS.ui.utility.updateClosestMonkeyScroller(n)},updateChannelHeader:function e(){var t=TS.templates.unread_header_info({is_showing:TS.model.unread_view_is_showing,has_new_messages:TS.model.unread_view_is_showing&&TS.client.unread.new_messages_in_channels.length,messages_loaded:TS.client.unread.messages_loaded,total_unread_count:TS.client.unread.getTotalMessagesCount(),sort_order:TS.client.unread.getSortOrder()});TS.client.channel_header.updateChannelHeaderInfo(t)},setUnreadPoint:function e(t){var i=TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+t+'"]');if(!i.length){if(TS.boot_data.feature_sli_briefing)TS.highlights_briefing.setUnreadPointOnMessage(t);return}var n=i.data("modelObId");x(t,n,i)},getTrackingData:function e(t){var i={is_unreads_view:true,unreads_event_seq_id:u.unreads_event_seq_id,unreads_elasped_time:Date.now()-c,unreads_page:u.unreads_page};if(t)i.unreads_page_message_index=_(TS.client.unread.getAllGroups()).map(function(e){return e.msgs}).flatten().reverse().findIndex({ts:t.toString()});return i},incrementTrackingSeqId:function e(){u.unreads_event_seq_id+=1},rebuildMsgsIncludingMember:function t(i){if(!TS.model.unread_view_is_showing||!e)return;TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(i,e)})},rebuildMsgCurrentStatusIncludingMember:function t(i){if(!TS.model.unread_view_is_showing||!e)return;var n=$(e.container);var a=e.sections;if(!a)return;var r={member:i,for_message:true};_.each(a,function(e){_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(i,e)){var t=n.find('ts-message[data-ts="'+e.ts+'"] .message_current_status');t.replaceWith(TS.templates.current_status(r))}})})},rebuildMsgsWithHighlights:function t(i){if(!TS.model.unread_view_is_showing||!e)return;var n=_.reduce(i,function(e,t){_.each(t,function(t,i){e[i]=t});return e},{});TS.ui.message_container.maybeUpdateMessages(e,function(e){return n[e.ts]&&(n[e.ts].show_recap||n[e.ts].is_leaving_feedback||n[e.ts].left_feedback)})},maybeRebuildMsgsWithHighlightsFeedback:function t(i){if(!TS.model.unread_view_is_showing||!e)return;var n=_.reduce(i,function(e,t){_.each(t,function(t,i){e[i]=t});return e},{});TS.ui.message_container.maybeUpdateMessages(e,function(e){var t=n[e.ts]&&"positive"===n[e.ts].feedback;if(t){TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+e.ts+'"] .sli_briefing__feedback_controls').addClass("gave_positive_feedback");return false}return n[e.ts]&&(n[e.ts].show_recap||n[e.ts].is_leaving_feedback||n[e.ts].left_feedback)})},ensureSliLinkBriefingsAndUnreads:function e(){if(_.isUndefined(TS.client.ui.unread.sli_link_briefings_and_unreads))return TS.client.ui.unread.promise_to_get_briefings_experiment;return Promise.resolve()},sliLinkBriefingsAndUnreads:function e(){return"sli_link_briefings_and_unreads"===TS.client.ui.unread.sli_link_briefings_and_unreads&&""!==TS.model.team.plan}});var e;var t=false;var i=false;var n;var a=0;var r;var s=null;var o=false;var l=false;var d=false;var c=0;var u={unreads_event_seq_id:0,unreads_elasped_time:0,unreads_page:0,unreads_page_message_index:0};var m;var f=false;var h=false;var g=function e(){var t=[];switch(TS.i18n.locale()){case"fr-FR":t=[{emoji:"balloon",skintone:false,line_one:"Vous êtes à jour.",line_two:"On se sent déjà plus léger."},{emoji:"bee",skintone:false,line_one:"Vous êtes à jour.",line_two:"On décolle mieux face au vent, courage !"},{emoji:"books",skintone:false,line_one:"Lu et relu !",line_two:""},{emoji:"boom",skintone:false,line_one:"Boum !",line_two:"Vous êtes à jour."},{emoji:"clap",skintone:true,line_one:"Bravo !",line_two:"Vous avez tout lu."},{emoji:"coffee",skintone:false,line_one:"Vous avez tout lu !",line_two:"Une pause s’impose !"},{emoji:"crystalball",skintone:false,line_one:"Vous avez tout lu !",line_two:"Que vous réserve l’avenir ?"},{emoji:"high5",skintone:true,line_one:"C’est tout !",line_two:""},{emoji:"island",skintone:false,line_one:"Terminé !",line_two:"Vous pouvez vous la couler douce !"},{emoji:"owl",skintone:false,line_one:"Chouette !",line_two:"Vous avez terminé."},{emoji:"racecar",skintone:false,line_one:"Voilà !",line_two:"Vous êtes sur la bonne voie."},{emoji:"rocket",skintone:false,line_one:"Terminé !",line_two:"L’avenir vous appartient."},{emoji:"sun",skintone:false,line_one:"Vous êtes à jour.",line_two:"L’horizon est dégagé."},{emoji:"sunglasses",skintone:false,line_one:"Tout est à jour.",line_two:""},{emoji:"tada",skintone:false,line_one:"Tadam !",line_two:"Vous avez tout lu."},{emoji:"thumbup",skintone:true,line_one:"Ça y est !",line_two:"Vous avez fini."},{emoji:"victory",skintone:true,line_one:"Vous êtes à jour.",line_two:"Quelle est la suite du programme ?"}];break;case"de-DE":t=[{emoji:"airplane",skintone:false,line_one:"Jetzt bist du startklar.",line_two:""},{emoji:"art",skintone:false,line_one:"Alles paletti!",line_two:""},{emoji:"bee",skintone:false,line_one:"Geschafft!",line_two:"Ganz schön fleißig."},{emoji:"books",skintone:false,line_one:"Alles gelesen.",line_two:"Wie es im Buche steht."},{emoji:"boom",skintone:false,line_one:"Du bist der Knaller!",line_two:""},{emoji:"bulb",skintone:false,line_one:"Heureka!",line_two:"Du hast ALLES gelesen!"},{emoji:"checkered_flag",skintone:false,line_one:"Du bist am Ziel angelangt!",line_two:"Du hast alles gelesen!"},{emoji:"clap",skintone:true,line_one:"Das war das Tüpfelchen auf dem i.",line_two:""},{emoji:"croissant",skintone:false,line_one:"Geschafft!",line_two:"Das war es auch schon."},{emoji:"crystalball",skintone:false,line_one:"Alles klar.",line_two:"Die Zukunft gehört dir!"},{emoji:"footprints",skintone:false,line_one:"Gut gemacht.",line_two:"Jetzt liegt dir die Welt zu Füßen!"},{emoji:"hammer",skintone:false,line_one:"Du bist der Hammer!",line_two:"Alles gelesen!"},{emoji:"high5",skintone:true,line_one:"Geschafft!",line_two:"Das war alles."},{emoji:"metro",skintone:false,line_one:"Hier ist das Licht am Ende des Tunnels!",line_two:""},{emoji:"island",skintone:false,line_one:"Land in Sicht!",line_two:"Du hast alles gelesen!"},{emoji:"person_ball",skintone:true,line_one:"Immer am Ball bleiben!",line_two:""},{emoji:"rocket",skintone:false,line_one:"Du hast ein ganz schönes Lesetempo drauf!",line_two:""},{emoji:"sailboat",skintone:false,line_one:"Alles in Lot auf dem Boot.",line_two:""},{emoji:"sailboat",skintone:false,line_one:"Alles in Butter auf dem Kutter!",line_two:""},{emoji:"ship",skintone:false,line_one:"Klar Schiff!",line_two:""},{emoji:"soccer",skintone:false,line_one:"Volltreffer! ",line_two:"Du hast alles gelesen!"},{emoji:"sun",skintone:false,line_one:"Alles heiter und klar!",line_two:""},{emoji:"sunglasses",skintone:false,line_one:"Alles klar!",line_two:""},{emoji:"tada",skintone:false,line_one:"Ta-da !",line_two:"Du bist jetzt ganz schön belesen."},{emoji:"tea",skintone:false,line_one:"Du hast alles aufgeholt.",line_two:"Zeit für eine kleine Pause."},{emoji:"thumbup",skintone:true,line_one:"Du bist ganz schön auf Zack!",line_two:""},{emoji:"victory",skintone:true,line_one:"Alles erledigt!",line_two:"Das ist das A und O."},{emoji:"wrench",skintone:false,line_one:"Ganz schön fix!",line_two:""}];break;case"ja-JP":t=[{emoji:"blush",skintone:false,line_one:"未読メッセージは以上です。",line_two:"お疲れさまでした。"},{emoji:"bookmark_tabs",skintone:false,line_one:"未読チェック完了！準備万端！",line_two:"さあ、何からやりますか？"},{emoji:"candy",skintone:false,line_one:"全未読メッセージの確認、お疲れさまでした。",line_two:"はい、アメちゃん！"},{emoji:"check_mark",skintone:false,line_one:"全未読メッセージ確認終了！",line_two:"やることリストから1つ消えました！"},{emoji:"cityscape",skintone:false,line_one:"全未読メッセージの確認、お疲れさまでした。",line_two:"遠くを見ると疲れ目にいいらしいですよ？"},{emoji:"coffee",skintone:false,line_one:"すべての未読メッセージを確認しました。",line_two:"ちょっと一息入れませんか？"},{emoji:"confetti_ball",skintone:false,line_one:"未読メッセージ読了を達成しました！",line_two:""},{emoji:"crossed_swords",skintone:false,line_one:"みどく　メッセージを　やっつけた。",line_two:"かしこさが　１ポイント　あがった！"},{emoji:"dog",skintone:false,line_one:"未読チェック完了！",line_two:"ワンだふる！"},{emoji:"doughnut",skintone:false,line_one:"全未読メッセージ確認終了！",line_two:"ちょっと休憩して、疲れた脳に糖分補給"},{emoji:"herb",skintone:false,line_one:"未読スッキリ！気分もスッキリ！",line_two:""},{emoji:"leafs",skintone:false,line_one:"全メッセージが既読になりました。",line_two:"それはそれで、ちょっと寂しい…？"},{emoji:"rocket",skintone:false,line_one:"未読コンプリート！",line_two:"この調子でどんどん行っちゃいましょう！"},{emoji:"sparkles",skintone:false,line_one:"未読メッセージが、ぜんぶキレイに片付きました。",line_two:""},{emoji:"tada",skintone:false,line_one:"すごい！",line_two:"未読コンプリート！"},{emoji:"tea",skintone:false,line_one:"未読チェック完了！",line_two:"お疲れさまでした。"},{emoji:"trophy",skintone:false,line_one:"おめでとうございます！",line_two:"全未読チェック完了です！"},{emoji:"victory",skintone:true,line_one:"未読チェック完了！",line_two:""},{emoji:"sleuth",skintone:true,line_one:"全未読メッセージを",line_two:"漏れなくすべて確認しました。"}];break;case"es-ES":t=[{emoji:"boom",skintone:false,line_one:"Bum.",line_two:"Estás al día."},{emoji:"chick",skintone:false,line_one:"Estás al día.",line_two:"Es hora de salir a hacer algo estupendo."},{emoji:"candy",skintone:false,line_one:"Has leído todo.",line_two:"Aquí tienes un caramelo de regalo."},{emoji:"cityscape",skintone:false,line_one:"Has terminado de leer.",line_two:"Tienes el mundo a tus pies."},{emoji:"checkered_flag",skintone:false,line_one:"Has terminado de leer.",line_two:"¿Y ahora qué sigue?"},{emoji:"flex",skintone:true,line_one:"Has terminado de leer.",line_two:"¡Lo lograste!"},{emoji:"high5",skintone:true,line_one:"¡Eso es todo!",line_two:""},{emoji:"hourglass",skintone:false,line_one:"Has terminado de leer.",line_two:"El futuro es tuyo."},{emoji:"leafs",skintone:false,line_one:"Punto y aparte.",line_two:""},{emoji:"newspaper",skintone:false,line_one:"Ya estás al día con tu lectura.",line_two:"Ahora puedes tomarte un descanso."},{emoji:"rocket",skintone:false,line_one:"¡Listo! Estás al tanto de todo.",line_two:"Ahora puedes proponerte algo nuevo."},{emoji:"sunglasses",skintone:false,line_one:"El pronóstico se ve despejado.",line_two:""},{emoji:"sleuth",skintone:true,line_one:"Estás al tanto de todo.",line_two:"¿Y ahora qué?"},{emoji:"sleuth",skintone:true,line_one:"Listo.",line_two:"Ya estás al tanto de todo."},{emoji:"tada",skintone:false,line_one:"¡Enhorabuena!",line_two:"Has leído todo lo que había que leer."},{emoji:"trophy",skintone:false,line_one:"¡Al fin!",line_two:"Ya has terminado."}];break;default:t=[{emoji:"apple",skintone:false,line_one:"You’ve read all you needed.",line_two:"Take a moment."},{emoji:"balloon",skintone:false,line_one:"There! Caught up.",line_two:"Set your mind to something new."},{emoji:"bee",skintone:false,line_one:"You’re up to date.",line_two:"Go forth and do great things."},{emoji:"boom",skintone:false,line_one:"Boom.",line_two:"You’re up to date."},{emoji:"clap",skintone:true,line_one:"Everything unread is now read.",line_two:"You’ve done it."},{emoji:"growth",skintone:false,line_one:"Everything’s sorted!",line_two:"Let’s start something new."},{emoji:"crystalball",skintone:false,line_one:"All that was unread is now read.",line_two:"What’s next?"},{emoji:"high5",skintone:true,line_one:"That’s everything!",line_two:""},{emoji:"leafs",skintone:false,line_one:"Done and done.",line_two:""},{emoji:"octopus",skintone:false,line_one:"All done.",line_two:"The world is your oyster."},{emoji:"pony",skintone:false,line_one:"You’re all read.",line_two:"Here’s a pony."},{emoji:"racecar",skintone:false,line_one:"There.",line_two:"All caught up."},{emoji:"rocket",skintone:false,line_one:"All done.",line_two:"The future is yours."},{emoji:"sun",skintone:false,line_one:"You’re all caught up!",line_two:"Clear screens ahead."},{emoji:"sunglasses",skintone:false,line_one:"All clear.",line_two:""},{emoji:"sweetpotato",skintone:false,line_one:"Sweet potato!",line_two:"You’re all done."},{emoji:"tada",skintone:false,line_one:"Ta-da!",line_two:"You’ve read everything there is to read."},{emoji:"tada",skintone:false,line_one:"Ta-da!",line_two:"You’re up to date."},{emoji:"thumbup",skintone:true,line_one:"That’s that.",line_two:"You’re good to go."},{emoji:"tractor",skintone:false,line_one:"You’re all read.",line_two:"Here’s a tractor."},{emoji:"victory",skintone:true,line_one:"All caught up.",line_two:"What’s next?"}]}var i={default:{tada:cdn_url+"/436da/img/unread/empty/default/tada.png",victory:{1:cdn_url+"/436da/img/unread/empty/default/victory_1.png",2:cdn_url+"/436da/img/unread/empty/default/victory_2.png",3:cdn_url+"/436da/img/unread/empty/default/victory_3.png",4:cdn_url+"/436da/img/unread/empty/default/victory_4.png",5:cdn_url+"/436da/img/unread/empty/default/victory_5.png",6:cdn_url+"/436da/img/unread/empty/default/victory_6.png"},racecar:cdn_url+"/436da/img/unread/empty/default/racecar.png",rocket:cdn_url+"/436da/img/unread/empty/default/rocket.png",octopus:cdn_url+"/436da/img/unread/empty/default/octopus.png",high5:{1:cdn_url+"/436da/img/unread/empty/default/high5_1.png",2:cdn_url+"/436da/img/unread/empty/default/high5_2.png",3:cdn_url+"/436da/img/unread/empty/default/high5_3.png",4:cdn_url+"/436da/img/unread/empty/default/high5_4.png",5:cdn_url+"/436da/img/unread/empty/default/high5_5.png",6:cdn_url+"/436da/img/unread/empty/default/high5_6.png"},apple:cdn_url+"/436da/img/unread/empty/default/apple.png",sunglasses:cdn_url+"/436da/img/unread/empty/default/sunglasses.png",thumbup:{1:cdn_url+"/436da/img/unread/empty/default/thumbup_1.png",2:cdn_url+"/436da/img/unread/empty/default/thumbup_2.png",3:cdn_url+"/436da/img/unread/empty/default/thumbup_3.png",4:cdn_url+"/436da/img/unread/empty/default/thumbup_4.png",5:cdn_url+"/436da/img/unread/empty/default/thumbup_5.png",6:cdn_url+"/436da/img/unread/empty/default/thumbup_6.png"},boom:cdn_url+"/436da/img/unread/empty/default/boom.png",bee:cdn_url+"/436da/img/unread/empty/default/bee.png",clap:{1:cdn_url+"/436da/img/unread/empty/default/clap_1.png",2:cdn_url+"/436da/img/unread/empty/default/clap_2.png",3:cdn_url+"/436da/img/unread/empty/default/clap_3.png",4:cdn_url+"/436da/img/unread/empty/default/clap_4.png",5:cdn_url+"/436da/img/unread/empty/default/clap_5.png",6:cdn_url+"/436da/img/unread/empty/default/clap_6.png"},crystalball:cdn_url+"/436da/img/unread/empty/default/crystalball.png",tractor:cdn_url+"/436da/img/unread/empty/default/tractor.png",pony:cdn_url+"/436da/img/unread/empty/default/pony.png",chick:cdn_url+"/436da/img/unread/empty/default/chick.png",growth:cdn_url+"/f8983/img/unread/empty/default/growth.png",sun:cdn_url+"/436da/img/unread/empty/default/sun.png",balloon:cdn_url+"/436da/img/unread/empty/default/balloon.png",sweetpotato:cdn_url+"/436da/img/unread/empty/default/sweetpotato.png",leafs:cdn_url+"/436da/img/unread/empty/default/leafs.png",owl:cdn_url+"/436da/img/unread/empty/default/owl.png",books:cdn_url+"/436da/img/unread/empty/default/books.png",island:cdn_url+"/436da/img/unread/empty/default/island.png",coffee:cdn_url+"/436da/img/unread/empty/default/coffee.png",footprints:cdn_url+"/436da/img/unread/empty/default/footprints.png",tea:cdn_url+"/436da/img/unread/empty/default/tea.png",croissant:cdn_url+"/436da/img/unread/empty/default/croissant.png",art:cdn_url+"/436da/img/unread/empty/default/art.png",person_ball:{1:cdn_url+"/436da/img/unread/empty/default/person_ball_1.png",2:cdn_url+"/436da/img/unread/empty/default/person_ball_2.png",3:cdn_url+"/436da/img/unread/empty/default/person_ball_3.png",4:cdn_url+"/436da/img/unread/empty/default/person_ball_4.png",5:cdn_url+"/436da/img/unread/empty/default/person_ball_5.png",6:cdn_url+"/436da/img/unread/empty/default/person_ball_6.png"},airplane:cdn_url+"/436da/img/unread/empty/default/airplane.png",sailboat:cdn_url+"/436da/img/unread/empty/default/sailboat.png",ship:cdn_url+"/436da/img/unread/empty/default/ship.png",bulb:cdn_url+"/436da/img/unread/empty/default/bulb.png",hammer:cdn_url+"/436da/img/unread/empty/default/bulb.png",checkered_flag:cdn_url+"/436da/img/unread/empty/default/checkered_flag.png",wrench:cdn_url+"/436da/img/unread/empty/default/wrench.png",metro:cdn_url+"/436da/img/unread/empty/default/metro.png",soccer:cdn_url+"/436da/img/unread/empty/default/soccer.png",trophy:cdn_url+"/436da/img/unread/empty/default/trophy.png",cityscape:cdn_url+"/436da/img/unread/empty/default/cityscape.png",dog:cdn_url+"/436da/img/unread/empty/default/dog.png",crossed_swords:cdn_url+"/436da/img/unread/empty/default/crossed_swords.png",blush:cdn_url+"/436da/img/unread/empty/default/blush.png",candy:cdn_url+"/436da/img/unread/empty/default/candy.png",herb:cdn_url+"/436da/img/unread/empty/default/herb.png",sparkles:cdn_url+"/436da/img/unread/empty/default/sparkles.png",check_mark:cdn_url+"/436da/img/unread/empty/default/check_mark.png",confetti_ball:cdn_url+"/436da/img/unread/empty/default/confetti_ball.png",doughnut:cdn_url+"/436da/img/unread/empty/default/doughnut.png",bookmark_tabs:cdn_url+"/436da/img/unread/empty/default/bookmark_tabs.png",sleuth:{1:cdn_url+"/436da/img/unread/empty/default/sleuth_1.png",2:cdn_url+"/436da/img/unread/empty/default/sleuth_2.png",3:cdn_url+"/436da/img/unread/empty/default/sleuth_3.png",4:cdn_url+"/436da/img/unread/empty/default/sleuth_4.png",5:cdn_url+"/436da/img/unread/empty/default/sleuth_5.png",6:cdn_url+"/436da/img/unread/empty/default/sleuth_6.png"},hourglass:cdn_url+"/436da/img/unread/empty/default/hourglass.png",newspaper:cdn_url+"/436da/img/unread/empty/default/newspaper.png",flex:{1:cdn_url+"/436da/img/unread/empty/default/flex_1.png",2:cdn_url+"/436da/img/unread/empty/default/flex_2.png",3:cdn_url+"/436da/img/unread/empty/default/flex_3.png",4:cdn_url+"/436da/img/unread/empty/default/flex_4.png",5:cdn_url+"/436da/img/unread/empty/default/flex_5.png",6:cdn_url+"/436da/img/unread/empty/default/flex_6.png"}},google:{tada:cdn_url+"/436da/img/unread/empty/google/tada.png",victory:{1:cdn_url+"/436da/img/unread/empty/google/victory_1.png",2:cdn_url+"/436da/img/unread/empty/google/victory_2.png",3:cdn_url+"/436da/img/unread/empty/google/victory_3.png",4:cdn_url+"/436da/img/unread/empty/google/victory_4.png",5:cdn_url+"/436da/img/unread/empty/google/victory_5.png",6:cdn_url+"/436da/img/unread/empty/google/victory_6.png"},racecar:cdn_url+"/436da/img/unread/empty/google/racecar.png",rocket:cdn_url+"/436da/img/unread/empty/google/rocket.png",octopus:cdn_url+"/436da/img/unread/empty/google/octopus.png",high5:{1:cdn_url+"/436da/img/unread/empty/google/high5_1.png",2:cdn_url+"/436da/img/unread/empty/google/high5_2.png",3:cdn_url+"/436da/img/unread/empty/google/high5_3.png",4:cdn_url+"/436da/img/unread/empty/google/high5_4.png",5:cdn_url+"/436da/img/unread/empty/google/high5_5.png",6:cdn_url+"/436da/img/unread/empty/google/high5_6.png"},apple:cdn_url+"/436da/img/unread/empty/google/apple.png",sunglasses:cdn_url+"/436da/img/unread/empty/google/sunglasses.png",thumbup:{1:cdn_url+"/436da/img/unread/empty/google/thumbup_1.png",2:cdn_url+"/436da/img/unread/empty/google/thumbup_2.png",3:cdn_url+"/436da/img/unread/empty/google/thumbup_3.png",4:cdn_url+"/436da/img/unread/empty/google/thumbup_4.png",5:cdn_url+"/436da/img/unread/empty/google/thumbup_5.png",6:cdn_url+"/436da/img/unread/empty/google/thumbup_6.png"},boom:cdn_url+"/436da/img/unread/empty/google/boom.png",bee:cdn_url+"/436da/img/unread/empty/google/bee.png",clap:{1:cdn_url+"/436da/img/unread/empty/google/clap_1.png",2:cdn_url+"/436da/img/unread/empty/google/clap_2.png",3:cdn_url+"/436da/img/unread/empty/google/clap_3.png",4:cdn_url+"/436da/img/unread/empty/google/clap_4.png",5:cdn_url+"/436da/img/unread/empty/google/clap_5.png",6:cdn_url+"/436da/img/unread/empty/google/clap_6.png"},crystalball:cdn_url+"/436da/img/unread/empty/google/crystalball.png",tractor:cdn_url+"/436da/img/unread/empty/google/tractor.png",pony:cdn_url+"/436da/img/unread/empty/google/pony.png",chick:cdn_url+"/436da/img/unread/empty/google/chick.png",growth:cdn_url+"/f8983/img/unread/empty/google/growth.png",sun:cdn_url+"/436da/img/unread/empty/google/sun.png",balloon:cdn_url+"/436da/img/unread/empty/google/balloon.png",sweetpotato:cdn_url+"/436da/img/unread/empty/google/sweetpotato.png",leafs:cdn_url+"/436da/img/unread/empty/google/leafs.png",owl:cdn_url+"/436da/img/unread/empty/google/owl.png",books:cdn_url+"/436da/img/unread/empty/google/books.png",island:cdn_url+"/436da/img/unread/empty/google/island.png",coffee:cdn_url+"/436da/img/unread/empty/google/coffee.png",footprints:cdn_url+"/436da/img/unread/empty/google/footprints.png",tea:cdn_url+"/436da/img/unread/empty/google/tea.png",croissant:cdn_url+"/436da/img/unread/empty/google/croissant.png",art:cdn_url+"/436da/img/unread/empty/google/art.png",person_ball:{1:cdn_url+"/436da/img/unread/empty/google/person_ball_1.png",2:cdn_url+"/436da/img/unread/empty/google/person_ball_2.png",3:cdn_url+"/436da/img/unread/empty/google/person_ball_3.png",4:cdn_url+"/436da/img/unread/empty/google/person_ball_4.png",5:cdn_url+"/436da/img/unread/empty/google/person_ball_5.png",6:cdn_url+"/436da/img/unread/empty/google/person_ball_6.png"},airplane:cdn_url+"/436da/img/unread/empty/google/airplane.png",sailboat:cdn_url+"/436da/img/unread/empty/google/sailboat.png",ship:cdn_url+"/436da/img/unread/empty/google/ship.png",bulb:cdn_url+"/436da/img/unread/empty/google/bulb.png",checkered_flag:cdn_url+"/436da/img/unread/empty/google/checkered_flag.png",wrench:cdn_url+"/436da/img/unread/empty/google/wrench.png",metro:cdn_url+"/436da/img/unread/empty/google/metro.png",soccer:cdn_url+"/436da/img/unread/empty/google/soccer.png",trophy:cdn_url+"/436da/img/unread/empty/google/trophy.png",cityscape:cdn_url+"/436da/img/unread/empty/google/cityscape.png",dog:cdn_url+"/436da/img/unread/empty/google/dog.png",crossed_swords:cdn_url+"/436da/img/unread/empty/google/crossed_swords.png",blush:cdn_url+"/436da/img/unread/empty/google/blush.png",candy:cdn_url+"/436da/img/unread/empty/google/candy.png",herb:cdn_url+"/436da/img/unread/empty/google/herb.png",sparkles:cdn_url+"/436da/img/unread/empty/google/sparkles.png",check_mark:cdn_url+"/436da/img/unread/empty/google/check_mark.png",confetti_ball:cdn_url+"/436da/img/unread/empty/google/confetti_ball.png",doughnut:cdn_url+"/436da/img/unread/empty/google/doughnut.png",bookmark_tabs:cdn_url+"/436da/img/unread/empty/google/bookmark_tabs.png",sleuth:{1:cdn_url+"/436da/img/unread/empty/google/sleuth_1.png",2:cdn_url+"/436da/img/unread/empty/google/sleuth_2.png",3:cdn_url+"/436da/img/unread/empty/google/sleuth_3.png",4:cdn_url+"/436da/img/unread/empty/google/sleuth_4.png",5:cdn_url+"/436da/img/unread/empty/google/sleuth_5.png",6:cdn_url+"/436da/img/unread/empty/google/sleuth_6.png"}},twitter:{tada:cdn_url+"/436da/img/unread/empty/twitter/tada.png",victory:{1:cdn_url+"/436da/img/unread/empty/twitter/victory_1.png",2:cdn_url+"/436da/img/unread/empty/twitter/victory_2.png",3:cdn_url+"/436da/img/unread/empty/twitter/victory_3.png",4:cdn_url+"/436da/img/unread/empty/twitter/victory_4.png",5:cdn_url+"/436da/img/unread/empty/twitter/victory_5.png",6:cdn_url+"/436da/img/unread/empty/twitter/victory_6.png"},racecar:cdn_url+"/436da/img/unread/empty/twitter/racecar.png",rocket:cdn_url+"/436da/img/unread/empty/twitter/rocket.png",octopus:cdn_url+"/436da/img/unread/empty/twitter/octopus.png",high5:{1:cdn_url+"/436da/img/unread/empty/twitter/high5_1.png",2:cdn_url+"/436da/img/unread/empty/twitter/high5_2.png",3:cdn_url+"/436da/img/unread/empty/twitter/high5_3.png",4:cdn_url+"/436da/img/unread/empty/twitter/high5_4.png",5:cdn_url+"/436da/img/unread/empty/twitter/high5_5.png",6:cdn_url+"/436da/img/unread/empty/twitter/high5_6.png"},apple:cdn_url+"/436da/img/unread/empty/twitter/apple.png",sunglasses:cdn_url+"/436da/img/unread/empty/twitter/sunglasses.png",thumbup:{1:cdn_url+"/436da/img/unread/empty/twitter/thumbup_1.png",2:cdn_url+"/436da/img/unread/empty/twitter/thumbup_2.png",3:cdn_url+"/436da/img/unread/empty/twitter/thumbup_3.png",4:cdn_url+"/436da/img/unread/empty/twitter/thumbup_4.png",5:cdn_url+"/436da/img/unread/empty/twitter/thumbup_5.png",6:cdn_url+"/436da/img/unread/empty/twitter/thumbup_6.png"},boom:cdn_url+"/436da/img/unread/empty/twitter/boom.png",bee:cdn_url+"/436da/img/unread/empty/twitter/bee.png",clap:{1:cdn_url+"/436da/img/unread/empty/twitter/clap_1.png",2:cdn_url+"/436da/img/unread/empty/twitter/clap_2.png",3:cdn_url+"/436da/img/unread/empty/twitter/clap_3.png",4:cdn_url+"/436da/img/unread/empty/twitter/clap_4.png",5:cdn_url+"/436da/img/unread/empty/twitter/clap_5.png",6:cdn_url+"/436da/img/unread/empty/twitter/clap_6.png"},crystalball:cdn_url+"/436da/img/unread/empty/twitter/crystalball.png",tractor:cdn_url+"/436da/img/unread/empty/twitter/tractor.png",pony:cdn_url+"/436da/img/unread/empty/twitter/pony.png",chick:cdn_url+"/436da/img/unread/empty/twitter/chick.png",growth:cdn_url+"/f8983/img/unread/empty/twitter/growth.png",sun:cdn_url+"/436da/img/unread/empty/twitter/sun.png",balloon:cdn_url+"/436da/img/unread/empty/twitter/balloon.png",sweetpotato:cdn_url+"/436da/img/unread/empty/twitter/sweetpotato.png",leafs:cdn_url+"/436da/img/unread/empty/twitter/leafs.png",owl:cdn_url+"/436da/img/unread/empty/twitter/owl.png",books:cdn_url+"/436da/img/unread/empty/twitter/books.png",island:cdn_url+"/436da/img/unread/empty/twitter/island.png",coffee:cdn_url+"/436da/img/unread/empty/twitter/coffee.png",footprints:cdn_url+"/436da/img/unread/empty/twitter/footprints.png",tea:cdn_url+"/436da/img/unread/empty/twitter/tea.png",croissant:cdn_url+"/436da/img/unread/empty/twitter/croissant.png",art:cdn_url+"/436da/img/unread/empty/twitter/art.png",person_ball:{1:cdn_url+"/436da/img/unread/empty/twitter/person_ball_1.png",2:cdn_url+"/436da/img/unread/empty/twitter/person_ball_2.png",3:cdn_url+"/436da/img/unread/empty/twitter/person_ball_3.png",4:cdn_url+"/436da/img/unread/empty/twitter/person_ball_4.png",5:cdn_url+"/436da/img/unread/empty/twitter/person_ball_5.png",6:cdn_url+"/436da/img/unread/empty/twitter/person_ball_6.png"},airplane:cdn_url+"/436da/img/unread/empty/twitter/airplane.png",sailboat:cdn_url+"/436da/img/unread/empty/twitter/sailboat.png",ship:cdn_url+"/436da/img/unread/empty/twitter/ship.png",bulb:cdn_url+"/436da/img/unread/empty/twitter/bulb.png",checkered_flag:cdn_url+"/436da/img/unread/empty/twitter/checkered_flag.png",wrench:cdn_url+"/436da/img/unread/empty/twitter/wrench.png",metro:cdn_url+"/436da/img/unread/empty/twitter/metro.png",soccer:cdn_url+"/436da/img/unread/empty/twitter/soccer.png",trophy:cdn_url+"/436da/img/unread/empty/twitter/trophy.png",cityscape:cdn_url+"/436da/img/unread/empty/twitter/cityscape.png",dog:cdn_url+"/436da/img/unread/empty/twitter/dog.png",crossed_swords:cdn_url+"/436da/img/unread/empty/twitter/crossed_swords.png",blush:cdn_url+"/436da/img/unread/empty/twitter/blush.png",candy:cdn_url+"/436da/img/unread/empty/twitter/candy.png",herb:cdn_url+"/436da/img/unread/empty/twitter/herb.png",sparkles:cdn_url+"/436da/img/unread/empty/twitter/sparkles.png",check_mark:cdn_url+"/436da/img/unread/empty/twitter/check_mark.png",confetti_ball:cdn_url+"/436da/img/unread/empty/twitter/confetti_ball.png",doughnut:cdn_url+"/436da/img/unread/empty/twitter/doughnut.png",bookmark_tabs:cdn_url+"/436da/img/unread/empty/twitter/bookmark_tabs.png",sleuth:{1:cdn_url+"/436da/img/unread/empty/twitter/sleuth_1.png",2:cdn_url+"/436da/img/unread/empty/twitter/sleuth_2.png",3:cdn_url+"/436da/img/unread/empty/twitter/sleuth_3.png",4:cdn_url+"/436da/img/unread/empty/twitter/sleuth_4.png",5:cdn_url+"/436da/img/unread/empty/twitter/sleuth_5.png",6:cdn_url+"/436da/img/unread/empty/twitter/sleuth_6.png"}},emojione:{tada:cdn_url+"/436da/img/unread/empty/emojione/tada.png",victory:{1:cdn_url+"/436da/img/unread/empty/emojione/victory_1.png",2:cdn_url+"/436da/img/unread/empty/emojione/victory_2.png",3:cdn_url+"/436da/img/unread/empty/emojione/victory_3.png",4:cdn_url+"/436da/img/unread/empty/emojione/victory_4.png",5:cdn_url+"/436da/img/unread/empty/emojione/victory_5.png",6:cdn_url+"/436da/img/unread/empty/emojione/victory_6.png"},racecar:cdn_url+"/436da/img/unread/empty/emojione/racecar.png",rocket:cdn_url+"/436da/img/unread/empty/emojione/rocket.png",octopus:cdn_url+"/436da/img/unread/empty/emojione/octopus.png",high5:{1:cdn_url+"/436da/img/unread/empty/emojione/high5_1.png",2:cdn_url+"/436da/img/unread/empty/emojione/high5_2.png",3:cdn_url+"/436da/img/unread/empty/emojione/high5_3.png",4:cdn_url+"/436da/img/unread/empty/emojione/high5_4.png",5:cdn_url+"/436da/img/unread/empty/emojione/high5_5.png",6:cdn_url+"/436da/img/unread/empty/emojione/high5_6.png"},apple:cdn_url+"/436da/img/unread/empty/emojione/apple.png",sunglasses:cdn_url+"/436da/img/unread/empty/emojione/sunglasses.png",thumbup:{1:cdn_url+"/436da/img/unread/empty/emojione/thumbup_1.png",2:cdn_url+"/436da/img/unread/empty/emojione/thumbup_2.png",3:cdn_url+"/436da/img/unread/empty/emojione/thumbup_3.png",4:cdn_url+"/436da/img/unread/empty/emojione/thumbup_4.png",5:cdn_url+"/436da/img/unread/empty/emojione/thumbup_5.png",6:cdn_url+"/436da/img/unread/empty/emojione/thumbup_6.png"},boom:cdn_url+"/436da/img/unread/empty/emojione/boom.png",bee:cdn_url+"/436da/img/unread/empty/emojione/bee.png",clap:{1:cdn_url+"/436da/img/unread/empty/emojione/clap_1.png",2:cdn_url+"/436da/img/unread/empty/emojione/clap_2.png",3:cdn_url+"/436da/img/unread/empty/emojione/clap_3.png",4:cdn_url+"/436da/img/unread/empty/emojione/clap_4.png",5:cdn_url+"/436da/img/unread/empty/emojione/clap_5.png",6:cdn_url+"/436da/img/unread/empty/emojione/clap_6.png"},crystalball:cdn_url+"/436da/img/unread/empty/emojione/crystalball.png",tractor:cdn_url+"/436da/img/unread/empty/emojione/tractor.png",pony:cdn_url+"/436da/img/unread/empty/emojione/pony.png",chick:cdn_url+"/436da/img/unread/empty/emojione/chick.png",growth:cdn_url+"/f8983/img/unread/empty/emojione/growth.png",sun:cdn_url+"/436da/img/unread/empty/emojione/sun.png",balloon:cdn_url+"/436da/img/unread/empty/emojione/balloon.png",sweetpotato:cdn_url+"/436da/img/unread/empty/emojione/sweetpotato.png",leafs:cdn_url+"/436da/img/unread/empty/emojione/sweetpotato.png",owl:cdn_url+"/436da/img/unread/empty/emojione/owl.png",books:cdn_url+"/436da/img/unread/empty/emojione/books.png",island:cdn_url+"/436da/img/unread/empty/emojione/island.png",coffee:cdn_url+"/436da/img/unread/empty/emojione/coffee.png",footprints:cdn_url+"/436da/img/unread/empty/emojione/footprints.png",tea:cdn_url+"/436da/img/unread/empty/emojione/tea.png",croissant:cdn_url+"/436da/img/unread/empty/emojione/croissant.png",art:cdn_url+"/436da/img/unread/empty/emojione/art.png",person_ball:{1:cdn_url+"/436da/img/unread/empty/emojione/person_ball_1.png",2:cdn_url+"/436da/img/unread/empty/emojione/person_ball_2.png",3:cdn_url+"/436da/img/unread/empty/emojione/person_ball_3.png",4:cdn_url+"/436da/img/unread/empty/emojione/person_ball_4.png",5:cdn_url+"/436da/img/unread/empty/emojione/person_ball_5.png",6:cdn_url+"/436da/img/unread/empty/emojione/person_ball_6.png"},airplane:cdn_url+"/436da/img/unread/empty/emojione/airplane.png",sailboat:cdn_url+"/436da/img/unread/empty/emojione/sailboat.png",ship:cdn_url+"/436da/img/unread/empty/emojione/ship.png",bulb:cdn_url+"/436da/img/unread/empty/emojione/bulb.png",checkered_flag:cdn_url+"/436da/img/unread/empty/emojione/checkered_flag.png",wrench:cdn_url+"/436da/img/unread/empty/emojione/wrench.png",metro:cdn_url+"/436da/img/unread/empty/emojione/metro.png",soccer:cdn_url+"/436da/img/unread/empty/emojione/soccer.png",trophy:cdn_url+"/436da/img/unread/empty/emojione/trophy.png",cityscape:cdn_url+"/436da/img/unread/empty/emojione/cityscape.png",dog:cdn_url+"/436da/img/unread/empty/emojione/dog.png",crossed_swords:cdn_url+"/436da/img/unread/empty/emojione/crossed_swords.png",blush:cdn_url+"/436da/img/unread/empty/emojione/blush.png",candy:cdn_url+"/436da/img/unread/empty/emojione/candy.png",herb:cdn_url+"/436da/img/unread/empty/emojione/herb.png",sparkles:cdn_url+"/436da/img/unread/empty/emojione/sparkles.png",check_mark:cdn_url+"/436da/img/unread/empty/emojione/check_mark.png",confetti_ball:cdn_url+"/436da/img/unread/empty/emojione/confetti_ball.png",doughnut:cdn_url+"/436da/img/unread/empty/emojione/doughnut.png",bookmark_tabs:cdn_url+"/436da/img/unread/empty/emojione/bookmark_tabs.png",sleuth:{1:cdn_url+"/436da/img/unread/empty/emojione/sleuth_1.png",2:cdn_url+"/436da/img/unread/empty/emojione/sleuth_2.png",3:cdn_url+"/436da/img/unread/empty/emojione/sleuth_3.png",4:cdn_url+"/436da/img/unread/empty/emojione/sleuth_4.png",5:cdn_url+"/436da/img/unread/empty/emojione/sleuth_5.png",6:cdn_url+"/436da/img/unread/empty/emojione/sleuth_6.png"}}};var n=t[Math.floor(Math.random()*t.length)];var a=TS.model.prefs.emoji_mode;if("as_text"===a)a="default";var s=TS.model.prefs.preferred_skin_tone||"1";var o=n.skintone?i[a][n.emoji][s]:i[a][n.emoji];n.emoji_url=o;var l=new Image;l.src=n.emoji_url;r=n};var p=function e(){if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.unread.$scroller);if(!TS.environment.supports_sticky_position){A();k();y()}};var S=function e(t){var i=TS.client.unread.getGroup(t.id);if(i)TS.client.ui.unread.updateHeader(i)};var T=function e(t){var i;if(TS.ui.react_emoji_menu.is_showing)return;var n=t.keyCode;var a=[TS.utility.keymap.space,TS.utility.keymap.pageup,TS.utility.keymap.pagedown,TS.utility.keymap.end,TS.utility.keymap.home];var r=a.concat([TS.utility.keymap.left,TS.utility.keymap.right,82]);if(-1===r.indexOf(n))return;var d=t.target;var c=$("#col_flex")[0].contains(d);var u=$(".client_channels_list_container")[0].contains(d);var m=TS.client.ui.unread.$scroller[0];var g=TS.boot_data.feature_keyboard_navigation&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()&&!c&&!u&&!m.contains(d);if(-1!==a.indexOf(n)&&g)m.focus();if(t.metaKey||t.ctrlKey||t.shiftKey)return;if(s&&s.isPending())return;if(!o&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()&&!$("#messages_container .unread_empty_state").length&&!h&&!TS.client.ui.unread.$scroller.hasClass("transitioning")&&!TS.client.ui.unread.$unread_msgs_div.find(".collapsing").length){var p=TS.client.unread.getActiveGroup();if(n===TS.utility.keymap.right||n===TS.utility.keymap.left){f=true;t.preventDefault();var S=n===TS.utility.keymap.left;i=TS.client.unread.moveActiveMarker(S);if(i)v(i,p,{collapse_current_group:!S});else if(!TS.client.unread.areAllMessagesFetched()&&!S){var T=_.last(TS.client.unread.getAllGroups());if(T.id===p.id){l=true;var b=w(p);var y=b.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(p,y)}}}else if(82===n){f=true;if(p)if(p.marked_as_read)TS.client.ui.unread.markGroupAsUnread(p.id);else{o=true;TS.client.ui.unread.markGroupAsRead(p.id).then(function(){if(p.marked_as_read){i=TS.client.unread.moveActiveMarker();v(i,p)}else o=false})}}}};var v=function e(t,i,n){n=_.defaults(n,{collapse_current_group:false,scroll_and_expand:true});var a=function e(){var a=w(t);a.toggleClass("active",t.active&&f);TS.client.ui.unread.updateHeader(t);if(!t.marked_as_read)if(n.scroll_and_expand)TS.client.ui.unread.expandGroup(t);if(n.scroll_and_expand){var s=a.prev();if(i&&s.length&&s.data("model-id")===i.id){d=true;b(r)}else b(a)}o=false;return null};if(t){l=false;o=true;if(i){var r=w(i);if(n.collapse_current_group){var s=r.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(i,s,{scroll_group:false}).then(function(){r.toggleClass("active",i.active&&f);TS.client.ui.unread.updateHeader(i);a()})}else{r.toggleClass("active",i.active&&f);TS.client.ui.unread.updateHeader(i);a()}}else a()}else o=false;return null};var b=function e(t){if(!t.length)return;var i=t.closest(".monkey_scroller");if(!i.length)i=t.closest(":scrollable(vertical)");if(i.is("html"))i=$("body");i.scrollTop(Math.round(t[0].offsetTop-8))};var w=function e(t){return TS.client.ui.unread.$unread_msgs_div.find("[data-model-id="+t.model_ob.id+"]")};var y=function e(){var t=TS.client.ui.unread.$scroller.scrollTop();var n=TS.client.ui.unread.unread_groups.toArray();if(!n.length)return;var r=n.reduce(function(e,i){if(t+TS.client.ui.CLIENT_HEADER_OVERHANG>=i.y)return i;return e});if(TS.boot_data.feature_sli_briefing)if(n.length&&TS.client.ui.CLIENT_HEADER_OVERHANG<n[0].y&&t<n[0].y){if(i){i.find(".unread_group_header").css({top:"0",right:"auto"});i.removeClass("currently_sticky");i=null;if(TS.highlights_briefing.$briefing_header){TS.highlights_briefing.$briefing_header.addClass("sticky");TS.highlights_briefing.$briefing_view.addClass("sticky")}}return}else if(!i&&TS.highlights_briefing.$briefing_header&&TS.highlights_briefing.$briefing_view){TS.highlights_briefing.$briefing_header.removeClass("sticky");TS.highlights_briefing.$briefing_view.removeClass("sticky")}if(!r)return;var s=a-1;if(!i){i=r.$node;i.find(".unread_group_header").css({top:s,right:$("#col_flex").outerWidth()});i.addClass("currently_sticky")}if(i!==r.$node){i.find(".unread_group_header").css({top:"0",right:"auto"});i.removeClass("currently_sticky");i=r.$node;i.find(".unread_group_header").css({top:s,right:$("#col_flex").outerWidth()});i.addClass("currently_sticky")}if(!o&&!d){var l=TS.client.unread.getActiveGroup();if(l)if(i.data("model-id")!=l.id){var c=TS.client.unread.getGroup(i.data("model-id"));c=TS.client.unread.setActiveGroup(c);v(c,l,{collapse_current_group:false,scroll_and_expand:false})}}d=false};var k=function e(){var t=TS.client.ui.unread.$scroller.find(".unread_group");TS.client.ui.unread.unread_groups=t.map(function(e,t){return{$node:$(t),y:t.offsetTop}})};var A=function e(){a=$("#banner").height()};var C=function e(t){return{model_ob:t.model_ob,model_ob_id:t.model_ob.id,has_new_unreads:t.new_unread_cnt>0,unread_cnt:t.total_unreads||0,new_unread_cnt:t.new_unread_cnt,marked_as_read_cnt:t.marked_as_read_cnt||0,show_footer:t.new_unread_cnt>0,im_member:t.model_ob.is_im?TS.members.getMemberById(t.model_ob.user):{},marked_as_read:t.marked_as_read,collapsed:t.collapsed,active:f&&t.active,is_channel:t.model_ob.is_channel,is_group:t.model_ob.is_group,is_mpim:t.model_ob.is_mpim,is_im:t.model_ob.is_im,im_user:t.model_ob.user?TS.members.getMemberById(t.model_ob.user):null,supports_sticky_position:TS.environment.supports_sticky_position}};var M=function e(){if(!TS.client.unread.areAllMessagesFetched())return;var t=TS.client.unread.getAllGroups();var i=true;if(t.length)i=_.reduce(t,function(e,t){return e&&t.marked_as_read},t[0].marked_as_read);if(i)TS.client.ui.unread.displayEmptyState()};var I=function e(){h=false;TS.client.ui.unread.hideLoadingMessage();TS.client.ui.unread.$scroller.addClass("transitioning");TS.client.ui.unread.updateChannelHeader();TS.client.ui.unread.updateMsgs();TS.client.ui.unread.$scroller.removeClass("transitioning")};var x=function e(t,i,n){var a=TS.client.unread.getGroup(i);var r=a.model_ob;var s=TS.utility.msgs.getMarkMsgTSForUnreadPoint(t,a.msgs,r);var o=_.findIndex(a.msgs,{ts:s});var l=n.closest(".unread_group");l.find(".unread_divider").remove();l.find(".unread_day_container").removeClass("unread_day_container");if(!s)return false;a.manually_marked_unread_msg=t;TS.shared.markReadMsg(a.model_ob.id,s,TS.model.marked_reasons.back);TS.client.markLastReadsWithAPI();if(t===parseFloat(a.msgs[a.msgs.length-1].ts))return;var d=TS.templates.messages_unread_divider({label:TS.i18n.t("unread messages","all_unreads")()});var c=TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+a.msgs[o].ts+'"]');c.after(d);var u=n.closest(".unread_group").find(".unread_divider");if(u.next(".day_divider").length||u.is(":last-child")){u.addClass("adjacent_to_date");u.closest(".day_container").next(".day_container").addClass("unread_day_container")}return true};var E=function t(i){if(TS.model.unread_view_is_showing){var n=i.batch?i.batch:[i];_.each(n,function(t){TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(t,e)})})}}})()},4414:function(e,t){(function(){"use strict";TS.registerModule("ui.message_container",{register:function e(t){if(!t.container){TS.error("TS.ui.message_container.register requires a container!");return}if(!t.updateCallback)t.updateCallback=_.noop;if(!t.msg_order)t.msg_order="asc";C(t);var i=M(t);var n=$(t.container);n.data("message-container-config",t);n.addClass("message_container");f(t,i);TS.attachment_actions.select.decorateNewElements(n);t._state=i;S(t);r(t);if(TS.client&&t.name)TS.client.ui.checkInlineImgsAndIframes(t.name)},cleanup:function e(t){var i=$(t.container);var n=i;if(t.scroller)n=$(t.scroller);n.off("scroll.message_container");if(t._pending_op)t._pending_op.cancel()},update:function t(i,n){e={added:[],removed:[],replaced:[]};var a=$(i.container);i._known_edits=n;if(i._range)C(i,i._range.start);else C(i);var r=M(i);var s=i._state;var o=T(s,r);var l;w(o,function(e){var t=e.item;if("continue"===e.action){l=a.children('[data-section-id="'+t.id+'"]');c(i,t)}else if("delete"===e.action)a.children('[data-section-id="'+t.id+'"]').remove();else if("insert"===e.action){var n=h(i,t);if(l&&l.length)l.after(n);else a.prepend(n);l=n}else if("append"===e.action){var r=h(i,t);a.append(r);l=r}});i._state=r;S(i);if(TS.client&&i.name)TS.client.ui.checkInlineImgsAndIframes(i.name);TS.attachment_actions.select.decorateNewElements(a);var d=a;if(i.scroller)d=$(i.scroller);TS.ui.utility.updateClosestMonkeyScroller(d);if(i.updated_sig)i.updated_sig.dispatch(e);if(i.page_size){var u=_.reduce(r,function(e,t){var i=t.msgs.length||1;return e+i},0);if(!i._pending_op&&u<2*i.page_size){var m;if(i.has_more_end&&i.promiseToLoadMoreAtEnd)m=i.promiseToLoadMoreAtEnd;else if(i.has_more_beginning&&i.promiseToLoadMoreAtBeginning)m=i.promiseToLoadMoreAtBeginning;if(m)i._pending_op=m().then(function(){TS.ui.message_container.updateWithFocus(i,a.find(".message_container_item").first());return null}).finally(function(){i._pending_op=null})}}var f=e;i.updateCallback(f);e=null;i._known_edits=null;return f},updateWithFocus:function e(t,i){if(!i||!i.length)return TS.ui.message_container.update(t);var n=$(i);var a;if(i.is("ts-message")){var r=i.find(".message_body");if(r.length)n=r}if(i.is("ts-thread")){var s=i.find("ts-message:first");if(s.length)n=s}TS.ui.utility.preventElementFromScrolling(n,function(){a=TS.ui.message_container.update(t);return null},function(){var e=$(t.container);if($.contains(e[0],n[0]))return n;var a=i.attr("id");i=e.find("#"+a);if(i.is("ts-message")){r=i.find(".message_body");if(r.length)return r}if(i.is("ts-thread")){s=i.find("ts-message:first");if(s.length)return s}return i});return a},maybeUpdateMessages:function e(t,i){var n=$(t.container);var a=t._state;_.forEach(a,function(e){var a=n.children('[data-section-id="'+e.id+'"]');var r=F(t,e.msgs);var s=a.find(".day_container");_.forEach(r,function(n){var a=n.length>0?n[0].ts:null;if(!a)return;var r=s.filter(function(){var e=$(this).attr("data-ts");var i=TS.interop.datetime.toDateObject(a);var n=TS.interop.datetime.toDateObject(e);return t.skip_day_groupings||TS.interop.datetime.isSameDay(i,n)});if(!r.length)return;var o=b(n,n,t.msg_order,i);m(t,e,r,n,o)})})},jumpToTop:function e(t){delete t._range;var i=$(t.container).find(".message_container_item").first();var n=TS.ui.message_container.updateWithFocus(t,i);i=$(t.container).find(".message_container_item").first();i.scrollintoview({offset:"top",px_offset:50});return n},jumpToEnd:function e(t){var i=D(t);C(t,i);var n=TS.ui.message_container.update(t);var a=$(t.container);if(t.scroller)a=$(t.scroller);a.scrollTop(a.prop("scrollHeight"));return n},jumpToTS:function e(t,i,n){var a=B(t);var r=i;if(n){var s=_.findIndex(a,{msg_ts:r});if(s>0){s=Math.max(0,s-n);r=a[s].msg_ts}}var o=_.find(a,{msg_ts:r});C(t,o);return TS.ui.message_container.update(t)},scrollintoview:function e(t,i,n){if(t._scrolling_into_view)return;t._scrolling_into_view=true;n=n||{};var a=n.complete;var r=function e(){t._scrolling_into_view=false;if(a)a.call(this)};n.complete=r;$("#"+i).scrollintoview(n)},getRange:function e(t){return t._range},pageUp:function e(t,i){if(!t._range||!t.page_size)return;I(t);TS.ui.message_container.updateWithFocus(t,i);if(t.afterPageUp){var n=H(t);_.invoke(t,"afterPageUp",n)}},pageDown:function e(t,i){if(!t._range||!t.page_size)return;x(t);TS.ui.message_container.updateWithFocus(t,i);if(t.afterPageDown){var n=H(t);_.invoke(t,"afterPageDown",n)}},test:function e(){return{resolveOrderedLists:y}}});var e;var t=false;var i=function t(i){if(!e)return;e.removed.push(i)};var n=function t(i){if(!e)return;e.added.push(i)};var a=function t(i){if(!e)return;e.replaced.push(i)};var r=function e(t){if(!t.page_size)return;var i=$(t.container);var n=L(t);var a=n.parent();var r=_.debounce(function(e){if(t._scrolling_into_view)return;var n=e.scrollTop;var r=e.scrollHeight;var d=a.height();var c=n+d;var _=r>3*d?.9:1;var u=c>.25*r;var m=0===n;var f=c>r*_;if(u)o(t);if(f)l(t,i);else if(m)s(t,i);if(TS.client)TS.client.ui.checkInlineImgsAndIframes(t.name)},250);n.on("scroll.message_container",function(){r(this)})};var s=function e(t,i){var n=B(t);if(!n.length)return;var a=i.find(".message_container_item").first();var r=_.first(n);var s=_.get(t,"_range.start");if(_.isEqual(r,s)){if(t.has_more_beginning&&t.promiseToLoadMoreAtBeginning){t._pending_op=t.promiseToLoadMoreAtBeginning().then(function(){TS.ui.message_container.pageUp(t,a)}).finally(function(){t._pending_op=null});return t._pending_op}}else TS.ui.message_container.pageUp(t,a)};var o=function e(i){if(!i._pending_op&&true!==t)if(i.has_more_end&&i.promiseToLoadMoreAtEnd){N("Start pre-emptive load of more messages",i);i._pending_op=i.promiseToLoadMoreAtEnd().then(function(){N("End pre-emptive load of more messages",i);i._pending_op=null;t=true});return i._pending_op}};var l=function e(i,n){var a=n.find(".message_container_item").last();if(t){N("Start appending loaded but not shown messages",i);t=false;d(i,a);N("End appending loaded but not shown messages",i)}else{if(!i._pending_op&&i.has_more_end&&i.promiseToLoadMoreAtEnd){N("Start load of more messages at append point",i);i._pending_op=i.promiseToLoadMoreAtEnd().then(function(){N("End load of more messages at append point",i);N("Start appending loaded messages at append point",i);i._pending_op=null;t=false;d(i,a);N("End appending loaded messages at append point",i)});return i._pending_op}if(i._pending_op)return i._pending_op.then(function(){if(t){N("Start appending loaded but not shown messages after pending",i);i._pending_op=null;t=false;d(i,a);N("End appending loaded but not shown messages after pending",i)}});N("Appending loaded and shown messages hidden by message_container at append point",i);d(i,a)}};var d=function e(t,i){TS.ui.message_container.pageDown(t,i);var n=H(t);if(n)return;var a=L(t);if(0===a.scrollTop()){a.scrollTop(80);t.page_size*=2}};var c=function e(t,i){var n=$(t.container);var a=_.find(t._state,{id:i.id});if(!i){TS.error("TS.ui.message_container.update could not find section "+i.id+" to update.");return}if(!a){TS.error("TS.ui.message_container.update could not find section_state for "+i.id+" to update.");return}var r=n.children('[data-section-id="'+i.id+'"]');if(!r.length){TS.error("TS.ui.message_container.updateSection could not find section "+i.id);return}if(i.completeness){r.removeClass("complete partial_start partial_end");if(i.completeness.start&&i.completeness.end)r.addClass("complete");else{if(!i.completeness.start)r.addClass("partial_start");if(!i.completeness.end)r.addClass("partial_end")}}var s=F(t,i.msgs);var o=F(t,a.msgs);var l=v(o,s,t.msg_order,t.skip_day_groupings);u(t,i,r,s,o,l)};var u=function e(t,i,n,a,r,s){var o;var l=n.find(".msgs_holder");if(!l.length)l=n;var d=l.find(".day_container");var c=function e(i){return d.filter(function(){var e=$(this).attr("data-ts");var n=TS.interop.datetime.toDateObject(i);var a=TS.interop.datetime.toDateObject(e);return t.skip_day_groupings||TS.interop.datetime.isSameDay(n,a)})};var u=function e(i,n){return _.find(i,function(e){var i=e[0];return t.skip_day_groupings||TS.utility.msgs.areMsgsSameDay(i,n)})};var f=function e(i){if(t._known_edits)if(_.includes(t._known_edits,i.ts))return true};w(s,function(e){var n=e.item;var s=u(a,n);if("continue"===e.action){o=c(n.ts);var _=b(u(r,n),s,t.msg_order,f);m(t,i,o,s,_)}else if("delete"===e.action)c(n.ts).remove();else if("insert"===e.action){var h=g(t,i,u(a,n));if(o&&o.length)o.after(h);else if(d.length)d.first().before(h);else l.append(h);o=h}else if("append"===e.action){var p=g(t,i,u(a,n));l.append(p);o=p}})};var m=function e(t,r,s,o,l){var d;var c=s.find(".message_container_item");var _={};c.each(function(){var e=$(this).attr("data-ts");_[e]=this});var u={};var m={};var f;o.forEach(function(e){u[e.ts]=e;m[e.ts]=f;f=e});var h;w(l,function(e){var o=e.item;var l=o.ts;var f=e.action;if("edited"===f)f="replace";if("continue"===f&&("insert"===h||"delete"===h))f="replace";if("continue"===f)d=$(_[l]);else if("replace"===f){var g=$(_[l]);var S=p(t,u[l],m[l],r);g.replaceWith(S);a(S);d=S}else if("delete"===f){var T=$(_[l]);i(T);T.remove()}else if("insert"===f){var v=p(t,u[l],m[l],r);if(d&&d.length)d.after(v);else if(c.length)c.first().before(v);else s.append(v);n(v);d=v}else if("append"===f){var b=p(t,u[l],m[l],r);s.append(b);n(b);d=b}h=e.action})};var f=function e(t,i){var n=$(t.container);_.forEach(i,function(e){var i=h(t,e);n.append(i)})};var h=function e(t,i){var n=t.buildSection(i);var a=$(n);a.attr("data-section-id",i.id);if(i.completeness)if(i.completeness.start&&i.completeness.end)a.addClass("complete");else{if(!i.completeness.start)a.addClass("partial_start");if(!i.completeness.end)a.addClass("partial_end")}var r=a.find(".msgs_holder");if(!r.length)r=a;var s=F(t,i.msgs);_.forEach(s,function(e){var n=g(t,i,e);r.append(n)});return a};var g=function e(t,i,a){var r=a[0];var s=$('<div class="day_container" data-ts="'+r.ts+'"></div>');if(!t.skip_day_groupings){var o=$(t.buildDayDivider(i,r));s.append(o);n(o)}var l;var d=_.map(a,function(e){var n=p(t,e,l,i);l=e;return n});d.forEach(function(e){s.append(e);n(e)});return s};var p=function e(t,i,n,a){var r=t.buildMsgHTML(i,n,a);var s=$(r);s.addClass("message_container_item");return s};var S=function e(t){var i=$(t.container);var n=B(t);var a=_.first(n);var r=_.last(n);var s=t._range&&t._range.start;var o=t._range&&t._range.end;var l=t.has_more_beginning;if(!l)if(a&&s&&!_.isEqual(a,s))l=true;var d=t.has_more_end;if(!d)if(r&&o&&!_.isEqual(r,o))d=true;var c=TS.i18n.t("Loading more messages...","unread")();var u=i.find(".and_more_beginning");u.remove();if(l)i.prepend('<div class="and_more_beginning italic align_center large_top_margin large_bottom_margin">'+c+"</div>");var m=i.find(".and_more_end");m.remove();if(d)i.append('<div class="and_more_end italic align_center large_top_margin large_bottom_margin">'+c+"</div>");else i.find(".unread_group:last").addClass("at_bottom")};var T=function e(t,i){return y(t,i,function(e,t){var i=e.order||0;var n=t.order||0;return i-n})};var v=function e(t,i,n,a){var r=_.map(t,function(e){return e[0]});var s=_.map(i,function(e){return e[0]});return y(r,s,function(e,t){if(a||TS.utility.msgs.areMsgsSameDay(e,t))return 0;return O(n,e.ts,t.ts)})};var b=function e(t,i,n,a){return y(t,i,function(e,t){if(e.ts===t.ts)return 0;return O(n,e.ts,t.ts)},function(e,t){if(a){var i=a(e,t);if(!_.isUndefined(i))return i}return Q(e,t)})};var w=function e(t,i){while(t){i(t);t=t.next}};var y=function e(t,i,n,a){var r=A(t,0);var s=A(i,0);return k(r,s,n,a)};var k=function e(t,i,n,a){if(!t&&!i)return null;if(!t)return{action:"append",item:i.item,next:e(t,i.next,n,a)};if(!i)return{action:"delete",item:t.item,next:e(t.next,i,n,a)};var r=n(t.item,i.item);if(0===r){if(a&&a(t.item,i.item))return{action:"edited",item:i.item,next:e(t.next,i.next,n,a)};return{action:"continue",item:i.item,next:e(t.next,i.next,n,a)}}if(r<0)return{action:"delete",item:t.item,next:e(t.next,i,n,a)};if(r>0)return{action:"insert",item:i.item,next:e(t,i.next,n,a)}};var A=function e(t,i,n){if(i>=t.length)return null;var a={item:t[i],prev:n};a.next=e(t,i+1,a);return a};var C=function e(t,i){if(!t.page_size)return;var n=B(t);if(!n.length)return;var a=2*t.page_size;var r={};var s=0;var o=t.msg_order;if(i){var l=false;s=_.findIndex(n,function(e){if(e.section_id===i.section_id){if(-1==e.msg_ts)return true;if(!l)l=true;return R(o,e.msg_ts,i.msg_ts)}if(l&&e.section_id!==i.section_id)return true;return false});if(s<0)s=0}var d=Math.min(a+s,n.length);r.start=n[s];r.end=n[d-1];if(s>0&&d-s<a){var c=a-(d-s);s=Math.max(0,s-c);r.start=n[s]}t._range=r};var M=function e(t){if(!t._range)return _.map(t.sections,function(e){var t=_.create(e);t.msgs=_.map(e.msgs,_.clone);t.completeness={start:true,end:true};return t});var i=[];var n=t._range.start;var a=t._range.end;_.forEach(t.sections,function(e){if(!E(e,t))return;var r=_.create(e);var s=P(t,e.msgs);r.msgs=_.filter(s,function(i){var r=t.msg_order;if(n.section_id===a.section_id)return R(r,i.ts,n.msg_ts)&&U(r,i.ts,a.msg_ts);if(e.id===n.section_id)return R(r,i.ts,n.msg_ts);else if(e.id===a.section_id)return U(r,i.ts,a.msg_ts);return true});if("desc"===t.msg_order)r.completeness={start:_.first(r.msgs)===_.first(s),end:_.last(r.msgs)===_.last(s)};else r.completeness={start:_.last(r.msgs)===_.last(s),end:_.first(r.msgs)===_.first(s)};if(e===_.first(t.sections)&&t.has_more_beginning)r.completeness.start=false;if(e===_.last(t.sections)&&t.has_more_end)r.completeness.end=false;r.msgs=_.map(r.msgs,_.clone);i.push(r)});return i};var I=function e(t){var i=B(t);var n=t._range;var a=t.msg_order;var r=_.takeWhile(i,function(e){return!(e.section_id===n.start.section_id&&R(a,e.msg_ts,n.start.msg_ts))});if(!r.length)return;var s=_.drop(i,r.length);var o=false;s=_.takeWhile(s,function(e){if(o)return false;var t=e.section_id===n.end.section_id&&R(a,e.msg_ts,n.end.msg_ts);if(t)o=true;return true});var l=_.takeRight(r,t.page_size);var d=_.take(s,s.length-l.length);n.start=_.first(l);n.end=_.last(d)};var x=function e(t){var i=B(t);var n=t._range;var a=t.msg_order;i=_.dropWhile(i,function(e){return!(e.section_id===n.start.section_id&&R(a,e.msg_ts,n.start.msg_ts))});var r=false;var s=_.takeWhile(i,function(e){if(r)return false;var t=e.section_id===n.end.section_id&&R(a,e.msg_ts,n.end.msg_ts);if(t)r=true;return true});var o=_.drop(i,s.length);if(!o.length)return;var l=_.take(o,t.page_size);var d=_.drop(s,l.length);n.start=_.first(d);n.end=_.last(l)};var E=function e(t,i){if(!i._range)return true;var n=false;var a;for(var r=0;r<i.sections.length;r+=1){a=i.sections[r];if(!n&&a.id===i._range.start.section_id)n=true;if(n&&a.id===t.id)return true;if(a.id===i._range.end.section_id)break}return false};var B=function e(t){var i=[];var n=t.msg_order;var a="asc"===n?_.forEachRight:_.forEach;_.forEach(t.sections,function(e){if(!e.msgs.length)i.push({section_id:e.id,msg_ts:"-1"});else{var n=P(t,e.msgs);a(n,function(t){i.push({section_id:e.id,msg_ts:t.ts})})}});return i};var D=function e(t){var i;_.findLast(t.sections,function(e){if(!e.msgs||!e.msgs.length)return false;var n;var a;if("asc"===t.msg_order){n=_.first(e.msgs);a=n?n.ts:null;i={section_id:e.id,msg_ts:a}}else{n=_.last(e.msgs);a=n?n.ts:null;i={section_id:e.id,msg_ts:a}}return true});return i};var F=function e(t,i){if(!i)return[];var n=t.msg_order;var a="asc"===n?_.forEachRight:_.forEach;var r;var s=[];var o=[];a(i,function(e){if(!t.skip_day_groupings&&(!r||!TS.utility.msgs.areMsgsSameDay(e,r))){if(o.length)s.push(o);o=[e]}else o.push(e);r=e});if(o.length)s.push(o);return s};var P=function e(t,i){if("desc"===t.msg_order)return i;var n=[];var a=[];var r;var s;var o;for(r=i.length-1;r>-1;r-=1){o=i[r];if(o.no_display)continue;if(o._hidden_reply&&!t.show_hidden_replies)continue;s=TS.utility.msgs.msgRollUpWorker(r,o,i,a);if("continue"===s)continue;else if("swap"===s){o=a[0];a.length=0}n.unshift(o)}return n};var O=function e(t,i,n){if("asc"===t){if(i<n)return-1;if(i>n)return 1}else{if(i>n)return-1;if(i<n)return 1}return 0};var R=function e(t,i,n){if("asc"===t)return i>=n;return i<=n};var U=function e(t,i,n){if("asc"===t)return i<=n;return i>=n};var Q=function e(t,i){if(i.ts in TS.model.display_unsent_msgs)return true;var n=t.edited;var a=i.edited;if(t.is_ephemeral&&t.text!==i.text)return true;return!_.isEqual(n,a)||!_.isEqual(t.reply_count,i.reply_count)};var L=function e(t){var i=$(t.container);var n=i;if(t.scroller)n=$(t.scroller);return n};var H=function e(t){var i=B(t);var n=_.first(i);var a=_.get(t,"_range.start");var r=_.isEqual(n,a);return r};var N=function e(t,i){var n=102;if(!TS.shouldLog(n))return;var a=B(i);var r=a.length;var s=i.sections.length;var o=i._range?_.findIndex(a,{msg_ts:i._range.start.msg_ts}):null;var l=i._range?_.findIndex(a,{msg_ts:i._range.end.msg_ts}):null;var d=i.has_more_end;TS.log(n,"[msg_container] "+t,{sections:s,messages:r,range_start:o,range_end:l,has_more_end:d})}})()},4415:function(e,t){(function(){"use strict";TS.registerModule("client.ui.app_profile",{onStart:function e(){$('[data-js="app_profile_tab"]').on("click",'[data-js="app_profile_btn"]',TS.client.ui.app_profile.onButtonClick)},active_app:null,openWithApp:function i(a,r,s,o){if(!a)return;if(void 0==o)o=true;TS.client.ui.app_profile.active_app=a;e=TS.apps.constructTemplateArgsForCardAndProfile(a,r,s,o);TS.client.ui.flex.openAppProfileFlex(r||a.id);$('[data-js="app_profile_header"]').html(TS.templates.app_profile_title(e));t=$('[data-js="app_profile_scroller"]');t.html(TS.templates.app_profile(e));n();var l=t.find('[data-js="app_auth_settings"]');if(o&&!_.get(a,"is_slack_integration"))TS.apps.promiseToGetFullAppProfile(r,s,a.id,true).then(function(t){if(t.auth_summary_list){var i={name:e.name,auth_summary_list:t.auth_summary_list};l.html(TS.templates.app_profile_settings(i))}else l.hide()});else l.hide();TS.clog.track("APP_PROFILE_OPEN",{app_id:a.id,bot_id:r,contexts:{core:{app_id:a.id,bot_id:r}}})},onButtonClick:function e(t){var n=$(this);var a=n.data("action");if("open_bot_dm"===a){var r=TS.client.ui.app_profile.active_app;var s=r.bot_user?r.bot_user.id:"";TS.clog.track("USER_PROFILE_CLICK",{app_id:r.id,bot_id:s});t.preventDefault();TS.ims.startImByMemberId(s)}else if("open_overflow_menu"===a)TS.client.ui.app_profile.openOverflowMenu(t);else if("desc_expand"===a){i.removeClass("app_desc_expand_showing");setTimeout(function(){i.addClass("app_desc_collapse_showing")},300)}else if("desc_collapse"===a){i.removeClass("app_desc_collapse_showing");i.addClass("app_desc_expand_showing")}},openOverflowMenu:function t(i){if(TS.menu.isRedundantClick(i))return;if(TS.client.ui.checkForEditing(i))return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_items.html(TS.templates.menu_app_profile_items(e));TS.menu.start(i,true);var n=$(i.target);TS.menu.positionAt(n,n.width()-TS.menu.$menu.width(),n.height()+8);TS.menu.$menu_items.on("click.menu","li",TS.client.ui.app_profile.onOverflowMenuClick);TS.menu.keepInBounds()},onOverflowMenuClick:function e(t){var i=$(this);var n=i.data("action");var a=TS.client.ui.app_profile.active_app;if("files"===n){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(a.bot_user.id)}else if("invite_to_channel"===n){t.preventDefault();TS.ui.invite.showInviteMemberToChannelDialog(a.bot_user.id)}else if(TS.features.isEnabled("retire_team_site_directory"))if("view_bot_profile"===n){t.preventDefault();TS.client.ui.previewMember(a.bot_user.id)}var r=a.id;var s=a.bot_user?a.bot_user.id:"";TS.clog.track("USER_PROFILE_CLICK",{app_id:r,bot_id:s});TS.menu.end()}});var e;var t;var i;var n=function e(){i=t.find('[data-js="app_profile_desc"]');if(i.find('[data-js="app_profile_desc_inner"]').height()<=1.2*i.height())i.removeClass("app_desc_expand_showing");else i.css("max-height",i.find('[data-js="app_profile_desc_inner"]').height());t.find(".emoji_replace_on_load").each(function(){var e=$(this).html();e=TS.emoji.graphicReplace(e);$(this).html(e)})}})()},4416:function(e,t){(function(){"use strict";TS.registerModule("channels_suggestions",{onStart:function e(){if(!TS.client)return;TS.client.login_sig.addOnce(function(){window.setTimeout(function(){TS.api.call("channels.suggestions",{}).then(_.noop)},3e4)})}})})()},4417:function(e,t){(function(){"use strict";TS.registerModule("ui.replies",{$scroller:$("#convo_scroller"),onStart:function e(){if(!TS.client){TS.warn("TS.ui.replies only works in the client");return}TS.prefs.team_perms_pref_changed_sig.add(D);TS.client.flexpane_display_switched_sig.add(A);TS.ui.window_focus_changed_sig.add(V);TS.replies.sanity_check_failed_sig.add(L);TS.replies.reply_changed_sig.add(K);TS.replies.reply_deleted_sig.add(z);TS.channels.joined_sig.add(H);TS.channels.left_sig.add(N);TS.groups.left_sig.add(G);TS.channels.archived_sig.add(j);TS.groups.archived_sig.add(j);TS.channels.unarchived_sig.add(j);TS.groups.unarchived_sig.add(j);TS.channels.history_fetched_sig.add(W);TS.groups.history_fetched_sig.add(W);TS.ims.history_fetched_sig.add(W);TS.mpims.history_fetched_sig.add(W);TS.view.members.unknown_resolution_rebuild_sig.add(Y);if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(f);else TS.ms.connected_sig.add(f);TS.channels.read_only.list_updated_sig.add(TS.ui.replies.refreshConversation);U=TS.utility.throttleFunc(U,250,true);h()},refreshConversation:function e(){var t=TS.ui.replies.activeConvoModelId();var i=TS.ui.replies.activeConvoThreadTs();if(!t||!i)return;var n=TS.shared.getModelObById(t);var a=TS.replies.getMessage(n,i);if(!a)return;r=TS.permissions.members.canPostInModelOb(TS.model.user,n)&&!n.is_archived;if(TS.boot_data.feature_default_shared_channels&&!r)r=TS.permissions.members.canThread(n);I(n,a)},openConversationFromMessagePane:function e(t,i,n,a,r){if(_.isString(i))i=TS.shared.getModelObById(i);var s=TS.client.ui.areMsgsScrolledToBottom();if(s){TS.ui.replies.openConversation(i,n,a,r);TS.client.ui.instaScrollMsgsToBottom()}else TS.ui.utility.preventElementFromScrolling(t,function(){TS.ui.replies.openConversation(i,n,a,r)})},openConversation:function e(t,i,n,r){try{if(!i){TS.error("openConversation called with bogus data; this is a programming error.");C();return}if(!TS.client){var s=TS.utility.msgs.constructConversationPermalink(t,i);window.location=s;return}if(_.isNumber(i)){TS.warn("Thread flexpane opened with non-string thread_ts");i+=""}TS.info("Opening conversation "+i+" in "+t.id);var o=!!a;y();k=true;TS.client.ui.flex.openConversationFlex(t,i);TS.ui.replies.maybeRenderReplies(t,i,n,r);TS.utility.msgs.startUpdatingRelativeTimestamps("#convo_container");if(o){F();d=true}else{$("#reply_container .message_input").addClass("hidden");d=false;TS.view.resize_sig.addOnce(function(){$("#reply_container .message_input").removeClass("hidden");F();d=true;c.dispatch()})}}catch(e){TS.error("Something went wrong when trying to open conversation "+i+" in "+_.get(t,"id")+": "+e);C()}finally{k=false}},maybeRenderReplies:function t(i,d,c,u){var m=TS.replies.getMessage(i,d);var f=$("ts-conversation");if(f.length){if(f.find("ts-message.selected").attr("data-ts")!=d){TS.warn("maybeRenderReplies called when same convo is already open");return Promise.resolve()}return Promise.reject(new Error("There is already a conversation open; only one can be open at a time"))}f=$(TS.templates.message_conversation({model_ob_id:i.id,thread_ts:d}));n=i.id;a=d;r=TS.permissions.members.canPostInModelOb(TS.model.user,i)&&!i.is_archived;if(TS.boot_data.feature_default_shared_channels&&!r)r=TS.permissions.members.canThread(i);s=[];if(u&&_.includes(l,u))o=u;else o=null;w(i,d,f);R(true);Z(m,i,d,f);TS.ui.message_container.register(e);M(f);if(m)I(i,m);var h=!!o;TS.ui.replies.toggleBackButton(h);var g;if(c)g=TS.replies.getThreadAround(i.id,d,c);else{var p=false;g=TS.replies.getThreadLazy(i.id,d,p)}return g.then(function(e){TS.ui.replies.finishRenderingReplies(i,d,m,e,c);if(TS.client&&!TS.onboarding.inOnboarding()&&(!TS.model.prefs.seen_replies_coachmark||TS.qs_args.show_replies_coachmark))setTimeout(function(){if(!a)return;TS.coachmark.start(TS.coachmarks.coachmarks.replies);TS.model.prefs.seen_replies_coachmark=true;TS.prefs.setPrefByAPI({name:"seen_replies_coachmark",value:true})},500);return null}).catch(function(e){TS.error("Unable to get conversation around message thread_ts="+d+" with error: "+e);if(n!==i.id||a!==d)return;C()}).finally(function(){if(n!==i.id||a!==d)return;if(0===f.closest(".monkey_scroller").width())TS.ui.utility.updateClosestMonkeyScroller(TS.ui.replies.$scroller,true);R(false)})},finishRenderingReplies:function t(i,r,o,l,d){var c=l.messages;var _=!!l.has_more_beginning||!!l.has_more_end;if(n!=i.id)return;if(a!=r)return;TS.info("Rendering thread "+r+", "+c.length+" messages (has_more: "+_+")");s=c;if(S()){TS.client.ui.flex.hideFlex();return}if(!o){o=TS.utility.msgs.getMsg(r,c);o=l.root_msg;I(i,o)}q(c,l.has_more_beginning,l.has_more_end);if(d)TS.ui.message_container.jumpToTS(e,d,m);else if(l.has_more_beginning)TS.ui.message_container.jumpToEnd(e);o=b(o,c);E(o);TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",i.id,r);if(d){var u=TS.templates.makeMsgDomIdInConversation(d);TS.ui.message_container.scrollintoview(e,u,{offset:"bottom",px_offset:-50,complete:function e(){P()}});$("#"+u).highlight(2500,"msg_highlighter")}else P();TS.replies.promiseToGetSubscriptionState(i.id,r).then(function(e){if(n!=i.id)return;if(a!=r)return;if(!e)return;TS.ui.replies.checkUnreads();return null});return null},maybeRemoveMessageFromConversation:function e(t,r){if(t.id!==n)return;if(r.thread_ts!=a&&r.ts!=a)return;var o=s&&_.find(s,{ts:r.ts});if(o)o.subtype="tombstone";if(S()){TS.client.ui.flex.hideFlex();return}var l=g();if(l.length&&r.ts==a){TS.ui.replies.maybeUpdateConversationWithMessage(t,r);return}var d=$('ts-conversation[data-thread-ts="'+r.thread_ts+'"]');if(!d.length)return;var c=d.find('ts-relatives ts-message[data-ts="'+r.ts+'"]');_.remove(s,{ts:r.ts});if(TS.utility.msgs.isMsgReply(r))_.remove(i.msgs,{ts:r.ts});if(r.is_pending)J();else if(c.length)c.addClass("delete_mode").slideUp(200,function(){J()});else J();E(_.find(s,{ts:r.thread_ts||r.ts}))},maybeUpdateConversationWithMessage:function r(o,l){if(o.id!==n)return;if(l.thread_ts!=a&&l.ts!=a)return;var d=s&&_.findIndex(s,{ts:l.ts});if(-1!==d)s[d]=l;else s.push(l);var c=false;if(TS.utility.msgs.isMsgReply(l)){var u=_.findIndex(i.msgs,{ts:l.ts});if(-1!==u)i.msgs[u]=l;else{c=true;var m=_.findIndex(i.msgs,function(e){return e.ts<l.ts});if(-1===m)i.msgs.push(l);else i.msgs.splice(m,0,l)}}else if(t.msgs.length)t.msgs[0]=l;else t.msgs.push(l);if(S()){TS.client.ui.flex.hideFlex();return}var f=TS.ui.replies.$scroller[0];var h=Math.abs(f.scrollHeight-f.offsetHeight-f.scrollTop);var g=50;var p=TS.ui.replies.$scroller.find("#reply_container");if(p.length)g=p.outerHeight(true);var T=h<g;var v=$('ts-conversation[data-thread-ts="'+(l.thread_ts||l.ts)+'"]');if(!v.length)return;var b=v.find('ts-message[data-ts="'+l.ts+'"]');var w;J([l.ts]);if(c&&T)TS.ui.message_container.jumpToEnd(e);w=v.find('ts-message[data-ts="'+l.ts+'"]');if(b.length)if(b.hasClass("hidden"))w.addClass("hidden");E(_.find(s,{ts:l.thread_ts||l.ts}));if(!b.length)TS.ui.replies.checkUnreads();if(T)f.scrollTop=f.scrollHeight-f.offsetHeight},updateMessageActions:function e(t,i){if(!TS.replies.canReplyToMsg(t,i)){if(t.is_channel&&!t.is_member)Q(t,i);return}var n=i.thread_ts||i.ts;var a=$("#reply_container");a.empty();a.append(TS.ui.replies.getReplyInputAvatarHTML());TS.ui.inline_msg_input.make(a,{placeholder:TS.i18n.t("Reply...","threads")(),complete_member_specials:TS.boot_data.feature_name_tagging_client?["BKhere"]:false,complete_cmds:true,in_thread:true,model_ob:t,onSubmit:function e(a,r){if(!TS.model.ms_connected)return;if(t.is_archived){TS.generic_dialog.alert(TS.i18n.t("This channel has been archived; you cannot send messages to it.","threads")());return}var o=_.reject(s,p);if(!o.length)return;var l=_.maxBy(o,"ts");var d=TS.client.ui.maybeHandleReactionCmd(l,r,function(){TS.ui.replies.clearReplyInput(t,n)});if(d)return;if(TS.utility.msgs.shouldSendSlashCommand(r)){TS.ui.replies.clearReplyInput(t,n);TS.client.ui.sendSlashCommand(t,r,i)}else{TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",t.id,n);var c=$("#reply_container .reply_broadcast_toggle").prop("checked");if(TS.boot_data.feature_default_shared_channels&&c)c=TS.permissions.members.canPostInChannel(t);TS.ui.replies.clearReplyInput(t,n);var u=c?"THREADS_REPLY_BROADCAST_CLICKED":"THREADS_REPLY";var m=_.get(i,".reply_count",0)+1;TS.ui.thread.trackEvent(t.id,i.ts,"convo",u,{num_msg_in_thread:m});if(c)TS.log(2004,"Submitting broadcast from flexpane for "+t.id+"-"+i.ts);TS.client.ui.sendMessage(t,r,i,c)}},getMsgDivForEditing:function e(){if(!s)return null;var t=_.reject(s,p);_.reverse(t);var i=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,t);if(!i)return null;return $('#convo_container ts-message[data-ts="'+i.ts+'"]')},onTextChange:function e(i){var a=TS.ui.replies.getReplyInputValueForStorage(i);TS.storage.storeReplyInput(t.id,n,a);var r=TS.ui.replies.$scroller[0];TS.ui.replies.maybeScrollReplyInputToBottomOfScroller(r)}});TS.ui.replies.bindReplyInputFocusEvents(a);x(t,n,a);var r=TS.storage.fetchReplyInput(t.id,n);if(r)TS.ui.replies.populateReplyInput(r)},getReplyInputAvatarHTML:function e(){var t=36;var i=false;var n=true;return TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,t,i,n)},bindReplyInputFocusEvents:function e(t){var i=t.find(".message_input");i.on("focusin",function(){t.addClass("has_focus")}).on("focusout",function(){var e=TS.utility.contenteditable.isEmpty(i,true);var n=document.activeElement===this||TS.utility.contenteditable.isActiveElement(this);if(e&&!n)t.removeClass("has_focus")})},maybeScrollReplyInputToBottomOfScroller:function e(t){var i=Math.abs(t.scrollHeight-t.offsetHeight-t.scrollTop);var n=i<50;if(n)t.scrollTop=t.scrollHeight-t.offsetHeight},getReplyInputValueForStorage:function e(t){var i=TS.utility.contenteditable.value(t);var n=!i.trim();var a=n?"":i;return a},checkReplyInputLengthAndUpdate:function e(t){var i=t.find(".message_input");var n=TS.msg_edit.isMessageTooLong(i);if(TS.features.isEnabled("message_input_byte_limit"))t.find(".reply_container_info").toggleClass("no_opacity",n>0);else t.find(".reply_container_info").toggleClass("no_opacity",n)},submitReply:function e(t,i){if(!i||0===i.length)return;var n=i.closest("#reply_container, #file_reply_container").find("form");if(0===n.length)return;n.submit()},updateFlexpaneThreadDivider:function e(t,i){if(!t||!t.length)return;if(i){t.removeClass("hidden");var n=t.find(".reply_count");n.text(TS.i18n.t("{count, plural, =1 {# reply} other {# replies}}","threads")({count:i}))}else t.addClass("hidden")},activeConvoModelId:function e(){return n},activeConvoThreadTs:function e(){return a},activeConvoOrigin:function e(){return o},populateReplyInput:function e(t){var i=$("#reply_container .message_input");TS.utility.populateInput(i,t,t.length)},clearReplyInput:function e(t,i){TS.ui.replies.populateReplyInput("");TS.utility.contenteditable.clearHistory($("#reply_container .message_input"));TS.storage.storeReplyInput(t.id,i,"");$("#reply_container .reply_broadcast_toggle").attr("checked",false)},focusReplyInput:function e(t){if(t&&!O())return;TS.utility.contenteditable.focus($("#reply_container .message_input"))},getActiveMessage:function e(t,i){if(t.id!=n)return null;return TS.utility.msgs.getMsg(i,s)},getActiveMessages:function e(){return s},toggleBackButton:function e(t){$("#convo_tab_back_container").toggleClass("hidden",!t)},joinChannelFromThread:function e(){if(!n||!a)return;var t=TS.shared.getModelObById(n);if(!t)return;var i=_.find(s,function(e){return e.ts===a});if(!i)return;TS.channels.joinById(t.id,function(){I(t,i)},{in_background:true});$("#reply_container .join_channel_from_thread").addClass("disabled")},checkUnreads:function e(){if(!TS.client.ui.isUserAttentionOnChat())return;if(!n||!a)return;if(!s||s.length<2)return;var t=TS.replies.getSubscriptionState(n,a);if(!t||!t.subscribed)return;var i=_.chain(s).filter(function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)&&!p(e)}).map("ts").max().value();if(!i)return;if(!t.last_read||i>t.last_read)TS.replies.markThread(n,a,i);return null},rebuildMsgsIncludingMember:function t(i){if(!n||!a||!e)return;var r=TS.shared.getModelObById(n);if(!r)return;TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(i,e)})},maybeOpenConversationLink:function e(t,i){if(!t||!t.length)return false;var n=t.prop("hostname");var a=t.prop("pathname");if(!n||!a)return false;if(0!==a.indexOf("/conversation/"))return false;if(TS.utility.normalizeDevHost(n)!==TS.utility.normalizeDevHost(document.location.hostname))return false;var r=a.split("/");r=_.drop(r,1);if(3!==r.length)return false;var s=r[1];if(!s)return false;var o=TS.shared.getModelObById(s)||TS.channels.getChannelByName(s)||TS.groups.getGroupByName(s)||TS.mpims.getMpimByName(s);if(!o)return false;if(!(o.is_channel||o.is_group||o.is_im))return false;if(o.is_im&&TS.ims.isImWithDeletedMember(o))return false;var l=r[2];if(!l)return false;if(0!==l.indexOf("p"))return false;if(17!==l.length)return false;l=l.replace("p","");if(isNaN(l))return false;var d=l.substr(0,10)+"."+l.substr(10);TS.ui.replies.openConversation(o,d,null,i);return true},rebuildMsgCurrentStatusIncludingMember:function t(i){if(!n||!a)return;var r=TS.shared.getModelObById(n);if(!r)return;var s={member:i,for_message:true};var o=e._state;_.each(o,function(e){_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(i,e)){var t=$('ts-conversation[data-thread-ts="'+(e.thread_ts||e.ts)+'"]');if(!t.length)return;var n=t.find('ts-message[data-ts="'+e.ts+'"] .message_current_status');n.replaceWith(TS.templates.current_status(s))}})})}});var e;var t;var i;var n;var a;var r;var s;var o;var l=["mentions","search_results","starred_items","channel_page","group_page","im_page"];var d;var c=new signals.Signal;var u=false;var m=50;var f=function r(o){if(!u){u=true;return}if(o)return;if(!n||!a)return;var l=TS.shared.getModelObById(n);if(!l)return;var d=a;var c=_.maxBy(s,"ts");var m=_.get(c,"ts");if(!m)return;TS.replies.getThreadAfter(l.id,d,m).then(function(r){if(n!==l.id)return;if(a!==d)return;if(!r.messages.length)return;if(!t||!i)return;if(r.has_more)e.has_more_end=true;ee(i.msgs,r.messages,d);X();J()})};var h=function e(){TS.ui.replies.$scroller.scroll(function(){U()});TS.ui.replies.$scroller.click(function(){TS.ui.replies.checkUnreads()});$("#convo_tab").on("click","#convo_tab_back",function(){if("mentions"===o)TS.client.ui.flex.openFlexTab("mentions");else if("search_results"===o){TS.search.view.showResults();TS.search.view.maybeRebuildResults()}else if("starred_items"===o)TS.client.ui.flex.openFlexTab("stars");else if("channel_page"===o||"group_page"===o||"im_page"===o)TS.client.ui.flex.openFlexTab("details")})};var g=function e(){return $("ts-conversation ts-message.selected")};var p=function e(t){return"tombstone"===t.subtype};var S=function e(){var t=_.reject(s,p);return 0===t.length};var T=function e(t,i,n,a){if(p(i))return;return TS.templates.builders.msgs.buildHTML({msg:i,prev_msg:n,model_ob:t,is_in_conversation:true,highlight_as_new:a,relative_ts:true,enable_slack_action_links:true})};var v=function e(t,i){return TS.templates.builders.msgs.buildHTML({model_ob:t,msg:i,is_root_msg:true,is_in_conversation:true,full_date:true,enable_slack_action_links:true})};var b=function e(t,i){if(!t.replies)return t;for(var n=0;n<t.replies.length;n+=1){var a=t.replies[n];if(a&&"U00"===a.user){var r=_.find(i,{ts:a.ts});if(r&&r.bot_id)a.bot_id=r.bot_id;t.replies[n]=a}}return t};var w=function e(t,i,n){var a=$("#convo_tab");y();a.find("#convo_container").append(n)};var y=function n(){if(e){TS.ui.message_container.cleanup(e);e=null;t=null;i=null}$("#convo_tab #convo_container, #convo_tab #reply_container").empty();$("#thread_load_error_wrapper").remove();$("#convo_tab .thread_participants").empty()};var k=false;var A=function e(t,i){if(k)return;if(!TS.model.ui_state){TS.warn("TS.model.ui_state not available; ignoring this flexpane switch");return}var l=TS.model.ui_state.flex_name;var d=TS.model.ui_state.flex_extra;if("convo"===l&&"convo"===t&&d==i){var c=!$("#flex_contents #convo_container").is(":empty");if(c)return}if("convo"===t){y();n=void 0;a=void 0;r=void 0;s=void 0;o=void 0;TS.utility.msgs.stopUpdatingRelativeTimestamps("#convo_container")}if("convo"!==l)return;var _;var u;var m=(d||"").split("-");if(1==m.length){_=TS.shared.getActiveModelOb().id;u=m[0]}else{_=m[0];u=m[1]}if(!_||!u){TS.error("convo flex pane opened without thread_ts; ignoring");try{k=true;TS.client.ui.flex.hideFlex()}catch(e){}finally{k=false}return}var f=TS.shared.getModelObById(_);if(!f&&TS._incremental_boot){var h=function e(){f=TS.shared.getModelObById(_);TS.ui.replies.openConversation(f,u)};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(h);else TS.ms.connected_sig.addOnce(h);return}return TS.ui.replies.openConversation(f,u)};var C=function e(){if("convo"!==TS.model.ui_state.flex_name)return;y();B();$("#reply_container").addClass("hidden");var t={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f50d.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f50d.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f50d.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f50d.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f50d.png"};TS.ui.replies.$scroller.prepend(TS.templates.thread_flexpane_error({emoji:t[TS.model.prefs.emoji_mode]}))};var M=function t(n){var r=_.find(s,{ts:a});if(!r)return;var o=_.get(i,"msgs.length",0);o=Math.max(r.reply_count||0,o);var l=o>0;n.find("ts-relatives.descendants").toggleClass("empty",!l);n.toggleClass("has_replies",l);var d=n.find(".convo_flexpane_divider");TS.ui.replies.updateFlexpaneThreadDivider(d,o);var c=true;if(e.has_more_end)c=false;else{var u=_(i.msgs).map("ts").max();if(u){var m=TS.ui.message_container.getRange(e);var f=_.get(m,"end.msg_ts");if(u>f)c=false}}var h=$("#reply_container");h.toggleClass("hidden",!c)};var I=function e(t,i){var n=true;if(!TS.replies.canReplyToMsg(t,i,n))return;if(r)TS.ui.replies.updateMessageActions(t,i);else $("#reply_container").html(TS.templates.reply_limited({channel_name:TS.shared.getDisplayNameForModelOb(t),is_archived:t.is_archived}));$("#reply_container").removeClass("hidden")};var x=function e(t,i,n){if(!t||!n||0===n.length)return;var a=TS.permissions.members.canPostInChannel(t);n.append(TS.templates.reply_broadcast_buttons({model_ob:t,label_id:i,view:"convo",can_post_back_to_channel:a}));var r=n.find(".reply_broadcast_label_container, .reply_send");r.mousedown(function(e){e.preventDefault();TS.ui.replies.focusReplyInput()}).click(TS.ui.replies.focusReplyInput);if(TS.console.shouldLog(2004)){var s=n.find(".reply_broadcast_toggle");s.change(function(){var e=$(this).prop("checked");if(e)TS.log(2004,"Broadcast toggle checked");else TS.log(2004,"Broadcast toggle un-checked")});s.closest("label").mousedown(function(){TS.log(2004,"mousedown on broadcast toggle")}).keydown(function(){TS.log(2004,"keydown on broadcast toggle")})}};var E=function e(t){if(!t)return;$("#convo_tab .thread_participants").html(TS.templates.builders.buildThreadParticipantListHTML(t))};var B=function e(){$("#convo_tab .thread_participants").text("")};var D=function e(){if(!n)return;var t=TS.shared.getModelObById(n);if(!t)return;var i=TS.permissions.members.canPostInModelOb(TS.model.user,t)&&!t.is_archived;if(TS.boot_data.feature_default_shared_channels&&!i)i=TS.permissions.members.canThread(t);if(i!==r){var s=TS.replies.getMessage(t,a);r=i;$("#reply_container").empty();I(t,s)}};var F=function e(){$("#reply_container .message_input").trigger("autosize-resize")};var P=function e(){var t=$("#reply_container .message_input");if(TS.utility.isFocusOnInput()&&!TS.utility.contenteditable.isActiveElement(t[0]))return;var i=true;if(d)TS.ui.replies.focusReplyInput(i);else c.addOnce(function(){TS.ui.replies.focusReplyInput(i)})};var O=function e(){var t=$("#reply_container .message_input");return TS.client.ui.isElInView(t,0,TS.ui.replies.$scroller.dimensions_rect())};var R=function e(t){$("#convo_loading_indicator").toggleClass("hidden",!t)};var U=function e(){TS.ui.replies.checkUnreads()};var Q=function e(t,i){var n=$("#reply_container");n.html(TS.templates.join_channel_from_thread({model_ob_name:t.name,is_convo:true,has_replies:!!i.reply_count}))};var L=function e(t,i,r,s,o){if(n!=t.id)return;if(a!=i.ts)return;q(r,s,o)};var H=function e(t){if(n!==t.id)return;TS.ui.replies.openConversation(t,a)};var N=function e(t){if(n!==t.id)return;TS.ui.replies.openConversation(t,a)};var G=function e(t){if(n!==t.id)return;TS.client.ui.flex.hideFlex()};var j=function e(t){if(n!==t.id)return;TS.ui.replies.openConversation(t,a)};var W=function e(i){if(i.id!==n)return;if(!s||!s.length)return;var a={};_.forEach(s,function(e,t){a[e.ts]=t});_.forEach(i.msgs,function(e){if(a.hasOwnProperty(e.ts)){var i=a[e.ts];s[i]=e}if(_.get(t,"msgs.length"))if(t.msgs[0].ts===e.ts)t.msgs[0]=e})};var K=function e(t,i){TS.ui.replies.maybeUpdateConversationWithMessage(t,i)};var z=function e(t,i){TS.ui.replies.maybeRemoveMessageFromConversation(t,i)};var V=function e(){TS.ui.replies.checkUnreads()};var Y=function e(t){var i=t.batch?t.batch:[t];_.each(i,TS.ui.replies.rebuildMsgsIncludingMember)};var q=function n(r,s,o){var l=_.find(r,{ts:a});var d=_.without(r,l);t.msgs.length=0;i.msgs.length=0;if(l)t.msgs.push(l);_.forEach(d,function(e){i.msgs.unshift(e)});e.sections.length=0;if(t.msgs.length)e.sections.push(t);e.sections.push(i);e.has_more_beginning=!!s;e.has_more_end=!!o;TS.utility.msgs.sortMsgs(i.msgs);X();J()};var J=function t(i){TS.ui.message_container.update(e,i)};var Z=function n(a,r,s,o){t={id:"root",order:0,msgs:[]};if(a)t.msgs.push(a);i={id:"replies",order:1,msgs:[]};e={name:"replies",container:o,scroller:TS.ui.replies.$scroller,page_size:m,sections:[t,i],has_more_beginning:false,has_more_end:false,skip_day_groupings:true,show_hidden_replies:true,buildSection:function e(t){if("root"===t.id)return TS.templates.message_conversation_root();return TS.templates.message_conversation_descendants()},buildMsgHTML:function e(t,i,n){if("root"===n.id)return v(r,t);return T(r,t)},updateCallback:function e(){M(o)},promiseToLoadMoreAtBeginning:function n(){var a=i.msgs;var o=_.minBy(a,"ts");var l=_.get(o,"ts");if(!l)return Promise.reject();return TS.replies.getThreadBefore(r.id,s,l).then(function(n){var a=n.root_msg;ee(i.msgs,n.messages,s);if(!n.has_more){e.has_more_beginning=false;t.msgs[0]=a;if(e.sections[0]!==t)e.sections.unshift(t)}X()})},promiseToLoadMoreAtEnd:function t(){var n=i.msgs;var a=_.maxBy(n,"ts");var o=_.get(a,"ts");if(!o)return Promise.reject();return TS.replies.getThreadAfter(r.id,s,o).then(function(t){ee(i.msgs,t.messages,s);if(!t.has_more)e.has_more_end=false;X()})}}};var X=function e(){s=_.flatten([t.msgs,i.msgs]);s=_.sortBy(s,"ts")};var ee=function e(t,i,n){var a=_.groupBy(t,"ts");_.forEach(i,function(e){if(e.ts===n)return;if(a[e.ts])return;t.push(e)});TS.utility.msgs.sortMsgs(t)}})()},4418:function(e,t){(function(){"use strict";TS.registerModule("client.threads",{switched_sig:new signals.Signal,reply_count_changed:new signals.Signal,new_thread_reply_count_changed:new signals.Signal,threads_unread_changed:new signals.Signal,onStart:function t(){if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(h);else TS.ms.connected_sig.add(h);TS.channels.message_received_sig.add(M);TS.groups.message_received_sig.add(M);TS.ims.message_received_sig.add(M);TS.mpims.message_received_sig.add(M);TS.channels.message_removed_sig.add(C);TS.groups.message_removed_sig.add(C);TS.ims.message_removed_sig.add(C);TS.mpims.message_removed_sig.add(C);TS.channels.message_changed_sig.add(A);TS.groups.message_changed_sig.add(A);TS.ims.message_changed_sig.add(A);TS.mpims.message_changed_sig.add(A);TS.replies.sanity_check_failed_sig.add(H);TS.replies.thread_subscription_changed_sig.add(P);TS.channels.joined_sig.add(W);TS.groups.joined_sig.add(W);TS.groups.left_sig.add(j);c=TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(1);e=new TS.PromiseQueue},showThreadsView:function t(s,o){s=!!s;o=!!o;var l=o?false:s;var d=TS.client.threadsViewActivated(o,l);if(d)TS.client.threads.switched_sig.dispatch();else return false;if(TS.msg_edit.editing_in_msg_pane)TS.msg_edit.resetEditUI();TS.client.ui.threads.showThreadsView();if(i){TS.info("Starting threads view with local data");r=K();y();TS.client.ui.threads.startWithData(i,n);U(a);p(r)}else{TS.info("Starting threads view from the api");e.addToQ(S)}return true},destroyThreadsView:function e(){if(!$("#client-ui").hasClass("threads_view_is_showing"))return;TS.client.ui.threads.destroyThreadsView();if(t&&t.isPending())t.cancel();t=null;a=0;r=null;clearTimeout(m);if(u||!i||!i.length){u=false;g()}},maybeReloadThreadsView:function t(){if(!TS.model.threads_view_is_showing)return;TS.client.ui.threads.resetUI();e.addToQ(S)},getMessage:function e(t,n){if(!i)return null;var a=null;_.find(i,function(e){if(e.model_ob.id!=t.id)return false;if(n==e.root_msg.ts){a=e.root_msg;return true}a=_.find(e.replies,{ts:n.toString()});return!!a});return a},getThread:function e(t,n){if(!i)return;return _.find(i,function(e){return e.model_ob.id===t.id&&e.root_msg.ts===n})},getCurrentReplyCount:function e(){return a||0},getNewThreadReplyCount:function e(){var t=_.takeWhile(i,function(e){return L(e)});if(!t||!t.length)return 0;var n=_.reduce(t,function(e,t){var i=_.reduce(t.replies,function(e,t){return t.ts>=r?e+1:e},0);return e+i},0);return n},updateThreadState:function e(t,i,n){var a=G();TS.client.threads.setThreadsUnreadData(t,i+a,n);TS.client.threads.logThreadState("update_thread_state: "+!!t+" "+(i+a)+" "+n)},setThreadsUnreadData:function e(t,i,n){TS.model.threads_has_unreads=t;TS.model.threads_mention_count=i||0;TS.utility.msgs.countAllUnreads();if(n)l=n;TS.client.ui.threads.updateChannelPaneUnreadState(TS.model.threads_has_unreads,TS.model.threads_mention_count);if(!TS.client.threads.hasUnreadThreads()&&TS.model.threads_view_is_showing)TS.client.ui.threads.maybeRemoveNewRepliesBanner();TS.client.threads.threads_unread_changed.dispatch()},setThreadsUnreadDataFromUsersCounts:function e(t,i){TS.client.threads.setThreadsUnreadData(t,i);TS.client.threads.logThreadState("users.counts: "+!!t+" "+i)},markAllNewThreads:function e(){_.forEach(i,function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);if(!t||!t.subscribed)return;var i=t.last_read;if(!i||i<e.ts)TS.replies.markThread(e.model_ob.id,e.root_msg.thread_ts,e.ts)});if(!TS.client.threads.hasUnreadThreads()&&TS.model.threads_view_is_showing)TS.client.ui.threads.maybeRemoveNewRepliesBanner()},hasUnreadThreads:function e(){return _.some(i,function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);if(!t||!t.subscribed)return;var i=t.last_read;if(!i||i<e.ts)return true})},showNewRepliesAndMarkThread:function t(n,a){if(!i)return;var r=TS.shared.getModelObById(n);if(!r)return;var s=TS.client.threads.getThread(r,a);if(!s)return;e.addToQ(function(){if(!TS.model.threads_view_is_showing)return;s.max_visible_ts=_.last(s.replies).ts;TS.client.ui.threads.revealNewReplies(s);var e=_.maxBy(s.replies,"ts").ts;TS.replies.markThread(n,a,e);return null})},showPreviousReplies:function t(n,a){if(!i)return;var r=TS.shared.getModelObById(n);if(!r)return;var s=TS.client.threads.getThread(r,a);if(!s)return;var o;var l=_.get(s,"replies.length")&&_.first(s.replies).ts;var d=_.get(s,"root_msg.reply_count",0);if(l&&d>TS.replies.DEFAULT_HISTORY_API_LIMIT)o=TS.replies.getThreadBefore(n,a,l);else{var c=true;o=TS.replies.getThreadLazy(n,a,c)}return e.addToQ(function(){if(!TS.model.threads_view_is_showing)return;o.then(function(e){if(!TS.model.threads_view_is_showing)return;var t=e.messages;var i=Infinity;if(s.replies&&s.replies.length)i=_.first(s.replies).ts;s.min_visible_ts=i;s.replies=s.replies.concat(_.reject(t,{ts:s.root_msg.ts}));s.replies=_.uniqBy(s.replies,"ts");s.replies=_.sortBy(s.replies,"ts")});TS.client.ui.threads.revealPreviousReplies(s,o);return o})},loadMoreThreads:function t(){return e.addToQ(T)},threadCompare:function e(t,i){if("new"===t.grouping&&"old"===i.grouping)return-1;if("old"===t.grouping&&"new"===i.grouping)return 1;if(t.ts<i.ts)return 1;if(t.ts>i.ts)return-1;return 0},maybeRerenderMessage:function t(i,n){if(!TS.model.threads_view_is_showing)return;if(!i||!n.thread_ts)return;e.addToQ(function(){var e=TS.client.threads.getThread(i,n.thread_ts);if(!e)return;D(e,n)})},debugUnthreads:function e(){var t="\n"+f.join("\n");TS.info(t)},logThreadState:function e(t){if(TS.has_pri[z])TS.log(z,"unread thread state change: "+t);var i=TS.interop.datetime.toTime(Date.now()/1e3,{includeMeridiem:false,includeSeconds:true});f.unshift(i+" "+t);f=_.take(f,15)},getThreadsLoadedCount:function e(){return i?i.length:0}});var e;var t;var i;var n=false;var a=0;var r;var s;var o=8;var l="0000000000.000000";var d=[];var c;var u=false;var m;var f=[];var h=function e(t){if(t)return;g();TS.client.threads.maybeReloadThreadsView()};var g=function t(){e.clear();i=null};var p=function e(t){if(TS.client.threads.hasUnreadThreads()){TS.replies.markAllThreads(t);if(!TS.model.threads_has_unreads)TS.metrics.count("threads_unread_inconsistency_no_local_unreads")}else if(TS.model.threads_has_unreads){TS.metrics.count("threads_unread_inconsistency_has_local_unreads");TS.warn("Correcting threads_has_unreads: was true but threads view has no new replies");TS.client.threads.setThreadsUnreadData(false,0);TS.client.threads.logThreadState("_markAllThreadsAfterLoading: false 0")}};var S=function e(){if(c)TS.metrics.mark("threads_view_time_to_fetch_and_display");r=K();clearTimeout(m);m=setTimeout(function(){TS.client.ui.threads.displaySlowLoadingMessage()},5e3);t=TS.api.call("subscriptions.thread.getView",{current_ts:r,limit:o});return t.then(v).then(function(e){var t=e.total_unread_replies;var n=e.has_more;if(TS.model.threads_view_is_showing)TS.client.ui.threads.startWithData(i,n);U(t);if(TS.model.threads_view_is_showing)p(r);if(c)TS.metrics.measureAndClear("threads_view_time_to_fetch_and_display","threads_view_time_to_fetch_and_display");return e}).catch(b)};var T=function e(){if(t&&t.isPending())t.cancel();var n=_.last(i).ts;clearTimeout(m);m=setTimeout(function(){TS.client.ui.threads.displaySlowLoadingMessage()},5e3);t=TS.api.call("subscriptions.thread.getView",{current_ts:n,limit:o});return t.then(v).catch(b)};var v=function e(t){TS.info("Processing subscriptions.thread.getView response");clearTimeout(m);var a=t.data;var r=a.threads;var s=a.total_unread_replies||0;var l=a.has_more;n=l;if(l&&r.length<o)TS.error("subscriptions.thread.getView returned fewer threads than the limit but has_more is true");r=_.filter(r,function(e){if(!e.root_msg){TS.error("Missing root_msg in subscriptions.thread.getView response");return false}if(!e.root_msg.thread_ts){TS.error("root_msg has no thread_ts in subscriptions.thread.getView response");return false}var t=e.root_msg.channel;if(!t){TS.error("No c_id in subscriptions.thread.getView response");return false}e.model_ob=TS.shared.getModelObById(t);if(!e.model_ob){TS.error("No channel with c_id "+t+" in subscriptions.thread.getView response");return false}e.root_msg=TS.utility.msgs.processImsg(e.root_msg,t);if(false===e.root_msg._subscribed){TS.error("Got a thread that is not subscribed to in subscriptions.thread.getView response: "+e.root_msg.thread_ts);return false}e.replies=[];if(e.latest_replies){e.latest_replies=_.map(e.latest_replies,function(e){return TS.utility.msgs.processImsg(e,t)});e.latest_replies=_.sortBy(e.latest_replies,"ts");e.replies=e.replies.concat(e.latest_replies)}if(e.unread_replies){e.unread_replies=_.map(e.unread_replies,function(e){return TS.utility.msgs.processImsg(e,t)});e.unread_replies=_.sortBy(e.unread_replies,"ts");e.replies=e.replies.concat(e.unread_replies)}if(e.replies.length){e.ts=_.last(e.replies).ts;if(e.unread_replies)e.grouping="new";else{e.ts=e.ts;e.grouping="old"}}else{e.ts=e.root_msg.ts;e.grouping="old"}e.initial_last_read=e.root_msg._last_read||0;TS.replies.maybeSlurpSubscriptionState(e.model_ob.id,[e.root_msg]);return true});if(!i)i=[];i=i.concat(r);var d=_.uniqBy(i,function(e){return e.model_ob.id+e.root_msg.ts});if(d.length!==i.length){TS.error("Removing duplicate threads in subscriptions.thread.getView response");i=d}k(i);return{total_unread_replies:s,has_more:l,threads:i}};var b=function e(t){TS.error("Threads view error during loading:");TS.error(t);var i=_.get(t,"data.error");if(!i)i=_.get(t,"message");if(!i)i=t;if(!_.isString(i))i=JSON.stringify(i);TS.error(i);var n=_.get(t,"stack");if(n)TS.error(JSON.stringify(n));TS.console.logError(t,"threads_view_fatal_error");clearTimeout(m);g();TS.client.ui.threads.displayFatalError()};var w=function e(t,i,n){var a=TS.replies.getSubscriptionState(t.id,i.ts);var r=_.filter(n,function(e){return!a.last_read||e.ts>a.last_read});var s=_.filter(n,function(e){return a.last_read&&e.ts<=a.last_read});var o={model_ob:t,root_msg:i,replies:[]};if(s.length&&!r.length){o.replies=_.takeRight(s,2);s=_.dropRight(s,2)}else if(s.length){o.replies.push(_.last(s));s=_.dropRight(s,1)}if(s.length){var l=i.reply_count-o.replies.length;if(l>0&&l<3&&s.length===l)o.replies=s.concat(o.replies)}if(r.length)o.replies=o.replies.concat(r);if(o.replies.length){o.ts=_.last(o.replies).ts;if(r.length)o.grouping="new";else o.grouping="old"}else{o.ts=i.ts;o.grouping="old"}o.initial_last_read=a.last_read||0;return o};var y=function e(){if(!i)return;i=_(i).map(function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);if(!t||!t.subscribed)return null;if(e.model_ob.is_channel&&!e.model_ob.is_member)return null;var i=w(e.model_ob,e.root_msg,e.replies);return i}).compact().value();i.sort(TS.client.threads.threadCompare);var t=i.length;i=_.take(i,o);if(t>i.length)n=true;R()};var k=function e(t){var i=_.map(t,"ts");t.sort(TS.client.threads.threadCompare);if(!_.isEqual(i,_.map(t,"ts")))TS.warn("Threads out of order; fixed in client")};var A=function t(n,a){if(!i||!n||!a)return;if(!a.thread_ts)return;e.addToQ(function(){var e=TS.client.threads.getThread(n,a.thread_ts);if(!e)return;return D(e,a)})};var C=function t(n,a){if(!i||!n||!a)return;if(!a.thread_ts)return;e.addToQ(function(){var e=x(n,a);if(TS.model.threads_view_is_showing&&e)TS.client.ui.threads.maybeRemoveMessageFromThread(n,a)})};var M=function t(i,n){if(!i||!n)return;if(!n.is_ephemeral&&!TS.utility.msgs.isTempMsg(n))if(!s||n.ts>s)s=n.ts;if(!n.thread_ts)return;if(!TS.utility.msgs.isMsgReply(n))return;e.addToQ(function(){return TS.replies.promiseToGetSubscriptionState(i.id,n.thread_ts).then(function(e){if(!e||!e.subscribed)return;I(i,n,e);var t=TS.client.threads.getThread(i,n.thread_ts);if(t)return B(t,n);return F(i,n.thread_ts)})})};var I=function e(t,i){if(i.ts<=l)return;var n=t.id===TS.ui.replies.activeConvoModelId()&&i.thread_ts===TS.ui.replies.activeConvoThreadTs()&&TS.client.ui.isUserAttentionOnChat();if(n)return;if(!O(i))return;var a=true;var r=1e3*parseFloat(i.ts);var s="away"===TS.model.user.presence;var o=s||r<TS.model.user._presence_last_changed;var d=TS.model.here_regex.test(i.text)&&!o;var c=TS.utility.msgs.getMsgMentionData(i).non_channel_mentions;var _=c||d?TS.model.threads_mention_count+1:TS.model.threads_mention_count;if(TS.model.threads_has_unreads===a&&TS.model.threads_mention_count===_)return;TS.client.threads.setThreadsUnreadData(a,_);if(d&&!c)N(t.id,i.thread_ts,i.ts);TS.client.threads.logThreadState("message_received: "+!!a+" "+_+" "+t.id+" "+i.thread_ts+" "+i.ts)};var x=function e(t,n){if(!i||!t||!n)return;var s=TS.client.threads.getThread(t,n.thread_ts);if(!s)return false;if(n.ts===n.thread_ts){TS.error("Attempting to remove remove root msg from thread instead of converting it to tombstone");return false}var o=false;var l=_.findIndex(s.replies,{ts:n.ts});if(-1!==l){s.replies.splice(l,1);o=true}var d=_.findIndex(s.root_msg.replies,{ts:n.ts});if(-1!==d){s.root_msg.replies.splice(l,1);o=true}if(parseFloat(n.ts)>r){U(a-1);Q()}if(!s.replies.length&&!_.get(s.root_msg,"replies.length")){E(t,s);return o}var c=_.findIndex(s.unread_replies,{ts:n.ts});if(-1!==c)s.unread_replies.splice(c,1);var u=_.findIndex(s.latest_replies,{ts:n.ts});if(-1!==u)s.latest_replies.splice(u,1);return o};var E=function e(t,n){if(!i||!n)return;i=_.without(i,n);if(TS.model.threads_view_is_showing)TS.client.ui.threads.maybeRemoveThread(t,n)};var B=function e(t,n){if(!i||!t||!n)return;var r=_.findIndex(t.replies,{ts:n.ts});if(-1!==r)return;if(!t.max_visible_ts&&O(n))t.max_visible_ts=t.replies.length?_.last(t.replies).ts:t.root_msg.ts;t.replies.push(n);t.replies=_.sortBy(t.replies,"ts");var s=false;if(!O(n)){s=true;t.max_visible_ts=_.last(t.replies).ts}if(TS.model.threads_view_is_showing)TS.client.ui.threads.maybeUpdateThreadWithMessage(t,n,s);if("old"===t.grouping)TS.client.ui.threads.hideCaughtUpDivider();U(a+1);Q();return null};var D=function e(t,n){if(!i||!t||!n)return;var a=false;if(n.ts===n.thread_ts){t.root_msg=n;a=true}var r=_.findIndex(t.replies,{ts:n.ts});if(-1!==r){t.replies.splice(r,1,n);a=true}if(TS.model.threads_view_is_showing&&a)TS.client.ui.threads.maybeUpdateThreadWithMessage(t,n)};var F=function e(t,n){if(!i||!t||!n)return;var r=TS.client.threads.getThread(t,n);if(r)return;var s=true;var o=TS.replies.getThreadLazy(t.id,n,s);return o.then(function(e){var n=e.root_msg;var r=_.filter(e.messages,TS.utility.msgs.isMsgReply);var s=w(t,n,r);var o=TS.replies.getSubscriptionState(t.id,n.ts);var l=s.replies.filter(function(e){return!o.last_read||e.ts>o.last_read}).length;i.unshift(s);i.sort(TS.client.threads.threadCompare);if(TS.model.threads_view_is_showing)TS.client.ui.threads.insertNewThread(s);U(a+l);Q();return null})};var P=function t(n,a,r){if(!i||!n||!a)return;if(!r.subscribed)return;var s=TS.shared.getModelObById(n);if(!s)return;e.addToQ(function(){var e=TS.client.threads.getThread(s,a);if(e)return;F(s,a)})};var O=function e(t){return!(t.user===TS.model.user.id||t.is_ephemeral)};var R=function e(){a=0;_.each(i,function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.ts);var i=_.filter(e.replies,function(e){return!t.last_read||e.ts>t.last_read});a+=i.length});U(a)};var U=function e(t){a=t;TS.client.threads.reply_count_changed.dispatch(a)};var Q=function e(){if(!TS.model.threads_view_is_showing)return;var t=TS.client.threads.getNewThreadReplyCount();if(t)TS.client.threads.new_thread_reply_count_changed.dispatch(t)};var L=function e(t){var i=TS.replies.getSubscriptionState(t.model_ob.id,t.root_msg.thread_ts);if(!i)return true;return!i.last_read||t.ts>i.last_read};var H=function t(i,n,a,r,s){if(s)return;e.addToQ(function(){var e=TS.client.threads.getThread(i,n.ts);if(!e)return;e.replies=_.reject(a,{ts:e.root_msg.ts});if(TS.model.threads_view_is_showing)TS.client.ui.threads.maybeRedrawThread(e)})};var N=function e(t,i,n){var a=TS.replies.getSubscriptionState(t,i);if(!a||!a.subscribed)return;if(a.last_read&&a.last_read>=n)return;d.push({model_ob_id:t,thread_ts:i,msg_ts:n})};var G=function e(){_.remove(d,function(e){var t=TS.shared.getModelObById(e.model_ob_id);if(!t)return true;if(t.is_channel&&!t.is_member)return true;var i=TS.replies.getSubscriptionState(e.model_ob_id,e.thread_ts);if(!i||!i.subscribed)return true;if(i.last_read&&i.last_read>=e.msg_ts)return true;return false});return d.length};var j=function e(t){if(!i)return;var n=_.filter(i,function(e){return e.model_ob.id===t.id});_.forEach(n,function(e){E(t,e)})};var W=function e(){if(!i)return;if(TS.model.threads_view_is_showing)u=true;else g()};var K=function e(){var t;if(s)t=parseFloat(s);var i=Math.floor(Date.now()/1e3);if(!t){if(TS.has_pri[z])TS.log(z,"Starting threads view with current time because !_max_ts");return i}if(i>s){if(TS.has_pri[z])TS.log(z,"Starting threads view with current time because it is greater than _max_ts");return i}t+=1;if(TS.has_pri[z])TS.log(z,"Starting threads view with "+t+" because it is greater than the current time");return t};var z=2004})()},4419:function(e,t){(function(){"use strict";TS.registerModule("client.ui.threads",{$channel_pane_item:$("#channels_scroller .all_threads"),$scroller:$("#threads_msgs_scroller_div"),$container:null,onStart:function e(){TS.prefs.team_perms_pref_changed_sig.add(w);TS.prefs.emoji_mode_changed_sig.add(S);TS.channels.joined_sig.add(b);TS.channels.left_sig.add(b);TS.groups.left_sig.add(b);TS.channels.archived_sig.add(b);TS.groups.archived_sig.add(b);TS.channels.unarchived_sig.add(b);TS.groups.unarchived_sig.add(b);TS.client.threads.new_thread_reply_count_changed.add(g);TS.channels.read_only.list_updated_sig.add(u);i=new TS.PromiseQueue},showThreadsView:function e(){$("#client-ui").addClass("threads_view_is_showing");TS.client.ui.threads.$scroller.addClass("loading");TS.client.ui.threads.$scroller.addClass("emojimode_"+TS.model.prefs.emoji_mode);$("#footer").addClass("hidden");TS.client.archives.cancel(true);if(TS.boot_data.feature_keyboard_navigation)TS.client.ui.threads.$scroller.attr("tabindex","-1");var t=true;TS.client.ui.rebuildAllButMsgs(t);if(TS.useReactSidebar())TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem("Vall_threads"));if("details"===TS.model.ui_state.flex_name)TS.client.ui.flex.hideFlex(true);var i=true;TS.client.msg_pane.hideNewMsgsBar(i);TS.client.ui.threads.$container=$('<div id="threads_msgs"></div>');TS.client.ui.threads.$container.appendTo(TS.client.ui.threads.$scroller);TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback");if(!TS.environment.supports_custom_scrollbar)TS.client.ui.threads.$scroller.monkeyScroll();$("#threads_view_banner").removeClass("hidden");TS.utility.msgs.startUpdatingRelativeTimestamps("#threads_msgs");A();TS.clog.track("THREADS_VIEW_OPEN",{view_session_index:a});TS.client.ui.threads.incrementTrackingSeqId()},isThreadsViewDOMShowing:function e(){return $("#client-ui").hasClass("threads_view_is_showing")},destroyThreadsView:function e(){TS.client.ui.threads.resetUI();TS.client.ui.threads.$scroller.off("scroll.threads_view_scroll");TS.client.ui.threads.$scroller.empty();$("#client-ui").removeClass("threads_view_is_showing");T();$("#footer").removeClass("hidden");TS.client.ui.threads.$container=null;TS.utility.msgs.stopUpdatingRelativeTimestamps("#threads_msgs");if(!r)TS.client.ui.threads.trackThreadsViewClosed("OTHER");if(TS.boot_data.feature_keyboard_navigation)$(window).off("keydown.threads")},resetUI:function t(){i.clear();p();if(e){TS.ui.message_container.cleanup(e);e=null}TS.client.ui.threads.$container.empty();$(".threads_alternative_view_wrapper").remove();TS.client.ui.threads.$scroller.addClass("loading")},displayEmptyState:function e(){if(!TS.model.threads_view_is_showing)return;var t={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f331.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f331.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f331.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f331.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f331.png"};var i={emoji:t[TS.model.prefs.emoji_mode],is_empty:true};TS.client.ui.threads.displayAlternativeThreadsView(i)},displayFatalError:function e(){if(!TS.model.threads_view_is_showing)return;var t={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f420.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f420.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f420.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f420.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f420.png"};var i={emoji:t[TS.model.prefs.emoji_mode],is_error:true};TS.client.ui.threads.displayAlternativeThreadsView(i)},displayAlternativeThreadsView:function e(t){TS.client.ui.threads.$scroller.find(".threads_alternative_view_wrapper").remove();TS.client.ui.threads.$scroller.removeClass("loading");TS.client.ui.threads.$scroller.removeClass("slow_loading");TS.client.ui.threads.$scroller.find("#threads_msgs").empty();TS.client.ui.threads.$scroller.append(TS.templates.threads_alternative_view(t))},isAlternativeThreadsViewShowing:function e(){return TS.client.ui.threads.$scroller.find(".threads_alternative_view_wrapper").length>0},displaySlowLoadingMessage:function e(){if(TS.client.ui.threads.$scroller.hasClass("loading"))TS.client.ui.threads.$scroller.addClass("slow_loading");var t=$("#threads_msgs .and_more_end, #threads_msgs .and_more_beginning");if(t.length){var i=TS.i18n.t("Still loading... sorry for the long wait!","threads")();t.text(i)}},updateChannelPaneUnreadState:function e(t,i){TS.client.ui.threads.$channel_pane_item.toggleClass("unread",t);TS.client.ui.threads.$channel_pane_item.toggleClass("mention",!!i);var n=TS.client.ui.threads.$channel_pane_item.find(".unread_highlights");if(!i)n.empty();else{if(i>9)i="9+";n.text(i)}n.toggleClass("hidden",!i)},updateChannelPaneActiveState:function e(){TS.client.ui.threads.$channel_pane_item.toggleClass("active",!!TS.model.threads_view_is_showing)},startWithData:function t(i,n){TS.client.ui.threads.$scroller.removeClass("loading");TS.client.ui.threads.$scroller.removeClass("slow_loading");if(i.length<1){TS.client.ui.threads.displayEmptyState();return}e={name:"threads",container:TS.client.ui.threads.$container,scroller:TS.client.ui.threads.$scroller,page_size:8,msg_order:"desc",skip_day_groupings:true,has_more_beginning:false,has_more_end:!!n,buildSection:function e(t){return TS.templates.thread_view_section({is_old_section:"old_threads"===t.id,show_threads_notification_banner:k(t,i)})},buildMsgHTML:function e(t,i){return d(t,i)},updateCallback:function e(){c()},promiseToLoadMoreAtEnd:function e(){return TS.client.threads.loadMoreThreads().then(l)}};e.sections=[];var a=_.filter(i,{grouping:"new"});var r=_.filter(i,{grouping:"old"});if(a.length){var u=s();u.msgs=a}if(r.length){var m=o();m.msgs=r}if(!TS.environment.supports_custom_scrollbar){var f=TS.client.ui.threads.$scroller.data("monkeyScroll");if(f)f.updateFunc()}TS.ui.message_container.register(e);c();h();if(TS.boot_data.feature_keyboard_navigation)$(document).on("keydown.threads",y)},buildThreadMsgHTML:function e(t,i,n){return TS.templates.builders.buildThreadMsgHTML(t,i,n)},maybeUpdateThreadWithMessage:function e(t,n,a){i.addToQ(function(){var e=TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+(n.thread_ts||n.ts)+'"]');if(!e.length)return;TS.ui.thread.updateThreadWithMessage(e,t,n,a)})},maybeRemoveNewRepliesBanner:function e(){i.addToQ(function(){if(t)p()})},maybeRemoveMessageFromThread:function e(t,n){if(!t||!n)return;if(n.ts===n.thread_ts){TS.error("Attempting to remove remove root msg from DOM instead of converting it to tombstone or deleting entire <ts-thread>");return}var a=TS.client.threads.getThread(t,n.thread_ts);if(!a)return;i.addToQ(function(){var e=TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+(n.thread_ts||n.ts)+'"]');if(!e.length)return;var t=TS.ui.thread.removeMessageFromThread(e,a,n);return t})},maybeRemoveThread:function t(n,a){if(!n||!a)return;i.addToQ(function(){_.forEach(e.sections,function(e){e.msgs=_.without(e.msgs,_.find(e.msgs,function(e){return n.id===e.model_ob.id&&a.root_msg.thread_ts===e.root_msg.thread_ts}))});TS.ui.message_container.update(e)})},insertNewThread:function t(n){i.addToQ(function(){TS.client.ui.threads.$scroller.removeClass("loading");TS.client.ui.threads.$scroller.removeClass("slow_loading");var t=_.get(e,"sections");if(!t)return;var i;if("new"===n.grouping)i=s();else i=o();i.msgs.push(n);i.msgs.sort(TS.client.threads.threadCompare);var a=TS.client.ui.threads.$container.find("ts-thread:first");TS.ui.message_container.updateWithFocus(e,a)})},jumpToTop:function t(){if(!TS.model.threads_view_is_showing)return;TS.ui.message_container.jumpToTop(e)},revealNewReplies:function e(t){i.addToQ(function(){var e=v(t);if(!e.length)return;return TS.ui.thread.revealNewReplies(e,t)})},revealPreviousReplies:function e(t,n){var a=v(t);if(n.isPending())TS.ui.thread.showThreadLoadingSpinner(a);return i.addToQ(function(){if(!a.length)return;return TS.ui.thread.revealPreviousReplies(a,t,n)})},maybeRedrawThread:function t(n){i.addToQ(function(){n.edited=Date.now();TS.ui.message_container.update(e)})},hideCaughtUpDivider:function e(){if(!TS.model.threads_view_is_showing)return;$("#threads_msgs .threads_caught_up_divider").addClass("hide_divider")},getThreadFromEl:function e(t){if(!t||!t.length)return;var i=t.closest("ts-thread");var n=i.attr("data-model-ob-id");var a=i.attr("data-thread-ts");if(!n||!a)return;var r=TS.shared.getModelObById(n);return TS.client.threads.getThread(r,a)},incrementTrackingSeqId:function e(){a+=1},trackThreadsViewClosed:function e(t){var i=_.merge(TS.client.ui.threads.getTrackingData(),{num_threads_loaded:TS.client.threads.getThreadsLoadedCount(),view_exit_event:t});TS.clog.track("THREADS_VIEW_CLOSE",i);r=true},getTrackingData:function e(){return{view_session_elapsed_time:Date.now()-n,view_session_index:a}},rebuildMsgsIncludingMember:function t(i){if(!TS.model.threads_view_is_showing)return;var n=_.get(e,"sections");if(!n)return;_.each(n,function(e){_.each(e.msgs,function(e){if(TS.utility.msgs.messageIncludesMember(i,e.root_msg))TS.client.ui.threads.maybeUpdateThreadWithMessage(e,e.root_msg);_.each(e.replies,function(t){if(TS.utility.msgs.messageIncludesMember(i,t))TS.client.ui.threads.maybeUpdateThreadWithMessage(e,t)})})})},rebuildMsgCurrentStatusIncludingMember:function t(i){if(!TS.model.threads_view_is_showing)return;var n=_.get(e,"sections");if(!n)return;var a={member:i,for_message:true};_.each(n,function(e){_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(i,e.root_msg)){var t=TS.client.ui.threads.$container.find('ts-message[data-ts="'+e.root_msg.ts+'"] .message_current_status');t.replaceWith(TS.templates.current_status(a))}_.each(e.replies,function(e){if(TS.utility.msgs.memberSentMessage(i,e)){var t=TS.client.ui.threads.$container.find('ts-message[data-ts="'+e.ts+'"] .message_current_status');t.replaceWith(TS.templates.current_status(a))}})})})}});var e;var t=false;var i;var n;var a;var r;var s=function t(){if(!e||!e.sections)return;var i=_.find(e.sections,{id:"new_threads"});if(!i){i={id:"new_threads",order:0,msgs:[]};e.sections.unshift(i)}return i};var o=function t(){if(!e||!e.sections)return;var i=_.find(e.sections,{id:"old_threads"});if(!i){i={id:"old_threads",order:1,msgs:[]};e.sections.push(i)}return i};var l=function t(i){var n=i.has_more;var a=i.threads;var r=_.get(e,"sections");if(!r)return;var l=_.filter(a,{grouping:"new"});var d=_.filter(a,{grouping:"old"});if(l.length){var c=s();c.msgs=l}if(d.length){var u=o();u.msgs=d}e.has_more_end=!!n};var d=function e(t){return TS.ui.thread.buildThreadHTML(t)};var c=function e(t){var i=TS.client.ui.threads.$container;if(!i)return;var n=i.find("ts-thread");_.forEach(n,function(e){if(t)$(e).data("input_rendered",false);f($(e))})};var u=function e(){var t=true;c(t)};var m=function e(t){var i=TS.client.ui.threads.$container.find("ts-thread[data-model-ob-id="+t.id+"]");i.data("input_rendered",false);_.forEach(i,function(e){f($(e))})};var f=function e(t){if(!t||!t.length)return;if(t.data("input_rendered"))return;var i=t.attr("data-model-ob-id");var n=t.attr("data-thread-ts");if(!i||!n)return;var a=TS.shared.getModelObById(i);if(!a)return;var r=TS.client.threads.getThread(a,n);if(!r){TS.error("Thread not found in TS.client.threads _thread_data");return}TS.ui.thread.renderReplyInput(t,r);t.data("input_rendered",true)};var h=function i(){var n=TS.client.ui.threads.$scroller;n.on("scroll.threads_view_scroll",_.debounce(function(){if(!TS.model.threads_view_is_showing)return;if(t&&0===n.scrollTop()){var i=TS.ui.message_container.getRange(e);var a=_.get(i,"start");if(!a)return;if(-1===a.msg_ts){TS.client.threads.markAllNewThreads();return}var r=e.sections[0].msgs[0];if(!r||a.msg_ts===r.ts)TS.client.threads.markAllNewThreads()}},150))};var g=function e(i){var n=$("#threads_view_banner");var a=TS.i18n.t("{new_thread_reply_count,plural,=1{{new_thread_reply_count} new reply}other{{new_thread_reply_count} new replies}}","threads")({new_thread_reply_count:i});n.find("#new_replies_info").text(a);n.removeClass("no_opacity");TS.client.ui.threads.$container.addClass("new_banner_is_showing");t=true};var p=function e(i){t=false;if(i)$("#threads_view_banner").addClass("hidden");$("#threads_view_banner").addClass("no_opacity");TS.client.ui.threads.$container.removeClass("new_banner_is_showing")};var S=function e(){if(!TS.model.threads_view_is_showing)return;T();TS.client.ui.threads.$scroller.addClass("emojimode_"+TS.model.prefs.emoji_mode)};var T=function e(){TS.client.ui.threads.$scroller.removeClass(function(e,t){return(t.match(/(^|\s)emojimode_\S+/g)||[]).join(" ")})};var v=function e(t){var i=t.root_msg.ts;var n=t.model_ob.id;var a=TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+i+'"][data-model-ob-id="'+n+'"]');return a};var b=function e(t){if(!TS.model.threads_view_is_showing)return;i.addToQ(function(){m(t)})};var w=function e(t){if(!TS.model.threads_view_is_showing)return;if(!t)return;if("who_can_post_general"===t)i.addToQ(function(){var e=TS.channels.getGeneralChannel();m(e)})};var y=function e(t){if(TS.ui.react_emoji_menu.is_showing)return;var i=[TS.utility.keymap.space,TS.utility.keymap.pageup,TS.utility.keymap.pagedown,TS.utility.keymap.end,TS.utility.keymap.home];var n=t.target;var a=$("#col_flex")[0].contains(n);var r=$(".client_channels_list_container")[0].contains(n);var s=TS.client.ui.threads.$scroller[0];var o=TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()&&!a&&!r&&!s.contains(n);if(-1!==i.indexOf(t.keyCode)&&o)s.focus()};var k=function e(t,i){return!TS.model.prefs.seen_threads_notification_banner&&"mentions"===TS.notifs.getGlobalNotificationSetting()&&!TS.model.prefs.threads_everything&&"new_threads"===t.id&&i.length>3};var A=function e(){n=Date.now();a=0;r=false}})()},4420:function(e,t){(function(){"use strict";TS.registerModule("client.deprecation",{supported:{chrome:51,firefox:47,safari:9,msie:11,msedge:14,electron:"0.0.0"},onStart:function e(){TS.client.login_sig.addOnce(function(){if(TS.qs_args.deprecate_modal)i();else if(TS.qs_args.deprecate_modal_unsupported)n();else if(TS.qs_args.deprecate_modal_install)a();else if(TS.qs_args.deprecate_modal_install_unsupported)r();else if(TS.qs_args.deprecate_modal_ssb)s();if(TS.client.deprecation.isDeprecatedSSB())s();else if(!TS.client.deprecation.isBrowserSupported())if(TS.client.deprecation.canInstallSSB())if(TS.client.deprecation.isBrowserFamilySupported())a();else r();else if(TS.client.deprecation.isBrowserFamilySupported())i();else n()})},isBrowserSupported:function e(){if(TS.model.is_electron&&TS.model.desktop_app_version){var t=TS.model.desktop_app_version;var i=t.major+"."+t.minor+"."+t.patch;if(TS.utility.compareSemanticVersions(i,TS.client.deprecation.supported.electron)>=0)return true;TS.console.info(t," electron app is deprecated!");return false}if(!window.bowser){TS.console.warn("no bowser???");return true}if(bowser.mobile)return false;if(_.some(TS.client.deprecation.supported,function(e,t){return bowser[t]&&bowser.version>=e}))return true;if(bowser.firefox&&45===Math.floor(bowser.version))return true;TS.console.warn(bowser,navigator.userAgent,"is deprecated!");return false},isBrowserFamilySupported:function e(){if(!window.bowser)return false;return _.some(TS.client.deprecation.supported,function(e,t){return bowser[t]})},isDeprecatedSSB:function e(){return!TS.client.deprecation.isBrowserSupported()&&TS.model.is_our_app},canInstallSSB:function e(){if(TS.model.is_win_7_plus)return true;if(TS.model.is_mac&&1===TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8"))return true;if(TS.model.is_lin)return true;return false}})})();var i=function e(){TS.metrics.count("deprecation_modal");var t=TS.i18n.t("This browser is out of date","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:true}).replace("emoji-sizer","");t=new Handlebars.SafeString(t);TS.ui.fs_modal.start({title:t,body:TS.i18n.t("<p>We know it's a hassle to upgrade, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please upgrade to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:true,go_button_text:TS.i18n.t("Learn More","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button");TS.utility.openInNewTab("https://get.slack.help/hc/"+TS.i18n.zdLocale()+"/articles/201746897","_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var n=function e(){TS.metrics.count("deprecation_modal_unsupported");var t=TS.i18n.t("This browser is no longer supported","deprecation")()+" "+TS.emoji.graphicReplace(":construction:",{jumbomoji:true}).replace("emoji-sizer","");t=new Handlebars.SafeString(t);TS.ui.fs_modal.start({title:t,body:TS.i18n.t("<p>We know it's a hassle to change browsers, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please switch to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:true,go_button_text:TS.i18n.t("Learn More","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button_unsupported");TS.utility.openInNewTab("https://get.slack.help/hc/"+TS.i18n.zdLocale()+"/articles/201746897","_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var a=function e(){TS.metrics.count("deprecation_modal_install");var t=TS.i18n.t("This browser is out of date","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:true}).replace("emoji-sizer","");t=new Handlebars.SafeString(t);TS.ui.fs_modal.start({title:t,body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>We know it’s a hassle to upgrade, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please upgrade to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p><p>For the finest Slack experience, we recommend downloading our desktop app: you’ll get greater control over your notifications, easy switching between workspaces, and — handily — automatic updates!</p>","deprecation")({locale:TS.i18n.zdLocale()}):TS.i18n.t("<p>We know it's a hassle to upgrade, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please upgrade to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p><p>For the finest Slack experience, we recommend downloading our desktop app: you'll get greater control over your notifications, easy switching between teams, and — handily — automatic updates!</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:true,go_button_text:TS.i18n.t("Use the Slack app","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button_install");TS.utility.openInNewTab("/ssb/redirect","_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var r=function e(){TS.metrics.count("deprecation_modal_install_unsupported");var t=TS.i18n.t("This browser is no longer supported","deprecation")()+" "+TS.emoji.graphicReplace(":construction:",{jumbomoji:true}).replace("emoji-sizer","");t=new Handlebars.SafeString(t);TS.ui.fs_modal.start({title:t,body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>We know it’s a hassle to change browsers, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please switch to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p><p>For the finest Slack experience, we recommend <a href='https://slack.com/downloads'>downloading our desktop app</a>: you’ll get greater control over your notifications, easy switching between workspaces, and — handily — automatic updates!</p>","deprecation")({locale:TS.i18n.zdLocale()}):TS.i18n.t("<p>We know it's a hassle to change browsers, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please switch to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p><p>For the finest Slack experience, we recommend <a href='https://slack.com/downloads'>downloading our desktop app</a>: you'll get greater control over your notifications, easy switching between teams, and — handily — automatic updates!</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:true,go_button_text:TS.i18n.t("Use the Slack app","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button_install_unsupported");TS.utility.openInNewTab("/ssb/redirect","_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var s=function e(){TS.metrics.count("deprecation_modal_ssb");var t=TS.i18n.t("This is an out-of-date version of Slack","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:true}).replace("emoji-sizer","");t=new Handlebars.SafeString(t);TS.ui.fs_modal.start({title:t,body:TS.i18n.t("<p>We've made some great improvements to our desktop app — it now runs faster, uses far less memory, and updates automatically.</p><p><strong>To continue using Slack, please <a href='https://slack.com/downloads'>manually download our new desktop app</a> soon.</strong> We want your experience of Slack to be fast, secure, and the best it can possibly be. As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")(),show_secondary_go_button:true,go_button_text:TS.i18n.t("Update the App","deprecation")(),show_cancel_button:false,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function e(){TS.metrics.count("deprecation_button_ssb");TS.utility.openInNewTab(o(),"_blank")},onShowComplete:function e(){$("#fs_modal .dialog_go").focus()}});$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})};var o=function e(){var t=false;var i="";if(TS.model.is_mac)t="osx";else if(TS.model.is_win){t="windows";i=TS.model.is_win_64?"windows_64":"windows"}else if(TS.model.is_lin)t="linux";if(t)return"https://slack.com/downloads/instructions/"+t+"?os="+t+"&build_architecture="+i;return"https://slack.com/downloads"}},4421:function(e,t){(function(){"use strict";TS.registerModule("client.ui.app_space",{$channel_pane_item:$("#channels_scroller .app_space"),$scroller:$("#app_space_scroller_div"),$loading_msg_container:null,$container:null,valid_sub_views:["messages","about","permissions"],active_view:"messages",screenshots_templates:[],onStart:function e(){if(!TS.apps.isAppSpaceEnabled())return;if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(u);else TS.ms.connected_sig.add(u);TS.ims.switched_sig.add(TS.client.ui.app_space.prepareAppSpace,TS.client.ui.app_space)},prepareAppSpace:function e(){var t=TS.shared.getActiveModelOb();var i=TS.members.getMemberById(t.user);var n=_.get(i,"profile.bot_id");var r=_.get(i,"profile.team");if(n)a(n,r)},toggleView:function t(i){if(TS.client.ui.app_space.valid_sub_views.indexOf(i)<0)return;if(!e)return TS.client.ui.app_space.resetView();TS.client.channel_header.setActiveTab(i);TS.client.ui.app_space.active_view=i;if("messages"===i)TS.client.ui.app_space.resetView();else if("about"===i)d();else if("permissions"===i)if(TS.boot_data.feature_app_space_permissions_tab)c()},resetView:function e(){TS.client.msg_pane.hideCenterWorkspace();TS.client.msg_pane.showMessageContainer()},renderAppInformation:function t(i,n,a){if(!i)return m();TS.client.ui.app_space.active_app=i;TS.client.ui.app_space.app_bot_id=n;TS.client.ui.app_space.app_team_id=a;e=TS.apps.constructTemplateArgsForCardAndProfile(i,n,a);if(!e)return m();var r;if(i.permissions)r=TS.apps.promiseToParsePermissionsForApp(i.permissions);else r=Promise.resolve();r.then(function(t){e.permissions=t;l();if(!TS.environment.supports_custom_scrollbar)TS.client.ui.app_space.$scroller.monkeyScroll();if(TS.client.ui.app_space.active_view)TS.client.ui.app_space.toggleView(TS.client.ui.app_space.active_view)})},onButtonClick:function e(t){t.preventDefault();var i=$(this);var a=i.data("action");if("desc_expand"===a){n.removeClass("--collapsed");n.addClass("--expanded")}else if("desc_collapse"===a){n.addClass("--collapsed");n.removeClass("--expanded")}},resetUI:function e(){t.empty();if("messages"!==TS.client.ui.app_space.active_view){TS.client.ui.app_space.resetView();TS.client.ui.app_space.active_view="messages"}TS.client.ui.app_space.active_app=null;TS.client.ui.app_space.app_bot_id=null;TS.client.ui.app_space.app_team_id=null;TS.client.ui.app_space.screenshots_templates=[]},openScreenshotModal:function t(i){var n=$(i.target);var a=n.data("app-space-screenshot");if(e.youtube_id)if("youtube"===a)a=0;else a+=1;TS.ui.fs_modal.start({body_template_html:TS.templates.fs_modal_simple_gallery({items:TS.client.ui.app_space.screenshots_templates,modal_gallery_index:a}),header_html:TS.templates.fs_modal_app_header(e),modal_bg_class:"off_white_bg",modal_gallery:{index:a,total_items:TS.client.ui.app_space.screenshots_templates.length-1},modal_class:"fs_modal_header fs_modal_footer",modal_contents_container_class:"c-modal_gallery",show_go_button:false,show_cancel_button:false})},verifyTabs:function e(){l()}});var e;var t=$('[data-js="app_space"]');var i;var n;var a=function e(t,i){TS.apps.promiseToGetFullAppProfile(t,i,null,true).then(function(e){TS.client.ui.app_space.renderAppInformation(e,t,i)})};var r=function e(){i=$('[data-js="app_space_profile"]');i.on("click","[data-app-space-screenshot]",TS.client.ui.app_space.openScreenshotModal);i.on("click",'[data-js="app_profile_btn"]',TS.client.ui.app_space.onButtonClick);i.on("click","[data-member-profile-link]",function(e){e.preventDefault();TS.client.ui.previewMember($(this).data("member-profile-link"))})};var s=function t(){if(e.youtube_id)TS.client.ui.app_space.screenshots_templates.push(TS.templates.app_youtube_video({youtube_id:e.youtube_id,disable_autoplay:true}));if(e.screenshots)_.each(e.screenshots,function(e){TS.client.ui.app_space.screenshots_templates.push(TS.templates.app_space_screenshot({image_url:e.image_1600}))})};var o=function e(){n=$('[data-js="app_profile_desc"]');t.find(".emoji_replace_on_load").each(function(){var e=$(this).html();e=TS.emoji.graphicReplace(e);$(this).html(e)})};var l=function t(){if(!TS.boot_data.feature_app_space_permissions_tab||!e)return;var i=$('[data-js="channel_header_tabs"]');var n=i.find('[data-target="permissions"]');if(e.show_settings_section&&void 0!==e.permissions)n.removeClass("hidden");else n.addClass("hidden")};var d=function i(){t.html(TS.templates.app_space_profile(e));o();s();r();TS.client.msg_pane.hideMessageContainer();TS.client.msg_pane.showCenterWorkspace();TS.clog.track("APP_SPACE_ABOUT_OPEN",{app_id:TS.client.ui.app_space.active_app.id,bot_id:TS.client.ui.app_space.app_bot_id,contexts:{core:{app_id:TS.client.ui.app_space.active_app.id,bot_id:TS.client.ui.app_space.app_bot_id}}})};var c=function i(){TS.client.msg_pane.hideMessageContainer();TS.client.msg_pane.showCenterWorkspace();var n=_.get(e.auth,"created_by");if(n){var a=TS.members.getMemberById(n);var r;var s;if(a){r=TS.members.getPrefCompliantMemberName(a);s=new Handlebars.SafeString(_.escape(r))}e=_.assign({},e,{permissions:{member_username:_.get(a,"name"),member_id:_.get(a,"id"),member_name:s}})}t.html(TS.templates.app_space_permissions(e))};var u=function e(){TS.client.ui.app_space.resetUI();TS.client.ui.app_space.prepareAppSpace()};var m=function e(){TS.client.ui.app_space.resetUI();TS.client.channel_header.hideTab("about");TS.client.channel_header.hideTab("permissions")}})()},4422:function(e,t){(function(){"use strict";TS.registerModule("ui.shared_invites_modal",{onStart:function e(){$("body").on("click",'[data-action="admin_shared_invites_modal"]',function(e){if(TS.isPartiallyBooted())return;if(!r())return TS.ui.admin_invites.start();if("channel_list_invites_link"===e.target.id){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"invite_people",action:"click",ui_element:"invite_people_button"}}});TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"impression",ui_element:"share_invite_link_modal"},referring_ui_context:{step:"invite_people",ui_element:"invite_people_button"}},referring_event_id:"INAPP_INVITES"})}d(e)});if(!TS.boot_data.show_shared_invites_modal)return;return s()},start:function e(t){return u(t)},updateCode:function e(){return s()},userCanViewSharedInvitesModal:function e(){return r()}});var e;var t;var i;var n;var a=function e(){return!TS.model.team.plan&&TS.model.user.is_admin};var r=function e(){if(!TS.boot_data.show_shared_invites_modal)return false;if(TS.model.team.plan)return false;return a()||TS.ui.admin_invites.canInvite()&&i};var s=function e(){return TS.api.call("users.listSharedInvites",{mode:"last_active"}).then(function(e){if(e.data.invites&&e.data.invites.length)o(e.data.invites[0]);else o(null)},function(e){TS.error("could not create shared invite link: "+e)})};var o=function e(t){i=t;clearTimeout(n);if(!i)return;var a=1e3*i.date_expire;var r=a-new Date;if(r<0){i=null;return}if(r>2147483647)r=2147483647;n=setTimeout(s,r)};var l=function e(){return s().then(function(){if(!i)return;return TS.api.call("users.admin.revokeSharedInvite",{code:i.code}).then(function(){o(null);return Promise.resolve()})})};var d=function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_items.html(TS.templates.shared_invites_modal());TS.menu.start(t);TS.menu.menu_closed_sig.addOnce(function(){$("#shared_invite_link_modal_warning").remove()});u(t)};var c=function t(i,n){n=n||{};var a=A[i];if(!a){TS.error("no shared invite modal view");return Promise.reject()}if(n.warning){var r=e.closest(".menu");r.prepend(TS.templates.shared_invites_modal_warning({warning:n.warning}))}else $("#shared_invite_link_modal_warning").remove();return a(n)};var u=function n(){e=$("#shared_invite_link_modal");t=$("#shared_invite_link_modal_body");var r;if(i)if(a())r="admin_share_link";else r="nonadmin_share_link";else r="admin_create_link";m();return c(r)};var m=function e(){h();p();v();b();f();S()};var f=function t(){var i=e.find("#shared_invite_link_url");i.on("click",function(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"invite_link"}}})})};var h=function t(){e.on("click",'[data-action="shared_invite_open_email_invites"]',function(){TS.ui.admin_invites.start();if(TS.menu)TS.menu.end();TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"email_invite_link"}}})})};var g=function e(){t.html(TS.templates.shared_invites_modal_admin_create_link_body());return Promise.resolve()};var p=function t(){var i;e.on("click",'[data-action="shared_invite_create_link"]',function(){i=$(this);var t=e.find("#select_shared_invite_expiration");TS.ui.startButtonSpinner(i.get(0));t.attr("disabled","disabled");var n=_.toInteger(t.val());TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"create_invite_link_button"}}});return TS.api.call("users.admin.createSharedInvite",{expiration:n,max_signups:1e3,disable_email:true},function(e,n){if(e){o(n);return c("admin_share_link")}t.removeAttr("disabled");TS.ui.stopButtonSpinner(i.get(0),false);return c("admin_create_link",{warning:"ratelimited"})})})};var S=function t(){e.on("click","#select_shared_invite_expiration",function(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"expiration_period_menu"}}})})};var T=function e(){var n=i.date_expire;var a=y(n);var r={shared_invite_url:i.url,is_admin:true};if(a){r.time_until_expiration_string=new Handlebars.SafeString(a);r.expiration_date=TS.interop.datetime.toCalendarDate(n);r.expiration_time=TS.interop.datetime.toTime(n,{do24hrTime:TS.utility.date.do24hrTime()})}t.html(TS.templates.shared_invites_modal_share_link_body(r));return Promise.resolve()};var v=function t(){e.on("click",'[data-action="disable_shared_link"]',function(){var e=$(".menu");e.addClass("hide_behind_dialog");TS.menu.needs_to_remain_open=function(){return true};TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"disable_link"}}});return new Promise(function(t){TS.generic_dialog.start({title:TS.i18n.t("Deactivate your invite link?","pages_admin")(),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>The invite link for <b>{team_name}</b> will stop working. Please note that if you sent the link to anyone, they may not be able to join your workspace.</p>","pages_admin")({team_name:_.escape(TS.model.team.name)}):TS.i18n.t("<p>The invite link for <b>{team_name}</b> will stop working. Please note that if you sent the link to anyone, they may not be able to join your team.</p>","pages_admin")({team_name:_.escape(TS.model.team.name)}),go_button_class:"btn_danger ladda-button",go_button_text:TS.i18n.t("Deactivate Link","pages_admin")(),onGo:function e(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"deactivate_link",action:"click",ui_element:"deactivate_link_button"}}});t()},onCancel:function e(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"deactivate_link",action:"click",ui_element:"cancel_button"}}})},onEnd:function t(){TS.menu.needs_to_remain_open=void 0;e.removeClass("hide_behind_dialog")}})}).then(function(){return l().then(function(){return c("admin_create_link",{warning:"link_disabled"})},function(){TS.error("disable share invites link failed")})})})};var b=function t(){e.on("click",'[data-action="copy_shared_link"]',function(){var e=$(this);w(e);TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"copy_button"}}})})};var w=function e(t){var i=t.parent().find("input");var n=i.attr("data-invite-url");TS.clipboard.writeText(n);i.select();t.removeClass("hide_copy_btn_ts_tip");window.setTimeout(function(){t.addClass("hide_copy_btn_ts_tip")},2e3)};var y=function e(t){var i;var n=TS.interop.datetime.toDateObject(Date.now()/1e3);var a=TS.interop.datetime.distanceInDays(TS.interop.datetime.toDateObject(t),n);var r=a/7;if(a>30)return"";if(_.isInteger(r))i=TS.i18n.t("in {num_weeks, plural, =1{one week}other{{num_weeks} weeks}}","shared_invites_modal")({num_weeks:r});else i=TS.i18n.t("in {num_days, plural, =1{one day}other{{num_days} days}}","shared_invites_modal")({num_days:a});return TS.interop.datetime.prettifyDateString(t,{fallbackString:i,uncapitalized:true})};var k=function e(){var n=i.date_expire;var a=y(n);var r={shared_invite_url:i.url,is_admin:false};if(a){r.time_until_expiration_string=new Handlebars.SafeString(a);r.expiration_date=TS.interop.datetime.toCalendarDate(n);r.expiration_time=TS.interop.datetime.toTime(n,{do24hrTime:TS.utility.date.do24hrTime()})}t.html(TS.templates.shared_invites_modal_share_link_body(r));return Promise.resolve()};var A={admin_create_link:g,admin_share_link:T,nonadmin_share_link:k}})()},4423:function(e,t){(function(){"use strict";TS.registerModule("ui.apps_browser",{onStart:function e(){},start:function t(i){if(!TS.apps.isAppSpaceEnabled())return;if(TS.client.ui.checkForEditing())return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var r=TS.templates.apps_browser({showTutorial:TS.model.prefs.seen_app_space_tutorial});TS.ui.fs_modal.start({body_template_html:r,onShow:n,onEnd:a,disable_esc:true,modal_class:"fs_modal_internal_scroll p-apps_browser_modal"});e=document.getElementById("apps_browser_container");TS.interop.mountAppsBrowser(e,{addAppsVariant:i});TS.clog.track("APP_INDEX_OPEN");$("[data-manage_apps_link]").click(function(){TS.clog.track("APP_INDEX_MANAGE_CLICK")})},startAddApps:function e(){if(TS.apps.permissions.areXoxaAppsInstalled()){i=TS.shared.getActiveModelOb();TS.apps.permissions.ensureAppAndBotResourceMembershipIsKnown(i.id).then(function(){TS.ui.apps_browser.start(true)})}else TS.ui.apps_browser.start()},canAppBeAdded:function e(t){return TS.apps.permissions.canAppOrBotBeAddedToResource(t,i)},buildAddAppsTitle:function e(){return TS.apps.permissions.buildAddAppsTitle(i)},routeAppOpen:function e(t){TS.ui.fs_modal.close();if(t.bot_user_id)TS.ims.startImByMemberId(t.bot_user_id);else if(t.bot_id)TS.apps.startFlexPaneByBotId(TS.model.team.id,t.bot_id,true);else TS.apps.startFlexPaneByAppId(TS.model.team.id,t.app_id,false)},addAppToChannel:function e(t){TS.ui.fs_modal.close();var i=TS.members.getMemberById(t.bot_user_id);TS.apps.permissions.addAppOrBotToActiveResource(i)},showAppTutorial:function e(){TS.clog.track("APP_TUTORIAL_VIEW");TS.ui.card_carousel.start({cards:t,onShow:r,onEnd:s});if(!TS.model.prefs.seen_app_space_tutorial)TS.prefs.setPrefByAPI({name:"seen_app_space_tutorial",value:true},function(){TS.model.prefs.seen_app_space_tutorial=true;$("[data-view_tutorial_link]").removeClass("display_none");TS.redux.dispatch(TS.interop.redux.features.prefs.forcePrefRefresh())})}});var e;var t=[{image:cdn_url+"/436da/img/app_space_tutorial_illustration_01.jpg",animation:"",title:TS.i18n.t("Common tasks, done in a jiffy","apps_browser")(),text:TS.i18n.t("Approve requests, schedule meetings, share documents, and more — all inside Slack.","apps_browser")()},{image:cdn_url+"/436da/img/app_space_tutorial_illustration_02.jpg",animation:"",title:TS.i18n.t("Connect the tools you already use","apps_browser")(),text:TS.i18n.t("Slack works with the systems you use, for everything from accounting to customer support.","apps_browser")()},{image:cdn_url+"/436da/img/app_space_tutorial_illustration_03.jpg",animation:"",title:TS.i18n.t("Discover new ways to work","apps_browser")(),text:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Poll your workspace, send kudos, and automate the coffee run. Have a better workday with apps.","apps_browser")():TS.i18n.t("Poll your team, send kudos, and automate the coffee run. Have a better workday with apps.","apps_browser")()}];var i=null;var n=function e(){$("[data-view_tutorial_link]").click(function(){TS.ui.apps_browser.showAppTutorial()});$(window.document).on("keydown",o)};var a=function t(){TS.interop.unmountAppsBrowser(e);i=null;$(window.document).off("keydown",o)};var r=function e(){$(window.document).off("keydown",o)};var s=function e(){$(window.document).on("keydown",o)};var o=function e(t){if(t.which==TS.utility.keymap.esc)TS.ui.fs_modal.close()}})()},4424:function(e,t){(function(){"use strict";TS.registerModule("ui.messages_utils",{onStart:function e(){if(!TS.boot_data.feature_keyboard_navigation)return;$("#messages_container").prepend('<div class="first_hidden_tab_stop" tabindex="0"></div>').append('<div class="last_hidden_tab_stop" tabindex="0"></div>').on("keydown",f).on("focus",".message,.unread_group_header,.bottom_mark_all_read",A).on("mousedown",".message,.unread_group_header,.bottom_mark_all_read",k).on("mousemove",".message--focus",x);$(document).on("keyup",C).on("keydown",M);var t=_.debounce(TS.ui.messages_utils.identifyFirstAndLastTabStopInView,50);$(".message_pane_scroller").on("scroll",t);TS.view.resize_sig.add(t);TS.channels.history_being_fetched_sig.add(I);TS.groups.history_being_fetched_sig.add(I);TS.ims.history_being_fetched_sig.add(I);TS.mpims.history_being_fetched_sig.add(I)},getLastTabStopInView:function e(t){var i=n("reduceRight");return t.reduce(i,null)||$()},getFirstTabStopInView:function e(t){var i=n("reduce");var a=B()?t.concat($("#end_div")):t;return a.reduceRight(i,null)||$()},isAllContentInView:function e(){var t=TS.ui.messages_utils.scrollerForCurrentView();return t.outerHeight()==t[0].scrollHeight},identifyFirstAndLastTabStopInView:function e(){if(TS.useReactMessages())return;c();var t=$("#messages_container").find(".first_hidden_tab_stop,.last_hidden_tab_stop");t.attr("tabindex","-1");if(TS.ui.messages_utils.isAllContentInView())return;var i=TS.ui.messages_utils.getMessagesInView();if(!i||i&&!i.length)return;i.forEach(function(e){if(e.hasClass("dirty_hover_container"))TS.ui.messages.updateMessageHoverContainer(e)});var n=TS.ui.messages_utils.getFirstTabStopInView(i);var a=TS.ui.messages_utils.getLastTabStopInView(i);n.addClass("first_tab_stop_in_view");a.addClass("last_tab_stop_in_view");t.attr("tabindex","0")},nextChannelViewMessage:function e(t){var i=TS.ui.utility.nextWithClass(t,"message");return i.length?i:o(t,".day_container")},prevChannelViewMessage:function e(t){var i=TS.ui.utility.prevWithClass(t,"message");return i.length?i:s(t,".day_container")},nextUnreadViewItem:function e(t){if(t.is(".unread_group_header")&&t.closest(".unread_group.collapsed").length)return t.closest(".unread_group").next(".unread_group").find(".unread_group_header");if(t.is(".unread_group_header"))return t.closest(".unread_group").find(".day_container").first().find("ts-message:first-of-type");var i=t.is(".message")&&TS.ui.messages_utils.nextChannelViewMessage(t);if(i.length)return i;var n=t.closest(".unread_group").next(".unread_group");if(n.length)return n.find(".unread_group_header");return t.closest(".unread_group").find(".bottom_mark_all_read")},prevUnreadViewItem:function e(t){if(t.is(".bottom_mark_all_read"))return t.closest(".unread_group").find(".day_container").last().find("ts-message:last-of-type");var i=t.is(".message")&&TS.ui.messages_utils.prevChannelViewMessage(t);if(i.length)return i;if(t.is(".message"))return t.closest(".msgs_holder").prev(".unread_group_header");var n=t.closest(".unread_group").prev(".unread_group");if(n.hasClass("collapsed"))return n.find(".unread_group_header");return n.find(".day_container").last().find("ts-message:last-of-type")},nextThreadsViewMessage:function e(t){var i=TS.ui.utility.nextWithClass(t,"message");if(i.length)return i;var n=TS.ui.utility.nextWithClass(t,"thread_replies_container").find("ts-message:first-of-type");if(n.length)return n;var a=o(t,"ts-thread",".thread_messages > ts-message:first-of-type");if(a.length)return a;var r="ts-thread:first-of-type .thread_messages > ts-message:first-of-type";return o(t,".threads_section",r)},prevThreadsViewMessage:function e(t){var i=TS.ui.utility.prevWithClass(t,"message");if(i.length)return i;var n=TS.ui.utility.prevWithClass(t.closest(".thread_replies_container"),"message");if(n.length)return n;var a=s(t,"ts-thread",".thread_replies_container > ts-message:last-of-type");if(a.length)return a;var r="ts-thread:last-of-type .thread_replies_container > ts-message:last-of-type";return s(t,".threads_section",r)},getMessagesInView:function e(){var i=TS.ui.messages_utils.scrollerForCurrentView();if(i.outerHeight()==i[0].scrollHeight)return i.find(".message,.unread_group_header,.bottom_mark_all_read").toArray().reverse().map(function(e){return $(e)});var n=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var a=n.left+n.width/2;var r=n.bottom-10;var s=n.left;var o=n.bottom/2;var l=t();var d=function e(t){var i=t[t.length-1];var n=i[0].getBoundingClientRect().top;if(n>=0&&n<=10)return t;if(n<0)return t;var a=l(i);if(!a.length)return t;return e(t.concat(a))};var c=TS.ui.utility.findNodeInRegion(".message,.unread_group_header,.bottom_mark_all_read",a,r,s,o);if(!c)return;return d([c])},scrollerForCurrentView:function e(){var t={unread_view_is_showing:"#unread_msgs_scroller_div",threads_view_is_showing:"#threads_msgs_scroller_div",archive_view_is_showing:"#archive_msgs_scroller_div",app_space_view_is_showing:"#app_space_scroller_div"};var i=Object.keys(t).reduce(function(e,i){return TS.model[i]?t[i]:e},"#msgs_scroller_div");return $(i)},getFirstMessageInDom:function e(t){var i={unread_view_is_showing:"first",threads_view_is_showing:"first"};var n=Object.keys(i).reduce(function(e,t){return TS.model[t]?i[t]:e},"last");var a=t.find(".message,.unread_group_header,.bottom_mark_all_read");return a[n]()},getFirstMessageInView:function e(t){var i={unread_view_is_showing:".first_tab_stop_in_view",threads_view_is_showing:".first_tab_stop_in_view"};var n=Object.keys(i).reduce(function(e,t){return TS.model[t]?i[t]:e},".last_tab_stop_in_view");TS.ui.messages_utils.identifyFirstAndLastTabStopInView();return t.find(n).closest(".message,.unread_group_header,.bottom_mark_all_read")},establishInitialFocus:function e(t,i){E(i.find(".message--focus"));var n=TS.ui.messages_utils.isAllContentInView()?TS.ui.messages_utils.getFirstMessageInDom(i):TS.ui.messages_utils.getFirstMessageInView(i);l(n);if(TS.ui.messages_utils.isAllContentInView())return;var a=38==t.keyCode;d(a,n,i)},visibleMsgsScrollAreaRect:function e(){var t=document.getElementById("messages_container").getBoundingClientRect();var i=8;var n=t.top+i;return{top:n,left:t.left,bottom:t.bottom,right:t.right,width:t.width,height:t.bottom-n}}});var e=function e(t){var i="prev"==t?"prev":"next";var n={unread_view_is_showing:"UnreadViewItem",threads_view_is_showing:"ThreadsViewMessage"};return function(){var e=Object.keys(n).reduce(function(e,t){return TS.model[t]?n[t]:e},"ChannelViewMessage");return TS.ui.messages_utils[i+e]}};var t=e("prev");var i=e("next");var n=function e(t){return function(e,i){if(e)return e;var n=i.hasClass("message--focus");if(!n)i.addClass("message--focus");var a=r(i,t);if(!n)i.removeClass("message--focus");if(a)return $(a)}};var a=function e(){var t=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var i=t.top;var n=t.bottom;return function(e){var t=e.getBoundingClientRect().top;return t>=i&&t<=n}};var r=function e(t,i){var n=a();var r="reduceRight"==i?"lastFocusableChild":"firstFocusableChild";return TS.ui.utility[r](t[0],n)};var s=function e(t,i,n){var a=n||"ts-message:last-of-type";return t.closest(i).prev(i).find(a)};var o=function e(t,i,n){var a=n||"ts-message:first-of-type";return t.closest(i).next(i).find(a)};var l=function e(t){if(!t.length)return;if(t.is(".message"))TS.ui.messages.updateMessageHoverContainer(t);t.attr("tabindex",-1).focus()};var d=function e(t,i,n){if(!i.length)return;var a=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var r=i[0].getBoundingClientRect();var s=r.top;var o=r.height;var l=i.find(".action_hover_container");var d=function(){if(!l.length)return 0;var e=l[0].getBoundingClientRect().top;var t=parseInt(l.css("right"),10);return e-t}();var c=a.top+(s-d);var _=n.scrollTop();if(t&&s>=c)return;if(t||o>=a.height)n.scrollTop(_-(c-s))};var c=function e(){var t=TS.ui.messages_utils.scrollerForCurrentView();t.find(".first_tab_stop_in_view").removeClass("first_tab_stop_in_view");t.find(".last_tab_stop_in_view").removeClass("last_tab_stop_in_view")};var u=function e(){var t=TS.ui.messages_utils.scrollerForCurrentView();E(t.find(".message--focus"));TS.ui.messages_utils.identifyFirstAndLastTabStopInView();t.find(".first_tab_stop_in_view").focus().addClass("focus-ring")};var m=function e(){var t=TS.ui.messages_utils.scrollerForCurrentView();E(t.find(".message--focus"));TS.ui.messages_utils.identifyFirstAndLastTabStopInView();t.find(".last_tab_stop_in_view").focus().addClass("focus-ring")};var f=function e(t){var i=t.keyCode;var n=$(t.target);if(i==TS.utility.keymap.esc&&n.hasClass("message--focus")){n.blur();return}if(i==TS.utility.keymap.tab&&TS.client.ui.isUserAttentionOnChat()){b(t);return}if(!n.is("#messages_container")&&h(t))v(t)};var h=function e(t){var i=t.keyCode;var n=TS.utility.keymap;var a=i==n.up||i==n.down;var r=t.metaKey||t.ctrlKey||t.altKey||t.shiftKey;return a&&!TS.utility.isFocusOnInput()&&!r&&TS.client.ui.isUserAttentionOnChat()};var g=0;var p=0;var S=function e(t){if(!t)return false;var i=a();var n=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var r=t.getBoundingClientRect();var s=r.bottom;return i(t)||s>n.top&&s<=n.bottom||r.height>=n.height};var T=function e(n,a,r){var s=n.keyCode;var o={38:t,40:i}[s]();var c=o(a);if(!c.length)return;n.preventDefault();l(c);var _=38==s;d(_,c,r);g=Date.now()};var v=function e(t,i){var n=TS.ui.messages_utils.scrollerForCurrentView();var a=n.find(".message--focus");var r=i||!i&&!S(a[0]);if(r){TS.ui.messages_utils.establishInitialFocus(t,n);return}T(t,a,n)};var b=function e(t){p=Date.now();var i=t.target;var n=$(i);if(n.is(".message .ql-editor"))return;var r=n.closest(".message");if(r.hasClass("dirty_hover_container"))TS.ui.messages.updateMessageHoverContainer(r);var s=t.shiftKey;var o=a();var l=function e(t){var i=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var n=t.getBoundingClientRect();var a=n.bottom;return o(t)||a>i.top&&a<=i.bottom};if(!s&&n.is(".last_tab_stop_in_view")){t.preventDefault();if($("#client-ui").hasClass("flex_pane_showing")){w();return}if(window.winssb){TS.utility.contenteditable.focus(TS.client.msg_input.$input);return}$("#messages_container .last_hidden_tab_stop").focus();return}if(s&&n.is(".first_tab_stop_in_view")){t.preventDefault();TS.ui.utility.lastFocusableChild($("#client_header .flex_header")).focus();return}if(!l(i)){t.preventDefault();u()}};var w=function e(){var t=TS.ui.utility.firstFocusableChild($("#col_flex .panel.active"));if(t)$(t).addClass("focus-ring").focus()};var y=false;var k=function e(){y=true};var A=function e(t){if(y){y=false;return}var i=t.target;var n=$(i);var a=$(".message--focus");var r=a.get(0);if(r&&r.contains(i)||n.is(".message--focus"))return;E(a);n.closest(".message,.unread_group_header,.bottom_mark_all_read").addClass("message--focus").append('<div class="messagefocusindicator"></div>')};var C=function e(t){if(t.target==document)return;var i=t.target;var n=$(i);if(9!=t.keyCode)return;var a=TS.ui.messages_utils.scrollerForCurrentView();if(!t.shiftKey&&n.is("#messages_container .first_hidden_tab_stop")){if(a.find(".first_tab_stop_in_view").length){u();return}if($("#client-ui").hasClass("flex_pane_showing")){w();return}if(window.winssb){TS.utility.contenteditable.focus(TS.client.msg_input.$input);return}$("#messages_container .last_hidden_tab_stop").focus();return}if(t.shiftKey&&n.is("#messages_container .last_hidden_tab_stop")){if(a.find(".last_tab_stop_in_view").length){m();return}TS.ui.utility.lastFocusableChild($("#client_header .flex_header")).addClass("focus-ring").focus();return}var r=a.find(".message--focus");var s=r.get(0);if(s&&!s.contains(i))E(r)};var M=function e(t){if(t.target==document)return;var i=t.keyCode;var n=t.target;var a=$(n);var r=$("#messages_container");var s=a.is(r);var o=i==TS.utility.keymap.tab;if(o&&!t.shiftKey&&a.is("#col_flex")){w();t.preventDefault();return}if(!h(t))return;var l=!s&&r[0].contains(n);var d=$("#col_flex")[0].contains(n);var c=$(".client_channels_list_container")[0].contains(n);if(l||d||c)return;t.preventDefault();if(s)r.blur();v(t,true)};var I=function e(){if(Date.now()-g>1e3)return;var t=TS.ui.messages_utils.scrollerForCurrentView();var i=t.find(".message--focus");if(!i.length)return;var n=TS.model.archive_view_is_showing?TS.client.archives.msgs_scrolled_sig:TS.client.ui.msgs_scrolled_sig;n.addOnce(function(){var e=$("#"+i.attr("id"));l(e)})};var x=function e(t){var i=Date.now();if(i-g<=1e3)return;if(i-p<=1e3)return;var n=$(t.currentTarget);n.blur().removeAttr("tabindex");E(n)};var E=function e(t){t.removeClass("message--focus");t.find(".messagefocusindicator").remove()};var B=function e(){var t=document.getElementById("end_div");if(!t)return false;var i=TS.ui.messages_utils.visibleMsgsScrollAreaRect();var n=t.getBoundingClientRect();var a=n.bottom;return a>i.top&&a<=i.bottom}})()},4425:function(e,t){(function(){"use strict";TS.registerModule("ui.macro_keyboard_nav",{onStart:function i(){if(!TS.boot_data.feature_keyboard_navigation)return;$(document).on("keydown",t).on("blur",".focusablesection",e).on("mousemove",".focusablesection",TS.ui.macro_keyboard_nav.blurSection)},blurSection:function e(t){$(t.currentTarget).blur()},focusSection:function e(t){$(t).append('<div class="sectionfocusindicator"></div>');$(t).addClass("focusablesection").attr("tabindex",-1).focus();document.body.scrollTop=0},moveNext:function e(t){if(t.altKey||t.metaKey)return;var a="`"==t.key;var s="~"==t.key;if(!((a||s)&&t.ctrlKey&&TS.client.ui.isUserAttentionOnChat()))return;var o=$(t.target);var l=o.is(r.join(","));if(!l){TS.ui.macro_keyboard_nav.focusSection(r[0]);return}var d=s?"prev":"next";var c=function e(t,i,n){return o.is(i)?n+1:t};var _=function e(t,i,n){return o.is(i)?n-1:t};var u="next"==d?c:_;var m=r.reduce(u,0);var f="next"==d?i(m):n(m);TS.ui.macro_keyboard_nav.focusSection(f)}});var e=function e(t){$(t.currentTarget).removeClass("focusablesection").removeAttr("tabindex").find(".sectionfocusindicator").remove()};var t=function e(t){var i=$(t.target);if(t.keyCode==TS.utility.keymap.esc&&i.hasClass("focusablesection")){i.blur();return}TS.ui.macro_keyboard_nav.moveNext(t)};var i=function e(t){var i=r[t];if(!i)return e(0);var n=$(i);if(a(n))return i;return e(t+1)};var n=function e(t){var i=r[t];if(!i)return e(r.length-1);var n=$(i);if(a(n))return i;return e(t-1)};var a=function e(t){return"none"!=t.css("display")&&t.width()&&t.height()};var r=["#messages_container","#footer","#col_flex",".client_channels_list_container","#client_header"]})()},4426:function(e,t){(function(){"use strict";TS.registerModule("client.quick_promo",{onStart:function e(){i=TS.experiment.getGroup("quick_promo_invite_nudge");TS.client.login_sig.addOnce(r)},test:function e(){var t={_showModal:o};Object.defineProperty(t,"_showModal",{get:function e(){return o},set:function e(t){o=t}});return t}})})();var i;var n;var a;var r=function e(){if("show_invite_nudge"!==i&&"show_invite_nudge_contextual"!==i)return;TS.api.call("promo.show",{team_id:TS.model.team.id,user_id:TS.model.user.id,previous_login:TS.boot_data.last_login_timestamp}).then(function(e){if(!e.data||!e.data.ok||!e.data.show_modal)return;n=e.data.invite_count?e.data.invite_count:0;s();var t=new Image;t.onload=o;t.src=cdn_url+"/436da/img/quick_promo/ill_team@2x.png"})};var s=function e(){if("show_invite_nudge_contextual"===i&&n>0)a="contextual";else if("show_invite_nudge_contextual"===i)a="contextual_no_invites";else a="non_contextual"};var o=function e(){TS.generic_dialog.start({type:"quick_promo",body:TS.templates.quick_promo_invite_nudge({copy_is_contextual_with_invites:"contextual"===a,copy_is_non_contextual:"non_contextual"===a,invite_count:n}),dialog_class:"quick_promo",force_small:true,show_close_button:true,show_cancel_button:true,cancel_button_text:TS.i18n.t("Remind Me Later","quick_promo")(),fullscreen:false,show_go_button:true,onGo:l,go_button_text:TS.i18n.t("Invite People","quick_promo")(),onCancel:d});c()};var l=function e(){TS.prefs.setPrefByAPI({name:"promo_dismissed",value:true});f("invite_people_button")};var d=function e(){TS.prefs.setPrefByAPI({name:"promo_snoozed",value:Date.now()/1e3});f("remind_me_later_button")};var c=function e(){_();u();m()};var _=function e(){var t=$(".c-modal_footer__go--quick_promo");t.attr("data-action","admin_invites_modal")};var u=function e(){var t=$(".c-modal_close--quick_promo");t.one("click",function(){TS.prefs.setPrefByAPI({name:"promo_dismissed",value:true});f("exit_button")})};var m=function e(){var t=$(".modal-backdrop");t.on("click",function(){f("outside_click")})};var f=function e(t){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"invite_nudge",action:"click",ui_element:t},growth:{trigger:a}}})}},4427:function(e,t){(function(){"use strict";TS.registerModule("ui.card_carousel",{onStart:function e(){},start:function a(s){if(!s.cards){TS.warn("Card carousel requires cards to show.");return}e=s;t=s.cards;i=0;n=t.length;r();if(e.onShow)e.onShow()}});var e;var t;var i;var n;var a=function e(i){var n=new Image;n.onload=function(){if(0===i){d(i);var e=setTimeout(function(){if(!TS.generic_dialog.is_showing)return;$(window.document).bind("keydown",s);clearTimeout(e)},100)}n.onload=null;n.src=null;n=null};n.src=t[i].image};var r=function e(){for(var t=0;t<n;t++)a(t)};var s=function e(t){if(t.which==TS.utility.keymap.enter||t.which==TS.utility.keymap.right)l();else if(t.which==TS.utility.keymap.esc)_();else if(t.which==TS.utility.keymap.left&&0!==i)o()};var o=function e(){TS.generic_dialog.end();i-=1;if(i<0||i>=n){_();return}d(i)};var l=function e(){TS.generic_dialog.end();i+=1;if(i<0||i>=n){_();return}d(i)};var d=function e(a){var r=false;var s=false;if(0===a)r=true;if(i+1===n)s=true;var d={display_card_index:i+1,number_of_cards:n,first_card:r,last_card:s};var u={card:t[i],allow_animations:TS.model.prefs.a11y_animations};TS.generic_dialog.start({body:TS.templates.card_carousel(u),body_cls:"c-card_carousel__body",show_go_button:false,show_cancel_button:false,dialog_class:"c-card_carousel",backdrop_click_to_dismiss:true,onCancel:c});var m=$(".c-card_carousel");m.append(TS.templates.card_carousel_buttons(d));m.find(".c-card_carousel__body").click(l);m.find("[data-card_left_button]").click(o);m.find("[data-card_right_button]").click(l);m.find("[data-card_close_button]").click(_)};var c=function t(){$(window.document).unbind("keydown",s);if(e.onEnd)e.onEnd()};var _=function e(){c();TS.generic_dialog.cancel()}})()},4428:function(e,t){(function(){"use strict";TS.registerModule("client.ui.teams",{onStart:function e(){TS.teams.rename_sig.add(TS.client.ui.teams.updateSharedChannelIcons);TS.teams.added_sig.add(TS.client.ui.teams.updateSharedChannelIcons)},updateSharedChannelIcons:function e(t){if(t.id===TS.model.team.id)return;$(".ts_icon_shared_channels[data-shared-team-ids]").each(function(e,i){var n=$(i);var a=n.data("shared-team-ids");a=a&&TS.utility.parseJSONOrElse(a,a);if(!a.length||-1===a.indexOf(t.id))return;var r=n.data("tooltip-position");n.replaceWith(TS.templates.shared_channels_icon({shared_team_ids:a,tooltip:true,tooltip_position:r}))})}})})()},4429:function(e,t){(function(){"use strict";TS.registerModule("ui.onboarding_dialog",{onStart:function e(){},start:function e(){if(TS.generic_dialog.is_showing)return;c().then(function(){if(n){s(TS.templates.onboarding_dialog_team_creator_welcome({first_name:TS.model.user.name,team_name:TS.model.team.name}));l()}else s(TS.templates.onboarding_dialog_quest({modal_color_class:"c-modal__media_container--onboarding_dialog_"+a,modal_title:r}))})}})})();var i;var n=true;var a="blue";var r="Start by creating a channel";var s=function e(t){TS.generic_dialog.start({type:"onboarding_dialog",force_small:true,hide_footer:true,body:t});o();i=$(".c-modal_body--onboarding_dialog")};var o=function e(){if(TS.boot_data.feature_quest_onboarding)$(".c-modal_body--onboarding_dialog").on("click",".c-modal__close--onboarding_dialog",function(e){TS.menu.startWithGeneric(e,[{value:"remind",label:TS.i18n.t("Remind me next time","prefs")()},{value:"skip",label:TS.i18n.t("Skip completely","prefs")()}],function(e){if("remind"==e)$("#generic_dialog").css("background-color","chartreuse");else $("#generic_dialog").css("background-color","aliceblue");TS.generic_dialog.cancel()})})};var l=function e(){$("#start_quest_onboarding").one("click",function(){n=false;d()})};var d=function e(){i.html(TS.templates.onboarding_dialog_quest({modal_color_class:"c-modal__media_container--onboarding_dialog_"+a,modal_title:r}))};var c=function e(){return new Promise(function(e,t){var i=new Image;i.onload=function(){e()};i.onerror=function(){t(new Error("failed to load image"))};i.src=cdn_url+"/883cf/img/focus-rocks-0.png"})}}},[1593]);