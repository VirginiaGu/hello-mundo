webpackJsonp([2,387,395,396,397,398,399,409,414],{3667:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("enterprise",{enterprise_domain_changed_sig:new signals.Signal,onStart:function e(){if(TS.boot_data.page_needs_enterprise)t();if(TS.client)TS.client.user_added_to_team_sig.add(TS.enterprise.ensureTeamInModel);if(TS.client)TS.client.user_removed_from_team_sig.add(TS.enterprise.ensureTeamInModel)},getTeamsForMember:function e(t,n){var r=TS.model.user;if(!t.enterprise_user)return null;if(n&&!r.enterprise_user)return null;if(!TS.model.enterprise||!TS.model.enterprise_teams)return null;var i=TS.model.enterprise_teams;var a=t.enterprise_user.teams;var s=[];var o={all:[]};if(n){s=r.enterprise_user.teams;o.other=[];o.shared=[]}i.forEach(function(e){var t=false;var r=false;if(a.indexOf(e.id)>-1){t=true;o.all.push(e)}if(n&&t){if(s.indexOf(e.id)>-1)r=true;if(r)o.shared.push(e);else o.other.push(e)}});return o},upsertAndSignal:function e(t){if(!TS.boot_data.page_needs_enterprise)TS.warn("Unexpected call to TS.enterprise.upsertAndSignal");if(!t)return;var n=TS.enterprise.upsertEnterprise(t);if("CHANGED"===n.status)if(-1!=n.what_changed.indexOf("name"))TS.enterprise.enterprise_domain_changed_sig.dispatch(n.enterprise);return n},upsertEnterprise:function e(r){if(!TS.boot_data.page_needs_enterprise)TS.warn("Unexpected call to TS.enterprise.upsertEnterprise");t();var i=TS.model.enterprise;var a="NOOP";var s=[];if(r)for(var o in r)if(i[o]!=r[o])if("icon"===o){i[o]=r[o];s.push(o);a="CHANGED"}else if(i[o]!=r[o])if(r[o]&&!TS.utility.isScalar(r[o])){i[o]=r[o];TS.warn(o+" is not scalar! it needs to be handled by upsertEnterprise specifically to test if it has changed! "+n(r[o]))}else if("boolean"!==typeof r[o]||!r[o]!=!i[o]){i[o]=r[o];s.push(o);a="CHANGED"}return{status:a,enterprise:i,what_changed:s}},upsertEnterpriseTeam:function t(n,s){if(!TS.boot_data.page_needs_enterprise)TS.warn("Unexpected call to TS.enterprise.upsertEnterpriseTeam");if(!n||"string"===typeof n)return;var o=TS.model.enterprise_teams;var l=TS.enterprise.getTeamById(n.id);var u=TS.model.team&&n.id===TS.model.team.id;if(l){_.each(_.keys(n),function(e){if("description"===e)l[e]=_.unescape(n[e]);else l[e]=n[e]});n=l;a(n);i(n);if(u)n=_.merge({},l,TS.model.team)}else{r(n);if(u)n=_.merge({},n,TS.model.team);o.push(n);e[n.id]=n}if(u&&!s){s=true;TS.team.upsertTeam(n,s)}return n},getTeamById:function t(n){var r=TS.model.enterprise_teams;var i=e[n];if(i)return i;if(!r)return null;for(var a=0;a<r.length;a+=1){i=r[a];if(i.id===n){TS.warn(n+" not in _id_map?");e[n]=i;return i}}return null},promiseToEnsureEnterprise:function e(){if(!TS.boot_data.page_needs_enterprise)TS.warn("Unexpected call to TS.enterprise.promiseToEnsureEnterprise");t();return Promise.all([TS.api.call("enterprise.info",{include_primary_owner:true}).reflect(),TS.enterprise.promiseToGetTeams().reflect()]).then(function(e){var t=[];e.forEach(function(e){if(e.isFulfilled())return;t.push(e.reason())});if(t.length)return Promise.reject(new Error("Some enterprise APIs failed:\n"+t.join("\n")));var n=e[0].value().data.enterprise;TS.enterprise.upsertEnterprise(n)})},promiseToGetTeams:function e(t){var n={include_archived:false,include_deleted:false,include_user_counts:true,include_leave_team:true,include_join_request:true};if(t)n.exclude_discoverable=t;return TS.api.call("enterprise.teams.list",n).reflect().then(function(e){if(!e.isFulfilled()){TS.console.error("The API failed:\n"+e.reason());return Promise.resolve([])}if(TS.boot_data.feature_lazy_grid_teams)return Promise.resolve(_(e.value().data.teams).map(TS.teams.upsertTeam).map("team").filter(function(e){if(!e.enterprise_id)return false;if(!t)return true;return t.indexOf(e.discoverable)<0}));var n=e.value().data.teams;n.forEach(function(e){TS.enterprise.upsertEnterpriseTeam(e)});return Promise.resolve(TS.model.enterprise_teams.filter(function(e){if(!t)return true;return t.indexOf(e.discoverable)<0}))})},ensureTeamInModel:function e(t,n){var r={include_user_counts:true,include_leave_team:true,team:t,include_join_request:true};if(TS.model.enterprise_api_token)r.enterprise_token=TS.model.enterprise_api_token;if(n)r=_.merge({},r,n);return TS.api.callImmediately("enterprise.teams.info",r).then(function(e){if(!e.data.ok)return false;return TS.enterprise.upsertEnterpriseTeam(e.data.team)})},addTeamsToSharedForChannel:function e(t,n){if(!TS.boot_data.page_needs_enterprise)return;if(!t.is_shared)return;if(t.is_global_shared)return;var r=t.shared_team_ids;r=_(r).concat(n).uniq().value();t.shared_team_ids=r},updateSharesForChannel:function e(t,n){if(!TS.boot_data.page_needs_enterprise)return;if(!t.is_shared)return;t.shared_team_ids=_.uniq(n)},isUserOnTeam:function e(t,n){return t.enterprise_user.teams.indexOf(n.id)>-1}});var e={};var t=function e(){if(TS.model.enterprise&&TS.model.enterprise_teams)return;TS.model.enterprise=_.merge({},TS.model.enterprise);TS.model.enterprise_teams=_.merge([],TS.model.enterprise_teams)};var r=function e(t){switch(t.discoverable){case"public":case"open":t.is_open=true;break;case"private":case"closed":t.is_closed=true;break;case"unlisted":default:t.is_unlisted=true}t.description=_.unescape(t.description);if(!t.user_counts)t.user_counts={};if(t.user_counts&&!t.user_counts.active_members)t.user_counts.active_members=0;a(t);if("undefined"===typeof t.joined_date)t.joined_date=0;i(t)};var i=function e(t){if(false===t.can_leave&&t.cannot_leave_reasons&&1===t.cannot_leave_reasons.length&&"not_team_member"===t.cannot_leave_reasons[0]&&!t.is_assigned){t.can_leave=true;t.cannot_leave_reasons=[]}};var a=function e(t){if(!t.top_combined_channels)t.top_combined_channels=[];if(t.your_channels||t.your_groups){var n=[];if(t.your_channels)n=n.concat(t.your_channels);if(t.your_groups)n=n.concat(t.your_groups);t.top_combined_channels=_.uniqBy(t.top_combined_channels.concat(n),"id").sort(function(e,t){var n=e.name.toLowerCase();var r=t.name.toLowerCase();if(n<r)return-1;if(n>r)return 1;return 0})}}})()},3669:function(e,t){(function(){"use strict";TS.registerModule("format.texty",{memberToSlug:function e(t,n){if(!t||!t.id||!t.name)return;var r;if(TS.boot_data.feature_name_tagging_client)r=TS.members.getPrefCompliantMemberName(t,false,true);else r="@"+t.name;return{insert:r,attributes:{slackmention:{id:t.id,label:r,should_highlight:!!n}}}},convertContentsToString:function e(t){if(!t.contents)return"";var n=_.reduce(t.contents,function(e,t){if(t.attributes&&t.attributes.slackmention){if(t.insert.length>t.attributes.slackmention.label.length){var n=t.insert.split(t.attributes.slackmention.label);if(n.length>1){n.shift();n=n.map(function(){return"<@"+t.attributes.slackmention.id+"|"+_.escape(t.attributes.slackmention.label)+">"});return e+n.join("")}}return e+"<@"+t.attributes.slackmention.id+"|"+_.escape(t.attributes.slackmention.label)+">"}return e+t.insert},"");return n.replace(/\n$/,"")},convertContentsToStringForDisplay:function e(t){if(!t.contents)return"";t=_.reduce(t.contents,function(e,t){if(t.attributes&&t.attributes.slackmention)return e+t.attributes.slackmention.label;return e+t.insert},"");return t.replace(/\n$/,"")},convertContentsStringToContents:function e(t){var n={contents:[]};if(-1!==t.search(a)){var r=[];t.replace(a,function(e,t,n,i){r.push({id:t,label:_.unescape(n),index:i,length:e.length})});var i=0;r.forEach(function(e){var r=t.substring(i,e.index);if(r.length)n.contents.push({insert:r});var a=TS.format.texty.shouldHighlightMention(e.id,e.label);var s="UNVERIFIED"===e.id;n.contents.push({insert:e.label,attributes:{slackmention:{label:e.label,id:e.id,mention:a,unverified:s}}});i=e.index+e.length});var s=t.substr(i);if(s.length)n.contents.push({insert:s});return n}n.contents.push({insert:t});return n},convertContentsStringForSlashCommands:function e(t){var n=TS.format.texty.convertContentsStringToContents(t);return _.reduce(n.contents,function(e,t){if(t.attributes&&t.attributes.slackmention){var n=t.attributes.slackmention.id;if("BKeveryone"===n)return e+"@everyone";else if("BKhere"===n)return e+"@here";else if("BKchannel"===n)return e+"@channel";else if("BKgroup"===n)return e+"@group";return e+"@"+n}return e+t.insert},"")},convertContentsStringForSearch:function e(t){var n=TS.format.texty.convertContentsStringToContents(t);return _.reduce(n.contents,function(e,t){if(t.attributes&&t.attributes.slackmention){var n=t.attributes.slackmention.id;if("BKeveryone"===n)return e+"@everyone";else if("BKhere"===n)return e+"@here";else if("BKchannel"===n)return e+"@channel";else if("BKgroup"===n)return e+"@group";return e+"<@"+n+">"}return e+t.insert},"")},getMemberAsContentsString:function e(t){if(!t)return"";return"<@"+t.id+"|"+TS.members.getPrefCompliantMemberName(t,true,true)+">"},getFormattedDelta:function e(t){if(!t)return;var n=t.map(s);var r=o(n);var i=_.last(r);i.insert=i.insert.replace(/\n$/,"");var a=r.map(l);return new TS.interop.texty.Delta(a)},replaceFormatMentions:function e(t,n,r){var i=0;n=n.replace(a,function(e,n,a){i+=1;var s="mention-placeholder-"+Date.now()+"-"+i;var o=r?_.escape(a):a;if("BKeveryone"===n)o="<!everyone>";else if("BKhere"===n)o="<!here>";else if("BKchannel"===n)o="<!channel>";else if("BKgroup"===n)o="<!group>";else if("S"===n.charAt(0)){var l=TS.user_groups.getUserGroupsById(n);if(l)o="<!subteam^"+l.id+"|@"+l.handle+">"}else{var u=TS.members.getMemberById(n);if(u)o="<@"+u.id+">"}t.push({mention:o,placeholder:s});return s});return n},buildSmartQuotesDelta:function e(t){var n=new TS.interop.texty.Delta;var r=0;var a=t.reduce(function(e,t){if(t.attributes&&t.attributes.slackmention){var n=t.insert.replace(/./g,"a");return e+n}return e+t.insert},"");var s=TS.format.texty.replaceSmartQuotes(a);if(a===s)return n;for(var o=0;o<a.length;o++)if(a[o]!==s[o]&&-1!==i.indexOf(a[o])&&-1!==i.indexOf(s[o])){n.retain(o-r).delete(1).insert(s[o]);r=o+1}return n},replaceSmartQuotes:function e(t){t=t.replace(/[\u2018|\u2019]/g,"'");t=t.replace(/[\u201c|\u201d]/g,'"');var n=[];t=TSF.replaceFormatContents(n,t,{replace_pre:true,replace_code:true,replace_url:true});var r=[];t=m(t,r);t=t.replace(/([^A-Za-z0-9]|^)"(\S)/g,"$1“$2").replace(/(\u201c[^"]*)"([^"]*$|[^\u201c"]*\u201c)/g,"$1”$2").replace(/([^0-9])"/g,"$1”").replace(/([^A-Za-z0-9]|^)'(\S)/g,"$1‘$2").replace(/([a-z])'([a-z])/gi,"$1’$2").replace(/((\u2018[^']*)|[a-z])'([^0-9]|$)/gi,"$1’$3").replace(/(\u2018)([0-9]{2}[^\u2019]*)(\u2018([^0-9]|$)|$|\u2019[a-z])/gi,"’$2$3").replace(/(\B|^)\u2018(?=([^\u2019]*\u2019\b)*([^\u2019\u2018]*\W[\u2019\u2018]\b|[^\u2019\u2018]*$))/gi,"$1‘").replace(/'/g,"′");t=f(t,r);t=TSF.swapOutPlaceholders(n,t);return t},removeInvalidMentions:function e(t){t.contents=t.contents.map(function(e){if(e.attributes&&e.attributes.slackmention&&!TS.members.getMemberById(e.attributes.slackmention.id)&&!TS.user_groups.getUserGroupsById(e.attributes.slackmention.id)&&-1===["BKeveryone","BKhere","BKchannel","BKgroup"].indexOf(e.attributes.slackmention.id))return{insert:e.insert};return e});return t},shouldHighlightMention:function e(t,n){if(TS.model.user.id===t)return true;else if(TS.user_groups.getUserGroupsById(t)&&-1!==TS.model.highlight_words.indexOf(n))return true;else if(-1!==["BKeveryone","BKhere","BKchannel","BKgroup"].indexOf(t))return true;return false},test:function e(){var t={};Object.defineProperty(t,"IGNORED_FORMATS",{get:function e(){return n},set:function e(t){n=t}});return t}});var e={bold:function e(t){return"*"+t+"*"},italic:function e(t){return"_"+t+"_"},code:function e(t){return"`"+t+"`"},strike:function e(t){return"~"+t+"~"},"code-block":function e(t){return"```\n"+t+"\n```"},bracketed:function e(t){return"["+t+"]"}};var t=["bold","italic","code","strike","bracketed"];var n=["code","code-block"];var r=["monospace","menlo","consolas","inconsolata","courier","monaco","anonymous pro","terminus","source code pro"];var i=["'",'"',"“","”","‘","’"];var a=/(?:<)@((?:(?:U|W|S)[A-Z0-9]{8})|BKeveryone|BKhere|BKchannel|BKgroup|UNVERIFIED)\|(@.+?)(?:>)/g;function s(t){var n={attributes:{},insert:t.insert};_.each(t.attributes,function(t,r){if("fontFamily"===r&&c(t))r="code";if(!e[r]||!t)return;if("code-block"===r)r="code";n.attributes[r]=true});return n}function o(e){var t=e.slice(0,1);_.each(e.slice(1),function(e){var n=_.last(t);if(_.isEqual(e.attributes,n.attributes))n.insert+=e.insert;else t.push(e)});return t}function l(r){var i={insert:r.insert};_.each(r.attributes,function(r,a){a=d(i.insert,a);if(_.includes(n,a))return;if(_.includes(t,a)){var s=i.insert.split("\n").map(function(t){return u(t,e[a])});i.insert=s.join("\n")}else i.insert=u(i.insert,e[a])});return i}function u(e,t){if(/^\s*$/.test(e))return e;return e.replace(/^(\s*)((?:.|\n)*?)(\s*)$/,function(e,n,r,i){return n+t(r)+i})}function d(e,t){if("code-block"===t&&e.match(/^[^\n]*\n?$/))return"code";if("code"===t&&e.match(/\n/g))return"code-block";return t}function c(e){if(!e)return false;var t=e.toLowerCase();if(_.includes(t," mono"))return true;return r.some(function(e){return _.includes(t,e)})}function m(e,t){TS.emoji.eachEmoticon(e,function(n){e=e.replace(n,function(e){var n="<emoticon-placeholder-"+Date.now()+">";t.push({emoticon:e,placeholder:n});return n})});return e}function f(e,t){t.forEach(function(t){e=e.replace(t.placeholder,t.emoticon)});return e}})()},3674:function(e,t){(function(){"use strict";TS.registerModule("tabcomplete.channels",{type:"channels",getMatch:function e(t){if(!_.isString(t))return;var n;var r=t.lastIndexOf("#");var i=/(^|\n|.)(#[^~`!@#$%^&*()+=[\]{}\\|;:'",.<>/?\s]*)$/i;var a=TS.i18n.deburr(t);a.replace(i,function(e,i){if(!TS.tabcomplete.isAllowedSurroundingCharacter(i))return;n=t.substr(r,t.length-r)});if(!n)return;return{match:n,index:r}},shouldDisplayResults:function e(t,n){if(!t||_.isEmpty(n))return false;var r=t.replace(/^#/,"").toLowerCase();var i=1===n.length&&n[0].name===r;return!i},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;return t[n]},getInsertData:function e(t){if(!t)return;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"channel"}}});var n="#"+t.name;return{text:n}},search:function t(n,r,i){var a=e(n);i(null,a)},render:function e(t,n){var r=TS.templates.tabcomplete_channel_header({text:t});var i=TS.templates.tabcomplete_channel_results({results:n});return TS.tabcomplete.renderMenu(r,i)},onSelect:function e(t,n){if(!t)return;if(!n)n="";n=n.replace(/^#/,"");TS.ui.frecency.record(t,n)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)}});function e(e){var t;t={channels:_.reject(TS.redux.channels.dangerouslyGetChannelsForUser(),"is_archived")};var n={prefer_exact_match:true,frecency:true,limit:25,allow_empty_query:true,search_previous_channel_names:true};var r=e.replace(/^#/,"");var i=TS.sorter.search(r,t,n);return _.map(i,"model_ob")}})()},3675:function(e,t){(function(){"use strict";TS.registerModule("tabcomplete.commands",{type:"commands",getMatch:function e(t,n,r){if(!_.isString(t))return;if(_.isNumber(r)&&0!==r)return;if(t.startsWith("／"))t="/"+t.substring(1);if("/"===t)TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_start",trigger:"slash_command"}}});var i;var a;TS.i18n.deburr(t).replace(/^(\/\S*)$/i,function(e,n,r){a=r;i=t.substr(a,n.length)});if(!i)return;return{match:i,index:a}},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;var r=_.flatMap(t,"cmds");return _.find(r,{index:n})},getInsertData:function e(t){if(!t)return;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_select",trigger:"slash_command"}}});var n=t.name;return{text:n}},search:function t(n,r,i){var a=e(n,r);i(null,a)},render:function e(t,n){var r=TS.templates.tabcomplete_command_header({text:t});var i=TS.templates.tabcomplete_command_results({results:n});return TS.tabcomplete.renderMenu(r,i)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)}});function e(e,n){var r=t(n);var i=TS.i18n.deburr(e.toLowerCase());i=TS.tabcomplete.trimTrailingCharacterModifier(i);if(i)r=r.filter(function(e){if(0===(e.normalized||e.name).indexOf(i))return true;var t=e.localized_aliases||e.aliases;if(t)return t.some(function(e){var t=TS.i18n.deburr(e);return 0===t.indexOf(i)});return false});var a=_.map(r,"name");var s=TS.cmd_handlers.sortNames(a);var o;if(TS.boot_data.feature_last_command_in_tab_complete&&"/"===i&&TS.chat_history.getCommands().length){var l=TS.chat_history.getCommands()[0].trim();var u=l.split(" ")[0];var d=TS.cmd_handlers.getAvailableUserCmds()[u];var c=d?1:0;o=s.map(function(e,t){return _.assign({index:t+c,name:e},TS.cmd_handlers[e])});var m=l;if(TS.boot_data.feature_name_tagging_client){m=TS.format.texty.convertContentsStringToContents(l);m=TS.format.texty.convertContentsToStringForDisplay(m)}if(d){var f={name:m,index:0,type:"last"};o.unshift(f);var p=TS.cmd_handlers.groupCmdsByType(o);var h=TS.i18n.t("Last Used","command_tab_complete");p.unshift({name:h,id:"last",cmds:[f]});return p}return TS.cmd_handlers.groupCmdsByType(o)}o=s.map(function(e,t){return _.assign({index:t,name:e},TS.cmd_handlers[e])});return TS.cmd_handlers.groupCmdsByType(o)}function t(e){var t=TS.cmd_handlers.getAvailableUserCmds(e);var n=_.map(t,function(e,t){return _.assign({name:t},e)});return n}})()},3676:function(e,t){(function(){"use strict";TS.registerModule("tabcomplete.emoji",{type:"emoji",getMatch:function e(t,n){if(!_.isString(t))return;var r;var i;var a;if(TS.boot_data.feature_localization)a=/(^|\n|[^+-])([+-]?:[^~@#$%^&*()=[\]{}\\|;:",.<>/ ]*)$/i;else a=/(^|\n|[^+-])([+-]?:[\w\-+'’]*)$/i;TS.i18n.deburr(t).replace(a,function(e,n,a,s){var o=n[n.length-1];if(!TS.tabcomplete.isAllowedSurroundingCharacter(o))return;if(n.trim()&&/^[+-]/.test(a)){a=a.slice(1);s+=1}i=s+n.length;r=t.substr(i,a.length)});if(!r)return;if(!n)if(!l(r,TS.i18n.locale()))return;return{match:r,index:i}},shouldDisplayResults:function e(t,n,r){if(!t||_.isEmpty(n)||_.isEmpty(n.results))return false;if(1===n.results.length&&r)return false;return true},getResultAtIndex:function e(t,n){if(!t||!t.results||!_.isNumber(n))return;var r=t.results[n];if(!r)return;return{action:t.action,emoji:r}},getInsertData:function e(t){if(!t||!t.emoji)return;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"emoji"}}});var n=":"+(t.emoji.display_name||t.emoji.name)+":";if(t.emoji.is_skin){var r=!!TS.boot_data.feature_localization;n+=TS.emoji.getChosenSkinToneModifier(r)||""}if("add_rxn"===t.action)n="+"+n;else if("remove_rxn"===t.action)n="-"+n;return{text:n}},getNextSelectedIndex:function e(a){var s;switch(a.keyCode){case TS.utility.keymap.right:s="right";break;case TS.utility.keymap.left:s="left";break;case TS.utility.keymap.up:s="up";break;case TS.utility.keymap.down:s="down"}if(!s)return;var o=t(a.menu);if(1===o.length)return 0;if("right"===s)return a.selectedIndex<o.length-1?a.selectedIndex+1:0;if("left"===s)return a.selectedIndex>0?a.selectedIndex-1:o.length-1;if(a.keyCode===TS.utility.keymap.home||"up"===s&&a.metaKey)return 0;if(a.keyCode===TS.utility.keymap.end||"down"===s&&a.metaKey)return o.length-1;if(!TS.boot_data.feature_tinyspeck)return;var l=_.map(o,function(e,t){var r=n(e);r.index=t;return r});var u=l[a.selectedIndex];var d=r(u,l,"down"===s);var c=i(u,d);if(!c){if("down"===s)return o.length-1;if("up"===s)return 0}return c.index},search:function t(n,r,i){var o=/^(\+|-):/.test(n)?n[0]:"";var l=r.index;n=TS.emoji.normalizeSearchTerm(n);n=TS.tabcomplete.trimTrailingCharacterModifier(n);var u=a(n);var d;if(0===l&&o){var c=TS.shared.getActiveModelOb();var m=e(c);if("-"===o){var f;if(TS.boot_data.feature_tinyspeck)f=s(n,m);else f=u;if(!_.isEmpty(f))d={action:"remove_rxn",results:f}}else if("+"===o){var p;if(TS.boot_data.feature_tinyspeck)p=_.difference(u,m);else p=u;if(!_.isEmpty(p))d={action:"add_rxn",results:p}}}else d={action:"search",results:u};if(d&&!d.results.length)d=null;i(null,d)},render:function e(t,n){var r=TS.templates.tabcomplete_emoji_header({text:t,action:n.action});var i=_.map(n.results,function(e){return o(e,n.action)});var a=TS.templates.tabcomplete_emoji_results({results:i});return TS.tabcomplete.renderMenu(r,a)},onSelect:function e(t,n){if(!t||!t.emoji)return;if(!n)n="";n=n.replace(/^:/,"");TS.ui.frecency.record(t.emoji,n)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},test:function n(){var r={};Object.defineProperty(r,"_getResultElements",{get:function e(){return t},set:function e(n){t=n}});Object.defineProperty(r,"_getLocalResults",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(r,"_getPrevMsgRxns",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(r,"_sortResults",{get:function e(){return s},set:function e(t){s=t}});return r}});var e=function e(t){var n=TS.utility.msgs.getDisplayedMsgs(t.msgs);var r=_.find(n,function(e){return!e.is_ephemeral});if(!r)return;var i=TS.rxns.getMemberRxnsFromMessage(r,TS.model.user.id);var a=_.map(i,function(e){var t=e.name.replace(/(:.+)$/,"");return TS.emoji.getEmojiByName(t)});return _.compact(a)};var t=function e(t){if(!t)return[];return _.toArray(t.querySelectorAll(".tab_complete_ui_item"))};var n=function e(t){var n=t.offsetLeft;return{left:n,right:n+t.offsetWidth,top:t.offsetTop}};var r=function e(t,n,r){if(!t||!n||!n.length)return;var i=_.groupBy(n,"top");var a=_.map(_.keys(i),_.toNumber);var s=a.indexOf(t.top);var o=r?s+1:s-1;var l=a[o];return i[l]};var i=function e(t,n){if(!t||!n||!n.length)return;var r=n.filter(function(e){if(_.inRange(e.left,t.left,t.right))return true;if(_.inRange(e.right,t.left,t.right))return true;if(e.left<t.left&&e.right>t.right)return true;return false});if(!r)return;var i=_.maxBy(r,function(e){var n=Math.max(e.left,t.left);var r=Math.min(e.right,t.right);return r-n});return i};var a=function e(t){return s(t,TS.model.emoji_map)};var s=function e(t,n){if(!n||!n.length)return[];var r={emoji:n};var i={allow_empty_query:true,frecency:true,limit:50,prefer_exact_match:true};var a=t.replace(/^(\+|-)?:/,"");n=TS.sorter.search(a,r,i);return _.map(n,"model_ob")};var o=function e(t){var n=":"+(t.display_name||t.name)+":";var r={emoji_is_plain_text_only:"as_text"===TS.model.prefs.emoji_mode,emoji:t,emoji_display_name_with_colons:n};if(t.is_skin){r.show_skin_tone_variant=t.is_skin;r.emoji_name_with_colons_and_skin=t.name_with_colons+TS.emoji.getChosenSkinToneModifier();var i=!!TS.boot_data.feature_localization;r.emoji_display_name_with_colons_and_skin=n+TS.emoji.getChosenSkinToneModifier(i)}return r};var l=function e(t,n){switch(n){case"ja-JP":return t.length>=2;default:return t.length>=3}}})()},3677:function(e,t){(function(){"use strict";TS.registerModule("tabcomplete.members",{type:"members",getMatch:function e(t,n,r,i){var a;var s;var o=/(^|\n|.)?(@[^\s\n@]*)$/i;if(TS.boot_data.feature_name_tagging_client)o=/(^|\n|.)?((?:@|\uFF20)[^\n@\uFF20]*)$/i;t.replace(o,function(e,t,n,r){var o=TS.tabcomplete.isAllowedSurroundingCharacter(t)||i&&i.allowed_preceding_symbols&&-1!==i.allowed_preceding_symbols.indexOf(t);if(!o)return;if(t)r+=t.length;a=n;s=r});if(!a&&(!TS.model.prefs.require_at||n)){var l;if(TS.boot_data.feature_name_tagging_client)l=_.last(/(^|\s)([^\s\n@\uFF20]+)$/.exec(t));else l=_.last(/(^|\s)([^\s\n@]+)$/.exec(t));l=TS.tabcomplete.trimSurroundingSymbols(l);if(c(l,n)){a=l;s=t.length-l.length}}if(!a)return;return{match:a,index:s}},shouldDisplayResults:function e(t,n){if(!t||_.isEmpty(n))return false;if(TS.boot_data.feature_name_tagging_client)return true;var r=1===n.length&&g(t,n[0]);return!r},getResultAtIndex:function e(t,n){if(!t||!_.isNumber(n))return;return t[n]},getInsertData:function e(t,n){if(!t)return;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"member"}}});var r=n&&n.length&&0===n.indexOf("@");if(TS.boot_data.feature_name_tagging_client)r=n&&n.length&&(0===n.indexOf("@")||0===n.indexOf("＠"));var i=TS.tabcomplete.members.getDisplayTextForResult(t,r);if(TS.client&&TS.client.msg_input&&TS.utility.contenteditable.hasFocus(TS.client.msg_input.$input)&&-1===["@everyone","@channel","@here"].indexOf(i)){var a=TS.shared.getActiveModelOb();if(!TS.client.msg_input.tabcomplete_completions[a.id])TS.client.msg_input.tabcomplete_completions[a.id]=[];if(-1===TS.client.msg_input.tabcomplete_completions[a.id].indexOf(i))TS.client.msg_input.tabcomplete_completions[a.id].push(i.substring(1))}if(TS.boot_data.feature_texty_mentions){var s=TS.format.texty.shouldHighlightMention(t.id,i);return{text:i,format:{slackmention:{id:t.id,label:i,mention:s}}}}return{text:i}},getDisplayTextForResult:function e(t,n){if(t.is_broadcast_keyword)return"@"+t.name;else if(t.is_usergroup)return"@"+t.handle;return p(t,n)},search:function n(r,i,u){var d=f(r,i.isUserSolicited);var c=m(d);var p;if(!i.no_model_ob)p=i.model_ob||TS.shared.getActiveModelOb();var g=l(p,i.no_model_ob);var S=TS.user_groups.getActiveUserGroups();var T;if(i.complete_member_specials)T=TS.tabcomplete.members.getBroadcastKeywords(i.complete_member_specials);var v=a(p,r,{members:g,usergroups:S,broadcast_keywords:T});c(function(){u(null,v)});if(p){var b=_(g).map("id").without("USLACKBOT").value();if(b.length>e){var y=TS.boot_data.page_needs_enterprise?"W":"U";var w=TS.ui.frecency.getMostCommonWithPrefix(y,e);var k=_.map(w,"id");var x=_.intersection(b,k);var C=_.difference(b,x);b=x.concat(C.slice(0,e-x.length))}TS.log(1990,"Ensuring we have membership for "+b.length+" users in "+p.id+": "+b);TS.membership.ensureChannelMembershipIsKnownForUsers(p.id,b).then(function(e){TS.log(1990,"Got membership for "+b.length+" users in "+p.id+"; any fetches required? "+e);if(e)c(function(){u(null,v)})});if(TS.apps.permissions.areXoxaAppsInstalled())TS.apps.permissions.ensureAppResourceMembershipIsKnown(p.id).then(function(e){if(e)c(function(){u(null,v)})})}if(o(r,g,i)){var M=s(p,r,t);M.then(function(e){var t=_(g).concat(e).compact().uniqBy("id").value();var n=a(p,r,{members:t,usergroups:S,broadcast_keywords:T});var i=[];if(p){var s=_.filter(n,"is_usergroup");i=_.reduce(s,function(e,t){var n=TS.user_groups.ensureUserGroupMembersInModelObNumIsKnown(t.id,p.id);if(!n.isResolved())e.push(n);return e},[]);TS.membership.ensureChannelMembershipIsKnownForUsers(p.id,_.map(n,"id"))}if(i.length)Promise.all(i).then(function(){c(function(){u(null,n)})});else if(!h(v,n))c(function(){u(null,n)});return null})}},render:function e(t,n,r){if("@"!==t[0])t="@"+t;var i=TS.templates.tabcomplete_member_header({text:t});var a;if(!r.no_model_ob)a=r.model_ob||TS.shared.getActiveModelOb();var s=n.map(function(e){if(e.is_broadcast_keyword)return e;if(e.is_usergroup)return d(a,e);return u(a,e,t)});var o=TS.templates.tabcomplete_member_results({results:s,is_client:!!TS.client});return TS.tabcomplete.renderMenu(i,o)},onSelect:function e(t,n){if(!t)return;if(!n)n="";n=n.replace(/^@/,"");TS.ui.frecency.record(t,n)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},getBroadcastKeywords:function e(t){var n=TS.utility.members.getBroadcastKeywordsForUser();if(_.isArray(t))n=n.filter(function(e){return-1!==t.indexOf(e.id)});return n},test:function e(){var t={IGNORED_SEARCH_TERMS:n,MIN_UNPREFIXED_MATCH_LENGTH:r};Object.defineProperty(t,"IGNORED_SEARCH_TERMS",{get:function e(){return n},set:function e(t){n=t}});Object.defineProperty(t,"_shouldDoAsyncSearch",{get:function e(){return o},set:function e(t){o=t}});Object.defineProperty(t,"_getLocalMembers",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(t,"_sortResults",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"SEARCH_DELAY_MS",{get:function e(){return i},set:function e(t){i=t}});return t}});var e=100;var t=25;var n=["the","and"];var r=3;var i=500;var a=function e(n,r,i){var a={allow_empty_query:true,frecency:true,limit:t,prefer_exact_match:true};var s=n&&!n.is_im;if(s){a.model_ob=n;a.prefer_channel_members=s}var o=r.replace(/^@/,"");var l=TS.boot_data.feature_name_tagging_client?_.trimEnd(o):o;var u=TS.sorter.search(l,i,a);var d=_.map(u,"model_ob");var c=S(o,d);return c};var s=function e(t,n,r){var i={query:n.replace(/^@/,""),max_api_results:r,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false,limit_by_model_relevancy:t};if(t&&!t.is_im)i.determine_membership_for_channel=t.id;return TS.members.promiseToSearchMembers(i).then(function(e){if(!e||!e.items||!e.items.length)return[];return e.items})};var o=function e(t,i,a){if(0!==t.indexOf("@")){if(-1!==n.indexOf(t))return false;if(t.length<r)return false;if(a.member_prefix_required)return false;if(TS.model.prefs.require_at)return false}if(i&&i.length)if(1===i.length&&"@"+i[0].name===t)return false;return true};var l=function e(t,n){var r=TS.members.getActiveMembersWithSelfAndSlackbot();if(!n)r=r.filter(function(e){return TS.utility.members.isMemberRelevantToModel(e,t)});return r};var u=function e(t,n){var r=[];var i=[];var a;var s;if(TS.boot_data.feature_name_tagging_client){a=TS.members.getPrefCompliantMemberName(n,false,false);s=TS.members.getMemberSecondaryName(n);r.push("primary_name");i.push("secondary_name")}else{r.push("username");i.push("realname");a=n.name;s=TS.members.getMemberRealName(n)}var o=t&&!t.is_im;var l;var u;var d;if(n.is_app_user){d=TS.apps.permissions.getAppUserResourceMembershipStatus(n.id,t.id);u=d.is_known;l=!d.is_member}else if(o){d=TS.membership.getUserChannelMembershipStatus(n.id,t);u=d.is_known;if(u)l=!d.is_member}var c;if(TS.boot_data.feature_shared_channels_client&&TS.utility.teams.isMemberExternal(n)){var _=TS.teams.getTeamById(n.team_id);if(_&&_.name)c=_.name}return{is_member:true,member:n,primary_name_classes:r.join(" "),secondary_name_classes:i.join(" "),show_channel_membership:o,member_does_not_belong_to_channel:l,secondary_name:s,primary_name:a,membership_status_is_known:u,team_name:c}};var d=function e(t,n){var r=0;if(t)r=TS.user_groups.getUserGroupMembersNotInModelObCount(n.id,t.id);return{description:n.description||n.name,is_usergroup:true,members_not_in_channel:r,usergroup:n}};var c=function e(t,i){if(!t)return false;if(i)return true;if(t.length<r)return false;if(_.includes(n,t.toLowerCase()))return false;return true};var m=function e(t){var n=Date.now()+t;return function(e){var t=Date.now();var r=Math.max(0,n-t);setTimeout(e,r)}};var f=function e(t,n){if(0===t.indexOf("@"))return 0;if(n)return 0;return i};var p=function e(t,n){var r=t.name;if(TS.boot_data.feature_name_tagging_client)r=TS.members.getPrefCompliantMemberName(t);else if(TS.boot_data.feature_shared_channels_client&&TS.utility.teams.isMemberExternal(t)){var i=TS.teams.getTeamById(t.team_id);var a=t.team_id;if(i&&i.domain)a=i.domain;r+="+"+a;if(!i)TS.console.warn("team "+t.team_id+" not in local model so not avail for tabcomplete")}var s=TS.model.team.prefs.require_at_for_mention||TS.model.prefs.require_at;if(n||s)r="@"+r;return r};var h=function e(t,n){if(!n&&!t)return true;if(!n||!t)return false;if(t.length!==n.length)return false;return _.isEqualWith(t,n,function(e,t){return e.id===t.id})};var g=function e(t,n){var r=t.replace(/^@/,"").toLowerCase();return n.name===r};var S=function e(t,n){if(!Array.isArray(n))return n;if(!TS.model.prefs.require_at&&"you"===t)return n.filter(function(e){return e.id!==TS.model.user.id});return n}})()},3678:function(e,t){(function(){"use strict";TS.registerModule("tabcomplete",{positionUIRelativeToInput:function e(t,n,r){if(!t||!n)return;var i=$(n).offset();t.style.left=i.left+"px";var a;if(r){var s=i.top+$(n).height()+2;t.style.top=s+"px";a=$(window).height()-s}else{t.style.bottom=$(window).height()-i.top+"px";a=i.top}var o=_.clamp(a-$(t).find(".tab_complete_ui_header").outerHeight()-2,454);$(t).find(".tab_complete_ui_scroller").css("maxHeight",o+"px")},render:function e(t,n,r,i){switch(t){case"members":return TS.tabcomplete.members.render(n,r,i);case"commands":return TS.tabcomplete.commands.render(n,r,i);case"emoji":return TS.tabcomplete.emoji.render(n,r,i);case"channels":return TS.tabcomplete.channels.render(n,r,i);default:TS.warn('TS.tabcomplete: unknown render type "'+t+'"')}},renderMenu:function e(t,n){return TS.templates.tabcomplete_menu({safe_header_html:new Handlebars.SafeString(t),safe_results_html:new Handlebars.SafeString(n)})},onSelectedIndexChange:function e(t){var n=$(".tab_complete_ui_item");n.removeClass("active");n.eq(t).addClass("active");n.eq(t).scrollintoview({duration:0})},isAllowedSurroundingCharacter:function e(t){if(!t||!t.trim())return true;return""===TS.tabcomplete.trimSurroundingSymbols(t)},trimSurroundingSymbols:function e(n){if(!n)return"";return n.replace(t,"")},trimTrailingCharacterModifier:function e(t){if(!t)return"";return t.replace(n,"")},test:function t(){return{ALLOWED_PRECEDING_SYMBOLS:e}}});var e=["{","[","(","*","_","/",'"',"“","'","‘","<"];var t=function(e){var t=e.map(function(e){return"\\"+e});return new RegExp("^("+t.join("|")+")+","g")}(e);var n=/[`´ˆ¨˜]$/})()},3690:function(e,t){(function(){"use strict";TS.registerModule("utility.url",{isValidSlackWebSocketUrl:function e(t){var n=TS.utility.url.getHostName(t);if("dev"===TS.boot_data.version_ts&&"localhost"===n)return true;return/\.slack-msgs.com$/.test(n)},getHostName:function e(t,n){var r=TS.utility.url.parseUrl(t).hostname||"";if(!r){if(TS.console)TS.console.warn('getHostName: no hostname found for URL "'+t+'" / '+r);return r}if(r&&n){var i=r.split(".");if(i.length>2)r=i.slice(i.length-2).join(".")}return r},parseUrl:function e(t){if(!t)return{};var n=document.createElement("a");n.href=t;return{hash:n.hash,hostname:n.hostname,pathname:n.pathname,protocol:n.protocol,search:n.search}},setUrlQueryStringValue:function e(t,n,r){var i=document.createElement("a");i.href=t;var a=i.search?i.search.slice(1):"";i.search=TS.utility.url.setQueryStringValue(a,n,r);return i.href},removeUrlQueryStringValue:function e(t,n){var r=document.createElement("a");r.href=t;if(!r.search)return t;var i=r.search.slice(1);r.search=TS.utility.url.removeQueryStringValue(i,n);return r.href},urlQueryStringParse:function e(t){var n=document.createElement("a");n.href=t;if(!n.search)return{};var r=n.search?n.search.slice(1):"";return TS.utility.url.queryStringParse(r)},queryStringParse:function e(t){var n={};var r;r=t.split("&");for(var i=0;i<r.length;i+=1){var a=r[i].indexOf("=");if(-1!=a){var s=r[i].substring(0,a);var o=r[i].substring(a+1);n[s]=unescape(o)}else if(r[i].length)n[r[i]]=""}return n},setQueryStringValue:function e(t,n,r){var i=TS.utility.url.queryStringParse(t);i[n]=r;return TS.utility.url.queryStringEncode(i)},removeQueryStringValue:function e(t,n){var r=TS.utility.url.queryStringParse(t);if(!r.hasOwnProperty(n))return t;delete r[n];return TS.utility.url.queryStringEncode(r)},queryStringEncode:function e(t){if(!t)return"";if(0==Object.keys(t).length)return"";var n=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])});return"?"+n.join("&")},simpleIsUrl:function e(t){var n=false;var r;var i;if(-1!==t.indexOf(" "))return n;r=document.createElement("a");r.href=t;if(r.protocol&&r.hostname&&r.pathname&&window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"/"+t!=r.href){i=/[a-z0-9]+\.[a-z0-9]+/i;n=i.test(r.hostname);if(-1==r.hostname.indexOf(".")&&"localhost"===r.hostname)n=true}return n}})})()},3883:function(e,t){(function(){"use strict";TS.registerComponent("ui.CurrentStatusInput",{_constructor:function e(t){this._onSave=t.onSave;this._onEscape=t.onEscape;this._onError=t.onError;this._$container=t.$parent.find(".current_status_input_container").addBack(".current_status_input_container");this._$emoji_input=t.$parent.find('[name="status_emoji"]');this._$inline_saver=t.$parent.find(".current_status_inline_saver");this._$input=t.$parent.find(".current_status_input");this._$action_buttons=t.$parent.find(".current_status_action_buttons");this._$cancel_button=this._$action_buttons.find(".current_status_cancel_button");this._$save_button=this._$action_buttons.find(".current_status_save_button");this._$status_emoji_picker=t.$parent.find(".current_status_emoji_picker");this._$status_clear_icon=t.$parent.find(".status_clear_icon");this._$status_clear_icon_wrap=t.$parent.find(".status_clear_icon_wrap");this._$presets_list=t.$parent.find(".current_status_presets");this._has_form_context=t.has_form_context;this._has_presets_menu=t.has_presets_menu;this._preset_index=t.preset_index;this._is_preset_editor=_.isNumber(this._preset_index);this._selected_emoji=this._getOriginalStatus().emoji;this._bindFunctions();this._bindEvents();this._toggleStatusClearIcon();if(TS.boot_data.feature_texty_takes_over)this._startTexty();else this._startTabComplete();TS.ui.validation.validate(this._$input)},destroy:function e(){if(this._$input)if(TS.boot_data.feature_texty_takes_over)TS.utility.contenteditable.unload(this._$input);else this._$input.TS_tabComplete("destroy");this._unbindEvents();this._$container=null;this._$emoji_input=null;this._$inline_saver=null;this._$input=null;this._$action_buttons=null;this._$cancel_button=null;this._$save_button=null;this._$status_clear_icon=null;this._$status_clear_icon_wrap=null;this._$status_emoji_picker=null;this._$presets_list=null;this._has_form_context=null;this._has_presets_menu=null;this._selected_emoji=null;this._preset_index=null;this._is_preset_editor=null;this._onSave=null;this._onEscape=null;this._onError=null},focus:function e(){if(this._$input&&this._$input.length)TS.utility.contenteditable.setCursorAtEnd(this._$input)},getEscapedInputText:function e(){return _.escape(TS.emoji.maybeGetCanonicalEmojiString(TS.utility.contenteditable.value(this._$input).replace(/\t/g," ").trim()))},hasText:function e(){return!TS.utility.contenteditable.isEmpty(this._$input,true)},hasNewText:function e(){return this.getEscapedInputText()!==this._getOriginalStatus().text},isEdited:function e(){return this.hasNewText()||this._selected_emoji!==this._getOriginalStatus().emoji},isSaveable:function e(){return this.isEdited()},onEmojiSelected:function e(t){t=t||"";this._selectEmoji(t);this._toggleActionButtons();this._toggleStatusClearIcon();this.focus()},onTabComplete:function e(t,n){TS.utility.populateInput(this._$input,t,n);TS.ui.validation.validate(this._$input)},_bindFunctions:function e(){this._onFocus=this._onFocus.bind(this);this._onCancel=this._onCancel.bind(this);this._onKeydown=this._onKeydown.bind(this);this._onKeyup=this._onKeyup.bind(this);this._onBodyClick=this._onBodyClick.bind(this);this.clearCurrentStatus=this.clearCurrentStatus.bind(this);this._openEmojiPicker=this._openEmojiPicker.bind(this);this._presetChosen=this._presetChosen.bind(this);this._editCurrentStatus=this._editCurrentStatus.bind(this);this.onEmojiSelected=this.onEmojiSelected.bind(this);this.onTabComplete=this.onTabComplete.bind(this)},_bindEvents:function e(){if(!TS.boot_data.feature_texty_takes_over)this._$input.on("focus.ui_current_status_input",this._onFocus);this._$input.on("keydown.ui_current_status_input",this._onKeydown);this._$input.on("keyup.ui_current_status_input",this._onKeyup);this._$status_emoji_picker.on("click.ui_current_status_input",this._openEmojiPicker);this._$status_clear_icon.on("click.ui_current_status_input",this.clearCurrentStatus);this._$cancel_button.on("click.ui_current_status_input",this._onCancel);this._$save_button.on("click.ui_current_status_input",this._editCurrentStatus);if(!this._has_presets_menu)this._$presets_list.on("click.ui_current_status_input",".current_status_preset_option",this._presetChosen)},_unbindEvents:function e(){if(this._$input)this._$input.off(".ui_current_status_input");if(this._$status_clear_icon)this._$status_clear_icon.off(".ui_current_status_input");if(!this._has_presets_menu)this._$presets_list.off(".ui_current_status_input");if(this._$status_emoji_picker&&this._$status_emoji_picker.length)this._$status_emoji_picker.off(".ui_current_status_input");if(this._$cancel_button&&this._$cancel_button.length)this._$cancel_button.off(".ui_current_status_input");if(this._$save_button&&this._$save_button.length)this._$save_button.off(".ui_current_status_input");this._maybeRemoveBodyClickHandler()},_getOriginalStatus:function e(){var t=this._is_preset_editor?TS.model.team.prefs.custom_status_presets[this._preset_index][0]:TS.members.getMemberCurrentStatus(TS.model.user).emoji;var n=this._is_preset_editor?TS.model.team.prefs.custom_status_presets[this._preset_index][1]:TS.members.getMemberCurrentStatus(TS.model.user).text;return{emoji:t,text:n}},_selectEmoji:function e(t){this._selected_emoji=t||"";this._$emoji_input.val(this._selected_emoji);this._$status_emoji_picker.find(".current_status_empty_emoji").toggleClass("hidden",!!this._selected_emoji);this._$status_emoji_picker.find(".current_status_emoji").html(TS.format.formatCurrentStatus(this._selected_emoji,void 0,{stop_animations:true,transform_missing_emoji:true,ignore_emoji_mode_pref:"as_text"===TS.model.prefs.emoji_mode}))},_startTabComplete:function e(){var n=this._$input;var r=n.tab_complete_ui.bind(n,{id:"current_status_input_tab_complete_ui",min_width:t});var i={complete_emoji:true,complete_members:false,ui_initer:r,onComplete:this.onTabComplete};this._$input.TS_tabComplete(i)},_onCancel:function e(){if(!this._has_form_context){this._maybeRemoveBodyClickHandler();this._restoreCurrentStatus();TS.utility.contenteditable.blur(this._$input);this._maybeHidePresetsMenu();if(_.isFunction(this._onEscape))this._onEscape(this._getOriginalStatus())}},_onFocus:function e(t){if(!this.isEdited()||this._getSelectedPresetIndex()>-1||!(this.hasText()||this._selected_emoji))this._maybeShowPresetsMenu(t);this._maybeAddBodyClickHandler()},_onBodyClick:function e(t){if(TS.ui.react_emoji_menu.is_showing)return;if($.contains(this._$container.get(0),t.target))return;if(!TS.boot_data.feature_texty_takes_over&&(this._$input.tab_complete_ui("isShowing")||this._$input.tab_complete_ui("wasJustHidden")))return;this._onCancel()},_onKeydown:function e(t){if(TS.boot_data.feature_texty_takes_over){if(t.which===TS.utility.keymap.enter)t.stopPropagation();else if(t.which===TS.utility.keymap.tab)t.stopPropagation();else if(t.which===TS.utility.keymap.esc){t.stopPropagation();t.preventDefault()}}else if(!TS.ui.react_emoji_menu.is_showing)if(t.which===TS.utility.keymap.enter&&!this._$input.tab_complete_ui("isShowing")&&this.isSaveable()){t.stopPropagation();this._editCurrentStatus()}else if(t.which===TS.utility.keymap.tab&&this._$input.tab_complete_ui("isShowing"))t.stopPropagation();else if(t.which===TS.utility.keymap.esc){t.stopPropagation();t.preventDefault();if(!this._$input.tab_complete_ui("isShowing"))this._onCancel()}},_onKeyup:function e(t){if([TS.utility.keymap.enter,TS.utility.keymap.esc,TS.utility.keymap.tab].indexOf(t.which)>-1)return;this._toggleStatusClearIcon();this._toggleActionButtons();if(this.isEdited())this._maybeHidePresetsMenu();else this._maybeShowPresetsMenu(t)},_maybeShowPresetsMenu:function e(t){if(this._has_presets_menu){TS.menu.startWithList(t,this._$presets_list,{onClick:this._presetChosen,close_on_click:true,ignore_bounds:true,attach_to_target_at_full_width:true,keep_menu_open_if_target_clicked_again:true});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)}},_maybeHidePresetsMenu:function e(){if(this._has_presets_menu&&TS.model.menu_is_showing)TS.menu.end()},_maybeAddBodyClickHandler:function e(){if(!this._has_form_context&&this._has_presets_menu)TS.utility.rAF(function(){$("body").on("click.ui_current_status_input",this._onBodyClick)}.bind(this))},_maybeRemoveBodyClickHandler:function e(){if(!this._has_form_context&&this._has_presets_menu)$(document.body).off(".ui_current_status_input")},_maybeGetCanonicalStatus:function e(t){if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)return TSFEmoji.translateEmojiStringToCanonical(t,TS.i18n.locale());return t},_getLocalizedStatus:function e(t){if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)return TSFEmoji.translateEmojiStringToLocal(t,TS.i18n.locale());return t},_openEmojiPicker:function e(t){var i=$(t.target).closest(".current_status_emoji_picker").dimensions_rect();var a=!this._has_presets_menu;TS.ui.react_emoji_menu.start({e:t,callback:this.onEmojiSelected,position:a?"bottom-left":"top-left",offset_y:a?r:n,target_bounds:i})},_toggleActionButtons:function e(){this._$action_buttons.toggleClass("invisible",!this.isSaveable()||!this.hasText()&&!this._selected_emoji)},_toggleStatusClearIcon:function e(){this._$status_clear_icon_wrap.toggleClass("hidden",!this._selected_emoji&&!this.hasText())},_presetChosen:function e(t){var n=$(t.target).closest(".current_status_preset_option");var r=n.data("text")||"";var i=n.data("emoji")||"";TS.utility.contenteditable.value(this._$input,TS.emoji.maybeGetLocalizedEmojiString(TS.format.unFormatMsg(r)));this._selectEmoji(i);this._toggleStatusClearIcon();this._editCurrentStatus()},clearCurrentStatus:function e(){TS.utility.contenteditable.clear(this._$input);TS.ui.validation.validate(this._$input);this._selectEmoji("");this._toggleStatusClearIcon();this._toggleActionButtons();this._editCurrentStatus()},clogStatusChange:function t(n,r,i){var a={custom_status_set_origin:i};if(!n&&!r){a.custom_status="UNKNOWN";TS.clog.track("CUSTOM_STATUS_CLEAR",a);return}var s=this._getSelectedPresetIndex(n,r);if(s>-1)a.custom_status=TS.model.team.prefs.uses_customized_custom_status_presets?"ADMIN_PRESET":e[s];else a.custom_status="USER_DEFINED";a.custom_status_text=n;a.custom_status_emoji=r;TS.clog.track("CUSTOM_STATUS_SET",a)},clogPresetChange:function e(t,n){TS.clog.track("CUSTOM_STATUS_ADMIN_PRESET_SET",{custom_status_text:t,custom_status_emoji:n,custom_status_preset:"ADMIN_PRESET_"+(this._preset_index+1)})},_getSelectedPresetIndex:function e(t,n){if(_.isUndefined(t))t=this.getEscapedInputText();if(_.isUndefined(n))n=this._selected_emoji;var r=TS.team.getTeamCustomStatusPresets();var i=_.findIndex(r,function(e){return e.text===t});var a=_.findIndex(r,function(e){return e.emoji===n});return i>-1&&i===a?i:-1},_restoreCurrentStatus:function e(){var t=this._getOriginalStatus();TS.utility.contenteditable.value(this._$input,TS.emoji.maybeGetLocalizedEmojiString(TS.format.unFormatMsg(t.text)));TS.ui.validation.validate(this._$input);this._selectEmoji(t.emoji);this._toggleStatusClearIcon();this._toggleActionButtons()},_editCurrentStatus:function e(){if(this._has_form_context)return Promise.resolve();if(!TS.ui.validation.validate(this._$input,{quiet:true,fast:true})){TS.ui.validation.validate(this._$input);return Promise.resolve()}if(!this.isSaveable())return Promise.resolve();this._maybeRemoveBodyClickHandler();var t=TS.emoji.maybeGetCanonicalEmojiString(TS.utility.contenteditable.value(this._$input).replace(/\t/g," ").trim());var n=this.getEscapedInputText();var r=this._selected_emoji||t&&TS.model.team.prefs.custom_status_default_emoji;var i;if(this._has_presets_menu)i="FLEXPANE_PROFILE";else if(!this._has_form_context)i="TEAM_MENU";if(!TS.boot_data.feature_texty_takes_over)this._$input.val("").val(TS.emoji.maybeGetLocalizedEmojiString(TS.format.unFormatMsg(n)));var a;if(this._is_preset_editor)a=new Promise(function(e,n){return TS.prefs.setTeamPrefByAPI({custom_status_presets:this._getUpdatedPresets(t,this._selected_emoji)},n,["uses_customized_custom_status_presets"]).then(e)}.bind(this));else{var s={profile:JSON.stringify({status_text:t,status_emoji:this._selected_emoji})};a=TS.api.call("users.profile.set",s)}a.then(function(){if(this._is_preset_editor)this.clogPresetChange(n,r);else this.clogStatusChange(n,r,i)}.bind(this),function(e){if(_.isFunction(this._onError))this._onError(this._getOriginalStatus());if(e&&e.data&&"ratelimited"===e.data.error)TS.generic_dialog.alert(TS.i18n.t("You’re changing your status too often! You might have better luck if you try again in a few minutes.","current_status")());else TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","current_status")());if(this._$input)this._restoreCurrentStatus();return e}.bind(this));TS.ui.inline_saver.show({target:this._$inline_saver,promise:a});if(_.isFunction(this._onSave))this._onSave({text:n,emoji:r});return a},_startTexty:function e(){var t=this._editCurrentStatus;var n=this._onCancel;var r=this._onFocus;var i=this._$input;var a=this._is_preset_editor?TS.i18n.t("e.g. Gone to lunch","current_status")():TS.i18n.t("What’s your status?","current_status")();TS.utility.contenteditable.create(i,{modules:{tabcomplete:{completers:[TS.tabcomplete.emoji],positionMenu:function e(t){t.style.width=i.outerWidth()+"px";t.style.minWidth=0;TS.tabcomplete.positionUIRelativeToInput(t,i)}}},singleLineInput:true,placeholder:a,onFocus:function e(){r(jQuery.Event("focus",{target:i,currentTarget:i}))},onEnter:function e(){t();return false},onEscape:function e(){n();return false},onTextChange:function e(){TS.ui.validation.validate(i)}});TS.utility.contenteditable.value(i,TS.emoji.maybeGetLocalizedEmojiString(TS.format.unFormatMsg(this._getOriginalStatus().text)));TS.utility.contenteditable.enable(i)},_getUpdatedPresets:function e(t,n){var r=[];var i=TS.model.team.prefs.custom_status_presets;var a=i.slice(0,this._preset_index);var s=[n,t];var o=i.slice(this._preset_index+1);r=a;r.push(s);return r.concat(o)}});var e=["IN_A_MEETING","COMMUTING","OUT_SICK","VACATIONING","WORKING_REMOTELY"];var t=400;var n=-5;var r=5})()},4187:function(e,t){(function(){"use strict";TS.registerModule("presence_manager",{sub_list_changed:new signals.Signal,onStart:function e(){i=true;p=TS.utility.enableFeatureForUser(1);if(o.length)b();if(l.length)y();if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.disconnectedSig.add(k);TS.interop.SocketManager.connectedSig.add(w)}else{TS.ms.disconnected_sig.add(k);TS.ms.connected_sig.add(w)}},addPresenceList:function e(t){if(-1===a.indexOf(t)){a.push(t);t.added_sig.add(g);t.removed_sig.add(S)}},removePresenceList:function e(t){if(a.indexOf(t)>-1){a.splice(a.indexOf(t),1);t.added_sig.remove(g);t.removed_sig.remove(S)}},createNewPresenceList:function e(t){return new TS.PresenceList(t)},isSubscribedToMember:function e(t){return o.indexOf(t)>=0},queryMemberPresence:function e(t){if(_.isArray(t))t.forEach(function(e){h(e)});else h(t);y()},periodicallyCheckPresenceConsistency:function e(t){if(_.isUndefined(t))t=1e3;if(c){clearInterval(c);c=null}c=setInterval(x,t)},stopCheckingPresenceConsistency:function e(){if(c)clearInterval(c);c=null},getSubList:function e(){return o.slice()},test:function e(){var t={getSubObject:function e(){var t={};var n;for(n in s)if(s[n])t[n+" "+TS.members.getMemberById(n).name]=s[n];return t},getSubList:function e(){return o}};Object.defineProperty(t,"_is_first_connection",{get:function e(){return f},set:function e(t){f=t}});Object.defineProperty(t,"_handleConnect",{get:function e(){return w},set:function e(t){w=t}});Object.defineProperty(t,"_addMemberToQueryList",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(t,"_sendSubList",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(t,"_sendQueryList",{get:function e(){return y},set:function e(t){y=t}});return t}});var e="USLACKBOT";var t=1e3;var n=1300;var r=1300;var i=false;var a=[];var s={};var o=[];var l=[];var u=false;var d=false;var c;var m=false;var f=true;var p=false;var h=function e(t){if(o.indexOf(t)>-1)return;if(l.indexOf(t)>-1)return;l.push(t)};var g=function e(t){if(!_.isArray(t))t=[t];t.forEach(function(e){T(e)})};var S=function e(t){if(!_.isArray(t))t=[t];t.forEach(function(e){v(e)})};var T=function t(n){if(n===e)return;if(s[n])s[n]+=1;else{s[n]=1;o.push(n);b()}return null};var v=function e(t){if(s[t]){s[t]-=1;if(!s[t]){var n=o.indexOf(t);o.splice(n,1);b()}}return null};var b=function e(){if(!i||0===o.length||u)return null;var t=TS.isSocketManagerEnabled()?TS.interop.SocketManager.isConnected():TS.model.ms_connected;if(!t)return;u=true;Promise.resolve().then(function(){u=false;if(p)TS.metrics.count("presence_manager",o.length);if(o&&o.length>n){if(!m){TS.console.logError({},"presence_sub_list_too_long","List length is "+o.length);m=true}o=o.slice(0,n)}var e={type:"presence_sub",ids:o};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.send(e);else TS.ms.send(e);TS.presence_manager.sub_list_changed.dispatch();return null})};var y=function e(){if(!i||0===l.length||d)return null;var t=TS.isSocketManagerEnabled()?TS.interop.SocketManager.isConnected():TS.model.ms_connected;if(!t)return;d=true;Promise.resolve().then(function(){d=false;_.chunk(l,r).forEach(function(e){var t={type:"presence_query",ids:e};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.send(t);else TS.ms.send(t)});l=[];return null})};b=_.throttle(b,t);y=_.throttle(y,t);var w=function e(t){if(TS.client&&!f&&!t){var n=_.map(TS.model.members,"id");var r=_.map(TS.model.bots,"id");var i=n.concat(r);i.forEach(function(e){h(e)})}f=false;b();y()};var k=function e(){var t=function e(){b();y()};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.promiseToHaveOpenWebSocket().then(t);else TS.ms.promiseToHaveOpenWebSocket().then(t)};var x=function e(){var t;var n=[];var r=[];var i=[];var a=Array.prototype.slice.call(document.querySelectorAll("[data-member-presence]"));a.forEach(function(e){t=e.getAttribute("data-member-presence");if($(e).is(":visible"))r.push(t);else i.push(t)});r=_.uniq(r);if(_.difference(r,o).length){var s=_.map(_.difference(r,o),TS.members.getMemberById);TS.warn("There are members needing presence updates in the DOM that are not in the presence subscription list");TS.warn("Missing Names:",_.map(s,"name"));TS.warn("Missing Ids:",_.map(s,"id"))}n=_.uniq(r.concat(i));if(_.difference(o,n).length){var l=_.map(_.difference(o,n),TS.members.getMemberById);TS.warn("There are members in the presence subscription list that are no longer in the DOM.");TS.warn("This might be fine if a longListView of members is showing, but once that list is removed these errors should go away.");TS.warn("Extra Names:",_.map(l,"name"));TS.warn("Extra Ids:",_.map(l,"id"))}}})()},4189:function(e,t){(function(){"use strict";TS.registerModule("compression",{compress:function e(t,n,i,s){var o=Date.now();if(i){var l=LZString.compress(n);var u=Date.now()-o;if(TS.has_pri[a])TS.log(a,t+" took "+u+"ms to _compress immediately str.length: "+n.length);return s({k:t,str:l})}r(t,n,function(e,n){var r=Date.now()-o;if(TS.has_pri[a])TS.log(a,t+" took "+r+"ms for the compression worker to callback ("+n+"ms spent within the worker) result.length: "+e.length);s({k:t,str:e})})},deCompress:function e(t,n){return""},terminate:function t(){if(e)e.terminate();e=null}});var e=null;var t=0;var n={};var r=function r(a,s,o){if(!e)i();t+=1;var l="job_key"+t;n[l]=function(e,t){o(e,t);delete n[l]};e.postMessage({request:"compress",input:s,job_key:l,k:a})};var i=function t(){if(e){TS.error("_makeWorker but there is a _worker");return}var r=_.get(TS,"boot_data.vvv_paths.lz_string","/js/libs/lz-string-1.4.4.js");var i=TS.environment.is_dev;if(TS.qs_args.local_assets||i)r=location.protocol+"//"+location.host+r;e=TS.utility.makeWebWorker("function() {\t\t\tself.importScripts('"+r+"');\t\t\tself.onmessage = function(e) {\t\t\t\tvar start = Date.now();\t\t\t\tvar result;\t\t\t\tif (e.data.request === 'compress') {\t\t\t\t\tresult = LZString.compress(e.data.input)\t\t\t\t}\t\t\t\tvar elapsed = Date.now() - start;\t\t\t\tpostMessage({\t\t\t\t\trequest: e.data.request,\t\t\t\t\tresult: result,\t\t\t\t\tjob_key: e.data.job_key,\t\t\t\t\tk: e.data.k,\t\t\t\t\telapsed: elapsed\t\t\t\t});\t\t\t}\t\t}",function(e){var t=n[e.data.job_key];if(!t){TS.error("e.data.job_key:"+e.data.job_key+" had no record in _callbacks??");return}t(e.data.result,e.data.elapsed)})};var a=488})()},4190:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("storage",{version:"0.85",msgs_version:window.boot_data&&boot_data.cache_version||"unknown_version",cache_ts_version:window.boot_data&&boot_data.cache_ts_version||"unknown_version",do_compression:!TS.model.is_our_app&&"undefined"!==typeof window.Worker&&(!window.bowser||!bowser.phantom&&!bowser.msie),test:function e(){return{getLocalStorage:P,setLocalStorage:j,getKeys:b,set:H}},onStart:function e(){TS.storage.onStart=function(){};if(!TS.storage.do_compression&&TS.boot_data.feature_force_ls_compression){TS.warn("Special case: force-enabling LS compression for this session.");TS.storage.do_compression=true}TS.storage.version+=TS.storage.do_compression?"-compressed-LZString":"";var t=a||"1"==TS.qs_args.ls_disabled||!D||TS.boot_data&&TS.boot_data.ls_disabled||function(){if(!TS.storage.storageAvailable()){w();if(!TS.storage.storageAvailable()){TS.warn("TS.storage.storageAvailable() = false in onStart after flushing all our keys, so disabling");return true}}return false}();if(TS.has_pri[N]){TS.log(N,"TS.storage.onStart should_disable:"+t);TS.log(N,"TS.storage.do_compression:"+TS.storage.do_compression+" (_ls.getItem('is_compressed') === 'yes'):"+(D&&"yes"===D.getItem("is_compressed")))}TS.ui.window_unloaded_sig.add(x);TS.ui.window_focus_changed_sig.add(C);TS.storage.setDisabled(t);H("rxn_records",null)},setDisabled:function e(t){if(a==t)return;if(t||!D){a=true;if(D)w()}else{a=false;y()}TS.info("_disabled:"+a)},storageAvailable:function e(){if(!D)return false;try{var t="test_to_see_if_we_can_write_to_local_storage";D.setItem(t,"foo");D.removeItem(t);return true}catch(e){return false}},storageSize:function e(t){var r=0;if(!D)return r;var i=b();var a=0;var s;var o;for(var l=0;l<i.length;l+=1){a+=1;s=i[l];o=D.getItem(s);if(!o&&""!==o)TS.warn(s+" not measurable value, typeof:"+("undefined"===typeof o?"undefined":n(o)));else{r+=o.length;if(t)TS.info(s+"="+(2*o.length/1024).toFixed(2)+"KB (total="+(r/1024).toFixed(2)+"KB)")}}if(t)TS.info("total for "+a+" items is "+(r/1024).toFixed(2)+"KB");return r},completelyEmptyAllStorageAndReset:function e(){TS.info("completelyEmptyAllStorageAndReset running");k();TS.storage.storeLastEventTS("",true,true);var t=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_b4_flush:"+t);if(t){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+b().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(o).join(", "))}F(true,"completelyEmptyAllStorageAndReset");var n=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_after_flush:"+n);if(n){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+b().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(o).join(", "))}},flush:function e(t){if(TS.has_pri[N])TS.log(N,"TS.storage.flush()");w();if(t)TS.storage.clearBufferAndCache()},clearBufferAndCache:function e(){if(TS.has_pri[N])TS.log(N,"TS.storage.clearBufferAndCache()");o={};l={};if(TS.compresion)TS.compression.terminate()},fetchStorageVersion:function e(){return O("storage_version")},storeStorageVersion:function e(t){H("storage_version",t,true)},fetchCacheTSStorageVersion:function e(){return O("storage_cache_ts_version")},storeCacheTSStorageVersion:function e(t){H("storage_cache_ts_version",t,true)},_makeMsgInputId:function e(t){return"msg_input_"+t},fetchLastMsgInput:function e(t){return O(TS.storage._makeMsgInputId(t),null)},storeLastMsgInput:function e(t,n){H(TS.storage._makeMsgInputId(t),n)},_makeCommentInputId:function e(t){return"comment_input_"+t},fetchLastCommentInput:function e(t){return O(TS.storage._makeCommentInputId(t),null)},storeLastCommentInput:function e(t,n){H(TS.storage._makeCommentInputId(t),n)},fetchOldestTs:function e(t){return O(i(t),null)},storeOldestTs:function e(t,n){H(i(t),n)},fetchActiveHistory:function e(){return O("active_history",[])||[]},storeActiveHistory:function e(t){H("active_history",t,true)},fetchLastEventTS:function e(t){return O("last_event_ts","",t)||""},storeLastEventTS:function e(t,n,r){H("last_event_ts",t,n,r)},fetchUIState:function e(){return O("ui_state",{})||{}},storeUIState:function e(t){H("ui_state",t)},fetchExpandableState:function e(){var t=O("expandable_state",{});return t&&"object"===("undefined"===typeof t?"undefined":n(t))?t:{}},storeExpandableState:function e(t){H("expandable_state",t)},fetchClientWindows:function e(){return O("client_windows",{})||{}},storeClientWindows:function e(t){H("client_windows",t)},fetchInputHistory:function e(){var t=O("input_history",[])||[];if("string"===typeof t)t=[t];var n=300;if(t.length>n)t.length=n;return t},storeInputHistory:function e(t){H("input_history",t)},fetchCustomEmoji:function e(){return O("custom_emoji",null)||null},storeCustomEmoji:function e(t){H("custom_emoji",t)},fetchStaticTranslations:function e(){return O("static_translations",null)||null},storeStaticTranslations:function e(t){H("static_translations",t)},fetchApps:function e(){return O("apps",null)||null},storeApps:function e(t){H("apps",t)},fetchAppsSearchResults:function e(){return O("apps_search",null)||null},storeAppsSearchResults:function e(t){H("apps_search",t)},fetchCmds:function e(){return O("cmds",null)||null},storeCmds:function e(t){H("cmds",t)},fetchChannelPageState:function e(){return O("channel_page_state",{})||{}},storeChannelPageState:function e(t){H("channel_page_state",t)},fetchInvitesState:function e(){return O("invites_state",[])||[]},storeInvitesState:function e(t){H("invites_state",t)},fetchBriefingOpensCount:function e(){return Number(O("briefing_opens_count",0))||0},storeBriefingOpensCount:function e(t){H("briefing_opens_count",t)},fetchReplyInput:function e(t,n){var r=O("reply_inputs")||[];var i=_.find(r,{model_ob_id:t,thread_ts:n});return i?i.text:""},storeReplyInput:function e(t,n,r){var i=10;var a=O("reply_inputs")||[];a=_.reject(a,{model_ob_id:t,thread_ts:n});if(a.length>i)a.shift();a.push({model_ob_id:t,thread_ts:n,text:r});H("reply_inputs",a)},fetchFilterState:function e(){return O("team_filter_state","")||""},storeFilterState:function e(t){H("team_filter_state",t)},fetchCallsState:function e(){return O("calls_state",{})||{}},storeCallsState:function e(t){H("calls_state",t)},fetchFrecency:function e(t){return O("frecency_"+t)},storeFrecency:function e(t,n){H("frecency_"+t,n)},clearFrecency:function e(t){H("frecency_"+t,"")},fetchEnterpriseState:function e(){return O("enterprise_state",{})||{}},storeEnterpriseState:function e(t){H("enterprise_state",t)},fetchLastTraceTS:function e(){return O("last_trace_ts","")||""},storeLastTraceTS:function e(){H("last_trace_ts",Date.now())}});var e=window.boot_data.user_id+"_";var t="channel_msgs_";var r="oldest_msg_ts_";var i=function e(t){return r+t};var a;var s=false;var o={};var l={};var u=1e3;var d=false;var c=1e3;var m=false;var f=1e3;var p=false;var h=false;var g=null;var S=3e5;var T=1e4;var v=1e3;var b=function e(){var t=[];if(!D)return t;var n=D.length;if(!n)return t;for(var r=0;r<n;r+=1)t.push(D.key(r));return t};var y=function t(){var n;if(!a){var r=TS.storage.fetchStorageVersion()||"";var i=-1!=r.indexOf("-compressed")||"yes"===D.getItem("is_compressed");if(TS.storage.do_compression&&!i){TS.warn("migrating to compressed format");n=b();n.forEach(function(t){var n=t.replace(e,"");var r=B(t,D.getItem(t));var i="converting: "+t+" -> "+n+" val.length: "+(void 0===r||null===r?-1:String(r).length);H(n,null);H(n,r);if(O(n)==r){if(TS.has_pri[N])TS.log(N,i+" SUCCESS _get(name) has a value:"+!!O(n)+", and it it the same as val")}else TS.error(i+" FAILURE _get(name) !== val")});TS.warn("migration to compressed format complete, "+n.length+" migrated");TS.storage.storeStorageVersion(TS.storage.version)}else if(TS.has_pri[N])TS.log(N,"no migration needed");D.setItem("is_compressed",TS.storage.do_compression?"yes":"no")}var s=TS.storage.fetchCacheTSStorageVersion();if(TS.has_pri[N])TS.log(N,"storage_cache_ts_version:"+s);var o=TS.storage.fetchStorageVersion()||"";if(TS.has_pri[N]){TS.log(N,"TS.storage.version:"+TS.storage.version);TS.log(N,"storage_version:"+o);TS.log(N,"TS.storage last_unload_flushing: "+O("last_unload_flushing"));TS.log(N,"TS.storage.storageAvailable(): "+TS.storage.storageAvailable())}n=b();if(TS.has_pri[N])TS.dir(N,n,"_getKeys()");if(!TS.storage.storageAvailable()){TS.warn("TS.storage.storageAvailable() = false so flushing all our keys");w()}else if(o!=TS.storage.version){TS.warn("storage_version:"+o+" does not match TS.storage.version:"+TS.storage.version+" so flushing all our keys: "+n.join(", "));w()}else if(!TS.storage.fetchLastEventTS()){TS.warn("TS.storage.fetchLastEventTS() is empty so flushing channel data");k()}TS.storage.storeStorageVersion(TS.storage.version);if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(M);else TS.ms.connected_sig.addOnce(M)};var w=function t(){b().forEach(function(t){if(0===t.indexOf(e))D.removeItem(t)})};var k=function n(){var i=b();if(TS.has_pri[N])TS.log(N,i,"_getKeys()");var a;for(var s=0;s<i.length;s+=1){a=i[s];if(0!==a.indexOf(e))continue;if(-1==a.indexOf(t)&&-1==a.indexOf(r))continue;D.removeItem(a);delete o[a];TS.warn("_ls.removeItem:"+a)}for(a in o){if(0!==a.indexOf(e))continue;if(-1==a.indexOf(t)&&-1==a.indexOf(r))continue;delete o[a];TS.warn("delete _buffer:"+a)}l={};i=b();TS.dir(488,i,"_getKeys()")};var x=function e(){s=true;H("last_unload_flushing",(new Date).toString(),true);F(true,"_windowUnloaded");TS.compression.terminate()};var C=function e(){F(true,"_windowBlurred")};var M=function e(){if(g){window.clearInterval(g);g=null}g=window.setInterval(I,S)};var I=function e(){if(!TS.model)return;var t=Object.keys(o).length;if(!t)return;var n=false;var r="";if(!TS.model.ui.is_window_focused){r="window blurred!";n=true}var i=Date.now()-TS.model.client.last_user_active_timestamp;if(!n)if(i>=T){r="window focused, but user has been idle long enough "+i+" >= "+T;n=true}if(TS.has_pri[N])TS.log(N,"_maybeFlushBuffer ok_to_flush_all:"+n);if(n){F(true,"maybeFlushBuffer ("+t+") "+r);return}var a=i>v;if(TS.has_pri[N])TS.log(N,"_maybeFlushBuffer ok_to_flush_some:"+a);r="window focused, but user has been idle long enough "+i+" >= "+v;if(a)F(false,"maybeFlushBuffer ("+t+") "+r)};var A=function e(t){return"string"===typeof t||"number"===typeof t||!t?t:JSON.stringify(t)};var E=function e(t){if("undefined"===t)return null;if("null"===t)return null;return t};var F=function e(t,n){if(a)return;var r=new Date;var i=Date.now();var s;var u=0;var d;var c=TS.model&&TS.model.team&&TS.model.team.domain&&TS.boot_data.feature_tinyspeck;var _;var m;var g;var S;var T;for(d in o){if(o[d].being_flushed)continue;S=A(o[d].val);if(void 0===S||null===S){D.removeItem(d);delete o[d];delete l[d]}else try{R(d,S)}catch(e){TS.warn("_flushBuffer _ls.setItem failed once, flushing all our keys. TS.storage.storageSize():"+TS.storage.storageSize(false));TS.error(0,e);w();delete o[d];delete l[d];continue}u+=1;s=Date.now()-i;if(c&&TS.has_pri[N])TS.log(N,"_flushBuffer _ls.setItem "+d+": "+s+"ms "+(o[d]&&o[d].val&&o[d].val.toString?o[d].val.toString().substr(0,100):"NULL?"));if(!t){_=new Date-r;if(!p&&_>f){p=true;g=new Date;try{m=TS.storage.storageSize()}catch(e){}g=new Date-g;T="Took "+_+"ms for "+u+" item (!all case) (threshold is "+f+" ms). Key: "+d+". Buffer length: "+(o[d]&&o[d].val&&o[d].val.toString()?o[d].val.toString().length:"unknown (not a string)")+". localStorage size: "+(m||"unknown")+". Time to read LS size: "+g;TS.info("_flushBuffer exceeded slow write threshold: "+T)}}if(o[d])o[d].being_flushed=true;if(!t){if(TS.has_pri[N])TS.log(N,"_flushBuffer: Wrote one item. why: "+n);return}l={}}if(u&&!h){_=new Date-r;if(_>f){h=true;try{m=TS.storage.storageSize()}catch(e){}T="Took "+_+"ms for "+u+" items (threshold is "+f+" ms). localStorage size: "+m+". App open for "+((Date.now()-TS.boot_data.start_ms)/1e3/60).toFixed(2)+" min. why: "+n;TS.info("_flushBuffer exceeded slow write threshold (all case): "+T)}}if(TS.has_pri[N])if(0===u)TS.log(N,"_flushBuffer: Nothing to save.");else TS.log(N,"_flushBuffer: Saved "+u+(1===u?" item":" items")+" why: "+n)};var O=function t(n,r,i){var s=e+n;if(i)TS.info("_get name:"+n+" k:"+s+" disabled:"+a+' _buffer["'+s+'"].val:'+(o[s]&&o[s].val));if(a)return o[s]&&o[s].val||r;if(s in o)return o[s]&&o[s].val||r;if(l.hasOwnProperty(s))return l[s];var u=B(s,U(s,D.getItem(s)),r,i);l[s]=u;return u};var B=function e(t,r,i,a){var s=new Date;var o=E(r);if(a)TS.info("_get _correctBadValsFromStorage(_ls.getItem(k)) k:"+t+" typeof result:"+("undefined"===typeof o?"undefined":n(o))+" /^[{[]/.test(result):"+/^[{[]/.test(o));var l;if(o&&"string"===typeof o&&/^[{[]/.test(o))o=TS.utility.parseJSONOrElse(o)||o;o=o||(void 0!==i?i:null);s=new Date-s;if(!d&&s>u){d=true;try{l=TS.storage.storageSize()}catch(e){}var c="_get took longer than threshold: Took "+s+"ms to read "+t+" (theshold is "+u+"ms), length = "+(o&&!isNaN(o.length)?o.length:"unknown")+". Storage size: "+l;TS.info(c)}return o};var H=function t(n,r,i,s){var u=false;var d=new Date;var _;var f=e+n;o[f]={val:r,being_flushed:false};l[f]=o[f].val;if(s)TS.info("_set immediate:"+i+" name:"+n+" k:"+f+" disabled:"+a+" do_compression:"+TS.storage.do_compression+' _buffer["'+f+'"].val:'+o[f].val);if(i){if(!a){var p=A(r);if(void 0===p||null===p){D.removeItem(f);delete o[f]}else try{R(f,p,i)}catch(e){TS.warn("_set _ls.setItem failed, flushing. TS.storage.storageSize():"+TS.storage.storageSize(false));u=true}}if(s)TS.info("_set failed:"+u);if(!u){if(s)TS.info('_set _buffer["'+f+'"]:'+(o[f]&&JSON.stringify(o[f])));d=new Date-d;if(d>c){TS.warn("_set immediately "+n+": "+d+"ms "+(r&&r.toString?r.toString().substr(0,100):"NULL?"));if(!m){m=true;try{_=TS.storage.storageSize()}catch(e){}var h="_set exceeded slow set threshold (immediate): Took "+d+"ms to write "+f+" (theshold is "+c+"ms), length = "+(r&&!isNaN(r.length)?r.length:"unknown")+". Storage length: "+_;TS.info(h)}}else if(TS.has_pri[N])TS.log(N,"_set GOOD immediately: "+i+" "+n+": "+d+"ms",r)}}};var $=!!(window.macgap&&macgap.ls);var D=$?macgap.ls:window.localStorage;var P=function e(){return D};var j=function e(t){D=t};var R=function e(t,n,r){n=String(n);if(TS.storage.do_compression){TS.compression.compress(t,n,r||s,L);return}L({k:t,str:n})};var L=function e(t){D.setItem(t.k,t.str);var r=function e(r){var i=D.getItem(t.k);if(i===t.str){if(r>1)TS.warn(t.k+" now saved, try #"+r);delete o[t.k];delete l[t.k];return}if(r>1&&(!o[t.k]||o[t.k].val!=t.str)){TS.error("buffer changed for "+t.k+" so we don't care anymore, a new value is being set for it, try #"+r);return}TS.error("WTF not saved, try #"+r+" "+t.k+" "+(t.str||"").length+" typeof ob.str:"+n(t.str)+" from_ls:"+("undefined"===typeof i?"undefined":n(i)));D.setItem(t.k,t.str);setTimeout(e,1e3,r+1)};r(1)};var U=function e(t,n){if(!TS.storage.do_compression)return n;var r=Date.now();if(n)n=LZString.decompress(n);var i=Date.now()-r;if(n&&TS.has_pri[N])TS.log(N,t+" took "+i+"ms to _decompress str.length: "+n.length);return n};var N=488})()},4191:function(e,t){(function(){"use strict";TS.registerModule("api",{paused_sig:new signals.Signal,unpaused_sig:new signals.Signal,Q_empty_sig:new signals.Signal,onStart:function e(){if(TS.boot_data.feature_name_tagging_client){var r=["channels.view","rtm.leanStart","rtm.start","users.info","users.list"];_.forEach(r,function(e){if(t[e])_.assign(t[e],{name_tagging:true});else t[e]={name_tagging:true}})}if(TS.boot_data.feature_sli_briefing)n.push("highlights.briefing");if(TS.boot_data.feature_sli_channel_insights)n.push("channels.insights")},test:function r(){var i={_one_at_a_time_methodsA:s,_ensure_model_methodsA:n,_pause:ie,_unPause:ae,_pauseUntilAPIConnectionRestored:ue,_promisify:q,_getMaxAttempts:k,_incrementPending:C,_decrementPending:M,_getDefaultArgsByMethodName:A,_kickOffACallOrEnqueue:E,_callOutsideHandler:L,_nextFromQ:B,_reQueue:U,_calculateHTTPErrorDelayMs:N,_makeLogSafeMethodName:G,_logError:R,_getAPIErrorObject:W,_maybeShowConnectivityWarning:ee,_one_at_a_time_Q:m};Object.defineProperty(i,"_pauseFor",{get:function e(){return le},set:function e(t){le=t}});Object.defineProperty(i,"_pauseUntilBackOnline",{get:function e(){return de},set:function e(t){de=t}});Object.defineProperty(i,"_pauseUntilServiceIsUp",{get:function e(){return ce},set:function e(t){ce=t}});Object.defineProperty(i,"_maybePauseUntilServiceIsUp",{get:function e(){return me},set:function e(t){me=t}});Object.defineProperty(i,"_one_at_a_time_call_pending",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(i,"_is_paused",{get:function e(){return p},set:function e(t){p=t}});Object.defineProperty(i,"_ensure_model_methodsA",{get:function e(){return n},set:function e(t){n=t}});Object.defineProperty(i,"_one_at_a_time_methodsA",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(i,"_max_attempts",{get:function e(){return S}});Object.defineProperty(i,"_pending",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(i,"_pause_secs",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(i,"_maybeTimingClearMarks",{get:function e(){return Q},set:function e(t){Q=t}});Object.defineProperty(i,"_maybeTimingCount",{get:function e(){return V},set:function e(t){V=t}});Object.defineProperty(i,"_maybeTimingMark",{get:function e(){return Y},set:function e(t){Y=t}});Object.defineProperty(i,"_maybeTimingMeasure",{get:function e(){return J},set:function e(t){J=t}});Object.defineProperty(i,"_maybeShowConnectivityWarning",{get:function e(){return ee},set:function e(t){ee=t}});Object.defineProperty(i,"_default_api_args",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(i,"_default_api_args_by_method",{get:function e(){return t},set:function e(n){t=n}});Object.defineProperty(i,"_kickOffACall",{get:function e(){return F},set:function e(t){F=t}});Object.defineProperty(i,"_kickOffACallOrEnqueue",{get:function e(){return E},set:function e(t){E=t}});Object.defineProperty(i,"_last_connectivity_warning_time",{get:function e(){return Z},set:function e(t){Z=t}});Object.defineProperty(i,"_api_queue_depth_warning_threshold",{get:function e(){return X},set:function e(t){X=t}});Object.defineProperty(i,"_main_Q",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(i,"_one_at_a_time_Q",{get:function e(){return m},set:function e(t){m=t}});Object.defineProperty(i,"_makeRequest",{get:function e(){return O},set:function e(t){O=t}});return i},call:function e(t,n,r,i,a){return E(t,n,r,i,a)},callImmediately:function e(t,n,r,i,a){var o=true;if(-1!=s.indexOf(t))if(c){TS.warn(t+" cannot be called with TS.api.callImmediately because a one-at-a-time call is already pending, so sending to _kickOffACallOrEnqueue for enqueuing");return E(t,n,r,i,a,o)}if(p){TS.warn(t+" cannot be called with TS.api.callImmediately because we are waiting due to a non-200 response, so sending to _kickOffACallOrEnqueue for enqueuing");return E(t,n,r,i,a,o)}n=n||{};var l=q(t,r);return F(t,n,l,i,a)},callSynchronously:function e(t,n,r,i,a){n=n||{};n._synchronously=true;return TS.api.callImmediately(t,n,r,i,a)},debugGetCounts:function e(){return{_method_call_counts:y,_pending:u}},hasPendingRequests:function e(){return!!u},getQLengths:function e(){return{_main_Q:d.length,_one_at_a_time_Q:m.length}},isPaused:function e(){return p},callFuncWhenApiQisEmpty:function e(t){if(TS.api.hasPendingRequests()){if(!TS.api.Q_empty_sig.has(t))TS.api.Q_empty_sig.addOnce(t)}else t()},debugShowStatus:function e(){TS.console.group("TS.api status");if(p)if(h)TS.console.log(2,"API calls are paused for "+h+"more seconds");else TS.console.log(2,"API calls are paused.");else TS.console.log(2,"API calls are NOT paused");TS.console.warn(2,"Pending count is "+u+", main queue length is "+d.length+", and one-at-a-time queue length is "+m.length);if(y.total_asks==y.total_attempts)TS.console.log(2,"Total API calls made (there have been no retries): "+y.total_asks);else{TS.console.log(2,"Total API calls made (not including retries): "+y.total_asks);TS.console.log(2,"Total API calls made (including retries): "+y.total_attempts)}if(y.total_non_200s)TS.console.warn(2,"Total non-200 API responses: "+y.total_non_200s);else TS.console.log(2,"No non-200 API responses");TS.console.groupEnd("TS.api status")},debugShowQueue:function e(){_.forEach({main:d,"one-at-a-time":m},function(e,t){TS.console.group("TS.api "+t+" queue");if(e.length)e.forEach(function(e){TS.console.log(2,e.method,e.args)});else TS.console.log(2,"Nothing pending in "+t+" queue");TS.console.groupEnd("TS.api "+t+" queue")})},debugSetPaused:function e(t){var n=100;if(t){ie({reason:{DEBUG:true},retry_after:1e3*n});TS.console.log(2,"API calls are now paused for",n,"seconds")}else{ae();TS.console.log(2,"API calls are now unpaused")}},runNextFromQueue:function e(){if(p){TS.info("Calls are paused, so runNextFromQueue doing anything");return}TS.info("Running next from queue");B()}});var e={};var t={"channels.view":{canonical_avatars:true},"rtm.leanStart":{canonical_avatars:true},"rtm.start":{canonical_avatars:true},"users.info":{canonical_avatars:true},"users.list":{canonical_avatars:true}};var n=["activity.mentions","stars.list","files.list","files.info","search.messages","search.files","channels.history","groups.history","im.history","mpim.history","channels.listShared","groups.listShared","unread.history","pins.list","subteams.users.list","subteams.list","channels.replies","groups.replies","im.replies","subscriptions.thread.getView","chat.command","conversations.history"];var r=["channels.history","pins.list","groups.history","im.history","mpim.history","unread.history","activity.mentions","conversations.history"];var i=["rtm.start","rtm.leanStart","files.list"];var a=["rtm.start","rtm.leanStart","activity.mentions","stars.list","files.list","files.info","apps.list","commands.list","channels.list","emoji.list","help.issues.list","subteams.list","subteams.users.list","rtm.checkFastReconnect"];var s=["users.prefs.set","rtm.start","rtm.leanStart","rtm.checkFastReconnect","enterprise.setPhoto","signup.createTeam"];var o=["channels.view","dnd.teamInfo","screenhero.rooms.create","screenhero.rooms.join","screenhero.rooms.refreshToken","screenhero.rooms.invite","highlights.list","enterprise.channels.createShared","enterprise.groups.createShared","enterprise.teams.create"];var l=["api.test","auth.emailToken","auth.findTeam","auth.findUser","auth.loginMagic","auth.signin","enterprise.signup.complete","enterprise.signup.checkDomain","enterprise.signup.checkPassword","helpdesk.get","search.appDirectory","signup.addLead","team.checkEmailDomains","test.versionInfo","oauth.access"];var u=0;var d=[];var c=false;var m=[];var f=4;var p=false;var h=0;var g;var S=10;var T=6e4;var v=5e3;var b=100;var y={total_asks:0,total_attempts:0,total_non_200s:0};var w=0;var k=function e(t){if("rtm.start"===t)return 2;if("rtm.leanStart"===t)return 2;if("rtm.checkFastReconnect"===t)return 2;return S};var x=function e(t,n){var r=k(t);if("rtm.start"===t&&n>=r)return true;if("rtm.leanStart"===t&&n>=r)return true;if("rtm.checkFastReconnect"===t&&n>=r)return true;if(w>=4)return true};var C=function e(t){u+=1;if(u>=10)V("ts_api_pending_10plus");else if(u>=5)V("ts_api_pending_5plus");else if(u>=3)V("ts_api_pending_3plus");else if(2==u)V("ts_api_pending_2");else if(1==u)V("ts_api_pending_1");if(-1!=s.indexOf(t))c=true};var M=function e(t){u-=1;if(-1!=s.indexOf(t))c=false};var I=function e(t){M(t);if(!p)B()};var A=function n(r){return _.assign({},e,t[r])};var E=function e(t,n,r,i,a,o){if(_.isUndefined(t)){TS.error("Tried to make API call, but API method name was not specified");throw new Error("Invalid API call")}n=_.defaults(n||{},A(t));var l=q(t,r);var h;if(-1!=s.indexOf(t)){if(!p&&!c)return F(t,n,l,i,a);h=m}else{if(!p&&u<f)return F(t,n,l,i,a);h=d}var g={p:l,method:t,args:n,dont_set_active:i,progressHandler:a};if(o)h.unshift(g);else h.push(g);if(p){V("ts_api_called_while_paused");ee()}if(h==d)V("ts_api_main_queue_depth",d.length);return l.promise};var F=function e(t,n,r,i,a){if(r.promise.isCancelled()){if(TS.has_pri[he])TS.log(he,t+" cancelled before call could be made in TS.api");setTimeout(B,1);return r.promise}if(TS.boot_data.feature_conversations_api){var s=/^(channels|groups|mpim|im)\./;t=t.replace(s,"conversations.")}if(TS.has_pri[he])TS.log(he,'calling method "'+t+'" args._attempts:'+n._attempts);C(t);var l=t.indexOf("search.")>-1;if(TS.boot_data.page_needs_enterprise&&n.enterprise_token&&l&&!TS.model.prefs.search_only_current_team)n.token=n.enterprise_token;else if(TS.boot_data.page_needs_enterprise&&n.enterprise_token&&!l)n.token=n.enterprise_token;else n.token=TS.model.api_token;if(!TS.client&&!i){n.set_active=true;TS.model.last_net_send=Date.now()}var u=Date.now();var d=H(t,n);var c=u/1e3;var m=TS.model.api_url+t+"?_x_id="+TS.boot_data.version_uid.substring(0,8)+"-"+c;_.each(TS.qs_args,function(e,t){if(0==t.indexOf("feature_")||0==t.indexOf("exp_"))m+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(("rtm.start"===t||"rtm.leanStart"===t)&&TS.client&&!TS.isSocketManagerEnabled())m=TS.utility.appendLogToUrlWithLimit(m,TS.ms.getConnectionFlowLog());if(TS.boot_data.feature_channel_eventlog_client)if("channels.history"===t||"groups.history"===t||"im.history"===t||"mpim.history"===t||"conversations.history"===t)n.visible=1;var f=function e(){$(d)};var p=function e(i,a){var s=Date.now()-u;TS.dir(2,{data:i,args:n},'got api rsp for method "'+t+'" (took '+s+"ms)");i=i||{ok:false};if(i.ok){D(d);L(t,n,i,a,r);return{breathing_ms:b,try_again:false}}j(d);R(t,n,i);if(-1!=o.indexOf(t)){TS.warn('NOT re-Qing "'+t+'", as specified');L(t,n,i,a,r);return{breathing_ms:b,try_again:false}}if((429==i.status||503==i.status)&&n._attempts>=k(t)||n._synchronously){TS.warn('NOT re-Qing api call "'+t+'" because we tried too many times ('+n._attempts+")");L(t,n,i,a,r);return{breathing_ms:b,try_again:false}}if("_timeout"===i.error)return{breathing_ms:v,try_again:true};if("_badly_formed"===i.error)return{breathing_ms:b,try_again:true};if("_http_error"===i.error){n._delay_ms=N(n,i);if(0==i.status&&x(t,n._attempts)){de(n._attempts);return{breathing_ms:0}}else if(429==i.status)le(n._delay_ms);else if(i.status>=500&&x(t,n._attempts)){var l=function(){var e={};return function(){e._delay_ms=N(e,i)}}();me(l,k(t),n._attempts);var c=n._attempts<k(t);return{breathing_ms:n._delay_ms,try_again:c}}y.total_non_200s+=1;return{breathing_ms:n._delay_ms}}var _=false;var m=3;var f=b;if(n._attempts<m)if(("search.files"===t||"search.messages"===t)&&"solr_failed"===i.error)_=true;else if("users.info"===t&&"user_not_found"===i.error){f=1e3*n._attempts;_=true}if(_)return{breathing_ms:f,try_again:true};L(t,n,i,a,r);return{breathing_ms:b,try_again:false}};O(m,t,n,r,f,i,a,p);return r.promise};var O=function e(t,n,r,i,s,o,u,d){var c=new XMLHttpRequest;var m=-1!=a.indexOf(n);var f=0;if(!r._attempts){r._attempts=0;y.total_asks+=1;y[n]=y[n]?y[n]+1:1}r._attempts+=1;y.total_attempts+=1;if(TS.has_pri[ge])TS.log(ge,n+" count: "+y[n]+" (asks: "+y.total_asks+" attempts: "+y.total_attempts+")");var p=function e(){if(TS._count_bytes_received)TS._bytes_received+=c.responseText.length;var t=JSON.parse(c.responseText);w=0;var a=d(t,c.getResponseHeader("X-Slack-Req-Id"));if(a.try_again)setTimeout(function(){U(n,r,i,o,u)},a.breathing_ms);I(n)};var h=function e(){if(("rtm.start"===n||"rtm.leanStart"===n)&&TS.ms&&!TS.isSocketManagerEnabled())TS.ms.logConnectionFlow("TS.api got a "+c.status+" response for method: "+n);var t={ok:false,error:"_http_error",status:parseInt(c.status,10),retry_after:parseInt(c.getResponseHeader&&c.getResponseHeader("Retry-After"),10)};if(t.status>=500||0==t.status)w+=1;else w=0;var a=d(t);function s(){U(n,r,i,o,u);I(n)}if(false===a.try_again){var l;L(n,r,t,l,i);I(n)}else if(a.breathing_ms)setTimeout(s,a.breathing_ms);else s()};var g=function e(){c.onerror=_.noop;c.onreadystatechange=_.noop;c.onprogress=_.noop;c.abort();S=_.noop;var t={ok:false,error:"_timeout",seconds:T};var a=d(t);setTimeout(function(){if(a.try_again)U(n,r,i,o,u);I(n)},a.breathing_ms)};i.onCancel=function(){if(TS.has_pri[he])TS.log(he,n+" cancelled and aborted during request in TS.api");c.onerror=_.noop;c.onreadystatechange=_.noop;c.onprogress=_.noop;c.abort();S=_.noop;clearTimeout(f);setTimeout(I,b,n)};var S=function e(t){if(TS.has_pri[Se])TS.log(Se,n+" progress: "+(void 0!=t&&-1!=t&&100*t+"%"||-1!=t&&0!==t&&100*t+"%"||"unknown"));if(!m)return;clearTimeout(f);var i=T;if("rtm.start"===n)if(r.cache_ts)i=1.5*T;else i=2*T;f=setTimeout(function(){clearTimeout(f);if(!TS.isSocketManagerEnabled())TS.ms.logConnectionFlow(n+"_timeout");var e=T+"ms passed, no "+n+" progress";var t="API method timed out after "+i;var r="api_call_timeout";var a=false;TS.console.logError(e,t,r,a);g()},i)};c.onprogress=function(e){var t=e.lengthComputable?e.loaded/e.total:-1;if(m)S(t);if(u)u(t)};c.onerror=function(){};c.onreadystatechange=function(){if(1==c.readyState);else if(2==c.readyState){if(s)s(c)}else if(3==c.readyState);else if(4==c.readyState){c.onprogress({loaded:1,total:1,lengthComputable:true});c.onprogress=_.noop;clearTimeout(f);if(200==c.status){c.onreadystatechange=null;p()}else h()}};var v=new FormData;var k=l.indexOf(n)<0;var x=false;Object.keys(r).forEach(function(e){if("token"===e&&!k)return;if("_"===e[0])return;v.append(e,r[e]);x=true});c.open("POST",t,!r._synchronously);c.setRequestHeader("X-Slack-Version-Ts",TS.boot_data.version_ts);if(m)S(0);if(x)c.send(v);else c.send()};var B=function e(){var t;if(m.length&&!c)t=m.shift();else if(d.length>=te&&ne){t=_.find(d,function(e){return re(e.method)!==ne});if(t&&d[0]!==t)_.remove(d,t);else t=d.shift()}else if(d.length)t=d.shift();if(!t){if(0===u){TS.api.Q_empty_sig.dispatch();ne=void 0}return}ne=re(t.method);F(t.method,t.args,t.p,t.dont_set_active,t.progressHandler)};var H=function e(t,n){var r="api_call_"+G(t);var a=r+"__headers";var s="start_"+y.total_asks+"_"+r;Y(s);return{args:n,method:t,mark_label:s,headers_label:a,complete_label:r,ephemeral:-1===i.indexOf(t)}};var $=function e(t){if(!t)return;J(t.headers_label,t.mark_label,null,{ephemeral:t.ephemeral});P(t,t.headers_label)};var D=function e(t){if(!t)return;Y(t.complete_label,t.mark_label,null,{ephemeral:t.ephemeral});P(t,t.complete_label);Q(t.mark_label)};var P=function e(t,n){if(!t)return;if("rtm.start"===t.method||"rtm.leanStart"===t.method){var r=n;r+="__dmeliding_"+(t.args.only_relevant_ims?"yes":"no");J(r,t.mark_label,null,{ephemeral:t.ephemeral})}};var j=function e(t){if(!t)return;Q(t.mark_label)};var R=function e(t,n,r){if("file_deleted"===r.error);else{var i=r;var a='api call "'+t+'" not ok';var s="api_call_error";var o=false;TS.console.logError(i,a,s,o);if(TS.qs_args.log_api_failures){try{TS.warn("args: "+JSON.stringify(n))}catch(e){TS.warn("could not stringify args")}try{TS.warn("data: "+JSON.stringify(r))}catch(e){TS.warn("could not stringify data")}}else TS.warn("args/data logging skipped, run with ?log_api_failures=1 to enable full logging")}};var L=function e(t,i,a,s,o){var l=function e(){var n=TS.client&&TS.client.stats&&TS.client.stats.isEnabled();var r;var l;if(n){fe+=1;r="api_response_handler_"+fe;l="slow_api_handler_"+t;TS.metrics.mark(r)}o.handler(a.ok,a,i,s);if(n){var u=TS.metrics.measureAndClear(l,r);if(u>pe)TS.console.warn("API method handler took too long ("+u+"): "+t,TS.console.getStackTrace())}return Promise.resolve()};if(!a.ok&&a.active_migration&&TS.boot_data){var u=TS.boot_data.api_active_migration_error_response_type;if(!u)TS.info('API returned "active_migration" (enterprise org migration) for '+t+" - not alerting or reloading because no api_active_migration_error_response_type set.",a);else if(TS.boot_data.ignore_api_active_migration_error)TS.info('API returned "active_migration" (enterprise org migration) for '+t+' - skipping "'+u+'" because ignore_api_active_migration_error set.',a);else if("allow_reload"===u){if(!TS.boot_data.active_migration_reload_underway){TS.warn('About to reload because API returned "active_migration" (enterprise org migration) for '+t+" and api_active_migration_error_response_type allows reload.",a);TS.boot_data.active_migration_reload_underway=true;TS.reload(false,"TS.api._callOutsideHandler")}}else if("show_dialog"===u)if(TS.boot_data.user_saw_migration_dialog)TS.info('API returned "active_migration" (enterprise org migration) for '+t+", but user has already seen dialog. Doing nothing.");else{TS.info('API returned "active_migration" (enterprise org migration) for '+t+". Showing migration dialog.");TS.ui.fs_modal.start({title:"This team is joining an Enterprise Organization!",body:"Apologies for the interruption. This team is currently being migrated into "+(a.enterprise_name?"the <b>"+_.escape(a.enterprise_name)+"</b> Organization":"an Organization")+", which can take some time to complete. In the meantime, you won’t be able to use it, but we’ll email you once it’s done.",show_cancel_button:false,show_go_button:false,disable_default_controls:true,disable_esc:true});TS.boot_data.user_saw_migration_dialog=true}else TS.warn('API returned "active_migration" (enterprise org migration) for '+t+', but api_active_migration_error_response_type of "'+u+'" not recognized - doing nothing.',a);return l()}if(!a.ok)return l();if(-1==n.indexOf(t))return l();var d=function e(){if(0===t.indexOf("bots."))return Promise.resolve();if(TS.has_pri[Te])TS.log(Te,'running api data from "'+t+'" through TS.bots.ensureBotsInDataArePresent()');return TS.bots.ensureBotsInDataArePresent(a,t,i.channel||void 0).catch(function(e){TS.error(e)})};var c=function e(){if(_.includes(r,t))return Promise.resolve();if(0===t.indexOf("users."))return Promise.resolve();if(TS.has_pri[Te])TS.log(Te,'running api data from "'+t+'" through TS.members.ensureMembersInDataArePresent()');return TS.members.ensureMembersInDataArePresent(a,t,i.channel||void 0).catch(function(e){TS.error(e)})};var m=function e(){if(TS.has_pri[Te])TS.log(Te,'running api data from "'+t+'" through TS.shared.ensureModelObsInDataArePresent()');return TS.ensureFullyBooted().then(function(){return TS.shared.ensureModelObsInDataArePresent(a,t).catch(function(e){TS.error(e)})})};var f=function e(){if(!TS.boot_data.feature_shared_channels_client)return Promise.resolve();if(0===t.indexOf("teams."))return Promise.resolve();TS.console.log(528,'running api data from "'+t+'" through TS.teams.ensureTeamsInDataArePresent()');return TS.teams.ensureTeamsInDataArePresent(a).catch(function(e){TS.console.error(e)})};m().then(function(){return Promise.join(d(),c(),f())}).then(l)};var U=function e(t,n,r,i,a){TS.warn('re Qing api call "'+t+'"');var o=-1!=s.indexOf(t)?m:d;o.unshift({method:t,args:n,p:r,dont_set_active:i,progressHandler:a})};var N=function e(t,n){var r;var i;var a=n.retry_after||60;if(a>180)a=180;if(429==n.status||503==n.status){i=1.1;r=180}else{i=1.3;a=1;r=60}var s=!t._delay_ms?1e3*(a+1):Math.min(t._delay_ms*i,1e3*r);s+=Math.random()*(s/2);return Math.floor(s)};var G=function e(t){return String(t).replace(/\./g,"_")};var W=function e(t){var n=new Error('API call "'+t.method+'" not ok');n.method=t.method;n.data=t.data;n.args=t.args;return n};var q=function e(t,n){var r;var i;var a=new Promise(function(e,t,a){i=e;r=t;a(function(){if("function"===typeof n)TS.error("Because you passed a handler, which is deprecated, this API call has been cancelled but your handler has not been called. Use Promise chaining to cancel and react.");o.onCancel()})});if("function"===typeof n)a=a.caught(_.noop);var s=function e(a,s,o,l){var u={data:s,args:o,method:t,request_id:l};if(a)i(u);else r(W(u));if(n)n(a,s,o,l)};var o={promise:a,handler:s,onCancel:_.noop};return o};var z=.01;var K=TS.qs_args.api_timings||Math.random()<=z;var V=function e(t,n){if(!K)return;TS.metrics.count(t,n)};var Y=function e(t){if(!K)return;TS.metrics.mark(t)};var J=function e(t,n,r,i){if(!K)return;TS.metrics.measure(t,n,r,i)};var Q=function e(t){if(!K)return;TS.metrics.clearMarks(t)};var X=100;var Z=0;var ee=function e(){if(TS.ui.fs_modal.is_showing)return;if(!p)return;if(d.length<X)return;var t=3e5;if(Date.now()-Z<t)return;Z=Date.now();TS.metrics.count("ts_api_connectivity_warning_shown");TS.ui.fs_modal.start({title:"Connection troubles",body:"We're having a bit of trouble with our connections to Slack's servers. We've seen this problem clear up with a restart of Slack, a solution which we suggest to you now only with great regret and self-loathing.",go_button_text:"Reload Slack",cancel_button_text:"Ignore",onGo:function e(){TS.metrics.count("ts_api_connectivity_warning_reload");TS.reload(null,"API queue was too deep ("+d.length+" / "+X+") and user chose to reload")},onCancel:function e(){TS.metrics.count("ts_api_connectivity_warning_ignore")}})};var te=5;var ne;var re=function e(t){return t.replace(/^(channels|groups|im|mpim)\./,"_modelob_.")};var ie=function e(t){if("undefined"===typeof t)throw new Error("Please specify the reason pausing the API");if(!p){p=true;V("ts_api_pause");Y("ts_api_pause_start");TS.api.paused_sig.dispatch(t)}};var ae=function e(){if(p){p=false;V("ts_api_unpause");J("ts_api_pause_duration","ts_api_pause_start");Q("ts_api_pause_start")}};var se=function e(){TS.api.unpaused_sig.dispatch()};var oe=1e3;var le=function e(t){h=Math.max(h,Math.ceil(t/oe));ie({reason:{API_ERROR:true},retry_after:h});clearInterval(g);g=setInterval(function(){h-=1;TS.api.paused_sig.dispatch({reason:{API_ERROR:true},retry_after:h});if(!h){clearInterval(g);ae();se();B()}},oe)};var ue=function e(t,n,r){if(p)return;ie({reason:t});return TS.api.connection.waitForAPIConnection(n,r).catch(function(){}).then(ae).then(se).then(B).catch(function(e){TS.error("An error occured while waiting for API connection to come back",e);throw e})};var de=function e(t){TS.warn(t+" consecutive connection errors. Pausing API queue until internet returns");return ue({OFFLINE:true})};var ce=function e(t,n,r){TS.warn("Received "+r+" consecutive 500s; pausing API queue until we determine the service is in a good state");return ue({SERVICE_DOWN:true},t,n)};var _e=false;var me=function e(t,n,r){if(_e)return;_e=true;TS.api.connection.promiseToTestAPIConnection().then(function(e){if(e);else ce(t,n,r)}).finally(function(){_e=false})};var fe=0;var pe=1e3;var he=2;var ge=48;var Se=222;var Te=528})()},4196:function(e,t){(function(){"use strict";TS.registerModule("permissions.members",{onStart:function e(){if(TS.boot_data.feature_stop_loud_channel_mentions&&TS.client&&TS.client.login_sig)TS.client.login_sig.add(t)},canThread:function e(t){if(!TS.boot_data.feature_default_shared_channels)return true;if(t.is_read_only||t.is_non_threadable)return false;return true},canPostInChannel:function e(t){if(t.is_general)return TS.permissions.members.canPostInGeneral(TS.model.user);if(TS.ims.isImWithDeletedMember(t))return false;if(TS.boot_data.feature_default_shared_channels){if(t.is_read_only||t.is_thread_only)return false;return true}return!TS.channels.read_only.isReadOnly(t.id)},canPostInGeneral:function t(n){if(!n)return false;return e("who_can_post_general",n)},canPostInModelOb:function e(t,n){if(n.is_general)return TS.permissions.members.canPostInGeneral(t);else if(TS.boot_data.page_needs_enterprise&&n.is_shared)return TS.permissions.members.canPostInChannel(n);else if(TS.ims.isImWithDeletedMember(n))return false;return true},canNonAdminsAtMentionEveryoneBySettings:function t(){return e("who_can_at_everyone",TS.model.user)},canAtMentionEveryone:function e(){if(!TS.boot_data.feature_stop_loud_channel_mentions)return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings();var t=TS.channels.getGeneralChannel();if(!t){TS.warn("WTF, could not getGeneralChannel()? Checking only team settings, skipping large channel mentions check.");return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()}return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()&&!TS.permissions.members.shouldStopChannelMentions(t.id,TS.model.user.id)},canNonAdminsAtChannelOrGroupBySettings:function t(){return e("who_can_at_channel",TS.model.user)},canAtChannelOrGroup:function e(t){return TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(t)&&!TS.permissions.members.shouldStopChannelMentions(t,TS.model.user.id)},shouldStopChannelMentions:function e(t,n){if(!TS.boot_data.feature_stop_loud_channel_mentions)return false;var i=TS.shared.getModelObById(t);if(!i){TS.warn("shouldStopChannelMentions(): could not find model_ob for id "+t);return false}if(i.is_im&&!i.is_mpim)return false;var a=TS.membership.getMembershipCounts(i);var s=_.get(a,"counts.member_count")||0;var o=s>=r;if(o&&n){var l=TS.members.getMemberById(n);if(l&&l.is_admin)o=false}return o},canMsgMentionChannelIfMention:function e(t,n,r){if(!TS.boot_data.feature_stop_loud_channel_mentions)return true;if(!t){TS.warn("canMsgMentionChannel: WTF no msg_text?",arguments);return true}var i=true;var a=false;var s=false;var o=false;var l={text:t,subtype:""};var u=TS.utility.msgs.msgContainsMention(l,a,i,s,o);if(!u)return true;var d=TS.permissions.members.shouldStopChannelMentions(n,r);if(d)return false;return true},canArchiveChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_archive_channels",TS.model.user)},canCreateChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_create_channels",TS.model.user)},canCreateGroups:function t(){if(TS.model.user.is_ultra_restricted)return false;return e("who_can_create_groups",TS.model.user)},canCreateMpims:function e(){if(TS.model.user.is_ultra_restricted)return false;return true},canCreateAndDeleteUserGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_create_delete_user_groups",TS.model.user,true)},canEditUserGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_edit_user_groups",TS.model.user,true)},canUserSeeMember:function e(t){if(!TS.model.user.is_restricted)return true;else if(t.is_self)return true;else if(t.is_slackbot)return true;return TS.members.getMembersForUser().indexOf(t)>=0},canKickFromChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_kick_channels",TS.model.user,true)},canKickFromGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_kick_groups",TS.model.user,true)},canCreateConvertOrgSharedChannels:function e(){if(!TS.boot_data.page_needs_enterprise)return false;if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return true;return TS.permissions.members.canManageOrgSharedChannels()},canManageOrgSharedChannels:function e(){if(!TS.model.team.prefs.who_can_manage_shared_channels)return true;if(!TS.boot_data.page_needs_enterprise)return false;var t=TS.model.user;if(t.is_restricted)return false;if(void 0!==TS.model.team.prefs.can_user_manage_shared_channels)return TS.model.team.prefs.can_user_manage_shared_channels;var n=TS.model.team.prefs.who_can_manage_shared_channels.type[0];if("regular"===n)return true;if("admin"===n)return t.is_admin||t.is_owner||!!(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner));if("owner"===n){if(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner))return true;if(TS.model.team.prefs.who_can_manage_shared_channels.user&&TS.model.team.prefs.who_can_manage_shared_channels.user.indexOf(TS.model.user.id)>-1)return true;return false}return false},canCreateSharedChannel:function e(){if(!TS.boot_data.feature_connecting_shared_channels)return false;if(!TS.boot_data.feature_shared_channels_client)return false;if(!TS.model.user.is_owner&&!TS.model.user.is_admin)return false;return true},canRequestSharedChannel:function e(){if(!TS.boot_data.feature_connecting_shared_channels)return false;if(!TS.boot_data.feature_shared_channels_client)return false;return true},canExportMessageHistory:function e(t){if(TS.boot_data.feature_channel_exports&&(TS.model.user.is_admin||t.is_im||t.is_group))return true;return false},canUserInviteToChannel:function e(t){if(TS.model.user.is_ultra_restricted)return false;if(t.is_channel&&t.is_member)return true;if(t.is_group)return true;return false},canOrgUserManageGuests:function e(){if(!TS.boot_data.page_needs_enterprise)return true;if(!TS.model.team.prefs.who_can_manage_guests)return true;var t=TS.model.user;var n=t.is_admin;var r=t.enterprise_user.is_admin;var i=TS.model.team.prefs.who_can_manage_guests;var a=_.head(_.get(i,"type"));if("admin"===a&&(n||r))return true;if("owner"===a&&r)return true;if("owner"===a&&_.includes(i.user,t.id))return true;return false},test:function t(){var n={};Object.defineProperty(n,"_checkPrefCascade",{get:function t(){return e},set:function t(n){e=n}});return n}});var e=function e(t,n,r){if("undefined"===typeof r)r=true;if(n.is_restricted)return"ra"===TS.model.team.prefs[t];if("ra"===TS.model.team.prefs[t])return true;if("regular"===TS.model.team.prefs[t])return true;if("admin"===TS.model.team.prefs[t])return!!n.is_admin;if("owner"===TS.model.team.prefs[t])return!!n.is_owner;return r};function t(){TS.prefs.team_loud_channel_mentions_limit_changed_sig.add(n);n()}var n=function e(){r=TS.model.team.prefs.loud_channel_mentions_limit||Math.infinity};var r})()},4197:function(e,t){(function(){"use strict";TS.registerModule("tips",{onStart:function t(){e.delegate(".ts_tip_lazy, .ts_tip_float","mouseenter",o);e.delegate(".ts_tip_float","mouseleave",l);e.on("click",".ts_tip",function(e){if(TS.isPartiallyBooted()){e.preventDefault();e.stopPropagation();TS.incremental_boot.userDidInteractWithUI();return}c($(this))})},hideAll:function e(){$(".ts_tip").addClass("ts_tip_hide")},unhideAll:function e(){$(".ts_tip").removeClass("ts_tip_hide")},updateTipTitle:function e(t,r){var a=m(t);if(a.length)a.html(r);else t.attr("title",r);if(n&&n[0]==t[0])if(!r)u();else{i.html(r);d()}},updateFloater:function e(t){if(i&&t.title)i.text(t.title);if(r&&t.classes_to_add)r.addClass(t.classes_to_add.join(" "))}});var e=$("BODY");var t=null;var n=null;var r=null;var i=null;var a=10;var s=0;var o=function o(l){n=$(l.currentTarget);var c=n.hasClass("ts_tip_multiline");n.addClass("ts_tip_hidden");if(0==n.children(".ts_tip_tip").length)p(n,c);n.removeAttr("title");n.removeClass("ts_tip_lazy");$("#ts_tip_float_floater").remove();if(n.hasClass("ts_tip_float")){var _=n.attr("class").split(/\s+/).filter(function(e){if("ts_tip_float"===e)return false;if("ts_tip_lazy"===e)return false;return 0===e.indexOf("ts_tip")});var m=TS.templates.builders.strBuilder('<div id="ts_tip_float_floater" style="width:${w}px; height:${h}px;" class="${classes}">${tip_html}</div>',{w:n.outerWidth(),h:n.outerHeight(),classes:_.join(" "),tip_html:n.find(".ts_tip_tip").clone()[0].outerHTML});r=$(m);e.append(r);s=setTimeout(function(){r.removeClass("ts_tip_hidden");d()},a);t=n.closest(":scrollable(vertical)");t.on("scroll.ts_tip_removal",u);n.on("destroyed.ts_tip_removal",u);if(n.hasClass("ts_tip_hide_on_click"))n.on("click.ts_tip_removal",u);if(c)i=r.find(".ts_tip_multiline_inner");else{i=r.find(".ts_tip_tip_inner");if(!i.length)i=r.find(".ts_tip_tip")}}else setTimeout(function(){n.removeClass("ts_tip_hidden")},a)};var l=function e(){u()};var u=function e(){clearTimeout(s);if(r)r.addClass("ts_tip_hidden");if(n&&n.length){n.off("click.ts_tip_removal");n.off("destroyed.ts_tip_removal")}if(t)t.off("scroll.ts_tip_removal");t=null;n=null;r=null;i=null};var d=function e(){var t=n.offset();var i=2;var a=window.innerWidth-i;var s=window.innerHeight-i;var o=r.hasClass("ts_tip_multiline");var l=function e(){if(o)return r.find(".ts_tip_multiline_inner").dimensions_rect();return r.find(".ts_tip_tip").dimensions_rect()};var u=function e(t){r.removeClass("\t\t\tts_tip_right \t\t\tts_tip_rightish \t\t\tts_tip_left \t\t\tts_tip_leftish \t\t\tts_tip_multiline_top_leftish \t\t\tts_tip_multiline_top_left \t\t\tts_tip_multiline_top_right \t\t\tts_tip_multiline_top_rightish \t\t").addClass(t)};r.css("left",t.left).css("top",t.top);var d=l();if(d.bottom>s)r.removeClass("ts_tip_bottom").addClass("ts_tip_top");else if(d.top<i)r.removeClass("ts_tip_top").addClass("ts_tip_bottom");if(o){if(d.right>a)u("ts_tip_multiline_top_rightish");else if(d.left<i)u("ts_tip_multiline_top_leftish");d=l();if(d.right>a)u("ts_tip_multiline_top_right");else if(d.left<i)u("ts_tip_multiline_top_left")}else{if(d.right>a)u("ts_tip_rightish");else if(d.left<i)u("ts_tip_leftish");d=l();if(d.right>a)u("ts_tip_right");else if(d.left<i)u("ts_tip_left")}};var c=function e(t){var n=m(t);var r="tip-toggle-auto";var i;if(t.data(r))i=t;else if(n.data(r))i=n;if(!(i&&i.length))return;var a=n.html();var s=i.data(r);if(!s)return TS.warn("No toggle state text defined on tipped element. Please add text to data-tip-toggle-text or data-tip-toggle-auto attribute");TS.tips.updateTipTitle(t,s);i.data(r,a)};var m=function e(t){var n=t.find(".ts_tip_multiline_inner");if(!n.length)n=t.find(".ts_tip_tip_inner");if(!n.length)n=t.find(".ts_tip_tip");return n};var f=function e(t){if(t.text().trim().length)return;if(t.attr("aria-label"))return;return _.uniqueId("ts_tip_tip_")};var p=function e(t,n){var r="";if(t.data("tip-member"))r=TS.templates["c-member"]({member:TS.members.getMemberById(t.data("tip-member")),size:"small",avatar:true,no_tip:true,dark:true});else{var i=t.prop("title");var a=f(t);var s=a?' id="'+a+'"':"";r=n?'<span class="ts_tip_multiline_inner">'+i+"</span>":i}var o=["<span",s,' class="ts_tip_tip"',">",r,"</span>"];t.append(o.join(""));t.attr("aria-labelledby",a)}})()},4198:function(e,t){(function(){"use strict";TS.registerModule("notifs",{onStart:function e(){},canCorGHaveChannelMentions:function e(t){var n=TS.channels.getChannelById(t)||TS.groups.getGroupById(t)||TS.mpims.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}return TS.notifs.canModelObHaveChannelMentions(n)},canModelObHaveChannelMentions:function e(t){if(t.is_im)return false;if("admin"===TS.model.team.prefs.who_can_at_channel||"owner"===TS.model.team.prefs.who_can_at_channel)return true;if(TS.channels.isChannelRequired(t)&&("admin"===TS.model.team.prefs.who_can_at_everyone||"owner"===TS.model.team.prefs.who_can_at_everyone))return true;if(t.is_general&&("admin"===TS.model.team.prefs.who_can_post_general||"owner"===TS.model.team.prefs.who_can_post_general))return true;var n=TS.notifs.getCalculatedCorGNotifySetting(t.id);if("mentions"!==n&&"nothing"!==n)return true;return!TS.notifs.hasUserSuppressedCorGChannelMentions(t)},hasUserSuppressedCorGChannelMentions:function e(t){var n=TS.model.at_channel_suppressed_channels.indexOf(t.id);if(-1!=n)return true;return false},hasUserSuppressedCorGChannelMentionsById:function e(t){var n=TS.channels.getChannelById(t)||TS.groups.getGroupById(t)||TS.mpims.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}return TS.notifs.hasUserSuppressedCorGChannelMentions(n)},hasUserSuppressedCorGPushChannelMentions:function e(t){var n=TS.channels.getChannelById(t)||TS.groups.getGroupById(t)||TS.mpims.getMpimById(t);if(!n){TS.error("no model_ob for c_id:"+t+"?");return true}var r=TS.model.push_at_channel_suppressed_channels.indexOf(n.id);if(-1!=r)return true;return false},isCorGMuted:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.muted_channels.indexOf(t)>-1)return true;return false},getGlobalPushNotificationSetting:function e(){if(TS.model.prefs.push_everything)return"everything";if(TS.model.prefs.push_mention_alert&&TS.model.prefs.push_dm_alert)return"dm_and_mentions";if(TS.model.prefs.push_mention_alert)return"mentions";if(TS.model.prefs.push_dm_alert)return"dms";return"nothing"},getCorGsNotUsingGlobalPushNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[]};var n;var r;var i={};var a;var s;var o="quiet";if(TS.model.prefs.push_mention_alert)o="mentions";if(TS.model.prefs.push_everything)o="loud";s=TS.model.prefs.push_loud_channels_set?TS.model.prefs.push_loud_channels_set.split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;i[a]="quiet"}s=TS.channels.getChannelsForUser();for(r=0;r<s.length;r+=1){if(!s[r])continue;a=s[r].id;if("mentions"!==TS.notifs.getCalculatedCorGPushNotifySetting(a))continue}s=TS.model.prefs.push_mention_channels?TS.model.prefs.push_mention_channels.split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;if(!i[a])continue;i[a]="mentions"}s=TS.model.prefs.push_loud_channels?TS.model.prefs.push_loud_channels.split(","):[];for(r=0;r<s.length;r+=1){a=$.trim(s[r]);if(!a)continue;if(!i[a])continue;i[a]="loud"}_.forOwn(i,function(e,r){n=TS.channels.getChannelById(r)||TS.groups.getGroupById(r)||TS.mpims.getMpimById(r);if(!n)return;if(n.is_archived)return;if(n.is_channel&&!n.is_member)return;if("loud"===e){if("loud"===o)return;t.everything.push(n)}else if("mentions"===e){if("mentions"===o)return;t.mentions.push(n)}else if("mentions_suppressed"===e);else{if("quiet"===o)return;t.nothing.push(n)}});return t},getGlobalNotificationSetting:function e(){if(!TS.model.prefs.growls_enabled)return"nothing";if(TS.model.prefs.all_channels_loud)return"everything";return"mentions"},getCorGsNotUsingGlobalNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[],muted:[],suppressed:[]};var n=TS.channels.getChannelsForUser();_.forOwn(n,function(e){if(e.is_archived)return;if(!e.is_member)return;if(r(e.id))t.nothing.push(e);if(i(e.id))t.mentions.push(e);if(a(e.id))t.everything.push(e);if(TS.notifs.isCorGMuted(e.id))t.muted.push(e);if(TS.notifs.hasUserSuppressedCorGChannelMentions(e))t.suppressed.push(e)});_.forOwn(TS.model.groups,function(e){if(e.is_archived)return;if(r(e.id))t.nothing.push(e);if(i(e.id))t.mentions.push(e);if(a(e.id))t.everything.push(e);if(TS.notifs.isCorGMuted(e.id))t.muted.push(e);if(TS.notifs.hasUserSuppressedCorGChannelMentions(e))t.suppressed.push(e)});_.forOwn(TS.model.mpims,function(e){if(e.is_archived)return;if(r(e.id))t.nothing.push(e);if(i(e.id))t.mentions.push(e);if(a(e.id))t.everything.push(e);if(TS.notifs.isCorGMuted(e.id))t.muted.push(e);if(TS.notifs.hasUserSuppressedCorGChannelMentions(e))t.suppressed.push(e)});return t},getCalculatedCorGNotifySetting:function r(i){if(!i){TS.error('wtf no c_id "'+i+'"');return false}var a=n(i);if(a){if(e(i))return"everything";if(t(i))return"nothing";return"mentions"}if(TS.model.prefs.growls_enabled){if(TS.model.prefs.all_channels_loud)return"everything";return"mentions"}return"nothing"},muteOrUnmuteCorG:function e(t){if(!t)return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var n=TS.shared.getModelObById(t);if(!n)return;if(n.is_im)return;var r=TS.notifs.isCorGMuted(t);if(!r){TS.notifs.makeCorGMuted(t);if(n.is_channel)TS.channels.markMostRecentReadMsg(n,TS.model.marked_reasons.muted);else if(n.is_mpim)TS.mpims.markMostRecentReadMsg(n,TS.model.marked_reasons.muted);else if(n.is_group)TS.groups.markMostRecentReadMsg(n,TS.model.marked_reasons.muted)}else TS.notifs.makeCorGNOTMuted(t);var i=TS.model.muted_channels.join(",");TS.prefs.onPrefChanged({name:"muted_channels",value:i});TS.prefs.setPrefByAPI({name:"muted_channels",value:i})},makeCorGMuted:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.muted_channels.indexOf(t);if(-1==a)TS.model.muted_channels.push(t);TS.prefs.setMutedChannels(TS.model.muted_channels.join(","));if(!TS.client)return;if(n)TS.channels.calcUnreadCnts(n);if(r)TS.groups.calcUnreadCnts(r);if(i)TS.mpims.calcUnreadCnts(i)},makeCorGNOTMuted:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.muted_channels.indexOf(t);if(-1!=a)TS.model.muted_channels.splice(a,1);TS.prefs.setMutedChannels(TS.model.muted_channels.join(","));if(!TS.client)return;if(n)TS.channels.calcUnreadCnts(n);if(r)TS.groups.calcUnreadCnts(r);if(i)TS.mpims.calcUnreadCnts(i)},makeCorGSuppressed:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.at_channel_suppressed_channels.indexOf(t);if(-1==a)TS.model.at_channel_suppressed_channels.push(t);TS.prefs.setSuppressedChannels(TS.model.at_channel_suppressed_channels.join(","));if(!TS.client)return;if(n)TS.channels.calcUnreadCnts(n);if(r)TS.groups.calcUnreadCnts(r);if(i)TS.mpims.calcUnreadCnts(i)},makeCorGNOTSuppressed:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.at_channel_suppressed_channels.indexOf(t);if(-1!=a)TS.model.at_channel_suppressed_channels.splice(a,1);TS.prefs.setSuppressedChannels(TS.model.at_channel_suppressed_channels.join(","));if(!TS.client)return;if(n)TS.channels.calcUnreadCnts(n);if(r)TS.groups.calcUnreadCnts(r);if(i)TS.mpims.calcUnreadCnts(i)},makeCorGPushSuppressed:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_at_channel_suppressed_channels.indexOf(t);if(-1==a)TS.model.push_at_channel_suppressed_channels.push(t);TS.prefs.setPushSuppressedChannels(TS.model.push_at_channel_suppressed_channels.join(","))},makeCorGNOTPushSuppressed:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_at_channel_suppressed_channels.indexOf(t);if(-1!=a)TS.model.push_at_channel_suppressed_channels.splice(a,1);TS.prefs.setPushSuppressedChannels(TS.model.push_at_channel_suppressed_channels.join(","))},makeCorGDTopNothing:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);if(-1!=a)TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);if(TS.model.prefs.growls_enabled){if(-1==a)TS.model.never_channels.push(t);u(t)}else{if(-1!=a)TS.model.never_channels.splice(a,1);d(t)}TS.prefs.setNeverChannels(TS.model.never_channels.join(","))},makeCorGDTopEverything:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.never_channels.indexOf(t);if(-1!=a)TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));a=TS.model.loud_channels.indexOf(t);if(TS.model.prefs.growls_enabled&&TS.model.prefs.all_channels_loud){if(-1!=a)TS.model.loud_channels.splice(a,1);d(t)}else{if(-1==a)TS.model.loud_channels.push(t);u(t)}TS.prefs.setLoudChannels(TS.model.loud_channels.join(","))},makeCorGDTopMentions:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);if(-1!=a)TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);if(-1!=a)TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));if(TS.model.prefs.growls_enabled&&!TS.model.prefs.all_channels_loud)d(t);else u(t)},makeCorGPushNothing:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_loud_channels.indexOf(t);if(-1!=a)TS.model.push_loud_channels.splice(a,1);TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","));a=TS.model.push_mention_channels.indexOf(t);if(-1!=a)TS.model.push_mention_channels.splice(a,1);TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","));if(TS.model.prefs.push_everything||TS.model.prefs.push_mention_alert)c(t);else m(t)},makeCorGPushEverything:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_mention_channels.indexOf(t);if(-1!=a)TS.model.push_mention_channels.splice(a,1);TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","));a=TS.model.push_loud_channels.indexOf(t);if(TS.model.prefs.push_everything){if(-1!=a)TS.model.push_loud_channels.splice(a,1);m(t)}else{if(-1==a)TS.model.push_loud_channels.push(t);c(t)}TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","))},makeCorGPushMentions:function e(t){var n=TS.channels.getChannelById(t);var r=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!n&&!r&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_loud_channels.indexOf(t);if(-1!=a)TS.model.push_loud_channels.splice(a,1);TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","));a=TS.model.push_mention_channels.indexOf(t);if(!TS.model.prefs.push_mention_alert||TS.model.prefs.push_everything){if(-1==a)TS.model.push_mention_channels.push(t);c(t)}else{if(-1!=a)TS.model.push_mention_channels.splice(a,1);m(t)}TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","))},getCalculatedCorGPushNotifySetting:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}var n=l(t);if(n){if(s(t))return"everything";if(o(t))return"mentions";return"nothing"}if(TS.model.prefs.push_everything)return"everything";if(TS.model.prefs.push_mention_alert)return"mentions";return"nothing"}});var e=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels.indexOf(t)>-1)return true;return false};var t=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.never_channels.indexOf(t)>-1)return true;return false};var n=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels_set&&TS.model.loud_channels_set.indexOf(t)>-1)return true;return false};var r=function e(t){if(TS.model.prefs.growls_enabled&&"nothing"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var i=function e(t){var n=TS.notifs.getCalculatedCorGNotifySetting(t);if("mentions"!==n)return false;if(!TS.model.prefs.growls_enabled||TS.model.prefs.all_channels_loud)return true;return false};var a=function e(t){if((!TS.model.prefs.growls_enabled||!TS.model.prefs.all_channels_loud)&&"everything"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var s=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels.indexOf(t)>-1)return true;return false};var o=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_mention_channels.indexOf(t)>-1)return true;return false};var l=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels_set&&TS.model.push_loud_channels_set.indexOf(t)>-1)return true;return false};var u=function e(t){var n=TS.model.loud_channels_set.indexOf(t);if(-1==n)TS.model.loud_channels_set.push(t);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var d=function e(t){var n=TS.model.loud_channels_set.indexOf(t);if(-1!=n)TS.model.loud_channels_set.splice(n,1);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var c=function e(t){var n=TS.model.push_loud_channels_set.indexOf(t);if(-1==n)TS.model.push_loud_channels_set.push(t);TS.prefs.setPushLoudChannelsSet(TS.model.push_loud_channels_set.join(","))};var m=function e(t){var n=TS.model.push_loud_channels_set.indexOf(t);if(-1!=n)TS.model.push_loud_channels_set.splice(n,1);TS.prefs.setPushLoudChannelsSet(TS.model.push_loud_channels_set.join(","))}})()},4199:function(e,t){(function(){"use strict";TS.registerModule("redux",{onStart:function t(){e=TS.interop.redux.configureStore();TS.redux.dispatch(TS.interop.redux.features.bootData.setBootData(TS.boot_data))},bindSingleArgSelectorToStore:function e(t){return function(e){if(arguments.length>1)throw new Error("bindSingleArgSelectorToStore only supports zero or one arguments");return t.call(void 0,TS.redux.getState(),e)}},getState:function t(){return e&&e.getState&&e.getState()},getStoreInstance:function t(){return e},dispatch:function t(n){if(n&&e&&e.dispatch)return e.dispatch(n)},test:function e(){var t={};return t}});var e})()},4200:function(e,t){(function(){"use strict";TS.registerModule("redux.all_unreads",{onStart:function e(){t()},updateHasUnreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreads(t))},updateHasUnreadThreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreadThreads(t))},updateThreadsMentionCount:function e(t){if(!_.isInteger(t))return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateThreadsMentionCount(t))}});function e(){TS.redux.all_unreads.updateHasUnreadThreads(TS.model.threads_has_unreads);TS.redux.all_unreads.updateThreadsMentionCount(TS.model.threads_mention_count)}function t(){if(_.get(TS,"client.threads.threads_unread_changed"))TS.client.threads.threads_unread_changed.add(e)}})()},4201:function(e,t){(function(){"use strict";TS.registerModule("redux.channels",{onStart:function a(){e=TS.interop.redux.entities.channels.isIm;t=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.channels.getAllChannels);n=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.channels.getChannelById);r=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.channelsMeta.channelNamesToIds.getChannelIdByName);i=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.channelsMeta.needsApiMarking.getAllIdsNeedingMarking);Object.defineProperty(TS.model,"channels",{get:function e(){return u("channels")}});Object.defineProperty(TS.model,"groups",{get:function e(){return u("groups")}});Object.defineProperty(TS.model,"mpims",{get:function e(){return u("mpims")}});Object.defineProperty(TS.model,"ims",{get:function e(){return u("ims")}})},forceUpdateOfEntityById:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.entities.channels.forceUpdateOfChannelById(t.id))},clearAllShowInListEvenThoughUnreadsFlags:function e(){TS.redux.dispatch(TS.interop.redux.entities.channels.clearAllShowInListEvenThoughUnreadsFlags())},dangerouslyGetEntityById:function e(t){return n(t)},dangerouslyGetChannelsForUser:function e(){var n=_.filter(t(),function(e){return e.is_channel});if(!TS.model.user.is_restricted)return n;return _.filter(n,"is_member")},dangerouslyGetGroups:function e(){return _.filter(t(),function(e){return e.is_group&&!e.is_mpim})},dangerouslyGetMpims:function e(){return _.filter(t(),function(e){return e.is_group&&e.is_mpim})},isChannel:function e(t){if(!t)return false;return t.is_channel},isMpim:function e(t){if(!t)return false;return t.is_group&&t.is_mpim},isGroup:function e(t){if(!t)return false;return t.is_group&&!t.is_mpim},isIm:function t(n){return e(n)},setMarkingState:function e(t,n){TS.redux.dispatch(TS.interop.redux.entities.channelsMeta.needsApiMarking.setMarkingState({id:t,needsApiMarking:n}))},clearAllMarkingFlags:function e(){TS.redux.dispatch(TS.interop.redux.entities.channelsMeta.needsApiMarking.clearAllMarkingFlags())},getAllIdsNeedingMarking:function e(){return i()},bulkAddEntities:function e(t){TS.redux.dispatch(TS.interop.redux.entities.channels.bulkAddChannels(t))},bulkUpdateEntities:function e(t){TS.redux.dispatch(TS.interop.redux.entities.channels.bulkUpdateChannels(t))},addEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var n="Attempting to add a channel interop object, not a channel. Only raw channel objects can be added. Take this to #devel-redux";if(l())throw new Error(n);else{TS.console.error(n);return}}TS.redux.dispatch(TS.interop.redux.entities.channels.addChannel(t))},removeEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){t=n(t.id);if(!t)return}TS.redux.dispatch(TS.interop.redux.entities.channels.removeChannel(t))},removeEntityFromNameMap:function e(t){TS.redux.dispatch(TS.interop.redux.entities.channelsMeta.channelNamesToIds.removeChannelFromNameMap({name:t}))},addEntityToNameMap:function e(t){if(!t||!t.id)return;var r=t._is_interop_channel_object?n(t.id):t;TS.redux.dispatch(TS.interop.redux.entities.channelsMeta.channelNamesToIds.addChannelToNameMap(r))},replaceEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var r="Attempting to replace a channel object with a channel interop object. If you are trying to update a property for this channel you should change the property directly. Take this to #devel-redux";if(l())throw new Error(r);else{TS.console.error(r);return}}var i=n(t.id);if(i)TS.redux.channels.removeEntity(i);TS.redux.channels.addEntity(t)},updateMutedChannels:function e(){var t=_.reduce(TS.model.muted_channels,function(e,t){e[t]=true;return e},{});TS.redux.dispatch(TS.interop.redux.entities.channelsMeta.mutedChannels.setMutedChannels(t))},getEntityById:function e(t){var r=n(t);return TS.redux.channels.interop.maybeWrapEntity(r)},getEntityByName:function e(t){var n=r(t);if(n)return TS.redux.channels.getEntityById(n);return null},getChannelById:function e(t){var n=TS.redux.channels.getEntityById(t);if(n&&n.is_channel)return n;return null},getChannelByName:function e(t){var n=TS.redux.channels.getEntityByName(t);if(n&&n.is_channel)return n;return null},getGroupById:function e(t){var n=TS.redux.channels.getEntityById(t);if(n&&n.is_group&&!n.is_mpim)return n;return null},getGroupByName:function e(t){var n=TS.redux.channels.getEntityByName(t);if(n&&n.is_group&&!n.is_mpim)return n;return null},getMpimById:function e(t){var n=TS.redux.channels.getEntityById(t);if(n&&n.is_group&&n.is_mpim)return n;return null},getMpimByName:function e(t){var n=TS.redux.channels.getEntityByName(t);if(n&&n.is_group&&n.is_mpim)return n;return null},getImById:function t(n){var r=TS.redux.channels.getEntityById(n);if(e(r))return r;return null},getImByMemberId:function t(n){var r=TS.redux.channels.getEntityByName(n);if(e(r))return r;return null},test:function e(){var t={};return t}});var e;var t;var n;var r;var i;var a;var s={};var o={channels:void 0,groups:void 0,mpims:void 0,ims:void 0};var l=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var u=function n(r){var i=t();var l;switch(r){case"channels":l=function e(t){return t.is_channel};break;case"groups":l=function e(t){return t.is_group&&!t.is_mpim};break;case"ims":l=e;break;case"mpims":l=function e(t){return t.is_group&&t.is_mpim}}if(i===a&&s[r])return s[r];if(i!==a){a=i;s={}}s[r]=_.filter(i,l);s[r]=_.map(s[r],TS.redux.channels.interop.maybeWrapEntity);if(!o[r])o[r]=_.defer(function(){delete s[r];delete o[r];a=null});return s[r]}})()},4202:function(e,t){(function(){"use strict";TS.registerModule("redux.channels.interop",{onStart:function t(){e=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.channels.getChannelById)},maybeWrapEntity:function e(t){if(!t||!t.id)return t;return T(t.id)},getSetCounts:function e(){return _.chain(t).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},getReduxSetCounts:function e(){return _.chain(n).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},test:function e(){var t={};return t}});var e;var t={};var n={};var r={};var i=function e(){var t=window.Proxy&&S();return t};var a=function e(t,n,r){if(!t||!n)return;var i={id:t};i[n]=r;TS.redux.dispatch(TS.interop.redux.entities.channels.updateOneKeyForChannel(i))};var s=["_show_in_list_even_though_no_unreads","deleted","has_draft","is_archived","is_channel","is_group","is_im","is_mpim","is_member","is_open","is_org_shared","is_self_im","is_shared","is_slackbot_im","is_starred","last_read","members","priority","unread_cnt","unread_highlight_cnt"];var o=["_archive_msgs","_checking_at_channel_status","_consistency_has_been_checked","_consistency_is_being_checked","_delayed_fetch_timer","_did_defer_initial_msg_history","_display_name_lc","_display_name_truncated","_has_auto_scrolled","_history_fetched_since_last_connect","_i18n_ns_history","_i18n_ns","_internal_name","_jumper_previous_name_match","_latest_via_users_counts","_mark_most_recent_read_timer","_marked_reason","_members","_mention_count_display_via_users_counts","_name_lc","_needs_unread_recalc","_prev_last_read","_score","_temp_last_read","_temp_unread_cnt","_users_counts_info","active_members","can_thread","create_channel","created","creator","date_created","enterprise_id","fetched_history_after_scrollback_time","has_fetched_history_after_scrollback","has_pins","history_changed","history_fetch_failed","history_fetch_retries","history_is_being_fetched","id","inviter","is_default","is_general","is_global_shared","is_limited","is_moved","is_non_threadable","is_org_default","is_org_mandatory","is_private","is_read_only","is_thread_only","last_made_active","last_msg_input","latest","length","member","msgs","name_normalized","name","needs_created_message","needs_invited_message","needs_joined_message","never_needs_joined_msg","note","num_members","old_name","oldest_msg_ts","opened_this_session","parent_group","pinned_items","pinned_items_count","presence","previous_names","purpose","scroll_top","shared_team_ids","team_url","tooltip","topic","unread_count_display","unread_count","unread_highlight_cnt_in_client","unread_highlights","unreads","user","was_archived_this_session"];if(TS.useReactSidebar())s.push("_display_name");else o.push("_display_name");var l=["_get","_is_interop_channel_object","_set","_setWithReduxAction","attributes","children","disabled","is_broadcast_keyword","is_divider","is_emoji","is_usergroup","is_view","nodeType","old_name","props_to_define","selector","then","title","toJSON","window"];var u=_.reduce(s,function(e,t){e[t]=true;return e},{});var d=_.reduce(o,function(e,t){e[t]=true;return e},{});var c=_.reduce(l,function(e,t){e[t]=true;return e},{});var m={};var f=function t(n,i){if(!d[i]&&!u[i]&&!c[i]&&_.isString(i)){TS.console.logStackTrace("Accessing an unknown key "+i+" on a model object");if(!r[i])r[i]=true;if(S())throw new Error("Dev only warning: Trying to get an unknown field "+i+" from a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #devel-redux");var a=e(n.id);return a&&a[i]}return n[i]};var p=function n(i,a,s){if(_.isString(a))t[a]=(t[a]||0)+1;if(!d[a]&&!u[a]&&_.isString(a)){TS.console.logStackTrace("Setting an unknown key "+a+" on a model object");if(!r[a])r[a]=true;if(S())throw new Error("Dev only warning: Trying to set an unknown field "+a+" on a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #devel-redux");var o=e(i.id);if(o)o[a]=s}i[a]=s;return true};var h=function e(t){this.id=t;Object.defineProperties(this,this.props_to_define)};var g={};_.without(o,"id").forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(n){return this._set(e,n)}};s.forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(n){return this._setWithReduxAction(e,n)}}})});h.prototype.props_to_define=g;h.prototype._is_interop_channel_object=true;h.prototype._get=function(t){var n=e(this.id);if(n)return n[t]};h.prototype._set=function(t,n){var r=e(this.id);if(r)r[t]=n;return true};h.prototype._setWithReduxAction=function(t,r){var i=e(this.id);if(i)if(i[t]!==r){a(this.id,t,r);n[t]=(n[t]||0)+1}return true};var S=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var T=function e(t){if(!t)throw new Error("Must pass in a valid id to _createWrappedEntityById");var n;var r=i();if(m[t])n=m[t];else{n=new h(t);if(r)n=new window.Proxy(n,{get:function e(t,n){return f(t,n)},set:function e(t,n,r){return p(t,n,r)}});m[t]=n}return n}})()},4203:function(e,t){(function(){"use strict";TS.registerModule("redux.presence",{onStart:function e(){n()},updatePresenceForMember:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:t.id,presence:t.presence}))},addToBulkUpsertPayload:function t(n){if(!n)return;var r=n.id;var i=n.presence;e.push({id:r,presence:i})},test:function e(){var t={};return t}});var e=[];var t=function t(){if(e.length){TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(e));e=[]}};var n=function e(){TS.members.presence_changed_sig.add(TS.redux.presence.updatePresenceForMember);TS.members.batch_upserted_sig.add(t)}})()},4204:function(e,t){(function(){"use strict";TS.registerModule("redux.custom_status",{onStart:function e(){n()},updateStatusForMember:function e(t){if(!(t&&t.id&&t.profile))return;TS.redux.dispatch(TS.interop.redux.features.customStatus.updateStatus({memberId:t.id,status:{emoji:t.profile.status_emoji,text:t.profile.status_text}}))},addToBulkUpsertPayload:function t(n){e.push(n)},test:function e(){var t={};return t}});var e=[];var t=function t(){if(e.length){TS.redux.dispatch(TS.interop.redux.features.customStatus.bulkUpdateStatus(e));e=[]}};var n=function e(){TS.members.changed_current_status_sig.add(TS.redux.custom_status.updateStatusForMember);TS.members.batch_upserted_sig.add(t)}})()},4205:function(e,t){(function(){"use strict";TS.registerModule("redux.dnd",{onStart:function t(){e=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.dnd.getDndByMemberId)},isMemberInDndById:function t(n){return e(n)},updateDndForMember:function e(t,n){if(!t)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDnd({memberId:t,isInDnd:n}))},test:function e(){var t={};return t}});var e})()},4206:function(e,t){(function(){"use strict";TS.registerModule("redux.members",{onStart:function r(){if(TS.useReduxMembers()){o();e=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.members.getAllMembers);t=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.members.getMemberById);n=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.members.getCurrentMember);Object.defineProperty(TS.model,"members",{get:function e(){return TS.redux.members.getAllMembers()},set:function e(){TS.error("TS.redux.members: trying to set TS.model.members???");return false}});Object.defineProperty(TS.model,"user",{get:function e(){return n()},set:function e(t){TS.warn("setting TS.model.user!!");TS.redux.members.addMember(t)}})}},getMemberById:function e(n){var r=t(n);if(!r||r.id!==n)return null;return r},getAllMembers:function t(){var n=e();if(n===r)return i;i=_.values(n);r=n;return i},addMember:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.entities.members.addMember(t))},addToBulkUpsertPayload:function e(t){a.push(t)},test:function e(){var t={};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return a},set:function e(t){a=t}});return t}});var e;var t;var n;var r;var i;var a=[];var s=function e(){if(a.length){TS.redux.dispatch(TS.interop.redux.entities.members.bulkAddMembers(a));a=[]}};var o=function e(){TS.members.batch_upserted_sig.add(s)}})()},4207:function(e,t){(function(){"use strict";TS.registerModule("redux.bots",{onStart:function n(){if(TS.useReduxMembers()){i();e=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.bots.getAllBots);t=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.entities.bots.getBotById);Object.defineProperty(TS.model,"bots",{get:function e(){return TS.redux.bots.getAllBots()},set:function e(){TS.error("TS.redux.bots: trying to set TS.model.bots???");return false}})}},getBotById:function e(n){var r=t(n);if(!r||r.id!==n)return null;return r},getAllBots:function t(){return _.values(e())},addBot:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.entities.bots.addBot(t))},addToBulkUpsertPayload:function e(t){n.push(t)},test:function e(){var t={};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return n},set:function e(t){n=t}});return t}});var e;var t;var n=[];var r=function e(){if(n.length){TS.redux.dispatch(TS.interop.redux.entities.bots.bulkAddBots(n));n=[]}};var i=function e(){TS.bots.batch_upserted_sig.add(r)}})()},4208:function(e,t){(function(){"use strict";TS.registerModule("redux.member_types",{onStart:function e(){n()},updateMemberTypeForMember:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.entities.memberTypesById.updateMemberType(t))},addToBulkUpdatePayload:function t(n){e.push(n)},test:function e(){var t={};return t}});var e=[];var t=function t(){if(e.length){TS.redux.dispatch(TS.interop.redux.entities.memberTypesById.bulkUpdateMemberType(e));e=[]}};var n=function e(){TS.members.changed_account_type_sig.add(TS.redux.member_types.updateMemberTypeForMember);TS.members.batch_upserted_sig.add(t)}})()},4209:function(e,t){(function(){"use strict";TS.registerModule("redux.prefs",{onStart:function e(){n()},setUserPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setUserPrefs(t))},setTeamPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setTeamPrefs(t))},test:function e(){var t={};return t}});var e=function e(){TS.redux.dispatch(TS.interop.redux.features.prefs.forcePrefRefresh())};var t=_.throttle(e,1e3);var n=function e(){var n=_.filter(TS.prefs,function(e,t){return t.indexOf("changed_sig")>-1});n.forEach(function(e){e.add(t)})}})()},4210:function(e,t){(function(){"use strict";TS.registerModule("redux.reactions",{updateReaction:function e(t,n){if(!t)return;TS.redux.dispatch(TS.interop.redux.entities.reactions.updateReaction({key:t,reactions:n}))},addToBulkUpsertPayload:function n(r,i){if(!r)return;if(!e)return;t.push({key:r,reactions:i})},isInBulkUpsertMode:function t(){return e},startBulkUpsert:function t(){if(e)return false;e=true;return true},finishBulkUpsert:function t(){if(!e)return false;n();e=false;return true}});var e=false;var t=[];var n=function e(){if(t.length){TS.redux.dispatch(TS.interop.redux.entities.reactions.bulkUpdateReaction(t));t=[]}}})()},4211:function(e,t){(function(){"use strict";TS.registerModule("redux.messages",{addMessages:function e(t,n,r){var i=_.some(t,function(e){var t=TS.redux.messages.getMessageByTimestamp(e.channel,e.ts);return!t});TS.redux.dispatch(TS.interop.redux.entities.messages.addMessages(t));if(n){var a=_.reject(t,TS.utility.msgs.isMsgHidden);if(_.isEmpty(a))return i;var s=a&&a[0]&&a[0].channel;var o=_.map(a,"ts");var l={};if(r)l={oldest:_.min(o),hasMore:false};TS.redux.dispatch(TS.interop.redux.entities.channelHistory.addTimestamps(_.assign({channelId:s,timestamps:o},l)))}return i},addMessage:function e(t,n){if(!t||!t.channel||!t.ts)return;var r=TS.redux.messages.getMessageByTimestamp(t.channel,t.ts);TS.redux.dispatch(TS.interop.redux.entities.messages.addMessages([t]));if(!TS.utility.msgs.isMsgHidden(t)){var i={channelId:t.channel,timestamps:[t.ts]};if(n){i.oldest=t.ts;i.hasMore=false;i.append=true}TS.redux.dispatch(TS.interop.redux.entities.channelHistory.addTimestamps(i))}return!r},replaceMessage:function e(t){if(!t||!t.channel||!t.ts)return;TS.redux.messages.addMessage(t)},removeMessage:function e(t){if(!t||!t.channel||!t.ts)return;TS.redux.dispatch(TS.interop.redux.entities.channelHistory.removeTimestamp({channelId:t.channel,timestamp:t.ts}));TS.redux.dispatch(TS.interop.redux.entities.messages.removeMessage(t))},getMessageByTimestamp:function e(t,n){if(!TS.interop.redux.entities.messages.getMessageByTimestamp)return null;return TS.interop.redux.entities.messages.getMessageByTimestamp(TS.redux.getState(),t,n)}})})()},4212:function(e,t){(function(){"use strict";TS.registerModule("redux.teams",{addTeam:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.entities.teams.addTeam(t))},getTeamById:function e(t){if(!TS.interop.redux.entities.teams.getTeamById)return null;return TS.interop.redux.entities.teams.getTeamById(TS.redux.getState(),t)},getTeamByEnterpriseId:function e(t){if(!TS.interop.redux.entities.teams.getTeamByEnterpriseId)return null;return TS.interop.redux.entities.teams.getTeamByEnterpriseId(TS.redux.getState(),t)},getTeamByDomain:function e(t){if(!TS.interop.redux.entities.teams.getTeamByDomain)return null;return TS.interop.redux.entities.teams.getTeamByDomain(TS.redux.getState(),t)}})})()},4213:function(e,t){(function(){"use strict";TS.registerModule("redux.socket",{onStart:function i(){if(!TS.useReactMessages())return;if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.connectedSig.add(e);TS.interop.SocketManager.disconnectedSig.add(t);TS.interop.SocketManager.troubleConnectingSig.add(n);TS.interop.SocketManager.waitingForRateLimitSig.add(r)}else{TS.ms.connected_sig.add(e);TS.ms.trouble_sig.add(n);TS.ms.disconnected_sig.add(t);TS.ms.reconnecting_sig.add(r)}},test:function t(){return{socketConnectedMS:e}}});var e=function e(t){TS.redux.dispatch(TS.interop.redux.features.socket.connected(t))};var t=function e(){TS.redux.dispatch(TS.interop.redux.features.socket.disconnected())};var n=function e(){TS.redux.dispatch(TS.interop.redux.features.socket.troubleConnecting())};var r=function e(){TS.redux.dispatch(TS.interop.redux.features.socket.reconnecting())}})()},4214:function(e,t){(function(){"use strict";TS.registerModule("channels",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,left_sig:new signals.Signal,member_left_sig:new signals.Signal,list_fetched_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,topic_changed_sig:new signals.Signal,purpose_changed_sig:new signals.Signal,created_sig:new signals.Signal,deleted_sig:new signals.Signal,renamed_sig:new signals.Signal,archived_sig:new signals.Signal,unarchived_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,data_retention_changed_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,data_updated_sig:new signals.Signal,addMsg:function e(t,n){var r=TS.channels.getChannelById(t);if(!r){TS.error('unknown channel "'+t+'"');return}if(TS.useReactMessages()){if(!TS.redux.messages.addMessage(n,true))return}else if(!TS.shared.addMsg(r,n))return;var i=!TS.utility.msgs.isTempMsg(n);TS.channels.calcUnreadCnts(r,i);TS.utility.msgs.maybeTruncateMsgs(r);TS.channels.message_received_sig.dispatch(r,n)},calcUnreadCnts:function e(t,n){TS.shared.calcUnreadCnts(t,TS.channels,n)},removeMsg:function e(t,n){var r=TS.channels.getChannelById(t);if(!r){TS.error('unknown channel "'+t+'"');return}if(r._archive_msgs)TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n);TS.channels.message_removed_sig.dispatch(r,n);TS.channels.calcUnreadCnts(r,true)},sendMsg:function e(t,n,r,i){var a;var s=TS.channels.getChannelById(t);if(!s)return false;if(s.is_archived)return false;if(!s.is_member)return false;var o=TS.channels.getGeneralChannel();var l=function e(t,i){if(i){var a={text:t,ephemeral_type:i,slackbot_feels:"sad_surprise"};TS.client.ui.addOrFlashEphemeralBotMsg(a)}else TS.generic_dialog.alert(t).then(function(){if(r)TS.ui.replies.focusReplyInput();else TS.view.focusMessageInput()});if(r){TS.ui.replies.populateReplyInput(n);TS.ui.replies.focusReplyInput()}else{TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}};if(s.is_general&&!TS.permissions.members.canPostInGeneral(TS.model.user)){var u=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("A Workspace Owner has restricted posting to the #*{channel_name}* channel.","channels")({channel_name:s.name}):TS.i18n.t("A Team Owner has restricted posting to the #*{channel_name}* channel.","channels")({channel_name:s.name});l(u,"general_posting_restricted");return false}var d=TS.format.cleanMsg(n);var c=!!r;var _=TS.model.here_regex.test(d);var m=TS.model.channel_regex.test(d)&&!c||TS.model.group_regex.test(d)&&!c||_;var f=TS.model.everyone_regex.test(d)&&!c||TS.channels.isChannelRequired(s)&&m;if(f){if(!TS.permissions.members.canAtMentionEveryone(s.id)){if(TS.model.user.is_restricted){a="<p>"+TS.i18n.t("Your account is restricted, and you cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";l(a);return false}if(!TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings(t))if(TS.boot_data.feature_teams_to_workspaces)a="<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";else a="<p>"+TS.i18n.t("A Team Owner has restricted the use of <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";else{if(TS.boot_data.feature_teams_to_workspaces)a="<p>"+TS.i18n.t("Usage of <b>{everyone}</b> is restricted to Workspace Admins in the large general channel.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";else a="<p>"+TS.i18n.t("Usage of <b>{everyone}</b> is restricted to Team Admins in the large general channel.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.metrics.count("stopped_loud_channel_mention")}if(!TS.channels.isChannelRequired(s)&&TS.permissions.members.canAtChannelOrGroup(s.id))a+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>";l(a);return false}if(!TS.channels.isChannelRequired(s)&&!_){if(!o||!o.is_member){a="<p>"+TS.i18n.t("You cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup(t))a+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>";l(a)}else TS.generic_dialog.start({title:TS.i18n.t("Send {everyone} a message","channels")({everyone:TS.templates.builders.atLabel("everyone")}),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('<p class="bold">Would you like to switch to #{general_channel} and send your message?</p>\t\t\t\t\t\t\t<p class="">Using <b>{everyone}</b> in a message is a way to address your entire workspace, but it must be done in the #{general_channel} channel.</p>\t\t\t\t\t\t\t<p class="no_bottom_margin">If you just want to address everyone in this channel, use <b>{channel}</b> instead.</p>',"channels")({general_channel:o.name,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}):TS.i18n.t('<p class="bold">Would you like to switch to #{general_channel} and send your message?</p>\t\t\t\t\t\t\t<p class="">Using <b>{everyone}</b> in a message is a way to address your whole team, but it must be done in the #{general_channel} channel.</p>\t\t\t\t\t\t\t<p class="no_bottom_margin">If you just want to address everyone in this channel, use <b>{channel}</b> instead.</p>',"channels")({general_channel:o.name,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, send it","channels")(),onGo:function e(){TS.channels.displayChannel({id:o.id,and_send_txt:n})},onCancel:function e(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}});return false}}if(m&&!TS.permissions.members.canAtChannelOrGroup(t)){var p=_?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");if(!TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(t))if(TS.boot_data.feature_teams_to_workspaces)a="<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <b>{key_word}</b> messages.","channels")({key_word:p})+"</p>";else a="<p>"+TS.i18n.t("A Team Owner has restricted the use of <b>{key_word}</b> messages.","channels")({key_word:p})+"</p>";else{if(TS.boot_data.feature_teams_to_workspaces)a="<p>"+TS.i18n.t("Usage of <b>{key_word}</b> is restricted to Workspace Admins in this large channel.","channels")({key_word:p})+"</p>";else a="<p>"+TS.i18n.t("Usage of <b>{key_word}</b> is restricted to Team Admins in this large channel.","channels")({key_word:p})+"</p>";TS.metrics.count("stopped_loud_channel_mention")}l(a);return false}if(!c&&TS.ui.needToShowAtChannelWarning(t,n)){TS.ui.at_channel_warning_dialog.startInMessagePane(t,n,TS.channels);return false}return TS.shared.sendMsg(t,n,TS.channels,r,i)},onSendMsg:function e(t,n){var r=TS.channels.getChannelById(n.SENT_MSG.channel);if(!r){TS.error("unknown channel? "+n.SENT_MSG.channel);return}TS.shared.onSendMsg(t,n,r,TS.channels)},displayChannel:function e(t){var n=_.defaults({},t,{from_history:false,replace_history_state:false});var i=n.id;if(!i){TS.error("no channel id supplied");return}var a=n.path;var s=n.and_send_txt;var o=n.from_history;var l=n.replace_history_state;if(TS.isPartiallyBooted()&&i!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+i);var u=TS.channels.getChannelById(i);if(!u){TS.error('channel "'+i+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);TS.shared.maybeClearHasAutoScrolled();if(i===TS.model.active_channel_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('channel "'+i+'" already displayed');if(s)TS.channels.sendMsg(i,$.trim(s));return}if(TS.has_pri[r])TS.log(r,"displayChannel: "+u.id);if(TS.shared.didDeferMessageHistoryById(u.id))TS.shared.checkInitialMsgHistory(u,TS.channels);if(!u.is_member){if(s){TS.model.requested_channel_joins[i]={and_send_txt:s};TS.channels.joinById(i);return}var d=TS.shared.getActiveModelOb();if(!(d.is_channel&&!d.is_member))TS.client.archives.previous_model_ob=d}var c=l?false:o;var m=TS.client.channelDisplaySwitched({id:i,path:a,replace_history_state:l,no_history_add:c});if(m)TS.channels.switched_sig.dispatch();if(s)TS.channels.sendMsg(i,$.trim(s))},setLastRead:function e(t,n,r){if(t.last_read===n)return false;if(n.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts: "+n);return false}var a=t.id+". last_read = "+t.last_read+" -> "+n+", reason: "+(r||"unspecified");if(t.last_read>n){var s=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n];if(s){TS.warn("NOT going back in time on channel "+a);return}if(TS.has_pri[i])TS.log(i,"going back in time on channel "+a,TS.console.getStackTrace());TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,n)}else{if(TS.has_pri[i])TS.log(i,"TS.channels.setLastRead: "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,n)}t.last_read=n;if(r)t._marked_reason=r;TS.channels.marked_sig.dispatch(t);TS.utility.msgs.maybeClearUsersCountsInfo(t);TS.channels.calcUnreadCnts(t);return true},markMostRecentReadMsg:function e(t,n,r){if(!t){TS.error("channel unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.entities.channels.markMostRecentMsgRead(t.id));return}if((!t.msgs||!t.msgs.length)&&!r)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){if(t.is_member&&(t.msgs&&t.msgs.length||!t._latest_via_users_counts))TS.warn('no valid tses for channel "'+t.id+'"???');return}TS.channels.markReadMsg(t.id,i,n)},markReadMsg:function e(t,n,r){var i=TS.channels.getChannelById(t);if(!i){TS.error('channel "'+t+'" unknown');return}if(i.last_read===n)return;if(TS.channels.setLastRead(i,n,r)){i._marked_reason=r;if(i.is_member){var a=true;TS.redux.channels.setMarkingState(i.id,a)}}},onMarked:function e(t,n,r){var i=TS.channels.getChannelById(r.channel);if(!i){TS.error('error: no channel "'+r.channel+'"');return}if(t||n&&("not_in_channel"===n.error||"is_archived"===n.error||"channel_not_found"===n.error));else{var a=true;TS.redux.channels.setMarkingState(i.id,a)}},create:function e(t,n){n=n||{};if(TS.model.user.is_restricted)return Promise.reject(new Error("restricted_action"));if(!t)return Promise.reject(new Error("required"));if(TS.model.created_channels[t])return Promise.reject(new Error("name_taken"));TS.model.created_channels[t]=true;return new Promise(function(e,r){return TS.api.call("channels.create",{name:t,validate:n.validate_name}).then(function(t){TS.channels.onJoin(t.data.ok,t.data,t.args);e(t);return null}).catch(function(e){delete TS.model.created_channels[t];r(e);return null})})},join:function e(t,n,r){r=r||{};if(TS.model.user.is_restricted)return Promise.reject(new Error("Account is restricted"));if(!t)return Promise.reject(new Error("No channel name given"));if(!TS.channels.getChannelByName(t)){if(TS.model.created_channels[t])return Promise.reject("Already joining");TS.model.created_channels[t]=true}return new Promise(function(e,i){return TS.api.call("channels.join",{name:t,_in_background:!!r.in_background,validate:!!r.validate}).then(function(t){TS.channels.onJoin(t.data.ok,t.data,t.args);if(n)n(t.data.ok,t.data,t.args);else e(t);return null}).catch(function(e){delete TS.model.created_channels[t];if(n)n(e.data.ok,e.data,e.args);else i(e);return null})})},joinById:function e(t,n,r){r=r||{};if(TS.model.user.is_restricted)return Promise.reject(new Error("Account is restricted"));if(!t)return Promise.reject(new Error("No channel id given"));if(!TS.channels.getChannelById(t)){if(TS.model.created_channel_ids[t])return Promise.reject("Already joining");TS.model.created_channel_ids[t]=true}return new Promise(function(e,i){return TS.api.call("channels.join",{channel:t,_in_background:!!r.in_background,validate:!!r.validate}).then(function(t){TS.channels.onJoin(t.data.ok,t.data,t.args);if(n)n(t.data.ok,t.data,t.args);else e(t);return null}).catch(function(e){delete TS.model.created_channel_ids[t];if(n)n(e.data.ok,e.data,e.args);else i(e);return null})})},onJoin:function e(t,n,r){if(!t){if("name_taken"===n.error);else if("is_archived"===n.error)TS.channels.displayChannel({id:TS.channels.getChannelByName(r.name).id});else if("restricted_action"===n.error)if(TS.boot_data.feature_teams_to_workspaces)TS.generic_dialog.alert(TS.i18n.t("<p>You don’t have permission to create new channels.</p><p>Talk to your Workspace Owner.</p>","channels")());else TS.generic_dialog.alert(TS.i18n.t("<p>You don’t have permission to create new channels.</p><p>Talk to your Team Owner.</p>","channels")());else{TS.error("failed to join channel");alert("failed to join channel")}return}var i;var a;if(n.channel){a=TS.channels.upsertChannel(n.channel);i=n.channel.id}if(!i){TS.error("no channel_id?!!");return}var s="";if(TS.model.requested_channel_joins[i]){s=TS.model.requested_channel_joins[i].and_send_txt;delete TS.model.requested_channel_joins[i]}if(!a){TS.error("no channel?!!");return}if(r._in_background)return;if(!a.needs_created_message&&!a.never_needs_joined_msg)a.needs_joined_message=true;if(TS.client)TS.channels.displayChannel({id:i,and_send_txt:s})},leave:function e(t){var n=TS.channels.getChannelById(t);if(!n)return;if(TS.boot_data.feature_default_shared_channels){var r=TS.permissions.channels.canMemberLeaveChannel(n,TS.model.user);if(!r){TS.generic_dialog.alert(TS.i18n.t("Sorry, you can’t leave <strong>#{channel_name}</strong>!","channels")({channel_name:n.name}));return}}if(TS.channels.isChannelRequired(n)||TS.model.user.is_restricted){TS.generic_dialog.alert(TS.i18n.t("Sorry, you can’t leave <strong>#{channel_name}</strong>!","channels")({channel_name:n.name}));return}else if(n.is_private){TS.generic_dialog.start({title:TS.i18n.t("Leave {channel_name}","channels")({channel_name:n.name}),body:TS.i18n.t("<p>If you leave the private channel, you will no longer be able to see any of its messages. To rejoin the private channel, you will have to be re-invited.</p><p>Are you sure you wish to leave?</p>","channels")(),go_button_text:TS.i18n.t("Yes, leave the private channel","channels")(),onGo:function e(){TS.api.call("channels.leave",{channel:t},TS.channels.onLeave)}});return}TS.channels.markMostRecentReadMsg(n,TS.model.marked_reasons.left);TS.client.markLastReadsWithAPI();TS.api.call("channels.leave",{channel:t},TS.channels.onLeave)},onLeave:function e(t,n,r){if(!t){TS.error("failed to leave channel");return}var i=TS.channels.getChannelById(r.channel);if(!i){TS.error('error no channel "'+r.channel+'"');return}i.msgs.length=0;if(i.is_limited)i.is_limited=false},closeMpim:function e(t){var n=TS.channels.getChannelById(t);if(!n)return;TS.api.call("conversations.close",{channel:t},TS.channels.onMpimClosed)},onMpimClosed:function e(t,n,r){if(!t)return;if(n.no_op){var i=TS.channels.getChannelById(r.channel);if(i)TS.mpims.closed_sig.dispatch(i)}},setTopic:function e(t,n){if(TS.boot_data.feature_name_tagging_client){n=TS.format.cleanMsg(n);TS.api.call("channels.setTopic",{channel:t,topic:n,name_tagging:true},TS.channels.onSetTopic)}else TS.api.call("channels.setTopic",{channel:t,topic:n},TS.channels.onSetTopic)},onSetTopic:function e(t){if(!t)TS.error("failed to set channel topic")},setPurpose:function e(t,n){if(TS.boot_data.feature_name_tagging_client){n=TS.format.cleanMsg(n);TS.api.call("channels.setPurpose",{channel:t,purpose:n,name_tagging:true},TS.channels.onSetPurpose)}else TS.api.call("channels.setPurpose",{channel:t,purpose:n},TS.channels.onSetPurpose)},onSetPurpose:function e(t,n){if(!t){TS.error("failed to set channel purpose");TS.channels.alertSetPurposeError(n.error)}},alertSetPurposeError:function e(t){var n;if("too_long"===t)n=TS.i18n.t("Oooops! That purpose is too long. Please try again with fewer than 250 characters.","channels")();else if("restricted_action"===t||"user_is_restricted"===t)n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Uh oh! You don’t have permission to change the purpose. Talk to your workspace admin.","channels")():TS.i18n.t("Uh oh! You don’t have permission to change the purpose. Talk to your team admin.","channels")();else n=TS.i18n.t("Uh oh! Something went wrong with setting the purpose. Please try again.","channels")();TS.generic_dialog.alert(n)},getChannelsFilteredBy:function e(t){return TS.shared.getEntitiesFilteredBy("channels",t)},getChannelById:function e(t){if(!t)return null;return TS.redux.channels.getChannelById(t)},getFirstChannelYouAreIn:function e(){var t=TS.model.channels;if(!t)return null;return _.find(t,"is_member")},getGeneralChannel:function e(){var t=TS.model.channels;if(!t)return null;return _.find(t,"is_general")},isChannelRequired:function e(t){return t.is_general||t.is_org_mandatory},isChannelOrgDefault:function e(t){if(t.is_shared&&TS.channels.isChannelRequired(t))return true;if(TS.boot_data.feature_default_shared_channels)return t.is_org_default;return false},getChannelByName:function e(t){return TS.redux.channels.getChannelByName(t)},upsertChannel:function t(n,r){return e(n,r)},removeChannel:function e(t){if(TS.has_pri[a])TS.log(a,'removing channel "'+t.id+'"');TS.redux.channels.removeEntity(t);if(TS.client)if(TS.model.active_channel_id===t.id)TS.client.activeChannelDisplayGoneAway();if(t.msgs)t.msgs.length=0;if(t.is_limited)t.is_limited=false;TS.channels.deleted_sig.dispatch(t)},channelRenamed:function e(t){var n=TS.channels.getChannelById(t.id);t.previous_names=[n._name_lc].concat(n.previous_names||[]);var r=TS.channels.upsertChannel(t);r._name_lc=_.toLower(r.name);TS.channels.renamed_sig.dispatch(r)},markScrollTop:function e(t,n){var r=TS.channels.getChannelById(t);if(!r)return false;if(r.scroll_top===n)return false;r.scroll_top=n;return true},maybeLoadScrollBackHistory:function e(t,n){var r=TS.channels.getChannelById(t);if(!r)return false;return TS.shared.maybeLoadScrollBackHistory(r,TS.channels,n)},onHistory:function e(t,n,r){var i=TS.channels.getChannelById(r.channel);if(!i){TS.error('error no channel "'+r.channel+'"');return}if(!t||!n||!n.messages){TS.error("failed to get history for channel "+r.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=2500;var s=5e3;var o=_.random(a,s);TS.info("retrying history fetch on channel "+i.id+" in "+o);window.setTimeout(function(){TS.info("retrying history fetch on channel "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.channels.fetchHistory(i,r,TS.channels.onHistory)},o);return}i.history_fetch_retries=0;var l=TS.shared.onHistory(i,n,r,TS.channels);if(!l){i.history_is_being_fetched=false;TS.channels.history_fetched_sig.dispatch(i)}var u=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.channels.calcUnreadCnts(i,u)},fetchHistory:function e(t,n,r){if(!t){TS.error('error no channel "'+t+'"');return}if(!TS.boot_data.feature_initial_scroll_position)TS.shared.maybeClearHasAutoScrolled(t);t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.channels.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){TS.error("giving up on channels.history for "+t.id+", channel.history_fetch_retries = "+t.history_fetch_retries);t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;if(TS.client)TS.client.msg_pane.updateEndMarker();return}if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.history",n,r||TS.channels.onHistory);else TS.api.call("channels.history",n,r||TS.channels.onHistory)},topicChanged:function e(t,n,r,i){if(!t.topic)t.topic={};t.topic.creator=n;t.topic.last_set=r;t.topic.value=i;TS.channels.topic_changed_sig.dispatch(t,n,i)},purposeChanged:function e(t,n,r,i){if(!t.purpose)t.purpose={};t.purpose.creator=n;t.purpose.last_set=r;t.purpose.value=i;TS.channels.purpose_changed_sig.dispatch(t,n,i)},closeArchivedChannel:function e(t){TS.shared.closeArchivedChannel(t)},makeMembersWithPreselectsForTemplate:function e(t,n){n=n||[];var r=[];for(var i=0;i<t.length;i+=1){var a=t[i];var s=-1!=n.indexOf(a.id);r[i]={member:a,preselected:s}}return r},fetchList:function e(){TS.api.call("channels.list",{exclude_members:1},TS.channels.onListFetched)},onListFetched:function e(t,n){if(!t){TS.error("failed to fetch channel list");return}var r=true;var i=_.map(n.channels,function(e){return TS.channels.upsertChannel(e,r)});if(i.length)TS.redux.channels.bulkAddEntities(_.compact(i));TS.channels.list_fetched_sig.dispatch(n.channels)},kickMember:function e(t,n){if(!TS.permissions.members.canKickFromChannels())return;var r=TS.channels.getChannelById(t);if(!r)return;return TS.shared.kickMember(r,n)},getChannelsForUser:function e(){var t=TS.model.channels;if(!TS.model.user.is_restricted)return t;return TS.channels.getChannelsUserIsIn()},getChannelsUserIsIn:function e(){var t=TS.model.channels;return _.filter(t,"is_member")},getUnarchivedChannelsForUser:function e(){var t=TS.channels.getChannelsForUser();return _.reject(t,"is_archived")},getAllVisibleMpimsForUser:function e(t){if(!t)t=TS.model.mpims;if(TS.boot_data.feature_shared_channels_client){var n=_.filter(TS.model.channels,function(e){if(e.is_mpim)return true});t=_.union(t,n)}return t.filter(function(e){if(e.is_open)return true;if(e.is_starred)return true;if(e.unread_cnt)return true;if(!e.latest&&(!e.msgs||!e.msgs.length))return false;if(e.members&&2===e.members.length)return false;if(TS.model.user.is_ultra_restricted)return true;return true})},setDataRetention:function e(t,n,r,i){var a={channel:t,retention_type:$("select[name=retention_type]").val()};if(1==a.retention_type)a.retention_duration=$("#retention_duration").val();TS.api.call("channels.setRetention",a,function(e,t,n){if(i)i(e,t,n);if(e)TS.channels.data_retention_changed_sig.dispatch(n)})},getDataRetention:function e(t,n){TS.api.call("channels.getRetention",{channel:t},n)}});var e=function e(r,i){var a=TS.channels.getChannelById(r.id);var o;delete r.unread_count;if(TS.boot_data.feature_tinyspeck&&"C00"===r.id)TS.warn("_upsertChannel() got a bad channel id of C00",r);if(a){a=_.assign({},TS.redux.channels.dangerouslyGetEntityById(r.id));if(TS.has_pri[s])TS.log(s,'updating existing channel "'+r.id+'"');for(var l in r)if("members"===l){if(!r.is_mpim)continue;o=r.members;if(r.is_shared)a.members=_.union(a.members,o);else{if(a.members.length!==o.length)TS.metrics.count("channel_upsert_membership_discrepancy");a.members.length=0;for(var u=0;u<o.length;u+=1)a.members.push(o[u])}}else if("pinned_items"===l){if(TS.client){if(r.pinned_items)TS.pins.upsertPinnedItems(r.pinned_items);a.pinned_items=r.pinned_items}}else a[l]=r[l];t(a);r=a;if(TS.isPartiallyBooted()&&null===r.oldest_msg_ts)r.oldest_msg_ts=TS.storage.fetchOldestTs(r.id);TS.shared.maybeResetHistoryFetched(r);if(TS.client&&r.is_member){var d=true;TS.shared.checkInitialMsgHistory(r,TS.channels,d)}if(!i)TS.redux.channels.replaceEntity(r)}else{n(r);if(!i)TS.redux.channels.addEntity(r);if(r.pinned_items&&TS.client)TS.pins.upsertPinnedItems(r.pinned_items)}if(r.is_member&&r.is_archived){TS.error("channel.is_member and channel.is_archived are both true for "+r.id);TS.dir(0,r);r.is_member=false}if(TS.client){var c=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(r);if(TS.model.active_cid===r.id)TS.channels.calcUnreadCnts(r,c);else if(!a)TS.channels.calcUnreadCnts(r,c)}return r};var t=function e(t){if(!t.is_shared)return;if(t.is_global_shared){if(t.shares)t.shares=void 0;if(t.shared_team_ids)t.shared_team_ids=void 0;return}if(t.shares&&TS.shared.isModelObOrgShared(t)){t.shared_team_ids=_(t.shared_team_ids||[]).concat(_.map(t.shares,"id")).value();if(t.shares)t.shares=void 0}else if(t.shares&&TS.shared.isModelObShared(t)){if(_.isArray(t.shares))if(_.isObject(t.shares[0]))t.shared_team_ids=_.map(t.shares,function(e){return e.team.id});else t.shared_team_ids=t.shares;else if(_.isObject(t.shares))t.shared_team_ids=_.map(t.shares,"team.id");if(t.shares)t.shares=void 0}t.shared_team_ids=_(t.shared_team_ids||[]).uniq().value();if(TS.shared.isModelObShared(t)&&t.shared_team_ids.length)TS.teams.ensureTeamsArePresent(t.shared_team_ids)};var n=function e(n){TS.shared.setPriorityForDev(n);n.is_channel=true;n.is_general=!!n.is_general;if(TS.boot_data.feature_default_shared_channels){n.is_org_mandatory=!!n.is_org_mandatory;n.is_org_default=!!n.is_org_default}n._name_lc=_.toLower(n.name);n._show_in_list_even_though_no_unreads=false;TS.shared.maybeResetHistoryFetched(n);if(!n.topic)n.topic={};if(!n.purpose)n.purpose={};n.is_member=!!n.is_member;n.scroll_top=-1;n.history_is_being_fetched=false;n.unread_highlight_cnt=0;n.unread_highlights=[];n.unread_cnt=0;n.unreads=[];TS.shared.setOldestUnreadTsForId(n.id,null);n.has_fetched_history_after_scrollback=false;if(TS.client)if(TS._incremental_boot&&n.msgs&&n.msgs.length>0){n.msgs=n.msgs.map(function(e){return TS.utility.msgs.processImsg(e,n.id)});TS.utility.msgs.setMsgs(n,n.msgs)}else TS.utility.msgs.setMsgs(n,[]);else if(TS.boot_data.msgs)TS.utility.msgs.ingestMessagesFromBootData(n);n.oldest_msg_ts=TS.storage.fetchOldestTs(n.id)||null;n.last_msg_input=TS.storage.fetchLastMsgInput(n.id)||null;n.has_draft=!!n.last_msg_input;if(TS.model.created_channels[n.name]){n.needs_created_message=true;delete TS.model.created_channels[n.name]}t(n)};var r=999;var i=142;var a=4;var s=5})()},4215:function(e,t){(function(){"use strict";TS.registerModule("membership",{membership_counts_need_refetch_sig:new signals.Signal,onStart:function e(){TS.channels.member_left_sig.add(d);TS.channels.member_joined_sig.add(u);TS.groups.member_left_sig.add(d);TS.groups.member_joined_sig.add(u);TS.channels.switched_sig.add(m);TS.groups.switched_sig.add(m);TS.ims.switched_sig.add(m);TS.mpims.switched_sig.add(m);TS.channels.joined_sig.add(f);TS.channels.left_sig.add(p);TS.groups.left_sig.add(p);var t=function e(){if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(h);else TS.ms.connected_sig.add(h)};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(t);else TS.ms.connected_sig.addOnce(t);var n=Infinity;TS.members.changed_deleted_sig.add(g,this,n);TS.members.non_loaded_changed_deleted_sig.add(g,this,n)},test:function n(){var s={};Object.defineProperty(s,"_channel_member_counts_info",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(s,"_promiseToGetChannelMemberCountsFromAPI",{get:function e(){return o},set:function e(t){o=t}});Object.defineProperty(s,"_isChannelMembershipKnownForUser",{get:function e(){return r},set:function e(t){r=t}});Object.defineProperty(s,"_getChannelMembershipForUser",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(s,"_setChannelKnownMembership",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(s,"_channel_known_member_statuses",{get:function e(){return t},set:function e(n){t=n}});return s},lazyLoadGroupMembership:function e(){return false},lazyLoadMpimMembership:function e(){return false},getUserChannelMembershipStatus:function e(t,n){if(!_.isString(t))throw new Error("Expected user_id to be a string");if(!_.isObject(n))throw new Error("Expected channel to be an object");if(n.is_im)return{is_known:true,is_member:t==TS.boot_data.user_id||t==n.user};if(r(n.id,t))return{is_known:true,is_member:i(n.id,t)};var a={is_known:false};Object.defineProperty(a,"is_member",{get:function e(){throw new Error("Value for is_member is not known; check is_known before accessible this field")}});return a},setUserChannelMembership:function e(t,n,r){if(!_.isString(t))throw new Error("Expected user_id to be a string");return a(n.id,t,r)},ensureChannelMembershipIsKnownForUsers:function e(t,n){var r=s(t,n);if(0===r.length)return Promise.resolve(false);return TS.flannel.fetchChannelMembershipForUsers(t,r).then(function(e){_.forEach(e,function(e,n){a(t,n,e)});return true})},isChannelMembershipKnownForUsers:function e(t,n){var r=s(t,n);return 0===r.length},notifyChannelMembershipChanged:function e(t,n,r,i){var a=TS.members.getMemberById(t);if(!a){var s=r?"joined":"left";TS.warn("User "+t+" "+s+" channel "+n.id+" but we don’t have that user in our model");return}if(r)TS.channels.member_joined_sig.dispatch(n,a,!i);else TS.channels.member_left_sig.dispatch(n,a)},promiseToGetMembershipCounts:function e(t){var n=TS.membership.getMembershipCounts(t);if(n.promise)return n.promise.then(function(){return Promise.resolve(TS.membership.getMembershipCounts(t).counts)});return Promise.resolve(n.counts)},getMembershipCounts:function t(n){e[n.id]=e[n.id]||{};var r=e[n.id];var i=!r.promise&&(!r.counts||r.should_refetch);if(i){r.should_refetch=false;r.promise=o(n,r.last_fetched_ts||0).then(function(e){r.counts=e;delete r.promise;if(r.should_refetch)TS.membership.getMembershipCounts(n);r.last_fetched_ts=Date.now();return null})}return r}});var e={};var t={};var n={};var r=function e(n,r){if(!t[n])return false;return _.includes(t[n].known_members,r)||_.includes(t[n].known_non_members,r)};var i=function e(n,r){if(t[n]&&_.includes(t[n].known_members,r))return true;else if(t[n]&&_.includes(t[n].known_non_members,r))return false;throw new Error("Channel membership not known for the given user; this is a programming error")};var a=function e(n,a,s){if(!_.isString(n))throw new Error("model_ob_id should be a string");if(!_.isString(a))throw new Error("user_id should be a string");if(!_.isBoolean(s))throw new Error("is_member should be a boolean");if(!t[n])t[n]={known_members:[],known_non_members:[]};if(r(n,a)&&i(n,a)==s)return false;if(TS.has_pri[T])TS.log(T,"Noting "+a+" ("+_.get(TS.members.getMemberById(a),"name","(member not loaded)")+") "+(s?"is":"is NOT")+" a member of "+n);if(s){t[n].known_members.push(a);_.pull(t[n].known_non_members,a)}else{t[n].known_non_members.push(a);_.pull(t[n].known_members,a)}return true};var s=function e(t,n){if(!_.isString(t))throw new Error("Expected channel_id to be a string");if(!_.isArray(n))throw new Error("Expected user_ids to be an array");if(n.length>0&&!_.isString(n[0]))throw new Error("Expected user_ids to be an array of strings");if("D"===t[0])return[];var i=n.filter(function(e){return!r(t,e)});return i};var o=function e(t,r){if(!t)return Promise.reject(new Error("Cannot fetch member counts without model_ob"));if(TS.interop.utility.looksLikeMemberId(t.id))return Promise.reject(new Error("Cannot fetch member counts on user objects"));var i=1e4;var a=Date.now()-r;var s=n[t.id];if(s)return s;if(a<i)s=new Promise(function(e){if(TS.has_pri[S])TS.log(S,"Channel member counts ("+t.id+"): it’s only been "+a+"ms since last fetch; waiting "+(i-a)+" ms before fetching");setTimeout(e,i-a)});else s=Promise.resolve();n[t.id]=s.then(function(){if(TS.has_pri[S])TS.log(S,"Channel member counts ("+t.id+"): fetching counts from API");return TS.flannel.fetchMembershipCountsForChannel(t.id).then(function(e){if(!e)throw new Error("Invalid membership counts response from flannel!");if(TS.has_pri[S])TS.log(S,"Channel member counts from flannel ("+t.id+"): "+JSON.stringify(e));return{member_count:e.members,restricted_member_count:e.guests,teams_member_count:e.external_teams}}).catch(function(){var e=Date.now();n[t.id]=null;return o(t,e)}).finally(function(){n[t.id]=null})});return n[t.id]};var l=function t(n,r,i){var a=e[n.id];if(!a)return;a.should_refetch=true;if(a.counts){a.counts.member_count+=r;if(i)a.counts.restricted_count+=r}};var u=function e(t,n){var r=1;l(t,r,n.is_restricted);a(t.id,n.id,true)};var d=function e(t,n){var r=-1;l(t,r,n.is_restricted);a(t.id,n.id,false)};var c;var m=function t(){if(c){var n=TS.shared.getModelObById(c);if(n&&n.is_channel&&!n.is_member){if(TS.has_pri[S])TS.log(S,"Channel member counts ("+n.id+"): removing local counts because we switched away and we are not a member");delete e[n.id]}}c=TS.shared.getActiveModelOb().id};var f=function e(t){u(t,TS.model.user)};var p=function n(r){if(TS.has_pri[S])TS.log(S,"Channel member counts ("+r.id+"): removing local counts because we left the channel");delete e[r.id];delete t[r.id]};var h=function r(i){if(i)return;var a=TS.shared.getActiveModelOb();var s;if(a&&a.id){s=e[a.id]||{};s.should_refetch=true}e={};t={};n={};if(a&&a.id)e[a.id]=s;TS.membership.membership_counts_need_refetch_sig.dispatch()};var g=function t(){_.forEach(e,function(e){e.should_refetch=true})};var S=1989;var T=1990})()},4216:function(e,t){(function(){"use strict";TS.registerModule("channels.read_only",{list_updated_sig:new signals.Signal,updateList:function e(t){if(!t||!_.isArray(t))return;var n=_.uniq(t);var r=_.difference(n,TS.model.read_only_channels);var i=_.difference(TS.model.read_only_channels,n);i.forEach(function(e){var t=TS.shared.getModelObById(e);if(!t)return;var n=_.assign({},t,{is_read_only:false});if(t.is_private)TS.groups.upsertGroup(n);else TS.channels.upsertChannel(n)});r.forEach(function(e){var t=TS.shared.getModelObById(e);if(!t)return;var n=_.assign({},t,{is_read_only:true});if(t.is_private)TS.groups.upsertGroup(n);else TS.channels.upsertChannel(n)});TS.model.read_only_channels=n;TS.channels.read_only.list_updated_sig.dispatch()},addChannelToList:function e(t){TS.model.read_only_channels=_.uniq(_.concat(TS.model.read_only_channels,t));TS.channels.read_only.list_updated_sig.dispatch()},removeChannelFromList:function e(t){TS.model.read_only_channels=TS.model.read_only_channels.filter(function(e){return e!==t});TS.channels.read_only.list_updated_sig.dispatch()},isReadOnly:function e(t){if(TS.boot_data.page_needs_enterprise){if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return false}else if(TS.model.user.owner)return false;var n=TS.shared.getModelObById(t);if(!n)return false;if(n.is_im||n.is_mpim)return false;if(!_.isUndefined(n.is_read_only))return n.is_read_only;return TS.model.read_only_channels.indexOf(t)>-1}})})()},4217:function(e,t){(function(){"use strict";TS.registerModule("channels.ui",{onStart:function e(){},showDataRetentionDialog:function r(i,o,l,u){var d=!l;var c=TS.shared.getModelObById(i);if(!c){TS.error("unknown channel_id passed to data retention dialog:"+i);return}var m;var f;if(c.is_im||c.is_mpim){f="conversation";m="this conversation"}else if(c.is_group||c.is_private){f="channel";m=_.escape(c.name)}else{f="channel";m="#"+_.escape(c.name)}var p=TS.model.team.prefs.retention_type;var h=TS.model.team.prefs.retention_duration;if(c.is_im||c.is_mpim){p=TS.model.team.prefs.dm_retention_type;h=TS.model.team.prefs.dm_retention_duration}else if(c.is_group||c.is_private){p=TS.model.team.prefs.group_retention_type;h=TS.model.team.prefs.group_retention_duration}var g=s();if(!d)g=TS.templates.channel_data_retention_dialog({model_type:f,retention_type:l,retention_duration:u,team_type:p,team_duration:h});TS.generic_dialog.start({title:TS.i18n.t("Edit retention policy for {channel_name}","channels")({channel_name:m}),body:g,go_button_text:TS.i18n.t("Save settings","channels")(),enter_always_gos:true,onGo:function e(){var t=$("select[name=retention_type]").val();var n=$("#retention_duration").val();if(null===t)return;if(null===n)return;var r=TS.shared.getControllerForModelOb(c);if(_.isFunction(r.setDataRetention))r.setDataRetention(i,t,n,o)},onShow:d?null:a});if(d)if(c.is_im)TS.ims.getDataRetention(i,n);else if(c.is_mpim)TS.mpims.getDataRetention(i,n);else if(c.is_group)TS.groups.getDataRetention(i,t);else TS.channels.getDataRetention(i,e)},showArchiveChannelDialog:function e(t){TS.generic_dialog.start({title:TS.i18n.t("Archive #{channel_name}","channels")({channel_name:t.name}),body:TS.templates.channel_option_archive({name:t.name}),go_button_text:TS.i18n.t("Yes, archive the channel","channels")(),onGo:function e(){TS.api.call("channels.archive",{channel:t.id},function(e,t){if(e){if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var n=TS.i18n.t("Archiving failed with error: {error}","channels")({error:t.error});if("last_ra_channel"===t.error)if(TS.model.user.is_admin)n=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")();else n=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to.","channels")();else if("restricted_action"===t.error)if(TS.boot_data.feature_teams_to_workspaces)n=TS.i18n.t("<p>You don’t have permission to archive channels.</p><p>Talk to your Workspace Owner.</p>","channels")();else n=TS.i18n.t("<p>You don’t have permission to archive channels.</p><p>Talk to your Team Owner.</p>","channels")();else if("already_archived"===t.error)n=TS.i18n.t("This channel was already archived.","channels")();else if("cant_archive_general"===t.error)n=TS.i18n.t("This channel cannot be archived.","channels")();setTimeout(TS.generic_dialog.alert,500,n)})}})},showArchiveGroupDialog:function e(t,n){var r=TS.i18n.t("{leave, select, true{Leave and archive}other{Archive}} {prefix}{name}","channels")({leave:n,prefix:TS.model.group_prefix,name:t.name});var i=TS.i18n.t("{leave, select, true{Yes, leave & archive the channel}other{Yes, archive the channel}}","channel")({leave:n});TS.generic_dialog.start({title:r,body:TS.templates.channel_option_archive({name:t.name,group_prefix:TS.model.group_prefix}),go_button_text:i,onGo:function e(){TS.api.call("groups.archive",{channel:t.id},function(e,r){if(e){if(n&&TS.client)TS.shared.closeArchivedChannel(t.id);if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var i=TS.i18n.t("Archiving failed with error: {error}","channels")({error:r.error});if("last_ra_channel"===r.error)if(TS.model.user.is_admin)i=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")();else i=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to.","channels")();else if("already_archived"===r.error)i=TS.i18n.t("This channel was already archived.","channels")();else if("restricted_action"===r.error)if(TS.boot_data.feature_teams_to_workspaces)i=TS.i18n.t("<p>You don’t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")();else i=TS.i18n.t("<p>You don’t have permission to archive private channels.</p><p>Talk to your Team Owner.</p>","channels")();setTimeout(TS.generic_dialog.alert,500,i)})}})},channelCreateDialogShowNameTakenAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".name_taken_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowDisallowedCharsAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".invalid_chars_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowSinglePunctuationAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".single_punctuation_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowOtherErrorAlert:function e(t,n){if(!n)n=TS.i18n.t("Sorry! Something went wrong.","channels")();t.find(".modal_input_note").addClass("hidden");t.find(".other_error").removeClass("hidden").find(".error_message").text(n)},channelCreateDialogCleanName:function e(t){var n=t.find(".title_input").val();var r=TS.utility.cleanChannelName(n);while("#"===n.substr(0,1))n=n.substr(1);if(r!=n){t.find(".title_input").val(r);TS.channels.ui.channelCreateDialogShowDisallowedCharsAlert(t);return false}return true},channelCreateDialogValidateInput:function e(t){var n=t.find(".title_input").val();var r=TS.utility.cleanChannelName(n);if(!TS.channels.ui.channelCreateDialogCleanName(t))return false;if("_"===r||"-"===r){TS.channels.ui.channelCreateDialogShowSinglePunctuationAlert(t);return false}if(!n){$("#channel_create_title").select();return false}if(TS.channels.getChannelByName(n)||TS.groups.getGroupByName(n)||TS.members.getMemberByName(n)){TS.channels.ui.channelCreateDialogShowNameTakenAlert(t);return false}return true}});var e=function e(t,n){if(t){var a=n.retention.retention_type;var s=n.retention.retention_duration;r("channel",a,s)}else i("channel",n)};var t=function e(t,n){if(t){var a=n.retention.retention_type;var s=n.retention.retention_duration;r("group",a,s)}else i("group",n)};var n=function e(t,n){if(t){var a=n.retention.retention_type;var s=n.retention.retention_duration;r("conversation",a,s)}else i("conversation",n)};var r=function e(t,n,r){var i=$("#generic_dialog .loading_hash_animation");var s=TS.model.team.prefs.retention_type;var o=TS.model.team.prefs.retention_duration;if("group"===t){s=TS.model.team.prefs.group_retention_type;o=TS.model.team.prefs.group_retention_duration}else if("conversation"===t){s=TS.model.team.prefs.dm_retention_type;o=TS.model.team.prefs.dm_retention_duration}if("group"===t)t="channel";i.replaceWith(TS.templates.channel_data_retention_dialog({model_type:t,retention_type:n,retention_duration:r,team_type:s,team_duration:o}));a()};var i=function e(t,n){var r=$("#generic_dialog .loading_hash_animation");if("no_perms"===n.error||"is_archived"===n.error||"not_paid"===n.error){if("group"===t)t="channel";r.replaceWith('<p class="no_bottom_margin">'+TS.i18n.t("Sorry! You can’t change the retention duration for this {model_type, select, conversation {conversation} other {channel}}.","channels")({model_type:t})+"</p>")}else r.replaceWith('<p class="no_bottom_margin">'+TS.i18n.t("Oops! Something went wrong. Please try again.","channels")()+"</p>")};var a=function e(){$("select[name=retention_type]").change(function(){if(1!=this.value){$("#team_retention_pref").removeClass("hidden");$("#retention_duration_container, #retention_duration_warning").addClass("hidden")}else{$("#team_retention_pref").addClass("hidden");$("#retention_duration_container, #retention_duration_warning").removeClass("hidden");if(0===$("#retention_duration").val())$("#retention_duration").val("");$("#retention_duration").focus()}}).change()};var s=function e(){var t=cdn_url+"/9c217/img/loading_hash_animation_@2x.gif";var n=TS.i18n.t("Loading...","channels")();return'<div class="loading_hash_animation" style="margin: 2rem;"><img src="'+t+'" alt="'+n+'" /><br />'+n+"</div>"}})()},4220:function(e,t){(function(){"use strict";TS.registerModule("groups",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,left_sig:new signals.Signal,member_left_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,topic_changed_sig:new signals.Signal,purpose_changed_sig:new signals.Signal,deleted_sig:new signals.Signal,renamed_sig:new signals.Signal,opened_sig:new signals.Signal,closed_sig:new signals.Signal,archived_sig:new signals.Signal,unarchived_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,data_retention_changed_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,addMsg:function e(t,n){var r=TS.groups.getGroupById(t);if(!r){TS.error('unknown group "'+t+'"');return}if(TS.useReactMessages()){if(!TS.redux.messages.addMessage(n,true))return}else if(!TS.shared.addMsg(r,n))return;var i=!TS.utility.msgs.isTempMsg(n);TS.groups.calcUnreadCnts(r,i);TS.utility.msgs.maybeTruncateMsgs(r);TS.groups.message_received_sig.dispatch(r,n);if(!r.is_open)if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.open",{channel:r.id});else TS.api.call("groups.open",{channel:r.id})},calcUnreadCnts:function e(t,n){TS.shared.calcUnreadCnts(t,TS.groups,n)},removeMsg:function e(t,n){var r=TS.groups.getGroupById(t);if(!r){TS.error('unknown group "'+t+'"');return}if(r._archive_msgs)TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n);TS.groups.message_removed_sig.dispatch(r,n);TS.groups.calcUnreadCnts(r,true)},sendMsg:function e(t,n,r,i){return TS.shared.sendMsgGroup(t,n,TS.groups,r,i)},onSendMsg:function e(t,n){var r=TS.groups.getGroupById(n.SENT_MSG.channel);if(!r){TS.error("unknown group? "+n.SENT_MSG.channel);return}TS.shared.onSendMsg(t,n,r,TS.groups)},displayGroup:function e(t){var n=_.defaults({},t,{from_history:false,replace_history_state:false});var i=n.id;if(!i){TS.error("no group id supplied");return}var a=n.path;var s=n.and_send_txt;var o=n.from_history;var l=n.replace_history_state;if(TS.isPartiallyBooted()&&i!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+i);var u=TS.groups.getGroupById(i);if(!u){TS.error('group "'+i+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);TS.shared.maybeClearHasAutoScrolled();if(TS.shared.didDeferMessageHistoryById(u.id))TS.shared.checkInitialMsgHistory(u,TS.groups);if(TS.has_pri[r])TS.log(r,"displayGroup "+u.id+" from_history:"+o+" replace_history_state:"+l);if(i===TS.model.active_group_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('group "'+i+'" already displayed');if(s)TS.groups.sendMsg(i,$.trim(s));return}var d=l?false:o;var c=a||"/messages/"+u;var m=TS.client.channelDisplaySwitched({id:i,path:c,replace_history_state:l,no_history_add:d});if(m)TS.groups.switched_sig.dispatch();if(u.is_open){if(s)TS.groups.sendMsg(i,$.trim(s));return}TS.model.requested_group_opens[i]={and_send_txt:s};if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.open",{channel:u.id});else TS.api.call("groups.open",{channel:u.id})},setLastRead:function e(t,n,r){if(t.last_read===n)return false;if(n.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+n);return false}var a=t.id+". last_read = "+t.last_read+" -> "+n+", reason: "+(r||"unspecified");if(t.last_read>n){var s=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n];if(s){TS.warn("NOT going back in time on group "+a);return}if(TS.has_pri[i])TS.log(i,"going back in time on group "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,n)}else{if(TS.has_pri[i])TS.log(i,"TS.groups.setLastRead: "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,n)}t.last_read=n;if(r)t._marked_reason=r;TS.groups.marked_sig.dispatch(t);TS.utility.msgs.maybeClearUsersCountsInfo(t);TS.groups.calcUnreadCnts(t);return true},markMostRecentReadMsg:function e(t,n,r){if(!t){TS.error("group unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.entities.channels.markMostRecentMsgRead(t.id));return}if((!t.msgs||!t.msgs.length)&&!r)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){if(t.msgs&&t.msgs.length||!t._latest_via_users_counts)TS.warn('no valid tses for group "'+t.id+'"???');return}TS.groups.markReadMsg(t.id,i,n)},markReadMsg:function e(t,n,r){var i=TS.groups.getGroupById(t);if(!i){TS.error('group "'+t+'" unknown');return}if(i.last_read===n)return;if(TS.groups.setLastRead(i,n,r)){i._marked_reason=r;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},onMarked:function e(t,n,r){var i=TS.groups.getGroupById(r.channel);if(!i){TS.error('error no group "'+r.channel+'"');return}if(t||n&&"is_archived"===n.error);else{var a=true;TS.redux.channels.setMarkingState(i.id,a)}},create:function e(t,n){n=n||{};if(!t)return;TS.model.created_groups[t]=true;var r=n.and_invite_members_idsA?n.and_invite_members_idsA.join(","):"";return new Promise(function(e,i){TS.api.call("groups.create",{name:t,_and_invite_members_ids:r,validate:n.validate}).then(function(t){e(t);TS.groups.onCreate(t.data.ok,t.data,t.args);return null}).catch(function(e){i(e);return null})})},createChild:function e(t,n,r){var i=TS.groups.getGroupById(t);if(!i)return;TS.model.archives_and_recreated_groups[t]=true;var a=n?n.join(","):"";TS.api.call("groups.createChild",{channel:t,_and_invite_members_ids:a},function(e,t,n){TS.groups.onCreate(e,t,n);if(r)r(e,t,n)})},onCreate:function e(t,n,r){if(!t){if("name_taken"===n.error);else if("restricted_action"===n.error);else TS.error("failed to create group");return}var i;var a;if(n.group){i=TS.groups.upsertGroup(n.group);a=n.group.id}if(!a){TS.error("no group_id?!!");return}if(!i){TS.error("no group?!!");return}var s=r._and_invite_members_ids?r._and_invite_members_ids.split(","):null;if(s)TS.api.call("groups.invite",{channel:a,users:s.join(",")});if(TS.client)TS.groups.displayGroup({id:a})},getLeaveAction:function e(t){if(TS.model.user.is_ultra_restricted)return"";if(!TS.groups.canLeaveGroup(t))return"";var n=TS.groups.getGroupById(t);if(n.is_archived)return"close";var r=n.active_members.filter(function(e){var t=TS.members.getMemberById(e);return!t.is_bot});if(1===r.length)return"leave_and_archive";return"leave"},leave:function e(t){var n=TS.groups.getGroupById(t);if(!n){TS.error("WTF no group:"+t);return}if(TS.boot_data.feature_default_shared_channels){var r=TS.permissions.channels.canMemberLeaveChannel(n,TS.model.user);if(!r){TS.generic_dialog.alert(TS.i18n.t("Sorry, you can’t leave <strong>{group_name}</strong>!","channels")({group_name:TS.model.group_prefix+n.name}));return}}var i=TS.groups.getLeaveAction(t);if("close"===i)TS.shared.closeArchivedChannel(t);else if("leave_and_archive"===i)TS.channels.ui.showArchiveGroupDialog(n,true);else if("leave"===i)TS.generic_dialog.start({title:TS.i18n.t("Leave {group}","groups")({group:TS.model.group_prefix+n.name}),body:TS.i18n.t("<p>If you leave the private channel, you will no longer be able to see any of its messages. To rejoin the private channel, you will have to be re-invited.</p><p>Are you sure you wish to leave?</p>","groups")(),go_button_text:TS.i18n.t("Yes, leave the private channel","groups")(),onGo:function e(){TS.api.call("groups.leave",{channel:t},TS.groups.onLeave)}});else TS.generic_dialog.alert(TS.i18n.t("Sorry, you can’t leave <strong>{group}</strong>!","groups")({group:TS.model.group_prefix+n.name}))},onLeave:function e(t,n,r){if(!t){if(n&&"last_member"===n.error){TS.shared.closeArchivedChannel(r.channel);return}TS.error("failed to leave group");return}var i=TS.groups.getGroupById(r.channel);if(!i)return;i.msgs.length=0;if(i.is_limited)i.is_limited=false},setTopic:function e(t,n){if(TS.boot_data.feature_name_tagging_client){n=TS.format.cleanMsg(n);TS.api.call("groups.setTopic",{channel:t,topic:n,name_tagging:true},TS.groups.onSetTopic)}else TS.api.call("groups.setTopic",{channel:t,topic:n},TS.groups.onSetTopic)},onSetTopic:function e(t){if(!t)TS.error("failed to set group topic")},setPurpose:function e(t,n){if(TS.boot_data.feature_name_tagging_client){n=TS.format.cleanMsg(n);TS.api.call("groups.setPurpose",{channel:t,purpose:n,name_tagging:true},TS.groups.onSetPurpose)}else TS.api.call("groups.setPurpose",{channel:t,purpose:n},TS.groups.onSetPurpose)},onSetPurpose:function e(t,n){if(!t){TS.error("failed to set group purpose");TS.channels.alertSetPurposeError(n.error)}},getGroupsFilteredBy:function e(t){return TS.shared.getEntitiesFilteredBy("groups",t)},getGroupById:function e(t){if(!t)return null;return TS.redux.channels.getGroupById(t)},getGroupByName:function e(t){return TS.redux.channels.getGroupByName(t)},upsertGroup:function t(n,r){return e(n,r)},removeGroup:function e(t){if(TS.has_pri[a])TS.log(a,'removing group "'+t.id+'"');TS.redux.channels.removeEntity(t);if(TS.client)if(TS.model.active_group_id===t.id)TS.client.activeChannelDisplayGoneAway();if(t.msgs)t.msgs.length=0;if(t.is_limited)t.is_limited=false;TS.groups.deleted_sig.dispatch(t)},groupRenamed:function e(t){var n=TS.groups.upsertGroup(t);n._name_lc=_.toLower(n.name);TS.groups.renamed_sig.dispatch(n)},markScrollTop:function e(t,n){var r=TS.groups.getGroupById(t);if(!r)return false;if(r.scroll_top===n)return false;r.scroll_top=n;return true},maybeLoadScrollBackHistory:function e(t,n){var r=TS.groups.getGroupById(t);if(!r)return false;return TS.shared.maybeLoadScrollBackHistory(r,TS.groups,n)},onHistory:function e(t,n,r){var i=TS.groups.getGroupById(r.channel);if(!i){TS.error('error no group "'+r.channel+'"');return}if(!t||!n||!n.messages){TS.error("failed to get history for group "+r.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=2500;var s=5e3;var o=_.random(a,s);TS.info("retrying history fetch on group "+i.id+" in "+o);window.setTimeout(function(){TS.info("retrying history fetch on group "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.groups.fetchHistory(i,r,TS.groups.onHistory)},o);return}i.history_fetch_retries=0;var l=TS.shared.onHistory(i,n,r,TS.groups);if(!l){i.history_is_being_fetched=false;TS.groups.history_fetched_sig.dispatch(i)}var u=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.groups.calcUnreadCnts(i,u)},fetchHistory:function e(t,n,r){if(!t){TS.error('error no group "'+t+'"');return}if(!TS.boot_data.feature_initial_scroll_position)TS.shared.maybeClearHasAutoScrolled(t);t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.groups.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;if(TS.client)TS.client.msg_pane.updateEndMarker();return}if(t.is_private&&_.startsWith(t.id,"C"))TS.api.call("conversations.history",n,r||TS.groups.onHistory);else TS.api.call("groups.history",n,r||TS.groups.onHistory)},topicChanged:function e(t,n,r,i){if(!t.topic)t.topic={};t.topic.creator=n;t.topic.last_set=r;t.topic.value=i;TS.groups.topic_changed_sig.dispatch(t,n,i)},purposeChanged:function e(t,n,r,i){if(!t.purpose)t.purpose={};t.purpose.creator=n;t.purpose.last_set=r;t.purpose.value=i;TS.groups.purpose_changed_sig.dispatch(t,n,i)},getUnarchivedClosedGroups:function e(){var t=TS.groups.getUnarchivedGroups();return _.reject(t,"is_open")},getUnarchivedGroups:function e(){var t=TS.model.groups;return _.reject(t,"is_archived")},calcActiveMembersForGroup:function e(t){t.active_members.length=0;if(!t.members)return;var n;for(var r=0;r<t.members.length;r+=1){n=TS.members.getMemberById(t.members[r]);if(!n)continue;if(n.deleted)continue;t.active_members.push(n.id)}},calcActiveMembersForAllGroups:function e(){var t=TS.model.groups;for(var n=0;n<t.length;n+=1)TS.groups.calcActiveMembersForGroup(t[n])},createSuggestedName:function e(t){var n=TS.model.user.name;var r=[];var i;var a;var s=TS.model.channel_name_max_length;for(a=0;a<t.length;a+=1){i=TS.members.getMemberById(t[a]);if(!i)continue;r.push(i)}r.sort(function e(t,n){var r=t._name_lc;var i=n._name_lc;if(r<i)return-1;if(r>i)return 1;return 0});for(a=0;a<r.length;a+=1){i=r[a];n+="-"+i.name.split("-")[0]}if(n.length>s){n=n.substr(0,s);if("-"===n.charAt(n.length-1))n=n.substr(0,s-1)}var o=n;var l=1;var u;while(TS.channels.getChannelByName(n)||TS.groups.getGroupByName(n)||TS.members.getMemberByName(n)){u=(l+1).toString();l+=1;n=o+u;if(n.length>s)n=o.substr(0,s-u.length)+u}return n},kickMember:function e(t,n){if(!TS.permissions.members.canKickFromGroups())return;var r=TS.groups.getGroupById(t);if(!r)return;return TS.shared.kickMember(r,n)},canLeaveGroup:function e(t){if(!TS.model.user.is_restricted)return true;if(TS.model.user.is_ultra_restricted)return false;if(TS.channels.getChannelsForUser().length)return true;var n=TS.model.groups;var r;for(var i=0;i<n.length;i+=1){r=n[i];if(r.is_archived)continue;if(r.id===t)continue;return true}return false},setDataRetention:function e(t,n,r,i){var a={channel:t,retention_type:parseInt($("select[name=retention_type]").val(),10)};if(1===a.retention_type)a.retention_duration=$("#retention_duration").val();TS.api.call("groups.setRetention",a,function(e,t,n){if(i)i(e,t,n);if(e)TS.groups.data_retention_changed_sig.dispatch(n)})},getDataRetention:function e(t,n){TS.api.call("groups.getRetention",{channel:t},n)}});var e=function e(r,i){var s=TS.groups.getGroupById(r.id);var o;delete r.unread_count;if(s){s=_.assign({},TS.redux.channels.dangerouslyGetEntityById(r.id));if(TS.has_pri[a])TS.log(a,'updating existing group "'+r.id+'"');for(var l in r)if("members"===l){o=r.members;s.members.length=0;for(var u=0;u<o.length;u+=1)s.members.push(o[u])}else if("pinned_items"===l){if(TS.client){if(r.pinned_items)TS.pins.upsertPinnedItems(r.pinned_items);s.pinned_items=r.pinned_items}}else s[l]=r[l];t(s);r=s;if(TS.isPartiallyBooted()&&null===r.oldest_msg_ts)r.oldest_msg_ts=TS.storage.fetchOldestTs(r.id);TS.shared.maybeResetHistoryFetched(r);if(TS.client){var d=true;TS.shared.checkInitialMsgHistory(r,TS.groups,d)}if(!i)TS.redux.channels.replaceEntity(r)}else{if(TS.has_pri[a])TS.log(a,'adding group "'+r.id+'"');TS.utility.ensureInArray(TS.model.all_group_ids,r.id);n(r);if(!i)TS.redux.channels.addEntity(r);if(r.pinned_items&&TS.client)TS.pins.upsertPinnedItems(r.pinned_items)}if(TS.client){var c=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(r);if(TS.model.active_cid===r.id)TS.groups.calcUnreadCnts(r,c);else if(!s)TS.groups.calcUnreadCnts(r,c)}TS.groups.calcActiveMembersForGroup(r);return r};var t=function e(t){if(!t.is_shared)return;if(!TS.boot_data.page_needs_enterprise)return;if(t.is_global_shared){if(t.shares)t.shares=void 0;if(t.shared_team_ids)t.shared_team_ids=void 0;return}if(t.shares){t.shared_team_ids=_(t.shared_team_ids||[]).concat(_.map(t.shares,"id")).value();if(t.shares)t.shares=void 0}t.shared_team_ids=_(t.shared_team_ids||[]).uniq().value()};var n=function e(n){TS.shared.setPriorityForDev(n);n.is_group=true;n._name_lc=_.toLower(n.name);n._show_in_list_even_though_no_unreads=false;TS.shared.maybeResetHistoryFetched(n);n.active_members=[];n.scroll_top=-1;n.history_is_being_fetched=false;n.unread_highlight_cnt=0;n.unread_highlights=[];n.unread_cnt=0;n.unreads=[];TS.shared.setOldestUnreadTsForId(n.id,null);n.has_fetched_history_after_scrollback=false;if(TS.client)if(TS._incremental_boot&&n.msgs&&n.msgs.length>0){n.msgs=n.msgs.map(function(e){return TS.utility.msgs.processImsg(e,n.id)});TS.utility.msgs.setMsgs(n,n.msgs)}else TS.utility.msgs.setMsgs(n,[]);else if(TS.boot_data.msgs)TS.utility.msgs.ingestMessagesFromBootData(n);n.oldest_msg_ts=TS.storage.fetchOldestTs(n.id)||null;n.last_msg_input=TS.storage.fetchLastMsgInput(n.id)||null;n.has_draft=!!n.last_msg_input;if(TS.model.created_groups[n.name])delete TS.model.created_groups[n.name];t(n)};var r=999;var i=142;var a=4})()},4221:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("files",{team_file_added_sig:new signals.Signal,team_file_deleted_sig:new signals.Signal,team_file_deleted_success_sig:new signals.Signal,team_file_changed_sig:new signals.Signal,team_file_shared_sig:new signals.Signal,team_file_comment_added_sig:new signals.Signal,team_file_comment_edited_sig:new signals.Signal,team_file_comment_deleted_sig:new signals.Signal,file_uploaded_sig:new signals.Signal,file_uploading_sig:new signals.Signal,file_progress_sig:new signals.Signal,file_canceled_sig:new signals.Signal,file_queue_emptied_sig:new signals.Signal,channel_files_fetched_sig:new signals.Signal,user_changed_public_url_sig:new signals.Signal,uploadQ:[],uploading:false,polling_count:0,polling_file_id:null,polling_ticket:null,polling_tim:null,polling_handler:null,waiting_for_refresh:{},supported_audio_type_re:/^(m4a|mp3|wav)$/,supported_video_type_re:/^(mp4|mov|webm)$/,onStart:function e(){TS.prefs.team_disable_file_editing_changed_sig.add(TS.files.getFileActions,TS.files.upsertAndSignal)},isFilePrivate:function e(t){return!t.is_public&&!t.is_external&&!t.is_shared},isFileUntitled:function e(t){return"-"===t.name},createPublicURL:function e(t,n){if(TS.model.team.prefs.disallow_public_file_urls)return;TS.api.callImmediately("files.sharedPublicURL",{file:t.id},function(e,r,i){if(e){TS.files.upsertAndSignal({id:t.id,public_url_shared:true});TS.files.user_changed_public_url_sig.dispatch(r.file)}else if(r.error&&"not_allowed"===r.error){TS.model.team.prefs.disallow_public_file_urls=true;if(TS.boot_data.feature_external_files)TS.generic_dialog.alert(TS.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this Post.","files")());else TS.generic_dialog.alert(TS.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this space.","files")())}if(n&&"function"===typeof n)n(e,r,i)})},createSpace:function e(t){var n={};if(TS.boot_data.page_needs_enterprise)n.team=TS.model.team.id;TS.api.callSynchronously("files.createSpace",n,function(e,n){if(e){var r=TS.files.upsertAndSignal(n.file).file;if(TS.web)TS.ssb.upsertFileInSSBParentWin(r);t(r)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}})},createAndOpenNewSpace:function e(t,n){TS.files.createSpace(function(e){if(e){var r=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";if(TS.boot_data.page_needs_enterprise)if(r.length)r+="&origin_team="+TS.model.team.id;else r="?origin_team="+TS.model.team.id;var i=e.permalink+r;if(n||!TS.ssb.openNewFileWindow(e,i,r))TS.utility.openInNewTab(i,e.id)}if("function"===typeof t)t(e)})},createArugula:function e(t){TS.api.callSynchronously("files.createArugula",{},function(e,n){if(e){var r=TS.files.upsertAndSignal(n.file).file;if(TS.web)TS.ssb.upsertFileInSSBParentWin(r);t(r)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}})},createAndOpenNewArugula:function e(t,n){TS.files.createArugula(function(e){if(e){var r=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";var i=e.permalink+r;if(n||!TS.ssb.openNewFileWindow(e,i,r))TS.utility.openInNewTab(i,e.id)}if("function"===typeof t)t(e)})},promptForFileUnshare:function e(t,n){var r=TS.channels.getChannelById(n);if(!r)var i=TS.groups.getGroupById(n);if(!i)i=TS.mpims.getMpimById(n);if(!i&&!r)return;var a=TS.i18n.t("<p>Are you sure you want to un-share this file from the <strong>{channel_name}</strong> {is_private, select, true {private} other {}} channel?</p>\t\t\t<p>Un-sharing the file will not remove existing share and comment messages, but it will keep any future comments from appearing in the channel.</p>","files")({is_private:!r,channel_name:r?"#"+r.name:i.name});TS.generic_dialog.start({title:TS.i18n.t("Un-share file","files")(),body:a,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, unshare this file","files")(),cancel_button_text:TS.i18n.t("Cancel","files")(),onGo:function e(){TS.files.unshareFile(t,n)}})},shareFile:function e(t,n,r,i,a){var s={file:t,channel:n,comment:r||""};s.resharing_aware=true;if(i)s.share_quietly=true;return TS.api.call("files.share",s,function(e,t,n){TS.files.onFileShare(e,t,n);if(a)a(e,t,n)})},onFileShare:function e(t,n,r){if(!t)return;TS.files.fetchFileInfo(r.file,function(e,t){if(TS.web)TS.files.upsertAndSignal(t)});if(TS.web&&TS.web.space)TS.web.space.onFileShare(t,n,r)},unshareFile:function e(t,n,r){TS.api.call("files.unshare",{file:t,channel:n},function(e,n,i){TS.files.onFileUnShare(e,n,i);if(r)r(t,TS.files.getFileById(t))})},fetchFileInfo:function e(t,n){var r=false;return a(t,r,n)},fetchFileInfoRaw:function e(t,n){var r=true;return a(t,r,n)},onFileUnShare:function e(t,n,r){if(!t)return;TS.files.fetchFileInfo(r.file,function(e,t){if(TS.web)TS.files.upsertAndSignal(t)})},fetchTeamFiles:function e(n,r){TS.api.call("files.list",{types:n,count:t},function(e,t,n){if(e)if(t.files){var i;for(var a=0;a<t.files.length;a+=1){i=t.files[a];TS.files.upsertFile(i)}}if(r)r(e,t,n)})},fetchMemberFiles:function e(n,r,i){TS.api.call("files.list",{user:n,types:r,count:t},function(e,t,n){if(e)if(t.files){var r;for(var a=0;a<t.files.length;a+=1){r=t.files[a];TS.files.upsertFile(r)}}if(i)i(e,t,n)})},fetchChannelFiles:function e(t,n,r,i){var a=i&&i.length?i.join(","):"";if(n)TS.api.call("files.list",{channel:t,types:a,count:r},function(e,t,r){if(e)TS.files.onChannelFetch(e,t,r);n(e,t,r)});else TS.api.call("files.list",{channel:t,types:a},TS.files.onChannelFetch)},fetchMultipleFiles:function e(t,n,r){return TS.api.call("files.list",{files:t.join(",")},function(e,t,i){if(e)if(t.files&&!r){var a;for(var s=0;s<t.files.length;s+=1){a=t.files[s];TS.files.upsertFile(a)}}if(n)n(e,t,i)})},onChannelFetch:function e(t,n,r){if(!t)return;if(n.files){var i;for(var a=0;a<n.files.length;a+=1){i=n.files[a];TS.files.upsertFile(i)}}TS.files.channel_files_fetched_sig.dispatch(r.channel,n.files)},addComment:function e(t,n,r,i){var a={file:t,comment:n,channel:r||""};TS.api.callImmediately("files.comments.add",a,function(e,t,n){TS.files.onFileComment(e,t,n);if(i)i(e,t,n)})},onFileComment:function e(t,n,r){if(!t)return;var i=TS.files.getFileById(r.file);if(!i){TS.error("no file? "+r.file);return}TS.files.addCommentToFile(n.comment,i)},getFileById:function e(t){return TS.files.getFileByProp("id",t)},getFileByDownloadUrlPrivate:function e(t){return TS.files.getFileByProp("url_private_download",t)},getFileByProp:function e(t,n){if(!t)return null;if(!n)return null;var r=TS.model.files;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i[t]==n)return i}return null},getFileActions:function e(t){if(!t)return;var n={};var r=false;if(t.user==TS.model.user.id)r=true;if(t.is_public)n.share=true;else if(r)n.share=true;else n.share_private_file=true;n.comment=true;if(!t.public_url_shared&&"external"!==t.mode&&!TS.model.user.is_restricted&&!TS.model.team.prefs.disallow_public_file_urls)if(t.is_public)n.create_public_link=true;else if(r)n.create_public_link=true;if(t.public_url_shared&&!TS.model.user.is_restricted&&(TS.model.user.is_admin||r)&&!TS.model.team.prefs.disallow_public_file_urls)n.revoke_public_link=true;if("hosted"===t.mode||"snippet"===t.mode)n.download=true;if(t.mimetype&&0===t.mimetype.indexOf("image/")||"pdf"===t.filetype||"external"===t.mode||"snippet"===t.mode||"email"===t.mode)n.open_original=true;if(TS.web)if("post"===t.mode||"snippet"===t.mode||"space"===t.mode||"email"===t.mode||"arugula"===t.mode)n.print=true;if("space"===t.mode&&!("USLACKBOT"===t.user&&"Getting_Started_with_Posts"===t.name))n.learn_more=true;if("space"===t.mode||"arugula"===t.mode)n.new_window=true;if("space"===t.mode&&"locked"!==t.state)n.edit=true;if(r){if("snippet"===t.mode||"post"===t.mode||"space"===t.mode||"arugula"===t.mode)n.edit=true;if("hosted"===t.mode||"email"===t.mode)n.edit_title=true;n.delete_file=true}if(TS.model.user.is_admin){var i;if(TS.boot_data.feature_shared_channels_client)i=TS.utility.teams.isMemberExternalById(t.user);n.delete_file=!i}if(TS.clipboard.canWriteText())n.copy_file_link=true;if("external"===t.mode)if(r||TS.model.user.is_admin)n.refresh=true;if(window.Dropbox&&Dropbox.isBrowserSupported()&&TS.model.prefs.dropbox_enabled)if("hosted"===t.mode)n.save_to_dropbox=true;if(TS.client){var a=TS.shared.getActiveModelOb();if(TS.pins.canUserPinHere(a))if(t.pinned_to&&-1!==t.pinned_to.indexOf(a.id))n.unpin_file=true;else{var s=!!t.is_public;if(t.channels)s=s||-1!==t.channels.indexOf(a.id);else TS.warn("No channels array for file object in getFileActions(): "+t.id);if(t.groups)s=s||-1!==t.groups.indexOf(a.id);else TS.warn("No groups array for file object in getFileActions(): "+t.id);if(t.ims)s=s||-1!==t.ims.indexOf(a.id);else TS.warn("No ims array for file object in getFileActions(): "+t.id);if(s)n.pin_file=true}}n.rxn_file=true;if(TS.model.team.prefs.disable_file_editing){n.edit=false;n.edit_title=false}if(TS.model.team.prefs.disable_file_deleting)n.delete_file=false;if(t.is_tombstoned){n.edit=false;n.edit_title=false;n.delete_file=false}return n},getFileCommentActions:function e(t,n){if(!t)return{};var r={can_edit:true,can_delete:true};if(t.user!=TS.model.user.id)r.can_edit=false;else if(TS.model.team.prefs.msg_edit_window_mins>-1&&(Date.now()-TS.interop.datetime.toDateObject(t.timestamp))/6e4>TS.model.team.prefs.msg_edit_window_mins)r.can_edit=false;if(!TS.model.team.prefs.allow_message_deletion){if(!TS.model.user.is_admin)r.can_delete=false}else if(t.user!=TS.model.user.id)if(!TS.model.user.is_admin)r.can_delete=false;if(TS.client){var i=TS.shared.getActiveModelOb();if(TS.pins.canUserPinHere(i))if(t.pinned_to&&-1!==t.pinned_to.indexOf(i.id))r.can_unpin=true;else{var a=!!n.is_public;if(n.channels)a=a||-1!==n.channels.indexOf(i.id);else TS.warn("No channels array for file object in getFileCommentActions(): "+n.id);if(n.groups)a=a||-1!==n.groups.indexOf(i.id);else TS.warn("No groups array for file object in getFileCommentActions(): "+n.id);if(n.ims)a=a||-1!==n.ims.indexOf(i.id);else TS.warn("No ims array for file object in getFileCommentActions(): "+n.id);if(a)r.can_pin=true}}r.rxn_file_comment=true;return r},getThumbSrcForFile:function e(t,n){try{t=o(t)}catch(e){return false}if(!t.thumb_360&&!t.thumb_360_gif)return false;if(!n)n={};if(!n.max_size)n.max_size=480;if(false===TS.model.prefs.a11y_animations&&"gif"===t.filetype){if(t.deanimate_gif)return t.deanimate_gif;if(n.max_size>360&&t.thumb_480)return t.thumb_480;else if(t.thumb_160)return t.thumb_160}if(t.thumb_480_gif||t.thumb_360_gif){if(n.max_size>360&&t.thumb_480_gif)return t.thumb_480_gif;if(t.thumb_360_gif)return t.thumb_360_gif}if(TS.features.isEnabled("pjpeg")&&t.pjpeg)return t.pjpeg;if(TS.features.isEnabled("pdf_thumb")&&t.thumb_pdf)return t.thumb_pdf;if(n.max_size>480&&t.thumb_1024)return t.thumb_1024;if(n.max_size>360&&t.thumb_960)return t.thumb_960;if(t.thumb_720)return t.thumb_720;if(t.thumb_480)return t.thumb_480;return t.thumb_360},fileIsImage:function e(t){try{t=o(t)}catch(e){return false}var n=t.thumb_360||t.thumb_360_gif;var r=t.mimetype&&-1!==t.mimetype.indexOf("image/");return n&&r},fileHasRichPreview:function e(t){try{t=o(t)}catch(e){return false}var n=t.mimetype&&-1!==t.mimetype.indexOf("image/");return t.has_rich_preview&&!n},fileIsSupportedAudio:function e(t){return TS.files.supported_audio_type_re.test(o(t).filetype)},fileIsSupportedVideo:function e(t){return TS.files.supported_video_type_re.test(o(t).filetype)},fileIsHostedSupportedMedia:function e(t){try{t=o(t)}catch(e){return false}var n=TS.files.fileIsSupportedAudio(t)||TS.files.fileIsSupportedVideo(t);var r=!t.is_external||!_.isEmpty(_.get(t,"video.outputs"));return n&&r},fileIsPDF:function e(t){try{t=o(t)}catch(e){return false}return"pdf"===t.filetype},getFileTemplateArguments:function e(t,n){var r={};r.current_user_id=TS.model.user.id;r.file_partial="generic";if(/(snippet|post|email|arugula)/.test(t.mode))r.file_partial=t.mode;if(/(space)/.test(t.mode))r.file_partial="post";if(TS.files.fileIsImage(t)){r.file_partial="image";r.image_src=TS.files.getThumbSrcForFile(t,{max_size:n});r.image_width=360===n?t.thumb_360_w:t.thumb_480_w||t.thumb_360_w;r.image_height=360===n?t.thumb_360_h:t.thumb_480_h||t.thumb_360_h;r.preserve_aspect_ratio=r.image_width>0&&r.image_height>0;r.preview_actions_class="";if(r.image_width<170||r.image_height<50)r.preview_actions_class+=" overflow_preview_actions";if(r.image_width<170)r.preview_actions_class+=" overflow_preview_actions_width"}if(/(post|space|email|arugula|generic)/.test(r.file_partial))r.title_hider=true;if("snippet"===t.mode)r.title_hider="Untitled"===t.title;r.filesize=t.size>2e4&&!/(gdoc|gpres|gsheet|gdraw)/.test(t.filetype);if(!/(space|post)/.test(t.filetype))r.meta_filetype=new Handlebars.SafeString(TS.templates.builders.makeFiletypeHTML(t));if(TS.templates.builders.makeExternalFiletypeHTML(t)===r.meta_filetype)r.meta_filetype=false;if(TS.files.fileIsHostedSupportedMedia(t)){if(TS.files.fileIsSupportedVideo(t)){r.file_is_video=true;var i={width:t.width,height:t.height,source:t.url_private,size:t.size};if(t.video){r.transcoding_status=t.video.status;if(t.video.outputs)for(var a=t.video.outputs.length-1;a>=0;a-=1){var s=t.video.outputs[a];if(!s.source)continue;if(!i.width||s.width>i.width)i=s}}r.video_height=TS.model.native_video_embed_height;if(t.thumb_video)r.poster=t.thumb_video;r.best_source=i.source}if(TS.files.fileIsSupportedAudio(t)){r.file_is_audio=true;r.audio_preload="metadata";if(t.size<=TS.model.native_media_preload_limit_bytes)r.audio_preload="auto"}}return r},getFileDetailsMetaTemplateArguments:function e(t){var n=TS.files.getFileActions(t);var r="post"===t.mode;var i="space"===t.mode||"post"===t.mode;var a="snippet"===t.mode;var s="arugula"===t.mode;var o={file:t,user:TS.model.user,download:"hosted"===t.mode,edit_link:r?t.edit_link:t.permalink,edit:(i||a)&&t.user===TS.model.user.id,is_post:r,is_post_or_space:i,is_snippet:a,is_arugula:s,show_open_public_link:!TS.model.team.prefs.disallow_public_file_urls,show_revoke_public_link:!TS.model.team.prefs.disallow_public_file_urls&&n.revoke_public_link};if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}if(t&&t.id)if("snippet"===t.mode||"post"===t.mode||"space"===t.mode)if(!t.content&&!t.content_html&&!t.content_highlight_html)TS.files.fetchFileInfo(t.id);return o},createFileCommentsGroup:function e(t){var n={};function r(e,t,r){var i=TS.shared.getModelObById(t);var a=i&&TS.shared.getDisplayNameForModelOb(i);var s=e.share_info&&e.share_info[t];var o=s&&s.timestamp;var l=TS.members.getMemberById(s&&s.user_id);var u=l&&TS.members.getPrefCompliantMemberName(l);n[t]={name:a,first_share:{name:u,timestamp:o},comments:r?[r]:[]}}for(var i=t.comments.length-1;i>=0;i-=1){var a=t.comments[i];if(a.channel)if(n[a.channel])n[a.channel].comments.unshift(a);else r(t,a.channel,a)}_.each([t.channels,t.groups,t.ims,t.mpims],function(e){if(e)for(var i=e.length-1;i>=0;i-=1){var a=e[i];if(!n[a])r(t,a)}});t._comments_grouped=n},resetFileCommentsGroup:function e(t){t._comments_grouped=null},sortFiles:function e(t){function n(e,t){if(e.timestamp<t.timestamp)return 1;if(e.timestamp>t.timestamp)return-1;return 0}t.sort(n)},getFileCommentById:function e(t,n){var r;for(var i=0;i<t.comments.length;i+=1){r=t.comments[i];if(r.id==n)return r}return null},addCommentToFile:function e(t,n){var r=TS.files.getFileCommentById(n,t.id);if(r)return r;t._rxn_key=TS.rxns.getRxnKey("file_comment",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;n.comments.push(t);TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_added_sig.dispatch(n,t);return t},editCommentOnFile:function e(t,n){var r;var i=false;var a=false;for(var s=0;s<n.comments.length;s+=1){r=n.comments[s];if(r.id==t.id){i=true;n.comments[s]=t;if(r.is_starred)t.is_starred=true;if(r._rxn_key)t._rxn_key=r._rxn_key;if(r.pinned_to&&!t.pinned_to)t.pinned_to=r.pinned_to;if(n.initial_comment&&r.id==n.initial_comment.id){n.initial_comment=t;a=true}break}}if(!i)return false;TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_edited_sig.dispatch(n,t);if(a)TS.files.team_file_changed_sig.dispatch(n);return true},deleteCommentOnFile:function e(t,n){var r;var i=[];var a;for(var s=0;s<n.comments.length;s+=1){r=n.comments[s];if(r.id==t){a=r;if(n.initial_comment&&r.id==n.initial_comment.id)n.initial_comment=null;continue}i.push(r)}if(i.length==n.comments.length)return;n.comments=i;TS.files.sortCommentsOnFile(n);TS.files.team_file_comment_deleted_sig.dispatch(n,t,a);TS.files.team_file_changed_sig.dispatch(n)},sortCommentsOnFile:function e(t){function n(e,t){if(e.timestamp>t.timestamp)return 1;if(e.timestamp<t.timestamp)return-1;return 0}t.comments.sort(n)},upsertFile:function e(t){if(Object.keys(t).length<2)TS.error("upserting a bad file object! it has less than 2 properties");if("space"===t.mode){try{if(t.preview&&/^\s*<document>/.test(t.preview)){var r=$(t.preview);if(r.length)t.preview=r.html();if(r.length){var a=r.children().eq(0);if(a.hasClass("list"))a.find("li:not(:first)").remove();if("pre"===a.prop("tagName").toLowerCase())t.preview_in_list=a.length?'<span class="monospace">'+_.escape(a.text())+"</span>":"";else t.preview_in_list=a.length?_.escape(a.text()):""}}}catch(e){TS.log(93,"problem with file.preview id:"+t.id);if(TS.boot_data.feature_tinyspeck)TS.log(93,"(TS-ONLY log) file.preview: "+t.preview)}try{if(t.content_html){var s=$(t.content_html);if(s.length)t.content_html=s.html()}}catch(e){TS.log(93,"problem with file.content_html id:"+t.id);if(TS.boot_data.feature_tinyspeck)TS.log(93,"(TS-ONLY log) file.content_html: "+t.content_html)}}if("post"===t.mode&&t.preview){var o=t.preview;var l=o.split("\n");var u=l.length;for(var d=0;d<u;d+=1){var c=l[d];if(c){t.preview_in_list=c;break}}}if("snippet"===t.mode){var m=["content","content_highlight_html"];var f=12800;_.forEach(m,function(e){if(t[e]&&t[e].length>f){var n=truncate(t[e],f);if(n!==t[e]){t[e]=n;t.is_truncated=true}}})}if(t.pretty_type&&TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)t.pretty_type=TS.i18n.getStaticTranslation(t.filetype,"file_pretty_type_strings")||t.pretty_type;var p=TS.model.files;var h=TS.files.getFileById(t.id);var g="NOOP";var S=[];var T;var v;var b;var y;if(h){t._rxn_key=TS.rxns.getRxnKey("file",t.id);b=TS.rxns.getExistingRxnsByKey(t._rxn_key);if(b&&!t.reactions)TS.warn("file:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments)for(y=0;y<t.comments.length;y+=1){v=t.comments[y];v._rxn_key=TS.rxns.getRxnKey("file_comment",v.id);b=TS.rxns.getExistingRxnsByKey(v._rxn_key);if(b&&!v.reactions)TS.warn("comment:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(v._rxn_key,v.reactions);delete v.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);b=TS.rxns.getExistingRxnsByKey(t.initial_comment._rxn_key);if(b&&!t.initial_comment.reactions)TS.warn("initial_comment:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}if(t.is_tombstoned!==h.is_tombstoned)for(var w in h)if("is_tombstoned"===w)h[w]=!!t[w];else delete h[w];else if(t.is_tombstoned==h.is_tombstoned&&!t.is_tombstoned)delete h.is_tombstoned;T=(h.channels||[]).concat(h.ims||[]).concat(h.groups||[]);for(var k in t)if("channels"===k||"ims"===k||"groups"===k||"pinned_to"===k||"to"===k||"from"===k||"cc"===k||"attachments"===k){var x=false;var C=_.isArray(t[k])?t[k]:[];var M=_.isArray(h[k])?h[k]:[];if("to"===k||"from"===k||"cc"===k||"attachments"===k){if(M.length!=C.length)x=true}else if(M.join("")!=C.join("")){x=true;if("channels"===k||"ims"===k||"groups"===k)T=T.concat(t[k]||[])}if(x){h[k]=t[k];g="CHANGED";S.push(k)}}else if("preview"===k){if(h[k]!==t[k]){h[k]=t[k];if(h.content)delete h.content;if(h.content_html)delete h.content_html;if(h.content_highlight_html)delete h.content_highlight_html;g="CHANGED";S=S.concat([k,"content","content_html","content_highlight_html"])}}else if("comments"===k){if(t[k]&&!TS.utility.areSimpleObjectsEqual(t[k],h[k],"file:"+t.id+" "+t.name)){h[k]=t[k];g="CHANGED";S.push(k)}}else if("content"===k){if(t[k]&&h[k]!=t[k]){h[k]=t[k];g="CHANGED";S.push(k)}}else if("editor"===k||"state"===k){if(t[k]!=h[k]){T=[];S.push(k);h[k]=t[k];g="CHANGED"}}else if("initial_comment"===k)h[k]=t[k];else if("reactions"===k)h[k]=t[k];else if(("channel_map"===k||"group_map"===k||"im_map"===k||"teams"===k||"teams_shared_with"===k||"users"===k)&&!TS.utility.isScalar(t[k]))h[k]=t[k];else if("video"===k){if(t[k]&&!TS.utility.areSimpleObjectsEqual(t[k],h[k],"file:"+t.id+" "+t.name)){h[k]=t[k];g="CHANGED";S.push(k)}}else if(h[k]!=t[k])if(t[k]&&!TS.utility.isScalar(t[k])){h[k]=t[k];TS.warn(k+" is not scalar! it needs to be handled by upsertFile specifically to test if it has changed! "+n(t[k]))}else if("boolean"!==typeof t[k]||!t[k]!=!h[k]){S.push(k+" ["+h[k]+"] -> ["+t[k]+"]");h[k]=t[k];g="CHANGED"}}else{g="ADDED";t._rxn_key=TS.rxns.getRxnKey("file",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments){for(y=0;y<t.comments.length;y+=1){v=t.comments[y];v._rxn_key=TS.rxns.getRxnKey("file_comment",v.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(v._rxn_key,v.reactions);delete v.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}}p.push(t);var I=TS.members.getPotentiallyUnknownMemberById(t.user);if(I){I.files.push(t);TS.files.sortFiles(I.files)}else TS.error("hmmm, file "+t.id+" does not have a known user "+t.user);i(t);h=t}if("CHANGED"===g){i(t);if(_.includes(S,"comments"))TS.utility.msgs.updateCommentReferences(h)}if(!h.comments)h.comments=[];else h.comments_count=Math.max(h.comments_count,h.comments.length);if(!h.channels)h.channels=[];if(!h.ims)h.ims=[];if(!h.groups)h.groups=[];h.is_shared=h.groups.length>0||h.channels.length>0;TS.files.sortFiles(TS.model.files);return{status:g,file:h,what_changed:S}},upsertAndSignal:function e(t){var n=TS.files.upsertFile(t);if("CHANGED"===n.status)TS.files.team_file_changed_sig.dispatch(n.file);else if("ADDED"===n.status)TS.files.team_file_added_sig.dispatch(n.file);return n},removeFile:function e(t){TS.log(4,'removing file "'+t+'"');var n=TS.files.getFileById(t);if(n)n.is_deleted=true;TS.model.channels.forEach(function(e){if(n)TS.utility.msgs.removeFileSharesAndMentions(e,n);if(n)TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.groups.forEach(function(e){if(n)TS.utility.msgs.removeFileSharesAndMentions(e,n);if(n)TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.ims.forEach(function(e){if(n)TS.utility.msgs.removeFileSharesAndMentions(e,n);if(n)TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});TS.model.mpims.forEach(function(e){if(n)TS.utility.msgs.removeFileSharesAndMentions(e,n);if(n)TS.utility.msgs.removeFileComments(e,n);TS.utility.msgs.removeFileReferences(e,t)});if(n)TS.files.team_file_deleted_sig.dispatch(n)},upload:function e(t){if(TS.files.uploading)TS.files.uploadQ.push(t);else TS.files.actuallyUpload(t)},actuallyUpload:function t(n){TS.files.uploading=true;n.retry_num=n.retry_num||0;var r=new FormData;var i;var a=!!n.file;if(n.title)n.title=TS.emoji.maybeGetCanonicalEmojiString(n.title);if(n.text){i=n.title||n.filetype;TS.files.file_uploading_sig.dispatch(i,n.retry_num>0,a);r.append("content",n.text);if(n.filetype)r.append("filetype",n.filetype);if(n.filename)TS.warn("ignoring filename because it makes no sense for text files")}else{i=n.title||n.filename||n.file&&n.file.name||"blob";TS.files.file_uploading_sig.dispatch(i,n.retry_num>0,a);if("string"===typeof n.file)r.append("content64",n.file);else r.append("file",n.file);if(n.filename)r.append("filename",n.filename);if(n.filetype)TS.warn("ignoring filetype we send a filename which can intuit it")}r.append("token",TS.model.api_token);if(n.channels&&n.channels.length){var s="";if("string"===typeof n.channels)s=n.channels;else if(n.channels.join)s=n.channels.join(",");r.append("channels",s)}r.append("title",n.title);if(n.initial_comment)r.append("initial_comment",n.initial_comment);var o="files.uploadAsync";if(n.link){if(n.is_dropbox)o="files.uploadExternal";if(n.is_box)o="files.uploadExternal";r.append("link",n.link)}var l;if("files.uploadAsync"===o)l=TS.model.async_api_url+o;else l=TS.model.api_url+o;var u=false;e=$.ajax({url:l,data:r,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();if(e.upload)e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=parseInt(100*e.loaded/e.total,10);TS.files.file_progress_sig.dispatch(t)}else TS.info("Upload length not computable")},false);return e},error:function e(t,r,a){u=true;TS.info("Error: Failed to upload file.");TS.info("textStatus:"+r+" errorThrown:"+a);TS.info("data:"+t);if("abort"===r){TS.files.file_canceled_sig.dispatch(i);TS.files.uploadOver(false);return}if(0===n.retry_num){n.retry_num+=1;TS.files.actuallyUpload(n)}else TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.i18n.t("Yes, try again","files")(),cancel_button_text:TS.i18n.t("No, cancel","files")(),onGo:function e(){n.retry_num+=1;TS.files.actuallyUpload(n)},onCancel:function e(){TS.files.uploadOver(false)}})},complete:function e(t){if(u)return;t=jQuery.parseJSON(t.responseText);if(t&&t.ok&&t.file)if("files.uploadAsync"===o){var r=function e(t,n,r){if(!TS.files.polling_file_id)return;if(t)if("complete"===n.status){var i=TS.files.upsertAndSignal(n.file);TS.files.uploadProcessingOver(true,i.file.id)}else if("failed"===n.status){var a="";if(n.debug&&TS.boot_data.feature_tinyspeck)a="<br><br>TS only Debugging:<br><br>"+n.debug;TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")()+a,go_button_text:TS.i18n.t("Yes, try again","files")(),cancel_button_text:TS.i18n.t("No, cancel","files")(),onGo:function e(){r.retry_num+=1;TS.files.actuallyUpload(r)},onCancel:function e(){TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}})}else TS.files.pollForUploadProcessing();else{TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Hmm, it looks like your file failed to upload.","files")(),show_cancel_button:true});TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}};TS.files.startPollingForUploadProcessing(t.file,t.ticket,r)}else{var i=TS.files.upsertAndSignal(t.file);TS.files.uploadOver(t.ok,i.file.id)}else{TS.info("Error: Failed to upload file.");TS.info(t);if(t)if(0===n.retry_num){n.retry_num+=1;TS.files.actuallyUpload(n)}else if("folders_not_supported"===t.error)TS.generic_dialog.start({title:TS.i18n.t("Folders not supported","files")(),body:TS.i18n.t("<p>Sorry, <strong>{folder_name}</strong> is a folder, and folder uploads are not supported by Slack.</p>\t\t\t\t\t\t\t\t\t<p>Try uploading a .zip version of the file instead.</p>","files")({folder_name:_.escape(n.filename)}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false)}});else if("request_timeout"===t.error)TS.generic_dialog.start({title:TS.i18n.t("File upload timed out","files")(),body:TS.i18n.t('<p>It looks like you’re on a slow or inconsistent internet connection. You may want to try your file upload again later. Or, try again now and it might work if you cross your fingers!</p>\t\t\t\t\t\t\t\t\t<p>If you’re still having problems, you can:</p>\t\t\t\t\t\t\t\t\t<ul><li><a href="/help/test" target="{new_win_name}" class="bold">Run our Self-Help Tests</a></li>\t\t\t\t\t\t\t\t\t<li><a href="/help/requests/new" target="{new_win_name}" class="bold">Contact our support team</li></ul>',"files")({new_win_name:TS.templates.builders.newWindowName()}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false)}});else if("file_uploads_disabled"===t.error)TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("At the request of your administrator, file uploads have been disabled on this workspace.","files")():TS.i18n.t("At the request of your administrator, file uploads have been disabled on this team.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});else if("file_uploads_except_images_disabled"===t.error)TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("At the request of your administrator, only images can be uploaded to this workspace.","files")():TS.i18n.t("At the request of your administrator, only images can be uploaded to this team.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});else TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.i18n.t("Yes, try again","files")(),cancel_button_text:TS.i18n.t("No, cancel","files")(),onGo:function e(){n.retry_num+=1;TS.files.actuallyUpload(n)},onCancel:function e(){TS.files.uploadOver(false)}});else{alert("Upload failed.");TS.files.uploadOver(false)}}}})},startPollingForUploadProcessing:function e(t,n,r){TS.files.polling_count=0;TS.files.polling_file_id=t;TS.files.polling_ticket=n;TS.files.polling_handler=r;TS.files.pollForUploadProcessing()},pollForUploadProcessing:function e(){TS.files.polling_count+=1;TS.files.polling_tim=setTimeout(function(){if(!TS.files.polling_ticket)return;TS.api.callImmediately("files.uploadStatus",{ticket:TS.files.polling_ticket},function(e,t,n){if(!TS.files.polling_ticket)return;TS.files.polling_handler(e,t,n)})},1e3*TS.files.polling_count)},uploadProcessingOver:function e(t,n){if(TS.files.polling_file_id!=n)return;TS.info("TS.files.uploadProcessingOver polling_file_id:"+TS.files.polling_file_id+" polling_ticket:"+TS.files.polling_ticket+" polling_count:"+TS.files.polling_count);TS.files.polling_count=0;TS.files.polling_file_id=null;TS.files.polling_ticket=null;TS.files.polling_handler=null;clearTimeout(TS.files.polling_tim);TS.files.uploadOver(t,n)},uploadOver:function t(n,r){TS.files.file_uploaded_sig.dispatch(n,r);TS.files.uploading=false;e=null;if(TS.files.uploadQ.length)TS.files.actuallyUpload.call(null,TS.files.uploadQ.shift());else TS.files.file_queue_emptied_sig.dispatch()},cancelCurrentUpload:function t(){if(e)e.abort()},deleteFile:function e(t){TS.api.call("files.delete",{file:t},TS.files.onFileDelete)},onFileDelete:function e(t){if(!t);},endEditFileTitle:function e(){$("#file_edit_title_container").addClass("hidden");$("#file_title_container").removeClass("hidden")},saveEditFileTitle:function e(t){var n=TS.files.getFileById(t);if(!n)return;var r=$("#file_edit_title_input").val();if(!$.trim(r)){TS.sounds.play("beep");return}var i=n.title;if(i==r){TS.files.endEditFileTitle();return}TS.api.callImmediately("files.edit",{file:t,title:TS.emoji.maybeGetCanonicalEmojiString(r)},function(e){if(!e){TS.files.upsertAndSignal({id:t,title:i});TS.generic_dialog.alert(TS.i18n.t("Something’s gone wrong, and your change didn’t save. If you see this message more than once, you may want to try restarting Slack.","files")(),TS.i18n.t("Oh, crumbs!","files")(),TS.i18n.t("Got it","files")())}});r=_.escape(r);TS.files.upsertAndSignal({id:t,title:r});TS.files.endEditFileTitle()},editFileTitle:function e(t){var n=TS.files.getFileById(t);if(!n)return;var r=n.title;if(r)r=TS.format.unFormatMsg(r);else r=n.name;$("#file_title_container").addClass("hidden");$("#file_edit_title_container").removeClass("hidden");$("#file_edit_title_input").val(r);$("#file_edit_title_input").select()},openBoxChooser:function e(){TS.utility.box.unregister(TS.utility.box.SUCCESS_EVENT_TYPE,TS.files.onBoxChooser);TS.utility.box.success(TS.files.onBoxChooser);TS.utility.box.launchPopup()},onBoxChooser:function e(t){var n=new Array(t.length);for(var r=0;r<t.length;r+=1){var i=t[r];n[r]={name:i.name,link:i.url,is_box:true}}TS.ui.upload_dialog.startWithCommentFromChatInput(n)},openDropboxChooser:function e(){var t="preview";Dropbox.choose({success:TS.files.onDropboxChooser,linkType:t,multiselect:true})},onDropboxChooser:function e(t){var n=[];for(var r=0;r<t.length;r+=1){var i=t[r];n.push({name:i.name,size:i.bytes,link:i.link,icon:i.icon,is_dropbox:true})}TS.ui.upload_dialog.startWithCommentFromChatInput(n)},makeFileNameFromFile:function e(t){return t.name||TS.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toFilenameFriendlyDate(Date.now()/1e3)})+".png"},makeFileTitleFromFile:function e(t){return t.name||TS.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toDate(Date.now()/1e3)})},justUploadTheseFileNow:function e(t){var n;for(var r=0;r<t.length;r+=1){n=t[r];if(n.size>TS.model.upload_file_size_limit_bytes)continue;TS.files.upload({file:n,filename:TS.files.makeFileNameFromFile(n),title:TS.files.makeFileTitleFromFile(n),channels:[TS.shared.getActiveModelOb().id],initial_comment:""})}},refreshFile:function e(t){TS.files.startRefreshingFile(t);TS.api.call("files.refresh",{file:t},TS.files.onFileRefresh)},onFileRefresh:function e(t,n,r){var i=r.file;if(t)TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.i18n.t("File refreshed!","files")()).end();else if(!t){TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.i18n.t("Refresh failed.","files")()+"</span>",5e3);TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.i18n.t("Refresh failed","files")()).end()}if(t&&!n.will_refresh)TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.i18n.t("File refreshed < 1 minute ago.","files")()+"</span>",5e3);if(TS.web&&t){TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.i18n.t("Reloading...","files")());TS.reload(false,"TS.files.onFileRefresh")}if(!t)if("file_deleted"===n.error){var a=TS.files.getFileById(i);if(a)TS.files.removeFile(a.id)}},fileWasMaybeRefreshed:function e(t){if(!t)return;if(!TS.files.waiting_for_refresh[t.id])return;TS.files.doneRefreshingFile(t.id,'<span class="kelly_green">'+TS.i18n.t("File refreshed!","files")()+"</span>",6e4)},startRefreshingFile:function e(t){TS.files.waiting_for_refresh[t]=true;$('.file_refresh[data-file-id="'+t+'"]').addClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').removeClass("hidden")},doneRefreshingFile:function e(t,n,r){delete TS.files.waiting_for_refresh[t];$('.file_refresh_status[data-file-id="'+t+'"]').html(n);setTimeout(function(){$('.file_refresh[data-file-id="'+t+'"]').removeClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').text(TS.i18n.t("Refreshing file...","files")()).addClass("hidden")},r)},shareOrReshareFile:function e(t,n,r,i,a){var s=TS.files&&TS.files.getFileById?TS.files.getFileById(t):null;var o=false;var l=s.user!=TS.model.user.id;var u=!s.bot_id;if(TS.files.isFilePrivate(s)&&l&&u)o=true;if(!s)TS.error("File for reshare doesn't exist: "+t);else if(o)TS.files.reShareConfirmation([s],function(){TS.ui.share_dialog.start(t,n,r,i,null,a)});else TS.ui.share_dialog.start(t,n,r,i,null,a)},reShareConfirmation:function e(t,n){var r=t.map(function(e){return TS.members.getPrefCompliantMemberNameById(e.user,true)});r=_.uniq(r);var i=TS.i18n.t("You’re about to share {file_count, plural, =1 {a private file} other {private files}}","files")({file_count:t.length});var a=TS.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {has} other {have}} privately shared {file_count, plural, =1 {the file <strong>{file_title}</strong>} other {these files}} with you. Are you sure you want to proceed with sharing {file_count, plural, =1 {it} other {them}} somewhere else?</p><p>It’s important to note that any comments on {file_count, plural, =1 {the file <strong>{file_title}</strong>} other {these files}} will also be shared.</p>","files")({user_names:TS.i18n.listify(r).join(""),file_owners_count:r.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""});TS.generic_dialog.start({title:i,body:a,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Proceed with sharing","files")(),cancel_button_text:TS.i18n.t("Cancel","files")(),onGo:n})},updateFileListItem:function e(t,n){var r=n.find('.file_list_item[data-file-id="'+t.id+'"]');if(r.length){r.replaceWith(TS.templates.builders.fileHTML(t));if(TS.files.fileIsImage(t))n.find(".lazy").lazyload()}}});var e=null;var t=20;var r={};var i=function e(t){if(!TS.files.fileIsImage(t))return;var n={width:t.thumb_360_w,height:t.thumb_360_h,link_url:t.url_private,internal_file_id:t.id};if("gif"===t.filetype)if(t.deanimate_gif)TS.inline_imgs.makeInternalInlineImg(t.deanimate_gif,n);else if(t.thumb_160)TS.inline_imgs.makeInternalInlineImg(t.thumb_160,n);if(t.thumb_480_gif||t.thumb_360_gif){if(t.thumb_480_gif)TS.inline_imgs.makeInternalInlineImg(t.thumb_480_gif,n);if(t.thumb_360_gif)TS.inline_imgs.makeInternalInlineImg(t.thumb_360_gif,n)}else{if(t.thumb_720)TS.inline_imgs.makeInternalInlineImg(t.thumb_720,n);if(t.thumb_480)TS.inline_imgs.makeInternalInlineImg(t.thumb_480,n);if(t.thumb_360)TS.inline_imgs.makeInternalInlineImg(t.thumb_360,n);if(TS.features.isEnabled("pjpeg")&&t.pjpeg)TS.inline_imgs.makeInternalInlineImg(t.pjpeg,n);if(TS.features.isEnabled("pdf_thumb")&&t.thumb_pdf)TS.inline_imgs.makeInternalInlineImg(t.thumb_pdf,n)}};var a=function e(t,n,i){var a=function e(r){var a;if(r&&r.data){var o=!!n;s(r.data.ok,r.data,r.args,o);a=n?r.data.file:TS.files.getFileById(t)}if(i)i(t,a);return a||t};var o=500;var l=r[t];if(!l){l=TS.api.call("files.info",{file:t,page:1,count:o,truncate:1});r[t]=l;l.finally(function(){delete r[t]})}return l.then(function(e){return a(e)}).catch(function(e){return a(e)})};var s=function e(t,n,r,i){if(!t){if("file_deleted"===n.error){var a=TS.files.getFileById(r.file);if(a)TS.files.removeFile(a.id);else if(r.file)TS.files.removeFile(r.file)}else if("file_not_found"===n.error)TS.files.removeFile(r.file);return}if(n.file){n.file.comments=n.comments;n.file.content=n.content;n.file.content_html=n.content_html;n.file.content_highlight_html=n.content_highlight_html;if(!i)TS.files.upsertAndSignal(n.file)}};var o=function e(t){var n=_.isString(t)?TS.files.getFileById(t):t;if(!_.isObject(n))throw new Error("Expected file or file ID.");return n}})()},4223:function(e,t){(function(){"use strict";TS.registerModule("ims",{switched_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,closed_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,data_retention_changed_sig:new signals.Signal,onStart:function e(){if(TS.useReactSidebar()){TS.prefs.display_real_names_override_changed_sig.add(i);TS.prefs.team_display_real_names_changed_sig.add(i);TS.members.changed_profile_sig.add(r)}},addMsg:function e(t,n){var r=TS.ims.getImById(t);if(!r){TS.error('unknown im "'+t+'"');return}if(TS.useReactMessages()){if(!TS.redux.messages.addMessage(n,true))return}else if(!TS.shared.addMsg(r,n))return;var i=!TS.utility.msgs.isTempMsg(n);TS.ims.calcUnreadCnts(r,i);TS.utility.msgs.maybeTruncateMsgs(r);TS.ims.message_received_sig.dispatch(r,n);if(!r.is_open)if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.open",{users:r.user,return_im:true,reason:"TS.ims.addMsg"},TS.ims.onOpened);else TS.api.call("im.open",{user:r.user,return_im:true,reason:"TS.ims.addMsg"},TS.ims.onOpened)},calcUnreadCnts:function e(t,n){TS.shared.calcUnreadCnts(t,TS.ims,n)},removeMsg:function e(t,n){var r=TS.ims.getImById(t);if(!r){TS.error('unknown im "'+t+'"');return}if(r._archive_msgs)TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n);TS.ims.message_removed_sig.dispatch(r,n);TS.ims.calcUnreadCnts(r,true)},sendMsg:function e(t,n,r,i){return TS.shared.sendMsg(t,n,TS.ims,r,i)},onSendMsg:function e(t,n){var r=TS.ims.getImById(n.SENT_MSG.channel);if(!r){TS.error("unknown im? "+n.SENT_MSG.channel);return}TS.shared.onSendMsg(t,n,r,TS.ims)},closeImByMemberId:function e(t){var n=TS.ims.getImByMemberId(t);if(!n)return;TS.ims.closeIm(n.id)},closeIm:function e(t){var n=TS.ims.getImById(t);if(!n||!n.is_open)return;n.is_open=false;var r=TS.model.active_im_id==t;if(r&&TS.client)TS.client.activeChannelDisplayGoneAway();TS.ims.onClosed(true,{no_op:!r},{channel:t});var i="im.close";if(TS.boot_data.feature_shared_channels_beta)i="conversations.close";TS.api.call(i,{channel:t}).catch(function(){n.is_open=true;TS.ims.onClosed(true,{no_op:!r},{channel:t})})},onClosed:function e(t,n,r){if(!t)return;if(n.no_op){var i=TS.ims.getImById(r.channel);if(i)TS.ims.closed_sig.dispatch(i)}},startImById:function e(t,n,r){var i=TS.ims.getImById(t);if(!i){TS.error(t+" not an im");return}TS.ims.startImByMemberId(i.user,n,r)},startImByMemberName:function e(t,n,r){var i=TS.members.getMemberByName(t);if(!i){TS.error("no member?? "+t);return}TS.ims.startImByMemberId(i.id,n,r)},startImByMemberId:function e(t,n,r){var i=TS.ims.getImByMemberId(t);if(i){TS.console.log(6532,"im_debug: found im");if(TS.ims.isImWithDeletedMember(i))TS.client.archives.previous_model_ob=TS.shared.getActiveModelOb();TS.ims.displayIm(i.id,n);if(i.is_open){TS.console.log(6532,"im_debug: im is open");if(r)TS.ims.sendMsg(i.id,$.trim(r));return Promise.resolve()}}TS.model.requested_im_opens[t]={and_send_txt:r};if(TS.boot_data.feature_shared_channels_beta)return TS.api.call("conversations.open",{users:t,return_im:true,reason:"TS.ims.startImByMemberId"},TS.ims.onOpened);return TS.api.call("im.open",{user:t,return_im:true,reason:"TS.ims.startImByMemberId"},TS.ims.onOpened)},promiseToStartImByMemberId:function e(t,n,r,i){var a=TS.ims.startImByMemberId(t,n,r,i);var s=function e(){var n=TS.shared.getActiveModelOb();return n&&n.is_im&&n.user===t};TS.console.log(6532,"im_debug: start promise (id="+t+", isActive="+s()+")");if(s())return Promise.resolve();return a.then(function(e){TS.console.log(6532,"im_debug: promise resolved (id="+e.request_id+", isActive="+s()+")");if(s())return Promise.resolve();var n;return new Promise(function(e){TS.console.log(6532,"im_debug: start inner promise");n=function t(){TS.console.log(6532,"im_debug: im_switched (isActive="+s()+")");if(s())return e()};TS.ims.switched_sig.add(n)}).timeout(3e4).finally(function(){TS.console.log(6532,"im_debug: inner promise finally");delete TS.model.requested_im_opens[t];TS.ims.switched_sig.remove(n)})})},onOpened:function e(t,n,r){if(!t)return;if(r.return_im&&n.channel)TS.ims.upsertIm(n.channel)},displayIm:function e(t,n,r){if(TS.isPartiallyBooted()&&t!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+t);var i=TS.ims.getImById(t);if(!i){TS.error('im "'+t+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(i);TS.shared.maybeClearHasAutoScrolled();if(TS.shared.didDeferMessageHistoryById(i.id))TS.shared.checkInitialMsgHistory(i,TS.ims);if(t==TS.model.active_im_id&&!TS.client.activeChannelIsHidden()){if(r)TS.ims.sendMsg(i.id,$.trim(r));return}var a=TS.client.channelDisplaySwitched({id:t,no_history_add:n});if(a)TS.ims.switched_sig.dispatch();if(r)TS.ims.sendMsg(i.id,$.trim(r))},setLastRead:function e(t,n,r){if(t.last_read==n)return false;if(n.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+n);return false}var i=t.id+". last_read = "+t.last_read+" -> "+n+", reason: "+(r||"unspecified");if(t.last_read>n){var a=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n];if(a){TS.warn("NOT going back in time on im "+i);return}if(TS.has_pri[o])TS.log(o,"going back in time on im "+i);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,n)}else{if(TS.has_pri[o])TS.log(o,"TS.ims.setLastRead: "+i);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,n)}t.last_read=n;if(r)t._marked_reason=r;TS.ims.marked_sig.dispatch(t);TS.utility.msgs.maybeClearUsersCountsInfo(t);TS.ims.calcUnreadCnts(t);return true},markMostRecentReadMsg:function e(t,n,r){if(!t){TS.error("im unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.entities.channels.markMostRecentMsgRead(t.id));return}if((!t.msgs||!t.msgs.length)&&!r)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){if(t.msgs&&t.msgs.length||!t._latest_via_users_counts)TS.warn('no valid tses for im "'+t.id+'"???');return}TS.ims.markReadMsg(t.id,i,n)},markReadMsg:function e(t,n,r){var i=TS.ims.getImById(t);if(!i){TS.error('im "'+t+'" unknown');return}if(i.last_read==n)return;if(TS.ims.setLastRead(i,n,r)){i._marked_reason=r;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},onMarked:function e(t,n,r){var i=TS.ims.getImById(r.channel);if(!i){TS.error('wtf no im "'+r.channel+'"');return}if(!t){var a=true;TS.redux.channels.setMarkingState(i.id,a)}},getImsFilteredBy:function e(t){return TS.shared.getEntitiesFilteredBy("ims",t)},getImById:function e(t){if(!t)return null;return TS.redux.channels.getImById(t)},getDisplayNameOfUserForIm:function e(t){if(TS.useReactSidebar())return n(t);return TS.members.getPrefCompliantMemberName(TS.members.getMemberById(t.user))},getDisplayNameOfUserForImLowerCase:function e(t){return TS.members.getPrefCompliantMemberNameLowerCase(TS.members.getMemberById(t.user))},getImByUsername:function e(t){var n=TS.members.getMemberByName(t);if(!n)return null;return TS.ims.getImByMemberId(n.id)},getImByMemberId:function e(t){return TS.redux.channels.getImByMemberId(t)},getFirstOpenIm:function e(){var t=TS.model.ims;var n;if(!t)return null;for(var r=0;r<t.length;r+=1){n=t[r];if(n.is_open)return n}return null},isImWithDeletedMember:function e(t){if(!t.is_im)return false;var n=TS.members.getMemberById(t.user);if(!n||!n.deleted)return false;return true},setNameFromMember:function t(n){var r=TS.ims.getImByMemberId(n.id);if(!r)return;e(r,n)},upsertIm:function e(n,r){var i=TS.ims.getImById(n.id);delete n.unread_count;if(i){i=_.assign({},TS.redux.channels.dangerouslyGetEntityById(n.id));if(TS.has_pri[s])TS.log(s,'updating existing im "'+n.id+'"');_.each(_.keys(n),function(e){i[e]=n[e]});n=i;if(TS.isPartiallyBooted()&&null===n.oldest_msg_ts)n.oldest_msg_ts=TS.storage.fetchOldestTs(n.id);TS.shared.maybeResetHistoryFetched(n);if(TS.client&&(n.is_open||n.unread_cnt)){var a=true;TS.shared.checkInitialMsgHistory(n,TS.ims,a)}if(!r)TS.redux.channels.replaceEntity(n)}else{if(TS.has_pri[s])TS.log(s,'adding im "'+n.id+'"');TS.utility.ensureInArray(TS.model.all_im_ids,n.id);var o=TS.members.getMemberById(n.user);t(n,o);if(!r)TS.redux.channels.addEntity(n)}if(TS.client){var l=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(n);if(TS.model.active_cid==n.id)TS.ims.calcUnreadCnts(n,l);else if(!i)TS.ims.calcUnreadCnts(n,l)}return n},markScrollTop:function e(t,n){var r=TS.ims.getImById(t);if(!r)return false;if(r.scroll_top==n)return false;r.scroll_top=n;return true},maybeLoadScrollBackHistory:function e(t,n){var r=TS.ims.getImById(t);if(!r)return false;return TS.shared.maybeLoadScrollBackHistory(r,TS.ims,n)},onHistory:function e(t,n,r){var i=TS.ims.getImById(r.channel);if(!i){TS.error('wtf no im "'+r.channel+'"');return}if(!t||!n||!n.messages){TS.error("failed to get history for im "+r.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=2500;var s=5e3;var o=_.random(a,s);TS.info("retrying history fetch on im "+i.id+" in "+o);window.setTimeout(function(){TS.info("retrying history fetch on im "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.ims.fetchHistory(i,r,TS.ims.onHistory)},o);return}i.history_fetch_retries=0;var l=TS.shared.onHistory(i,n,r,TS.ims);if(!l){i.history_is_being_fetched=false;TS.ims.history_fetched_sig.dispatch(i)}var u=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.ims.calcUnreadCnts(i,u);if(TS.view)if(!l&&i.unread_cnt)TS.client.channel_pane.rebuild("ims")},fetchHistory:function e(t,n,r){if(!t){TS.error('wtf no im "'+t+'"');return}if(!TS.boot_data.feature_initial_scroll_position)TS.shared.maybeClearHasAutoScrolled(t);t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.ims.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;if(TS.client)TS.client.msg_pane.updateEndMarker();return}TS.api.call("im.history",n,r||TS.ims.onHistory)},checkForOldImsToClose:function e(){return TS.shared.checkForOldImsToClose()},setDataRetention:function e(t,n,r,i){var a={channel:t,retention_type:$("select[name=retention_type]").val()};if(1==a.retention_type)a.retention_duration=$("#retention_duration").val();TS.api.call("im.setRetention",a,function(e,t,n){if(i)i(e,t,n);if(e)TS.ims.data_retention_changed_sig.dispatch(n)})},getDataRetention:function e(t,n){TS.api.call("im.getRetention",{channel:t},n)}});var e=function e(t,n){if(TS._incremental_boot&&t.name);else t.name=t.user;if(n)t.name=n.name;t._name_lc=_.toLower(t.name)};var t=function t(n,r){TS.shared.setPriorityForDev(n);n.is_im=true;e(n,r);if(r)if(r.is_slackbot)n.is_slackbot_im=true;else if(r.is_self)n.is_self_im=true;TS.shared.maybeResetHistoryFetched(n);n.opened_this_session=false;n.scroll_top=-1;n.history_is_being_fetched=false;n.unread_highlight_cnt=0;n.unread_highlights=[];n.unread_cnt=0;n.unreads=[];TS.shared.setOldestUnreadTsForId(n.id,null);n.has_fetched_history_after_scrollback=false;if(TS.client)if(TS._incremental_boot&&n.msgs&&n.msgs.length>0){n.msgs=n.msgs.map(function(e){return TS.utility.msgs.processImsg(e,n.id)});TS.utility.msgs.setMsgs(n,n.msgs)}else TS.utility.msgs.setMsgs(n,[]);else if(TS.boot_data.msgs)TS.utility.msgs.ingestMessagesFromBootData(n);n.oldest_msg_ts=TS.storage.fetchOldestTs(n.id)||null;n.last_msg_input=TS.storage.fetchLastMsgInput(n.id)||null;n.has_draft=!!n.last_msg_input;if(r)n.is_archived=r.deleted};var n=function e(t){if(t._display_name)return t._display_name;var n=TS.members.getMemberById(t.user);if(!n)return t.name;t._display_name=TS.members.getPrefCompliantMemberName(n);return t._display_name};var r=function e(t){var n=_.find(TS.model.ims,{user:t.id});if(n)a(n)};var i=function e(){TS.model.ims.forEach(a)};var a=function e(t){t._display_name=void 0};var s=4;var o=142})()},4224:function(e,t){(function(){"use strict";TS.registerModule("mpims",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,closed_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,data_retention_changed_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(i);TS.prefs.team_display_real_names_changed_sig.add(i);TS.members.changed_profile_sig.add(r)},getVisibleMpims:function e(t){TS.channels.getAllVisibleMpimsForUser(t)},addMsg:function e(t,n){var r=TS.mpims.getMpimById(t);if(!r){TS.error('unknown mpim "'+t+'"');return}if(TS.useReactMessages()){if(!TS.redux.messages.addMessage(n,true))return}else if(!TS.shared.addMsg(r,n))return;var i=!TS.utility.msgs.isTempMsg(n);TS.mpims.calcUnreadCnts(r,i);TS.utility.msgs.maybeTruncateMsgs(r);TS.mpims.message_received_sig.dispatch(r,n);if(!r.is_open&&TS.utility.msgs.msgCanCountAsUnread(n))if(1==r.members.length){var a=r.members[0];if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.open",{users:a,return_im:true,reason:"TS.mpims.addMsg"},TS.ims.onOpened);else TS.api.call("im.open",{user:a,return_im:true,reason:"TS.mpims.addMsg"},TS.ims.onOpened)}else if(r.members.length>1){var s=r.members.join(",");if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.open",{users:s},TS.mpims.onOpened);else TS.api.call("mpim.open",{users:s},TS.mpims.onOpened)}},calcUnreadCnts:function e(t,n){TS.shared.calcUnreadCnts(t,TS.mpims,n)},removeMsg:function e(t,n){var r=TS.mpims.getMpimById(t);if(!r){TS.error('unknown mpim "'+t+'"');return}if(r._archive_msgs)TS.utility.msgs.spliceMsg(r._archive_msgs,n);var i=r.msgs;TS.utility.msgs.spliceMsg(i,n);TS.mpims.message_removed_sig.dispatch(r,n);TS.mpims.calcUnreadCnts(r,true)},sendMsg:function e(t,n,r,i){return TS.shared.sendMsgGroup(t,n,TS.mpims,r,i)},onSendMsg:function e(t,n){var r=TS.mpims.getMpimById(n.SENT_MSG.channel);if(!r){TS.error("unknown mpim? "+n.SENT_MSG.channel);return}TS.shared.onSendMsg(t,n,r,TS.mpims)},closeMpim:function e(t){var n=TS.mpims.getMpimById(t);if(!n){n=TS.channels.getChannelById(t);if(TS.shared.isModelObShared(n))TS.channels.closeMpim(t);return}if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.close",{channel:t},TS.mpims.onClosed);else TS.api.call("mpim.close",{channel:t},TS.mpims.onClosed)},onClosed:function e(t,n,r){if(!t)return;if(n.no_op){var i=TS.mpims.getMpimById(r.channel);if(i)TS.mpims.closed_sig.dispatch(i)}},onOpened:function e(t){if(!t);},displayMpim:function e(t){var n=_.defaults({},t,{from_history:false,replace_history_state:false});var r=n.id;if(!r){TS.error("no mpim id supplied");return}var i=n.path;var a=n.and_send_txt;var s=n.from_history;var o=n.replace_history_state;if(TS.isPartiallyBooted()&&r!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+r);var l=TS.mpims.getMpimById(r);if(!l){TS.error('mpim "'+r+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(l);TS.shared.maybeClearHasAutoScrolled();if(TS.shared.didDeferMessageHistoryById(l.id))TS.shared.checkInitialMsgHistory(l,TS.mpims);if(r==TS.model.active_mpim_id&&!o&&!TS.client.activeChannelIsHidden()){TS.warn('mpim "'+r+'" already displayed');if(a)TS.mpims.sendMsg(r,$.trim(a));return}var u=o?false:s;var d=i||"/messages/"+l;var c=TS.client.channelDisplaySwitched({id:r,path:d,replace_history_state:o,no_history_add:u});if(c)TS.mpims.switched_sig.dispatch();if(l.is_open){if(a)TS.mpims.sendMsg(r,$.trim(a));return}TS.model.requested_mpim_opens[r]={and_send_txt:a};var m=l.members.filter(function(e){return TS.model.user.id!==e});if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.open",{users:m.join(",")},TS.mpims.onOpened);else TS.api.call("mpim.open",{users:m.join(",")},TS.mpims.onOpened)},setLastRead:function e(t,n,r){if(t.last_read==n)return false;if(n.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+n);return false}var i=t.id+". last_read = "+t.last_read+" -> "+n+", reason: "+(r||"unspecified");if(t.last_read>n){var a=TS.model.last_reads_set_by_client[t.id+"_"+n];delete TS.model.last_reads_set_by_client[t.id+"_"+n];if(a){TS.warn("NOT going back in time on mpim "+i);return}if(TS.has_pri[c])TS.log(c,"going back in time on mpim "+i);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,n)}else{if(TS.has_pri[c])TS.log(c,"TS.mpims.setLastRead: "+i);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,n)}t.last_read=n;if(r)t._marked_reason=r;TS.mpims.marked_sig.dispatch(t);TS.utility.msgs.maybeClearUsersCountsInfo(t);TS.mpims.calcUnreadCnts(t);return true},markMostRecentReadMsg:function e(t,n,r){if(!t){TS.error("mpim unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.entities.channels.markMostRecentMsgRead(t.id));return}if((!t.msgs||!t.msgs.length)&&!r)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){if(t.msgs&&t.msgs.length||!t._latest_via_users_counts)TS.warn('no valid tses for mpim "'+t.id+'"???');return}TS.mpims.markReadMsg(t.id,i,n)},markReadMsg:function e(t,n,r){var i=TS.mpims.getMpimById(t);if(!i){TS.error('mpim "'+t+'" unknown');return}if(i.last_read==n)return;if(TS.mpims.setLastRead(i,n,r)){i._marked_reason=r;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},onMarked:function e(t,n,r){var i=TS.mpims.getMpimById(r.channel);if(!i){TS.error('error no mpim "'+r.channel+'"');return}if(!t){var a=true;TS.redux.channels.setMarkingState(i.id,a)}},getMpimsFilteredBy:function e(t){return TS.shared.getEntitiesFilteredBy("mpims",t)},getMpimById:function e(t){if(!t)return null;return TS.redux.channels.getMpimById(t)},getMpimByName:function e(t){return TS.redux.channels.getMpimByName(t)},getActiveMembers:function e(t){var n=TS.mpims.getMembersInDisplayOrder(t);return n.filter(function(e){return!e.deleted})},getMembersInDisplayOrder:function e(t){if(!t)return;if(t._members&&t._members.length===t.members.length-1)return t._members;t._members=_.without(t.members,TS.model.user.id).map(function(e){var t=TS.members.getMemberById(e);if(!t)TS.warn("Could not find a member in model with id: "+e);return t});return _.compact(t._members)},getDisplayName:function e(t,n,r,i,a){var u=_.isInteger(i);if(t._display_name&&!n&&!r&&!u&&!a)return t._display_name;if(t._display_name_truncated&&!n&&!r&&!a&&u)return t._display_name_truncated;if(a)return l(t);if(TS.boot_data.feature_name_tagging_client)return o(t,n);var d=TS.mpims.getMembersInDisplayOrder(t);var c=TS.members.shouldDisplayRealNames();var m=_.compact(d);var f=d.length-m.length;if(f){var p=_(m).map("id").value().join(",");TS.warn("TS.mpims.getDisplayName(): Missing "+f+" members. Valid IDs = "+p);d=m}var h={};if(c)d.forEach(function(e){if(e.profile.first_name){if(!h[e.profile.first_name])h[e.profile.first_name]=[];h[e.profile.first_name].push(e)}});var g=d.map(function(e){var t="";if(TS.members.getMemberCurrentStatus(e).emoji||TS.members.getMemberCurrentStatus(e).text)t=" "+TS.templates.current_status({tip_direction:"bottom",member:e,classes:"ts_tip_float"});if(e.profile.first_name&&c){var i=$.trim(e.profile.first_name);var a=$.trim(e.profile.last_name);var o=i;if(a&&(h[i]&&h[i].length>1||r))o+=" "+s(a)+".";if(n){o=_.escape($.trim(o));o='<span class="mpdm_member '+TS.templates.makeMemberDomId(e)+" "+TS.templates.makeMemberPresenceStateClass(e)+'" data-member-id="'+e.id+'">'+o+t+"</span>"}return o}var l=$.trim(e.name);if(n){l=_.escape(l);l='<span class="mpdm_member '+TS.templates.makeMemberDomId(e)+" "+TS.templates.makeMemberPresenceStateClass(e)+'" data-member-id="'+e.id+'">'+l+t+"</span>"}return l});var S;if(u&&n)S=g.slice(0,i).join(" ");else if(n)S=g.join(" ");else if(u&&g.length>i+1){var T=g.splice(0,i);S=TS.i18n.t("{names} and {others_count, number} others","mpims")({names:T.join(", "),others_count:g.length})}else S=g.join(", ");if(!n&&!r&&!u)t._display_name=S;if(!n&&!r&&u)t._display_name_truncated=S;return S},getDisplayNameLowerCase:function e(t){if(t._display_name_lc)return t._display_name_lc;var n=TS.mpims.getDisplayName(t);t._display_name_lc=_.toLower(n);return t._display_name_lc},getTooltipText:function e(t){var n=TS.mpims.getMembersInDisplayOrder(t);var r=n.map(function(e){if(e.profile.real_name)return e.profile.real_name;return e.name});var i=r.join(", ");if(i===TS.mpims.getDisplayName(t))return"";return i},getMpimArchivesPath:function e(t){return"/archives/"+t.id},getMemberCount:function e(t){return Math.min(Math.max(t.members.length-1,2),9)},upsertMpim:function e(t,n){var r=TS.mpims.getMpimById(t.id);delete t.unread_count;if(r){r=_.assign({},TS.redux.channels.dangerouslyGetEntityById(t.id));if(TS.has_pri[d])TS.log(d,'updating existing mpim "'+r.id+'"');for(var i in t){if("name"===i)continue;r[i]=t[i]}t=r;if(TS.isPartiallyBooted()&&null===t.oldest_msg_ts)t.oldest_msg_ts=TS.storage.fetchOldestTs(t.id);TS.shared.maybeResetHistoryFetched(r);if(TS.client&&(t.is_open||t.unread_cnt)){var a=true;TS.shared.checkInitialMsgHistory(t,TS.mpims,a)}if(!n)TS.redux.channels.replaceEntity(t)}else{if(TS.has_pri[d])TS.log(d,'adding mpim "'+t.id+'"');TS.utility.ensureInArray(TS.model.all_group_ids,t.id);u(t);if(!n)TS.redux.channels.addEntity(t)}if(TS.client){var s=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(t);if(TS.model.active_cid==t.id)TS.mpims.calcUnreadCnts(t,s);else if(!r)TS.mpims.calcUnreadCnts(t,s)}return t},processNewMpimForUpserting:function e(t){u(t)},markScrollTop:function e(t,n){var r=TS.mpims.getMpimById(t);if(!r)return false;if(r.scroll_top==n)return false;r.scroll_top=n;return true},maybeLoadScrollBackHistory:function e(t,n){var r=TS.mpims.getMpimById(t);if(!r)return false;return TS.shared.maybeLoadScrollBackHistory(r,TS.mpims,n)},onHistory:function e(t,n,r){var i=TS.mpims.getMpimById(r.channel);if(!i){TS.error('error no mpim "'+r.channel+'"');return}if(!t||!n||!n.messages){TS.error("failed to get history for mpim "+r.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=2500;var s=5e3;var o=_.random(a,s);TS.info("retrying history fetch on mpim "+i.id+" in "+o);window.setTimeout(function(){TS.info("retrying history fetch on mpim "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.ims.fetchHistory(i,r,TS.mpims.onHistory)},o);return}i.history_fetch_retries=0;var l=TS.shared.onHistory(i,n,r,TS.mpims);if(!l){i.history_is_being_fetched=false;TS.mpims.history_fetched_sig.dispatch(i)}var u=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.mpims.calcUnreadCnts(i,u);if(TS.view)if(!l&&i.unread_cnt)TS.client.channel_pane.rebuild("ims")},fetchHistory:function e(t,n,r){if(!t){TS.error('error no mpim "'+t+'"');return}if(!TS.boot_data.feature_initial_scroll_position)TS.shared.maybeClearHasAutoScrolled(t);t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.mpims.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;if(TS.client)TS.client.msg_pane.updateEndMarker();return}if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.history",n,r||TS.mpims.onHistory);else TS.api.call("mpim.history",n,r||TS.mpims.onHistory)},setNamesFromMember:function e(t){TS.model.mpims.forEach(function(e){if(_.includes(e.members,t.id)){n(e);a(e)}})},checkMpimMatch:function e(t,n,r){if(!t)return;var i=true;var a=true;var s=TS.mpims.getMembersInDisplayOrder(t);for(var o=0;o<n.length;o+=1){var l=false;for(var u=0;u<s.length;u+=1)if(TS.utility.members.checkMemberMatch(s[u],n[o],i)||r&&TS.utility.members.checkMemberMatch(s[u],r[o],i))l=true;if(!l)a=false}return a},setDataRetention:function e(t,n,r,i){var a={channel:t,retention_type:$("select[name=retention_type]").val()};if(1==a.retention_type)a.retention_duration=$("#retention_duration").val();TS.api.call("mpim.setRetention",a,function(e,t,n){if(i)i(e,t,n);if(e)TS.mpims.data_retention_changed_sig.dispatch(n)})},getDataRetention:function e(t,n){TS.api.call("mpim.getRetention",{channel:t},n)},convertToGroup:function e(t,n,r){r=r||{};var i=t.id;return TS.api.call("mpim.convertToGroup",{channel:i,name:n,validate:!!r.validate_name})}});var e=false;var t=function t(n){var r=TS.mpims.getMembersInDisplayOrder(n);if(r.length<2)return n._internal_name;if(_.compact(r).length<r.length){var i=_(r).compact().map("id").value();var a=_.without(n.members,i);TS.warn("Missing some members in MPIM "+n.id+":"+a.join(","));var s=_.reject(a,TS.members.getMemberById);if(s.length>0)TS.warn("Some members ("+s.join(",")+") were still unavailable when we tried again; unable to recover");else{TS.info("All members were available when we tried again; recovering");n._members=void 0;r=TS.mpims.getMembersInDisplayOrder()}if(!e){e=true;TS.console.logStackTrace("We are somehow trying to generate a name for an mpim without having all members locally. Here's a stack trace");if(TS.boot_data.feature_tinyspeck)TS.metrics.count("mpim_missing_members_bug_ts_only");else TS.metrics.count("mpim_missing_members_bug")}}return"@"+_(r).compact().map(function(e){if(TS.utility.teams.isMemberExternal(e))return e.name+"_"+e.team_id;return e.name}).value().join(",")};var n=function e(n){if(n._name_lc)TS.redux.channels.removeEntityFromNameMap(n._name_lc);n.name=t(n);n._name_lc=_.toLower(n.name);TS.redux.channels.addEntityToNameMap(n)};var r=function e(t){TS.model.mpims.forEach(function(e){if(-1!==e.members.indexOf(t.id))a(e)})};var i=function e(){TS.model.mpims.forEach(a)};var a=function e(t){t._display_name=void 0;t._display_name_lc=void 0};var s=function e(t){var n=t.charCodeAt(0);var r;if(n>=55296&&n<=56319&&t.length>1){r=t.charCodeAt(1);if(r>=56320&&r<=57343)return t.substring(0,2)}return t.substring(0,1)};var o=function e(t,n){var r=TS.mpims.getMembersInDisplayOrder(t);var i=r.map(function(e){var t=TS.members.getPrefCompliantMemberName(e);if(n){var r="";if(TS.members.getMemberCurrentStatus(e).emoji||TS.members.getMemberCurrentStatus(e).text)r=" "+TS.templates.current_status({tip_direction:"bottom",member:e,classes:"ts_tip_float"});t=_.escape($.trim(t));t='<li class="mpdm_member '+TS.templates.makeMemberDomId(e)+" "+TS.templates.makeMemberPresenceStateClass(e)+'" data-member-id="'+e.id+'">'+t+r+"</li>"}return t});var a=n?i.join(" "):i.join(", ");if(!n)t._display_name=a;return a};var l=function e(t){var n=TS.mpims.getMembersInDisplayOrder(t);var r=n.map(function(e){return TS.members.getPrefCompliantMemberName(e)});var i=TS.i18n.listify(r,{strong:true}).join("");return i};var u=function e(t){t._internal_name=t.name;n(t);TS.shared.setPriorityForDev(t);t.is_mpim=true;t.is_group=true;t.opened_this_session=false;t.scroll_top=-1;t.history_is_being_fetched=false;t.unread_highlight_cnt=0;t.unread_highlights=[];t.unread_cnt=0;t.unreads=[];TS.shared.setOldestUnreadTsForId(t.id,null);t.has_fetched_history_after_scrollback=false;if(TS.client){TS.shared.maybeResetHistoryFetched(t);if(TS._incremental_boot&&t.msgs&&t.msgs.length>0){t.msgs=t.msgs.map(function(e){return TS.utility.msgs.processImsg(e,t.id)});TS.utility.msgs.setMsgs(t,t.msgs)}else TS.utility.msgs.setMsgs(t,[])}else if(TS.boot_data.msgs)TS.utility.msgs.ingestMessagesFromBootData(t);t.oldest_msg_ts=TS.storage.fetchOldestTs(t.id);t.last_msg_input=TS.storage.fetchLastMsgInput(t.id);t.has_draft=!!t.last_msg_input};var d=4;var c=142})()},4225:function(e,t){(function(){"use strict";TS.registerModule("shared",{msg_sent_sig:new signals.Signal,onStart:function e(){if(TS.client){TS.channels.switched_sig.add(m);TS.ims.switched_sig.add(m);TS.groups.switched_sig.add(m);TS.mpims.switched_sig.add(m);if(TS.client&&TS.client.unread)TS.client.unread.switched_sig.add(m);if(TS.client&&TS.client.threads)TS.client.threads.switched_sig.add(m);var n=function e(){t=true;v()};if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.connectedSig.addOnce(n);TS.interop.SocketManager.connectedSig.add(w)}else{TS.ms.connected_sig.addOnce(n);TS.ms.connected_sig.add(w)}}},test:function e(){var t={};Object.defineProperty(t,"_queried_usernames",{get:function e(){return b},set:function e(t){b=t}});return t},didDeferMessageHistoryById:function e(t){if(!t)return false;return i[t]},setDeferMessageHistoryForId:function e(t,n){if(!t)return;i[t]=!!n},getUserCountsInfoById:function e(t){if(!t)return;return s[t]},setUserCountsInfoForId:function e(t,n){if(!t)return;s[t]=n},deleteUserCountsInfoForId:function e(t){if(!t)return;delete s[t]},getOldestUnreadTsForId:function e(t){if(!t)return;return o[t]},setOldestUnreadTsForId:function e(t,n){if(!t)return;o[t]=n},calcUnreadCnts:function e(t,n,r){if(TS.useReactMessages())return;if(TS._incremental_boot)return;if(TS.shared.didDeferMessageHistoryById(t.id))if(!t.is_im&&!t.is_mpim){if(!a[t.id]){var i=2500;var o=1e4;var l=_.random(i,o);if(TS.has_pri[M])TS.log(M,"calcUnreadCnts ("+t.id+"): no history in model, no history call yet - delaying "+l+" ms before history fetch.");a[t.id]=window.setTimeout(function(){if(TS.has_pri[M])TS.log(M,"calcUnreadCnts ("+t.id+"): fetching after "+l+" ms delay.");delete a[t.id];TS.shared.checkInitialMsgHistory(t,n)},l)}}else{TS.shared.checkInitialMsgHistory(t,n);return}t.unreads.length=0;t.unread_highlights.length=0;TS.shared.setOldestUnreadTsForId(t.id,null);var u=t.msgs;var d=t.unread_cnt;var c=t.unread_highlight_cnt;var m;var f=false;var p=false;var h=true;var g="away"===TS.model.user.presence;if(!t.was_archived_this_session){if(t.is_archived)h=false;if(t.is_channel&&!t.is_member)h=false}if(t.is_im){var S=TS.members.getMemberById(t.user);if(S&&S.deleted)h=false}var T=TS.notifs.isCorGMuted(t.id);var v=t.is_im||t.is_mpim||TS.notifs.canModelObHaveChannelMentions(t);var b;if(h&&u)for(var y=0;y<u.length;y+=1){m=u[y];if(m.ts<=t.last_read)continue;if(TS.utility.msgs.isTempMsg(m)&&!m._alert_even_though_temp)continue;p=TS.utility.msgs.msgCanCountAsUnread(m);f=f||p;if(!p)continue;t.unreads.push(m.ts);var w=TS.shared.getOldestUnreadTsForId(t.id);if(!w||m.ts<w)TS.shared.setOldestUnreadTsForId(t.id,m.ts);if("thread_broadcast"===m.subtype)continue;if(v){var k=1e3*parseFloat(m.ts);b=g||k<TS.model.user._presence_last_changed;if(TS.utility.msgs.msgContainsMention(m,b))if(TS.permissions.members.canMsgMentionChannelIfMention(m.text,t.id,m.user)){TS.log(99,"allowing channel mention for msg.ts "+m.ts+" from member "+m.user+" in "+t.id);t.unread_highlights.push(m.ts)}else TS.log(99,"ignoring large channel mention for msg.ts "+m.ts+" from member "+m.user+" in "+t.id+" because member is not an admin.")}else if(TS.utility.msgs.getMsgMentionData(m).non_channel_mentions)t.unread_highlights.push(m.ts)}if(!f&&t.unreads.length){t.unreads.length=0;t.unread_highlights.length=0;TS.shared.setOldestUnreadTsForId(t.id,null);if(r)n.markMostRecentReadMsg(t,TS.model.marked_reasons.none_qualify)}if(TS.has_pri[I])TS.log(I,"TS.shared.calcUnreadCnts: "+t.id+", unreads.length: "+t.unreads.length+" and_mark: "+r);var x=TS.shared.lastReadIsOlderThanCurrentHistory(t);if(TS.boot_data.feature_calc_unread_minimums&&x)t.unread_cnt=Math.max(t.unread_cnt,t.unreads.length);else t.unread_cnt=t.unreads.length;if(T)if(t.unread_cnt)t._show_in_list_even_though_no_unreads=true;if(TS.boot_data.feature_calc_unread_minimums&&x)t.unread_highlight_cnt=Math.max(t.unread_highlight_cnt,t.unread_highlights.length);else t.unread_highlight_cnt=t.unread_highlights.length;TS.shared.maybeMarkReadIfMuted(t,n);TS.utility.msgs.countAllUnreads();if(d!=t.unread_cnt)n.unread_changed_sig.dispatch(t);if(c!=t.unread_highlight_cnt)n.unread_highlight_changed_sig.dispatch(t);if(TS.client){if(!s[t.id]||!s[t.id].has_unreads)return;if(!t._history_fetched_since_last_connect||t.history_is_being_fetched)return;if(!t.msgs.length||t.unread_cnt)return;delete s[t.id];if(TS.notifs.isCorGMuted(t.id)){if(TS.has_pri[I])TS.log(I,"TS.shared.calcUnreadCnts: "+t.id+": ignoring possible users.counts has_unreads discrepancy because channel is muted.");return}var C=TS.shared.getActiveModelOb();if(C&&C.id===t.id){if(TS.has_pri[I])TS.log(I,"TS.shared.calcUnreadCnts: "+t.id+": ignoring possible users.counts has_unreads discrepancy due to active channel.");return}var A=TS.utility.msgs.getMostRecentValidTs(t);var E=TS.model.marked_reasons.none_qualify;TS.warn('Found users.counts discrepancy: has_unreads = true for "'+t.id+'", but client calculated 0 unreads after fetching history ('+t.msgs.length+' msgs). Marking now with reason="'+E+'" to correct discrepancy, assuming last_read ('+t.last_read+") < latest ("+A+").");if(parseFloat(t.last_read)>=parseFloat(A)){TS.warn('Error last >= latest for "'+t.id+'"? Bailing, not attempting to mark.');return}n.markMostRecentReadMsg(t,E)}},getLatestMsgTs:function e(t){if(t.latest&&t.latest.ts){if(TS.has_pri[M])TS.log(M,"getLatestMsgTs ("+t.id+"): returning model_ob.latest.ts of "+t.latest.ts);return t.latest.ts}var n=t.latest||t._latest_via_users_counts;if(TS.has_pri[M])TS.console.log(M,"getLatestMsgTs ("+t.id+"): no latest.ts, returning latest || _latest_via_users_counts ("+t.latest+" || "+t._latest_via_users_counts+") -> "+n);return n},queueConsistencyCheckAfterHistory:function e(t){if(!t){TS.warn("queueConsistencyCheck: no model_ob");return}if(t._consistency_is_being_checked||t._consistency_has_been_checked)return;var n=TS.shared.getControllerForModelOb(t);n.history_fetched_sig.addOnce(function(e){if(!e)return;if(e._consistency_is_being_checked||e._consistency_has_been_checked)return;if(TS.has_pri[M])TS.log(M,'"'+t.id+'": fetched history, now checking consistency.');TS.utility.msgs.checkConsistencyViaApi(e.id)})},maybeFetchHistoryAndThenCheckConsistency:function e(t){var n=true;TS.shared.maybeFetchHistory(t,n)},maybeFetchHistory:function e(t,n){if(!t){TS.warn("maybeFetchHistory: no model_ob?");return}var r;if(TS.has_pri[M])r='maybeFetchHistory: "'+t.id+'": ';if(t.history_is_being_fetched){if(TS.has_pri[M])TS.log(M,r+"history is being fetched already. Queueing consistency check and exiting.");TS.shared.queueConsistencyCheckAfterHistory(t);return}if(t._history_fetched_since_last_connect){if(TS.has_pri[M])TS.log(M,r+"history already fetched.");TS.utility.msgs.checkConsistencyViaApi(TS.model.active_cid);return}if(TS.has_pri[M])if(n)TS.log(M,r+"checking history first, then consistency.");else TS.log(M,r+"checking history.");if(n)TS.shared.queueConsistencyCheckAfterHistory(t);var i=TS.shared.getControllerForModelOb(t);TS.shared.checkInitialMsgHistory(t,i);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearNewMsgsTimer(t)},checkInitialMsgHistory:function e(n,r,i){if(TS.useReactMessages())return;if(n.history_is_being_fetched){TS.warn('checkInitialMsgHistory NOT DOING ANYTHING, because "'+n.id+'" history_is_being_fetched:true');return}var s=TS.isPartiallyBooted()||!t;if(s&&TS._did_incremental_boot&&n.id===TS.model.active_channel_id)return;if(a[n.id]){if(TS.has_pri[M])TS.log(M,"checkInitialMsgHistory ("+n.id+"): Clearing _delayed_fetch_timer and fetching immediately");window.clearTimeout(a[n.id]);delete a[n.id]}TS.shared.setDeferMessageHistoryForId(n.id,false);if(i)n._needs_unread_recalc=true;else TS.utility.msgs.maybeFetchUserDataFromLS(n);var o=TS.model.initial_msgs_cnt;var l=TS.shared.getLatestMsgTs(n);var u=TS.utility.msgs.getMsg(l,n.msgs);if(u&&!n._history_fetched_since_last_connect){if(TS.has_pri[M])TS.log(M,'We have all recent "'+n.id+'" messages, but have not fetched history since last connect. Will fetch, omitting "latest".');u=null;l=null}var d;if(u){if(TS.has_pri[M])TS.log(M,'we have all recent "'+n.id+'" msgs unread_count:'+n.unread_count+" unread_cnt:"+n.unread_cnt+" initial_count:"+o);TS.shared.maybeDealWithAllSentTempMsgs(n,r);var c=TS.utility.msgs.getOlderMsgsStatus(n);if(n.msgs.length<TS.model.initial_msgs_cnt&&c.more){if(TS.isPartiallyBooted());else{TS.error("calling loadHistory because status.more=true && model_ob.msgs.length < TS.model.initial_msgs_cnt: "+n.msgs.length+" < "+TS.model.initial_msgs_cnt);TS.dir(0,c,n.id);TS.shared.loadHistory(n,r,o)}return true}}else if(i)TS.shared.setDeferMessageHistoryForId(n.id,true);else{if(TS.has_pri[M])TS.log(M,'WE DO NOT HAVE ALL RECENT MESSAGES for "'+n.id+'" unread_count:'+n.unread_count+" unread_cnt:"+n.unread_cnt+" initial_count:"+o);var _=false;if(!n.msgs.length);d={channel:n.id,count:o,inclusive:"string"===typeof n.latest,ignore_replies:true,include_pin_count:true};if(l)d.latest=l;if(_){if(TS.has_pri[M])TS.log(M,'we have some but not all recent "'+n.id+'" msgs but we no_oldest so are not setting oldest for api call')}else if(n.msgs.length&&!TS.utility.msgs.isTempMsg(n.msgs[0])){if(TS.has_pri[M])TS.log(M,'we have some but not all recent "'+n.id+'" msgs');d.oldest=n.msgs[0].ts}else if(TS.has_pri[M])TS.log(M,'we have no "'+n.id+'" msgs');if(!n._history_fetched_since_last_connect)if(!n.msgs.length){if(TS.has_pri[M])TS.log(M,'we have no msgs for "'+n.id+'", and have not fetched history since last connection');if(d.latest){if(TS.has_pri[M])TS.log(M,"no msgs.length. dropping api_args.latest of "+d.latest+' for "'+n.id+'"');delete d.latest}if(d.oldest){if(TS.has_pri[M])TS.log(M,"no msgs.length. dropping api_args.oldest of "+d.oldest+' for "'+n.id+'"');delete d.oldest}}else if(1===n.msgs.length&&!TS.utility.msgs.isTempMsg(n.msgs[0])){if(TS.has_pri[M])TS.log(M,'first new message on "'+n.id+", fetching history without any latest/oldest");delete d.latest;delete d.oldest}else{if(TS.has_pri[M])TS.log(M,"we have some ("+n.msgs.length+') but not all recent msgs for "'+n.id+'", and have not fetched history since last connection');if(d.latest){if(TS.has_pri[M])TS.log(M,'first history fetch since connect for "'+n.id+'" - deleting api_args.latest of '+d.latest);delete d.latest}if(d.oldest&&d.count)if(TS.has_pri[M])TS.log(M,"We have api_args.oldest, fetching oldest + "+d.count+' messages on "'+n.id+'" to get client up-to-date.')}var m=function e(){if(n.history_is_being_fetched){if(TS.has_pri[M])TS.log(M,'NOT fetching history on "'+n.id+'", history already being fetched')}else{if(TS.has_pri[M])TS.log(M,'fetching history for "'+n.id+'" with api_args',d);r.fetchHistory(n,d)}};var f=TS.isSocketManagerEnabled()?TS.interop.SocketManager.isConnected():TS.model.ms_connected;if(f)m();else if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(m);else TS.ms.connected_sig.addOnce(m)}},maybeLoadScrollBackHistory:function e(t,n,r){if(!r&&0!==t.scroll_top)return false;var i=TS.utility.msgs.getOlderMsgsStatus(t);if(!i.more){TS.info("Not loading scrollback in "+t.id+": "+i.text);if(3===i.code){var a=_.map(t.msgs,"ts");TS.shared.checkForMoreMsgs(t).then(function(){var e;e="more messages than expected in "+t.id;TS.logError(e,"oldest_msg_ts or is_limited is wrong","Scrollback history error");var r=_.map(t.msgs,"ts");var i=_.difference(a,r);var s=_.difference(r,a);if(i.length||s.length){e="timestamps not present in new data:"+i.toString()+"; timestamps not present in old data: "+s.toString();TS.logError(e,"Found a difference in timestamps before and after history call","Scrollback history error")}else TS.log(null,"Did not find a difference between old and new timestamp data after history API call.");if(TS.shared.getActiveModelOb().id!==t.id||t.history_is_being_fetched)return;if(t.is_limited)t.is_limited=false;if(t.oldest_msg_ts)TS.utility.msgs.resetOldestMsgsTs(t);TS.shared.loadScrollBackHistory(t,n)},_.noop)}return false}return TS.shared.loadScrollBackHistory(t,n)},loadScrollBackHistory:function e(t,n){if(!t.msgs.length){if(TS.has_pri[M])TS.log(M,"TS.shared.loadScrollbackHistory: No messages in "+t.id+" yet; not loading scrollback history.");if(!t._history_fetched_since_last_connect){if(TS.has_pri[M])TS.log(M,"TS.shared.loadScrollBackHistory: No messages, and history has not been fetched since last connect; doing an initial fetch.");TS.shared.checkInitialMsgHistory(t,n)}return}TS.info(t.id+" HAS MORE");TS.shared.loadHistory(t,n);t.has_fetched_history_after_scrollback=true;t.fetched_history_after_scrollback_time=Date.now();return true},loadHistory:function e(t,n,r){var i={channel:t.id,latest:t.msgs[t.msgs.length-1].ts,count:r||TS.model.subsequent_msgs_cnt,ignore_replies:true,include_pin_count:true};n.fetchHistory(t,i)},checkForMoreMsgs:function e(t){var n={channel:t.id,latest:t.msgs[t.msgs.length-1].ts,count:1,ignore_replies:true,include_pin_count:true};return TS.api.call(TS.shared.getHistoryApiMethodForModelOb(t),n).then(function(e){if(e.data.messages&&e.data.messages.length>0)return Promise.resolve(e);return Promise.reject(new Error("No more messages"))})},onSendMsg:function e(t,n,r,i){var a=n.temp_ts?TS.utility.msgs.getMsgByProp("temp_ts",n.temp_ts,r.msgs):null;if(!t){if(a){TS.model.unsent_msgs[a.ts]=true;i.msg_not_sent_sig.dispatch(r,a,n)}else TS.error("that makes no sense");return}TS.view.scroll_down_when_msg_from_user_is_added=true;var s;if(a){s=_.cloneDeep(a);s.text=n.text;s.ts=n.ts;delete s.is_pending;i.removeMsg(r.id,a)}else{TS.warn("no temp msg for "+n.reply_to);s={text:n.text,user:TS.model.user.id,ts:n.ts}}if(n.SENT_MSG.thread_ts)s.thread_ts=n.SENT_MSG.thread_ts;i.addMsg(n.SENT_MSG.channel||r.id,TS.utility.msgs.processImsg(s,r.id));var o;if(r.is_channel)o=TS.i18n.t("channel","shared")();else if(r.is_group&&!r.is_mpim)o=TS.i18n.t("private channel","shared")();else return;var l=n.text.match(/<!subteam(.*?)>/g);if(l)for(var u=0;u<l.length;u+=1){var d=l[u].replace(">","").replace("<","");d=d.split("|")[0];var c=d.split("^")[1];if(!c)continue;(function(e){TS.user_groups.getUserGroupMembers(e,function(t){var i=_.uniq(t.users);if(!i)return;TS.membership.ensureChannelMembershipIsKnownForUsers(r.id,i).then(function(){var t=[];i.forEach(function(e){if(!TS.membership.getUserChannelMembershipStatus(e,r).is_member)t.push(e)});if(!t.length)return;var a=TS.interop.datetime.makeTsStamp();var l="<!subteam^"+e+">";var u=t.length;var d="TS.client.ui.promptForGroupOrChannelInvite('"+r.id+"', '"+t.join(",")+"', '"+a+"')";var c="TS.client.ui.sendChannelMsgThroughSlackBot('"+r.id+"', '"+n.ts+"', '"+t.join(",")+"', '"+a+"')";var _="TS.utility.msgs.removeEphemeralMsg('"+r.id+"', '"+a+"')";TS.client.msg_pane.addMaybeClick(d,TS.client.ui.promptForGroupOrChannelInvite.bind(Object.create(null),r.id,t.join(","),a));TS.client.msg_pane.addMaybeClick(c,TS.client.ui.sendChannelMsgThroughSlackBot.bind(Object.create(null),r.id,n.ts,t.join(","),a));TS.client.msg_pane.addMaybeClick(_,TS.utility.msgs.removeEphemeralMsg.bind(Object.create(null),r.id,a));var m="";m=TS.i18n.t("{member_count, plural, =1 {One member} =2 {Two members} =3 {Three members} =4 {Four members} =5 {Five members} =6 {Six members} =7 {Seven members} =8 {Eight members} =9 {Nine members} =10 {Ten members} other {# members}} of the {name} group {member_count, plural, =1 {isn’t} other {aren’t}} in this {channel}. ","shared")({name:l,member_count:u,channel:o});if("G"===r.id.charAt(0))m+=TS.i18n.t("If you’d like I can <javascript:{prompt}|invite them to join>, or, <javascript:{nothing}|do nothing>.","shared")({prompt:d,nothing:_});else m+=TS.i18n.t("If you’d like Slack can <javascript:{message}|notify them about your message>.","shared")({message:c});TS.client.ui.addEphemeralBotMsg({channel:r.id,ts:a,text:m,thread_ts:s.thread_ts})})})})(c)}var m=TS.client&&TS.client.stats&&TS.client.stats.isEnabled();if(m)TS.metrics.measureAndClear("send_msg_"+TS.shared.getTypeForModelOb(),"msg_input_try_to_submit")},sendMsg:function t(n,r,i,a,s){if(!r)return false;var o=TS.shared.getModelObById(n);var l=o&&o.msgs&&o.msgs[0]&&TS.interop.datetime.toDateObject(o.msgs[0].ts+1)||Date.now();var u=TS.interop.datetime.makeTsStamp(l);var d=TS.format.cleanMsg(r);if(!TS.boot_data.feature_name_tagging_client){var c=_(TS.utility.members.getUsernamesMentionedInString(r)).reject(TS.members.getMemberByName).reject(TS.user_groups.getUserGroupsByHandle).reject(function(e){return b[e]}).value();if(c.length>0){var m=this;var f=arguments;y(c).then(function(){TS.shared.sendMsg.apply(m,f);return null});return true}}var p={type:"message",channel:n,text:$.trim(d)};if(a){p.thread_ts=a.thread_ts||a.ts;p.reply_broadcast=s}if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.send(p).then(function(e){e.temp_ts=u;i.onSendMsg(true,e)}).catch(function(e){e.msg.temp_ts=u;i.onSendMsg(false,e.msg)}).finally(function(){_.pull(e[n],u)});e[n]=e[n]||[];e[n].push(u)}else TS.ms.send(p,function(e,t){t.temp_ts=u;return i.onSendMsg(e,t)},u);TS.typing.userEnded(o);var h={type:"message",text:d,user:TS.model.user.id,ts:u,is_pending:true,temp_ts:u};if(p.thread_ts){h.thread_ts=p.thread_ts;h._hidden_reply=true;h._was_reply_broadcast=p.reply_broadcast}i.addMsg(n,h);TS.shared.msg_sent_sig.dispatch(o);return true},sendMsgGroup:function e(t,n,r,i,a){var s=TS.shared.getModelObById(t);var o=s.is_mpim?TS.i18n.t("conversation","shared")():TS.i18n.t("channel","shared")();var l=s.is_mpim?"conversation":"channel";if(!s)return false;if(s.is_archived)return false;var u=TS.channels.getGeneralChannel();var d=function e(t){TS.generic_dialog.alert(t).then(function(){if(i)TS.ui.replies.focusReplyInput();else TS.view.focusMessageInput()});if(i)TS.ui.replies.populateReplyInput(n);else TS.utility.contenteditable.value(TS.client.ui.$msg_input,n)};var c=TS.format.cleanMsg(n);var m=!!i;var f;if(TS.model.everyone_regex.test(c)&&!m){if(!TS.permissions.members.canAtMentionEveryone()){if(!TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings())if(TS.boot_data.feature_teams_to_workspaces)f="<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";else f="<p>"+TS.i18n.t("A Team Owner has restricted the use of <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";else if(TS.boot_data.feature_teams_to_workspaces)f="<p>"+TS.i18n.t("Usage of <strong>{everyone}</strong> is restricted to Workspace Admins in the large general channel.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";else f="<p>"+TS.i18n.t("Usage of <strong>{everyone}</strong> is restricted to Team Admins in the large general channel.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup(s.id))f+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this {conversation_or_channel}, use <strong>{at_label}</strong> instead.","shared")({conversation_or_channel:o,at_label:TS.templates.builders.atLabel(l)})+"</p>";else if(TS.model.user.is_restricted)f="<p>"+TS.i18n.t("Your account is restricted, and you cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";d(f);return false}if(!u||!u.is_member){f="<p>"+TS.i18n.t("You cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup())f+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this {conversation_or_channel}, use <strong>{at_label}</strong> instead.","shared")({conversation_or_channel:o,at_label:TS.templates.builders.atLabel(l)})+"</p>";d(f)}else TS.generic_dialog.start({title:TS.i18n.t("Send {everyone} a message","shared")({everyone:TS.templates.builders.atLabel("everyone")}),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this {conversation_or_channel}, use <strong>{channel}</strong> instead.</p>',"shared")({general_channel:"#"+_.escape(u.name),conversation_or_channel:o,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}):TS.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your whole team, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this {conversation_or_channel}, use <strong>{channel}</strong> instead.</p>',"shared")({general_channel:"#"+_.escape(u.name),conversation_or_channel:o,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, send it","shared")(),onGo:function e(){TS.channels.displayChannel({id:u.id,and_send_txt:n})},onCancel:function e(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,n);TS.view.focusMessageInput()}});return false}var p=TS.model.here_regex.test(c);var h=(TS.model.channel_regex.test(c)||TS.model.group_regex.test(c))&&!m;if((h||p)&&!TS.permissions.members.canAtChannelOrGroup()){var g=p?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");if(TS.boot_data.feature_teams_to_workspaces)f="<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <strong>{key_word}</strong> messages.","shared")({key_word:g})+"</p>";else f="<p>"+TS.i18n.t("A Team Owner has restricted the use of <strong>{key_word}</strong> messages.","shared")({key_word:g})+"</p>";d(f);return false}if(!m&&TS.ui.needToShowAtChannelWarning(t,n)){TS.ui.at_channel_warning_dialog.startInMessagePane(t,n,r);return false}return TS.shared.sendMsg(t,n,r,i,a)},onHistory:function e(t,n,r,i){var a=t.msgs;var s;if(n.is_limited){if(TS.has_pri[M])TS.log(M,'data.is_limited case: setting has_more = false, is_limited = true for "'+t.id+'"',r);n.has_more=false;t.is_limited=true}var o;if(!t._history_fetched_since_last_connect){if(TS.has_pri[M])TS.log(M,'first history fetch for "'+t.id+'"',r);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeResetUnreadsCheck(t);if(r.oldest)if(!n.has_more){if(TS.has_pri[M])TS.log(M,'first history fetch. has_more is false for "'+t.id+'" - we should have all recent msgs. Setting _history_fetched_since_last_connect.',r);t._history_fetched_since_last_connect=true;if(t.history_is_being_fetched){if(TS.has_pri[M])TS.log(M,'Resetting history_is_being_fetched for "'+t.id+'"');t.history_is_being_fetched=false}o=true;if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeStartNewMsgsTimer(t)}else{t.msgs=[];d={channel:t.id,count:TS.model.initial_msgs_cnt,inclusive:true};if(TS.has_pri[M])TS.log(M,'first history fetch. has_more is TRUE for "'+t.id+'" - dumping history and fetching most recent '+TS.model.initial_msgs_cnt+" msgs. prior history call data follows.",r);i.fetchHistory(t,d);return true}else{if(TS.boot_data.feature_scrollback_half_measures&&TS.model.prefs.start_scroll_at_oldest){var l=parseInt(t.last_read,10)?t.last_read:null;if(n.messages&&l&&!r._second_attempt_for_last_read){var u=_.minBy(n.messages,"ts");if(u&&u.ts>l){var d={channel:t.id,count:3*TS.model.initial_msgs_cnt,inclusive:true,_second_attempt_for_last_read:true};if(TS.has_pri[M])TS.log(M,"last_read for "+t.id+" is older than the first history response, trying again with a larger count");i.fetchHistory(t,d);return true}}}if(TS.has_pri[M])TS.log(M,'first history fetch. no "oldest" param for "'+t.id+'", marking _history_fetched_since_last_connect = true.',r);t._history_fetched_since_last_connect=true;if(t.history_is_being_fetched){if(TS.has_pri[M])TS.log(M,'Resetting history_is_being_fetched for "'+t.id+'"');t.history_is_being_fetched=false}o=true;if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeStartNewMsgsTimer(t)}}if(r.oldest)if(n.has_more){TS.info(t.id+" has more than one page of msg history between what is in cache and the latest, so let's dump what we have and just use this page of results");TS.info(t.id+" args.oldest:"+r.oldest);a.length=0;if(t.is_limited)t.is_limited=false}var c=[];var m=[];if(n.messages){for(var f=0;f<n.messages.length;f+=1)if(!TS.utility.msgs.getMsg(n.messages[f].ts,a)){s=n.messages[f];c.push(TS.utility.msgs.processImsgFromHistory(s,t.id));m.push(s.ts)}if(TS.has_pri[M])TS.log(M,'got history for "'+t.id+'", added '+c.length+" new messages out of "+n.messages.length+" total.")}if(c.length&&!TS.utility.msgs.getDisplayedMsgs(c).length)TS.warn("no displayed msgs in this page for "+t.id+" ! We expect TS.client.ui.afterHistoryFetch to detect this and load another page");a=c.concat(a);a=TS.utility.msgs.setMsgs(t,a);if(TS.has_pri[E])TS.log(E,t.id+" msgs has more history now");if(t.latest&&t.latest.ts&&!TS.utility.msgs.getMsg(t.latest.ts,a)){if(TS.has_pri[E])TS.log(E,"tacking on latest msg "+t.latest.ts);s=t.latest;TS.utility.msgs.appendMsg(a,TS.utility.msgs.processImsgFromHistory(s,t.id));TS.utility.msgs.sortMsgs(a)}if(!r.oldest)if(!n.has_more&&!n.is_limited)TS.utility.msgs.setOldestMsgsTs(t);TS.shared.maybeDealWithAllSentTempMsgs(t,i);if(o){if(TS.has_pri[M])TS.log(M,"onHistory: post-message merge, doing recalc of unread counts for "+t.id);var p=false;i.calcUnreadCnts(t,p)}if(TS.pins)TS.pins.updateCount(t,n.pin_count)},maybeDealWithAllSentTempMsgs:function t(n,r){if(!TS.useSocket())return;function i(e){var t=TS.utility.msgs.getMsg(e,n.msgs);if(!t)return;var i=TS.utility.msgs.getNonTempMsgFromUserMatchingText(t.text,TS.model.user.id,n.msgs);if(i){var a=TS.interop.datetime.toDateObject(i.ts);var s=TS.interop.datetime.toDateObject(e);if(a<s){TS.info("existing_msg time is older than temp_msg time, so it can’t be the message we were looking for");i=null}}if(!i){TS.warn("not removing, we don’t appear to have this non-temp message: "+t.ts);TS.model.unsent_msgs[t.ts]=true;r.msg_not_sent_sig.dispatch(n,t);return}TS.info("removing temp_msg: "+t.ts+" existing_msg:"+i.ts);if(!r)r=TS.shared.getControllerForModelOb(n);if(_.isFunction(r.removeMsg))r.removeMsg(n.id,t);return true}if(TS.isSocketManagerEnabled()){if(!e.hasOwnProperty(n.id))return;e[n.id].forEach(function(e){i(e)});delete e[n.id]}else _.forOwn(TS.ms.sent_map,function(e,t){if(e.msg.channel!=n.id)return;var r=i(e.temp_ts);if(r)delete TS.ms.sent_map[t]})},getControllerForModelOb:function e(t){if(!t)return{};if(t.is_im)return TS.ims;else if(t.is_mpim&&t.is_group)return TS.mpims;else if(t.is_group)return TS.groups;return TS.channels},getActiveModelOb:function e(){var t;if(TS.client){if(TS.model.active_channel_id)t=TS.channels.getChannelById(TS.model.active_channel_id);else if(TS.model.active_im_id)t=TS.ims.getImById(TS.model.active_im_id);else if(TS.model.active_mpim_id)t=TS.mpims.getMpimById(TS.model.active_mpim_id);else if(TS.model.active_group_id)t=TS.groups.getGroupById(TS.model.active_group_id)}else if(TS.boot_data.channel_id)t=TS.channels.getChannelById(TS.boot_data.channel_id);else if(TS.boot_data.im_id)t=TS.ims.getImById(TS.boot_data.im_id);else if(TS.boot_data.mpim_id)t=TS.mpims.getMpimById(TS.boot_data.mpim_id);else if(TS.boot_data.group_id)t=TS.groups.getGroupById(TS.boot_data.group_id);else{TS.warn("error getActiveModelOb found no ob");TS.warn("TS.boot_data.channel_id: "+TS.boot_data.channel_id);TS.warn("TS.boot_data.im_id: "+TS.boot_data.im_id);TS.warn("TS.boot_data.group_id: "+TS.boot_data.group_id)}return t},getDisplayNameForModelOb:function e(t){if(t.is_mpim)return TS.mpims.getDisplayName(t);else if(t.is_im){var n=false;var r=true;return TS.members.getPrefCompliantMemberNameById(t.user,n,r)}else if(t.is_group||t.is_private)return t.name;else if(t.is_channel)return"#"+t.name;TS.warn("getDisplayNameForModelOb: unknown model_ob type: "+t.id);return t.id},getTypeForModelOb:function e(t){t=t||TS.shared.getActiveModelOb();if(!t)return"";if(t.is_mpim)return"mpim";if(t.is_slackbot_im)return"slackbot";if(t.is_im)return"im";if(t.is_group)return"group";if(t.is_channel)return"channel";return""},getDisplayNameForModelObNoSigns:function e(t){if(t.is_mpim)return TS.mpims.getDisplayName(t);else if(t.is_im){var n=false;var r=false;return TS.members.getPrefCompliantMemberNameById(t.user,n,r)}else if(t.is_group||t.is_channel)return t.name;TS.warn("getDisplayNameForModelOb: unknown model_ob type: "+t.id);return t.id},getEntitiesFilteredBy:function e(t,n){if(!t)return[];if(!n)return TS.model[t];return _.filter(TS.model[t],n)},getModelObById:function e(t){if(!t)return null;var n=t[0];if("C"===n)return TS.channels.getChannelById(t);else if("G"===n)return TS.mpims.getMpimById(t)||TS.groups.getGroupById(t);else if("S"===n)return TS.user_groups.getUserGroupsById(t);else if("E"===n)return TS.emoji.getEmojiById(t);else if("B"===n)return TS.bots.getBotById(t);else if("U"===n||"W"===n)return TS.members.getMemberById(t);return TS.ims.getImById(t)},getAllModelObsForUser:function e(){return TS.channels.getChannelsForUser().concat(TS.model.groups,TS.model.ims,TS.model.mpims)},getShareModelObId:function e(t,n){var r;var i;var a=function e(t){if(TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==t)TS.client.archives.cancel()};if(t&&TS.interop.utility.looksLikeMemberId(t)){r=TS.ims.getImByMemberId(t);if(!r)if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.open",{users:t,return_im:true,reason:"TS.shared.getShareModelObId"},function(e,i,a){if(e){TS.ims.onOpened(e,i,a);r=TS.ims.getImByMemberId(t);if(r)n(r.id);else if(TS.web)n(i.channel.id);else TS.error("getShareModelObId opened an IM, but it is not in the model? data.channel.id: "+i.channel.id)}else TS.error("getShareModelObId try to open an IM, but failed data: "+JSON.stringify(i||null))});else TS.api.call("im.open",{user:t,return_im:true,reason:"TS.shared.getShareModelObId"},function(e,i,a){if(e){TS.ims.onOpened(e,i,a);r=TS.ims.getImByMemberId(t);if(r)n(r.id);else if(TS.web)n(i.channel.id);else TS.error("getShareModelObId opened an IM, but it is not in the model? data.channel.id: "+i.channel.id)}else TS.error("getShareModelObId try to open an IM, but failed data: "+JSON.stringify(i||null))});else{t=r.id;a(t);n(t)}}else if(t&&"C"===t.charAt(0)){i=TS.channels.getChannelById(t);if(!i.is_member&&!i.is_archived)TS.channels.joinById(i.id,function(e){if(e)n(t);else n(t)});else{a(t);n(t)}}else{a(t);n(t)}},getModelObIdForSendingMsg:function e(t,n){var r;var i;if(t&&TS.interop.utility.looksLikeMemberId(t)){r=TS.ims.getImByMemberId(t);if(!r)if(TS.boot_data.feature_shared_channels_beta)TS.api.call("conversations.open",{users:t,return_im:true,reason:"TS.shared.getModelObIdForSendingMsg"},function(e,i,a){if(e){TS.ims.onOpened(e,i,a);r=TS.ims.getImByMemberId(t);if(r)n(r.id);else if(TS.web)n(i.channel.id);else TS.error("getModelObIdForSendingMsg opened an IM, but it is not in the model? data.channel.id: "+i.channel.id)}else TS.error("getModelObIdForSendingMsg try to open an IM, but failed data: "+JSON.stringify(i||null))});else TS.api.call("im.open",{user:t,return_im:true,reason:"TS.shared.getModelObIdForSendingMsg"},function(e,i,a){if(e){TS.ims.onOpened(e,i,a);r=TS.ims.getImByMemberId(t);if(r)n(r.id);else if(TS.web)n(i.channel.id);else TS.error("getModelObIdForSendingMsg opened an IM, but it is not in the model? data.channel.id: "+i.channel.id)}else TS.error("getModelObIdForSendingMsg try to open an IM, but failed data: "+JSON.stringify(i||null))});else{t=r.id;n(t)}}else if(t&&"C"===t.charAt(0)){i=TS.channels.getChannelById(t);if(!i.is_member&&!i.is_archived)TS.channels.joinById(i.id,function(e){if(e)n(t);else n(t)});else n(t)}else n(t)},maybeMarkReadIfMuted:function e(t){if(!t)return;if(!TS.notifs.isCorGMuted(t.id))return;if(!t.unreads.length||t.unread_highlights.length)return;if("hide_read_channels"===TS.model.prefs.sidebar_behavior){if(TS.model.active_cid==t.id)return}else if("hide_read_channels_unless_starred"===TS.model.prefs.sidebar_behavior&&!t.is_starred)if(TS.model.active_cid==t.id)return;if(t.is_mpim)TS.mpims.markMostRecentReadMsg(t,TS.model.marked_reasons.muted);else if(t.is_group)TS.groups.markMostRecentReadMsg(t,TS.model.marked_reasons.muted);else TS.channels.markMostRecentReadMsg(t,TS.model.marked_reasons.muted)},markReadMsg:function e(t,n,r){var i=TS.shared.getModelObById(t);var a=TS.shared.getControllerForModelOb(i);if(_.isFunction(a.markReadMsg))a.markReadMsg(i.id,n,r)},moveLastMsgInput:function e(t,n){if(!t.last_msg_input)return;n.last_msg_input=t.last_msg_input;n.has_draft=!!n.last_msg_input;t.last_msg_input="";t.has_draft=!!t.last_msg_input;TS.storage.storeLastMsgInput(t.id,t.last_msg_input);TS.storage.storeLastMsgInput(n.id,n.last_msg_input)},closeArchivedChannel:function e(t){var n=TS.shared.getModelObById(t);if(!n)return;if(!n.is_archived)return;n.was_archived_this_session=false;TS.client.activeChannelDisplayGoneAway()},getLastMsg:function e(t){if(!t.msgs||0===t.msgs.length)return null;for(var n=0;n<t.msgs.length;n+=1)if(!TS.utility.msgs.isMsgHidden(t.msgs[n])&&!t.msgs[n].is_ephemeral)return t.msgs[n];return null},sorterByLastMsg:function e(t,n){var r=t&&TS.shared.getLastMsg(t);var i=n&&TS.shared.getLastMsg(n);var a;var s;if(r)a=parseFloat(r.ts);else if(t){a=TS.shared.getLatestMsgTs(t);if(a)a=parseFloat(a)}if(i)s=parseFloat(i.ts);else if(n){s=TS.shared.getLatestMsgTs(n);if(s)s=parseFloat(s)}if(a&&s){if(a>s)return-1;if(s>a)return 1}else{if(a)return-1;if(s)return 1}return 0},hasUnreads:function e(t){if(!t)return false;var n=TS.shared.getLatestMsgTs(t);if(!n)return false;return n>t.last_read},checkForOldImsToClose:function e(){var t=TS.model.ims;var n=TS.model.mpims;var r=t.concat(n);var i;var a;var s;var o;var l;var u=0;var d=11;var c=6048e5;for(l=0;l<r.length;l+=1){i=r[l];if(!i.is_open&&!i.unread_cnt)continue;u+=1}var _=u-d;if(_<1)return;TS.info("checkForOldImsToClose might close some. this_too_many:"+_);var m=[];for(l=0;l<r.length;l+=1){i=r[l];if(i.is_slackbot_im)continue;if(i.is_self_im)continue;if(!i.is_open)continue;if(i.unread_cnt)continue;if(i.is_starred)continue;if(i.opened_this_session)continue;if(i==TS.shared.getActiveModelOb())continue;a=TS.shared.getLatestMsgTs(i)||"";if(i.msgs&&i.msgs.length&&i.msgs[0]&&i.msgs[0].ts>a)a=i.msgs[0].ts;if(a)s=TS.interop.datetime.toDateObject(a);else s=new Date(1e3*i.created);o=new Date-s;if(o>c){TS.info(i.id+" "+s+" ms_since_activity:"+o+" allow_elapsed_ms:"+c);m.push({model_ob:i,ms_since_activity:o})}}if(!m.length)TS.info("checkForOldImsToClose found no candidates for closing");m.sort(function e(t,n){var r=t.ms_since_activity;var i=n.ms_since_activity;if(r<i)return 1;if(r>i)return-1;return 0});m.length=m.length>_?_:m.length;for(l=0;l<m.length;l+=1){i=m[l].model_ob;TS.warn("checkForOldImsToClose CLOSING:"+i.id+" ms_since_activity:"+m[l].ms_since_activity);if(i.is_im)TS.ims.closeIm(i.id);else if(i.is_mpim)TS.mpims.closeMpim(i.id)}},ensureModelObIsPresent:function e(t){return new Promise(function(e,n){if(!t)return e();if("string"!==typeof t)return e();u(t).then(e,n)})},getModelObIdsNotPresent:function e(t){return t.filter(function(e){return!TS.shared.getModelObById(e)})},promiseToHaveAllRelevantImIds:function e(){n=n||new Promise(function(e,t){TS.api.callImmediately("im.list").then(function(t){if(t.data&&t.data.ims&&t.data.ims.length){t.data.ims.forEach(function(e){TS.utility.ensureInArray(TS.model.all_im_ids,e.id)});TS.log(48,"TS.model.all_im_ids: "+TS.model.all_im_ids)}e()},function(e){n=null;t(e)})});return n},promiseToHaveAllRelevantGroupIds:function e(){r=r||new Promise(function(e,t){TS.api.callImmediately("groups.list",{no_sort:true}).then(function(t){if(t.data&&t.data.groups&&t.data.groups.length){t.data.groups.forEach(function(e){TS.utility.ensureInArray(TS.model.all_group_ids,e.id)});TS.log(48,"TS.model.all_group_ids: "+TS.model.all_group_ids)}e()},function(e){r=null;t(e)})});return r},ensureModelObsArePresent:function e(t){if(!t||!t.length)return Promise.resolve();var n=t.map(function(e){return TS.shared.ensureModelObIsPresent(e).reflect()});return Promise.all(n).then(function(e){var t=[];e.forEach(function(e){if(e.isFulfilled())return;t.push(e.reason())});if(t.length)return Promise.reject(new Error("some ensureModelObsArePresent c_ids failed:\n"+t.join("\n")));return Promise.resolve()})},ensureModelObsInDataArePresent:function e(t,n){var r=TS.utility.extractAllModelObIds(t,n);return TS.shared.ensureModelObsArePresent(r)},getHistoryApiMethodForModelOb:function e(t){if(TS.boot_data.feature_shared_channels_beta)return"conversations.history";if(t.is_mpim)return"mpim.history";if(t.is_group&&!t.is_private&&!_.startsWith(t.id,"C"))return"groups.history";if(t.is_im)return"im.history";return"channels.history"},addMsg:function e(t,n){return l(t,[n])},addMsgs:function e(t,n){if(l(t,n)){var r=false;var i=TS.shared.getControllerForModelOb(t);if(_.isFunction(i.calcUnreadCnts))i.calcUnreadCnts(t,r);TS.utility.msgs.maybeTruncateMsgs(t);if(TS.client)if(TS.model.active_cid!==t.id){if(TS.has_pri[M])TS.log(M,'Got message(s) for "'+t.id+'", but not active_cid "'+TS.model.active_cid+'" (yet.) NOT rebuilding.')}else{if(TS.has_pri[M])TS.log(M,"Got messages on active channel, rebuilding.");var a=true;TS.client.msg_pane.rebuildMsgsWithReason("addMsgs: got messages on active channel "+t.id,a)}return true}return false},kickMember:function e(t,n){var r=t.is_channel||t.is_group&&!t.is_mpim;if(!r)return;if(t.is_group){if(!TS.permissions.members.canKickFromGroups())return}else if(!TS.permissions.members.canKickFromChannels())return;var i=TS.members.getMemberById(n);if(!i)return;var a=true;var s=true;var o=TS.members.getPrefCompliantMemberName(i,a,s);var l=TS.shared.getDisplayNameForModelOb(t);TS.membership.ensureChannelMembershipIsKnownForUsers(t.id,[n]).then(function(){if(!TS.membership.getUserChannelMembershipStatus(n,t).is_member){TS.generic_dialog.alert(TS.i18n.t("<strong>{user_name}</strong> is not a member of {channel_name}.","shared")({user_name:o,channel_name:l}));return null}var e;if(t.is_group)e="<p>"+TS.i18n.t("If you remove <strong>{user_name}</strong> from {channel_name}, they will no longer be able to see any of its messages. To rejoin the private channel, they will have to be re-invited.</p><p>Are you sure you wish to do this?","shared")({user_name:o,channel_name:l})+"</p>";else e="<p>"+TS.i18n.t("Are you sure you wish to remove <strong>{user_name}</strong> from {channel_name}?","shared")({user_name:o,channel_name:l})+"</p>";var r=t.is_group?"groups.kick":"channels.kick";TS.generic_dialog.start({title:TS.i18n.t("Remove {user_name}","shared")({user_name:o}),body:e,go_button_text:TS.i18n.t("Yes, remove them","shared")(),onGo:function e(){TS.api.call(r,{channel:t.id,user:n}).catch(function(e){TS.info("Removing user failed; api="+r+"; error="+e.data.error);setTimeout(function(){var t=i.is_ultra_restricted?TS.i18n.t("Single-channel guests","shared")():TS.i18n.t("Multi-channel guests","shared")();if("cant_kick_from_last_channel"===e.data.error&&TS.model.user.is_admin){TS.generic_dialog.start({title:TS.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}),body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can’t be removed from channels.</p><p>If <strong>{member_display_name}</strong> should no longer have access to your workspace, we suggest deactivating their account.</p>","shared")({account_type:t,member_display_name:o}):TS.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can’t be removed from channels.</p><p>If <strong>{member_display_name}</strong> should no longer have access to your Slack team, we suggest deactivating their account.</p>","shared")({account_type:t,member_display_name:o}),go_button_text:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Manage Members","shared")():TS.i18n.t("Manage Team Members","shared")(),show_cancel_button:true,onGo:function e(){TS.utility.openInNewTab("/admin#restricted",TS.templates.builders.newWindowName())}});return}var n;switch(e.data.error){case"cant_kick_from_last_channel":if(TS.boot_data.feature_teams_to_workspaces)n=TS.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can’t be removed from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({account_type:t,member_display_name:o});else n=TS.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can’t be removed from channels.</p><p>Please contact a Team Admin if <strong>{member_display_name}</strong> should no longer have access to your Slack team.</p>","shared")({account_type:t,member_display_name:o});break;case"restricted_action":if(TS.boot_data.feature_teams_to_workspaces)n=TS.i18n.t("<p>Hmm, looks like you don’t have permission to kick from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({member_display_name:o});else n=TS.i18n.t("<p>Hmm, looks like you don’t have permission to kick from channels.</p><p>Please contact a Team Admin if <strong>{member_display_name}</strong> should no longer have access to your Slack team.</p>","shared")({member_display_name:o});break;default:n=TS.i18n.t("<p>Something’s gone wrong, and we couldn’t remove <strong>{member_display_name}</strong> from {channel}. We suspect this is only temporary. Try again in a bit?</p>","shared")({member_display_name:o,channel:l})}TS.generic_dialog.alert(n,TS.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}))},500)})}});return null})},maybeResetHistoryFetchedOnAll:function e(){if(!TS.client)return;if(TS.has_pri[M])TS.log(M,"maybeResetHistoryFetchedOnAll()");function t(e){TS.shared.maybeResetHistoryFetched(e)}_.forEach(TS.model.channels,t);_.forEach(TS.model.ims,t);_.forEach(TS.model.mpims,t);_.forEach(TS.model.groups,t)},maybeResetHistoryFetched:function e(t){if(!TS.client)return;if(!t){TS.warn("maybeResetHistoryFetched: WTF no model_ob",t);return}if(!t._history_fetched_since_last_connect)return;if(TS.has_pri[M]&&t._history_fetched_since_last_connect)TS.log(M,'resetting history_fetched_since_last_connect for "'+t.id+'"');t._history_fetched_since_last_connect=false},maybeClearHasAutoScrolled:function e(){var t=TS.shared.getActiveModelOb();if(t&&t._has_auto_scrolled){if(TS.has_pri[M])TS.log(M,'resetting _has_auto_scrolled for "'+t.id+'"');t._has_auto_scrolled=false}},setPriorityForDev:function e(t){if(!TS.boot_data.feature_sli_channel_priority)return;if("dev"!==TS.boot_data.version_ts)return;if(t.priority||0===t.priority)return;t.priority=TS.utility.strToApparentlyRndPerc(t.id)},isModelObShared:function e(t){if(!_.isObject(t))return false;if(t.is_shared&&!t.is_org_shared)return true;return false},isModelObOrgShared:function e(t){if(!t||!TS.model||!TS.model.team)return false;var n=TS.boot_data.page_needs_enterprise;return n&&t.is_org_shared},isRelevantTeam:function e(){var t=true;if(!TS.model.is_our_app||!window.winssb)return t;if(!TS.boot_data.page_needs_enterprise||!TS.model.team||!TS.model.team.enterprise_id||!TS.boot_data.other_accounts)return t;if(!window.winssb)return t;if(TS.has_pri[A])TS.log(A,"isRelevantTeam()");var n=TS.model.enterprise_teams;if(1===n.length)return t;var r=_.map(n,function(e){return e.id});var i=TSSSB.call("getLastActiveTeamIdForTeamIds",r);var a;if(TS.has_pri[A])TS.log(A,"isRelevantTeam(): Got relevant team IDs from SSB",i);if(i instanceof Array&&i.length){a=i[0];if(TS.has_pri[A])TS.log(A,"isRelevantTeam(): Array case - taking the first relevant team id",a,i)}else if(TS.has_pri[A]){TS.log(A,"isRelevantTeam(): relevant_team_ids is not an array, OR, is empty?",i);TS.log(A,"isRelevantTeam(): Electron did not provide any matches for the given team_ids",r)}if(!a){if(TS.has_pri[A])TS.log(A,"Invalid response from SSB lastActiveTeamIdForTeamIds() call? Exiting.");return t}if(TS.has_pri[A])TS.log(A,"comparing most_relevant_team_id ( "+a+") -> TS.model.team_id ("+TS.model.team.id+")");if(a===TS.model.team.id){if(TS.has_pri[A])TS.log(A,"isRelevantTeam(): "+TS.model.team.id+" is relevant. Including.")}else{if(TS.has_pri[A])TS.log(A,"isRelevantTeam(): "+TS.model.team.id+" is NOT relevant. Excluding.");t=false}return t},isRelevantTeamForSharedModelOb:function e(t){var n=true;if(!t)return n;if(!window.winssb)return n;if(!TS.boot_data.page_needs_enterprise||!TS.model.team||!TS.model.team.enterprise_id||!TS.boot_data.other_accounts)return n;if(!t.is_org_shared&&!t.is_shared)return n;var r;if(TS.has_pri[A])TS.log(A,"isRelevantTeamForSharedModelOb(): "+t.id);if(t.is_im||t.is_mpim||t.is_global_shared)r=_.map(TS.model.enterprise_teams,"id");else r=t.shared_team_ids;if(!r){if(TS.has_pri[A])TS.log(A,"Could not find shared team IDs for "+t.id+"? Exiting.");return n}var i=TSSSB.call("getLastActiveTeamIdForTeamIds",r);var a;if(TS.has_pri[A])TS.log(A,"Got relevant team IDs from SSB",i);if(i instanceof Array&&i.length){a=i[0];if(TS.has_pri[A])TS.log(A,"Array case - taking the first relevant team id",a,i)}else{if(TS.has_pri[A])TS.log(A,"relevant_team_ids is not an array, OR, is empty?",i);if(r&&r.length){if(TS.has_pri[A])TS.log(A,"we have enterprise_team_ids, looking there and taking the first item.",r);a=r[0]}else if(TS.has_pri[A])TS.log(A,"WTF no enterprise_team_ids, either?")}if(!a){if(TS.has_pri[A])TS.log(A,"Invalid response from SSB lastActiveTeamIdForTeamIds() call on "+t.id+"? Exiting.");return n}if(TS.has_pri[A])TS.log(A,"comparing most_relevant_team_id ( "+a+") -> TS.model.team_id ("+TS.model.team.id+")");if(a===TS.model.team.id){if(TS.has_pri[A])TS.log(A,"Shared channel "+t.id+" is relevant for this team ("+TS.model.team.id+"). Including.")}else{if(TS.has_pri[A])TS.log(A,"Shared channel "+t.id+" is NOT relevant for this team ("+TS.model.team.id+"). Excluding.");n=false}return n},checkDisplayEmailAddressPref:function e(){if(!TS.client||!TS.model.team||!TS.model.team.prefs)return;var t=0;var n=0;var r=0;var i=.5;if(TS.model.members)_.each(TS.model.members,function(e){if(e.is_bot)n+=1;if(!e||!e.profile||!e.profile.email)return;if(e.id===TS.model.user.id)return;t+=1});r=TS.model.members.length-n;if(!TS.model.team.prefs.display_email_addresses)if(t){TS.info("Email display hidden for this team, but found "+t+" email fields in TS.model.members.");TS.shared.onDisplayEmailAddressesPrefChanged()}else TS.info("Email display hidden for this team. Client model OK. ✓");else if(!t){TS.info("Email display allowed for this team, but no email fields found in TS.model.members.");TS.shared.onDisplayEmailAddressesPrefChanged()}else if(t/r<i){TS.warn("Email display allowed for this team, but < "+100*i+"% of non-bot members ("+t+"/"+r+") in model have email fields. Dumping LS cache to correct inconsistency.");TS.shared.onDisplayEmailAddressesPrefChanged()}},onDisplayEmailAddressesPrefChanged:function e(){if(!TS.model||!TS.model.team||!TS.model.team.prefs)return;TS.info('Team pref "display_email_addresses" -> '+TS.model.team.prefs.display_email_addresses);var t=0;if(TS.model.members)TS.model.members=_.map(TS.model.members,function(e){if(!e.profile||!e.profile.email)return e;if(e.id===TS.model.user.id)return e;t+=1;if(!TS.model.team.prefs.display_email_addresses)e.profile.email=void 0;return e});if(!TS.model.team.prefs.display_email_addresses)if(t)TS.info("display_email_addresses check: found and cleared "+t+" email fields from TS.model.members.");else TS.info("display_email_addresses check: TS.model.members is already clear of email fields. ✓");else if(!t)TS.info("display_email_addresses check: pref enabled, but 0 email fields found in TS.model.members.");var n=false;var r=true;if(TS.client&&TS.client.ui&&!TS.model.ms_logged_in_once)TS.client.ui.rebuildAll(n,r)},lastReadIsOlderThanCurrentHistory:function e(t){t=t||TS.shared.getActiveModelOb();if(!parseInt(t.last_read,10))return false;if(!t.msgs||!t.msgs.length)return false;if(t.oldest_msg_ts&&t.last_read<t.oldest_msg_ts)return false;return!_.some(t.msgs,function(e){return e.ts<=t.last_read})},dispatchUnreadChanged:function e(t){var n=TS.shared.getControllerForModelOb(t);n.unread_changed_sig.dispatch(t)},dispatchUnreadHighlightChanged:function e(t){var n=TS.shared.getControllerForModelOb(t);n.unread_highlight_changed_sig.dispatch(t)},batchUpsertObjects:function e(t){if(TS.has_pri[O])TS.log(O,"Flannel: upserting batch of "+t.length+" objects");var n=_.partition(t,function(e){if(TS.utility.members.isMember(e)){var t=TS.members.getMemberById(e.id);if(!t)t=TS.members.getUnknownMemberById(e.id);return t&&!t.is_unknown}return TS.shared.getModelObById(e.id)});var r=n[0];var i=n[1];var a=_.some(i,C);var s=_.some(i,TS.utility.members.isMember);var o=[];function l(e){var t=x(e);if(t)o.push(t)}function u(e){var t=k(e);if(t)o.push(t);return t}r.forEach(l);if(a)TS.bots.startBatchUpsert();if(s)TS.members.startBatchUpsert();i.forEach(u);if(a)TS.bots.finishBatchUpsert();if(s)TS.members.finishBatchUpsert();return o.map(function(e){return e.member||e.bot||e})}});var e={};var t=false;var n;var r;var i={};var a={};var s={};var o={};var l=function e(t,n){var r=false;if(!t._history_fetched_since_last_connect){var i;if(TS.has_pri[M])i='Defer case: First new message on "'+t.id+'" - ';if(!n||!n.length)TS.warn("_addMsgsWorker("+t.id+"): WTF no msgs to add?");if(!t.is_im&&!t.is_mpim&&!t.msgs.length){if(TS.has_pri[M])TS.log(M,i+"no history in model, no history call yet - waiting for calcUnreadCnts() which will trigger a delayed history fetch.")}else if(t.msgs.length){if(t.history_is_being_fetched){if(TS.pri)TS.log(58,i+"some history, history fetch is already underway - attaching "+n.length+" message(s) to model.")}else if(!t._history_fetched_since_last_connect){if(TS.pri)TS.log(58,i+"some history, have not fetched history since last reconnect - attaching "+n.length+" new messages to model.");TS.shared.maybeFetchHistoryAndThenCheckConsistency(t)}}else if(t.history_is_being_fetched){if(TS.has_pri[M])TS.log(M,i+"no history in model, but history is already pending - adding "+n.length+" message(s) to model.")}else if(!t._history_fetched_since_last_connect){if(TS.has_pri[M])TS.log(M,i+"no history in model, no history call yet - fetching, and adding "+n.length+" message(s) to model.");TS.shared.maybeFetchHistoryAndThenCheckConsistency(t)}else if(TS.pri)if(TS.has_pri[M])TS.log(M,i+"Edge case - "+n.length+" new message(s) to add, but no history and we have called history, too?")}n=_.filter(n,function(e){var n=e.ts&&TS.utility.msgs.getMsg(e.ts,t.msgs);if(n&&TS.has_pri[M])TS.log(M,"Not adding duplicate message "+e.ts+", already in "+t.id);return!n});if(!n.length){if(TS.has_pri[M])TS.log(M,"No messages to add to "+t.id+" - exiting.");return false}if(TS.has_pri[M])TS.log(M,"Adding "+(n.length>1?"messages":"message")+" to "+t.id);n.forEach(function(e){if(TS.utility.msgs.validateMsg(t.id,e,t.msgs)){r=true;TS.utility.msgs.appendMsg(t.msgs,e)}});if(!r)return false;TS.utility.msgs.sortMsgs(t.msgs);TS.utility.msgs.maybeSetOldestMsgsTsAfterMsgAdded(t);return true};var u=function e(t){if("string"!==typeof t)return Promise.reject(Error('c_id: "'+t+'" is not a String'));if(TS.has_pri[F])TS.log(F,'_getModelObByIdFromModelOrApi c_id: "'+t+'"');var n=TS.shared.getModelObById(t);if(n)return Promise.resolve(n);if("C"===t.charAt(0))return d(t);else if("G"===t.charAt(0))return TS.shared.promiseToHaveAllRelevantGroupIds().then(function(){if(-1==TS.model.all_group_ids.indexOf(t)){TS.maybeWarn(48,"c_id:"+t+" is not in TS.model.all_group_ids, not calling the API");return Promise.resolve()}return d(t)}).catch(function(e){if(e&&"groups.list"===e.method)return d(t);return Promise.reject(e)});return TS.shared.promiseToHaveAllRelevantImIds().then(function(){if(-1==TS.model.all_im_ids.indexOf(t)){TS.maybeWarn(48,"c_id:"+t+" is not in TS.model.all_im_ids, not calling the API");return Promise.resolve()}return d(t)}).catch(function(e){if(e&&"im.list"===e.method)return d(t);return Promise.reject(e)})};var d=function e(t){if(TS.has_pri[F])TS.log(F,'_getModelObByIdFromApi c_id: "'+t+'"');return new Promise(function(e,n){var r=TS.model.incrementUnknownIdHandled(t);if("C"===t.charAt(0)){var i={channel:t,no_members:true};TS.api.callImmediately("channels.info",i).then(function(n){e(TS.channels.upsertChannel(n.data.channel));TS.model.reportResultOfUnknownIdHandled(t,true)},function(i){if(TS.boot_data.page_needs_enterprise&&i.data&&i.data.error&&"channel_not_found"===i.data.error){TS.maybeWarn(98765,"_getModelObByIdFromApi called for a channel but it is not found for enterprise. Channel:",t);e();TS.model.reportResultOfUnknownIdHandled(t,true);return}n(Error((i.data&&i.data.error||"unknown error")+" try #"+r+" calling channels.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)})}else if("G"===t.charAt(0))TS.api.callImmediately("groups.info",{channel:t}).then(function(n){if(n.data.group.is_mpim)e(TS.mpims.upsertMpim(n.data.group));else e(TS.groups.upsertGroup(n.data.group));TS.model.reportResultOfUnknownIdHandled(t,true)},function(e){n(Error((e.data&&e.data.error||"unknown error")+" try #"+r+" calling groups.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)});else TS.api.callImmediately("im.info",{channel:t}).then(function(n){e(TS.ims.upsertIm(n.data.im));TS.model.reportResultOfUnknownIdHandled(t,true)},function(e){n(Error((e.data&&e.data.error||"unknown error")+" try #"+r+" calling im.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)})})};var c=null;var m=function e(t){var n=TS.client.activeChannelIsHidden()?null:TS.shared.getActiveModelOb();var r=c;if(r&&r.id)p(r);if(n&&n.id){f(n,t);var i=n.id.charAt(0);if("D"===i)T(n)}c=n};var f=function e(t,n){var r=t.id;var i=r.charAt(0);var a={channel_id:r,channel_type:i,is_boot:!!n,unread_channel_ids:h(),mentioned_channel_ids:g()};if(void 0!==t.is_member&&null!==t.is_member)a.is_member=t.is_member;if(!n)a.num_unreads=t.unread_cnt;TS.clog.track("CHANNEL_SWITCHED",a)};var p=function e(t){var n=t.id;var r=n.charAt(0);var i={channel_id:n,channel_type:r};if(void 0!==t.is_member&&null!==t.is_member)i.is_member=t.is_member;TS.clog.track("CHANNEL_SWITCHED_OUT",i)};var h=function e(){return S(function(e){return e.unread_cnt>0})};var g=function e(){return S(function(e){return e.unread_highlight_cnt>0})};var S=function e(t){if(!TS.model)return[];var n=[];var r=function e(t){return t.id};if(TS.model.channels)n=n.concat(_.map(_.filter(TS.model.channels,t),r));if(TS.model.groups)n=n.concat(_.map(_.filter(TS.model.groups,t),r));if(TS.model.ims)n=n.concat(_.map(_.filter(TS.model.ims,t),r));return n};var T=function e(t){var n=t.id;var r={};var i=TS.ims.getImById(n);var a=i?TS.members.getMemberById(i.user):null;if(a&&a.is_bot){var s=a.profile.bot_id;var o=TS.bots.getBotById(s);r.app_id=o?o.app_id:"";r.bot_id=s}TS.clog.track("DM_OPEN",r)};var v=function e(){var t=true;m(t)};var b={};var y=function e(t){TS.log(1989,"Flannel: seeing if usernames might reference users we have not loaded yet: ",t.join(", "));var n=t.map(function(e){b[e]=true;return TS.members.fetchAndUpsertMembersWithQuery(e).catch(_.noop)});return Promise.all(n)};var w=function e(t){if(t)return;n=null;r=null};var k=function e(t){if(C(t)){if(TS.has_pri[O])TS.log(O,"Flannel: upserting bot "+t.id+" from query results");return TS.bots.upsertBot(t)}else if(TS.utility.members.isMember(t)){if(TS.has_pri[O])TS.log(O,"Flannel: upserting user "+t.id+" from query results");return TS.members.upsertMember(t)}};var x=function e(t){if(C(t)){if(TS.has_pri[O])TS.log(O,"Flannel: upserting and signalling bot "+t.id+" from query results");return TS.bots.upsertAndSignal(t).bot}else if(TS.utility.members.isMember(t)){if(TS.has_pri[O])TS.log(O,"Flannel: upserting and signalling user "+t.id+" from query results");return TS.members.upsertAndSignal(t).member}};var C=function e(t){var n=_.get(t,"id[0]");return"B"===n};var M=58;var I=99;var A=1701;var E=4;var F=529;var O=1989})()},4226:function(e,t){(function(){"use strict";TS.registerModule("teams",{added_sig:new signals.Signal,rename_sig:new signals.Signal,changed_sig:new signals.Signal,unlinked_sig:new signals.Signal,changed_icon_sig:new signals.Signal,onStart:function e(){if(TS.boot_data.feature_shared_channels_client||TS.boot_data.feature_lazy_grid_teams){if(!TS.boot_data.feature_lazy_teams)if(TS.isSocketManagerEnabled())TS.interop.SocketManager.socketMessageReceivedSig.add(TS.teams.ensureTeamsInDataArePresent);else TS.ms.on_msg_sig.add(TS.teams.ensureTeamsInDataArePresent);TS.teams.changed_icon_sig.add(n);TS.teams.rename_sig.add(n);TS.team.team_name_changed_sig.add(i)}},getTeamById:function e(t){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams)return;if(!_.isString(t))return null;if(TS.model.team.id===t)return TS.model.team;if(_.find(TS.model.enterprise_teams,{id:t}))return _.find(TS.model.enterprise_teams,{id:t});var n=TS.redux.teams.getTeamById(t)||TS.redux.teams.getTeamByEnterpriseId(t);if(!n)TS.console.warn("team "+t+" not in local model");return n||null},getTeamByDomain:function e(t){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams){TS.console.warn("external shared channels must be on to use this");return}if(!_.isString(t))return null;if(TS.model.team.domain===t)return TS.model.team;return TS.redux.teams.getTeamByDomain(t)},getTeamByMsg:function e(t){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams){TS.console.warn("external shared channels must be on to use this");return}if(!_.isObject(t))return null;var n=t.source_team_id;if(!n)return null;var r=TS.teams.getTeamById(n);if(r)return r;return null},getTeamNameByMember:function e(t){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams)return;if(!_.isObject(t))return null;var n=TS.teams.getTeamById(t.team_id);if(n&&n.name)return n.name;return null},getTeamNameById:function e(t){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams)return;var n=TS.teams.getTeamById(t);if(!_.isObject(n))return null;if(n&&n.name)return n.name;return null},updateTeamName:function e(t){if(!t.name)return;var n=TS.teams.getTeamById(t.source_team);if(!n)return;n=_.clone(n);n.name=t.name;TS.teams.upsertAndSignal(n)},updateTeamIcon:function e(t){if(!t.icon)return;var n=TS.teams.getTeamById(t.source_team);if(!n)return;n=_.clone(n);n.icon=t.icon;TS.teams.upsertAndSignal(n)},upsertAndSignal:function e(t){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams){TS.console.warn("external shared channels must be on to use this");return}var n=TS.teams.upsertTeam(t);if("CHANGED"===n.status){if(-1!=n.what_changed.indexOf("icon"))TS.teams.changed_icon_sig.dispatch(n.team);if(-1!=n.what_changed.indexOf("name"))TS.teams.rename_sig.dispatch(n.team);if(-1!=n.what_changed.indexOf("unlinked"))TS.teams.unlinked_sig.dispatch(n.team)}else if("ADDED"===n.status)TS.teams.added_sig.dispatch(n.team);return n},upsertTeam:function t(n){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams){TS.console.warn("external shared channels must be on to use this");return}var r=TS.teams.getTeamById(n.id);var i="NOOP";var a=[];if(r){for(var s in n)if("icon"===s){if(n[s]&&!TS.utility.areSimpleObjectsEqual(n[s],r[s])){i="CHANGED";a.push(s)}}else if(r[s]!=n[s])if("boolean"!==typeof n[s]||!n[s]!=!r[s]){i="CHANGED";a.push(s)}}else i="ADDED";e(n);TS.redux.teams.addTeam(n);return{status:i,team:n,what_changed:a}},ensureTeamsArePresent:function e(n){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams){TS.console.warn("external shared channels must be on to use this");return Promise.resolve()}if(!_.isArray(n))return Promise.reject(Error("t_ids is not an array"));var r=_.reject(n,TS.teams.getTeamById);if(!r.length)return Promise.resolve();return t(r)},ensureTeamsInDataArePresent:function e(t){if(!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_lazy_grid_teams)return Promise.resolve();var n=TS.utility.extractAllTeamIds(t);return TS.teams.ensureTeamsArePresent(n)},ensureSharedTeamsForMember:function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return Promise.resolve();if(!t)return Promise.resolve();return TS.teams.ensureTeamsArePresent(a(t))},getSharedTeamsForMember:function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return[];if(!t)return[];return _.map(a(t),TS.teams.getTeamById)},test:function e(){return{_getSharedTeamIdsForMember:a,_maybeSetCanLeaveTeam:s,_maybeSetTopChannels:o,_maybeSetDescription:l,_maybeSetDiscoverability:u,_maybeSetUserCounts:d,_maybeSetJoinedDate:c}}});var e=function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return;if(!_.get(t,"enterprise_id"))return;u(t);l(t);d(t);c(t);s(t);o(t)};var t=function e(t){if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var n={teams:t};return new Promise(function(e,t){TS.api.callImmediately("team.info",n).then(function(t){var n=[];t.data.teams.forEach(function(e){n.push(TS.teams.upsertAndSignal(e).team)});e(n)},function(e){t(Error(e.data&&e.data.error||"unknown error"))})})};var n=function e(t){if(t!=TS.model.team)r(t);i(t)};var r=function e(t){if(!_.isObject(t))return;var n=TS.utility.teams.getMembersForTeam(t);if(!n.length)return;_.forEach(n,function(e){TS.members.changed_profile_sig.dispatch(e)})};var i=function e(t){if(!_.isObject(t))return;var n=TS.shared.getActiveModelOb();if(TS.shared.isModelObShared(n))TS.channels.shared_teams_updated_sig.dispatch(n)};var a=function e(t){if(!t)return[];if(_.get(t,"enterprise_user"))return _.intersection(_.get(t,"enterprise_user.teams",[]),_.get(TS.model.user,"enterprise_user.teams",[]));if(_.get(t,"team_id")===_.get(TS.model.user,"team_id"))return[t.team_id];return[]};var s=function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return;if(!_.get(t,"enterprise_id"))return;if(TS.permissions.teams.canLeaveTeam(t)){t.can_leave=true;t.cannot_leave_reasons=[]}};var o=function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return;if(!_.get(t,"enterprise_id"))return;if(!t.top_combined_channels)t.top_combined_channels=[];if(t.your_channels||t.your_groups){var n=[];if(t.your_channels)n=n.concat(t.your_channels);if(t.your_groups)n=n.concat(t.your_groups);t.top_combined_channels=_.uniqBy(t.top_combined_channels.concat(n),"id").sort(function(e,t){var n=e.name.toLowerCase();var r=t.name.toLowerCase();if(n<r)return-1;if(n>r)return 1;return 0})}};var l=function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return;if(!_.get(t,"enterprise_id"))return;t.description=_.unescape(t.description)};var u=function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return;if(!_.get(t,"enterprise_id"))return;t.is_open=false;t.is_closed=false;t.is_unlisted=false;switch(t.discoverable){case"public":case"open":t.is_open=true;break;case"private":case"closed":t.is_closed=true;break;case"unlisted":default:t.is_unlisted=true}};var d=function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return;if(!_.get(t,"enterprise_id"))return;if(!t.user_counts)t.user_counts={};if(!t.user_counts.active_members)t.user_counts.active_members=0};var c=function e(t){if(!TS.boot_data.feature_lazy_grid_teams)return;if(!_.get(t,"enterprise_id"))return;if("undefined"===typeof t.joined_date)t.joined_date=0}})()},4228:function(e,t){(function(){"use strict";TS.registerModule("utility.teams",{isMemberExternal:function e(t){if(!TS.boot_data.feature_shared_channels_client)return false;if(!_.isObject(t))return false;if(!t.team_id)return false;if(!t._is_local&&t._is_from_org)return false;return!t._is_local&&!t._is_from_org},isMemberExternalById:function e(t){var n=TS.members.getMemberById(t);if(!n){TS.console.warn("Trying to check for external team membership by id ("+t+") but member is not present in the model.");return false}return TS.utility.teams.isMemberExternal(n)},isMemberGuest:function e(t){if(!_.isObject(t))return false;if(t.is_external||t.is_restricted)return true;return false},isMsgFromOtherTeam:function e(t){if(!_.isObject(t))return false;if(!t.source_team_id)return false;if(t.source_team_id&&TS.model.team.id!=t.source_team_id)return true;return false},getMembersForTeam:function e(t){if(!_.isObject(t))return;if(!t.id)return;var n=_.filter(TS.model.members,{team_id:t.id});return n},isMemberOnTeam:function e(t,n){if(!t||!n)return false;if(_.get(t,"team_id")===_.get(n,"id"))return true;if("web"!==TS.boot_data.app)return _.includes(_.get(t,"enterprise_user.teams"),_.get(n,"id"));return false}})})()},4229:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("members",{status_changed_sig:new signals.Signal,presence_changed_sig:new signals.Signal,ds_presence_changed_sig:new signals.Signal,user_color_changed_sig:new signals.Signal,joined_team_sig:new signals.Signal,changed_current_status_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_real_name_sig:new signals.Signal,changed_deleted_sig:new signals.Signal,changed_profile_sig:new signals.Signal,changed_tz_sig:new signals.Signal,changed_account_type_sig:new signals.Signal,changed_admin_perms_sig:new signals.Signal,changed_owner_perms_sig:new signals.Signal,changed_self_sig:new signals.Signal,lazily_added_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,non_loaded_changed_deleted_sig:new signals.Signal,member_was_upserted_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,is_in_bulk_upsert_mode:false,members_for_user_changed_sig:new signals.Signal,onStart:function e(){if(TS.client)TS.client.user_added_to_team_sig.add(TS.members.userAddedToTeam);if(TS.client)TS.client.user_removed_from_team_sig.add(TS.members.userRemovedFromTeam);if(TS.boot_data.feature_less_accessible_id_fetching)if(TS.isSocketManagerEnabled())TS.interop.SocketManager.disconnectedSig.add(Q);else TS.ms.disconnected_sig.add(Q);if(TS.boot_data.feature_less_accessible_id_fetching){TS.channels.member_joined_sig.add(function(e,t){var n=true;Z(t,n)},TS.members,-1);TS.channels.member_left_sig.add(function(e,t){ee(t)},TS.members,-1)}else{TS.channels.member_joined_sig.add(J);TS.channels.member_left_sig.add(J)}if(TS.boot_data.feature_shared_channels_client)TS.members.lazily_added_sig.add(TS.teams.ensureTeamsInDataArePresent);if(TS.client)TS.client.login_sig.addOnce(function(){TS.members.non_loaded_changed_deleted_sig.add(J);if(TS.boot_data.feature_less_accessible_id_fetching)TS.members.changed_deleted_sig.add(function(e){var t=!e.deleted;Z(e,t)},TS.members,-1);else TS.members.changed_deleted_sig.add(J)});if(TS.isSocketManagerEnabled())TS.interop.SocketManager.disconnectedSig.add(se);else TS.ms.disconnected_sig.add(se);TS.channels.switched_sig.add(ce)},maybeFetchAccessibleUserIds:function e(){if(TS.isPartiallyBooted()&&!TS._did_full_boot)return Promise.resolve();if(!TS.model.user.is_restricted)return Promise.resolve();TS.model.guest_accessible_user_ids=TS.model.guest_accessible_user_ids||[];return TS.api.call("channels.guestVisibleMembers").then(function(e){var t=e.data;var n=t.members;if(!_.isEqual(_.sortBy(n),_.sortBy(TS.model.guest_accessible_user_ids))){f.length=0;TS.model.guest_accessible_user_ids=n;TS.model.need_guest_accessible_user_ids=false;TS.members.members_for_user_changed_sig.dispatch()}V=Date.now()})},getPotentiallyUnknownMemberById:function e(n){if(!n)return null;de(n);var r=t[n];if(r&&r.is_unknown)return r;if(!TS.interop.utility.looksLikeMemberId(n)){var i=TS.members.getMemberByName(n);if(i)return i;le(n);return{id:n,name:n,is_unknown:false,is_non_existent:true}}return TS.members.getMemberById(n)||j(n)},getMemberById:function e(n){if(!_.isString(n))return null;if(n&&"@"===n.charAt(0))n=n.substring(1);if(TS.useReduxMembers())return TS.redux.members.getMemberById(n);de(n);var r=t[n];if("undefined"!==typeof r){if(r.is_unknown)return null;return r}return null},getUnknownMemberById:function e(n){if(!n)return;de(n);var r=t[n];if(r&&r.is_unknown)return r;return null},getMemberByName:function e(t){t=_.toLower(t);if(!r.hasOwnProperty(t)){var n=TS.model.members;if(Object.keys(r).length<TS.model.members.length)n.forEach(function(e){r[e._name_lc]=e.id;r["@"+e._name_lc]=e.id})}if(r.hasOwnProperty(t))return TS.members.getPotentiallyUnknownMemberById(r[t]);return null},getMemberByNameAndTeamDomain:function e(t,n){if(!TS.boot_data.feature_shared_channels_client)return TS.members.getMemberByName(t);t=_.toLower(t).replace(/^@/,"");var r=TS.model.members;var i=_.filter(r,{_name_lc:t});if(0===i.length)return null;if(1===i.length)return i[0];var a=TS.teams.getTeamByDomain(n);if(a&&a.id){var s=_.find(i,{team_id:a.id});if(s)return s}return null},getMemberByNameAndTeamId:function e(t,n){if(!TS.boot_data.feature_shared_channels_client)return TS.members.getMemberByName(t);t=_.toLower(t).replace(/^@/,"");var r=TS.model.members;var i=_.filter(r,{_name_lc:t});if(0===i.length)return null;if(1===i.length)return i[0];var a=_.find(i,{team_id:n});if(a)return a;return null},getMemberByEmail:function e(t){t=_.toLower(t);var n=TS.model.members;var r;for(var i=0;i<n.length;i+=1){r=n[i];if(!r.profile)continue;if(!r.profile.email)continue;if(_.toLower(r.profile.email)==t)return r}return null},upsertAndSignal:function e(t){var n=TS.members.upsertMember(t);return ue(n,t)},upsertMember:function n(a){var s=TS.members.getMemberById(a.id);var o="NOOP";var l=[];if(!s)s=TS.members.getUnknownMemberById(a.id);if(a.is_ultra_restricted)a.is_restricted=true;if(s){if(TS.useReduxMembers())s=_.assign({},s);if(TS.has_pri[re])TS.log(re,'updating existing member "'+a.id+'"');var u=D(s,a);o=u.status;l=u.what_changed;if(_.includes(l,"presence"))if(TS.members.is_in_bulk_upsert_mode)TS.redux.presence.addToBulkUpsertPayload(s);else TS.redux.presence.updatePresenceForMember(s);if(_.includes(l,"is_restricted")||_.includes(l,"is_ultra_restricted"))if(TS.members.is_in_bulk_upsert_mode)TS.redux.member_types.addToBulkUpdatePayload(s);else TS.redux.member_types.updateMemberTypeForMember(s);if(_.includes(l,"deleted")){var d=TS.ims.getImByMemberId(s.id);if(d)d.is_archived=s.deleted}if(_.includes(l,"current_status"))if(TS.members.is_in_bulk_upsert_mode)TS.redux.custom_status.addToBulkUpsertPayload(s);else TS.redux.custom_status.updateStatusForMember(s);if("undefined"!==typeof s.is_non_existent)delete s.is_non_existent;a=s}else if(a.id){o="ADDED";U(a);if(TS.has_pri[re])TS.log(re,'adding member "'+a.id+'" color:'+a.color+" member_color:"+a.member_color);if(a.presence)if(TS.members.is_in_bulk_upsert_mode)TS.redux.presence.addToBulkUpsertPayload(a);else TS.redux.presence.updatePresenceForMember(a);if(a.profile&&a.profile.status_emoji)if(TS.members.is_in_bulk_upsert_mode)TS.redux.custom_status.addToBulkUpsertPayload(a);else TS.redux.custom_status.updateStatusForMember(a);if(TS.members.is_in_bulk_upsert_mode)TS.redux.member_types.addToBulkUpdatePayload(a);else TS.redux.member_types.updateMemberTypeForMember(a);e+=1;t[a.id]=a;r[a._name_lc]=a.id;r["@"+a._name_lc]=a.id;if(!TS.useReduxMembers())TS.model.members.push(a)}else TS.error("bad error, no member.id");if(a.is_self&&a.deleted){TS.reload(null,"member.is_self && member.deleted");return}if(!TS.members.is_in_bulk_upsert_mode){TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches()}TS.members.member_was_upserted_sig.dispatch();if(TS.useReduxMembers()&&"NOOP"!==o){a.profile=_.assign({},a.profile);if(TS.members.is_in_bulk_upsert_mode)TS.redux.members.addToBulkUpsertPayload(a);else TS.redux.members.addMember(a)}var c={status:o,member:a,what_changed:l};if(TS.members.is_in_bulk_upsert_mode)i.push(c);return c},processExistingMemberForUpserting:function e(t,n){return D(t,n)},processNewMemberForUpserting:function e(t){U(t)},setMemberUserColor:function e(t,n){n=_.escape(n);t.member_color=n||t.color;if(n&&n!=t.color)TS.model.user_colors[t.id]=n;else delete TS.model.user_colors[t.id];TS.members.user_color_changed_sig.dispatch(t)},toggleUserPresence:function e(){var t="away"===TS.model.user.presence?"active":"away";var n={presence:t};return TS.api.call("presence.set",n)},usernameChanged:function e(t,n){delete r[n];delete r["@"+n];t._name_lc=_.toLower(t.name);r[t._name_lc]=t.id;r["@"+t._name_lc]=t.id;C(t)},getActiveMembersWithSelfAndNotSlackbot:function e(){if(!a.length)a=TS.members.fillMembersWithOptions(a,{include_self:true,include_slackbot:false,include_bots:true});return a},getActiveMembersWithSelfAndNotBots:function e(){if(!s.length)s=TS.members.fillMembersWithOptions(s,{include_self:true,include_slackbot:false,include_bots:false});return s},getActiveMembersExceptSelfAndSlackbot:function e(){if(!o.length)o=TS.members.fillMembersWithOptions(o,{include_self:false,include_slackbot:false,include_bots:true});return o},getActiveMembersExceptSelfAndBots:function e(){if(!l.length)l=TS.members.fillMembersWithOptions(l,{include_self:false,include_slackbot:false,include_bots:false});return l},getActiveMembersWithSelfAndSlackbot:function e(){if(!u.length)u=TS.members.fillMembersWithOptions(u,{include_self:true,include_slackbot:true,include_bots:true});return u},getActiveMembersWithSlackbotAndNotSelf:function e(){if(!d.length)d=TS.members.fillMembersWithOptions(d,{include_self:false,include_slackbot:true,include_bots:true});return d},getMembersWithOptions:function e(t){var n=TS.members.getMembersForUser();var r=_.filter(n,function(e){if(e.is_stranger)return false;if(t.only_admins)return e.is_admin&&!e.deleted;if(t.only_local_team&&!e._is_local)return false;if(!t.include_deleted&&e.deleted)return false;if(!t.include_slackbot&&e.is_slackbot)return false;if(!t.include_self&&e.is_self)return false;if(!t.include_bots&&e.is_bot)return false;return true});return r},fillMembersWithOptions:function e(t,n){if(!_.isArray(t))throw new TypeError("members passed to fillMembersWithOptions is not an array!");t.length=0;var r=TS.members.getMembersWithOptions(n);_.each(r,function(e){t.push(e)});return t},getMembersForUser:function e(){if(!TS.model.user.is_restricted&&!TS.boot_data.feature_shared_channels_client)return TS.model.members;if(f.length)return f;if(!TS.model.user.is_restricted){f=_.filter(TS.model.members,function(e){return true!==e.is_stranger});return f}var t={};(TS.model.guest_accessible_user_ids||[]).forEach(function(e){t[e]=true});var n=TS.isPartiallyBooted();f=Object.keys(t).map(function(e){return{id:e,user:TS.members.getMemberById(e)}}).filter(function(e){var t=e.user;if(!t&&n)return false;if(!t)return false;return!t.deleted}).map(function(e){return e.user});return f},shouldDisplayRealNames:function e(){var t=TS.model.prefs.display_real_names_override;return TS.model.team.prefs.display_real_names&&-1!=t||1==t},getPrefCompliantMemberNameById:function e(t,n,r,i){var a=i?TS.members.getMemberById(t):TS.members.getPotentiallyUnknownMemberById(t);return a?TS.members.getPrefCompliantMemberName(a,n,r):t},getPrefCompliantMemberName:function e(t,n,r){if(!t)return"";var i=function(){var e=r?"@":"";if(TS.boot_data.feature_name_tagging_client){var n=TS.members.getMemberRealName(t);if(!TS.members.shouldDisplayRealNames()&&TS.members.getMemberProfileFieldDisplayName(t))n=TS.members.getMemberProfileFieldDisplayName(t);return e+n}if(!TS.model.team)return t.name;if(TS.members.shouldDisplayRealNames()){if(t.profile&&t.profile.real_name&&t.profile.real_name.length)return t.profile.real_name;return e+t.name}return e+t.name}();return n?_.escape(i):i},getPrefCompliantMemberNameLowerCase:function e(t,n){if(!t)return"";if(!TS.model.team)return t._name_lc;if(TS.members.shouldDisplayRealNames())if(t.profile&&t.profile.real_name){if(n)return _.escape(t._real_name_lc);return t._real_name_lc}return t._name_lc},getMemberRealName:function e(t){return I(t,"real_name")},getMemberRealNameLowerCase:function e(t){return I(t,"_real_name_normalized_lc")},getMemberProfileFieldDisplayName:function e(t){return I(t,"display_name")},getMemberProfileFieldDisplayNameLowerCase:function e(t){return I(t,"_display_name_normalized_lc")},getMemberUsernameAndRealNameInCorrectOrder:function e(t){var n=v(t);var r=TS.members.getPrefCompliantMemberName(n);var i={names_in_order:[],is_username_first:true};if(!n)i.names_in_order.push(r);else if(r===n.name){i.names_in_order.push(n.name);if(n.is_self)i.names_in_order.push(TS.i18n.t("(you)","members")());else if(n.profile.real_name&&n.profile.real_name!==n.name)i.names_in_order.push(n.profile.real_name)}else{i.is_username_first=false;if(n.profile.real_name&&n.profile.real_name!==n.name)i.names_in_order.push(n.profile.real_name);var a=n.is_self?TS.i18n.t("(you)","members")():n.name;i.names_in_order.push(a)}return i},getMemberSecondaryName:function e(t){var n=v(t);if(TS.boot_data.feature_name_tagging_client){var r=TS.members.getMemberRealName(n);var i=TS.members.getMemberProfileFieldDisplayName(n);if(TS.members.shouldDisplayRealNames())return i;else if(i)return r;return""}if(TS.members.shouldDisplayRealNames())return n.name;return TS.members.getMemberRealName(n)},getMemberCurrentStatus:function e(t){var n=v(t);if(!(n&&n.profile))return{emoji:"",text:""};return{emoji:n.profile.status_emoji||"",text:n.profile.status_text||""}},getMemberCurrentStatusForDisplay:function e(t,n){var r=TS.members.getMemberCurrentStatus(t);var i="";if(r.text)i+='<span class="prevent_copy_paste" aria-label=" "></span>'+TS.format.formatCurrentStatus(r.text,void 0,n);var a=TS.format.formatCurrentStatus(r.emoji,void 0,_.assign({transform_missing_emoji:true},n));return a+i},invalidateMembersUserCanSeeArrayCaches:function e(t){if(!TS.model.user||!TS.boot_data.feature_shared_channels_client&&!TS.model.user.is_restricted)return;var n=f.length;if(!n)return;f.length=0;TS.members.invalidateActiveMembersArrayCaches();if(t)return;var r=TS.members.getMembersForUser();if(r.length!==n)TS.members.members_for_user_changed_sig.dispatch()},invalidateActiveMembersArrayCaches:function e(){a.length=0;s.length=0;o.length=0;l.length=0;u.length=0;d.length=0;c.length=0;m.length=0},canUserPostInGeneral:function e(){return TS.permissions.members.canPostInGeneral(TS.model.user)},memberSorterByActive:function e(t,n){if(t.presence!=n.presence){if("active"===t.presence)return-1;if("active"===n.presence)return 1}var r=TS.members.getPrefCompliantMemberNameLowerCase(t);var i=TS.members.getPrefCompliantMemberNameLowerCase(n);if(r<i)return-1;if(r>i)return 1;return 0},memberSorterByActiveWithBotsLast:function e(t,n){if(t.presence!=n.presence){if("active"===t.presence)return-1;if("active"===n.presence)return 1}var r=t.is_bot||t.is_slackbot;var i=n.is_bot||n.is_slackbot;if(r!==i){if(!r)return-1;if(!i)return 1}var a=TS.members.getPrefCompliantMemberNameLowerCase(t);var s=TS.members.getPrefCompliantMemberNameLowerCase(n);if(a<s)return-1;if(a>s)return 1;return 0},memberSorterByName:function e(t,n){var r=TS.members.getMemberNameForSort(t);var i=TS.members.getMemberNameForSort(n);if(r<i)return-1;if(r>i)return 1;return 0},getMemberNameForSort:function e(t){return TS.members.getPrefCompliantMemberNameLowerCase(t)},prepareMembersForLS:function e(){var t=[];var n;var r;var i;var a;for(a=0;a<TS.model.members.length;a+=1){r=TS.model.members[a];if(!r){TS.warn("prepareMembersForLS: no member at offset "+a+"??");continue}if(!r._is_local)continue;n={};t.push(n);for(i in r){if("files"===i)continue;if("activity"===i)continue;if("stars"===i)continue;if("mentions"===i)continue;if(0===i.indexOf("_"))continue;n[i]=r[i]}n.profile=H(n.profile)}return t},ensureMembersInDataArePresent:function e(t,n,r){var i=TS.utility.extractAllMemberIds(t,n,r);if("T02J3DPUE"===_.get(TS,"model.team.id")&&!_.isEmpty(i.m_ids)){var a=_.some(i.m_ids,function(e){return"U"===e[0]});if(a){var s={message:"Fetching U users on W team from source: "+n,stack:TS.console.getStackTrace()};$.post(TS.boot_data.beacon_error_url,{description:"fetch_u_on_w_team",error_json:JSON.stringify(s),team:_.get(TS,"model.team.id","none"),user:TS.boot_data.user_id,version:TS.boot_data.version_ts})}}return TS.members.ensureMembersArePresent(i.m_ids,i.c_ids,i.t_ids)},getMemberIdsNotPresent:function e(t,n,r){var i=[];var a=[];var s=[];t.forEach(function(e,t){if(!TS.members.getMemberById(e)){i.push(e);a.push(n[t]);s.push(r[t])}});return{m_ids:i,c_ids:a,t_ids:s}},fetchMemberProfileExtras:function e(t,n){n=n||["shared_channels"];var r={user:t,keys:n.join(",")};return TS.api.call("users.profile.getExtras",r).catch(function(){TS.info("Failed to fetch member profile extras")}).then(function(e){if(!e||!e.data)return{};return _.omit(e.data,"ok")})},fetchAndUpsertMembersWithQuery:function e(t){return TS.flannel.fetchRawObjectsWithQuery(t).then(function(e){e.objects=TS.shared.batchUpsertObjects(e.objects);return e})},ensureMembersArePresent:function e(t){if(!t||!t.length)return Promise.resolve();var n=_(t).uniq().filter(TS.members.getMemberById).value();var r=_.difference(t,n);var i=TS.useSocket()?g:h;var a=_(r).chunk(i).map(function(e){var t=M(e);t.catch(function(t){TS.info("ensureMembersArePresent: got "+t+" while fetching "+e.join(", "));TS.logError(t)});return t.reflect()}).value();return Promise.all(a).then(function(e){var t=e.filter(function(e){return e.isRejected()}).map(function(e){return e.reason()});if(t.length){var n=new Error("Some member fetches failed");n.rejection_reasons=t;return Promise.reject(n)}return Promise.resolve()})},ensureMembersArePresentInSharedModelObs:function e(t){t=t.filter(function(e){return!!e.is_shared});return TS.members.ensureMembersArePresentInModelObs(t)},ensureMembersArePresentInModelObs:function e(t){var n=[];var r=[];if(TS.boot_data.page_needs_enterprise&&TS.boot_data.exclude_org_members)return Promise.resolve();t.forEach(function(e){if(e.is_im){n.push(e.user);r.push(e.id)}else if(e.is_mpim){n.push.apply(n,e.members||[]);r.push.apply(r,_.fill(Array(e.members&&e.members.length||0),e.id))}else if(e.is_channel);else if(e.is_group){n.push.apply(n,e.members||[]);r.push.apply(r,_.fill(Array(e.members&&e.members.length||0),e.id))}else TS.warn("ensureMembersArePresentInModelObs found an unexpected model_ob type")});if(!n.length)return Promise.resolve();return TS.members.ensureMembersArePresent(n,r)},startBatchUpsert:function e(){if(TS.members.is_in_bulk_upsert_mode)return false;TS.members.is_in_bulk_upsert_mode=true;return true},finishBatchUpsert:function e(){if(!TS.members.is_in_bulk_upsert_mode)return false;TS.members.is_in_bulk_upsert_mode=false;TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches();var t=_.partition(i,function(e){return _.includes(e.what_changed,"is_unknown")});var n=t[0];if(n.length>0)TS.members.changed_is_unknown_sig.dispatch({batch:_.map(n,"member")});TS.members.batch_upserted_sig.dispatch(i);i=[];return true},allocateTeamListMembers:function e(t){var n;var r=[];var i=[];var a=[];var s=[];var o=[];var l=[];t.sort(function(e,t){var n=e._real_name_lc||e._name_lc;var r=t._real_name_lc||t._name_lc;if(n>r)return 1;if(r>n)return-1;return 0});for(var u=0;u<t.length;u+=1){n=t[u];if(n.deleted)if(n.is_bot)a.push(n);else i.push(n);else if(n.is_ultra_restricted)l.push(n);else if(n.is_restricted)o.push(n);else if(n.is_bot||n.is_slackbot)s.push(n);else r.push(n)}return{members:r,disabled_members:i,deleted_bots:a,bots:s,restricted_members:o,ultra_restricted_members:l}},promiseToSearchMembers:function e(t){return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e.query=e.query&&e.query.trim()||"";e.include_org=!!TS.boot_data.page_needs_enterprise&&!!e.include_org;e.org_team_ids=e.include_org&&Array.isArray(e.org_team_ids)?e.org_team_ids:[];e=E(e,A(e));if(e._is_new||e.num_remaining>0)return F(e);return Promise.resolve(e)})},isLocalTeamMember:function e(t){if(!t){TS.warn("isLocalTeamMember: No member provided?");return}if(t._is_local)return t._is_local;return t.team_id===TS.model.team.id},isNewMemberSearch:function e(t){return A(t)},readyMemberSearcher:function e(t,n){return E(t,n)},buildPromiseToSearchMembersArguments:function e(t){return O(t)},haveAllMembersForModelOb:function e(t){if(t.is_channel&&!t.is_group)return false;var n=t.members||[t.user];var r=_.map(TS.model.members,"id");return!_.difference(n,r).length},getAllKnownMemberIds:function e(){return _.map(TS.model.members,"id")},userAddedToTeam:function e(t){var n=_.merge({},TS.model.user);n.enterprise_user.teams=_.uniq(n.enterprise_user.teams.concat(t));TS.members.upsertMember(n)},userRemovedFromTeam:function e(t){var n=_.merge({},TS.model.user);n.enterprise_user.teams=n.enterprise_user.teams.filter(function(e){return e!==t});TS.members.upsertMember(n)},fetchMemberObjectsForUserProfileFields:function e(t){var n=[];if(t.is_restricted&&t.profile.guest_invited_by)n.push(t.profile.guest_invited_by);var r=TS.team.getVisibleTeamProfileFieldsForMember(t);var i=_.chain(r).filter({type:"user"}).reduce(function(e,t){return e.concat(t.value.split(/\s*,\s*/))},[]).value();n=_.chain(n).concat(i).compact().uniq().value();if(!n.length)return Promise.resolve();return TS.members.ensureMembersArePresent(n)},ditchMap:function n(){e=0;t={};r={}},maybeUpdateMembersUserCanSee:function e(t){if(TS.boot_data.feature_less_accessible_id_fetching&&t)return TS.members.ensureMembersArePresent([t]).then(function(){var e=true;return Z(TS.members.getMemberById(t),e)});return J()},getMembersForTeam:function e(t){var n=TS.members.getMembersWithOptions({include_self:true,include_bots:true});return _.filter(n,function(e){return!e.team_id||e.team_id===t})},test:function n(){var n={};Object.defineProperty(n,"_id_map_size",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(n,"_id_map",{get:function e(){return t},set:function e(n){t=n}});Object.defineProperty(n,"_name_map",{get:function e(){return r},set:function e(t){r=t}});Object.defineProperty(n,"_maybeRefetchAccessibleUserIds",{get:function e(){return Y},set:function e(t){Y=t}});Object.defineProperty(n,"_is_refetching_accessible_user_ids",{get:function e(){return z},set:function e(t){z=t}});Object.defineProperty(n,"_did_receive_multiple_calls_to_refetch_accessible_user_ids",{get:function e(){return K},set:function e(t){K=t}});Object.defineProperty(n,"_accessible_user_ids_last_fetched_ts",{get:function e(){return V},set:function e(t){V=t}});Object.defineProperty(n,"_maybeSetDeletedStatus",{get:function e(){return w},set:function e(t){w=t}});Object.defineProperty(n,"_maybeSetTeamId",{get:function e(){return k},set:function e(t){k=t}});Object.defineProperty(n,"_maybeSetLocality",{get:function e(){return x},set:function e(t){x=t}});Object.defineProperty(n,"_setImAndMpimNames",{get:function e(){return C},set:function e(t){C=t}});Object.defineProperty(n,"_setLowerCaseNamesForMember",{get:function e(){return N},set:function e(t){N=t}});Object.defineProperty(n,"_setImagesForMember",{get:function e(){return G},set:function e(t){G=t}});return n}});var e=0;var t={};var r={};var i=[];var a=[];var s=[];var o=[];var l=[];var u=[];var d=[];var c=[];var m=[];var f=[];var p=[];var h=250;var g=100;var S={};var T={};var v=function e(t){return _.isString(t)?TS.members.getPotentiallyUnknownMemberById(t):t};var b=function e(t){var n=t?t.is_unknown:false;if(!n)return false;if(t&&t.is_unknown)t.is_unknown=false;_.pull(p,t.id);if(S[t.id]){le(t.id);if(n)TS.statsd.measure("unknown_member_resolution_timing","unknown_member_resolution_timing_"+t.id)}return n};var y=function e(t){if(t.member_color)return;t.member_color=t.color;if(TS.model.user_colors[t.id])TS.members.setMemberUserColor(t,TS.model.user_colors[t.id])};var w=function e(t,n){if(!TS.boot_data.page_needs_enterprise)return;if(t.enterprise_user&&t.enterprise_user.teams&&t.enterprise_user.teams.length>0)if("web"===TS.boot_data.app){if(t.enterprise_user.teams.indexOf(TS.model.team.id)>-1)t.deleted=false}else if(n&&n.length&&n.indexOf("deleted")>=0){if(t.deleted){t.deleted=false;var r=n.indexOf("deleted");if(r>=0)n.splice(r,1)}}else t.deleted=false};var k=function e(t){if(t.team_id)return;if(t.enterprise_user&&t.id===t.enterprise_user.id){t.team_id=t.enterprise_user.enterprise_id;return}t.team_id=TS.model.team.id};var x=function e(t){if(!t){TS.warn("_maybeSetLocality: No member provided?");return}t._is_local=TS.utility.teams.isMemberOnTeam(t,TS.model.team);if(TS.boot_data.page_needs_enterprise)t._is_from_org=!t._is_local&&(t.team_id===TS.model.enterprise.id||_.get(t,"enterprise_user.enterprise_id")===TS.model.enterprise.id);if(TS.boot_data.feature_shared_channels_client){t.is_external=TS.utility.teams.isMemberExternal(t);if(TS.members.is_in_bulk_upsert_mode)TS.redux.member_types.addToBulkUpdatePayload(t);else TS.redux.member_types.updateMemberTypeForMember(t)}};var C=function e(t){TS.ims.setNameFromMember(t);TS.mpims.setNamesFromMember(t)};var M=function e(t,n){if(_.isEmpty(t))return Promise.resolve();if(!Array.isArray(t))return Promise.reject(new Error("m_ids is not an array"));t=_.uniq(t);var r="calls"===TS.boot_data.app&&!TS.model.ms_connecting;var i;var a=TS.useSocket()&&!n&&!r;if(a)i=TS.flannel.fetchRawObjectsByIds(t).then(function(e){return TS.shared.batchUpsertObjects(e)});else{var s={users:t,custom_fields_mode:"user"};i=TS.api.call("users.info",s).then(function(e){return e.data.users.map(function(e){return TS.members.upsertAndSignal(e).member})})}return i.then(function(n){if(n.length!==t.length)if(a&&TS.boot_data.feature_shared_channels_client){var r=_.difference(t,_.map(n,"id")).join(",");return e(t,true).tap(function(e){if(e.length==t.length)TS.warn("_fetchAndUpsertMembersWithIds tried to fetch members from Flannel but had to fall back to the API (everything worked out, though). Members: "+r);else TS.warn("_fetchAndUpsertMembersWithIds tried to fetch members from Flannel and from the API and still could not find them. Missing members: "+r)})}return n}).tap(function(e){var n=_.difference(t,_.map(e,"id"));if(e.length!==t.length)TS.warn("_fetchAndUpsertMembersWithIds requested "+t.length+" members but received "+e.length+". Missing members: "+n.join(", "));return e})};var I=function e(t,n){var r=v(t);if(!r)return"";if(!r.profile){if(r.is_bot&&r.name)return r.name;return""}if(r.profile[n])return r.profile[n];if(r[n])return r[n];if(r.profile[n+"_normalized"])return r.profile[n+"_normalized"];return""};var A=function e(t){return t._last_query!==t.query||t._last_include_org!==t.include_org||_.xor(t._last_org_team_ids,t.org_team_ids).length};var E=function e(t,n){t=t||{};if(t.hasOwnProperty("_searcher_p")&&n)t._searcher_p.cancel();if(!t.hasOwnProperty("_cursor_mark")||n)t._cursor_mark="";if(!t.hasOwnProperty("full_profile_filter"))t.full_profile_filter=true;if(!t.hasOwnProperty("include_bots"))t.include_bots=true;if(!t.hasOwnProperty("include_deleted"))t.include_deleted=false;if(!t.hasOwnProperty("include_self"))t.include_self=false;if(!t.hasOwnProperty("include_slackbot"))t.include_slackbot=true;if(!t.hasOwnProperty("only_local_team"))t.only_local_team=false;if(!t.hasOwnProperty("only_admins"))t.only_admins=false;if(!t.hasOwnProperty("items")||n)t.items=[];if(!t.hasOwnProperty("not_member_of"))t.not_member_of=[];if(!t.hasOwnProperty("member_of"))t.member_of=[];if(!t.hasOwnProperty("num_found")||n)t.num_found=0;if(!t.hasOwnProperty("num_remaining")||n)t.num_remaining=0;if(!t.hasOwnProperty("num_new")||n)t.num_new=0;if(!t.hasOwnProperty("max_api_results"))t.max_api_results=100;if(n){t._last_query=t.query;t._last_include_org=t.include_org;t._last_org_team_ids=t.org_team_ids}t._is_new=!!n;return t};var F=function e(t){var n=function e(){return B(t)};if(t._is_new)t._searcher_p=n();else t._searcher_p=t._searcher_p.then(n);return t._searcher_p};var O=function e(t){var n=[TS.utility.search.makeClause("is","user")];if(t._last_query){var r=t._last_query.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!t.full_profile_filter){if(TS.boot_data.feature_name_tagging_client)return TS.utility.search.makeConjunction("OR",[TS.utility.search.makeClause("real_name",e),TS.utility.search.makeClause("display_name",e)]);return TS.utility.search.makeConjunction("OR",[TS.utility.search.makeClause("name",e),TS.utility.search.makeClause("real_name",e)])}return TS.utility.search.makeClause("fuzzy_with_email",e)});n=n.concat(r)}if(t.not_member_of&&t.not_member_of.length){var i=t.not_member_of.map(function(e){return TS.utility.search.makeClause("not_member_of",e)});n.push(i.length>1?TS.utility.search.makeConjunction("OR",i):i[0])}if(t.member_of&&t.member_of.length){var a=t.member_of.map(function(e){return TS.utility.search.makeClause("member_of",e)});n.push(a.length>1?TS.utility.search.makeConjunction("OR",a):a[0])}if(t._last_include_org&&t._last_org_team_ids.length){var s=t._last_org_team_ids.map(function(e){return TS.utility.search.makeClause("belongs_to_team_id",e)});n.push(s.length>1?TS.utility.search.makeConjunction("OR",s):s[0])}var o=n.length>1?TS.utility.search.makeConjunction("AND",n):n[0];var l={query:o,count:t.max_api_results,include_bots:t.include_bots,include_deleted:t.include_deleted,ignore_guest_accounts:t.ignore_guest_accounts,only_local_team:t.only_local_team,only_admins:t.only_admins,raw_query:t.query};if(t._last_include_org)l.all_of_org=t._last_include_org;if(t._cursor_mark)l.cursor_mark=t._cursor_mark;if(t.determine_membership_for_channel)l.determine_membership_for_channel=t.determine_membership_for_channel;return l};var B=function e(t){var n=O(t);t.num_new=0;return TS.utility.search.promiseToSearch(n).then(function(e){if(!e.data.items.length)return Promise.resolve(t);if(!t.num_remaining){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}t.num_remaining-=e.data.items.length;t._cursor_mark=e.data.next_cursor_mark;var n=e.data.items.map(function(e){var n=TS.members.getMemberById(e.id);if(!n){if(t._last_include_org&&e.team_id!==TS.model.team.id){e.is_primary_owner=false;e.is_owner=false;e.is_admin=false}n=TS.members.upsertMember(e).member}return n}).filter(function(e){if(e.is_self&&!t.include_self||e.is_slackbot&&!t.include_slackbot){t.num_found-=1;return false}if(t.limit_by_model_relevancy)return TS.utility.members.isMemberRelevantToModel(e,t.limit_by_model_relevancy);return true});t.num_new=n.length;t.items.push.apply(t.items,n);return Promise.resolve(t)})};var H=function e(t){if(!_.isObject(t))return t;return _.omitBy(t,function(e,t){return 0===t.indexOf("image_")})};var D=function e(t,r){var i="NOOP";var a=[];W(t,r);Object.keys(r).forEach(function(e){if("profile"===e){var s=H(t.profile);var o=H(r.profile);if(_.isObject(o)){if(s.status_text!==o.status_text||s.status_emoji!==o.status_emoji){i="CHANGED";a.push("current_status");t.profile.status_text=o.status_text;t.profile.status_emoji=o.status_emoji}var l=Object.keys(s).filter(function(e){return"undefined"===typeof o[e]}).concat(["status_text","status_emoji"]);s=_.omit(s,l);o=_.omit(o,l);if(!_.isEqual(s,o)){var u=_.some(["real_name","full_name","display_name"],function(e){return o[e]!=s[e]});if(!_.isUndefined(s.fields)&&_.isUndefined(o.fields)){if(!TS.calls)TS.warn("So uh, yeah, we just tried to overwrite the `fields` value. Keeping what we have instead. User: "+r.id);o.fields=s.fields}t.profile=_.assign(t.profile,o);if(u)N(t);var d=s.avatar_hash!=o.avatar_hash;if(d)G(t);i="CHANGED";a.push(e)}}}else if("enterprise_user"===e)if(t[e]){for(var c in r[e])if(!_.isEqual(t[e][c],r[e][c])){t[e][c]=r[e][c];i="CHANGED";a.push(e)}}else{t[e]=r[e];i="CHANGED";a.push(e)}else if("id"===e){var m=t.id!=r.id&&t.enterprise_user&&r.enterprise_user;if(m){var f=t.enterprise_user.id==t.id;var p=r.id!=r.enterprise_user.id;if(f&&p){t.id=r.id;i="CHANGED";a.push(e)}}}else if("teams"===e){t[e]=r[e];i="CHANGED";a.push(e)}else if(t[e]!=r[e]){if("is_admin"===e)if(TS.has_pri[ae]){TS.console.warn(ae,e+"is changing from `"+t[e]+"` to `"+r[e]+"`");TS.console.trace(ae)}if(r[e]&&!TS.utility.isScalar(r[e])){t[e]=r[e];TS.warn(e+" is not scalar! it needs to be handled by upsertMember specifically to test if it has changed! "+n(r[e]))}else if("boolean"!==typeof r[e]||!r[e]!=!t[e]){a.push(e);i="CHANGED";var h=t[e];var g=r[e];t[e]=g;if("name"===e)TS.members.usernameChanged(t,h);else if("real_name"===e)t._real_name_lc=_.toLower(t.profile.real_name)}}});if(b(t))a.push("is_unknown");y(t);w(t,a);k(t);x(t);return{status:i,what_changed:a}};var P=function e(){if(!p.length){var t=TS.shared.getActiveModelOb();if(t&&T[t.id]){var n=performance.now()-T[t.id];TS.metrics.store("channel_switched_to_unknown_resolution",n);delete T[t.id]}return Promise.resolve()}var r=_.clone(p);if(TS.utility.enableFeatureForUser(10)&&r)TS.metrics.store("unknown_member_fetch_batch_size",r.length);return M(r).then(function(t){r.forEach(function(e){var n=TS.members.getUnknownMemberById(e);if(!_.find(t,{id:e})){n.is_non_existent=true;b(n)}});if(t&&r.length!==_.map(t,"id").length)TS.console.logError({member_ids_requested:r,member_ids_returned:_.map(t,"id"),is_enterprise:"enterprise"===TS.model.team.plan},"member_non_existent","unknown_member_error",false);var n=false;var i=true;if(TS.client&&TS.client.ui)TS.client.ui.rebuildAll(n,i);return e()}).catch(function(e){e.unknown_member_ids=p;e.unknown_member_ids_getting_fetched=r;TS.console.logError(e,"unknown_fetch_error","unknown_member_error",true);throw e})};var j=function e(t){if(!t)return null;if(TS.has_pri[ie])TS.log(ie,"member id "+t+" not found in members map, added unknown member to map");var n=R(t);p.push(t);if(1===p.length)_.defer(P);return n};var R=function e(t){var n={id:t,name:t};n=TS.members.upsertMember(n).member;n.is_unknown=true;n.is_non_existent=false;L(n);oe(t);TS.statsd.mark("unknown_member_resolution_timing_"+t);return n};var L=function e(t){if(!_.isObject(t.profile))return;if(!t.is_unknown&&!t.is_non_existent)return;_.forEach(["24","32","48","72","192","512","1024"],function(e){t.profile["image_"+e]=cdn_url+"/436da/img/unknown_avatar.png"})};var U=function e(t){if(!t.profile||"object"!==n(t.profile))t.profile={};if("USLACKBOT"===t.id)t.is_slackbot=true;b(t);y(t);w(t);k(t);x(t);t._first_name_lc="";t._last_name_lc="";t._real_name_lc="";t._real_name_normalized_lc="";if(TS.boot_data.feature_name_tagging_client){t._display_name_lc="";t._display_name_normalized_lc=""}N(t);G(t);t.files=[];t.activity=[];t.stars=[];t.mentions=[];q(t);C(t)};var N=function e(t){if("name"in t)t._name_lc=_.toLower(t.name);if(!_.isObject(t.profile))return;if("first_name"in t.profile)t._first_name_lc=_.toLower(t.profile.first_name);if("last_name"in t.profile)t._last_name_lc=_.toLower(t.profile.last_name);if("real_name"in t.profile){t._real_name_lc=_.toLower(t.profile.real_name);t._real_name_normalized_lc=_.toLower(TS.i18n.deburr(t._real_name_lc));t.profile.real_name_normalized=TS.i18n.deburr(t.profile.real_name)}if(TS.boot_data.feature_name_tagging_client){if("display_name"in t.profile)t._display_name_lc=_.toLower(t.profile.display_name);if("display_name_normalized"in t.profile)t._display_name_normalized_lc=_.toLower(t.profile.display_name_normalized)}};var G=function e(t){if(!_.isObject(t.profile))return;k(t);var n=TS.model.team.avatar_base_url+t.team_id+"-"+t.id+"-"+t.profile.avatar_hash+"-";_.forEach(["24","32","48","72","192","512","1024"],function(e){t.profile["image_"+e]=n+e});delete t.profile.image_original};var W=function e(t,n){if(_.get(t,"profile.always_active")!==_.get(n,"profile.always_active"))n.presence=_.get(n,"profile.always_active")?"active":"away"};var q=function e(t){if(!t.presence&&!_.isEmpty(TS.model.online_users)){var n=TS.model.online_users.indexOf(t.id);if(n>-1){t.presence="active";TS.model.online_users.splice(n,1)}}t.presence="active"===t.presence?"active":"away";if(_.get(t,"profile.always_active"))t.presence="active"};var z=false;var K=false;var V=0;var Y=function e(){if(!TS.model.user.is_restricted)return;if(z){K=true;return}z=true;var t=12e4;var n=Date.now()-V;var r;if(n<t)r=new Promise(function(e){setTimeout(e,t-n)});else r=Promise.resolve();r.then(function(){K=false;return TS.members.maybeFetchAccessibleUserIds()}).finally(function(){z=false;if(K){K=false;Y()}});return r};var J=function e(){TS.members.invalidateMembersUserCanSeeArrayCaches();return Y()};var Q=function e(){TS.model.need_guest_accessible_user_ids=true};var X=function e(t){return!TS.boot_data.feature_less_accessible_id_fetching||!t||!TS.model.user||!TS.model.user.is_restricted||!TS.model.guest_accessible_user_ids||!TS.model.guest_accessible_user_ids.length||TS.model.need_guest_accessible_user_ids||z};var Z=function e(t,n){if(X(t))return J();if(n){if(_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();TS.model.guest_accessible_user_ids.push(t.id)}else{if(!_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();_.pull(TS.model.guest_accessible_user_ids,t.id)}TS.members.invalidateMembersUserCanSeeArrayCaches();return Promise.resolve()};var ee=function e(t){if(X(t))return J();if(!_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();var n=_.concat(_.flatMap(TS.model.mpims,"members"),_.map(TS.model.ims,"user"));if(_.includes(n,t.id))return Promise.resolve();var r=te(t);var i=r[0];var a=r[1];if(a.length>ne)return J();if(a.length)return Promise.map(a,function(e){return TS.membership.ensureChannelMembershipIsKnownForUsers(e.model_ob.id,[t.id])}).then(function(){return e(t)});if(_.some(i,"membership.is_member"))return Promise.resolve();_.pull(TS.model.guest_accessible_user_ids,t.id);TS.members.invalidateMembersUserCanSeeArrayCaches();return Promise.resolve()};var te=function e(t){return _(_.concat(TS.channels.getChannelsForUser(),TS.model.groups)).map(function(e){return{model_ob:e,membership:TS.membership.getUserChannelMembershipStatus(t.id,e)}}).partition("membership.is_known").value()};var ne=10;var re=4;var ie=6655;var ae=1975;var se=function e(){if(0===_.keys(S).length)return;_.each(S,le)};var oe=function e(t){if(S[t])return;var n=TS.console.getStackTrace();S[t]=setTimeout(function(){if(TS.model.ms_connected){M([t]).then(function(){var e=TS.members.getUnknownMemberById(t);var n=e?"failure":"success";if("success"===n)le(t);TS.metrics.count("unknown_member_timeout_retry_"+n)});if(S[t])return;S[t]=setTimeout(function(){if(TS.model.ms_connected){var e=TS.members.getUnknownMemberById(t);if(e)return;TS.metrics.count("unknown_member_persistence_timeout");TS.statsd.measure("unknown_member_resolution_timing","unknown_member_resolution_timing_"+t);TS.console.logError({id:t,is_unknown:e.is_unknown,is_non_existent:e.is_non_existent,start_stack:n},"persistent unknown member","unknown_member_error",true)}},6e4)}},2e4)};var le=function e(t){clearTimeout(S[t]);delete S[t]};var ue=function e(t,n){if("ADDED"===t.status)TS.members.lazily_added_sig.dispatch(t.member);else if("CHANGED"===t.status){if(-1!=t.what_changed.indexOf("is_unknown")){TS.members.changed_is_unknown_sig.dispatch(t.member);return t}if(-1!=t.what_changed.indexOf("current_status"))TS.members.changed_current_status_sig.dispatch(t.member);if(-1!=t.what_changed.indexOf("profile"))TS.members.changed_profile_sig.dispatch(t.member);if(-1!=t.what_changed.indexOf("is_restricted")||-1!=t.what_changed.indexOf("is_ultra_restricted"))TS.members.changed_account_type_sig.dispatch(t.member);if(-1!=t.what_changed.indexOf("real_name"))TS.members.changed_real_name_sig.dispatch(t.member);if(-1!=t.what_changed.indexOf("name"))TS.members.changed_name_sig.dispatch(t.member);if(-1!=t.what_changed.indexOf("tz"))TS.members.changed_tz_sig.dispatch(t.member);if(-1!=t.what_changed.indexOf("deleted")){TS.members.changed_deleted_sig.dispatch(t.member);var r=TS.ims.getImByMemberId(t.member.id);if(r)TS.ims.calcUnreadCnts(r,true);TS.groups.calcActiveMembersForAllGroups()}if(-1!=t.what_changed.indexOf("presence"))TS.members.presence_changed_sig.dispatch(t.member);if(-1!=t.what_changed.indexOf("is_owner"))TS.members.changed_owner_perms_sig.dispatch(t.member);if(-1!=t.what_changed.indexOf("is_admin"))TS.members.changed_admin_perms_sig.dispatch(t.member);if(n.is_self){TS.members.changed_self_sig.dispatch(t.member);TS.model.makeYouRegex()}}return t};var de=function n(r){if("undefined"===typeof t[r]){var i=TS.model.members;if(e<i.length){i.forEach(function(e){t[e.id]=e});e=Object.keys(t).length;if(e!==i.length)TS.warn("member map size and member list length have diverged")}}};var ce=function e(){var t=TS.shared.getActiveModelOb();if(p.length>0&&t)T[t.id]=performance.now()}})()},4231:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("team",{team_profile_changed_sig:new signals.Signal,team_plan_changed_sig:new signals.Signal,team_email_domain_changed_sig:new signals.Signal,team_domain_changed_sig:new signals.Signal,team_name_changed_sig:new signals.Signal,onStart:function e(){if(TS.useSocket())if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(r,TS.team);else TS.ms.connected_sig.add(r,TS.team);a()},upsertAndSignal:function e(t){if(!t)return;var n=TS.team.upsertTeam(t);if("CHANGED"===n.status){if(-1!=n.what_changed.indexOf("profile"))TS.team.team_profile_changed_sig.dispatch(n.team);if(-1!=n.what_changed.indexOf("email_domain"))TS.team.team_email_domain_changed_sig.dispatch(n.team);if(-1!=n.what_changed.indexOf("domain"))TS.team.team_domain_changed_sig.dispatch(n.team)}return n},upsertTeam:function e(t,r){a();var i=TS.model.team;var l="NOOP";var u=[];if(t){if(TS.has_pri[4])TS.log(4,'updating team "'+t.id+'"');for(var d in t)if("profile"===d){if(t.profile.fields&&t.profile.fields.length){if("object"===n(t.profile.fields[0]))s(t.profile.fields);else if("string"===typeof t.profile.fields[0])o(t.profile.fields);u.push(d);l="CHANGED"}}else if("prefs"===d||"icon"===d||"cannot_leave_reasons"===d)i[d]=t[d];else if(i[d]!=t[d])if(t[d]&&!TS.utility.isScalar(t[d])){i[d]=t[d];TS.warn(d+" is not scalar! it needs to be handled by upsertTeam specifically to test if it has changed! "+n(t[d]))}else if("boolean"!==typeof t[d]||!t[d]!=!i[d]){i[d]=t[d];u.push(d);l="CHANGED"}if(TS.boot_data.feature_lazy_grid_teams){TS.model.team=_.merge({},TS.teams.getTeamById(t.id),i);if(!r){r=true;TS.teams.upsertTeam(TS.model.team,r)}}else if(TS.boot_data.page_needs_enterprise){var c=TS.enterprise.getTeamById(t.id);i=_.merge({},i,c);TS.model.team=i;if(!r){r=true;TS.enterprise.upsertEnterpriseTeam(i,r)}}}return{status:l,team:i,what_changed:u}},ensureTeamProfileFields:function e(){if(t)return t;t=TS.api.call("team.profile.get").then(function(e){TS.team.upsertTeam({profile:e.data.profile})});return t},getTeamProfileFieldById:function e(t){if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling getTeamProfileFieldById");for(var n=0;n<TS.model.team.profile.fields.length;n+=1)if(TS.model.team.profile.fields[n].id===t)return TS.model.team.profile.fields[n];return null},getVisibleTeamProfileFields:function e(){if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return!e.is_hidden})},getHiddenTeamProfileFields:function e(){if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling getHiddenTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return e.is_hidden})},getTeamCustomStatusPresets:function e(){return _.map(TS.model.team.prefs.custom_status_presets,function(e){return{text:e[1],emoji:e[0]}})},sortTeamProfileFieldsByOrdering:function e(){if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling sortTeamProfileFieldsByOrdering");else TS.model.team.profile.fields.sort(function(e,t){return e.ordering-t.ordering})},getVisibleTeamProfileFieldsForMember:function e(t,n){if(!(t&&t.profile))return[];if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFieldsForMember");return TS.model.team.profile.fields.filter(function(e){return(n||_.get(t.profile,["fields",e.id,"value"]))&&!e.is_hidden}).map(function(e){var n=_.get(t.profile,["fields",e.id,"value"]);var r=_.get(t.profile,["fields",e.id,"alt"]);var i=n&&"date"===e.type?TS.interop.datetime.convertISOtoUTCReadableDate(n):r;return $.extend(true,{value:n,alt:i},e)})},isEntireTeamLoaded:function t(){return e}});var e=false;var t;var r=function e(){t=null};var i=function e(t){if(t&&t.length)_.remove(t,function(e){return!e});return!(t&&t.length)};var a=function e(){if(_.get(window,"TS.model.team.profile.fields"))return;TS.model.team=TS.model.team||{};TS.model.team.profile=TS.model.team.profile||{};TS.model.team.profile.fields=TS.model.team.profile.fields||[]};var s=function e(t){if(i(t))return;var n=false;var r=false;var a=TS.model.team.profile.fields.reduce(function(e,t){e[t.id]=t;return e},{});t.forEach(function(e){var t=a[e.id];if(t){r=r||u(t,e);n=n||t.ordering!==e.ordering;$.extend(true,t,e)}else{TS.model.team.profile.fields.push(e);if(TS.model.members&&"options_list"===e.type)r=true}});if(n)TS.team.sortTeamProfileFieldsByOrdering();if(r)l(t)};var o=function e(t){if(i(t))return;_.remove(TS.model.team.profile.fields,function(e){return-1!==t.indexOf(e.id)});l(t)};var l=function e(t){if(!t||!t.length)return;if(!TS.model.members)return;t.forEach(function(e){TS.model.members.forEach(function(t){if(t.profile.fields&&t.profile.fields[e.id||e]){if(e.id){if("options_list"!==e.type)return;var n=-1!==e.possible_values.indexOf(t.profile.fields[e.id].value);if(n)return}var r=$.extend(true,{},t);delete r.profile.fields[e.id||e];TS.members.upsertMember(r)}})})};var u=function e(t,n){if(TS.model.members&&"options_list"===n.type)return n.possible_values.some(function(e){return-1===t.possible_values.indexOf(e)});return false}})()},4232:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("apps",{onStart:function t(){var n=true;e=TS.utility.throttleFunc(e,3e3,n)},isAppSpaceEnabled:function e(){return TS.boot_data.is_app_space_enabled},isAppmin:function e(){var t=false;var n=_.get(TS,"model.user");if(n&&!n.is_restricted){var r=_.get(TS,"model.team.prefs.who_can_manage_integrations.type",[]);for(var i=0;i<r.length;i++)if("regular"===r[i]||n["is_"+r[i]]){t=true;break}}return t},isCurrentModelViewAnApp:function e(){var t=TS.shared.getActiveModelOb();if(!t)return false;var n=TS.members.getMemberById(_.get(t,"user"));var r=_.get(n,"profile.bot_id");return!!r},resetUpApps:function t(){TS.storage.storeApps("");e()},setUp:function e(){return TS.apps.fetchApps()},ingestApp:function e(t){if(!t||!t.id)return;TS.model.apps[t.id]=t;TS.storage.storeApps({data:TS.model.apps,cache_ts:TS.model.apps_cache_ts})},ingestApps:function e(t){if("object"!==("undefined"===typeof t?"undefined":n(t))||!t)return;TS.storage.storeApps({data:t,cache_ts:TS.model.apps_cache_ts});TS.model.apps={};_.forEach(t,function(e){TS.model.apps[e.id]=e})},fetchApps:function e(){var t=TS.storage.fetchApps();if(t&&TS.model.apps_cache_ts==t.cache_ts){TS.model.did_we_load_with_app_cache=true;TS.apps.ingestApps(t.data);return Promise.resolve()}return TS.api.call("apps.list").then(function(e){TS.model.apps_cache_ts=e.data.cache_ts;TS.apps.ingestApps(e.data.apps)}).catch(_.noop)},getAppById:function e(t){if(!_.isString(t))return null;var n=TS.model.apps;if(!n){TS.warn("Trying to look up app by id ("+t+") but TS.model.apps is not present.");return null}var r=_.find(TS.model.apps,{id:t});if(r){r.is_app=true;return r}TS.warn("Trying to look up app by id ("+t+") but it is not present.");return null},startFlexPaneByAppId:function e(t,n,r){return TS.apps.promiseToGetFullAppProfile(null,t,n,r).then(function(e){TS.client.ui.app_profile.openWithApp(e,null,t,r);TS.client.flexDisplaySwitched("apps",e.id,true,true)}).catch(function(){TS.client.ui.flex.hideFlex()})},startFlexPaneByBotId:function e(t,n,r){return TS.apps.promiseToGetFullAppProfile(n,t,null,r).then(function(e){TS.client.ui.app_profile.openWithApp(e,n,t,r);TS.client.flexDisplaySwitched("apps",n,true,true)}).catch(function(){TS.client.ui.flex.hideFlex()})},promiseToGetFullAppProfile:function e(t,n,r,i){if(t&&!_.isString(t))return null;if(r&&!_.isString(r))return null;return new Promise(function(e,a,s){var o=TS.api.call("apps.profile.get",{bot:t,bot_home_team:n,app:r,show_auth_summary:!!i}).then(function(n){if(n.data.ok&&n.data.app_profile){var r=n.data.app_profile;TS.apps.ingestApp(r);e(r)}else{a(n.data.error);TS.warn("Trying to look up app by bot id ("+t+") but it failed.")}}).catch(function(e){TS.warn("Trying to look up app by bot id ("+t+") but it failed.");a(e.data)});s(function(){o.cancel()})})},sortNames:function e(t){return t.slice().sort(TS.i18n.sorter)},constructTemplateArgsForCardAndProfile:function e(t,n,r,i){if(!t)return TS.warn("Trying to build app card but it failed.");if(void 0==i)i=true;var a={name:t.name,desc:t.desc,app_icons:t.icons,app_id:t.id,bot_id:n,is_slack_integration:t.is_slack_integration,is_directory_published:t.is_directory_published,is_distributed:t.is_distributed,commands:_.toArray(t.commands)};var s=_.get(t,"bot_user.id");var o;var l=r!=TS.model.user.team_id;if(TS.boot_data.feature_shared_channels_client)a.is_foreign_app=l;if(t.app_card_color){a.color=TS.utility.hex2rgb(t.app_card_color);a.color.hex=t.app_card_color}if(t.config&&t.config.is_custom_integration){if(t.config.icons)if(t.config.icons.emoji){var u=TS.emoji.graphicReplace(_.escape(t.config.icons.emoji),{force_img:true});a.emoji_img_tag=new Handlebars.SafeString(u)}else a.bot_icons=t.config.icons;if(t.bot_user)o=t.config.real_name?t.config.real_name:t.bot_user.username;else o=t.config.username;a.name=o;a.desc=t.config.descriptive_label;a.username=t.config.username;a.custom_integration_type=t.config.custom_integration_type;a.date_created=t.config.date_created;var d='<a class="bold member charcoal_grey" data-member-id='+t.config.created_by+">"+TS.members.getPrefCompliantMemberNameById(t.config.created_by,true,true)+"</a>";a.custom_integration_creator=new Handlebars.SafeString(d)}if(_.get(t.config,"icons"))if(t.config.icons.image_72)a.avatar=t.config.icons.image_72;else a.avatar=t.config.icons.image_48;else if(t.icons)if(t.is_slack_integration)a.avatar=t.icons.image_192;else a.avatar=t.icons.image_96;if(t.screenshots)a.screenshots=t.screenshots;if(t.youtube_url){var c=TS.utility.getYoutubeIdFromURL(t.youtube_url);a.youtube_url=t.youtube_url;a.youtube_id=c}var m=t.screenshots||t.youtube_url;a.has_screenshots=m;if(_.get(t.config,"date_deleted")>0||true===_.get(t.auth,"revoked")){a.deleted=true;a.app_id=t.id}if(!t.is_slack_integration){if(TS.boot_data.feature_shared_channels_client&&l)a.disabled=false;else if(!t.auth||t.auth.revoked)a.disabled=true}else if(t.is_slack_integration)if(TS.boot_data.feature_shared_channels_client&&t.is_slack_integration&&l)a.disabled=false;else if(!t.config||"1"!==t.config.is_active||"0"!==t.config.date_deleted)a.disabled=true;if(i&&!l&&(s||!t.is_slack_integration)&&!t.is_xoxa_app)a.show_settings_section=true;if(t.installation_summary&&!t.is_xoxa_app){var f=t.installation_summary.replace(/<@([A-Z0-9]+)>/g,function(e,t){if(TS.members.getMemberById(t))return'<span class="app_card_member_link" data-member-profile-link='+t+">"+TS.members.getPrefCompliantMemberNameById(t,true,true)+"</span>";return'<span class="app_card_member_link" data-member-profile-link='+t+">A user</span>"});f=f.replace(/#([a-z0-9-]+)/g,function(e,t){var n=TS.channels.getChannelByName(t);if(n){var r=TS.templates.builders.makeChannelPrefix(n);return'<span class="app_card_channel_link internal_channel_link" data-channel-id="'+n.id+'">'+r+t+"</span>"}return t});a.installation_summary=new Handlebars.SafeString(f)}if(s){a.bot_user=t.bot_user.id;a.username=t.bot_user.username;a.bot_user_channel_count=t.bot_user.memberships_count;if(t.bot_user.memberships_count<1&&t.is_slack_integration)a.show_settings_section=false;var p=TS.shared.getActiveModelOb();if(TS.model.active_channel_id||TS.model.active_group_id){var h=TS.membership.getUserChannelMembershipStatus(t.bot_user.id,p);var g=h.is_known&&h.is_member;if(!h.is_known)TS.warn("Not sure whether bot user "+t.bot_user.id+" is a member of "+p.id+"; assuming not just to be sure");if(g)if(p.is_group&&TS.permissions.members.canKickFromGroups()||p.is_channel&&TS.permissions.members.canKickFromChannels())a.channel_kick_name=(TS.model.active_channel_id?"#":"")+p.name}if(!a.disabled)if(!TS.model.user.is_ultra_restricted)a.show_channel_invite=true;if(true===a.deleted)a.hide_link_to_app_profile=true}if(t.long_desc_formatted)a.long_description=new Handlebars.SafeString(t.long_desc_formatted);if(t.long_desc)a.long_description_raw=new Handlebars.SafeString(t.long_desc);if(t.support_url)a.support_url=t.support_url;if(t.user_can_manage)a.user_can_manage=t.user_can_manage;var S=_.isEmpty(_.get(t,"commands"));if(t.is_slack_integration&&S||TS.utility.strGetWordCount(t.long_desc)<350||!m&&S)a.hide_expand_button=true;return a},promiseToParsePermissionsForApp:function e(t){if(!t)return;var n={};var r=t.grantors;if(_.get(t,"scopes"))n.scopes=_.orderBy(t.scopes,"is_dangerous","asc");if(r){var i=_.map(r,"id");var a;return TS.members.ensureMembersArePresent(i).then(function(){a=_.map(r,function(e){return TS.members.getMemberById(e.id)});n.grantors=a;return n})}return Promise.resolve(n)}});var e=function e(){TS.apps.setUp()}})()},4233:function(e,t){(function(){"use strict";TS.registerModule("apps.permissions",{onStart:function e(){TS.channels.member_joined_sig.add(l);TS.channels.member_left_sig.add(l);TS.groups.member_joined_sig.add(l);TS.groups.member_left_sig.add(l);if(TS.client)TS.client.login_sig.addOnce(m)},app_resource_membership_changed_sig:new signals.Signal,xoxa_apps_installed_sig:new signals.Signal,areXoxaAppsInstalled:function e(){return i},ensureAppResourceMembershipIsKnown:function i(a){if(!TS.apps.permissions.areXoxaAppsInstalled())return Promise.resolve(false);if(s(a)&&0!==t){n=a;e={};t=0;r=true;return TS.api.call("apps.permissions.internal.listForResource",{channel:a}).then(function(n){t=Date.now();_.get(n,"data.apps",[]).forEach(function(t){e[t.app_user_id]=t});return true})}return Promise.resolve(false)},ensureAppAndBotResourceMembershipIsKnown:function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled())return Promise.resolve(false);return TS.apps.permissions.ensureAppResourceMembershipIsKnown(t).then(function(){return o(t)})},promiseToGenerateAppAndBotListForResource:function t(n){if(!TS.apps.permissions.areXoxaAppsInstalled())return Promise.resolve(false);return TS.apps.permissions.ensureAppAndBotResourceMembershipIsKnown(n).then(function(){return _.values(e).reduce(function(e,t){if(t.app_id){var n=TS.apps.getAppById(t.app_id);if(n){n.app_user_id=t.app_user_id;e.push(n)}}else if(t.name)e.push(t);return e},[]).sort(TS.i18n.mappedSorter("name"))})},getAppUserResourceMembershipStatus:function t(r,i){if(TS.apps.permissions.areXoxaAppsInstalled()&&i===n)return{is_known:!s(i),is_member:e.hasOwnProperty(r)};return{is_known:false,is_member:false}},addAppToResource:function e(t,n,r){var i;if(!_.isObject(t))throw new Error("Expected app user to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");var a=n.is_im||n.is_mpim;return TS.api.call("apps.permissions.internal.add",{channel:n.id,app_user:t.id}).then(function(e){return new Promise(function(s,o){if(_.get(e,"data.should_confirm")){i=_.get(e,"data.scope_info",[]);d(t,i,n,s,function(){var e=a?TS.i18n.t("{app_user} wasn’t added to this direct message.","apps")({app_user:u(t)}):TS.i18n.t("{app_user} wasn’t added to this channel.","apps")({app_user:u(t)});TS.cmd_handlers.addEphemeralFeedback(e,{input_txt:r})})}else o()})}).then(function(){return TS.api.call("apps.permissions.internal.add",{channel:n.id,app_user:t.id,did_confirm:true})}).then(function(){if(TS.apps.permissions.areXoxaAppsInstalled())TS.apps.permissions.handleAppResourceMembershipChanged(n,t)}).catch(function(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,r)})},removeAppFromResource:function e(t,n,r){if(!_.isObject(t))throw new Error("Expected app user to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");var i=_.escape(t.real_name);var a=c(n);return new Promise(function(e){TS.generic_dialog.start({dialog_class:"p-app_permission_remove_modal",title:new Handlebars.SafeString(TS.i18n.t("Remove {app_name} from {resource_name}?","apps")({app_name:i,resource_name:a})),body:new Handlebars.SafeString(TS.i18n.t("{app_name} will no longer be able to access or post to {resource_name}, unless you invite it again.","apps")({app_name:i,resource_name:a})),go_button_text:TS.i18n.t("Remove","apps")(),go_button_class:"btn_danger",onGo:function t(){e()}})}).then(function(){return TS.api.call("apps.permissions.internal.remove",{channel:n.id,app_user:t.id})}).then(function(){if(TS.apps.permissions.areXoxaAppsInstalled())TS.apps.permissions.handleAppResourceMembershipChanged(n,t)}).catch(function(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,r)})},requestPermissions:function e(t,n,r){var i=_.flatten(n.map(function(e){return e.scopes})).join(",");var a=TS.members.getMemberById(t);var s=function e(t){TS.api.call("apps.permissions.internal.addScope",{trigger_id:r,scopes:i,did_confirm:t}).catch(function(){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Hmm, something went wrong, try again?","apps")(),{slackbot_feels:"sad_surprise"})})};d(a,n,null,function(){s(true)},function(){s(false)})},addAppOrBotToActiveResource:function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled())return;var n=TS.shared.getActiveModelOb();if(t.is_app_user){TS.apps.permissions.addAppToResource(t,n);return}var r=n.is_group?"groups.invite":"channels.invite";TS.api.call(r,{channel:n.id,user:t.id})},removeAppOrBotFromActiveResource:function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled())return;var n=TS.shared.getActiveModelOb();if(t.is_app_user){TS.apps.permissions.removeAppFromResource(t,n);return}TS.shared.kickMember(n,t.id)},canAppOrBotBeAddedToResource:function e(t,n){if(!t||!TS.apps.permissions.areXoxaAppsInstalled())return false;var r=TS.members.getMemberById(t);if((n.is_im||n.is_mpim)&&!r.is_app_user)return false;var i=TS.apps.permissions.getAppUserResourceMembershipStatus(t,n.id);return i.is_known&&!i.is_member},handleAppResourceMembershipChanged:function e(t,r){if(!TS.apps.permissions.areXoxaAppsInstalled())return;n=null;TS.apps.permissions.app_resource_membership_changed_sig.dispatch(t,r)},buildAddAppsTitle:function e(t){if(TS.boot_data.feature_app_permissions_api_site)return TS.i18n.t("Add apps to {channel_name}","apps")({channel_name:c(t)});return""}});var e={};var t;var n;var r=true;var i=false;var a=12e4;var s=function e(r){if(r!==n||t<Date.now()-a)return true;return false};var o=function t(n){if(r&&"D"!==n.charAt(0))return TS.bots.fetchAndUpsertBotsWithQuery({channels:[n],filter:"bots"}).then(function(t){_.get(t,"objects",[]).forEach(function(t){var n=_.get(t,"id");e[n]={app_id:_.get(t,"profile.api_app_id"),app_user_id:_.get(t,"id"),name:_.get(t,"real_name"),app_icon:_.get(t,"profile.image_24")}});r=false;return true});return Promise.resolve(false)};var l=function e(t,r){if(TS.apps.permissions.areXoxaAppsInstalled()&&r.is_bot&&t.id===n)TS.apps.permissions.handleAppResourceMembershipChanged(t,r)};var u=function e(t){return"@"+_.escape(t.name)};var d=function e(t,n,r,i,a){var s=_.partition(n,function(e){return!e.is_dangerous});var o=s[0];var l=s[1];var u=t.real_name;var d;if(r)d=TS.i18n.t('{app_name} would like to do the following in <strong class="no_wrap">{channel_name}:</strong>',"apps")({app_name:u,channel_name:c(r)});else d=TS.i18n.t("{app_name} would like to do the following in <strong>all channels it’s a member of:</strong>","apps")({app_name:u});TS.generic_dialog.start({dialog_class:"p-app_permission_modal",go_button_text:TS.i18n.t("Authorize","apps")(),show_cancel_button:false,show_close_button:true,secondary_go_button_text:TS.i18n.t("Don’t Allow","apps")(),secondary_go_button_class:"btn_outline",show_secondary_go_button:true,force_small:true,body:TS.templates.app_permission_modal({app_name:u,app_image:t.profile.image_48,title:new Handlebars.SafeString(d),safe_scope_info:o,dangerous_scope_info:l}),onGo:i,onSecondaryGo:a,onShow:function e(){$('[data-js="app_permission_modal_scope_descriptions"]').on("click","[data-toggle-visibility]",function(){var e=$(this);var t=e.data("toggle-visibility");$("[data-toggle-visibility-id="+t+"]").toggleClass("hidden");var n=e.find("[data-toggled-text]");var r=n.data("toggled-text");var i=n.text();n.data("toggled-text",i);n.text(r)})}})};var c=function e(t){var n;if(t.is_channel)n="#";else if(t.is_im)n="@";else if(t.is_mpim)n='<i class="ts_icon ts_icon_multiparty_dm_'+TS.mpims.getMemberCount(t)+'"></i>';else n='<i class="ts_icon ts_icon_lock"></i>';return n+_.escape(TS.shared.getDisplayNameForModelObNoSigns(t))};var m=function e(){if(TS.boot_data.page_needs_enterprise)return;if(!TS.boot_data.feature_app_permissions_api_site)return;TS.bots.fetchAndUpsertBotsWithQuery({filter:"bots"}).then(function(e){i=_.some(_.get(e,"objects",[]),{is_app_user:true})}).then(function(){if(i)TS.apps.permissions.xoxa_apps_installed_sig.dispatch();else{var e=function e(t){if(t.is_app_user){i=true;TS.apps.permissions.xoxa_apps_installed_sig.dispatch();TS.members.joined_team_sig.remove(e)}};TS.members.joined_team_sig.add(e)}})}})()},4234:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("bots",{added_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_deleted_sig:new signals.Signal,changed_icons_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,is_in_bulk_upsert_mode:false,getBotById:function t(n){if(TS.useReduxMembers())return TS.redux.bots.getBotById(n);if(e[n])return e[n];var r=TS.model.bots;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i.id==n){TS.warn(n+" not in _id_map");e[n]=i;return i}}return null},getBotByMsg:function e(t){var n=TS.members.getMemberById(t.user);var r=t.bot_id||_.get(n,"profile.bot_id");if(!r)return null;var i=TS.bots.getBotById(r);if(i){i.id=r;return i}if(t.bot_profile){t.bot_profile.id=r;return t.bot_profile}return null},getBotByName:function e(t){var n=TS.model.bots;var r;if("undefined"===typeof t)return null;for(var i=0;i<n.length;i+=1){r=n[i];if(r.name.toLowerCase()==t.toLowerCase())return r}return null},getBotInfoByMsg:function e(t){var n=TS.members.getMemberById(t.user);var r=TS.bots.getBotByMsg(t);var i=_.get(r,"id")||_.get(n,"profile.bot_id");var a=_.get(r,"team_id");if(i&&!r)TS.warn("getBotInfoByMsg: failed to find a bot with ID '"+i+"'");var s=_.get(n,"profile.api_app_id")||_.get(r,"app_id");if(!s&&!i){TS.warn("Unable to get bot info for message",t);return null}if(TS.boot_data.feature_shared_channels_client&&a)return{bot_id:i,app_id:s,team_id:a};return{bot_id:i,app_id:s}},getBotNameById:function e(t){var n=TS.bots.getBotById(t);if(n&&n.name)return n.name},getBotNameByBotLink:function e(t){t=t.split("|");if(t.length>1){var n=t[1].slice(0,-1);if(n)return n}return null},upsertAndSignal:function e(t){var n=TS.bots.upsertBot(t);return r(n)},upsertBot:function t(r){var a=TS.bots.getBotById(r.id);var s="NOOP";var o=[];if(a){if(TS.has_pri[i])TS.log(i,'updating existing bot "'+r.id+'"');if(TS.useReduxMembers())a=_.assign({},a);for(var l in r)if("icons"===l){if(r[l]&&!TS.utility.areSimpleObjectsEqual(r[l],a[l],"bot:"+r.id+" "+r.name)){a.icons=r.icons;s="CHANGED";o.push(l)}}else if(a[l]!=r[l])if(r[l]&&!TS.utility.isScalar(r[l])){a[l]=r[l];TS.warn(l+" is not scalar! it needs to be handled by upsertBot specifically to test if it has changed! "+n(r[l]))}else if("boolean"!==typeof r[l]||!r[l]!=!a[l]){o.push(l);a[l]=r[l];s="CHANGED"}r=a}else{s="ADDED";if(TS.has_pri[i])TS.log(i,'adding bot "'+r.id+'"');TS.bots.processNewBotForUpserting(r);e[r.id]=r;if(!TS.useReduxMembers())TS.model.bots.push(r)}if("ADDED"===s||"CHANGED"===s)if(TS.useReduxMembers())if(TS.bots.is_in_bulk_upsert_mode)TS.redux.bots.addToBulkUpsertPayload(r);else TS.redux.bots.addBot(r);return{status:s,bot:r,what_changed:o}},processNewBotForUpserting:function e(){},configureUrl:function e(n){if(!n.is_bot)return;var r;var i=t(n);if(i)r="/apps/"+i;else if(n.profile.bot_id)r="/services/"+n.profile.bot_id;return r},startBatchUpsert:function e(){if(TS.bots.is_in_bulk_upsert_mode)return false;TS.bots.is_in_bulk_upsert_mode=true;return true},finishBatchUpsert:function e(){if(!TS.bots.is_in_bulk_upsert_mode)return false;TS.bots.is_in_bulk_upsert_mode=false;TS.bots.batch_upserted_sig.dispatch();return true},ensureBotsInDataArePresent:function e(t){var n=TS.utility.extractAllBotIds(t);return TS.bots.ensureBotsArePresent(n)},ensureBotsArePresent:function e(t){var n=["B01","BSLACKBOT"];var r=_(t).difference(n).reject(TS.bots.getBotById).value();if(!r.length)return Promise.resolve();var i;if(TS.useSocket())i=TS.flannel.fetchRawObjectsByIds(r).then(function(e){return TS.shared.batchUpsertObjects(e)});else i=TS.api.call("bots.info",{bots:r.join(",")}).then(function(e){return e.data.bots.map(function(e){return TS.bots.upsertAndSignal(e).bot})});return i.tap(function(e){if(e.length!==r.length)TS.warn("TS.bots.ensureBotsArePresent requested "+r.length+" bots but received "+e.length+". Missing bots: "+_.difference(r,_.map(e,"id")).join(","))})},fetchAndUpsertBotsWithQuery:function e(t){return TS.flannel.fetchRawObjectsWithQuery(t).then(function(e){e.objects=TS.shared.batchUpsertObjects(e.objects);return e})}});var e={};var t=function e(t){var n=t.profile.api_app_id;if(!n&&TS.model.apps&&TS.model.apps.length){var r=_.find(TS.model.apps,function(e){return e.name.toLowerCase()==t.name.toLowerCase()});if(r)n=r.id}return n};var r=function e(t){if("CHANGED"===t.status){if(-1!=t.what_changed.indexOf("icons"))TS.bots.changed_icons_sig.dispatch(t.bot);if(-1!=t.what_changed.indexOf("name"))TS.bots.changed_name_sig.dispatch(t.bot);if(-1!=t.what_changed.indexOf("deleted"))TS.bots.changed_deleted_sig.dispatch(t.bot)}return t};var i=5})()},4235:function(e,t){(function(){"use strict";TS.registerModule("members.view",{team_filter_changed_sig:new signals.Signal,filter_timer:null,onStart:function e(){E=TS.web&&TS.web.admin;var t=500;l=TS.utility.debounceWithPromise(w,t);u=TS.utility.debounceWithPromise(w,t);d=TS.utility.debounceWithPromise(w,t)},switchTabs:function e(t){if(E&&"invites"===TS.web.admin.view)$("#"+t+"_invites_tab").trigger("click");else if(TS.client)$("#"+t+"_members_tab").find("a").trigger("click");else $("#"+t+"_members_tab").trigger("click")},bindTeamFilter:function t(n,r,i){i=i||{};var a=$(n);var s=a.find("input.member_filter");var o=a.find(".icon_close");f(r,i);e=null;if(i.full_profile_filter&&!i.is_long_list_view)s.on("focus",function(){TS.team.ensureTeamProfileFields()});s.bind("keyup update-team-filter",function(){var t=s.val();if(TS.members.view.filter_timer)window.clearTimeout(TS.members.view.filter_timer);var a=function a(){if(t.trim().toLocaleLowerCase()!==e)TS.members.view.filterTeam(t,n,r,i).then(function(){if(TS.view)TS.view.rebuildUserGroupList()});o.toggleClass("hidden",!t.trim())};if(i.is_long_list_view)a();else TS.members.view.filter_timer=window.setTimeout(a,TS.members.getMembersForUser().length>500?250:50)});o.bind("click",function(){TS.members.view.clearFilter(n,r);if(TS.view)TS.view.rebuildUserGroupList();e=null;setTimeout(function(){s.focus()},0)})},filterTeam:function e(t,n,r,i){var a=p(r);if(_.get(i,"full_profile_filter")||_.get(a,"full_profile_filter"))return TS.team.ensureTeamProfileFields().then(function(){if(m(a))return T(t,n,r,a);k(t,n,r,i);return Promise.resolve()});k(t,n,r);return Promise.resolve()},getTeamFilter:function t(){return e},selectMatch:function e(t){var n=$(t);var r=n.data("list-items-id");var i=$(r);var a=i.find(".member_item");var s=a.filter(".active");if(1==s.length){var o=s.first();var l=o.data("member-id");if(l){TS.ims.startImByMemberId(l);TS.menu.end()}}},clearFilter:function n(r,i){var a=p(i);var s=$(r);var o=s.find("input.member_filter");var l=s.find(".icon_close");var u=s.data("list-items-id");var d=$(u);var c=d.find(".member_item");e="";TS.storage.storeFilterState(e);if(TS.members.view.filter_timer){window.clearTimeout(TS.members.view.filter_timer);TS.members.view.filter_timer=null}o.val("");l.addClass("hidden");if(m(a)){S(i);TS.members.view.filterTeam(e,r,i,a)}else{$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").removeClass("hidden");d.find(".no_results").addClass("hidden");c.addClass("active");if(t[i]){t[i].detachEvents();delete t[i]}d.find(".member_item.clone").remove();d.find(".filter_header").remove();TS.members.view.team_filter_changed_sig.dispatch("",TS.members.getMembersForUser().length);if(TS.client&&i){var _=$(i);_.trigger("resize-immediate");TS.ui.utility.updateClosestMonkeyScroller(_)}}},onTeamDirectoryItemClick:function e(t){if($(t.target).closest("a").length)return;var n=$(this);var r=n.data("member-id");var i=TS.members.getMemberById(r);if(!i)return;if(TS.client)TS.client.ui.previewMember(r)},findMatchesInMemberList:function e(t,n,r){return F(t,n,r)},getHeaderLabelForMatchKey:function e(t){return x(t)}});var e="";var t={};var n={};var r={};var i={};var a={members:{},restricted:{},deleted:{}};var s=100;var o=TS.client?92:116;var l;var u;var d;var c=function e(){if("list"===_.get(TS,"web.admin.view")&&TS.boot_data.feature_api_admin_page&&TS.boot_data.page_needs_enterprise)return false;return TS.boot_data.page_needs_enterprise};var m=function e(t){if(TS.boot_data.page_needs_enterprise&&t&&t.is_long_list_view)return true;if("list"===_.get(TS,"web.admin.view")&&TS.boot_data.feature_api_admin_page&&(TS.boot_data.page_needs_enterprise||TS.boot_data.feature_api_admin_page_not_ent))return true};var f=function e(t,n){r[t]=n};var p=function e(t){var n=r[t];if(!n){TS.error("Missing arguments for a bound filter");return}if(_.isFunction(n))n=n()||{};n.include_org=c();return n};var h=function e(t){var n=$(t).find(".ts_icon_search");if(n.next().is(t+"_spinner"))return;var r=TS.templates.loading_indicator({id:t.substring(1)+"_spinner"});n.after(r);n.addClass("hidden")};var g=function e(t){$(t).find(".ts_icon_search").removeClass("hidden");$(t+"_spinner").remove()};var S=function e(t){if(a.filter_p)a.filter_p.cancel();if(a.filtered_items)a.filtered_items={};a.filter_last_query=null;a.filter_last_include_org=null;a.members.filter_cursor_mark="";a.members.filter_num_remaining=0;a.members.filter_num_found=0;a.members.filter_scroll_mark=0;a.restricted.filter_cursor_mark="";a.restricted.filter_num_remaining=0;a.restricted.filter_num_found=0;a.restricted.filter_scroll_mark=0;a.deleted.filter_cursor_mark="";a.deleted.filter_num_remaining=0;a.deleted.filter_num_found=0;a.deleted.filter_scroll_mark=0;if(TS.client)$(t).off("scroll.filter").scrollTop(0);else if(TS.web)$(window).off("scroll.filter").scrollTop(0)};var T=function t(n,r,i,s){var o=n.trim();e=o.toLocaleLowerCase();TS.storage.storeFilterState(e);var l=a.filter_last_query!==e||a.filter_last_include_org!==s.include_org||a.filter_last_sort!==s.sort||a.filter_last_sort_dir!==s.sort_dir;if(l){S(i);a.filter_last_query=e;a.filter_last_include_org=s.include_org;if(s.sort)a.filter_last_sort=s.sort;if(s.sort_dir)a.filter_last_sort_dir=s.sort_dir}h(r);var u=function t(){return Promise.resolve().then(function(){return v(a,l,e,s)}).then(function(t){g(r);return b(t,a,l,e,o,r,i,s)}).finally(function(){TS.utility.rAF(function(){if(TS.client)TS.ui.utility.updateClosestMonkeyScroller($(i))})})};if(l)a.filter_p=u();else a.filter_p=a.filter_p.then(u);return a.filter_p};var v=function e(t,n,r,i){var a=n||"active_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;var s=n||"restricted_members"===TS.model.ui_state.tab_name&&t.restricted.filter_num_remaining;var o=n||"disabled_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;if(!a&&!s&&!o)return Promise.resolve(t.filtered_items);var c=_.assign({},i,{restricted:false});t.members.filter_p=a?l(t.members,r,c):Promise.resolve([]);var m=_.assign({},i,{restricted:true});t.restricted.filter_p=s?u(t.restricted,r,m):Promise.resolve([]);var f=_.assign({},i,{include_deleted:2,include_restricted_and_full_members:true});t.deleted.filter_p=o?d(t.deleted,r,f):Promise.resolve([]);return Promise.join(t.members.filter_p,t.restricted.filter_p,t.deleted.filter_p,function(e,r,a){var s=(i.sort?A:TS.members.allocateTeamListMembers)(e.concat(r,a));s.members=_.uniqBy(s.members,function(e){return e.id});s.disabled_members=_.uniqBy(s.disabled_members,function(e){return e.id});s.restricted_members=_.uniqBy(s.restricted_members,function(e){return e.id});s.ultra_restricted_members=_.uniqBy(s.ultra_restricted_members,function(e){return e.id});if(n)t.filtered_items=s;else{t.filtered_items.members.push.apply(t.filtered_items.members,s.members);t.filtered_items.disabled_members.push.apply(t.filtered_items.disabled_members,s.disabled_members);t.filtered_items.deleted_bots.push.apply(t.filtered_items.deleted_bots,s.deleted_bots);t.filtered_items.bots.push.apply(t.filtered_items.bots,s.bots);t.filtered_items.restricted_members.push.apply(t.filtered_items.restricted_members,s.restricted_members);t.filtered_items.ultra_restricted_members.push.apply(t.filtered_items.ultra_restricted_members,s.ultra_restricted_members)}return Promise.resolve(t.filtered_items)})};var b=function e(t,n,r,l,u,d,c,m){if(!t)return;if(_.get(TS,"web.admin"))return TS.web.admin.setLongListAdminListItems({items:t,no_dividers:!!l,query:l,new_query:!!r,num_found:{members:a.members.filter_num_found||0,restricted:a.restricted.filter_num_found||0,disabled:a.deleted.filter_num_found||0},remaining:{members:a.members.filter_num_remaining||0,restricted:a.restricted.filter_num_remaining||0,disabled:a.deleted.filter_num_remaining||0}},function(){T(l,d,c,m)});if(TS.client)i=TS.view.buildLongListTeamListItems(t,!!l);else if(TS.web.members)i=TS.web.members.buildLongListTeamListItems(t,!!l);var f=false;if("disabled_members"===TS.model.ui_state.tab_name&&0===(a.deleted.filter_num_found||0))f=true;if("restricted_members"===TS.model.ui_state.tab_name&&0===(a.restricted.filter_num_found||0))f=true;var p=TS.model.user_groups.filter(function(e){return!e.date_delete});if("user_groups"===TS.model.ui_state.tab_name&&0===p.length)f=true;if(f){TS.model.ui_state.tab_name="active_members";TS.storage.storeUIState(TS.model.ui_state);$("#active_members_tab").trigger("click")}var h=$("#active_members_list");if(h.length){h.longListView("setItems",i.active_members_list_items);if(r)h.longListView("scrollToTop")}var g=$("#restricted_members_list");if(g.length){g.longListView("setItems",i.restricted_members_list_items);if(r)g.longListView("scrollToTop")}var S=$("#deleted_members_list");if(S.length){S.longListView("setItems",i.deleted_members_list_items);if(r)S.longListView("scrollToTop")}var v=t.members.concat(t.bots);var b=t.restricted_members.concat(t.ultra_restricted_members);var y=t.disabled_members.concat(t.deleted_bots);var w=[{name:"active",label:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("full members","members_view")():TS.i18n.t("full team members","members_view")(),matches:v},{name:"restricted",label:TS.i18n.t("multi-channel guests","members_view")(),matches:b},{name:"disabled",label:TS.i18n.t("deactivated accounts","members_view")(),matches:y}];w.forEach(function(e){var t=$("#"+e.name+"_no_results");function n(){var n={query:u,tab:e,active_matches:v,show_active_matches:"active"!==e.name&&v.length>0,restricted_matches:b,show_restricted_matches:"restricted"!==e.name&&b.length>0,disabled_matches:y,show_disabled_matches:"disabled"!==e.name&&y.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").one("click",function(){TS.members.view.clearFilter(d,c)})}if(e.matches.length>0||!l)t.addClass("hidden").empty();else n()});if(r){if("#team_list_scroller"===c)if(TS.client){var k=$(c);var x=k.find("#team_list_members_wrapper");k.on("scroll.filter",function(){var e=k.scrollTop()+k.height()+o;var t;if("active_members"===TS.model.ui_state.tab_name){if(e<=n.members.filter_scroll_mark)return;t=x.height();if(e>t&&n.members.filter_p&&n.members.filter_p.isResolved()){T(l,d,c,m);n.members.filter_scroll_mark=e}}if("restricted_members"===TS.model.ui_state.tab_name){if(e<=n.restricted.filter_scroll_mark)return;t=x.height();if(e>t&&n.restricted.filter_p&&n.restricted.filter_p.isResolved()){T(l,d,c,m);n.restricted.filter_scroll_mark=e}}})}else if(TS.web)$(window).off("scroll.filter").on("scroll.filter",_.throttle(function(){var e=0;var t=0;var r=0;var u=null;if("active_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#active_members_list > .list_items").css("height"));t=_.reject(i.active_members_list_items,{is_divider:true}).length;r=n.members.filter_num_remaining;u=n.members.filter_p}if("restricted_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#restricted_members_list > .list_items").css("height"));t=_.reject(i.restricted_members_list_items,{is_divider:true}).length;r=n.restricted.filter_num_remaining;u=n.restricted.filter_p}if("disabled_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#disabled_members_list > .list_items").css("height"));t=_.reject(i.deleted_members_list_items,{is_divider:true}).length;r=n.deleted.filter_num_remaining;u=a.deleted.filter_p}var f=.9*Math.min(t,s);e=_.isNaN(e)?0:e;e-=f*o;if(e&&r&&$(this).scrollTop()>e&&u&&u.isResolved())T(l,d,c,m)},50,{leading:true}));var C=(n.members.filter_num_found||0)+(n.restricted.filter_num_found||0)+(n.deleted.filter_num_found||0);TS.members.view.team_filter_changed_sig.dispatch(u,C)}};var y=function e(t,n,r){var i=[];if(n)i=n.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!r.full_profile_filter){var t=TS.utility.search.makeClause("real_name",e);if(TS.boot_data.feature_name_tagging_client){var n=TS.utility.search.makeClause("display_name",e);var i=TS.utility.search.makeConjunction("OR",[t,n]);return i}var a=TS.utility.search.makeClause("name",e);var s=TS.utility.search.makeConjunction("OR",[a,t]);return s}return TS.utility.search.makeClause("fuzzy_with_email",e)});i.push(TS.utility.search.makeClause("is","user"));if(r.restricted){var a=TS.utility.search.makeClause("level","restricted");var o=TS.utility.search.makeClause("level","ultra_restricted");i.push(TS.utility.search.makeConjunction("OR",[a,o]))}var l=i.length>1?TS.utility.search.makeConjunction("AND",i):i[0];var u={query:l,count:s,include_bots:r.include_bots,exclude_slackbot:r.exclude_slackbot,include_deleted:r.include_deleted};if(r.sort)u.sort=r.sort;if(r.sort_dir)u.sort_dir=r.sort_dir;if(r.include_org)u.all_of_org=r.include_org;if(t.filter_cursor_mark)u.cursor_mark=t.filter_cursor_mark;if(r.endpoint)u.endpoint=r.endpoint;if(TS.web)u.solr=true;return u};var w=function e(t,n,r){var i=y(t,n,r);i.raw_query=n;return TS.utility.search.promiseToSearch(i).then(function(i){if(!t.filter_num_remaining){t.filter_num_remaining=i.data.num_found;t.filter_num_found=i.data.num_found}t.filter_num_remaining-=i.data.items.length;t.filter_cursor_mark=i.data.next_cursor_mark;if(!i.data.items.length)return Promise.resolve([]);var a=i.data.items.map(function(e){var t=TS.members.getMemberById(e.id);if(!t||!_.isEqual(t,e)){if(r.include_org&&e.team_id!==TS.model.team.id){e.is_primary_owner=false;e.is_owner=false;e.is_admin=false}t=TS.members.upsertMember(e).member}return t});if(!r.restricted&&!r.include_restricted_and_full_members)a=a.filter(function(e){return!e.is_restricted});if(a.length)return Promise.resolve(a);if(t.filter_num_remaining)return e(t,n,r);return Promise.resolve([])})};var k=function n(r,i,a,s){var o=$(i);var l=r.trim();e=l.toLocaleLowerCase();var u=o.data("list-items-id");var d=$(u);var c=d.find(".member_item:not(.clone)");var _=c.filter(".active");var m=d.find(".member_item.clone");var f=d.find(".filter_header");var p=!TS.web&&"#team_filter"===i;var h={};var g;var S;var T;TS.storage.storeFilterState(e);var v=false;var b;if(E&&"#team_filter"===i)b=d.find(".tab_pane.selected");if(!b&&!TS.web&&"#team_filter"===i)b=$("#team_list_members");if(b&&b.length)b.addClass("hidden");if(v){g=c.parent();S=document.activeElement?$(document.activeElement):null;c.detach()}if(t[a]){t[a].detachEvents();delete t[a]}m.remove();f.remove();_.removeClass("active");d.find(".no_results").addClass("hidden");if(v){g.append(c);if(S)S.focus()}var y;if(E&&"invites"===TS.web.admin.view){var w=[];var k=[];var x=[];$.each(c,function(e,t){var n;t=$(t);n=t.data("invite-id");h[n]=t});k=F(TS.web.admin.pending_invites,e).name||[];x=F(TS.web.admin.accepted_invites,e).name||[];w=k.concat(x);if(w.length>0){$.each(w,function(e,t){if(t&&t.member&&t.member.id&&h[t.member.id])h[t.member.id].addClass("active")});if(a)$(a).trigger("resize")}y=[{name:"pending",label:TS.i18n.t("pending invitations","members_view")(),matches:k},{name:"accepted",label:TS.i18n.t("accepted invitations","members_view")(),matches:x}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");if(e.matches.length>0){t.addClass("hidden").empty();return}var n={query:l,tab:e,pending_matches:k,show_pending_matches:"pending"!==e.name&&k.length>0,accepted_matches:x,show_accepted_matches:"accepted"!==e.name&&x.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})});T=w}else{var C;var M=[];var A=[];var O=[];if(E)if(!r.length)C=TS.web.admin.getMembersForUser();else C=TS.members.getMembersForUser();else C=TS.members.getMembersForUser();$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").toggleClass("hidden",!!e);$.each(c,function(e,t){var n;t=$(t);n=t.data("member-id");h[n]=t});w=F(C,e,s.full_profile_filter);var B=Object.keys(w);if(B.length>0){I(w,B,h,O,A,M,p?a:"");if(a){var H=$(a);H.trigger("resize");TS.ui.utility.updateClosestMonkeyScroller(H)}}else if("#file_member_filter"===i){d.find(".query").text(l);d.find(".no_results").removeClass("hidden")}if("#team_filter"===i){y=[{name:"active",label:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("full members","members_view")():TS.i18n.t("full team members","members_view")(),matches:M},{name:"restricted",label:TS.i18n.t("multi-channel guests","members_view")(),matches:A},{name:"disabled",label:TS.i18n.t("deactivated accounts","members_view")(),matches:O}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");function n(){var n={query:l,tab:e,active_matches:M,show_active_matches:"active"!==e.name&&M.length>0,restricted_matches:A,show_restricted_matches:"restricted"!==e.name&&A.length>0,disabled_matches:O,show_disabled_matches:TS.web&&"disabled"!==e.name&&O.length>0};var r=TS.templates.team_list_no_results(n);t.removeClass("hidden").html(r);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})}if(e.matches.length>0){t.addClass("hidden").empty();return}n()})}T=M.concat(A,O)}if(b&&b.length)b.removeClass("hidden");TS.ui.utility.updateClosestMonkeyScroller($(a));TS.members.view.team_filter_changed_sig.dispatch(l,T.length)};var x=function e(t){return n[t]||t};var C=function e(t,n){var r=document.createElement("div");var i=document.createElement("strong");r.classList.add("filter_header");i.appendChild(document.createTextNode(t));if(n.length)i.appendChild(document.createTextNode(": "));r.appendChild(i);n.forEach(function(e,t){r.appendChild(e);if(t<n.length-1)r.appendChild(document.createTextNode(", "))});return r};var M=function e(t,n){var r=document.createElement("span");var i=document.createElement("strong");var a=t.split(n);i.appendChild(document.createTextNode(n));r.appendChild(document.createTextNode(a.shift()));r.appendChild(i);r.appendChild(document.createTextNode(a.join(n)));return r};var I=function e(r,i,a,s,o,l,u){var d=$(u);var c=document.createDocumentFragment();var _=document.createDocumentFragment();var m=document.createDocumentFragment();var f;var p;var h;var g=E&&TS.web.admin.isSubsetCase();i.sort(function(e,t){return TS.i18n.sorter(n[e],n[t])}).forEach(function(e){var t=document.createDocumentFragment();var n=document.createDocumentFragment();var i=document.createDocumentFragment();var u=[];var d=[];var S=[];var T={};var v={};var b={};if(g)if(!h){h=$("#active_members > div:first-of-type");p=$("#restricted_members > div:first-of-type");f=$("#disabled_members > div:first-of-type")}r[e].forEach(function(r){var c=r.member;var _;var m=false;if(c&&c.id){_=a[c.id];if(!_&&g){_=$(TS.web.admin.buildMemberHTML(c,false,false));m=true}if(_)if("name"===e&&!m)_.addClass("active");else if(c.deleted){if(!f)f=_.parent();if(r.value&&!T[r.value])T[r.value]=u.push(M(r.value,r.match));t.appendChild(_.clone().addClass("active clone").get(0))}else if(c.is_restricted){if(!p)p=_.parent();if(r.value&&!v[r.value])v[r.value]=d.push(M(r.value,r.match));n.appendChild(_.clone().addClass("active clone").get(0))}else{if(!h)h=_.parent();if(r.value&&!b[r.value])b[r.value]=S.push(M(r.value,r.match));i.appendChild(_.clone().addClass("active clone").get(0))}if(c.deleted)s.push(c);else if(c.is_restricted)o.push(c);else l.push(c)}});if(t.childNodes&&t.childNodes.length){c.appendChild(C(x(e),u));c.appendChild(t)}if(n.childNodes&&n.childNodes.length){_.appendChild(C(x(e),d));_.appendChild(n)}if(i.childNodes&&i.childNodes.length){m.appendChild(C(x(e),S));m.appendChild(i)}t=null;n=null;i=null;u=null;d=null;S=null;T=null;v=null;b=null});if(f)f.append(c);if(p)p.append(_);if(h)h.append(m);if(d.length){var S=d.find(".member_item.clone");t[u]=S.find(".lazy").lazyload({container:d,ignore_when_hidden_element:d,all_images_same_size:true});S.one("remove",function(){if(t[u]){t[u].detachEvents();delete t[u]}})}if(g){if(TS.web.admin.lazyload&&TS.web.admin.lazyload.detachEvents){TS.web.admin.lazyload.detachEvents();TS.web.admin.lazyload=null}if(!TS.web.admin.lazyload)TS.web.admin.lazyload=$("#admin_list").find(".lazy").lazyload()}c=null;_=null;m=null;f=null;p=null;h=null};var A=function e(t){return _.reduce(t,function(e,t){if(t.deleted)if(t.is_bot)e.deleted_bots.push(t);else e.disabled_members.push(t);else if(t.is_ultra_restricted)e.ultra_restricted_members.push(t);else if(t.is_restricted)e.restricted_members.push(t);else if(t.is_bot||t.is_slackbot)e.bots.push(t);else e.members.push(t);return e},{members:[],disabled_members:[],deleted_bots:[],bots:[],restricted_members:[],ultra_restricted_members:[]})};var E;var F=function e(t,r,i){var a=new RegExp("^"+TS.utility.regexpEscape(r),"i");var s=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(r),"i");var o={};var l=i&&r?TS.team.getVisibleTeamProfileFields():[];n={title:"What I Do",name:"Name"};t.forEach(function(e){var t;if(TS.boot_data.feature_name_tagging_client)t=e._real_name_lc&&(e._real_name_lc.match(a)||e._real_name_lc.match(s))||e.email&&(e.email.match(a)||e.email.match(s))||e.profile&&e.profile.email&&(e.profile.email.match(a)||e.profile.email.match(s))||e.profile&&e.profile.real_name_normalized&&(e.profile.real_name_normalized.match(a)||e.profile.real_name_normalized.match(s))||e.profile&&e.profile.real_name&&(e.profile.real_name.match(a)||e.profile.real_name.match(s))||e.profile&&e.profile.display_name_normalized&&(e.profile.display_name_normalized.match(a)||e.profile.display_name_normalized.match(s))||e.profile&&e.profile.preferred_name&&(e.profile.preferred_name.match(a)||e.profile.preferred_name.match(s));else t=e.name&&(e.name.match(a)||e.name.match(s))||e.first_name&&(e.first_name.match(a)||e.first_name.match(s))||e.last_name&&(e.last_name.match(a)||e.last_name.match(s))||e._real_name_lc&&(e._real_name_lc.match(a)||e._real_name_lc.match(s))||e.email&&(e.email.match(a)||e.email.match(s))||e.profile&&e.profile.email&&(e.profile.email.match(a)||e.profile.email.match(s))||e.profile&&e.profile.real_name_normalized&&(e.profile.real_name_normalized.match(a)||e.profile.real_name_normalized.match(s))||e.profile&&e.profile.real_name&&(e.profile.real_name.match(a)||e.profile.real_name.match(s));if(t){if(!o.name)o.name=[];o.name.push({member:e})}if(i&&r){t=e.profile&&e.profile.title&&(e.profile.title.match(a)||e.profile.title.match(s));if(t){if(!o.title)o.title=[];o.title.push({member:e})}}if(l.length&&e.profile&&e.profile.fields)l.forEach(function(r){var i=e.profile.fields[r.id];if(!i)return;t=null;if("user"===r.type){if(i.value){var l="";i.value.split(/\s*,\s*/).some(function(e){l=TS.members.getPrefCompliantMemberNameById(e,false);return l.match(a)||l.match(s)});if(t){if(!o[r.id])o[r.id]=[];o[r.id].push({member:e,value:l,match:t[0]})}}}else{t=i.value&&(i.value.match(a)||i.value.match(s));if(t){if(!o[r.id])o[r.id]=[];o[r.id].push({member:e,value:i.value,match:t[0]})}else{t=i.alt&&(i.alt.match(a)||i.alt.match(s));if(t){if(!o[r.id])o[r.id]=[];o[r.id].push({member:e,value:i.alt,match:t[0]})}}}if(t&&!n[r.id])n[r.id]=r.label})});return o}})()},4236:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("prefs",{highlight_words_changed_sig:new signals.Signal,seen_welcome_2_changed_sig:new signals.Signal,emoji_mode_changed_sig:new signals.Signal,obey_inline_img_limit_changed_sig:new signals.Signal,messages_theme_changed_sig:new signals.Signal,expand_inline_imgs_changed_sig:new signals.Signal,expand_internal_inline_imgs_changed_sig:new signals.Signal,expand_non_media_attachments_changed_sig:new signals.Signal,webapp_spellcheck_changed_sig:new signals.Signal,color_names_in_list_changed_sig:new signals.Signal,search_only_my_channels_changed_sig:new signals.Signal,search_exclude_channels_changed_sig:new signals.Signal,search_exclude_bots_changed_sig:new signals.Signal,search_only_current_team_changed_sig:new signals.Signal,box_enabled_changed_sig:new signals.Signal,dropbox_enabled_changed_sig:new signals.Signal,read_changed_sig:new signals.Signal,push_changed_sig:new signals.Signal,time24_changed_sig:new signals.Signal,sidebar_behavior_changed_sig:new signals.Signal,dtop_notif_changed_sig:new signals.Signal,muted_channels_changed_sig:new signals.Signal,mac_ssb_bullet_changed_sig:new signals.Signal,team_hide_referers_changed_sig:new signals.Signal,team_require_at_for_mention_changed_sig:new signals.Signal,sidebar_theme_changed_sig:new signals.Signal,no_invites_widget_in_sidebar_changed_sig:new signals.Signal,no_omnibox_in_channels_changed_sig:new signals.Signal,k_key_omnibox_auto_hide_count_changed_sig:new signals.Signal,prev_next_btn_changed_sig:new signals.Signal,display_real_names_override_changed_sig:new signals.Signal,team_display_real_names_changed_sig:new signals.Signal,team_perms_pref_changed_sig:new signals.Signal,privacy_policy_seen_changed_sig:new signals.Signal,two_factor_update_seen_changed_sig:new signals.Signal,compliance_export_start_changed_sig:new signals.Signal,team_disallow_public_file_urls_changed_sig:new signals.Signal,msg_preview_changed_sig:new signals.Signal,mentions_exclude_at_channels_changed_sig:new signals.Signal,mentions_exclude_at_user_groups_changed_sig:new signals.Signal,team_auth_mode_changed_sig:new signals.Signal,team_sso_auth_restrictions_changed_sig:new signals.Signal,team_posts_migrating_changed_sig:new signals.Signal,preferred_skin_tone_changed_sig:new signals.Signal,separate_private_channels_changed_sig:new signals.Signal,separate_shared_channels_changed_sig:new signals.Signal,whats_new_read_changed_sig:new signals.Signal,team_dnd_enabled_changed_sig:new signals.Signal,team_dnd_start_hour_changed_sig:new signals.Signal,team_dnd_end_hour_changed_sig:new signals.Signal,team_invites_only_admins_changed_sig:new signals.Signal,tz_changed_sig:new signals.Signal,team_allow_calls_changed_sig:new signals.Signal,team_calling_app_name_changed_sig:new signals.Signal,team_calling_app_id_changed_sig:new signals.Signal,frecency_jumper_changed_sig:new signals.Signal,jumbomoji_changed_sig:new signals.Signal,hide_hex_swatch_changed_sig:new signals.Signal,channel_sort_changed_sig:new signals.Signal,show_memory_instrument_changed_sig:new signals.Signal,enable_unread_view_changed_sig:new signals.Signal,measure_css_usage_changed_sig:new signals.Signal,enable_react_emoji_picker_changed_sig:new signals.Signal,team_disable_file_editing_changed_sig:new signals.Signal,team_disable_file_deleting_changed_sig:new signals.Signal,team_display_email_addresses_changed_sig:new signals.Signal,all_unreads_sort_order_changed_sig:new signals.Signal,email_alerts_changed_sig:new signals.Signal,team_uses_customized_custom_status_presets_changed_sig:new signals.Signal,team_loud_channel_mentions_limit_changed_sig:new signals.Signal,locale_changed_sig:new signals.Signal,a11y_animations_changed_sig:new signals.Signal,use_react_sidebar_changed_sig:new signals.Signal,setPrefs:function e(t){var n=TS.model.prefs||{};TS.model.prefs=t;TS.prefs.mergeEmojiUse(TS.model.prefs.emoji_use);TS.prefs.mergeFrecencyJumper(TS.ui.frecency.isEnterprise()?TS.model.prefs.frecency_ent_jumper:TS.model.prefs.frecency_jumper);TS.prefs.setUserColors(TS.model.prefs.user_colors);TS.prefs.setLoudChannels(TS.model.prefs.loud_channels);TS.prefs.setSuppressedChannels(TS.model.prefs.at_channel_suppressed_channels);TS.prefs.setPushSuppressedChannels(TS.model.prefs.push_at_channel_suppressed_channels);TS.prefs.setNeverChannels(TS.model.prefs.never_channels);TS.prefs.setMutedChannels(TS.model.prefs.muted_channels,n.muted_channels);TS.prefs.setLoudChannelsSet(TS.model.prefs.loud_channels_set);TS.prefs.setPushLoudChannels(TS.model.prefs.push_loud_channels);TS.prefs.setPushMentionChannels(TS.model.prefs.push_mention_channels);TS.prefs.setPushLoudChannelsSet(TS.model.prefs.push_loud_channels_set);TS.prefs.setSearchExcludeChannels(TS.model.prefs.search_exclude_channels);TS.prefs.setChannelSort(TS.model.prefs.channel_sort);TS.prefs.setSidebarThemeCustomValues(TS.utility.parseJSONOrElse(TS.model.prefs.sidebar_theme_custom_values,void 0));TS.emoji.setEmojiMode();TS.prefs.setTheme();TS.model.prefs.emoji_autocomplete_big=false;TSSSB.call("runFromTray",!!TS.model.prefs.winssb_run_from_tray);TSSSB.call("windowFlashBehavior",TS.model.prefs.winssb_window_flash_behavior);if(TS.boot_data.feature_name_tagging_client){if(!TS.model.prefs.require_at)TS.model.prefs.require_at=true;if(!TS.model.team.prefs.require_at_for_mention)TS.model.team.prefs.require_at_for_mention=true}if(TS.boot_data.page_needs_enterprise){TS.model.prefs.require_at=true;TS.model.team.prefs.require_at_for_mention=true}TS.redux.prefs.setUserPrefs(TS.model.prefs);TS.redux.prefs.setTeamPrefs(TS.model.team.prefs)},setChannelSort:function e(t){TS.model.channel_sort=t},setHighlightWords:function e(t){TS.model.prefs.highlight_words=t;if(TS.boot_data.feature_name_tagging_client)TS.model.highlight_words=[];else{TS.model.highlight_words=["@"+TS.model.user.name];if(!TS.model.team.prefs.require_at_for_mention)TS.model.highlight_words.push(TS.model.user.name)}TS.model.highlight_words.push("<@"+TS.model.user.id);if(t&&"string"===typeof t)TS.model.highlight_words=TS.model.highlight_words.concat(t.split(","));TS.model.highlight_words_regex=null},setSuppressedChannels:function e(t){TS.model.prefs.at_channel_suppressed_channels=t;TS.model.at_channel_suppressed_channels=[];if(t&&"string"===typeof t)TS.model.at_channel_suppressed_channels=TS.model.at_channel_suppressed_channels.concat(t.split(","))},setPushSuppressedChannels:function e(t){TS.model.prefs.push_at_channel_suppressed_channels=t;TS.model.push_at_channel_suppressed_channels=[];if(t&&"string"===typeof t)TS.model.push_at_channel_suppressed_channels=TS.model.push_at_channel_suppressed_channels.concat(t.split(","))},setLoudChannels:function e(t){TS.model.prefs.loud_channels=t;TS.model.loud_channels=[];if(t&&"string"===typeof t)TS.model.loud_channels=TS.model.loud_channels.concat(t.split(","))},setNeverChannels:function e(t){TS.model.prefs.never_channels=t;TS.model.never_channels=[];if(t&&"string"===typeof t)TS.model.never_channels=TS.model.never_channels.concat(t.split(","))},setMutedChannels:function t(n,r){if(!r)r=TS.model.prefs.muted_channels;if(r!==n||!e){TS.model.prev_muted_channels=TS.model.prefs.muted_channels&&"string"===typeof TS.model.prefs.muted_channels?TS.model.prefs.muted_channels.split(","):[];TS.model.prefs.muted_channels=n}else return;e=true;var i;var a;TS.model.muted_channels=[];TS.model.newly_muted_channels=[];TS.model.newly_unmuted_channels=[];if(n&&"string"===typeof n){TS.model.muted_channels=TS.model.muted_channels.concat(n.split(","));TS.model.newly_unmuted_channels=_.difference(TS.model.prev_muted_channels,TS.model.muted_channels);TS.model.newly_muted_channels=_.difference(TS.model.muted_channels,TS.model.prev_muted_channels)}for(i=0;i<TS.model.muted_channels.length;i+=1){a=TS.shared.getModelObById(TS.model.muted_channels[i]);if(!a)continue;if(!a.unread_cnt)continue;a._show_in_list_even_though_no_unreads=true}TS.model.channels.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.model.groups.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.redux.channels.updateMutedChannels()},setLoudChannelsSet:function e(t){TS.model.prefs.loud_channels_set=t;TS.model.loud_channels_set=[];if(t&&"string"===typeof t)TS.model.loud_channels_set=TS.model.loud_channels_set.concat(t.split(","))},setPushLoudChannels:function e(t){TS.model.prefs.push_loud_channels=t;TS.model.push_loud_channels=[];if(t&&"string"===typeof t)TS.model.push_loud_channels=TS.model.push_loud_channels.concat(t.split(","))},setPushMentionChannels:function e(t){TS.model.prefs.push_mention_channels=t;TS.model.push_mention_channels=[];if(t&&"string"===typeof t)TS.model.push_mention_channels=TS.model.push_mention_channels.concat(t.split(","))},setPushLoudChannelsSet:function e(t){TS.model.prefs.push_loud_channels_set=t;TS.model.push_loud_channels_set=[];if(t&&"string"===typeof t)TS.model.push_loud_channels_set=TS.model.push_loud_channels_set.concat(t.split(","))},setSearchExcludeChannels:function e(t){TS.model.prefs.search_exclude_channels=t;TS.model.search_exclude_channels=[];if(t&&"string"===typeof t)TS.model.search_exclude_channels=TS.model.search_exclude_channels.concat(t.split(","))},mergeFrecencyJumper:function e(t){if(!t||"object"!==("undefined"===typeof t?"undefined":n(t)))t=TS.utility.parseJSONOrElse(t||null)||{};TS.model.frecency_jumper=t;return true},mergeEmojiUse:function e(t){if(!TS.model.emoji_names||!TS.model.emoji_names.length)TS.emoji.makeMenuLists();if(!t||"object"!==("undefined"===typeof t?"undefined":n(t))){t=TS.utility.parseJSONOrElse(t||null)||{};t=_.pickBy(t,function(e,t){return _.includes(TS.model.emoji_names,t)})}var r=false;for(var i in t)if(!TS.model.emoji_use.hasOwnProperty(i)||t[i]>TS.model.emoji_use[i]){TS.model.emoji_use[i]=t[i];r=true}if(!r){if(TS.has_pri[777])TS.log(777,"mergeEmojiUse TS.model.emoji_use unchanged");return false}if(TS.has_pri[777])TS.dir(777,TS.model.emoji_use,"mergeEmojiUse TS.model.emoji_use set to:");return true},setUserColors:function e(t){TS.model.prefs.user_colors=t;var n=t?JSON.parse(t):{};TS.model.user_colors=n||{}},setTheme:function e(){if("default"===TS.model.prefs.messages_theme)TS.model.prefs.messages_theme="light_with_avatars";TS.model.prefs.theme="light";TS.model.prefs.avatars=true;if("dense"===TS.model.prefs.messages_theme){TS.model.prefs.theme="dense";TS.model.prefs.avatars=false}else if("light"===TS.model.prefs.messages_theme){TS.model.prefs.theme="light";TS.model.prefs.avatars=false}else if("light_with_avatars"===TS.model.prefs.messages_theme){TS.model.prefs.theme="light";TS.model.prefs.avatars=true}},onTeamPrefChanged:function e(t){if("msg_edit_window_mins"===t.name)TS.model.team.prefs.msg_edit_window_mins=t.value;else if("allow_message_deletion"===t.name)TS.model.team.prefs.allow_message_deletion=!!t.value;else if("hide_referers"===t.name){TS.model.team.prefs.hide_referers=!!t.value;TS.prefs.team_hide_referers_changed_sig.dispatch()}else if("require_at_for_mention"===t.name){if(!TS.boot_data_feature_name_tagging_client){TS.model.team.prefs.require_at_for_mention=!!t.value;TS.prefs.setHighlightWords(TS.model.prefs.highlight_words);TS.prefs.team_require_at_for_mention_changed_sig.dispatch()}}else if("display_real_names"===t.name){TS.model.team.prefs.display_real_names=!!t.value;TS.prefs.team_display_real_names_changed_sig.dispatch()}else if("display_email_addresses"===t.name){TS.model.team.prefs.display_email_addresses=!!t.value;TS.prefs.team_display_email_addresses_changed_sig.dispatch()}else if(0===t.name.indexOf("who_can_")){if(TS.model.team.prefs[t.name]!=t.value){TS.model.team.prefs[t.name]=t.value;TS.prefs.team_perms_pref_changed_sig.dispatch(t.name)}}else if("compliance_export_start"===t.name){if(TS.model.team.prefs.compliance_export_start!=t.value){TS.model.team.prefs.compliance_export_start=t.value;TS.prefs.compliance_export_start_changed_sig.dispatch()}}else if("disallow_public_file_urls"===t.name){TS.model.team.prefs.disallow_public_file_urls=!!t.value;TS.prefs.team_disallow_public_file_urls_changed_sig.dispatch()}else if("auth_mode"===t.name){TS.model.team.prefs.auth_mode=t.value;TS.prefs.team_auth_mode_changed_sig.dispatch()}else if("sso_auth_restrictions"===t.name){TS.model.team.prefs.sso_auth_restrictions=t.value;TS.prefs.team_sso_auth_restrictions_changed_sig.dispatch()}else if("posts_migrating"===t.name){TS.model.team.prefs.posts_migrating=t.value;TS.prefs.team_posts_migrating_changed_sig.dispatch()}else if("dnd_enabled"===t.name){TS.model.team.prefs.dnd_enabled=t.value;TS.prefs.team_dnd_enabled_changed_sig.dispatch()}else if("dnd_start_hour"===t.name){TS.model.team.prefs.dnd_start_hour=t.value;TS.prefs.team_dnd_start_hour_changed_sig.dispatch()}else if("dnd_end_hour"===t.name){TS.model.team.prefs.dnd_end_hour=t.value;TS.prefs.team_dnd_end_hour_changed_sig.dispatch()}else if("invites_only_admins"===t.name){TS.model.team.prefs.invites_only_admins=t.value;TS.prefs.team_invites_only_admins_changed_sig.dispatch()}else if("allow_calls"===t.name){TS.model.team.prefs.allow_calls=t.value;TS.prefs.team_allow_calls_changed_sig.dispatch()}else if("calling_app_id"===t.name){TS.model.team.prefs.calling_app_id=t.value;TS.prefs.team_calling_app_id_changed_sig.dispatch()}else if("calling_app_name"===t.name){TS.model.team.prefs.calling_app_name=t.value;TS.prefs.team_calling_app_name_changed_sig.dispatch()}else if("disable_file_editing"===t.name){TS.model.team.prefs.disable_file_editing=t.value;TS.prefs.team_disable_file_editing_changed_sig.dispatch()}else if("disable_file_deleting"===t.name){TS.model.team.prefs.disable_file_deleting=t.value;TS.prefs.team_disable_file_deleting_changed_sig.dispatch()}else if("who_can_post_general"===t.name){TS.model.team.prefs[t.name]=t.value;var n=TS.channels.getGeneralChannel().id;if(TS.permissions.members.canPostInGeneral())TS.channels.read_only.removeChannelFromList(n);else TS.channels.read_only.addChannelToList(n)}else if("uses_customized_custom_status_presets"===t.name){TS.model.team.prefs[t.name]=t.value;TS.prefs.team_uses_customized_custom_status_presets_changed_sig.dispatch()}else if("loud_channel_mentions_limit"===t.name){TS.model.team.prefs[t.name]=t.value;TS.prefs.team_loud_channel_mentions_limit_changed_sig.dispatch()}else TS.model.team.prefs[t.name]=t.value},updateTeamPrefCanUserManageSharedChannels:function e(t){TS.model.team.prefs.can_user_manage_shared_channels=t.can_manage},onPrefChanged:function e(t){switch(t.name){case"locale":TS.prefs.locale_changed_sig.dispatch(t.value);break;case"flannel_server_pool":TS.model.prefs.flannel_server_pool=t.value;break;case"color_names_in_list":TS.model.prefs.color_names_in_list=!!t.value;TS.prefs.color_names_in_list_changed_sig.dispatch();break;case"display_real_names_override":TS.model.prefs.display_real_names_override=t.value;TS.prefs.display_real_names_override_changed_sig.dispatch();break;case"growls_enabled":TS.model.prefs.growls_enabled=!!t.value;TS.prefs.dtop_notif_changed_sig.dispatch();break;case"sidebar_theme":if(TS.model.prefs.sidebar_theme!==t.value){TS.model.prefs.sidebar_theme=t.value;TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"sidebar_theme_custom_values":if(TS.model.prefs.sidebar_theme_custom_values!==t.value){TS.prefs.setSidebarThemeCustomValues(JSON.parse(t.value));TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"expand_inline_imgs":TS.model.prefs.expand_inline_imgs=!!t.value;TS.prefs.expand_inline_imgs_changed_sig.dispatch();break;case"webapp_spellcheck":TS.model.prefs.webapp_spellcheck=!!t.value;TS.prefs.webapp_spellcheck_changed_sig.dispatch();break;case"expand_internal_inline_imgs":TS.model.prefs.expand_internal_inline_imgs=!!t.value;TS.prefs.expand_internal_inline_imgs_changed_sig.dispatch();break;case"expand_non_media_attachments":TS.model.prefs.expand_non_media_attachments=!!t.value;TS.prefs.expand_non_media_attachments_changed_sig.dispatch();break;case"messages_theme":TS.model.prefs.messages_theme=t.value;TS.prefs.setTheme();TS.prefs.messages_theme_changed_sig.dispatch();break;case"highlight_words":TS.prefs.setHighlightWords(t.value);TS.prefs.highlight_words_changed_sig.dispatch();break;case"at_channel_suppressed_channels":TS.prefs.setSuppressedChannels(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_at_channel_suppressed_channels":TS.prefs.setPushSuppressedChannels(t.value);TS.prefs.push_changed_sig.dispatch();break;case"loud_channels":TS.prefs.setLoudChannels(t.value);break;case"never_channels":TS.prefs.setNeverChannels(t.value);break;case"muted_channels":TS.prefs.setMutedChannels(t.value);TS.prefs.muted_channels_changed_sig.dispatch();break;case"loud_channels_set":TS.prefs.setLoudChannelsSet(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_loud_channels":TS.prefs.setPushLoudChannels(t.value);break;case"push_mention_channels":TS.prefs.setPushMentionChannels(t.value);break;case"push_loud_channels_set":TS.prefs.setPushLoudChannelsSet(t.value);TS.prefs.push_changed_sig.dispatch();break;case"emoji_use":if(TS.prefs.mergeEmojiUse(t.value))TS.emoji.maybeRemakeMenuListsIfFrequentsChanged();break;case"user_colors":_.each(_.keys(TS.model.user_colors),function(e){var t=TS.members.getMemberById(e);if(t)TS.members.setMemberUserColor(t,t.color)});TS.prefs.setUserColors(t.value);_.forOwn(TS.model.user_colors,function(e,t){var n=TS.members.getMemberById(t);if(n)TS.members.setMemberUserColor(n,e)});break;case"graphic_emoticons":TS.rxns.clearHandyRxnsDisplayDataCache();TS.model.prefs.graphic_emoticons=t.value;TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();break;case"ss_emojis":TS.model.prefs.ss_emojis=t.value;TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"emoji_mode":TS.rxns.clearHandyRxnsDisplayDataCache();TS.model.prefs.emoji_mode=t.value;TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"obey_inline_img_limit":TS.model.prefs.obey_inline_img_limit=t.value;TS.prefs.obey_inline_img_limit_changed_sig.dispatch();break;case"search_only_my_channels":TS.model.prefs.search_only_my_channels=!!t.value;TS.prefs.search_only_my_channels_changed_sig.dispatch();break;case"search_only_current_team":TS.model.prefs.search_only_current_team=!!t.value;TS.prefs.search_only_current_team_changed_sig.dispatch();break;case"search_exclude_channels":TS.prefs.setSearchExcludeChannels(t.value);TS.prefs.search_exclude_channels_changed_sig.dispatch();break;case"search_exclude_bots":TS.model.prefs.search_exclude_bots=!!t.value;TS.prefs.search_exclude_bots_changed_sig.dispatch();break;case"has_uploaded":TS.model.prefs.has_uploaded=!!t.value;break;case"has_invited":TS.model.prefs.has_invited=!!t.value;break;case"has_created_channel":TS.model.prefs.has_created_channel=!!t.value;break;case"no_joined_overlays":TS.model.prefs.no_joined_overlays=!!t.value;break;case"no_created_overlays":TS.model.prefs.no_created_overlays=!!t.value;break;case"seen_welcome_2":TS.model.prefs.seen_welcome_2=!!t.value;TS.prefs.seen_welcome_2_changed_sig.dispatch();break;case"box_enabled":TS.model.prefs.box_enabled=!!t.value;TS.prefs.box_enabled_changed_sig.dispatch();break;case"dropbox_enabled":TS.model.prefs.dropbox_enabled=!!t.value;TS.prefs.dropbox_enabled_changed_sig.dispatch();break;case"mark_msgs_read_immediately":if(TS.model.prefs.mark_msgs_read_immediately!==!!t.value){TS.model.prefs.mark_msgs_read_immediately=!!t.value;TS.prefs.read_changed_sig.dispatch()}break;case"start_scroll_at_oldest":if(TS.model.prefs.start_scroll_at_oldest!==!!t.value){TS.model.prefs.start_scroll_at_oldest=!!t.value;TS.prefs.read_changed_sig.dispatch()}break;case"mac_ssb_bullet":if(TS.model.prefs.mac_ssb_bullet!==!!t.value){TS.model.prefs.mac_ssb_bullet=!!t.value;TS.prefs.mac_ssb_bullet_changed_sig.dispatch()}break;case"all_channels_loud":if(TS.model.prefs.all_channels_loud!==!!t.value){TS.model.prefs.all_channels_loud=!!t.value;TS.prefs.dtop_notif_changed_sig.dispatch()}break;case"push_everything":if(TS.model.prefs.push_everything!==!!t.value){TS.model.prefs.push_everything=!!t.value;TS.prefs.push_changed_sig.dispatch()}break;case"push_mention_alert":if(TS.model.prefs.push_mention_alert!==!!t.value){TS.model.prefs.push_mention_alert=!!t.value;TS.prefs.push_changed_sig.dispatch()}break;case"push_dm_alert":if(TS.model.prefs.push_dm_alert!==!!t.value){TS.model.prefs.push_dm_alert=!!t.value;TS.prefs.push_changed_sig.dispatch()}break;case"time24":if(TS.model.prefs.time24!==!!t.value){TS.model.prefs.time24=!!t.value;TS.prefs.time24_changed_sig.dispatch()}break;case"sidebar_behavior":if(TS.model.prefs.sidebar_behavior!=t.value){TS.model.prefs.sidebar_behavior=t.value;TS.prefs.sidebar_behavior_changed_sig.dispatch()}break;case"two_factor_update_seen":if(TS.model.two_factor_update_seen!=t.value){TS.mode.prefs.two_factor_update_seen=t.value;TS.prefs.two_factor_update_seen_changed_sig.dispatch()}break;case"privacy_policy_seen":if(TS.model.prefs.privacy_policy_seen!=t.value){TS.model.prefs.privacy_policy_seen=t.value;TS.prefs.privacy_policy_seen_changed_sig.dispatch()}break;case"last_seen_at_channel_warning":if(TS.model.prefs.last_seen_at_channel_warning!=t.value)TS.model.prefs.last_seen_at_channel_warning=t.value;break;case"msg_preview":if(TS.model.prefs.msg_preview!=t.value){TS.model.prefs.msg_preview=t.value;TS.prefs.msg_preview_changed_sig.dispatch()}break;case"msg_preview_persistent":if(TS.model.prefs.msg_preview_persistent!=t.value){TS.model.prefs.msg_preview_persistent=t.value;TS.prefs.msg_preview_changed_sig.dispatch()}break;case"winssb_run_from_tray":if(TS.model.prefs.winssb_run_from_tray!=t.value){TS.model.prefs.winssb_run_from_tray=t.value;TSSSB.call("runFromTray",!!TS.model.prefs.winssb_run_from_tray)}break;case"winssb_window_flash_behavior":if(TS.model.prefs.winssb_window_flash_behavior!=t.value){TS.model.prefs.winssb_window_flash_behavior=t.value;TSSSB.call("windowFlashBehavior",TS.model.prefs.winssb_window_flash_behavior)}break;case"mentions_exclude_at_channels":if(TS.model.prefs.mentions_exclude_at_channels!=t.value){TS.model.prefs.mentions_exclude_at_channels=t.value;TS.prefs.mentions_exclude_at_channels_changed_sig.dispatch()}break;case"mentions_exclude_at_user_groups":if(TS.model.prefs.mentions_exclude_at_user_groups!=t.value){TS.model.prefs.mentions_exclude_at_user_groups=t.value;TS.prefs.mentions_exclude_at_user_groups_changed_sig.dispatch()}break;case"no_invites_widget_in_sidebar":if(TS.model.prefs.no_invites_widget_in_sidebar!=t.value){TS.model.prefs.no_invites_widget_in_sidebar=t.value;TS.prefs.no_invites_widget_in_sidebar_changed_sig.dispatch()}break;case"no_omnibox_in_channels":if(TS.model.prefs.no_omnibox_in_channels!=t.value){TS.model.prefs.no_omnibox_in_channels=t.value;TS.prefs.no_omnibox_in_channels_changed_sig.dispatch();if(TS.model.prefs.no_omnibox_in_channels)TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"quick_switcher_pref_changed",action:"button_hidden"});else TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"quick_switcher_pref_changed",action:"button_shown"})}break;case"k_key_omnibox_auto_hide_count":if(TS.model.prefs.k_key_omnibox_auto_hide_count!=t.value){TS.model.prefs.k_key_omnibox_auto_hide_count=t.value;TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.dispatch()}break;case"prev_next_btn":if(TS.model.prefs.prev_next_btn!=t.value){TS.model.prefs.prev_next_btn=t.value;TS.prefs.prev_next_btn_changed_sig.dispatch()}break;case"preferred_skin_tone":if(TS.model.prefs.preferred_skin_tone!=t.value){TS.rxns.clearHandyRxnsDisplayDataCache();TS.model.prefs.preferred_skin_tone=t.value;TS.prefs.preferred_skin_tone_changed_sig.dispatch()}break;case"separate_private_channels":if(TS.model.prefs.separate_private_channels!=t.value){TS.model.prefs.separate_private_channels=t.value;TS.prefs.separate_private_channels_changed_sig.dispatch()}break;case"separate_shared_channels":if(TS.model.prefs.separate_shared_channels!=t.value){TS.model.prefs.separate_shared_channels=t.value;TS.prefs.separate_shared_channels_changed_sig.dispatch()}break;case"whats_new_read":if(TS.model.prefs.whats_new_read!=t.value){TS.model.prefs.whats_new_read=t.value;TS.prefs.whats_new_read_changed_sig.dispatch()}break;case"tz":if(TS.model.prefs.tz!=t.value){TS.model.prefs.tz=t.value;TS.prefs.tz_changed_sig.dispatch()}break;case"frecency_jumper":if(TS.ui.frecency.isEnterprise())break;if(TS.prefs.mergeFrecencyJumper(t.value))TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"frecency_ent_jumper":TS.log(666,"Received a pref_change event for frecency_ent_jumper.");if(TS.prefs.mergeFrecencyJumper(t.value))TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"jumbomoji":if(TS.model.prefs.jumbomoji!=t.value){TS.model.prefs.jumbomoji=t.value;TS.prefs.jumbomoji_changed_sig.dispatch()}break;case"hide_hex_swatch":if(TS.model.prefs.hide_hex_swatch!=t.value){TS.model.prefs.hide_hex_swatch=t.value;TS.prefs.hide_hex_swatch_changed_sig.dispatch()}break;case"a11y_animations":if(TS.model.prefs.a11y_animations!==t.value){TS.model.prefs.a11y_animations=t.value;TS.prefs.a11y_animations_changed_sig.dispatch();if(TS.client)TS.clog.track("PREF_USER_CLIENT_UPDATE",{a11y_animations:TS.model.prefs.a11y_animations})}break;case"show_memory_instrument":if(TS.model.prefs.show_memory_instrument!==t.value){TS.model.prefs.show_memory_instrument=t.value;TS.prefs.show_memory_instrument_changed_sig.dispatch()}break;case"channel_sort":if(TS.model.prefs.channel_sort!==t.value){TS.model.prefs.channel_sort=t.value;TS.prefs.setChannelSort(TS.model.prefs.channel_sort);TS.prefs.channel_sort_changed_sig.dispatch()}break;case"enable_unread_view":if(TS.model.prefs.enable_unread_view!==t.value){TS.model.prefs.enable_unread_view=t.value;TS.prefs.enable_unread_view_changed_sig.dispatch()}break;case"measure_css_usage":if(TS.model.prefs.measure_css_usage!==t.value){TS.model.prefs.measure_css_usage=t.value;TS.prefs.measure_css_usage_changed_sig.dispatch()}break;case"enable_react_emoji_picker":if(TS.model.prefs.enable_react_emoji_picker!==t.value){TS.model.prefs.enable_react_emoji_picker=t.value;TS.prefs.enable_react_emoji_picker_changed_sig.dispatch()}break;case"client_logs_pri":TS.model.prefs[t.name]=t.value;TS.console.setAppropriatePri();break;case"email_alerts":TS.model.prefs[t.name]=t.value;TS.prefs.email_alerts_changed_sig.dispatch();break;case"use_react_sidebar":if(TS.model.prefs.use_react_sidebar!==t.value){TS.model.prefs.use_react_sidebar=t.value;TS.prefs.use_react_sidebar_changed_sig.dispatch()}break;default:TS.model.prefs[t.name]=t.value}},hex_regex:new RegExp(/^#?([0-9a-f]{6})$/i),setSidebarThemeCustomValues:function e(t){var r=false;if(t&&"object"===("undefined"===typeof t?"undefined":n(t))&&void 0===t.length)_.forOwn(t,function(e,n){r=false;if(!e)return false;if(!e.substr)return false;t[n]=e.substr(0,7);if(!e.match(TS.prefs.hex_regex))return false;r=true});if(r)TS.model.prefs.sidebar_theme_custom_values=JSON.stringify(t);else{TS.model.prefs.sidebar_theme="default";TS.model.prefs.sidebar_theme_custom_values=JSON.stringify(TS.sidebar_themes.default_themes.default_theme)}},setMultiPrefsByAPI:function e(t,n){var r="";_.forOwn(t,function(e,t){r+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(!r){TS.error(" no prefs to set?");return}var i={prefs:r};return TS.prefs.setPrefByAPI(i,n)},setPrefByAPI:function e(t,n){var r=function e(t,r,i){if(!t){var a;if(i.hasOwnProperty("name"))a="pref name: "+i.name;else if(i.prefs)a="(multiple prefs)";TS.logError(a,"TS.prefs.setPrefByAPI call got a not ok rsp","API response error");setTimeout(function(){if(i.prefs)TS.error("multi preferences setting failed.");else TS.error('"'+i.name+'" preference setting failed.')},0)}if(n)n(t,r,i)};var i=TS.model.window_unloading?TS.api.callSynchronously:TS.api.callImmediately;return i("users.prefs.set",t,r)},setTeamPrefByAPI:function e(t,n,r){var i=TS.model.window_unloading?TS.api.callSynchronously:TS.api.callImmediately;var a=$.Deferred();i("team.prefs.set",{prefs:JSON.stringify(t)},function(e,i){if(e){if(TS.web){r=r||[];var s=Object.keys(t).concat(r);s.forEach(function(e){if(i.prefs.hasOwnProperty(e))if(t.hasOwnProperty(e)||TS.model.team.prefs[e]!==i.prefs[e])TS.prefs.onTeamPrefChanged({name:e,value:i.prefs[e]})})}a.resolve(i.prefs)}else{a.reject(i);if(n)n(i)}});return a},saveHighlightWords:function e(n,r,i){var a=t(n);if(i||TS.model.prefs.highlight_words!=a)return TS.prefs.setPrefByAPI({name:"highlight_words",value:a},r);return Promise.resolve()},getReadStateTrackingPref:function e(){var t="default";if(TS.model.prefs.mark_msgs_read_immediately&&TS.model.prefs.start_scroll_at_oldest)t="immediate_scroll";else if(TS.model.prefs.mark_msgs_read_immediately)t="immediate";return t},setReadStateTrackingPref:function e(t,n){var r={};if("immediate_scroll"===t||"immediate"===t){r.mark_msgs_read_immediately=true;TS.model.prefs.mark_msgs_read_immediately=true;if("immediate_scroll"===t){r.start_scroll_at_oldest=true;TS.model.prefs.start_scroll_at_oldest=true}else{r.start_scroll_at_oldest=false;TS.model.prefs.start_scroll_at_oldest=false}}else{r.mark_msgs_read_immediately=false;TS.model.prefs.mark_msgs_read_immediately=false;r.start_scroll_at_oldest=false;TS.model.prefs.start_scroll_at_oldest=false}TS.prefs.setMultiPrefsByAPI(r,n)},test:function e(){return{_cleanHighlightWords:t}}});var e=false;var t=function e(t){if(!_.isString(t))return"";t=TS.format.replaceUnicodeDoppelgangers(t);return _(t).split(",").map(_.trim).compact().join(",")}})()},4237:function(e,t){(function(){"use strict";TS.registerModule("search",{search_dispatched_sig:new signals.Signal,quick_search_results_fetched_sig:new signals.Signal,all_search_results_fetched_sig:new signals.Signal,message_search_results_fetched_sig:new signals.Signal,file_search_results_fetched_sig:new signals.Signal,autosuggest_search_results_fetched_sig:new signals.Signal,search_filter_set_sig:new signals.Signal,search_filetype_filter_set_sig:new signals.Signal,search_sort_set_sig:new signals.Signal,search_channel_set_sig:new signals.Signal,search_group_set_sig:new signals.Signal,search_member_set_sig:new signals.Signal,message_search_more_results_fetched_sig:new signals.Signal,query:"",query_string:"",query_string_for_display:"",last_search_query:"",previous_query:"",sort:"timestamp",filter:"messages",filetype:"all",results:{},submit_tim:0,delay:500,suggestions:[],input:"",from_regex:/from:[@*\-.\w]+/gi,member:null,from:null,in_regex:/in:[#*\-.\w]+/gi,channel:null,group:null,im:null,per_page:-1,keyword_modifiers:["after","before","bot","during","from","to","has","in","on"],keyword_modifier_pair_regex:null,keyword_modifier_extract_regex:null,search_query_max_length:250,onStart:function e(){TS.search.keyword_modifier_pair_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\S+$");TS.search.keyword_modifier_extract_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\w*");TS.search.per_page=parseInt(TS.qs_args.search_count,10)||20;if(TS.client)TS.search.delay=10;if(TS.client)TS.client.login_sig.add(TS.search.loggedIn,TS.search);else if(TS.web)TS.web.login_sig.add(TS.search.loggedIn,TS.search);TS.search.search_channel_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_group_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_member_set_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_my_channels_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_current_team_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_exclude_bots_changed_sig.add(TS.search.searchAll,TS.search);TS.files.team_file_changed_sig.add(u);if(TS.qs_args.delay)TS.search.delay=TS.qs_args.delay;TS.search.input=$("#search_terms");if(!TS.boot_data.feature_texty_search)TSSSB.call("inputFieldCreated",TS.search.input.get(0));var t=[];if(TS.boot_data.feature_more_texty_search)t=[TS.tabcomplete.members];if(TS.boot_data.feature_sli_file_search&&TS.search.sliFileSearchIsEnabled())TS.search.filter="all";if(TS.boot_data.feature_texty_search)TS.utility.contenteditable.create(TS.search.input,{modules:{slacksearch:true,tabcomplete:{completers:t,matchOptions:{allowed_preceding_symbols:[":"]},onEnter:function e(){if(TS.boot_data.feature_more_texty_search){TS.search.submitSearch();TS.search.autocomplete.triggerInputEvent("on-enter")}},positionMenu:function e(t){var n=$(TS.search.input);var r=n.offset();var i=355;var a=31;var s=i-n.outerWidth();var o=r.left-s+a;var l=12;var u=r.top+n.height()+l;t.style.width=i+"px";t.style.top=u+"px";t.style.left=o+"px"},render:function e(t,n,r){var i={menu_type:"user",noResults:!r,users:r};return TS.templates.search_menu(i)},onRender:function e(){$("#chat_input_tab_ui").addClass("search_menu")}}},singleLineInput:true,avoidSlugging:!TS.boot_data.feature_more_texty_search,placeholder:TS.i18n.t("Search","page_client")(),onFocus:function e(){$("#client-ui").addClass("search_focused");TS.utility.contenteditable.setCursorAtEnd(TS.search.input);TS.search.autocomplete.setUpMenu();TS.search.autocomplete.onInputFocus();TS.search.autocomplete.triggerInputEvent("focus")},onBlur:function e(){$("#client-ui").removeClass("search_focused");TS.search.autocomplete.maybeLogSearchInputBlur();TS.search.autocomplete.triggerInputEvent("blur")},onEnter:function e(){TS.search.submitSearch();TS.search.autocomplete.triggerInputEvent("on-enter");return true},onTextChange:function e(){var t=TS.utility.contenteditable.isEmpty(TS.search.input);$("#header_search_form").toggleClass("active",!t);TS.search.autocomplete.triggerInputEvent("input")},onEscape:function e(){if(TS.boot_data.feature_keyboard_navigation){if(!$(".search_menu").is(":visible"))TS.utility.contenteditable.blur(TS.search.input)}else TS.utility.contenteditable.blur(TS.search.input);TS.search.autocomplete.triggerInputEvent("on-escape")},onTab:function e(){TS.search.autocomplete.triggerInputEvent("on-tab");return TS.boot_data.feature_keyboard_navigation}})},loggedIn:function e(){TS.search.sort="timestamp"},startSearchTimer:function e(t,n,r,i){clearTimeout(TS.search.submit_tim);TS.search.submit_tim=setTimeout(TS.search.dispatchSearch,TS.search.delay,t,n,r,i);TS.search.search_dispatched_sig.dispatch()},getNextPageOfSearchResults:function e(t,n,r){TS.search.dispatchSearch(t,n,TS.search.per_page,TS.search.onSearchAll,r)},getNextPageOfMessageResults:function e(t,n,r){a("search.messages",t,n,TS.search.per_page,r,s)},getNextPageOfFileResults:function e(t,n,r){a("search.files",t,n,TS.search.per_page,r,o)},extractNonModifierSearchTxt:function e(t){var n="";var r=t.split(" ");r.forEach(function(e){if(e.match(TS.search.keyword_modifier_extract_regex))return;n+=" "+e});n=$.trim(n);return n},dispatchSearch:function e(t,n,r,s,o){if(TS.isPartiallyBooted()){if(!i){var u=this;var d=function e(){TS.search.dispatchSearch.apply(u,i);i=void 0};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(d);else TS.ms.connected_sig.addOnce(d)}i=arguments;return}if(!o||1===o){var c=TS.search.extractNonModifierSearchTxt(t);if(c)TSSSB.call("writeFindString",c)}if(TS.search.separateMessagesAndFiles()){if(!o||1===o)TS.search.results[t]=null;var _=l();a("search.messages",t,n,r,o,_.msgs);a("search.files",t,n,r,o,_.files)}else a("search.all",t,n,r,o,s)},setFilter:function e(t){TS.search.filter=t;TS.search.search_filter_set_sig.dispatch()},setFiletypeFilter:function e(t){TS.search.filetype=t;TS.search.search_filetype_filter_set_sig.dispatch()},moreTopResults:function e(){TS.search.sort="score";TS.search.switchToRelevant(true);TS.clog.track("SEARCH_OPEN",{open_method:"top_results_see_more",click_module_position:0,click_module_name:"score",request_id:TS.search.last_request_id})},hasCachedRelevantResults:function e(){return"messages"===TS.search.filter&&_.has(TS.search.results[TS.search.query].messages,"modules.score")},hasCachedRecentResults:function e(){return"messages"===TS.search.filter&&_.has(TS.search.results[TS.search.query].messages,"timestamp_messages")},switchToRelevant:function e(t){var n=TS.search.results[TS.search.query].messages;TS.search.results[TS.search.query].messages=n.modules.score;TS.search.results[TS.search.query].messages.timestamp_messages=n;TS.search.results[TS.search.query].messages.order=0;TS.search.search_sort_set_sig.dispatch(t);TS.search.view.renderResults(true)},switchToRecent:function e(){TS.search.results[TS.search.query].messages=TS.search.results[TS.search.query].messages.timestamp_messages;TS.search.view.renderResults(true)},topResultsFeedback:function e(t,n){var r=[":bow:"];if("top_results_useful"===n){var i=Math.floor(5*Math.random())+2;r=[":tada:",":raised_hands::skin-tone-"+i+":"]}var a=r[Math.floor(Math.random()*r.length)];$(t).closest(".top_results_feedback").html("Thanks for your feedback! "+TS.emoji.graphicReplace(a));TS.clog.track("SEARCH_FEEDBACK",{search_feedback_value:n,request_id:TS.search.last_request_id})},setSort:function e(t,n){if(TS.search.sort===t)return;$(".search_toggle").toggleClass("active");TS.search.sort=t;TS.search.search_sort_set_sig.dispatch();if("score"!==t&&"model"!==t)t="timestamp";TS.prefs.setPrefByAPI({name:"search_sort",value:t});TS.clog.track("SEARCH_OPEN",{open_method:"set_sort_"+t,request_id:TS.search.last_request_id});if("timestamp"===t&&TS.search.hasCachedRecentResults())TS.search.switchToRecent();else if("score"===t&&TS.search.hasCachedRelevantResults())TS.search.switchToRelevant();else if(!n)TS.search.searchAll()},setChannel:function e(t){var n=TS.channels.getChannelById(t);if(n){TS.search.channel=n;TS.search.group=null;TS.search.im=null}else TS.search.channel=null;TS.search.search_channel_set_sig.dispatch()},setGroup:function e(t){var n=TS.groups.getGroupById(t);if(n){TS.search.group=n;TS.search.channel=null;TS.search.im=null}else TS.search.group=null;TS.search.search_group_set_sig.dispatch()},setMember:function e(t){var n=TS.members.getMemberById(t);if(n)TS.search.member=n;else{TS.search.member=null;TS.search.from=null;var r=TS.utility.contenteditable.value(TS.search.input).trim();var i=r.match(TS.search.from_regex);if(i){$.each(i,function(e,t){r=$.trim(r.replace(t,""))});TS.utility.contenteditable.value(TS.search.input,r)}}TS.search.search_member_set_sig.dispatch()},searchAll:function t(n){if(!TS.client)clearTimeout(TS.search.widget.key_tim);TS.search.previous_query=TS.search.query;e=new Date;if(n)TS.search.query_string=_.trim(n);else TS.search.query_string=_.trim(TS.utility.contenteditable.value(TS.search.input));if(TS.boot_data.feature_more_texty_search){TS.search.query=TS.format.texty.convertContentsStringForSearch(TS.search.query_string);TS.search.query_string_for_display=TS.format.texty.convertContentsToStringForDisplay(TS.format.texty.convertContentsStringToContents(TS.search.query_string))}else{TS.search.query=TS.search.query_string;TS.search.query_string_for_display=TS.search.query_string}if(TS.search.query_string)TS.search.startSearchTimer(TS.search.query,TS.search.query_string,TS.search.per_page,TS.search.onSearchAll);else{TS.search.view.updateOptions();if(TS.client)TS.search.autocomplete.stopSpinner();else TS.search.widget.stopSpinner()}},onSearchAll:function e(t,n,r){if("1"===TS.qs_args.force_search_fail){window.failed_once=true;t=false;n={ok:false,error:"solr_failed"}}if(!t){var i=n&&n.error?n.error:"unknown_error";if(!n)n={ok:false,error:i};n.query=n.query||r.query;n.messages=n.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]};n.files=n.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(r.query!==TS.search.query)if(!TS.search.results[r.query]||!TS.search.results[r.query].error)return;TS.search.last_search_query=r.query;if(TS.client)TS.search.upsertFiles(n);TS.search.expandChannelsAndCheckForMsgsInModel(n);if(1===r.page){TS.search.results[r.query]=n;TS.search.results[r.query]._time_of_search=Date.now();TS.search.all_search_results_fetched_sig.dispatch(n,r);TS.search.getNextPageOfSearchResults(r.query,r.query_string,2)}else{var a=TS.search.results[r.query];if(a.messages.matches)n.messages.matches=a.messages.matches.concat(n.messages.matches);if(a.files.matches)n.files.matches=a.files.matches.concat(n.files.matches);TS.search.results[r.query]=n;TS.search.all_search_results_fetched_sig.dispatch(n,r)}},searchSuggest:function e(t){TS.api.call("search.autocomplete",{query:t},TS.search.onSearchSuggest)},onSearchSuggest:function e(t,n,r){if(!TS.client)if(TS.search.widget.suppress_suggestions){TS.search.widget.suppress_suggestions=false;return}if(!t)return;TS.search.suggestions=[];if(n.suggestions[0]===TS.search.query&&1===n.suggestions.length)TS.search.suggestions=[];else if(TS.boot_data.feature_more_texty_search){var i=/<@([^>]+)>/gi;var a=[];n.suggestions.forEach(function(e){e.replace(i,function(e,t){a.push(t)})});a=_.uniq(a);TS.members.ensureMembersArePresent(a).then(function(){for(var e=0;e<n.suggestions.length;e+=1){var t=n.suggestions[e];t=t.replace(i,function(e,t){var n=TS.members.getMemberById(t);if(n)return TS.format.texty.getMemberAsContentsString(n);return e});TS.search.suggestions[e]={value:t,highlighted:TS.search.highlightSuggestion(_.escape(t))};n.suggestions[e]=t}TS.search.autosuggest_search_results_fetched_sig.dispatch(n,r)})}else $.each(n.suggestions,function(e,t){TS.search.suggestions[e]={value:t,highlighted:TS.search.highlightSuggestion(_.escape(t))}});if(!TS.boot_data.feature_more_texty_search)TS.search.autosuggest_search_results_fetched_sig.dispatch(n,r)},highlightSuggestion:function e(t){var n=TS.utility.contenteditable.value(TS.search.input);var r=new RegExp("("+TS.utility.preg_quote(n)+")","gi");var i=t.replace(r,"<b>$1</b>");return i},expandChannelsAndCheckForMsgsInMatch:function e(t){var i;var a=t.channel.id;var s;r(t,a);n.forEach(function(e){if(!t[e])return;r(t[e],a)});s=TS.rxns.getExistingRxnsByKey(t._rxn_key);if(s&&!t.reactions)TS.warn("msg:"+t.ts+" has reactions in local model, but we got an object in search results that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);i=TS.shared.getModelObById(a);if(i){if("im"===t.type&&!TS.ims.isImWithDeletedMember(i))t.im_exists=true;if(i.msgs)t.is_loaded=!!TS.utility.msgs.getMsg(t.ts,i.msgs);else if(TS.client)TS.warn(i.id+" has no msgs");t.channel=i;if(!t.permalink)t.permalink=TS.utility.msgs.constructMsgPermalink(i,t.ts)}},expandChannelsAndCheckForMsgsInModel:function e(t){var n;var r;if(!t.messages||!t.messages.matches)return;for(r=0;r<t.messages.matches.length;r+=1){n=t.messages.matches[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}if(t.messages.modules&&t.messages.modules.score){for(r=0;r<t.messages.modules.score.matches.length;r+=1){n=t.messages.modules.score.matches[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}if(t.messages.modules.score.top_results)for(r=0;r<t.messages.modules.score.top_results.length;r+=1){n=t.messages.modules.score.top_results[r];if(!n)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(n)}}},upsertFiles:function e(t){if(!t.files||!t.files.matches)return;for(var n=0;n<t.files.matches.length;n+=1){if(t.files.matches[n].preview){t.files.matches[n].preview_search=t.files.matches[n].preview;delete t.files.matches[n].preview}t.files.matches[n]=TS.files.upsertFile(t.files.matches[n]).file}},getResultsByQuery:function e(t){return TS.search.results[t]},getMatchByQueryAndTs:function e(t,n){return TS.search.getMatchByQueryByThings(t,n)},getMatchByQueryAndChannelAndTs:function e(t,n,r){return TS.search.getMatchByQueryByThings(t,r,n)},getMatchByQueryAndChannelAndTsAndModule:function e(t,n,r,i,a){var s=TS.search.getResultsByQuery(n);if(!s){TS.error("WTF no results?");return null}if(!s.messages.modules){TS.error("WTF no results.messages.modules?");return null}if(!s.messages.modules[a])TS.error("WTF no results.messages.modules."+a+"?");var o;for(var l=0;l<s.messages.modules[a].top_results.length;l+=1){o=s.messages.modules[a].top_results[l];if(!o){TS.error("WTF no match?");continue}if((!r||o.channel.id===r)&&o.ts===i){if(t)return{match:o,index:l};return o}}return null},getMatchByQueryByThings:function e(t,n,r){var i=TS.search.getResultsByQuery(t);if(!i){TS.error("WTF no results?");return null}return TS.search.getMatchFromResultsByThings(true,i,n,r)},getMatchFromResultsByThings:function e(t,n,r,i){if(!n){TS.error("WTF no results?");return null}if(!n.messages){TS.error("WTF no results.messages?");return null}if(!n.messages.matches){TS.error("WTF no results.messages.matches?");return null}var a;for(var s=0;s<n.messages.matches.length;s+=1){a=n.messages.matches[s];if(!a){TS.error("WTF no match?");continue}if((!i||a.channel.id===i)&&a.ts===r){if(t)return{match:a,index:s};return a}}return null},truncateQuery:function e(t){if(t.length>TS.search.search_query_max_length)return t.substring(0,TS.search.search_query_max_length);return t},resetSearchOptions:function e(){TS.search.channel=null;TS.search.group=null;TS.search.im=null;TS.search.member=null;TS.search.from=null;TS.search.searchAll()},saveSearch:function e(t,n){if(!t.terms)return;t.terms=$.trim(t.terms);if(TS.search.keyword_modifier_pair_regex.test(t.terms))return;TS.api.call("search.save",t,n)},separateMessagesAndFiles:function e(){return!!TS.client},setInputVal:function e(t){TS.utility.contenteditable.value(TS.search.input,t);TS.utility.contenteditable.focus(TS.search.input)},submitSearch:function e(){TS.search.input.closest("form").trigger("submit")},searchSessionExpired:function n(){return e&&Date.now()-e>t},debugQuery:function e(t,n){var r="/mc/search_eval_query.php?team_id="+t+"&user_id="+n+"&query="+encodeURIComponent(TS.search.query);window.open(r)},debugFileQuery:function e(t,n){var r="/mc/search_eval_file_query.php?team_id="+t+"&user_id="+n+"&query="+encodeURIComponent(TS.search.query);window.open(r)},getSort:function e(t){return"search.files"===t?"auto":TS.search.sort},sliFileSearchIsEnabled:function e(){return TS.boot_data.feature_sli_file_search&&"sli_file_search"===TS.boot_data.sli_file_search}});var e;var t=3e5;var n=["next","next_2","previous","previous_2"];var r=function e(t,n){t._rxn_key=TS.rxns.getRxnKey("message",t.ts,n);TS.utility.msgs.processAttachments(t.attachments);if(t.extracts&&t.extracts.length)t.extracts.forEach(function(e){e._rxn_key=t._rxn_key})};var i;var a=function e(t,n,r,i,a,s){var o={query:TS.emoji.maybeGetCanonicalEmojiString(n),query_string:r,highlight:true,count:i,types:[TS.search.filetype],sort:TS.search.getSort(t),page:a||1,extracts:1,extra_message_data:1,max_extract_len:150,highlight_attachments:1,active_cid:TS.model.active_cid,top_results:1,experts:1,locale:TS.i18n.localeOrPseudo()};if("search.all"===t)o.no_posts=1;if("search.files"!==t)o.more_matches=true;if(TS.boot_data.page_needs_enterprise&&TS.boot_data.enterprise_api_token){o.enterprise_token=TS.boot_data.enterprise_api_token;if("search.messages"===t)o.team=TS.model.team.id}if(TS.features.isEnabled("search_skip_context"))o.skip_context=1;TS.api.call(t,o,s)};var s=function e(t,n,r,i){if(!t||!n.messages){var a=n&&n.error?n.error:"unknown_error";if(!n)n={ok:false,error:a};n.query=n.query||r.query;n.messages=n.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}n.query=TS.emoji.maybeGetLocalizedEmojiString(n.query);r.query=TS.emoji.maybeGetLocalizedEmojiString(r.query);if(r.query!==TS.search.query)if(!TS.search.results[r.query]||!TS.search.results[r.query].error)return;if(TS.search.last_search_query!==r.query)delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=r.query;TS.search.last_request_id=i;TS.search.expandChannelsAndCheckForMsgsInModel(n);var s=TS.search.results[r.query];if(1==r.page){if(!s){TS.search.results[r.query]=n;s=n}else $.extend(s,n);s.initial_messages_total=n.messages.total;s.messages.pages=[{start:0,count:_.get(n.messages,"matches.length",0)}];if(_.has(s,"messages.modules.score.matches"))s.messages.modules.score.pages=[{start:0,count:_.get(s.messages.modules.score,"matches.length",0)}];s._time_of_search=Date.now();TS.search.message_search_results_fetched_sig.dispatch(s,r)}else{if(s.messages&&s.messages.matches){n.messages.matches=s.messages.matches.concat(n.messages.matches);n.messages.pages=s.messages.pages.concat([{start:s.messages.matches.length,count:_.get(n.messages,"matches.length",0)}])}$.extend(s,n);TS.search.message_search_results_fetched_sig.dispatch(s,r)}};var o=function e(t,n,r,i){if(!t||!n.files){var a=n&&n.error?n.error:"unknown_error";if(!n)n={ok:false,error:a};n.query=n.query||r.query;n.files=n.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}n.query=TS.emoji.maybeGetLocalizedEmojiString(n.query);r.query=TS.emoji.maybeGetLocalizedEmojiString(r.query);if(r.query!==TS.search.query)if(!TS.search.results[r.query]||!TS.search.results[r.query].error)return;if(TS.search.last_search_query!==r.query)delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=r.query;TS.search.last_files_request_id=i;if(TS.client)TS.search.upsertFiles(n);var s=TS.search.results[r.query];if(1===r.page){if(!s){TS.search.results[r.query]=n;s=n}else $.extend(s,n);s.initial_files_total=n.files.total;s._time_of_search=Date.now();TS.search.file_search_results_fetched_sig.dispatch(s,r)}else{if(s.files&&s.files.matches)n.files.matches=s.files.matches.concat(n.files.matches);$.extend(s,n);TS.search.file_search_results_fetched_sig.dispatch(s,r)}};var l=function e(){var t=false;var n=false;var r=function e(){if(t&&n)TS.search.all_search_results_fetched_sig.dispatch()};return{msgs:function e(){t=true;s.apply(this,arguments);r()},files:function e(){n=true;o.apply(this,arguments);r()}}};var u=function e(t){TS.files.updateFileListItem(t,$("#search_results_items"))}})()},4238:function(e,t){(function(){"use strict";TS.registerModule("ms",{fast_reconnects_enabled:true,calling_test_fast_reconnect:false,last_pong_time:0,sent_map:{},connected_sig:new signals.Signal,disconnected_sig:new signals.Signal,trouble_sig:new signals.Signal,reconnecting_sig:new signals.Signal,on_msg_sig:new signals.Signal,reconnect_requested_sig:new signals.Signal,errors:{BAD_TOKEN:1,CONNECTION_TROUBLE:1006,RATE_LIMIT:-1,UNKNOWN:0},onStart:function e(){if(!window.WebSocket){window.WebSocket=window.MozWebSocket;if(!window.WebSocket){alert(TS.i18n.t("Your browser does not support WebSockets.","ms")());return}}Ne=TS.boot_data.ws_refactor_bucket&&TS.utility.enableFeatureForUser(1);V(TS.model.ui.is_window_focused||false);TS.ui.window_focus_changed_sig.add(V);setInterval(function(){if(!TS.model.ms_connected)return;if(TS.model.rtm_start_throttler<1)return;TS.model.rtm_start_throttler-=1},6e4);var t=1;m=TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(t);f=Date.now();if(!TS.boot_data.feature_tinyspeck){ke=_.noop;xe=_.noop;we=_.noop}if(TS.client&&TS.client.stats){TS.client.stats.start_collecting_sig.add(function(){K=TS.boot_data.feature_queue_metrics&&TS.utility.enableFeatureForUser(Re)});TS.client.stats.stop_collecting_sig.add(function(){K=false})}},shouldLogFlowStats:function e(){return Ne},isAsleep:function t(){return e},test:function e(){return{_createNewSocket:Me}},send:function e(t,n,r){H+=1;t.id=H;var i=32768;var a=JSON.stringify(t);if(a.length>i){var s=t.subtype?t.type+"."+t.subtype:t.type;var o=new Error("Unable to send "+s+" message to MS because it exceeds "+i+" bytes");TS.console.logError(o,"too_big_to_send");var l=false;n(l,{error:"too_big_to_send"});return}TS.ms.sent_map[t.id.toString()]={msg:t,handler:n,ts:Date.now(),temp_ts:r};if("ping"===t.type||"pong"===t.type){if(TS.has_pri[Le]){TS.log(Le,"MS sending "+t.type);TS.dir(Le,t)}}else{TS.model.last_net_send=Date.now();if(TS.has_pri[Le]){TS.log(Le,"sending "+t.type);TS.dir(Le,t)}}if(!B){var u=new Error("TS.ms.send called when we have no _websocket! This is a programming error.");TS.error(u);TS.info("Some context for debugging:");TS.info("TS.model.calling_rtm_start="+TS.model.calling_rtm_start);TS.info("TS.model.ms_connected="+TS.model.ms_connected);TS.info("TS.model.ms_connecting="+TS.model.ms_connecting);TS.console.logStackTrace("TS.ms.sendMsg(...)");throw u}if(TS.client&&TS.client.stats.isEnabled()&&"message"===t.type){TS.metrics.mark("user_send_message_"+H);TS.metrics.mark("user_message_unprocessed_"+H)}B.send(a);return t.id},handleMsg:function e(t){var n=t.reply_to&&!("ok"in t)&&"message"===t.type;var r;if(t.reply_to){if(t.reply_to.toString()in TS.ms.sent_map)r=Ee(t);else if(!n)TS.error('received msg "'+t.reply_to+'" with type "'+t.type+'" but we have no record of it in sent_map')}else if(t.event_ts&&!t._from_evt_log)TS.ms.storeLastEventTS(t.event_ts,"handleMsg");var i=function e(){if(d){d=false;TS.info("Got pong from MS")}TS.ms.last_pong_time=Date.now();$=false;ke()};if("ping"===t.type||"pong"===t.type){if(TS.has_pri[Le])if(r&&r.ts)TS.log(Le,"MS msg "+t.type+" time: "+(Date.now()-r.ts)+" ms");else TS.log(Le,"MS msg "+t.type+" time: "+Date.now()+" ms (no sent.ts)");if(m)if(Date.now()-f>p){TS.metrics.measureAndClear("ms_ping_pong_latency","ms_ping_sent");f=Date.now()}else TS.metrics.clearMarks("ms_ping_sent");i();if(TS.has_pri[Le])TS.dir(Le,t)}else{var a=Date.now()-TS.ms.last_pong_time;if($&&a>v){if(TS.has_pri[Le])TS.log(Le,"MS msg being used as an implicit pong due to excessive delay ("+a+"ms)");i();if(m)TS.metrics.clearMarks("ms_ping_sent")}xe(t);if(TS.has_pri[Le]){if(r){var s=t.type||t.SENT_MSG.type||"";TS.log(Le,"msg "+(s?'"'+s+'" ':"")+"rsp time "+(Date.now()-r.ts)+"ms")}else TS.log(Le,'msg "'+t.type+'"');TS.dir(Le,t)}}if("error"===t.type)ue(t);else if("hello"===t.type)de(t);else if(!t.reply_to){if(K)TS.metrics.mark("ms_queue_processing_start");TS.ms.on_msg_sig.dispatch(t);if(K)TS.metrics.measureAndClear("ms_queue_starvation_time","ms_queue_processing_start")}if(r){if(!t.ok&&"flannel"===t.type)t.ok=true;if(!t.ok)t.error=t.error||{code:TS.ms.errors.UNKNOWN,msg:"unknown error (not specified by MS)"};if(n)t.ok=true;if(r.handler)r.handler(t.ok,t);if(TS.client&&TS.client.stats.isEnabled()&&t.SENT_MSG&&"message"===t.SENT_MSG.type)TS.metrics.measureAndClear("message_server_reply_and_render","user_message_unprocessed_"+t.reply_to)}},storeLastEventTS:function e(t,n){if(!t)return;var r=z||TS.storage.fetchLastEventTS();if(r&&t<=r)return;if(!n)n="???";q=n+" at "+Date.now()/1e3;z=t;TS.storage.storeLastEventTS(t)},onFailure:function n(r){TS.warn("TS.ms.onFailure reason_str:"+r);if(r)re("You got disconnected, so here are some details:\n>>>"+r);$=false;clearInterval(h);clearInterval(S);c=false;TS.info("Deprecating current socket in onFailure with reason: "+r);ie(4003,"Disconnecting due to failure. Reason: "+r);if(s){TS.ms.logConnectionFlow("on_goodbye_failure");t=0}else if(TS.model.ms_connected){TS.info("Disconnected from MS, TS.model.rtm_start_throttler:"+TS.model.rtm_start_throttler);TS.ms.logConnectionFlow("on_connected_failure");t=100}else{TS.ms.logConnectionFlow("on_notconnected_failure");t=2*(t+1e3);var i=t;if(t>4e3)t=_.random(i,i+i/2);t=Math.min(t,3e5)}if(!ce())if(TS.model.rtm_start_throttler>5){var a=2e3*TS.model.rtm_start_throttler;if(t<a){TS.info("because TS.model.rtm_start_throttler:"+TS.model.rtm_start_throttler+" we are increasing time until next login call");t=a}}if(TS.model.ms_connected){TS.model.ms_connected=false;TS.ms.disconnected_sig.dispatch()}if(e){TS.warn("NOT doing startReconnection(), we are asleep");return}if(TS.api.isPaused()){TS.warn("NOT doing startReconnection() because TS.api.isPaused(), but will try after it unpauses");TS.api.unpaused_sig.add(function(){TS.info("MS: starting reconnection after socket failure, having waited for API to unpause");TS.ms.startReconnection()});return}TS.info("MS: starting reconnection after socket failure");TS.ms.startReconnection()},startReconnection:function e(){n=Date.now()+t;if(t){TS.console.logStackTrace("Attempting to reconnect in "+t+"ms");clearTimeout(O);O=setTimeout(function(){if(!TS.model.window_unloading)TS.ms.startReconnectionImmediately()},t)}else{TS.console.logStackTrace("Attempting to reconnect immediately");TS.ms.startReconnectionImmediately()}clearInterval(E);E=setInterval(ae,F);ae()},startReconnectionImmediately:function e(){TS.info("MS wants to reconnect because of a start call");clearTimeout(O);if(r&&ce())TS.ms.fastReconnect();else{if(r){_e();r=false}TS.ms.reconnect_requested_sig.dispatch()}},manualReconnectNow:function e(){TS.ms.logConnectionFlow("manual_reconnect");clearTimeout(O);clearInterval(E);clearTimeout(b);j=0;if(!TS.model.window_unloading){TS.info("MS wants to reconnect because of a user interaction");TS.ms.reconnect_requested_sig.dispatch();TS.ms.reconnecting_sig.dispatch(0)}},disconnect:function e(t,n){if(B&&B.readyState!=WebSocket.CLOSED){s=!!t;TS.ms.logConnectionFlow("disconnect");if(TS.model.ms_connected)TS.info("TS.ms.disconnect called; closing the socket");else TS.info("TS.ms.disconnect called while we have a WebSocket but are not connected; closing the socket");var r="Disconnecting because TS.ms.disconnect was called. was_requested_by_server = "+!!t;if(_.isString(n)&&n.length){r=n+" was_requested_by_server = "+!!t;r=r.slice(0,120)}B.close(4005,r);TS.model.ms_connected=false;TS.ms.disconnected_sig.dispatch()}else TS.warn("TS.ms.disconnect called, but _websocket="+B+" TS.model.ms_connected="+TS.model.ms_connected)},logConnectionFlow:function e(t){var n=TS.model.ms_conn_log;var r=Date.now();n.push({name:t,time:r,delta:n.length?r-n[n.length-1].time:0});if(TS.has_pri[Le])TS.log(Le,"logConnectionFlow "+t+" "+n[n.length-1].delta)},getConnectionFlowLog:function e(){var t=TS.model.ms_conn_log;var n=[];for(var r=0;r<t.length;r+=1)n.push(encodeURIComponent(t[r].name+"-"+(t[r].delta?Math.round(t[r].delta/1e3):0)+"-"+Math.round(t[r].time/1e3)));if(TS.has_pri[Le])TS.dir(Le,TS.model.ms_conn_log);var i="_x_connection_log="+n.join(",");return i},connectImmediately:function e(t){if(!t)t=TS.model.team.url;if(!t)throw new Error("No WebSocket URL for us to connect to! 😱");t=be(t);Be(t);Ae()},connectProvisionallyAndFetchRtmStart:function e(t){if(!t)t=TS.model.team.url;t=be(t);Be(t);if(Ne)TS.metrics.count("ms_flow_connect_prov_8");return Ie()},hasProvisionalConnection:function e(){return!!ge},hasOpenWebSocket:function e(){return _.get(B,"readyState")==WebSocket.OPEN},promiseToHaveOpenWebSocket:function e(){if(TS.ms.hasOpenWebSocket())return Promise.resolve();if(!l)l=new Promise(function(e){u=e});return l},finalizeProvisionalConnection:function e(){if(Ne)TS.metrics.count("ms_flow_finalize_prov_8");return Oe()},fastReconnect:function e(){TS.info("Trying fast reconnect");TS.ms.calling_test_fast_reconnect=true;TS.api.callImmediately("rtm.checkFastReconnect").then(function(e){var t=e.data;if(TS.reloadIfVersionsChanged(t))return;if(Ne)TS.metrics.count("ms_flow_fast_reconnect_8");TS.ms.connectImmediately(U)},function(e){var t=e.data;var n=t&&t.error;if(n&&"_http_error"!==n){_e();r=false}TS.ms.onFailure("rtm.checkFastReconnect returned not-OK. error: "+n)}).finally(function(){TS.ms.calling_test_fast_reconnect=false;_e()})},setReconnectUrl:function e(t){U=t;N=Date.now()},getReconnectUrl:function e(){return U},sleep:function t(){if(e)return;if(!TS.model.ms_connected)return;e=true;var n=false;TS.ms.disconnect(n,"Disconnecting because client is going to sleep")},wake:function t(){if(!e)return;if(B){ne(null,"Forcing disconnect because we are trying to wake up");ie(4e3,"Forcing a disconnect of an old socket while waking up")}a=void 0;s=void 0;e=false;TS.info("MS: starting reconnection after waking");TS.ms.startReconnection()}});var e=false;var t=0;var n=0;var r=false;var i=0;var a;var s;var o=new signals.Signal;var l;var u;var d;var c=false;var m;var f;var p=3e5;var h=0;var g=3e3;var S=0;var T=1e4;var v=7e3;var b=0;var y=0;var w=1e4;var k=2e4;var x=0;var C=3e4;var M=9e4;var I=0;var A=5e3;var E=0;var F=1e3;var O=0;var B=null;var H=0;var $=false;var D=0;var P=3e5;var j=0;var R=null;var L=2e3;var U=null;var N=null;var G=false;var W=3e5;var q;var z;var K;var V=function e(t){if(t)D=6e4;else D=12e4;D+=T;if(TS.has_pri[Le])TS.log(Le,"MS _pong_timeout_ms set to:"+D+" has_focus:"+t)};var Y=function e(t){var n=t.data;if(0===n.charCodeAt(n.length-1)){var r=n.indexOf("\0");if(r>=0)n=n.slice(0,r)}if(TS._count_bytes_received)TS._bytes_received+=n.length;var i=JSON.parse(n);TS.ms.handleMsg(i)};var J=function e(){clearTimeout(b);j=0;je();if(r){_e();r=false;TS.metrics.measureAndClear("ms_fast_reconnect","ms_websocket_create");G=true}else{TS.metrics.measureAndClear("ms_connect","ms_websocket_create");G=false}if(Se)TS.ms.send({type:"mp_command",subtype:"login",url:be(TS.model.team.url)});He();B.onmessage=Y;TS.model.ms_conn_log.length=0;TS.info("MS WS connected!");TS.ms.logConnectionFlow("on_connect");clearTimeout(x);x=setTimeout(se,C)};var Q=function e(){if(TS.client)TS.shared.maybeFetchHistoryAndThenCheckConsistency(TS.shared.getActiveModelOb())};var X=function e(t){var n=t.args;var r=t.data;TS.error("_onEventLogError "+r);if(TS.client&&r&&"timestamp_too_old"===r.error){TS.storage.completelyEmptyAllStorageAndReset();var i="TS.reload() after a TS.storage.completelyEmptyAllStorageAndReset() because data.error: <code>timestamp_too_old</code>";if(r.reason)i+=" data.reason: <code>"+r.reason+"</code>";if(n)delete n.token;try{i+=" args: <pre>"+JSON.stringify(n,null,"\t")+"</pre>"}catch(e){}if(TS.boot_data&&TS.boot_data.feature_tinyspeck)i+="<p><b>Tell #dhtml about this, please!</b></p>";setTimeout(function(){TS.reload(null,i)},1);return null}Q();return null};var Z=function e(t){var n=t.data;if(!n.events){TS.error("_onEventLogOK missing events");Q();return null}if(TS.client&&n.has_more){setTimeout(function(){TS.reload(null,"event log data.has_more: "+n.has_more+")")},1);return null}var r;var i=[];var a={};var s;var o=function e(t){t._from_evt_log=true;s=null;r=r||t.event_ts;if("file_change"===t.type&&t.file&&t.file.id)s=t.type+t.file.id;else if("user_change"===t.type&&t.user&&t.user.id)s=t.type+t.user.id;else if("emoji_changed"===t.type)s=t.type;else if("channel_history_changed"===t.type&&t.channel){TS.info("eventlog: channel_history_changed for "+t.channel);s=t.type+t.channel}else if("group_history_changed"===t.type&&t.channel){TS.info("eventlog: group_history_changed for "+t.channel);s=t.type+t.channel}else if("im_history_changed"===t.type&&t.channel){TS.info("eventlog: im_history_changed for "+t.channel);s=t.type+t.channel}if(s){if(a[s])return;a[s]=true;i.unshift(t)}else if("slack_broadcast"===t.type){if(!t.reload)return;var n=R;if(n){if(!n.force_reload&&t.force_reload)R=t}else R=t}else i.unshift(t)};_.forEachRight(n.events,o);i.forEach(function(e){try{TS.ms.handleMsg(e)}catch(e){}});if(r)TS.ms.storeLastEventTS(r,"eventlog");if(R){try{TS.ms.handleMsg(R)}catch(e){}R=null}Q();return null};var ee=function e(){if(!$)return;var t=Date.now()-TS.ms.last_pong_time;if(TS.has_pri[Le])TS.log(Le,"MS since_last_pong_ms:"+t+" pong_timeout_ms:"+D);if(t<D)return;if(TS.boot_data.feature_no_pong_timeout)return;TS.metrics.count("ms_pong_timeout");TS.metrics.store("ms_time_since_pong",t);TS.warn("since_last_pong_ms too long! "+t+" > "+D);we();ke();TS.warn("calling disconnect(), expect to get an onDisconnect() callback");TS.ms.logConnectionFlow("on_ping_timeout");if(Ne)TS.metrics.count("ms_flow_trouble_connecting_8");TS.ms.trouble_sig.dispatch();$=false;re("You are on team Tiny Speck, so here are some pong details:\n>>>since_last_pong_ms too long! "+t+" > "+D+" ... calling disconnect(), expect to get an onDisconnect() callback");try{var n=false;TS.ms.disconnect(n,"Disconnecting because of pong timeout");clearTimeout(I);I=setTimeout(function(){TS.info("called disconnect, no onDisconnect callback happened in "+A+"ms, so calling _onDisconnect() manually now");ne(null,"since_last_pong_ms too long! then called disconnect, but no onDisconnect callback happened in "+A+"ms, so calling _onDisconnect() manually now")},A)}catch(e){TS.info("since_last_pong_ms too long! then an error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now");TS.warn(e);ne(null,"error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now")}};var te=function e(){TS.ms.send({type:"ping"});if($&&c){TS.info("Sent another ping to MS; prior ping was never replied to");d=true}if(m)TS.metrics.mark("ms_ping_sent");$=true;c=true};var ne=function n(i,o){if(!e)a=a||performance.now();if(!o&&s)o="disconnected after a goodbye message";o=o||"_onDisconnect called with event:"+i;TS.info("MS WS disconnected");TS.ms.logConnectionFlow("on_disconnect");clearTimeout(I);clearTimeout(x);clearTimeout(b);Se=false;ge=false;Pe();if(!i||1e3!==i.code&&1005!==i.code&&i.code<4e3)if(Ne)TS.metrics.count("ms_flow_unexpected_close_wider_variant_8");if(i){TS.info("_onDisconnect event.code:"+i.code);if(i.code==TS.ms.errors.CONNECTION_TROUBLE){TS.info("TS.ms: This was an unexpected WebSocket disconnection");if(Ne)TS.metrics.count("ms_flow_unexpected_close_8");if(t){TS.info("TS.ms: resetting ms_reconnect delay");t=0}if(TS.model.rtm_start_throttler){TS.info("TS.ms: resetting rtm.start throttler");TS.model.rtm_start_throttler=0}}}else TS.info("no event");if(ce())r=true;TS.ms.onFailure(o)};var re=function e(t){};var ie=function e(t,n){TS.model.ms_connecting=false;if(B){B.onclose=null;B.onerror=null;B.onmessage=null;B.onopen=null;try{if(n)n=n.slice(0,120);B.close(t,n)}catch(e){TS.info("Problem while deprecating current socket: "+e)}var r=B;B=void 0;o.dispatch(r)}ge=false;Pe()};var ae=function e(){var t=n-Date.now();var r=Math.round(t/1e3);if(r>=0)TS.ms.reconnecting_sig.dispatch(r);if(TS.model.window_unloading)clearInterval(E)};var se=function e(){var t="socket received no hello msg "+C+"ms after connection";TS.warn(t);TS.ms.logConnectionFlow("_onHelloTimeout");TS.ms.onFailure(t)};var oe=function e(){j+=1;var t="socket not connected "+y+"ms after creation. _connect_timeout_count:"+j;TS.warn(t);TS.ms.logConnectionFlow("_onConnectTimeout");if(3==j){TS.client.showConnectionTroubleDialog();return}else if(2==j)if(window.WEB_SOCKET_USING_FLASH);else if(TS.model.is_chrome_desktop){w=2e4;return}TS.ms.onFailure(t)};var le=function e(t){var n="";if(t){if(t.name)n+=" e.name="+t.name;if(t.message)n+=" e.message="+t.message;if(t.data)n+=" e.data="+t.data}TS.warn("_onError err_str: "+n);TS.dir(0,t)};var ue=function e(t){if(t.error)if(t.error.code==TS.ms.errors.BAD_TOKEN){TS.ms.logConnectionFlow("msg_error_code_1");_e();r=false}else{if(t.error.code==TS.ms.errors.RATE_LIMIT){TS.client.activateMsgRateLimit({notify_user:true});TS.ms.connected_sig.addOnce(TS.client.deactivateMsgRateLimit)}TS.info("_onErrorMsg imsg.error.msg: "+t.error.msg+", imsg.error.code: "+t.error.code);TS.ms.onFailure("_onErrorMsg imsg.error: "+JSON.stringify(t.error))}else TS.info("_onErrorMsg imsg: "+(t?JSON.stringify(t):"no imsg?"))};var de=function e(n){clearTimeout(x);var r=Date.now()-TS.ms.last_pong_time;TS.info("Hello msg recvd, since_last_pong_ms:"+r);if(n)TS.info("host_id: "+_.get(n,"host_id")+", server_version: "+_.get(n,"server_version"));TS.ms.logConnectionFlow("on_hello");if(TS.client&&r>P&&!G)TS.client.ui.maybePromptForSetActive();t=0;clearInterval(E);$=true;TS.ms.last_pong_time=Date.now();clearInterval(h);h=setInterval(ee,g);clearInterval(S);S=setInterval(te,T);TS.model.ms_connecting=false;TS.model.ms_connected=true;var a=z||TS.storage.fetchLastEventTS();var s=!!i;if(s)if(a&&!G){TS.info("calling eventlog.history with start:"+a+" (from TS.storage.fetchLastEventTS())");if(q)TS.info("last_event_ts is from "+q);TS.api.callImmediately("eventlog.history",{start:a,count:L,no_payload_if_has_more:true,batch_deleted_files:true}).then(Z).catch(X).finally(_.noop)}else if(TS.client)TS.shared.maybeFetchHistoryAndThenCheckConsistency(TS.shared.getActiveModelOb());TS.ms.connected_sig.dispatch(G);i+=1;te()};var ce=function e(){if(!TS.ms.fast_reconnects_enabled)return false;if(!U)return false;if(!TS.utility.url.isValidSlackWebSocketUrl(U))return false;var t=Date.now();var n=t-N;if(n<W)return true;_e();r=false;return false};var _e=function e(){U=null;N=null};var me;var fe;var pe;var he;var ge;var Se;var Te=function e(t){var n=[];var r=function e(){if("function"===typeof t){var r=t.apply(this,arguments);if(false===r)return}n.push({this_arg:this,args:arguments})};r.replay=function(e){n.forEach(function(t){e.apply(t.this_arg,t.args)});n.length=0};return r};var ve=function e(){y=window.WEB_SOCKET_USING_FLASH?k:w;clearTimeout(b);b=setTimeout(oe,y)};var be=function e(t){t=TS.utility.url.setUrlQueryStringValue(t,"version_uid",TS.boot_data.version_uid);t=TS.utility.appendLogToUrlWithLimit(t,TS.ms.getConnectionFlowLog());t=TS.utility.url.setUrlQueryStringValue(t,"batch_presence_aware",1);return t};var ye=[];var we=function e(){TS.info("Previous imsg events:\n========"+ye.join("\n")+"========")};var ke=function e(){ye.length=0};var xe=function e(t){t=t.SENT_MSG||t;var n=t.subtype?t.type+"."+t.subtype:t.type;ye.push(TS.makeLogDate()+n)};var Ce=function e(){TS.info("Finalizing provisional MS connection");if(B.readyState!=WebSocket.OPEN)ve();me.replay(J);fe.replay(ne);pe.replay(le);he.replay(Y);B.onopen=J;B.onclose=ne;B.onerror=le;me=void 0;fe=void 0;pe=void 0;he=void 0};var Me=function e(t){if(!TS.utility.url.isValidSlackWebSocketUrl(t)){TS.error("Tried to connect to a WebSocket URL that doesn’t look right; aborting");TS.ms.onFailure("Invalid WebSocket URL");return false}t=TS.utility.url.setUrlQueryStringValue(t,"flannel",1);t=TS.utility.url.setUrlQueryStringValue(t,"token",TS.boot_data.api_token);t=TS.utility.url.setUrlQueryStringValue(t,"no_annotations",1);if("dev"===TS.boot_data.version_ts&&TS.boot_data.should_use_flannel)t=TS.utility.url.setUrlQueryStringValue(t,"api_url",TS.boot_data.flannel_api_url);if(Fe())t=TS.utility.url.setUrlQueryStringValue(t,"canary",1);if(TS.has_pri[Ue])TS.log(Ue,"Connecting to Flannel..."+t);TS.ms.logConnectionFlow("connect");var n=t.replace(TS.boot_data.api_token,"REDACTED");TS.info("Connecting to: "+n);clearTimeout(b);TS.ms.last_url=t;TS.ms.last_start_ms=Date.now();TS.metrics.mark("ms_websocket_create");try{B=new WebSocket(t)}catch(e){TS.warn("failed to create new WebSocket");TS.error(e);TS.ms.onFailure("failed to create new WebSocket");return false}return true};var Ie=function e(){TS.info("Initializing provisional MS connection and fetching rtm.start over the socket");ge=true;var t=B;return new Promise(function(e,n){var r=function e(r){TS.warn("Giving up on rtm.start-over-MS attempt");clearTimeout(a);a=void 0;n(r);TS.ms.disconnected_sig.dispatch();o.remove(i);if(B&&B==t)ie(4001,"Deprecating socket because we are aborting an rtm start attempt")};var i=function e(n){if(n!==t){TS.warn("Received a call to abort RTM start attempt for a websocket that is not the current websocket, this should not be happening!");TS.info("current_websocket defined?",!!t,"recently_deprecated_socket defined?",!!n)}r(new Error("Socket was deprecated"))};o.addOnce(i);De();var a=setTimeout(function(){TS.warn("Provisional WebSocket timed out");r(new Error("Waited "+M+" ms for rtm.start response but didn’t get one"))},M);me=Te(He);fe=Te(function(){TS.warn("Provisional WebSocket got disconnected");r(new Error("WebSocket got disconnected"))});pe=Te(function(e){TS.warn("Provisional WebSocket encountered an error");var t=new Error("WebSocket got error");t.event=e;r(t)});he=Te(function(t){var n=JSON.parse(t.data);if("flannel"===n.type&&"user_query_response"===n.subtype){if(!n.reply_to){TS.error("Received a pre-connection Flannel query response without a reply_to field: "+t.data);return}else if(!TS.ms.sent_map[n.reply_to.toString()]){TS.error("Received a pre-connection Flannel query response for a query we did not send: "+t.data);return}var s=Ee(n);if(s&&_.isFunction(s.handler))s.handler(n.ok,n);return false}TS.info("Provisional WebSocket received a message of type "+n.type);if("hello"===n.type){clearTimeout(a);a=void 0;if(n.flannel&&n.start){var l=n.start;e(l);o.remove(i)}else r(new Error("`hello` imsg did not include rtm.start data"))}else if("error"===n.type){var u=JSON.stringify(n);TS.info('Provisional WebSocket "error" message: '+u);var d=new Error("WebSocket returned an error: "+u);d.data={error:_.get(n,"error.msg")};r(d)}});B.onclose=fe;B.onerror=pe;B.onmessage=he;B.onopen=me;setTimeout(function(){if(B&&B.readyState==WebSocket.CLOSED)r(new Error("WebSocket already closed; maybe internet is offline?"))},100)}).catch(function(e){TS.logError(e,"rtm-start-over-MS error","error on rtm start");throw e})};var Ae=function e(){B.onopen=J;B.onclose=ne;B.onerror=le;ve()};var Ee=function e(t){if(!t.reply_to)return;var n=TS.ms.sent_map[t.reply_to];if(!n)return;if(TS.client&&TS.client.stats.isEnabled()&&n.msg&&"message"===n.msg.type)TS.metrics.measureAndClear("message_server_reply","user_send_message_"+t.reply_to);t.SENT_MSG=n.msg;delete TS.ms.sent_map[t.reply_to];return n};var Fe=function e(){var t=_.get(TS,"model.prefs.flannel_server_pool",TS.boot_data.flannel_server_pool);if(!TS.boot_data.feature_tinyspeck&&!TS.boot_data.feature_flannel_use_canary_sometimes)t="production";switch(t){case"canary":return true;case"random":return 0==_.random(0,1);case"production":default:return false}};var Oe=function e(){Pe();if(ge&&!B){ge=false;TS.warn("Tried to finalize provisional connection while _did_make_provisional_connection flag is true, but there is no _websocket. This is a programming error.");return false}if(!ge){TS.warn("Tried to finalize provisional connection while _did_make_provisional_connection flag is false. This is a programming error.");return false}ge=false;Ce();return true};var Be=function e(t){if(B&&B.readyState==WebSocket.OPEN){TS.warn("TS.ms has an open WebSocket but we are trying to connect; TS.model.ms_connected = "+TS.model.ms_connected+"; TS.model.ms_connecting = "+TS.model.ms_connecting);throw new Error("TS.ms.connect called but we are already connected. This is a programming error.")}var n=Me(t);if(!n)throw new Error("Error creating WebSocket for URL "+t);TS.model.ms_connecting=true};var He=function e(){if(!u)return;u();l=void 0;u=void 0};var $e;var De=function e(){Pe();if(TS.qs_args.no_prov_timeout)return;$e=setTimeout(function(){if(ge){if(Ne)TS.metrics.count("ms_flow_prov_timeout_8");TS.warn("Giving up on provisional connection because no one ever finalized it");ie(4002,"Deprecating socket because the provisional connection was never finalized")}else TS.warn("Provisional connection timed out, but it does not look like we have a provisional connection")},6e4)};var Pe=function e(){if($e){clearTimeout($e);$e=void 0}};var je=function e(){if(a){var t=performance.now();var n=t-a;var r=s?"ms_reconnect_after_goodbye_duration":"ms_reconnect_other_duration";TS.metrics.store(r,n)}a=void 0;s=void 0};var Re=50;var Le=2;var Ue=1989;var Ne=false})()},4239:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("ms.msg_handlers",{onStart:function e(){E=window.performance&&TS.boot_data&&TS.boot_data.feature_ms_msg_handlers_profiling;if(TS.client&&TS.client.stats){TS.client.stats.start_collecting_sig.add(function(){r=TS.boot_data.feature_queue_metrics&&TS.utility.enableFeatureForUser(N);i=TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(G);L.enableStatsCollecting()});TS.client.stats.stop_collecting_sig.add(function(){r=false;i=false;L.disableStatsCollecting()})}if(TS.web&&!TS.web.space)return;if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.socketMessageReceivedSig.add(TS.ms.msg_handlers.msgReceived);TS.interop.Eventlog.messageReceivedSig.add(TS.ms.msg_handlers.msgReceived);TS.interop.SocketManager.connectedSig.add(function(){if(!TS.boot_data.feature_tinyspeck)return;if(c)clearTimeout(c);c=setTimeout(function(){if(!TS.interop.SocketManager.isConnected())return;if(u.length<50)return;var e=u[0];setTimeout(function(){if(u[0]!==e)return;var t=_.compact([u[0].type,u[0].subtype]).join(".");TS.warn("Looks like our msg_handlers queue might be wedged (it has "+u.length+" items in it, first one of type "+t+"). Kicking it.");var n=new Error("msg_handlers_queue_stuck_v2");TS.console.logError(n,"size = "+u.length+", first item = "+t)},1e4)},3e4)})}else TS.ms.on_msg_sig.add(TS.ms.msg_handlers.msgReceived)},debugGetQueueSize:function e(){return u.length},test:function e(){var t={};Object.defineProperty(t,"_is_batch_upserting_users",{get:function e(){return s},set:function e(t){s=t}});return t},msgReceivedFromParentWindow:function e(t){TS.ms.msg_handlers.msgReceived(t)},msgReceived:function e(t){if(E){j+=1;if(!R)R=Date.now()}if(t.reply_to)return;if(!TS.ms.msg_handlers[t.type])return;f(t)},message:function e(t){if(!TS.client)return;if(TS.has_pri[W])TS.log(W,"recved message type "+t.type);if(t.is_ephemeral&&!t.ts)t.ts=TS.interop.datetime.makeTsStamp();var n;var r="subtype__"+t.subtype;if(r in TS.ms.msg_handlers){if(TS.boot_data.feature_channel_eventlog_client){if("message_changed"===t.subtype||"message_deleted"===t.subtype||"channel_history_changed"===t.subtype||"group_history_changed"===t.subtype||"im_history_changed"===t.subtype||"mpim_history_changed"===t.subtype||"message_replied"===t.subtype){t.type=t.subtype;delete t.subtype;if(E)n=L.start(t.type);TS.ms.msg_handlers[t.type](t);if(n)n();return}if(t.hidden){TS.console.error(2,"WE SHOULD NOT BE GETTING ANY HIDDEN MESSAGES ANYMORE");TS.console.dir(2,0,t)}}if(E)n=L.start(r);TS.ms.msg_handlers[r](t);if(n)n()}if(E)n=L.start(t.type);var i=TS.utility.msgs.processImsg(t,t.channel);if(TS.ims.getImById(t.channel)){if("start_profile_AAAAAA"===t.text)TS.model.profiling_keys=true;else if("end_profile_AAAAAA"===t.text){TS.model.profiling_keys=false;if(TS.model.profiling_key_times){TS.files.upload({text:JSON.stringify(TS.model.profiling_key_times,null,"\t"),title:"auto profile",filetype:"javascript",channels:[t.channel],initial_comment:""});delete TS.model.profiling_key_times}}TS.ims.addMsg(t.channel,i)}else if(TS.mpims.getMpimById(t.channel))TS.mpims.addMsg(t.channel,i);else if(TS.groups.getGroupById(t.channel))TS.groups.addMsg(t.channel,i);else TS.channels.addMsg(t.channel,i);var a=TS.shared.getModelObById(t.channel);var s=TS.members.getMemberById(i.user);if(TS.typing&&s&&a)TS.typing.memberEnded(a,s);if(n)n()},subtype__file_share:function e(t){if(!t.file)return;if(t.file.id==TS.files.polling_file_id)TS.files.uploadProcessingOver(true,t.file.id)},message_changed:function e(t){if(TS.has_pri[W])TS.log(W,"recved message type "+t.type);TS.ms.msg_handlers.message_changed_worker(t)},subtype__message_changed:function e(t){if(TS.has_pri[W])TS.log(W,"recved subtype "+t.subtype);if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.message_changed_worker(t)},message_changed_worker:function e(t){if(!t.message){TS.error("no message?");return}TS.mentions.replaceMsg(t.message);var n=TS.shared.getModelObById(t.channel);if(!n){TS.error("unknown imsg.channel:"+t.channel);return}if(TS.pins)TS.pins.replaceMsg(t.message,n);if(t.message.imgs||TS.utility.msgs.hasImgs(t.message))TS.model.show_inline_img_size_pref_reminder=true;var r=true;TS.utility.msgs.replaceMsg(n,t.message,r)},message_deleted:function e(t){if(TS.has_pri[W])TS.log(W,"recved message type "+t.type);TS.ms.msg_handlers.message_deleted_worker(t)},subtype__message_deleted:function e(t){if(TS.has_pri[W])TS.log(W,"recved subtype "+t.subtype);if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.message_deleted_worker(t)},message_deleted_worker:function e(t){if(!t.deleted_ts){TS.error("no deleted_ts?");return}TS.mentions.removeMsg(t.deleted_ts);var n=TS.channels.getChannelById(t.channel);var r;var i;var a;if(!n)r=TS.ims.getImById(t.channel);if(!n&&!r)a=TS.mpims.getMpimById(t.channel);if(!n&&!r&&!a)i=TS.groups.getGroupById(t.channel);if(!r&&!n&&!a&&!i){TS.error("unknown imsg.channel:"+t.channel);return}var s=r||n||a||i;if(TS.pins)TS.pins.removeMsg(t.deleted_ts,s);var o=TS.utility.msgs.getMsg(t.deleted_ts,s.msgs);if(!o&&s._archive_msgs)o=TS.utility.msgs.getMsg(t.deleted_ts,s._archive_msgs);if(!o)o=TS.client.unread.getMessage(s,t.deleted_ts);if(!o)o=TS.ui.replies.getActiveMessage(s,t.deleted_ts);if(!o)o=TS.client.threads.getMessage(s,t.deleted_ts);if(TS.useReactMessages())TS.redux.messages.removeMessage({channel:t.channel,ts:t.deleted_ts});if(!o)return;if(r)TS.ims.removeMsg(s.id,o);else if(n)TS.channels.removeMsg(s.id,o);else if(a)TS.mpims.removeMsg(s.id,o);else if(i)TS.groups.removeMsg(s.id,o)},subtype__sh_room_created:function e(t){if(!t.room)return;TS.dir(441,t)},subtype__sh_room_shared:function e(t){if(!t.room)return;TS.dir(441,t)},channel_left:function e(t){TS.info("You left channel "+t.channel);var n=TS.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel);return}n.is_member=false;if(TS.model.active_channel_id==t.channel&&!n.was_archived_this_session)if(TS.client)TS.client.activeChannelDisplayGoneAway();TS.channels.calcUnreadCnts(n,true);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.channels.left_sig.dispatch(n)},member_left_channel:function e(t){var n;var r=t.user;if("C"===t.channel_type){n=TS.channels.getChannelById(t.channel);if(n){if(!n.is_member){TS.info(r+" left channel "+t.channel+" but we are not a member; ignoring");return}TS.info(r+" left channel "+t.channel);t.no_display=TS.utility.msgs.shouldHideChannelJoinOrLeaveMsg(t,n);var i=!t.no_display;var a=false;var s=TS.membership.setUserChannelMembership(r,n,a);if(s)TS.membership.notifyChannelMembershipChanged(r,n,a,i)}}else if("G"===t.channel_type){n=TS.groups.getGroupById(t.channel);if(n){var o=TS.members.getMemberById(r);if(!o){TS.error('unknown member: "'+r+'"');Q("member_left_channel");return}J("member_left_channel");TS.info(o.id+" left group "+t.channel);for(var l=0;l<n.members.length;l+=1)if(n.members[l]==o.id){n.members.splice(l,1);TS.groups.calcActiveMembersForGroup(n);break}TS.members.invalidateMembersUserCanSeeArrayCaches();TS.groups.member_left_sig.dispatch(n,o)}}},channel_joined:function e(t){TS.info("You joined channel "+t.channel.id);var n=TS.channels.upsertChannel(t.channel);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.channels.joined_sig.dispatch(n)},channel_created:function e(t){if(TS.model.user.is_restricted)return;TS.info("created channel "+t.channel.id);var n=TS.channels.upsertChannel(t.channel);TS.channels.created_sig.dispatch(n)},channel_changed:function e(t){if(!t.channel)return;TS.channels.backfills.updateBackfillingList(t.channel)},channel_converted_to_shared:function e(t){if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}var n=TS.channels.getChannelById(t.channel.id);if(!n){TS.error('unknown channel: "'+t.channel.id);return}if(_.isUndefined(t.channel.is_member))t.channel.is_member=false;t.channel.is_member=false;if(n.is_member)t.channel.is_member=true;TS.channels.upsertChannel(t.channel);if(n._name_lc!==_.toLower(t.channel.name))TS.channels.channelRenamed(t.channel);if(TS.client)TS.client.channel_pane.rebuild("channels");var r=TS.shared.getActiveModelOb();if(r.id===n.id)TS.channels.converted_to_shared_sig.dispatch(n)},channel_unshared:function e(t){var n=TS.channels.upsertChannel(t.channel);TS.channels.shared_teams_updated_sig.dispatch(n)},group_converted_to_shared:function e(t){if(!t.group||!t.group.id){TS.error("No group info sent");return}var n=TS.groups.getGroupById(t.group.id);if(!n){TS.error('unknown group: "'+t.group.id);return}if(n.is_member)t.group.is_member=true;TS.groups.upsertGroup(t.group);if(TS.client)TS.client.channel_pane.rebuild("channels");var r=TS.shared.getActiveModelOb();if(r.id===n.id)TS.groups.converted_to_shared_sig.dispatch(n)},teams_joined_shared_channel:function e(t){if(!TS.boot_data.page_needs_enterprise){TS.error("shared channel event sent to non-enterprise team:"+t.channel);return}var n=TS.channels.getChannelById(t.channel);if(!n)n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown channel or group: "'+t.channel);return}if(!n.is_shared){TS.error("shared channel event sent for non-shared channel:"+t.channel);return}if(t.is_global_shared){n.is_global_shared=t.is_global_shared;if(n.is_group)TS.groups.upsertGroup(n);else TS.channels.upsertChannel(n)}else TS.enterprise.addTeamsToSharedForChannel(n,t.teams);var r=TS.shared.getActiveModelOb();if(!r.id===n.id)return;if(n.is_group)TS.groups.shared_teams_updated_sig.dispatch(n);else TS.channels.shared_teams_updated_sig.dispatch(n)},teams_left_shared_channel:function e(t){if(!TS.boot_data.page_needs_enterprise){TS.error("shared channel event sent to non-enterprise team:"+t.channel);return}var n=TS.channels.getChannelById(t.channel);if(!n)n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown channel or group: "'+t.channel);return}if(!n.is_shared){TS.error("shared channel event sent for non-shared channel:"+t.channel);return}TS.enterprise.updateSharesForChannel(n,t.teams);var r=TS.shared.getActiveModelOb();if(!r.id===n.id)return;if(n.is_group)TS.groups.shared_teams_updated_sig.dispatch(n);else TS.channels.shared_teams_updated_sig.dispatch(n)},enterprise_rename:function e(t){TS.model.enterprise.name=t.name;var n=$(".team_menu.slack_menu");n.find(".slack_menu_header .current_team_name").text(TS.model.enterprise.name);n.find(".menu_list .enterprise_logout_url a strong").text(TS.model.enterprise.name);$(".enterprise-name").text(TS.model.enterprise.name)},enterprise_team_added:function e(t){if(!t.team||!TS.boot_data.page_needs_enterprise)return;if(TS.boot_data.feature_lazy_grid_teams)TS.teams.upsertTeam(t.team);else TS.enterprise.upsertEnterpriseTeam(t.team)},channel_deleted:function e(t){var n=TS.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel);return}TS.info("deleted channel "+t.channel);TS.channels.removeChannel(n)},channel_archive:function e(t){var n=TS.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel);return}if(n.is_archived)return;TS.info("archived channel "+t.channel);n.is_archived=true;if(t.is_moved)n.is_moved=1===t.is_moved;if(!TS.model.user.is_restricted)if(n.is_member)n.was_archived_this_session=true;TS.channels.archived_sig.dispatch(n)},channel_unarchive:function e(t){var n=TS.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel);return}if(!n.is_archived)return;TS.info("unarchived channel "+t.channel);if(n.was_archived_this_session){var r=true;TS.channels.joinById(n.id,null,{in_background:r})}if(t.is_moved)n.is_moved=1===t.is_moved;n.is_archived=false;n.was_archived_this_session=false;TS.channels.unarchived_sig.dispatch(n)},channel_rename:function e(t){var n=TS.channels.getChannelById(t.channel.id);if(!n){TS.error('unknown channel: "'+t.channel);return}TS.info("renamed channel "+t.channel.id);TS.channels.channelRenamed(t.channel)},member_joined_channel:function e(t){var n;var r=t.user;if("C"===t.channel_type){n=TS.channels.getChannelById(t.channel);if(n){if(!n.is_member){TS.info(r+" joined channel "+t.channel+" but we are not a member; ignoring");return}TS.info(r+" joined channel "+t.channel);if(r==TS.model.user.id&&t.inviter){n.needs_invited_message=true;n.inviter=t.inviter}t.no_display=TS.utility.msgs.shouldHideChannelJoinOrLeaveMsg(t,n);var i=!t.no_display;var a=true;var s=TS.membership.setUserChannelMembership(r,n,a);if(s)TS.membership.notifyChannelMembershipChanged(r,n,a,i)}}else if("G"===t.channel_type){n=TS.groups.getGroupById(t.channel);if(n){var o=TS.members.getMemberById(r);if(!o){TS.error('unknown member: "'+r+'"');Q("member_joined_channel");return}J("member_joined_channel");if(t.is_mpim)return;TS.info(o.id+" joined group "+t.channel);var l;for(var u=0;u<n.members.length;u+=1)if(n.members[u]==o.id){l=n.members[u];break}if(!l&&n){n.members.push(o.id);TS.groups.calcActiveMembersForGroup(n)}if(o.is_self&&t.inviter){n.needs_invited_message=true;n.inviter=t.inviter}TS.members.invalidateMembersUserCanSeeArrayCaches();TS.groups.member_joined_sig.dispatch(n,o)}}},channel_marked:function e(t){if(!TS.client)return;var n=TS.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel+'"');return}n.needs_invited_message=false;delete TS.model.last_reads_set_by_client[n.id+"_"+t.ts];if(TS.has_pri[q]&&n.last_read!==t.ts)TS.log(q,"channel_marked for "+n.id+", "+n.last_read+" -> "+t.ts);TS.channels.setLastRead(n,t.ts)},subtype__channel_topic:function e(t){var n=TS.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel+'"');return}var r=t.user;var i=TS.members.getMemberById(r);if(!i){TS.error('unknown member: "'+r+'"');Q("subtype__channel_topic");return}J("subtype__channel_topic");TS.info(i.id+" changed topic for channel "+t.channel);TS.channels.topicChanged(n,i.id,t.ts,t.topic)},subtype__channel_purpose:function e(t){var n=TS.channels.getChannelById(t.channel);if(!n){TS.error('unknown channel: "'+t.channel+'"');return}var r=t.user;var i=TS.members.getMemberById(r);if(!i){TS.error('unknown member: "'+r+'"');Q("subtype__channel_purpose");return}J("subtype__channel_purpose");TS.info(i.id+" changed purpose for channel "+t.channel);TS.channels.purposeChanged(n,i.id,t.ts,t.purpose)},channel_history_changed:function e(t){TS.ms.msg_handlers.channel_history_changed_worker(t)},subtype__channel_history_changed:function e(t){if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.channel_history_changed_worker(t)},channel_history_changed_worker:function e(t){TS.info("channel_history_changed for "+t.channel);return C(t,TS.channels)},mpim_joined:function e(t){var n=TS.mpims.getMpimById(t.channel.id);if(n)return;if(TS.shared.isModelObShared(t.channel)&&t.channel.is_channel){TS.ms.msg_handlers.channel_joined(t);return}var r=TS.mpims.upsertMpim(t.channel);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.mpims.joined_sig.dispatch(r);if(TS.client)TS.shared.checkInitialMsgHistory(r,TS.mpims)},subtype__mpim_join:function e(t){var n=t.user;var r=TS.members.getMemberById(n);if(!r){TS.error('unknown member: "'+n+'"');Q("subtype__mpim_join");return}J("subtype__mpim_join");TS.info(r.id+" joined mpim "+t.channel)},mpim_open:function e(t){var n=TS.mpims.getMpimById(t.channel);if(!n)n=TS.channels.getChannelById(t.channel);if(!n){TS.error("unknown mpim! "+t.channel);return}n.is_open=true;if(TS.model.requested_mpim_opens[t.channel]){if(n.is_channel)TS.channels.displayChannel({id:n.id,and_send_txt:TS.model.requested_mpim_opens[t.channel].and_send_txt});else TS.mpims.displayMpim({id:n.id,and_send_txt:TS.model.requested_mpim_opens[t.channel].and_send_txt});delete TS.model.requested_mpim_opens[t.channel]}n.opened_this_session=true;if(n.is_channel)TS.channels.created_sig.dispatch(n);else TS.mpims.opened_sig.dispatch(n);if(TS.client)TS.shared.checkInitialMsgHistory(n,TS.shared.getControllerForModelOb(n))},mpim_close:function e(t){var n=TS.mpims.getMpimById(t.channel);if(!n)n=TS.channels.getChannelById(t.channel);if(!n){TS.error('unknown mpim: "'+t.channel+'"');return}n.is_open=false;var r=t.converted_to;if(r&&TS.groups.getGroupById(r)){n.latest=null;TS.shared.moveLastMsgInput(n,TS.groups.getGroupById(r))}if(TS.model.active_cid==t.channel)if(TS.client&&r&&TS.groups.getGroupById(r))TS.groups.displayGroup({id:r});else if(TS.client)TS.client.activeChannelDisplayGoneAway();TS.mpims.closed_sig.dispatch(n)},mpim_marked:function e(t){if(!TS.client)return;var n=TS.mpims.getMpimById(t.channel);if(!n){TS.error('unknown mpim: "'+t.channel+'"');return}n.needs_invited_message=false;if(TS.has_pri[q]&&n.last_read!==t.ts)TS.log(q,"mpim_marked for "+n.id+", "+n.last_read+" -> "+t.ts);delete TS.model.last_reads_set_by_client[n.id+"_"+t.ts];TS.mpims.setLastRead(n,t.ts)},mpim_history_changed:function e(t){TS.ms.msg_handlers.mpim_history_changed_worker(t)},subtype__mpim_history_changed:function e(t){if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.mpim_history_changed_worker(t)},mpim_history_changed_worker:function e(t){TS.info("mpim_history_changed for "+t.channel);return C(t,TS.mpims)},group_left:function e(t){TS.info("You left group "+t.channel);var n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel);return}TS.groups.removeGroup(n);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.groups.left_sig.dispatch(n)},group_joined:function e(t){TS.info("You joined group "+t.channel.id);if(t.channel.is_mpim)return;var n=TS.groups.getGroupById(t.channel.name);if(n){TS.error("should not be getting a group_joined message if we already know about the group: "+t.channel.name+" "+t.channel.id);return}var r=TS.groups.upsertGroup(t.channel);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.groups.joined_sig.dispatch(r);if(TS.client)TS.shared.checkInitialMsgHistory(r,TS.groups)},group_deleted:function e(t){var n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel);return}TS.info("deleted group "+t.channel);TS.groups.removeGroup(n)},group_archive:function e(t){var n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel);return}if(n.is_archived)return;TS.info("archived group "+t.channel);n.is_archived=true;if(t.is_moved)n.is_moved=1===t.is_moved;if(n.is_open)n.was_archived_this_session=true;TS.groups.archived_sig.dispatch(n)},group_unarchive:function e(t){var n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel);return}if(t.is_moved)n.is_moved=1===t.is_moved;if(!n.is_archived)return;TS.info("unarchived group "+t.channel);n.is_archived=false;n.was_archived_this_session=false;TS.groups.unarchived_sig.dispatch(n)},group_rename:function e(t){var n=TS.groups.getGroupById(t.channel.id);if(!n){TS.error('unknown group: "'+t.channel.id);return}TS.info("renamed group "+t.channel.id);TS.groups.groupRenamed(t.channel)},group_open:function e(t){if(TS.mpims.getMpimById(t.channel))return TS.ms.msg_handlers.mpim_open(t);var n=TS.groups.getGroupById(t.channel);if(!n){TS.error("unknown group! "+t.channel);return}n.is_open=true;if(TS.model.requested_group_opens[t.channel]){TS.groups.displayGroup({id:n.id,and_send_txt:TS.model.requested_group_opens[t.channel].and_send_txt});delete TS.model.requested_group_opens[t.channel]}n.opened_this_session=true;TS.groups.opened_sig.dispatch(n);if(TS.client)TS.shared.checkInitialMsgHistory(n,TS.groups)},group_marked:function e(t){if(!TS.client)return;if(TS.mpims.getMpimById(t.channel))return TS.ms.msg_handlers.mpim_marked(t);var n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel+'"');return}n.needs_invited_message=false;if(TS.has_pri[q]&&n.last_read!==t.ts)TS.log(q,"group_marked for "+n.id+", "+n.last_read+" -> "+t.ts);delete TS.model.last_reads_set_by_client[n.id+"_"+t.ts];TS.groups.setLastRead(n,t.ts)},group_close:function e(t){if(TS.mpims.getMpimById(t.channel))return;var n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel+'"');return}n.is_open=false;if(TS.model.active_group_id==t.channel)if(TS.client)TS.client.activeChannelDisplayGoneAway();TS.groups.closed_sig.dispatch(n)},subtype__group_topic:function e(t){var n=TS.mpims.getMpimById(t.channel);if(n)return;var r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown group: "'+t.channel+'"');return}var i=t.user;var a=TS.members.getMemberById(i);if(!a){TS.error('unknown member: "'+i+'"');Q("subtype__group_topic");return}J("subtype__group_topic");TS.info(a.id+" changed topic for group "+t.channel+" to "+t.topic);TS.groups.topicChanged(r,a.id,t.ts,t.topic)},subtype__group_purpose:function e(t){var n=TS.mpims.getMpimById(t.channel);if(n)return;var r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown group: "'+t.channel+'"');return}var i=t.user;var a=TS.members.getMemberById(i);if(!a){TS.error('unknown member: "'+i+'"');Q("subtype__group_purpose");return}J("subtype__group_purpose");TS.info(a.id+" changed purpose for group "+t.channel);TS.groups.purposeChanged(r,a.id,t.ts,t.purpose)},group_history_changed:function e(t){TS.ms.msg_handlers.group_history_changed_worker(t)},subtype__group_history_changed:function e(t){if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.group_history_changed_worker(t)},group_history_changed_worker:function e(t){if(t.is_mpim)return;TS.info("group_history_changed for "+t.channel);return C(t,TS.groups)},im_created:function e(t){var n=TS.ims.getImById(t.channel.id);if(n){TS.warn("we already have an im for this user: "+t.user);return}TS.ims.upsertIm(t.channel);n=TS.ims.getImById(t.channel.id);if(!n){TS.error("error why can we not find this im: "+t.channel.id);return}var r=TS.members.getMemberById(t.user);if(!r){TS.error('unknown member: "'+t.user+'"');Q("im_created");return}J("im_created");TS.members.invalidateMembersUserCanSeeArrayCaches();if(n.is_open){if(TS.model.requested_im_opens[r.id]){TS.ims.displayIm(n.id,false,TS.model.requested_im_opens[r.id].and_send_txt);delete TS.model.requested_im_opens[r.id]}TS.ims.opened_sig.dispatch(n)}n.opened_this_session=true},im_open:function e(t){var n=TS.ims.getImById(t.channel);if(!n){TS.error("unknown im! "+t.channel);return}n.is_open=true;var r=TS.members.getMemberById(t.user);if(!r){TS.error('unknown member: "'+t.user+'"');Q("im_open");return}J("im_open");if(TS.model.requested_im_opens[r.id]){TS.ims.displayIm(n.id,false,TS.model.requested_im_opens[r.id].and_send_txt);delete TS.model.requested_im_opens[r.id]}n.opened_this_session=true;TS.ims.opened_sig.dispatch(n);if(TS.client)TS.shared.checkInitialMsgHistory(n,TS.ims)},im_marked:function e(t){if(!TS.client)return;var n=TS.ims.getImById(t.channel);if(!n){TS.error('unknown im: "'+t.channel+'"');return}if(TS.has_pri[q]&&n.last_read!==t.ts)TS.log(q,"im_marked for "+n.id+", "+n.last_read+" -> "+t.ts);delete TS.model.last_reads_set_by_client[n.id+"_"+t.ts];TS.ims.setLastRead(n,t.ts)},im_close:function e(t){var n=TS.ims.getImById(t.channel);if(!n){TS.error('unknown im: "'+t.channel+'"');return}if(!n.is_open)return;n.is_open=false;if(TS.model.active_im_id==t.channel)if(TS.client)TS.client.activeChannelDisplayGoneAway();TS.ims.closed_sig.dispatch(n)},im_history_changed:function e(t){TS.ms.msg_handlers.im_history_changed_worker(t)},subtype__im_history_changed:function e(t){if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.im_history_changed_worker(t)},im_history_changed_worker:function e(t){TS.info("im_history_changed for "+t.channel);return C(t,TS.ims)},manual_presence_change:function e(t){var n=TS.model.user;if("away"!==t.presence&&"active"!==t.presence){TS.error('unknown presence: "'+t.presence+'"');return}n.manual_presence=t.presence;TS.members.presence_changed_sig.dispatch(n)},presence_change:function e(t){t.team=t.team||TS.model.team.id;if(t.hasOwnProperty("users")&&_.isArray(t.users))t.users.forEach(function(e){M(e,t.presence)});else M(t.user,t.presence)},status_change:function e(t){var n=TS.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');Q("status_change");return}J("status_change");if(n.status==t.status)return;n.status=t.status;TS.members.status_changed_sig.dispatch(n)},user_can_manage_shared_channels:function e(t){TS.prefs.updateTeamPrefCanUserManageSharedChannels(t)},pref_change:function e(t){TS.prefs.onPrefChanged(t)},team_pref_change:function e(t){TS.prefs.onTeamPrefChanged(t)},user_read_only_channels:function e(t){if(TS.boot_data.default_shared_channels);else TS.channels.read_only.updateList(t.channel_ids)},team_profile_change:function e(t){TS.team.upsertAndSignal({profile:t.profile})},team_profile_reorder:function e(t){TS.team.upsertAndSignal({profile:t.profile})},team_profile_delete:function e(t){TS.team.upsertAndSignal({profile:t.profile})},team_plan_change:function e(t){TS.team.team_plan_changed_sig.dispatch(t)},file_created:function e(t){var n=TS.files.getFileById(t.file.id);if(n)TS.warn("we already know about this file, which probably means the files.upload response came in before this message (so np) "+t.file.id);else TS.files.upsertAndSignal(t.file)},file_public:function e(t){TS.files.upsertAndSignal(t.file)},file_deleted:function e(t){var n=t.file_ids||[t.file_id];n.forEach(function(e){TS.files.removeFile(e)})},file_private:function e(t){TS.files.fetchFileInfo(t.file_id)},file_change:function e(t){TS.files.upsertAndSignal(t.file);TS.files.fileWasMaybeRefreshed(t.file)},file_shared:function e(t){TS.files.upsertAndSignal(t.file);TS.files.team_file_shared_sig.dispatch(t.file)},file_unshared:function e(t){TS.files.upsertAndSignal(t.file)},file_comment_added:function e(t){var n=TS.files.getFileById(t.file.id);if(!n)return;if(!TS.files.editCommentOnFile(t.comment,n))TS.files.addCommentToFile(t.comment,n);TS.files.upsertFile(t.file)},file_comment_edited:function e(t){var n=TS.files.getFileById(t.file.id);if(!n)return;TS.files.editCommentOnFile(t.comment,n);TS.files.upsertFile(t.file)},file_comment_deleted:function e(t){var n=TS.files.getFileById(t.file.id);if(!n)return;TS.files.deleteCommentOnFile(t.comment,n);TS.files.upsertFile(t.file)},hello:function e(){},goodbye:function e(){if(!TS.isSocketManagerEnabled())return;TS.info("goodbye handler: disconnecting from the MS next time it is convenient");function t(){TS.ms.disconnected_sig.remove(t);TS.ui.window_focus_changed_sig.remove(t);if(TS.model.ms_connected){TS.info("goodbye handler: disconnecting now");var e=true;TS.ms.disconnect(e)}else TS.info("goodbye handler: got disconnected some other way before we handled the goodbye message")}if(!TS.model.ui.is_window_focused){t();return}TS.ms.disconnected_sig.addOnce(t);TS.ui.window_focus_changed_sig.addOnce(t)},team_join:function e(t){var n=t.user;TS.info(n.id+" joined the team");TS.members.upsertMember(n);n=TS.members.getMemberById(n.id);if(!n){TS.error("team_join: wtf no member "+n.id+"?");Q("team_join");return}J("team_join");TS.members.joined_team_sig.dispatch(n);if(TS.client)TS.view.showProperTeamPaneFiller()},user_change:function e(t){var n=TS.members.getMemberById(t.user.id);var r=t.from_flannel;if(!n){if(!r){if(TS.has_pri[K])TS.log(K,"Flannel: user_change for member not in model; ignoring");Q("user_change");return}if(TS.has_pri[K])TS.log(K,"Flannel: user_change for member not in model; will upsert because this looks like a Flannel hint")}J("user_change");var i=!n&&r;if(i&&!s&&!TS.members.is_in_bulk_upsert_mode){s=true;TS.members.startBatchUpsert()}else if(s&&!i){TS.members.finishBatchUpsert();s=false}if(t.user&&t.user.id===TS.model.user.id)if(TS.model.team&&TS.model.team.prefs&&!TS.model.team.prefs.display_email_addresses&&t.user.profile&&!t.user.profile.email){var a=n.profile&&n.profile.email;if(a){TS.info("user_change: email hidden via team pref. appending email from model for local user, so it is not lost in upsert.");t.user.profile.email=a}}TS.members.upsertAndSignal(t.user)},star_added:function e(t){if(!t.item){TS.error(t.type+" has no item");return}var n=TS.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');Q("star_added");return}J("star_added");if(!n.is_self)return;TS.stars.userStarStatusHasChanged(true,t.item,t.type);TS.stars.maybeUpdateUserStarredList({delta:1})},star_removed:function e(t){if(!t.item){TS.error(t.type+" has no item");return}var n=TS.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');return}if(!n.is_self)return;TS.stars.userStarStatusHasChanged(false,t.item,t.type);TS.stars.maybeRemoveStarredListItem(t.item)},reaction_added:function e(t){if(!t.item){TS.error(t.type+" has no item");return}TS.rxns.changeRxnsFromIMsg(t)},reaction_removed:function e(t){if(!t.item){TS.error(t.type+" has no item");return}TS.rxns.changeRxnsFromIMsg(t)},email_domain_changed:function e(t){TS.team.upsertAndSignal({email_domain:t.email_domain});if(TS.client)TS.view.showProperTeamPaneFiller()},team_domain_change:function e(t){TS.team.upsertAndSignal({domain:t.domain});TS.model.last_team_domain=TS.model.team.domain;TSSSB.call("teamDomainChanged",t.url)},slack_broadcast:function e(t){var n=null;var r=t.title||TS.i18n.t("Broadcast message","msg_handlers")();var i=t.body||"";var a="";var s=t.button||(t.reload?"Reload":"OK");var o=false;if(t.reload){if(t.force_reload){TS.info("reloading because imsg.force_reload");o=true}else if(!TS.boot_data.version_ts){TS.info("reloading because we dont have an version_ts");o=true}else if("dev"===t.version_ts){TS.info("reloading because dev");o=true}else if(parseInt(TS.boot_data.version_ts,10)<parseInt(t.version_ts,10)){TS.info("reloading because "+TS.boot_data.version_ts+" < "+t.version_ts);o=true}if(!o)return;n=function e(){if(TS.client)TS.reload()}}if(o){var l=_.random(10,20);var u=TS.i18n.t('(You will be auto reloaded in <span id="auto_secs">{secs}</span> seconds.)',"msg_handlers")({secs:l});a='<p class="top_margin">'+u+"</p>";setTimeout(function(){if(TS.client)TS.reload()},1e3*l);setInterval(function(){l-=1;if(l<1)return;$("#auto_secs").text(l)},1e3)}TS.generic_dialog.start({title:TS.format.formatNoHighlightsNoSpecials(r),body:TS.format.formatNoHighlightsNoSpecials(i)+a,go_button_text:s,show_cancel_button:false,esc_for_ok:true,onGo:n})},team_rename:function e(t){if(t.source_team&&t.source_team!==TS.model.team.id)TS.teams.updateTeamName(t);else{$("#team_name").text(t.name);document.title=document.title.replace(TS.model.last_team_name,t.name);if(TS.ui.growls.original_document_title)TS.ui.growls.original_document_title=TS.ui.growls.original_document_title.replace(TS.model.last_team_name,t.name);TS.model.team.name=t.name;TS.model.last_team_name=TS.model.team.name;TS.team.team_name_changed_sig.dispatch(TS.model.team);TSSSB.call("teamNameChanged",t.name)}},team_icon_change:function e(t){if(!t.icon)return;if(t.source_team&&t.source_team!==TS.model.team.id)TS.teams.updateTeamIcon(t);else{TS.model.team.icon=t.icon;TS.teams.changed_icon_sig.dispatch(TS.model.team);if(TS.client)TS.client.updateTeamIcon()}},bot_added:function e(t){var n=t.bot;TS.info(n.id+" was added");TS.bots.upsertBot(n);n=TS.bots.getBotById(n.id);if(!n){TS.error("error no bot "+n.id+"?");return}TS.bots.added_sig.dispatch(n)},bot_changed:function e(t){var n=TS.bots.getBotById(t.bot.id);if(!n&&TS.has_pri[K])TS.log(K,"Flannel: bot_changed for member not in model; upserting");TS.bots.upsertAndSignal(t.bot)},bot_removed:function e(t){var n=TS.bots.getBotById(t.bot.id);if(!n){if(TS.has_pri[K])TS.log(K,"Flannel: bot_removed for bot not in model; ignoring");return}TS.bots.upsertAndSignal(t.bot)},error:function e(){},user_typing:function e(t){if(!TS.typing)return;var n=TS.members.getMemberById(t.user);if(!n){TS.error("unknown imsg.user:"+t.user);Q("user_typing");return}J("user_typing");var r=TS.shared.getModelObById(t.channel);if(!r){TS.error("unknown imsg.channel:"+t.channel);return}TS.typing.memberStarted(r,n)},issue_change:function e(t){TS.help.onIssueChange(t.issue)},emoji_changed:function e(t){switch(t.subtype){case"add":if(!t.hasOwnProperty("name")||!t.hasOwnProperty("value")){TS.warn("Bad emoji_changed__add event; expected `name` and `value` to be present");return}TS.emoji.addCustomEmoji(t.name,t.value,t.event_ts);break;case"remove":if(!_.isArray(t.names)){TS.warn("Bad emoji_changed__remove event; expected `names` to be an array");return}t.names.forEach(function(e){TS.emoji.removeCustomEmoji(e,t.event_ts)});break;default:A("emoji_changed",t.event_ts,function(e){if(e)TS.model.emoji_cache_ts=e;TS.emoji.resetUpEmoji()})}},commands_changed:function e(t){if(!t.commands_removed&&!t.commands_updated){A("commands_changed",t.event_ts,function(e){if(e)TS.model.commands_cache_ts=e;TS.cmd_handlers.resetUpCmds()});return}if(_.isArray(t.commands_removed))t.commands_removed.forEach(function(e){TS.cmd_handlers.removeCommand(e.name,t.event_ts)});if(_.isArray(t.commands_updated))t.commands_updated.forEach(function(e){TS.cmd_handlers.updateCommand(e,t.event_ts)})},accounts_changed:function e(){setTimeout(TS.refreshTeams,1e3)},pin_added:function e(t){var n=TS.shared.getModelObById(t.channel_id);if(n){TS.pins.pinStatusHasChanged(true,t.item,t.item.type,n,t.pin_count);n.has_pins=true}},pin_removed:function e(t){var n=TS.shared.getModelObById(t.channel_id);if(n){TS.pins.pinStatusHasChanged(false,t.item,t.item.type,n,t.pin_count);if(false===t.has_pins)n.has_pins=false}},sh_room_join:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},sh_room_leave:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},sh_room_update:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},subteam_updated:function e(t){TS.user_groups.upsertUserGroupAndSignal(t.subteam)},subteam_members_changed:function e(t){if(!TS.boot_data.feature_subteam_members_diff)return;TS.info("TS.ms.msg_handlers.subteam_members_changed",t);TS.user_groups.userGroupMembersChanged(t)},subteam_created:function e(t){TS.user_groups.upsertUserGroupAndSignal(t.subteam)},subteam_deleted:function e(t){TS.user_groups.removeUserGroupAndSignal(t.subteam)},subteam_self_added:function e(t){TS.user_groups.upsertSelfUserGroup(t.subteam_id)},subteam_self_removed:function e(t){TS.user_groups.removeSelfUserGroup(t.subteam_id)},apps_changed:function e(t){if(t.event_ts)TS.model.apps_cache_ts=t.event_ts;TS.apps.ingestApp(t.app)},dnd_override:function e(t){TS.dnd.dndOverride(t.channel,t.timestamp)},dnd_updated:function e(t){var n=TS.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');return}TS.dnd.updateUserPropsAndSignal(n.id,t.dnd_status)},dnd_updated_user:function e(t){var n=TS.members.getMemberById(t.user);if(!n){TS.log(2002,'unknown member in dnd_updated_user: "'+t.user+'"');Q("dnd_updated_user");return}J("dnd_updated_user");TS.dnd.updateUserPropsAndSignal(n.id,t.dnd_status)},reconnect_url:function e(t){if(TS.isSocketManagerEnabled())return;if(!TS.ms.fast_reconnects_enabled)return;var n=t.url;TS.ms.setReconnectUrl(n)},message_replied:function e(t){var n=t.message;var r;if(n&&n.replies&&n.replies.length)r=_.maxBy(n.replies,"ts").ts;var i=TS.shared.getModelObById(t.channel);if(r&&i&&i.msgs){var a=TS.utility.msgs.findMsg(n.ts,i.id);if(a&&a.replies&&a.replies.length){var s=_.maxBy(a.replies,"ts").ts;if(r<s){TS.log(2004,"Not processing older message_replied event, "+r+" < "+s+", in "+t.channel);return}}}TS.ms.msg_handlers.message_changed_worker(t)},subtype__message_replied:function e(t){if(TS.has_pri[W])TS.log(W,"recved subtype "+t.subtype);if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.message_changed_worker(t)},thread_subscribed:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadSubscribed(n.channel,n.thread_ts,n)},thread_unsubscribed:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadUnsubscribed(n.channel,n.thread_ts,n)},thread_marked:function e(t){var n=t.subscription;if(!n||"thread"!==n.type)return;if(!n.channel||!n.thread_ts)return;TS.replies.threadMarked(n.channel,n.thread_ts,n.last_read,n.unread_count)},user_added_to_team:function e(t){TS.info("TS.ms.msg_handlers.user_added_to_team, team_id = "+t.team_id);if(TS.client)TS.client.user_added_to_team_sig.dispatch(t.team_id)},user_removed_from_team:function e(t){TS.info("TS.ms.msg_handlers.user_removed_from_team, team_id = "+t.team_id);if(TS.client)TS.client.user_removed_from_team_sig.dispatch(t.team_id)},update_thread_state:function e(t){if(!TS.client)return;TS.client.threads.updateThreadState(t.has_unreads,t.mention_count,t.timestamp)},shared_invite_code_created:function e(){if(!TS.client)return;TS.ui.shared_invites_modal.updateCode()},shared_invite_code_disabled:function e(){if(!TS.client)return;TS.ui.shared_invites_modal.updateCode()},app_permission_request:function e(t){if(!TS.interop.client_action_token.check(t.client_token))return;TS.apps.permissions.requestPermissions(t.app_user,t.scope_info,t.trigger_id)},form_sent:function e(t){if(!TS.boot_data.feature_app_forms)return;if(!TS.interop.client_action_token.check(t.client_token))return;var n=TS.interop.client_action_token.getTimeDelta(t.client_token);TS.statsd.timing("app_forms.initiation_to_open_delta",n);if(n>=t.timeout_range)return;var r=document.getElementById("app_form_mount_point");TS.interop.mountAppFormDialog(r,{appId:t.app_id,id:t.form_id,submitLabel:t.form_submit_label,title:t.form_title})},quest_assigned:function e(t){TS.quests.quest_assigned_sig.dispatch(t.payload.user_quests)}});var e=10;var t;var r;var i;var a=0;var s=false;var o=function e(t,n){if(!n)return false;if(TS.web&&TS.web.space&&!TS.web.space.isFileRelevant(n))return false;if("file_created"===t.type&&t.user_id==TS.model.user.id)return true;return!!TS.files.getFileById(n)};var l=function e(t){var n=["message","file_deleted","file_private"];if(_.includes(n,t.type))return false;if(t._file_attached)return false;var r=t;var i=t.file&&t.file.id||t.file_id;if(!i&&t.item){i=t.item.file&&t.item.file.id||t.item.file_id;if(i)r=t.item}if(!i)return false;return{ob_with_file:r,file_id:i}};var u=[];var d=false;var c;var m=function(){var e=500;var t={trailing:true};return _.debounce(function(e,t){if(TS.has_pri[W])TS.log(W,"TS.metrics: "+e+", Q length = "+t);TS.metrics.store(e,t,{is_count:true})},e,t)}();var f=function e(t){if(t._from_evt_log)d=true;t._enqueued_at=performance.now();u.push(t);if(r){a+=1;t._id=a;TS.metrics.mark("ms_event_queue_add_"+a)}if(1==u.length)p();else{if(TS.has_pri[W])TS.log(W,t.type+" is Qed and not being handled immediately _Q.length:"+u.length);if(!TS.client||!TS.client.stats.isEnabled())return;if(d){if(u.length>100)m("ms_event_from_log_q",u.length)}else if(u.length>10)m("ms_event_q",u.length)}};var p=function e(){if(c){clearTimeout(c);c=void 0}if(!u.length)return;if(!t)t=performance.now();if(r)TS.metrics.mark("ms_event_processing");var n=u[0];if(n._enqueued_at&&TS.client&&TS.client.stats.isEnabled()){var i=performance.now()-n._enqueued_at;TS.metrics.store("ms_time_in_queue",i,{allow_zero:true});delete n._enqueued_at}h(n)};var h=function e(t){var n=l(t);if(!n)return b(t);var r=n.ob_with_file;var i=n.file_id;if(!o(t,i)){if(TS.has_pri[z])TS.warn(z,t.type+" referenced an irrelevant file: "+i);return Promise.resolve().then(function(){return w()})}if(TS.has_pri[z])TS.dir(z,t,t.type+" -> _ensureFileObjectsOnMsgAndProceed()");if(!i){if(TS.has_pri[z])TS.maybeWarn(z,t.type+" referenced a relevant file but there is no file_id");return b(t)}if(TS.has_pri[z])TS.log(z,t.type+" referenced a relevant file and we have to look it up via the API: "+i);if(u.length>1)S(t,i,r);else g(t,i,r)};var g=function e(t,n,r){TS.files.fetchFileInfoRaw(n,function(e,i){if(!i){if(TS.has_pri[z])TS.warn(z,t.type+" file fetch failed (or the file has been deleted)");return Promise.resolve().then(function(){return w()})}r.file=i;if(TS.has_pri[z])TS.log(z,t.type+" now has a file definition");t._file_attached=true;_.forEach(u,function(e){var r=l(e);if(r&&r.file_id===n){r.ob_with_file.file=i;e._file_attached=true;if(TS.has_pri[z])TS.log(z,t.type+" now has a file definition (courtesy of a previously queued imsg for "+n+")")}});b(t)})};var S=function e(t,n,r){var i=[n];_.forEach(u,function(e){if(i.length>=20)return false;var t=l(e);if(t&&!_.includes(i,t.file_id)&&o(e,t.file_id))i.push(t.file_id)});if(i.length>1){var a=true;TS.files.fetchMultipleFiles(i,function(e,i){var a=i&&i.files;if(!e||!_.isArray(a)){if(TS.has_pri[z])TS.maybeWarn(z,t.type+" multi-file fetch failed");return Promise.resolve().then(function(){return w()})}var s={};_.forEach(a,function(e){s[e.id]=e});_.forEach(u,function(e){var n=l(e);if(!n)return;var r=s[n.file_id];if(!r)return;n.ob_with_file.file=r;e._file_attached=true;if(TS.has_pri[z])TS.log(z,t.type+" now has a file definition ("+n.file_id+")")});if(!s[n])g(t,n,r);else b(t)},a)}else g(t,n,r)};var T=function e(t){if(!TS.boot_data.feature_stop_loud_channel_mentions)return Promise.resolve();if(!t||"message"!==t.type||!t.text)return Promise.resolve();var n=TS.model.here_regex.test(t.text)||TS.model.channel_regex.test(t.text)||TS.model.everyone_regex.test(t.text)||TS.model.group_regex.test(t.text);if(n){var r=TS.shared.getModelObById(t.channel);if(!r){TS.maybeWarn(794,"_maybeEnsureMemberCount: Could not find model_ob for id "+t.channel);return Promise.resolve()}if(r.is_im&&!r.is_mpim)return Promise.resolve();if(r.is_mpim&&!TS.membership.lazyLoadMpimMembership())return Promise.resolve();if(r.is_group&&!TS.membership.lazyLoadGroupMembership())return Promise.resolve();return TS.membership.promiseToGetMembershipCounts(r).catch(_.noop)}return Promise.resolve()};var v=function e(r){if(!TS.boot_data.feature_lazy_teams)return b(r);if(i)TS.metrics.mark("ensure_resolution");if(TS.has_pri[W])TS.log(W,r.type+" is now being handled");var a;var s=true;var o=true;if(E)a=L.start(r.type);var l=function e(){return TS.shared.ensureModelObsArePresent(v).catch(function(e){if(r.channel&&"string"===typeof r.channel&&!TS.shared.getModelObById(r.channel)){TS.error(f+" could not be handled because imsg.channel could not be fetched. full err: "+e.message);TS.warn("imsg.ts:"+r.ts+", imsg.channel:"+r.channel);throw e}if(TS.has_pri[Y]){TS.warn(Y,f+" held some references to model_obs we could not fetch, but we have imsg.channel (or there was no imsg.channel) so we can still proceed");TS.log(Y,"imsg.ts:"+r.ts+", missing c ids:"+JSON.stringify(v))}})};var u=function e(){return TS.bots.ensureBotsArePresent(C).catch(function(e){TS.console.error(e)})};var d=function e(){return TS.members.ensureMembersArePresent(k.m_ids,k.c_ids,k.t_ids).catch(function(e){if(r.user&&"string"===typeof r.user&&!TS.members.getMemberById(r.user)||r.channel&&"object"===n(r.channel)&&r.channel.user&&"string"===typeof r.channel.user&&!TS.members.getMemberById(r.channel.user)){TS.error(f+" could not be handled because imsg.user or imsg.channel.user could not be fetched. full err: "+e.message);TS.warn("imsg.ts:"+r.ts+", imsg.user:"+r.user+", imsg.channel.user:"+r.channel&&r.channel.user);throw e}if(TS.has_pri[Y]){TS.maybeWarn(Y,f+" held some references to members we could not fetch, but we have imsg.user and imsg.channel.user (or they did not exist) so we can still proceed");TS.log(Y,"imsg.ts:"+r.ts+", missing_m_ids:"+JSON.stringify(k))}})};var c=function e(){if(!TS.boot_data.feature_shared_channels_client)return Promise.resolve();return TS.teams.ensureTeamsArePresent(M).catch(function(e){TS.console.error(e)})};var m=function e(n){if(i)TS.metrics.measureAndClear("ensure_resolution","_ensureModelObsAndProceed");try{x(r)}catch(e){TS.error(f+" errored out when being handled, with err: "+e.message,e);TS.console.logStackTrace()}if(!n)t=null;if(a)a(s);return w()};if(_.includes(U,r.type))return m(o);var f="type:"+r.type+(r.subtype?" subtype:"+r.subtype:"");var p=TS.utility.extractAllModelObIds(r,f);var h=TS.utility.extractAllMemberIds(r,f);var g=TS.utility.extractAllBotIds(r);var S=TS.utility.extractAllTeamIds(r);var v=TS.shared.getModelObIdsNotPresent(p);var k=TS.members.getMemberIdsNotPresent(h.m_ids,h.c_ids,h.t_ids);var C=_.reject(g,TS.bots.getBotById);var M=_.reject(S,TS.teams.getTeamById);var I=!!(v.length||k.m_ids.length||C.length||M.length);if(I&&"user_typing"===r.type&&y(r.channel))return w();Promise.join(l(),u(),d(),c()).then(function(){return T(r)}).then(function(){return m()}).catch(function(){if(a)a(s);return w(!I)})};var b=function e(r){if(TS.boot_data.feature_lazy_teams)return v(r);if(i)TS.metrics.mark("ensure_resolution");if(TS.has_pri[W])TS.log(W,r.type+" is now being handled");var a;var s=true;var o=true;if(E)a=L.start(r.type);var l=function e(){return TS.shared.ensureModelObsArePresent(g).then(function(){return u()},function(e){if(r.channel&&"string"===typeof r.channel&&!TS.shared.getModelObById(r.channel)){TS.error(m+" could not be handled because imsg.channel could not be fetched. full err: "+e.message);TS.warn("imsg.ts:"+r.ts+", imsg.channel:"+r.channel);if(a)a(s);return w()}if(TS.has_pri[Y]){TS.warn(Y,m+" held some references to model_obs we could not fetch, but we have imsg.channel (or there was no imsg.channel) so we can still proceed");TS.log(Y,"imsg.ts:"+r.ts+", missing c ids:"+JSON.stringify(g))}if(S.m_ids.length||b.length)return u();return T(r).then(c)})};var u=function e(){if(b.length)return TS.bots.ensureBotsArePresent(b).catch(_.noop).then(d);return d()};var d=function e(){return TS.members.ensureMembersArePresent(S.m_ids,S.c_ids,S.t_ids).catch(function(e){if(r.user&&"string"===typeof r.user&&!TS.members.getMemberById(r.user)||r.channel&&"object"===n(r.channel)&&r.channel.user&&"string"===typeof r.channel.user&&!TS.members.getMemberById(r.channel.user)){TS.error(m+" could not be handled because imsg.user or imsg.channel.user could not be fetched. full err: "+e.message);TS.warn("imsg.ts:"+r.ts+", imsg.user:"+r.user+", imsg.channel.user:"+r.channel&&r.channel.user);if(a)a(s);return w()}if(TS.has_pri[Y]){TS.maybeWarn(Y,m+" held some references to members we could not fetch, but we have imsg.user and imsg.channel.user (or they did not exist) so we can still proceed");TS.log(Y,"imsg.ts:"+r.ts+", missing_m_ids:"+JSON.stringify(S))}}).then(function(){return T(r)}).then(c)};var c=function e(n){if(i)TS.metrics.measureAndClear("ensure_resolution","_ensureModelObsAndMembersAndProceed");try{x(r)}catch(e){TS.error(m+" errored out when being handled, with err: "+e.message,e);TS.console.logStackTrace()}if(!n)t=null;if(a)a(s);return w()};if(_.includes(U,r.type))return c(o);var m="type:"+r.type+(r.subtype?" subtype:"+r.subtype:"");var f=TS.utility.extractAllModelObIds(r,m);var p=TS.utility.extractAllMemberIds(r,m);var h=TS.utility.extractAllBotIds(r);var g=TS.shared.getModelObIdsNotPresent(f);var S=TS.members.getMemberIdsNotPresent(p.m_ids,p.c_ids,p.t_ids);var b=_.reject(h,TS.bots.getBotById);if(g.length||S.m_ids.length||b.length)if("user_typing"===r.type&&y(r.channel))return w();if(g.length)l();else if(S.m_ids.length||b.length)u();else return T(r).finally(function(){return c(o)})};var y=function e(t){if(t===TS.model.active_cid)return false;var n=TS.shared.getModelObById(t);if(!n)return true;return!n.is_im&&!n.is_mpim};var w=function e(){if(!u.length)return Promise.resolve();if(r){var n=u.shift();TS.metrics.store("ms_event_q_length",u.length,{is_count:true});TS.metrics.measureAndClear("ms_event_duration","ms_event_processing");TS.metrics.measureAndClear("ms_event_and_queue_duration","ms_event_queue_add_"+n._id)}else u.shift();if(!u.length)d=false;if(k())return new Promise(function(e){setTimeout(function(){if(TS.has_pri[Y])TS.log(Y,"too much work per frame; need to take a break");t=null;p();return e()},0)});p();return Promise.resolve()};var k=function n(){return t&&u.length&&performance.now()-t>e};var x=function e(t){if(s&&"user_change"!==t.type){TS.members.finishBatchUpsert();s=false}TS.ms.msg_handlers[t.type](t);if(TS.client&&TS.model.is_our_app){TS.dir(236,t,"calling TS.client.windows.distributeMsgToWins");TS.client.windows.distributeMsgToWins(t)}};var C=function e(t,n){var r=TS.shared.getModelObById(t.channel);if(!r){TS.error('unknown model_ob: "'+t.channel+'"');return}r.history_changed=true;n.fetchHistory(r,{channel:r.id,latest:t.latest,inclusive:true,count:_.clamp(r.msgs.length,TS.model.initial_msgs_cnt,1e3)},function(e,i,a){if(!e)TS.error("could not retrieve history for "+r.id);else{TS.info("_history_changed: dumping old messages for "+r.id);r.is_limited=false;TS.utility.msgs.resetOldestMsgsTs(r);TS.warn("imsg.latest: "+t.latest);for(var s=r.msgs.length-1;s>-1;s-=1){var o=r.msgs[s];if(o.ts<t.latest)continue;i.messages.unshift(o)}r.msgs.length=0}n.onHistory(e,i,a);if(!r.latest){TS.info("history_changed: latest not set for "+r.id,t,r);var l=TS.shared.getLatestMsgTs(r);if(!l){TS.warn("history_changed: could not find latest via TS.shared.getLatestMsgTs(), using live msgs");l=r&&r.msgs.length?r.msgs[r.msgs.length-1]:null}if(!l)TS.warn("history_changed: still no latest ts for "+r.id+"?",l);else if(l){TS.info("history_changed: assigning latest of "+l+" to model_ob",l,r);r.latest=l}}r.history_changed=false})};var M=function e(t,n){if("away"!==n&&"active"!==n){TS.error('unknown presence: "'+n+'"');return}var r=TS.members.getMemberById(t);if(!r){Q("presence_change");return}J("presence_change");if(r.presence==n)return;if(_.get(r,"profile.always_active"))n="active";if(r.is_self)r._presence_last_changed=new Date;r.presence=n;TS.members.presence_changed_sig.dispatch(r)};var I={};var A=function e(t,n,r){I[t]=I[t]||{};var i=I[t];if(n)i.cache_ts=n;if(i.timer)return;var a=_.random(0,5e3);TS.info("Waiting "+a+" ms before handling "+t+" event");i.timer=setTimeout(function(){delete I[t];r(i.cache_ts)},a)};var E=false;var F=false;var O=1e3;var B=null;var H=6e4;var D={};var P={};var j=0;var R=0;var L={start:function e(t,n){if(!F)return;n=n&&parseInt(n,10)||O;var r={start:performance.now(),end:0};var i=function e(i){i=!!i;r.end=performance.now();var a=r.end-r.start;if(a>n)TS.warn("'"+t+"' msg_handler took "+_.round(a,2)+"ms"+(n!==O?" (threshold = "+n+")":""));L.count(t,a,i)};return i},count:function e(t,n,r){if(!P.start_time)P.start_time=performance.now();if(!D[t])D[t]={call_count:0,elapsed_time:0,async:!!r};if(r)D[t].async=r;D[t].call_count+=1;D[t].elapsed_time+=n;L.maybeReport()},report:function e(){L.finish();if(_.size(D)){var t=_.sum(_.map(D,"call_count"));if(TS.has_pri[V])TS.log(V,"🏔️ MS message stats: "+t+" handler calls in "+parseInt(P.elapsed_time/1e3,10)+"s window, "+j+" imsgs since "+new Date(R),D);L.beacon()}L.reset()},beacon:function e(){var t="ms_handler_";_.each(D,function(e,n){if(e.async)n=t+"async_"+n;else n=t+n;TS.metrics.count(n+"_count",e.call_count);TS.metrics.store(n+"_time",e.elapsed_time)});TS.metrics.store(t+"imsgs_received_total",j,{is_count:true})},finish:function e(){P.end_time=performance.now();P.elapsed_time=P.end_time-P.start_time},reset:function e(){D={};P={};B=null},maybeReport:function e(){if(B)return;B=window.setTimeout(L.report,H)},enableStatsCollecting:function e(){if(TS.has_pri[V])TS.log(V,"🏔️ MS message handler stat collecting enabled");F=true},disableStatsCollecting:function e(){if(TS.has_pri[V])TS.log(V,"🏔️ MS message handler stat collecting disabled");F=false}};var U=["channel_joined","dnd_updated","dnd_updated_user","manual_presence_change","member_left_channel","presence_change","status_change","subteam_created","user_removed_from_team","user_change"];var N=50;var G=1;var W=2;var q=141;var z=552;var K=1989;var V=808;var Y=794;var J=function e(t){if(TS.utility.enableFeatureForUser(1))TS.metrics.count("ms_event_handled_"+t)};var Q=function e(t){if(TS.utility.enableFeatureForUser(1))TS.metrics.count("ms_event_dropped_"+t)}})()},4240:function(e,t){(function(){"use strict";TS.registerModule("flannel",{fetchMemberCounts:function e(){return TS.ms.flannel.call("user_counts_request").then(function(e){return e.counts})},getFlannelConnectionUrl:function e(){var t=TS.getSocketStartArgs();return a(t)},fetchChannelMembershipForUsers:function t(n,r){if(!_.isString(n))throw new Error("Expected channel_id to be a string");if(!_.isArray(r)||!_.every(r,_.isString))throw new Error("Expected user_ids to be an array of strings");if(_.isEmpty(r))return Promise.resolve({});r=_.uniq(r);var i={};var a=_.chunk(r,e).map(function(e){var t={channel:n,users:e};var r=TS.ms.flannel.call("membership_query",t).then(function(e){var t=e.members||[];var n=e.non_members||[];var r=t.concat(n);r.forEach(function(e){i[e]=t.indexOf(e)>=0});return null});return r.reflect()});return Promise.all(a).then(function(){if(Object.keys(i).length!==r.length){var e=Object.keys(i);var t=_.difference(r,e);throw new Error("Flannel did not return membership status of "+n+" for some users: "+t.join(", "))}return i})},fetchMembershipCountsForChannel:function e(t){if(!_.isString(t))throw new Error("Expected channel_id to be a string");return TS.ms.flannel.call("user_counts_request",{channel:t}).then(function(e){return e.counts})},fetchRawObjectsByIds:function e(t){return r(t)},fetchRawObjectsWithQuery:function e(t,n){return i(t,n)}});var e=100;var t=2;var n=function e(t,n,r){return TS.ms.flannel.call("user_query_request",t).then(function(i){if(_.get(i,"results.length")){n=n.concat(i.results);if(r&&(n.length>=r||!i.next_marker))return{objects:n.slice(0,r),next_marker:n.length>r?n[r].id:i.next_marker}}if(!i.next_marker||n.length>=t.count&&!r){if(TS.has_pri[s])TS.log(s,"Flannel: finished fetching results for query",t);return{objects:n.slice(0,t.count),next_marker:n.length>t.count?n[t.count].id:i.next_marker}}t.marker=i.next_marker;if(TS.has_pri[s])TS.log(s,"Flannel: fetching next page for query",t);return e(t,n,r)})};var r=function n(r){var a=_.chunk(r,e);var s=Promise.map(a,function(e){var t=i({ids:e});t.catch(function(t){TS.warn("Flannel chunk fetch failed: ",e);TS.logError(t)});return t.reflect()},{concurrency:t});return s.then(function(e){var t=e.filter(function(e){return e.isRejected()}).map(function(e){return e.reason()});if(t.length){var n=new Error("Some Flannel fetches failed");n.rejection_reasons=t;return Promise.reject(n)}var r=_(e).map(function(e){return e.value().objects}).flatten().value();return Promise.resolve(r)})};var i=function e(t,r){if(_.isString(t))t={query:t};var i=[];return n(t,i,r)};var a=function e(t){return TS.utility.url.setUrlQueryStringValue(TS.boot_data.ms_connect_url,"start_args",TS.utility.url.queryStringEncode(t))};var s=1989})()},4242:function(e,t){(function(){"use strict";TS.registerModule("ds",{last_pong_time:0,sent_map:{},connected_sig:new signals.Signal,disconnected_sig:new signals.Signal,trouble_sig:new signals.Signal,reconnecting_sig:new signals.Signal,pong_sig:new signals.Signal,on_msg_sig:new signals.Signal,reconnect_requested_sig:new signals.Signal,onStart:function e(){b(TS.model.ui.is_window_focused||false);TS.ui.window_focus_changed_sig.add(b);setInterval(function(){if(!TS.model.ds_connected)return;if(TS.model.rtd_start_throttler<1)return;TS.model.rtd_start_throttler-=1},6e4)},send:function e(t,n,r){g+=1;t.id=g;TS.ds.sent_map[t.id.toString()]={msg:t,handler:n,ts:Date.now(),temp_ts:r};if("ping"===t.type||"pong"===t.type){if(TS.has_pri[$])TS.log($,"DS TS.ds ping --\x3e\n"+JSON.stringify(t,null,"  "))}else{TS.model.last_net_send=Date.now();if(TS.has_pri[$])TS.log($,"TS.ds --\x3e\n"+JSON.stringify(t,null,"  "))}if(h&&TS.model.ds_connected)h.send(JSON.stringify(t));else TS.ds.Q.push(t);return t.id},Q:[],sendTyping:function e(t){var n='{"type":"typing", "channel":"'+t+'"}';h.send(n)},handleMsg:function e(t){var n=t.reply_to&&!("ok"in t)&&"message"===t.type;var r;if(t.reply_to)if(t.reply_to.toString()in TS.ds.sent_map){r=TS.ds.sent_map[t.reply_to];t.SENT_MSG=r.msg;delete TS.ds.sent_map[t.reply_to]}else if(!n)TS.error('received msg "'+t.reply_to+'" with type "'+t.type+'" but we have no record of it in sent_map');if("ping"===t.type||"pong"===t.type){if(TS.has_pri[$]){TS.log($,"DS msg "+t.type+" time: "+(Date.now()-r.ts)+"ms");TS.log($,"DS TS.ds ping <--\n"+JSON.stringify(t,null,"  "))}TS.ds.last_pong_time=Date.now();TS.ds.pong_sig.dispatch();S=false}else{if(r){var i=t.type||t.SENT_MSG.type||"";if(TS.has_pri[$])TS.log($,"msg "+(i?'"'+i+'" ':"")+"rsp time "+(Date.now()-r.ts)+"ms")}if(TS.has_pri[$])TS.log($,"TS.ds <-- \n"+JSON.stringify(t,null," "))}if("error"===t.type)B(t);else if(!t.reply_to){TS.ds.on_msg_sig.dispatch(t);if("hello"===t.type)H(t)}if(r){if(!t.ok)t.error=t.error||{code:0,msg:"unknown error (not specified by MS)"};if(n)t.ok=true;if(r.handler)r.handler(t.ok,t)}},onFailure:function t(r){if(r)M("You got disconnected, so here are some details:\n>>>"+r);S=false;I();if(TS.model.ds_connected){TS.info("Disconnected from DS, TS.model.rtd_start_throttler:"+TS.model.rtd_start_throttler);TS.ds.logConnectionFlow("on_connected_failure");TS.model.ds_reconnect_ms=100;TS.ds.disconnect()}else{TS.ds.logConnectionFlow("on_notconnected_failure");TS.model.ds_reconnect_ms=1.3*(TS.model.ds_reconnect_ms+1e3);var i=TS.model.ds_reconnect_ms;if(TS.model.ds_reconnect_ms>4e3)TS.model.ds_reconnect_ms=_.random(i,i+i/3);TS.model.ds_reconnect_ms=Math.min(TS.model.ds_reconnect_ms,3e5)}if(TS.model.rtd_start_throttler>5){var a=2e3*TS.model.rtd_start_throttler;if(TS.model.ds_reconnect_ms<a){TS.info("because TS.model.rtd_start_throttler:"+TS.model.rtd_start_throttler+" we are increasing time until next login call");TS.model.ds_reconnect_ms=a}}if(TS.model.ds_connected){TS.model.ds_connected=false;TS.ds.disconnected_sig.dispatch()}TS.model.ds_connected=false;clearInterval(n);clearInterval(e);if(TS.model.ds_asleep){TS.warn("NOT doing startReconnection(), we are asleep");return}TS.ds.startReconnection()},startReconnection:function e(){TS.model.ds_reconnect_time=Date.now()+TS.model.ds_reconnect_ms;TS.info("Attempting to reconnect in "+TS.model.ds_reconnect_ms+"ms");clearInterval(m);m=setInterval(A,f);A();clearTimeout(p);p=setTimeout(function(){if(!TS.model.window_unloading)TS.ds.reconnect_requested_sig.dispatch()},TS.model.ds_reconnect_ms)},manualReconnectNow:function e(){TS.ds.logConnectionFlow("manual_reconnect");clearTimeout(p);clearInterval(m);clearTimeout(i);v=0;if(!TS.model.window_unloading){TS.ds.reconnect_requested_sig.dispatch();TS.ds.reconnecting_sig.dispatch(0)}},disconnect:function e(){if(h&&TS.model.ds_connected){TS.ds.logConnectionFlow("disconnect");h.close()}else TS.warn("TS.ds.disconnect called, but _websocket="+h+" TS.model.ds_connected="+TS.model.ds_connected)},logConnectionFlow:function e(t){var n=TS.model.ds_conn_log;var r=Date.now();n.push({name:t,time:r,delta:n.length?r-n[n.length-1].time:0});if(TS.has_pri[$])TS.log($,"logConnectionFlow "+t+" "+n[n.length-1].delta)},getConnectionFlowLog:function e(){var t=TS.model.ds_conn_log;var n=[];for(var r=0;r<t.length;r+=1)n.push(encodeURIComponent(t[r].name+"-"+(t[r].delta?Math.round(t[r].delta/1e3):0)+"-"+Math.round(t[r].time/1e3)));TS.dir(2,TS.model.ds_conn_log);var i="_x_connection_log="+n.join(",");return i},connect:function e(){if(!window.WebSocket)window.WebSocket=window.MozWebSocket;if(window.WebSocket){var t;try{TS.ds.logConnectionFlow("connect");t=TS.web.space.login_data.ws;var n=1==TS.qs_args.simulate_old_token?"&TRIGGER_OLD_TOKEN=1":"";t+="?version_uid="+TS.boot_data.version_uid+n;t=TS.utility.appendLogToUrlWithLimit(t,TS.ds.getConnectionFlowLog());TS.info("Connecting to: "+t);if(1==TS.qs_args.simulate_first_connect_failure&&!window.already_simulated_first_connect_failure){t=t.replace("e","w");TS.info("simulate_first_connect_failure url:"+t);window.already_simulated_first_connect_failure=true}a=window.WEB_SOCKET_USING_FLASH?o:s;clearTimeout(i);i=setTimeout(F,a);TS.ds.last_url=t;TS.ds.last_start_ms=Date.now();I();h=new WebSocket(t)}catch(e){TS.warn("failed to create new WebSocket");TS.error(e);TS.ds.onFailure("failed to create new WebSocket");return}TS.model.ds_connecting=true;if(1==TS.qs_args.simulate_first_connect_timeout&&v<1)TS.info("simulate_first_connect_timeout url:"+t);else h.onopen=w;h.onclose=C;h.onerror=O}else alert(TS.i18n.t("Your browser does not support Web Sockets.","ds")())},sleep:function e(){if(TS.model.ds_asleep)return;if(!TS.model.ds_connected)return;TS.model.ds_asleep=true;TS.ds.disconnect()},wake:function e(){if(!TS.model.ds_asleep)return;TS.model.ds_asleep=false;TS.ds.startReconnection()}});var e=0;var t=3e3;var n=0;var r=1e4;var i=0;var a=0;var s=1e4;var o=2e4;var l=0;var u=3e4;var d=0;var c=5e3;var m=0;var f=1e3;var p=0;var h=null;var g=0;var S=false;var T=0;var v=0;var b=function e(t){if(t)T=1e4;else T=6e4;T+=r;if(TS.has_pri[$])TS.log($,"DS _pong_timeout_ms set to:"+T+" has_focus:"+t)};var y=function e(t){var n=JSON.parse(t.data);TS.ds.handleMsg(n)};var w=function e(){clearTimeout(i);v=0;if(1==TS.qs_args.simulate_hello_timeout&&!window.already_simulated_hello_timeout){TS.info("simulate_hello_timeout");window.already_simulated_hello_timeout=true}else h.onmessage=y;TS.model.ds_conn_log.length=0;TS.info("DS WS connected!");TS.ds.logConnectionFlow("on_connect");clearTimeout(l);l=setTimeout(E,u)};var k=function e(){if(!S)return;var t=Date.now()-TS.ds.last_pong_time;if(TS.has_pri[$])TS.log($,"DS MS since_last_pong_ms:"+t+" pong_timeout_ms:"+T);if(t<T)return;TS.warn("since_last_pong_ms too long! "+t+" > "+T);TS.warn("calling disconnect(), expect to get an onDisconnect() callback");TS.ds.logConnectionFlow("on_ping_timeout");TS.ds.trouble_sig.dispatch();S=false;M("You are on team Tiny Speck, so here are some pong details:\n>>>since_last_pong_ms too long! "+t+" > "+T+" ... calling disconnect(), expect to get an onDisconnect() callback");try{TS.ds.disconnect();clearTimeout(d);d=setTimeout(function(){TS.info("called disconnect, no onDisconnect callback happened in "+c+"ms, so calling _onDisconnect() manually now");C(null,"since_last_pong_ms too long! then called disconnect, but no onDisconnect callback happened in "+c+"ms, so calling _onDisconnect() manually now")},c)}catch(e){TS.info("since_last_pong_ms too long! then an error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now");TS.warn(e);C(null,"error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now")}};var x=function e(){TS.ds.send({type:"ping"});S=true};var C=function e(t,n){n=n||"_onDisconnect called with event:"+t;TS.info("DS WS disconnected");TS.ds.logConnectionFlow("on_disconnect");clearTimeout(d);clearTimeout(l);clearTimeout(i);if(t)TS.info("_onDisconnect event.code:"+t.code);else TS.info("no event");TS.ds.onFailure(n)};var M=function e(t){TS.warn("_reportDisconnect reason_str:"+t)};var I=function e(){if(!h)return;h.onmessage=null;h.onopen=null;h.onerror=null;h.onclose=null;try{h.close()}catch(e){}};var A=function e(){var t=TS.model.ds_reconnect_time-Date.now();var n=Math.round(t/1e3);if(n>=0)TS.ds.reconnecting_sig.dispatch(n);if(TS.model.window_unloading)clearInterval(m)};var E=function e(){var t="socket received no hello msg "+u+"ms after connection";TS.warn(t);TS.ds.logConnectionFlow("_onHelloTimeout");TS.ds.onFailure(t)};var F=function e(){v+=1;var t="socket not connected "+a+"ms after creation. _connect_timeout_count:"+v;TS.warn(t);TS.ds.logConnectionFlow("_onConnectTimeout");if(3==v){TS.client.showConnectionTroubleDialog();return}else if(2==v)if(window.WEB_SOCKET_USING_FLASH);else if(TS.model.is_chrome_desktop){s=2e4;return}TS.ds.onFailure(t)};var O=function e(t){var n="";if(t){if(t.name)n+=" e.name="+t.name;if(t.message)n+=" e.message="+t.message;if(t.data)n+=" e.data="+t.data}TS.warn("_onError err_str: "+n);TS.dir(0,t)};var B=function e(t){if(t.error)if(1==t.error.code)TS.ds.logConnectionFlow("msg_error_code_1");else{TS.info("_onErrorMsg websocket is connected but we got an error message: "+JSON.stringify(t));TS.ds.onFailure("_onErrorMsg imsg.error:"+t.error)}else TS.info("_onErrorMsg: "+(t?JSON.stringify(t):"no imsg?"))};var H=function i(){clearTimeout(l);var a=Date.now()-TS.ds.last_pong_time;TS.info("Hello msg recvd, since_last_pong_ms:"+a);TS.ds.logConnectionFlow("on_hello");clearInterval(m);S=true;TS.ds.last_pong_time=Date.now();clearInterval(e);e=setInterval(k,t);clearInterval(n);n=setInterval(x,r);TS.model.ds_connecting=false;TS.model.ds_connected=true;var s;for(var o=0;o<TS.ds.Q.length;o+=1){s=TS.ds.Q.shift();if(TS.has_pri[$])TS.log($,"TS.ds (Q) --\x3e\n"+JSON.stringify(s,null,"  "));h.send(JSON.stringify(s))}TS.ds.connected_sig.dispatch();x()};var $=2})()},4243:function(e,t){(function(){"use strict";TS.registerModule("templates",{onStart:function t(){n();if(TS.members)TS.members.user_color_changed_sig.add(TS.templates.memberUserColorChanged,TS.templates);if(TS.prefs)TS.prefs.sidebar_behavior_changed_sig.add(TS.templates.sidebarBehaviorPrefChanged,TS.templates);TS.environment.retina_changed_sig.add(e)},makeUnreadMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_messages_"+t.id)},makeRxnKeyDomClass:function e(t){return TS.utility.makeSafeForDomId("rxns_key_"+t)},makeUnreadGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_group_messages_"+t.id)},makeUnreadDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_dms_"+t.id)},makeSentMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_messages_"+t.id)},makeSentGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_group_messages_"+t.id)},makeIssueListDomId:function e(t){return"issue_list_"+t},makeSentDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_dms_"+t.id)},makeMsgDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t)},makeMsgLabelDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t+"_label")},makeMsgAttachmentTextExpanderDomId:function e(t,n){return TS.utility.makeSafeForDomId("msg_rest_text_expander_"+t+"_"+n)},makeMSRDomId:function e(t){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts)},makeMSRDomIdWithModule:function e(t,n){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts+"_"+n)},makeSHRoomClass:function e(t){return TS.utility.makeSafeForDomId("screenhero_room_"+t)},makeChannelDomId:function e(t){return"channel_"+t.id},makeChannelDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,is_channel:t.is_channel||false,is_group:t.is_group||false,is_im:t.is_im||false,is_mpim:t.is_mpim||false,is_self_im:t.is_self_im||false,is_slackbot_im:t.is_slackbot_im||false,purpose:t.purpose?t.purpose.value:"",topic:t.topic?t.topic.value:""})},makeFileDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,title:t.title,mimetype:t.mimetype,filetype:t.filetype,size:t.size})},makeDayDividerDomId:function e(t){return TS.utility.makeSafeForDomId("day_divider_"+t)},makeGroupDomId:function e(t){return"group_"+t.id},makePriorityIconDomId:function e(t){return"priority_"+t.id},makeStarredIconDomId:function e(t){return"starred_"+t.id},makeMutedIconDomId:function e(t){return"muted_"+t.id},makeMemberDomId:function e(t){if(!t)return;return TS.templates.makeMemberDomIdById(t.id)},makeMemberDomIdById:function e(t){if(!t)return;return"member_"+t},makeMpimDomId:function e(t){return"mpim_"+t.id},makeChannelListDomId:function e(t){return"channel_"+t.id+"_member_list"},makeFileDomId:function e(t){return"file_"+t.id},makeFileCommentsDomId:function e(t){return"file_comments_"+t.id},makeFileContentsDomId:function e(t){return"file_contents_"+t.id},makeUnreadMsgsDomId:function e(t){return"unread_msg_"+t.id},makeUnreadHighlightDomId:function e(t){if(!t)return;return"unread_highlight_"+t.id},makeMemberPresenceDomClass:function e(t){return"member_presence_"+t},makeMemberPresenceStateClass:function e(t){var n=t.presence;if(TS.dnd.isMemberInDnd(t))n+=" dnd";return n},makeMemberPresenceStateAriaLabel:function e(t){var n=t.presence;var r="";if("active"===n)r+="active";else if("away"===n)r+="away";if(TS.dnd.isMemberInDnd(t))r+=", do not disturb";return r},makeMemberPresenceIcon:function e(t){if(t.deleted)return"";var n=TS.templates.makeMemberPresenceDomClass(t.id);var r="ts_icon_presence";var i="active"===t.presence?TS.i18n.t("active","templates_helpers")():TS.i18n.t("away","templates_helpers")();if(t.is_ultra_restricted){n+=" ura";r="ts_icon_presence_ura"}else if(t.is_restricted){n+=" ra";r="ts_icon_presence_ra"}else if(TS.utility.teams.isMemberExternal(t)){n+=" external";r="ts_icon_presence_external"}else if(t.is_slackbot)r="ts_icon_heart";var a='<i aria-hidden="true" class="ts_icon '+r+' presence_icon"></i>';var s=TS.templates.makeMemberPresenceStateClass(t);var o='<span data-member-presence="'+t.id+'" class="presence '+s+" "+n+'" title="'+i+'">'+a+"</span>";return o},makeMemberStatusDomClass:function e(t){return"member_status_"+t},memberUserColorChanged:function e(t){var n="color_"+t.id;if(t.color==t.member_color){var r="color_rule_"+n;var i=$("#"+r);i.remove();return}TS.templates.makeUserColorRule(t)},makeUserColorRule:function e(t){var n="color_"+t.id;var r="#"+_.escape(t.member_color);var i;if(TS.client)i="\t\t\t\t."+n+":not(.nuc), \t\t\t\t#col_channels ul li:not(.active):not(.away) > ."+n+":not(.nuc) {\t\t\t\t\tcolor:"+r+";\t\t\t\t}\t\t\t";else i="\t\t\t\t."+n+":not(.nuc) {\t\t\t\t\tcolor:"+r+";\t\t\t\t}\t\t\t";var a="color_rule_"+n;var s=$("#"+a);if(s.length)s.text(i);else $('<style type="text/css" id="'+a+'">'+i+"</style>").appendTo("body")},sidebarBehaviorPrefChanged:function e(){TS.templates.makeSidebarBehaviorRule()},makeSidebarBehaviorRule:function e(){var t;var n="sidebar_behavior";var r=$("#"+n);if("hide_read_channels"===TS.model.prefs.sidebar_behavior)t="\t\t\t\t.channels_list_holder ul li:not(.unread):not(.active):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}";else if("hide_read_channels_unless_starred"===TS.model.prefs.sidebar_behavior)t="\t\t\t\t.channels_list_holder div:not(#starred_div)>ul li:not(.unread):not(.active):not(.is_starred):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}";if(t)if(r.length)r.text(t);else $('<style type="text/css" id="'+n+'">'+t+"</style>").appendTo("head");else $("#"+n).remove()},makeMsgDomIdInConversation:function e(t){return TS.templates.makeMsgDomId(t)+"_conversation"},makeMsgDomIdInSearch:function e(t,n){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(n)},makeMsgDomIdInSearchTopResults:function e(t,n,r){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(n)+"_"+r},makeMsgDomIdInUnreadView:function e(t){return TS.templates.makeMsgDomId(t)+"_unread_view"},makeMsgDomIdInThreadsView:function e(t){return TS.templates.makeMsgDomId(t)+"_threads_view"},promiseToRenderAsync:function e(t,n){if(!t)return Promise.reject(new Error("No template to render"));return Promise.resolve(n).then(function(e){return t(e)})}});var e=function e(){var t;var n;var r;var i;$(".member_image").each(function(){i=$(this);t=i.data("member-id");n=i.data("thumb-size");r=!i.is("a");if(t&&n)$(this).replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(t,n,false,r))});i=null};var t=/{{\s*i18n_ns\s*('|")[a-zA-Z0-9]+('|")\s*}}/;var n=function e(){Object.keys(TS.raw_templates).forEach(function(e){TS.templates[e]=r(e,TS.raw_templates[e]);Handlebars.registerPartial(e,TS.templates[e])});delete TS.raw_templates};var r=function e(n,r){if(!r){TS.warn(n+" was passed no html");return null}if(t.test(r))r+=" {{_i18n_ns_end}}";var i=Handlebars.compile(r);return function(e){e=e||{};return i(e)}}})()},4244:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("templates.builders",{debug_items:{},debug_items_index:0,buildStarComponents:function e(t,n,r){return i(t,n,r)},fileHTML:function e(t,n){n=n||{};var r=TS.utility.members.getEntityFromFile(t);var i=TS.files.getFileActions(t);var a;var s="hosted"===t.mode||"external"===t.mode;var o={member:r,file:t,for_search:n.for_search,is_enterprise:n.is_enterprise,for_files_list:!n.for_share_dialog,icon_class:TS.utility.getImageIconClass(t,"thumb_80"),is_email:"email"===t.mode,is_space:"space"===t.mode,is_post:"post"===t.mode,is_snippet:"snippet"===t.mode,is_hosted_or_external:s,has_image:s&&t.thumb_80&&!t.has_rich_preview,can_share:!!i.share};if(TS.client)o.info_pane_visible="details"===TS.model.ui_state.flex_name;o.supports_line_clamp=TS.environment.supports_line_clamp;if("external"===t.mode)o.external_filetype_html=TS.templates.builders.makeExternalFiletypeHTML(t);if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}a=TS.templates.file_list_item(o);return a},buildReplyBarHTML:function e(t,n){var r={msg:t,model_ob:n,conversation_permalink:TS.utility.msgs.constructConversationPermalink(n,t.thread_ts)};var i=t.replies;if(i&&i.length){r.num_replies=i.length;var a=_.chain(i).map(function(e){return TS.members.getPotentiallyUnknownMemberById(e.user)}).compact().uniq().value();r.first_repliers=_.take(a,5);r.additional_reply_count=a.length-r.first_repliers.length;var s=_.last(i).ts;var o=TS.interop.datetime.toDateObject(s);if(TS.interop.datetime.isSameDay(o,new Date))if(1===r.num_replies)r.last_reply_at=TS.i18n.t("Today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})});else r.last_reply_at=TS.i18n.t("Last reply today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})});else if(1===r.num_replies)r.last_reply_at=TS.interop.datetime.toTimeAgo(s);else r.last_reply_at=TS.i18n.t("Last reply {time_ago}","threads")({time_ago:TS.interop.datetime.toTimeAgo(s)})}return TS.templates.message_reply_bar(r)},formatSoundUrl:function e(t,n){return""},buildAttachmentActions:function e(t,n){var r=t.actions.map(function(e){switch(e.type){case"button":return TS.templates.builders.buildAttachmentActionButtonHTML(e,n);case"select":return TS.templates.builders.buildAttachmentActionSelectHTML(e,n)}return});var i=r.join("");return i},buildAttachmentHTML:function e(t){var n=t.msg_dom_id||TS.templates.makeMsgDomId(t.msg.ts);var r=t.attachment;var i=t.model_ob||TS.shared.getActiveModelOb();if(TS.templates.builders.shouldDoSimpleAttachment(r,t.msg))if(r.video_html)return TS.templates.builders.buildInlineVideoTogglerAndDiv(r.from_url,n);else if(r.image_url)return TS.templates.builders.buildInlineImgTogglerAndDiv(r.from_url,n,t);else if(r.audio_url)return" "+TS.templates.builders.formatSoundUrl(r,t.msg);if(r.color){if("number"===typeof r.color)r.color=r.color.toString();if(!r.color.indexOf){TS.warn("msg "+t.msg.ts+" has an invalid (non string) color:"+r.color+" (removed in client)");delete r.color}else r.color=r.color.replace(/#/g,"")}var a=[];var s=[];if(r.fields){var o;var l;var u;for(var d=0;d<r.fields.length;d+=1){l=true;o=r.fields[d];if(u&&o.short&&u.short&&u._new_row)l=false;o._new_row=l;u=o;if(o.short)a.push(o);else s.push(o)}}var c=!r._always_expand&&r._short_text&&!TS.inline_attachments.shouldExpandText(TS.templates.makeMsgAttachmentTextExpanderDomId(t.msg.ts,r._index));var m=!!r.more;var f=r.from_url||r.ts_link||r.title_link||r.author_link;var p="reply_broadcast"===_.get(t.msg,"subtype");var h=r.thumb_link||f;var g=false;if(!i)TS.warn("need to get model_ob passed in here somehow! for expanding messages in activity feed");else if(false!==t.can_delete)g=(r.id||0===r.id)&&(r.from_url||t.msg.text)&&(TS.model.user.is_admin&&!i.is_im||TS.model.user.id==t.msg.user)&&"pinned_item"!==t.msg.subtype&&!p;var S=r.thumb_url&&!r.image_url&&!r.video_html&&!r.audio_html;var T=S?r.proxied_thumb_url||r.thumb_url:null;var v=false;var b="";if(r.is_msg_unfurl){var y=TS.utility.msgs.getMsg(r.ts,i.msgs);if(y&&y.pinned_to&&y.pinned_to.length>0){v=_.some(y.pinned_to,function(e){return e===i.id});if(v&&!p)b=TS.templates.builders.buildPinInfoHtml(y)}}var w=false;if(p)if(r.ts)w=TS.interop.datetime.toTime(r.ts,{do24hrTime:TS.utility.date.do24hrTime()});else w=TS.interop.datetime.toTime(t.msg.ts,{do24hrTime:TS.utility.date.do24hrTime()});var k=r.from_url&&t.has_container;if(p)k=true;var x={is_text_collapsed:c,has_more:m,attachment:r,attachment_meta:w,pin_html:b,short_fields:a,long_fields:s,msg:t.msg,msg_dom_id:n,real_src:TS.utility.attachments.getMediaSource(r),is_standalone:!t.msg.text||t.msg.ignore_if_attachments_supported||!r.pretext,show_fields_table:"0"!=TS.qs_args.show_fields_table,can_delete:g,thumb_link:h,small_thumb_url:T,show_fallback:TS.model.show_attachment_fallback,enable_slack_action_links:true===t.enable_slack_action_links};if(!t.from_post){var C="web"===TS.boot_data.app||true!==t.enable_slack_action_links;var M;if(C)if("web"===TS.boot_data.app)M="ARCHIVES";else if(TS.shared.getActiveModelOb().is_channel&&!TS.shared.getActiveModelOb().is_member)M="CHANNEL_PREVIEW";else M="OTHER";x=_.assign(x,{attachment:r,has_actions:!!(!_.isEmpty(r.actions)||!_.isEmpty(r.legacy_actions)),has_source:_.some(r._source),has_border:t.has_border,has_indent:r.indent,has_container:t.has_container,has_media:t.show_media_caret,has_text_content:!!(r.text||r.title),has_thumb:!!S,has_footer:!!(r.footer||r.footer_icon||r.ts||r._attribution)&&!p,disable_actions:C,disable_actions_reason:M,border_color:r.color&&"#"+r.color||null,break_border:t.break_border,caret_location:TS.utility.attachments.getMediaCaretLocation(r)});x.applied_classes=TS.utility.getAppliedClasses({inline_attachment:true,standalone:x.is_standalone,has_thumb:x.has_thumb,can_delete:x.can_delete,clickable:k,message_unfurl:r._unfurl_type_message,reply_broadcast:p,is_pinned:v});if(TS.boot_data.feature_connecting_shared_channels&&TS.utility.attachments.shouldTransformAttachmentForSharedChannelRequest(t.msg,r)){x.has_text_content=false;x.shared_channel_request_actions=TS.utility.attachments.generateSharedChannelRequestAttachmentActions(r)}if(x.has_footer&&x.attachment.is_msg_unfurl&&x.attachment.channel_name)if("Direct Message"===x.attachment.channel_name)x.attachment.footer=TS.i18n.t("Direct Message","chat_messages")();else if("External Message"===x.attachment.channel_name)x.attachment.footer=TS.i18n.t("From {team_name}","chat_messages")({team_name:x.attachment.team_name});else if(x.attachment.is_thread_root_unfurl)x.attachment.footer=TS.i18n.t("Thread in #{channel_name}","chat_messages")({channel_name:x.attachment.channel_name});else if(x.attachment.is_reply_unfurl)x.attachment.footer=TS.i18n.t("From a thread in #{channel_name}","chat_messages")({channel_name:x.attachment.channel_name});else x.attachment.footer=TS.i18n.t("Posted in #{channel_name}","chat_messages")({channel_name:x.attachment.channel_name});return TS.templates.message_attachment(x)}var I=true;var A="";if(t.show_initial_caret||t.show_media_caret){var E=TS.utility.attachments.getMediaType(r);switch(E){case"video":var F=TS.model.inline_videos[r.from_url||r.thumb_url];if(F){var O=true;A=TS.templates.builders.buildInlineVideoToggler(r.from_url||r.thumb_url,n,O);I=TS.inline_videos.shouldExpand(n,F)}break;case"audio":var B=TS.model.inline_audios[r.audio_html||r.audio_url];if(B){A=TS.templates.builders.buildInlineAudioToggler(r.audio_html||r.audio_url,n);I=TS.inline_audios.shouldExpand(n,B)}break;case"other":var H=TS.model.inline_others[r.other_html];if(H){A=TS.templates.builders.buildInlineOtherToggler(r.other_html,n);I=TS.inline_others.shouldExpand(n,H)}break;case"image":var $=TS.model.inline_imgs[r.from_url||r.image_url];if($){var D=!t.show_media_caret;A=TS.templates.builders.buildInlineImgToggler(r.from_url||r.image_url,n,D);I=TS.inline_imgs.shouldExpand(n,$)}break;default:var P=TS.model.inline_attachments[r.from_url];if(P){A=TS.templates.builders.buildInlineAttachmentToggler(r.from_url,n);I=TS.inline_attachments.shouldExpand(n,P)}else TS.warn("no inline_attachment for "+r.from_url)}}_.assign(x,{initial_caret_html:t.show_initial_caret?new Handlebars.SafeString(A):"",media_caret_html:t.show_media_caret?new Handlebars.SafeString(A):"",expand_media:t.show_media_caret?I:true,expand_it:t.show_initial_caret?I:true,bg_color:r.color||"e3e4e6",thumb_at_top:!window.attach_thumb_align_title,ts_link:f,small_thumb:S,max_width_class:S?"right_thumb_max_w":"",show_action_links:true===t.enable_slack_action_links,has_content:t.has_content});return TS.templates.spaces_attachment(x)},buildAttachmentActionButtonHTML:function e(t,n){n=true===n;var r={_disabled:n,_loading:false,id:"",name:"",style:"default",text:"",value:""};var i={default:"",primary:"btn_primary",danger:"btn_danger"};var a=t.clicked&&t.clicked_text?t.clicked_text:t.text;var s=TS.emoji.graphicReplace(a);var o=_.merge({},r,t,{btn_class:i[t.style],current_text:new Handlebars.SafeString(s)});return TS.templates.attachment_actions_button(o)},buildAttachmentActionSelectHTML:function e(t,n){var r=TS.attachment_actions.select.getActionModel(t,n);return TS.templates.attachment_actions_select(r)},shouldDoSimpleAttachment:function e(t,n){var r=false;if(n.standalone_attachment)return false;if((t.image_url||t.audio_url)&&t.from_url){if(n&&n.text){if(-1!=n.text.indexOf(t.from_url))r=true;if(TS.model.ampersands_are_inconsistent_in_from_urls)if(-1!=n.text.indexOf(t.from_url.replace(/&/g,"&amp;")))r=true}if(t.service_name||t.title)r=false}return r},formatAttachments:function e(t,n,r,i){if(!t.attachments)return"";var a="";var s;var o=[];var l;var u=t.attachments.length;var d=20;if(t.attachments.length>=d){if(!t._shown_attachments)t._shown_attachments=d;u=t._shown_attachments}for(s=0;s<u;s+=1){l=t.attachments[s];if(l.pretext||0===s)o.push([]);_.last(o).push(l)}for(s=0;s<o.length;s+=1)a+=TS.templates.builders.formatAttachmentGroup(o[s],t,r,i,n);if(t._shown_attachments<t.attachments.length)a+=TS.templates.builders.getShowMoreAttachmentHTML(t);return a},formatAttachmentGroup:function e(t,n,r,i,a){r=true===r;var s="";var o=false;t=t.map(function(e){return TS.utility.attachments.getDecoratedAttachment(e,n)});var l=n&&"reply_broadcast"===n.subtype;if(l)o=true;var u=o&&_.some(t,TS.utility.attachments.getMediaType);var d=o?_.some(t,"color"):true;var c=_.some(t,"from_url");var m=_.some(t,"indent");var f=false;if(l){var p=n.channel_id||_.get(t[1],"channel_id");var h=n.broadcast_thread_ts;if((!p||!/\d+\.\d+/.test(h))&&t[1]&&t[1].from_url){var g=t[1].from_url;var S=TS.utility.url.urlQueryStringParse(g);if(S.cid)p=S.cid;if(S.thread_ts)h=S.thread_ts}a=TS.shared.getModelObById(p);if(a&&h){if(h.indexOf(".")<0)h=h.substr(0,10)+"."+h.substr(10);var T={thread_ts:h,model_ob_id:a.id,convo_href:TS.utility.msgs.constructConversationPermalink(a,h)};f=TS.templates.reply_broadcast_preamble(T);f=new Handlebars.SafeString(f)}}var v;for(var b=0;b<t.length;b+=1){v=t[b];if(!v){TS.info("formatAttachments bad attach");TS.dir(0,n);continue}if(v.from_url&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(v,n))){s+="";continue}if(v.ts)v.ts_link=TS.utility.msgs.constructMsgPermalink(a,v.ts.toString());if(!TS.inline_attachments.shouldShow(v,n)){s+="";continue}if(v.actions&&v.actions.length){var y=["button","select"];var w;var k=[];var x=[];for(var C=0;C<v.actions.length;C+=1){w=v.actions[C];if(_.includes(y,w.type))x.push(w);else k.push(w)}if(k.length)v.legacy_actions=k;if(x.length)v.actions=x}var M=TS.utility.attachments.hasContent(v,["pretext"]);if(M){var I=t[b+1];s+=TS.templates.builders.buildAttachmentHTML({model_ob:a,attachment:v,has_border:d,has_indent:m,has_container:o,break_border:d&&I&&v.color!=I.color,url:null,msg:n,msg_dom_id:i,show_initial_caret:TS.templates.builders.shouldDoSimpleAttachment(v,n),show_media_caret:v.video_html||v.image_url||v.audio_html||v.audio_url||v.other_html,enable_slack_action_links:r,has_content:M})}if(l&&0===b)s+=TS.templates.reply_broadcast_count(v)}if(s||v.pretext)return TS.templates.attachment_group({model_ob:a,first_attachment:t[0],preamble:f,msg:n,has_border:d,has_indent:m,has_container:o,has_link:c,use_shrink_wrap:u,attachments_html:s&&new Handlebars.SafeString(s),enable_slack_action_links:r});return s},getShowMoreAttachmentHTML:function e(t){var n=t.attachments.length-t._shown_attachments;var r="";var i=t.ts;var a=TS.shared.getActiveModelOb();var s=false;if(TS.client&&!(a.is_channel&&!a.is_member)){s=true;if(t.attachments.length-t._shown_attachments>20)r=TS.i18n.t("Show next 20 items","attachments")();else r=TS.i18n.t("{count, plural, =1 {Show remaining # item} other {Show remaining # items}}","attachments")({count:n})}else r=TS.i18n.t("{count, plural, =1 {# more attachment} other {# more attachments}}","attachments")({count:n});return TS.templates.show_more_attachment({ts:i,btn_text:r,clickable_show_more_link:s})},formatMessageAsAttachment:function e(t,n){var r;var i;var a;if(t.user)i=t.user;else if("file_comment"===t.subtype&&t.comment&&t.comment.user)i=t.comment.user;else if(t.bot_id)a=t.bot_id;if(!t.text&&t.attachments&&t.attachments.length>=1&&t.attachments[0].is_share)r={author_name:t.attachments[0].author_name,author_subname:t.attachments[0].author_subname,author_icon:t.attachments[0].author_icon,author_link:t.attachments[0].author_link};else if(i){var s=TS.members.getMemberById(i);r={author_name:TS.members.getMemberRealName(s),author_subname:TS.boot_data.feature_name_tagging_client?TS.members.getMemberProfileFieldDisplayName(s):s.name,author_icon:s.profile.image_24};if(TS.boot_data.feature_name_tagging_client||TS.boot_data.feature_shared_channels_client)r.author_link="/team/"+i;else r.author_link="/team/"+_.escape(s.name)}else if(a){var o=TS.bots.getBotByMsg(t);r={author_subname:t.username||o.name,author_icon:o&&o.icons.image_48,author_link:"/services/"+a};if(t.icons&&t.icons.emoji&&t.icons.image_64)r.author_icon=t.icons.image_64}if(!r){TS.error("no author for msg "+t.ts);return""}var l=_.extend({},r,{is_msg_unfurl:true,id:1,ts:t.ts,from_url:TS.utility.msgs.constructAbsoluteMsgPermalink(n,t.ts),msg_subtype:t.subtype});if(t.text){l.text=t.text;l.mrkdwn_in_hash={text:true}}else if(t.attachments&&t.attachments.length>=1){var u=t.attachments[0];l.text=u.text||u.pretext}TS.inline_attachments.massageAttachment(l,0);l=TS.utility.attachments.getDecoratedAttachment(l,t);l.from_url=null;var d=TS.templates.builders.buildAttachmentHTML({attachment:l,msg:t,can_delete:false,has_content:true,has_border:true});d=TS.templates.attachment_group({msg:t,attachments_html:new Handlebars.SafeString(d)});return d},buildSHRoomAttachment:function e(t){var n=t.participants.map(function(e){return TS.members.getPotentiallyUnknownMemberById(e)});var r=t.created_by===TS.model.user.id;var i=TS.model.active_im_id?TS.members.getMemberById(TS.ims.getImById(TS.model.active_im_id).user):null;var a=i?TS.members.getPrefCompliantMemberName(i):"";var s=t.date_end?t.date_end-t.date_start:0;var o=TS.i18n.t("Shared a call","calls")();if(t.channels&&t.channels[0]===TS.model.active_cid)o=TS.i18n.t("Started a call","calls")();var l="";if(t.date_end)if(t.is_dm_call&&t.was_missed)if(t.was_rejected)if(r)l=TS.i18n.t("{name} declined the call","calls")({name:a});else l=TS.i18n.t("You declined the call","calls")();else if(r)l=TS.i18n.t("{name} missed the call","calls")({name:a});else l=TS.i18n.t("You missed the call","calls")();else l=TS.i18n.t("This call has ended","calls")();else if(!t.is_dm_call)l=-1!=t.participants.indexOf(TS.model.user.id)?TS.i18n.t("You are on this call","calls")():TS.i18n.t("Join this call","calls")();else if(2===t.participants.length)l=TS.i18n.t("On a call with {name}","calls")({name:a});else l=(r?TS.i18n.t("Calling {name}","calls"):TS.i18n.t("{name} is calling you","calls"))({name:a});var u;if(t.name)u=TS.i18n.t("{room_name} call","calls")({room_name:t.name});else u=TS.i18n.t("Untitled","calls")();return TS.templates.message_screenhero_attachment({room:t,participants:n,room_url:TS.utility.calls.getUrlForRoom(t),meta_room_name:_.escape(u),room_name:_.escape(t.name),title:o,description:l,show_description_ellipsis:2===t.participants.length,show_room_link:!t.date_end,expand_it:TS.inline_room_previews.shouldExpand(t.id),duration:s})},buildJoinLeaveRollUpStr:function e(t){var n="";if(t.is_in)if(t.joined&&t.left)n=TS.i18n.t("left and rejoined","templates_builders")();else n=TS.i18n.t("joined","templates_builders")();else if(t.joined&&t.left)n=TS.i18n.t("joined and left","templates_builders")();else n=TS.i18n.t("left","templates_builders")();return n},buildBotStr:function e(t,n){var r;if(n&&n.is_shared)if(t.bot_link)r=TS.bots.getBotNameByBotLink(t.bot_link);else r=TS.bots.getBotNameByBotLink(t.text);else r=TS.bots.getBotNameById(t.bot_id);var i="<"+TS.boot_data.team_url+"services/"+t.bot_id+"/|"+r+">";switch(t.subtype){case"bot_add":return TS.i18n.t("added an integration to this channel: {bot_url}","templates_builders")({bot_url:i});case"bot_enable":return TS.i18n.t("enabled an integration in this channel: {bot_url}","templates_builders")({bot_url:i});case"bot_disable":return TS.i18n.t("disabled an integration in this channel: {bot_url}","templates_builders")({bot_url:i});case"bot_remove":return TS.i18n.t("removed an integration from this channel: {bot_url}","templates_builders")({bot_url:i});default:return TS.i18n.t("updated an integration in this channel: {bot_url}","templates_builders")({bot_url:i})}},formatMessageByType:function n(r,i,a,s,o){var l="";var u;if(r.ignore_if_attachments_supported)return l;i=true===i;a=true===a;var d;var c;var m;var f;var p;var h;var g;var S;var T;var v;var b;var y;if((r._jl_rollup_hash||r._jl_rolled_up_in)&&t&&(!r._jl_rolled_up_in||r._jl_rolled_up_in!==r.ts))return l;t=false;if(r._jl_rollup_hash&&r.user in r._jl_rollup_hash.users){c=TS.members.getPotentiallyUnknownMemberById(r.inviter);var w=r._jl_rollup_hash.users[r.user];var k=TS.templates.builders.buildJoinLeaveRollUpStr(w);if(s.is_group||s.is_private)f=TS.model.group_prefix+s.name;else if(s)f="#"+s.name;else f=TS.i18n.t("the channel","templates_builders")();k+=" "+f;if(w.is_in&&c)k=TS.i18n.t("{join_or_leave} {channel_name} by invitation from {inviter}","templates_builders")({join_or_leave:TS.templates.builders.buildJoinLeaveRollUpStr(w),channel_name:f,inviter:"<@"+c.id+"|"+c.name+">"});var x=[];var C=[];var M=TS.i18n.t("along with","templates_builders")();var I;if(w.is_in&&c)I="<@"+c.id+"|"+c.name+">";var A;var E;var F;var O=0;for(var B in r._jl_rollup_hash.users){if(B==r.user)continue;if(O==e){t=true;break}F=r._jl_rollup_hash.users[B];if(F.is_in===w.is_in)if(F.is_in){if(F.inviter==r.user){M=TS.i18n.t("and invited","templates_builders")();A=true}if(F.inviter&&(F.inviter==w.inviter||F.inviter==r.user))x.push("<@"+B+">");else C.push("<@"+B+"> "+TS.templates.builders.buildJoinLeaveRollUpStr(F))}else x.push("<@"+B+">");else C.push("<@"+B+"> "+TS.templates.builders.buildJoinLeaveRollUpStr(F));O+=1}if(x.length){if(A)if(C.length)if(t)if(I)E=TS.i18n.t('{joined_or_left} {channel_name} by invitation from {inviter}, and invited {users} and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>. Also, {others} along with <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else E=TS.i18n.t('{joined_or_left} {channel_name}, and invited {users} and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>. Also, {others} along with <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else if(I)E=TS.i18n.t("{joined_or_left} {channel_name} by invitation from {inviter}, and invited {users}. Also, {others}.","templates_builders");else E=TS.i18n.t("{joined_or_left} {channel_name}, and invited {users}. Also, {others}.","templates_builders");else if(t)if(I)E=TS.i18n.t('{joined_or_left} {channel_name} by invitation from {inviter}, and invited {users} and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else E=TS.i18n.t('{joined_or_left} {channel_name}, and invited {users} and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else if(I)E=TS.i18n.t("{joined_or_left} {channel_name} by invitation from {inviter}, and invited {users}","templates_builders");else E=TS.i18n.t("{joined_or_left} {channel_name}, and invited {users}","templates_builders");else if(C.length)if(t)if(I)E=TS.i18n.t('{joined_or_left} {channel_name} by invitation from {inviter}, along with {users} and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>. Also, {others} along with <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else E=TS.i18n.t('{joined_or_left} {channel_name}, along with {users} and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>. Also, {others} along with <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else if(I)E=TS.i18n.t("{joined_or_left} {channel_name} by invitation from {inviter}, along with {users}. Also, {others}.","templates_builders");else E=TS.i18n.t("{joined_or_left} {channel_name}, along with {users}. Also, {others}.","templates_builders");else if(t)if(I)E=TS.i18n.t('{joined_or_left} {channel_name} by invitation from {inviter}, along with {users} and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else E=TS.i18n.t('{joined_or_left} {channel_name}, along with {users} and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else if(I)E=TS.i18n.t("{joined_or_left} {channel_name} by invitation from {inviter}, along with {users}","templates_builders");else E=TS.i18n.t("{joined_or_left} {channel_name}, along with {users}","templates_builders");k+=", "+M+" "+x.join(", ");l=TS.format.formatNoHighlightsNoSpecials(k);if(t)l+=TS.i18n.t(' and <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>',"templates_builders")();if(C.length){var H=TS.i18n.t(". Also, {others}","templates_builders")({others:C.join(", ")});l+=TS.format.formatNoHighlightsNoSpecials(H);if(t)l+=TS.i18n.t(' along with <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>',"templates_builders")();l+="."}}else if(C.length){if(t)if(I)E=TS.i18n.t('{joined_or_left} {channel_name} by invitation from {inviter}. Also, {others} along with <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else E=TS.i18n.t('{joined_or_left} {channel_name}. Also, {others} along with <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>.',"templates_builders");else if(I)E=TS.i18n.t("{joined_or_left} {channel_name} by invitation from {inviter}. Also, {others}.","templates_builders");else E=TS.i18n.t("{joined_or_left} {channel_name}. Also, {others}.","templates_builders");k+=TS.i18n.t(". Also, {others}","templates_builders")({others:C.join(", ")});l=TS.format.formatNoHighlightsNoSpecials(k);if(t)l+=TS.i18n.t(' along with <a onclick="TS.client.channel_page.showMemberSectionAndHighlight();">some others</a>',"templates_builders")();l+="."}else{l=TS.format.formatNoHighlightsNoSpecials(k);if(I)E=TS.i18n.t("{joined_or_left} {channel_name} by invitation from {inviter}","templates_builders");else E=TS.i18n.t("{joined_or_left} {channel_name}","templates_builders")}if(TS.boot_data.feature_join_leave_rollup_builder){var $=E({joined_or_left:TS.templates.builders.buildJoinLeaveRollUpStr(w),channel_name:f,inviter:c?TS.format.formatNoHighlightsNoSpecials("<@"+c.id+"|"+c.name+">"):"",users:TS.format.formatNoHighlightsNoSpecials(x.join(", ")),others:TS.format.formatNoHighlightsNoSpecials(C.join(", "))});l=$}}else if("channel_join"===r.subtype){c=TS.members.getMemberById(r.inviter);if(s.is_private)f=TS.model.group_prefix+s.name;else if(s)f="#"+s.name;else f=TS.i18n.t("the channel","templates_builders")();if(c){p="<@"+c.id+"|"+c.name+">";u=TS.i18n.t("joined {channel_name} from an invitation by {inviter}","templates_builders")({channel_name:f,inviter:p});l=TS.format.formatNoHighlightsNoSpecials(u,r)}else l=TS.i18n.t("joined {channel_name}","templates_builders")({channel_name:f})}else if("channel_leave"===r.subtype){if(s.is_private)f=TS.model.group_prefix+s.name;else if(s)f="#"+s.name;else f=TS.i18n.t("the channel","templates_builders")();l=TS.i18n.t("left {channel_name}","templates_builders")({channel_name:f})}else if("channel_name"===r.subtype)l=TS.i18n.t('renamed the channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:r.old_name,new_name:r.name});else if("channel_topic"===r.subtype)if(!r.topic)l=TS.i18n.t("cleared the channel topic","templates_builders")();else{if(TS.boot_data.feature_name_tagging_client)g=_.unescape(r.topic);g=TS.format.formatWithOptions(r.topic,r,{no_highlights:true});l=TS.i18n.t('set the channel topic: <span class="topic no_jumbomoji">{topic}</span>',"templates_builders")({topic:g})}else if("channel_purpose"===r.subtype)if(!r.purpose)l=TS.i18n.t("cleared the channel purpose","templates_builders")();else{S=r.purpose;if(TS.boot_data.feature_name_tagging_client)S=_.unescape(S);S=TS.format.formatWithOptions(S,r,{no_highlights:true});l=TS.i18n.t('set the channel purpose: <span class="purpose no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:S})}else if("group_join"===r.subtype){d=s;h=d?TS.model.group_prefix+d.name:TS.i18n.t("the private channel","templates_builders")();c=TS.members.getMemberById(r.inviter);if(c){p="<@"+c.id+"|"+c.name+">";u=TS.i18n.t("joined {group_name} from an invitation by {inviter}","templates_builders")({group_name:h,inviter:p});l=TS.format.formatNoHighlightsNoSpecials(u,r)}else l=TS.i18n.t("joined {group_name}","templates_builders")({group_name:h})}else if("group_leave"===r.subtype){d=s;h=d?TS.model.group_prefix+d.name:TS.i18n.t("the private channel","templates_builders")();l=TS.i18n.t("left {group_name}","templates_builders")({group_name:h})}else if("group_name"===r.subtype)l=TS.i18n.t('renamed the private channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:r.old_name,new_name:r.name});else if("group_topic"===r.subtype)if(!r.topic)l=TS.i18n.t("cleared the channel topic","templates_builders")();else{g=TS.format.formatWithOptions(r.topic,r,{no_highlights:true});l=TS.i18n.t('set the channel topic: <span class="no_jumbomoji">{topic}</span>',"templates_builders")({topic:g})}else if("group_purpose"===r.subtype)if(!r.purpose)l=TS.i18n.t("cleared the channel purpose","templates_builders")();else{S=TS.format.formatWithOptions(r.purpose,r,{no_highlights:true});l=TS.i18n.t('set the channel purpose: <span class="no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:S})}else if("group_archive"===r.subtype){d=s;h=d?TS.model.group_prefix+d.name:TS.i18n.t("the private channel","templates_builders")();T=_.get(TS.model.enterprise,"name","");if(TS.boot_data.feature_teams_to_workspaces)b=TS.i18n.t("your workspace admin","templates_builders")();else b=TS.i18n.t("your team admin","templates_builders")();if(r.user){v=TS.members.getMemberById(r.user);b=TS.format.formatNoHighlightsNoSpecials("<@"+v.id+"|"+v.name+">")}if(TS.client&&d&&d.is_archived)if(TS.model.archive_view_is_showing)if(1==d.is_moved)if(TS.boot_data.feature_teams_to_workspaces)l=TS.i18n.t("moved {group_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:h,enterprise_name:T,mover_name:b,name_for_url:d.id});else l=TS.i18n.t("moved {group_name} to another {enterprise_name} team. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:h,enterprise_name:T,mover_name:b,name_for_url:d.id});else l=TS.i18n.t("archived {group_name}. The contents will still be browsable and available in search.","templates_builders")({group_name:h,name_for_url:d.id});else{var D="TS.shared.closeArchivedChannel";var P="'"+d.id+"'";if(1==d.is_moved)if(TS.boot_data.feature_teams_to_workspaces)l=TS.i18n.t("moved {group_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:h,enterprise_name:T,mover_name:b,name_for_url:d.id});else l=TS.i18n.t("moved {group_name} to another {enterprise_name} team. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:h,enterprise_name:T,mover_name:b,name_for_url:d.id});else l=TS.i18n.t('archived {group_name}. The contents will still be browsable and available in search. \t\t\t\t\t\t\tIt can also be un-archived at any time. To close it now, <a onclick="{method}({group_id})">click here</a>.',"templates_builders")({group_name:h,name_for_url:d.id,method:D,group_id:P})}else if(1==d.is_moved)if(TS.boot_data.feature_teams_to_workspaces)l=TS.i18n.t("moved {group_name} to another {enterprise_name} workspace","templates_builders")({group_name:h,enterprise_name:T});else l=TS.i18n.t("moved {group_name} to another {enterprise_name} team","templates_builders")({group_name:h,enterprise_name:T});else if(0==d.is_moved)l=TS.i18n.t("archived {group_name}","templates_builders")({group_name:h})}else if("group_unarchive"===r.subtype){d=s;h=d?TS.model.group_prefix+d.name:TS.i18n.t("the private channel","templates_builders")();l=TS.i18n.t("un-archived {group_name}","templates_builders")({group_name:h})}else if("channel_archive"===r.subtype){var j="'"+s.id+"'";if(s.is_private)f=TS.model.group_prefix+s.name;else if(s)f="#"+s.name;else f=TS.i18n.t("the channel","templates_builders")();T=_.get(TS.model.enterprise,"name","");if(TS.client&&1==s.is_moved){if(r.user){v=TS.members.getMemberById(r.user);b=TS.format.formatNoHighlightsNoSpecials("<@"+v.id+"|"+v.name+">")}if(TS.model.archive_view_is_showing)if(TS.boot_data.feature_teams_to_workspaces)l=TS.i18n.t("moved {channel_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({channel_name:f,enterprise_name:T,mover_name:b,name_for_url:s.id});else l=TS.i18n.t("moved {channel_name} to another {enterprise_name} team. The contents up until this point are still browsable and available in search.","templates_builders")({channel_name:f,enterprise_name:T,mover_name:b,name_for_url:s.id});else if(TS.boot_data.feature_teams_to_workspaces)l=TS.i18n.t('moved {channel_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search. \t\t\t\t\t\tTo close it now, <a onclick="TS.channels.closeArchivedChannel({channel_id})">click here</a>.',"templates_builders")({channel_name:f,enterprise_name:T,mover_name:b,name_for_url:s.id,channel_id:j});else l=TS.i18n.t('moved {channel_name} to another {enterprise_name} team. The contents up until this point are still browsable and available in search. \t\t\t\t\t\tTo close it now, <a onclick="TS.channels.closeArchivedChannel({channel_id})">click here</a>.',"templates_builders")({channel_name:f,enterprise_name:T,mover_name:b,name_for_url:s.id,channel_id:j})}else if(TS.client&&s)if(TS.model.archive_view_is_showing)l=TS.i18n.t("archived {channel_name}. The contents will still be browsable and available in search.","templates_builders")({channel_name:f,name_for_url:s.id});else l=TS.i18n.t('archived {channel_name}. The contents will still be browsable and available in search. \t\t\t\t\t\tIt can also be un-archived at any time. To close it now, <a onclick="TS.channels.closeArchivedChannel({channel_id})">click here</a>.',"templates_builders")({channel_name:f,name_for_url:s.id,channel_id:j});else if(s&&1==s.is_moved)if(TS.boot_data.feature_teams_to_workspaces)l=TS.i18n.t("moved {channel_name} to another {enterprise_name} workspace","templates_builders")({channel_name:f,enterprise_name:T});else l=TS.i18n.t("moved {channel_name} to another {enterprise_name} team","templates_builders")({channel_name:f,enterprise_name:T})}else if("channel_unarchive"===r.subtype){if(s.is_private)f=TS.model.group_prefix+s.name;else if(s)f="#"+s.name;else f=TS.i18n.t("the channel","templates_builders")();l=TS.i18n.t("un-archived {channel_name}","templates_builders")({channel_name:f})}else if("me_message"===r.subtype)l="<i>"+TS.format.formatWithOptions(r.text,r,{do_inline_imgs:i})+"</i>";else if("play_sound"===r.subtype)l=TS.i18n.t('played "{msg_sound}"',"templates_builders")({msg_sound:r.sound});else if("sh_room_shared"===r.subtype||"sh_room_created"===r.subtype){if("sh_room_shared"===r.subtype);if(!o&&r._room_id)m=TS.rooms.getRoomById(r._room_id);if(o)l+="<span>"+TS.i18n.t("Shared a call","templates_builders")()+"</span>";else if(m)l+=TS.templates.builders.buildSHRoomAttachment(m)}else if("bot_add"===r.subtype||"bot_enable"===r.subtype||"bot_updated"===r.subtype||"bot_disable"===r.subtype||"bot_remove"===r.subtype){y=TS.templates.builders.buildBotStr(r,s);l=TS.format.formatWithOptions(y,r,{do_inline_imgs:i,enable_slack_action_links:a,no_highlights:true})}else if("reminder_add"===r.subtype||"reminder_delete"===r.subtype)l=TS.format.formatWithOptions(r.text,r,{do_inline_imgs:i,enable_slack_action_links:a,no_highlights:true});else l=TS.format.formatWithOptions(r.text,r,{do_inline_imgs:i,enable_slack_action_links:a});if(!l&&""!==l){TS.warn("no html msg.subtype:"+r.subtype);return""}l=TS.utility.msgs.handleSearchHighlights(l);return l},msgHtmlForSearch:function e(t,n,r,i,a){if("bot_message"!==t.subtype)t.subtype=null;var s="";if("extract"===r){s+='<div class="search_result_with_extract">';s+='<div class="extract_expand_text">'+TS.i18n.t("Expand","template_builders")()+"</div>";s+='<div class="extract_expand_icons blue"><i class="ts_icon ts_icon_chevron_up up_arrow"></i><i class="ts_icon ts_icon_chevron_down down_arrow"></i></div>'}else if("context"===r)s+='<div class="search_result_for_context">';else s+='<div class="search_result_for_extra_context">';s+=TS.templates.builders.msgs.buildHTML({msg:t,msg_dom_id:TS.templates.makeMsgDomIdInSearch(t.ts,i),model_ob:n,container_id:"search_message_results",standalone:true,for_search_display:true,search_result_type:r,prev_msg:a});s+="</div>";return s},msgHtmlForSearchTopResults:function e(t){if("bot_message"!==t.subtype)t.subtype=null;var n=(!t.extracts||0==t.extracts.length)&&t.attachments;var r=TS.templates.builders.msgs.buildHTML({msg:t,msg_dom_id:TS.templates.makeMsgDomIdInSearchTopResults(t.ts,t,"sort_top_results"),model_ob:t.channel,container_id:"search_message_results",standalone:true,for_top_results_search_display:true,no_attachments:!n});return r},buildMsgHTMLForSearchTopResults:function e(t){return TS.templates.builders.msgHtmlForSearchTopResults(t)},buildMsgHTMLForSearch:function e(t){var n=t.channel;var r="";var i=[];if(t.previous_2)i.push(t.previous_2);if(t.previous)i.push(t.previous);i.push(t);if(t.next)i.push(t.next);if(t.next_2)i.push(t.next_2);if(i.length>1&&!TS.search.view.resultHasExtracts(t)){t.force_extract_type="extract";if(t.previous)t.previous.force_extract_type="context";if(t.next)t.next.force_extract_type="context"}var a;i.forEach(function(e,s){var o;if(e.force_extract_type)o=e.force_extract_type;else o=TS.search.view.determineMessageResultType(i,s);if(!e.permalink&&t.permalink&&"extract"!==o)e.permalink=t.permalink;if(!e.team&&t.team&&"extract"!==o)e.team=t.team;r+=TS.templates.builders.msgHtmlForSearch(e,n,o,t,a);a=e});return r},search_ellipsis:'<span class="extract_ellipsis">&hellip;</span>',buildStar:function e(t,n,r){var a=i(t,n,r);if(!_.isObject(a))return{};return TS.templates.star(a)},buildStarWithTip:function e(t,n,r){var a=i(t,n,r);if(!_.isObject(a))return{};return TS.templates.star_with_tip(a)},buildMentionHTML:function e(t){var n=t.message;var r="";if(!n)return r;if("file_share"===n.subtype||"file_mention"===n.subtype||"file_comment"===n.subtype||"file_reaction"===n.subtype)if(!n.file)return r;var i=TS.shared.getModelObById(t.channel);if(!i)return r;var a;var s=4;var o=[];var l="";var u="";var d="";var c="reaction"===t.type;u=TS.templates.builders.strBuilder('<button type="button" class="btn_link msg_right_link msg_jump" data-cid="${cid}">'+TS.i18n.t("Jump","templates_builders")()+"</button>",{cid:i.id});d=TS.templates.builders.msgs.buildHTML({msg:n,model_ob:i,standalone:true,jump_link:u,no_attachments:!!n.text,for_mention_display:true,for_mention_rxn_display:c});r=d;if(c){var _=TS.rxns.getRxnKeyByMsgType(n);a=TS.rxns.getExistingRxnsByKey(_);if(!a)return"";var m=a[a.length-1];var f=m.users[m.users.length-1];if(!TS.rxns.getRxnFromRxns(a,m.name))return"";var p=TS.members.getPotentiallyUnknownMemberById(f);var h=TS.rxns.getAllUniqueRxners(a,f);var g=h.length+1;var S="file_reaction"===n.subtype;var T;if(2==g){var v=TS.members.getPotentiallyUnknownMemberById(h[0]);if(S)T=TS.i18n.t('<span class="mention_rxn_summary_members">{user} & {another_user}</span> reacted to your file.',"rxn");else T=TS.i18n.t('<span class="mention_rxn_summary_members">{user} & {another_user}</span> reacted to your message.',"rxn");l=T({user:TS.templates.builders.makeMemberPreviewLink(p,true),another_user:TS.templates.builders.makeMemberPreviewLink(v)})}else if(g>2){var b=true;var y=true;var w=h.map(function(e){return TS.members.getPrefCompliantMemberNameById(e,b,y)});var k=g-1;if(S)T=TS.i18n.t('<span class="mention_rxn_summary_members">{user} & <span class="ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top" title="{names}">{count, plural, =1 {# other} other {# others}}</span></span> reacted to your file.',"rxn");else T=TS.i18n.t('<span class="mention_rxn_summary_members">{user} & <span class="ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top" title="{names}">{count, plural, =1 {# other} other {# others}}</span></span> reacted to your message.',"rxn");l=T({user:TS.templates.builders.makeMemberPreviewLink(p,true),names:TS.i18n.listify(w).join(""),count:k})}else{if(S)T=TS.i18n.t('<span class="mention_rxn_summary_members">{user}</span> reacted to your file.',"rxn");else T=TS.i18n.t('<span class="mention_rxn_summary_members">{user}</span> reacted to your message.',"rxn");l=T({user:TS.templates.builders.makeMemberPreviewLink(p,true)})}o=a.filter(function(e){return TS.emoji.isValidName(e.name)}).slice(0,s).map(function(e){return new Handlebars.SafeString(TS.emoji.graphicReplace(":"+e.name+":"))});var x={ts:n.ts,rxns_to_display:o,msg_html:new Handlebars.SafeString(d),rxn_members:new Handlebars.SafeString(l),jump_link_html:new Handlebars.SafeString(u),is_file_reaction:S};if(n.thread_ts)x.thread_ts=n.thread_ts;r=TS.templates.mentions_rxn(x)}return r},buildMentions:function e(){TS.mentions.weaveInRxnRecords();var t="";var n=null;var r=TS.model.user;if(!r.mentions||!r.mentions.length)return t;var i=[];i=r.mentions;$.each(i,function(e,r){var i;try{i=TS.templates.builders.buildMentionHTML(r)}catch(e){TS.error("Problem building mention html for "+r.message.ts+" in "+r.channel);TS.error(e)}if(!i)return;var a="";var s=TS.shared.getModelObById(r.channel);var o=r.message;var l=!n;if(n&&!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(n.rxn_ts||n.message.ts),TS.interop.datetime.toDateObject(r.rxn_ts||o.ts)))l=true;if(l){if(n)a="</div>";a+='<div class="mention_day_container_div">'+TS.templates.messages_day_divider({ts:r.rxn_ts||o.ts})}var u=n&&n.channel;if(s&&(s.is_channel||s.is_mpim||s.is_group))if(u!=s.id||l)a+=TS.templates.mentions_item({model_ob:s});t+=a+i;n=r});if(t)t+="</div>";return t},buildStarredItemHTML:function e(t){var n="<div class='star_item'>";var r={star:t,current_user_id:TS.model.user.id};var i;if("message"===t.type){var a=t.message;var s=false;i=TS.shared.getModelObById(t.channel);if(!i){TS.warn("channel "+t.channel+" for this starred message was probably deleted");return""}if(i.is_im){var o=TS.members.getMemberById(i.user);t.message.recipient=o;if(TS.ims.isImWithDeletedMember(i))s=true}var l="";if(!s)l=TS.templates.builders.strBuilder('<button type="button" class="btn_unstyle star_jump msg_right_link btn btn_outline" data-cid="${cid}">'+TS.i18n.t("Jump","templates_builders")()+"</button>",{cid:i.id});n+=TS.templates.builders.msgs.buildHTML({msg:a,model_ob:i,standalone:true,starred_items_list:true,starred_items_actions:true,jump_link:l,no_attachments:!!a.text,full_date:true})}else if("file"===t.type)n+=TS.templates.builders.fileHTML(t.file);else if("channel"===t.type||"group"===t.type){i=TS.shared.getModelObById(t.channel);if(!i){TS.warn("channel or group "+t.channel+" was probably deleted");return""}r.model_ob=i;n+=TS.templates.star_item(r)}else{r.from_starred_item=true;n+=TS.templates.star_item(r)}n+="</div>";return n},buildPinInfoHtml:function e(t){var n={};var r=TS.pins.getPinData(t);if(r&&r.created_by&&r.created){var i=TS.members.getPotentiallyUnknownMemberById(r.created_by);n.user=i;n.ts=r.created;n.complete_data=n.user&&n.ts}else n.complete_data=false;n.unknown_member_token=new Handlebars.SafeString(TS.templates.unknown_member());var a=TS.templates.pinned_message_info(n);return new Handlebars.SafeString(a)},buildHighlightsInfoHtml:function e(t){var n=TS.templates.highlights_message_info(t);return new Handlebars.SafeString(n)},buildInlineImgTogglerAndDiv:function e(t,n,r){var i=TS.model.inline_imgs[t];if(!i)return"";return TS.templates.builders.buildInlineImgToggler(t,n)+" "+TS.templates.builders.buildInlineImgDiv(t,n,r)},buildInlineImgToggler:function e(t,n,r,i){var a=TS.model.inline_imgs[t];if(!a){TS.console.warn(8675309,"buildInlineImgToggler did not find anything in TS.model.inline_imgs for key:"+t);return""}var s=TS.inline_imgs.shouldExpand(n,a,i);var o=a.link_url||t;var l=a.bytes&&a.bytes>TS.model.inline_img_byte_limit;var u=a.width&&a.height&&a.width*a.height>TS.model.inline_img_pixel_limit;var d=!u;var c="";var m="";if(!s&&(!TS.model.prefs.obey_inline_img_limit||l)||u){var f=!a.internal_file_id&&TS.model.prefs.expand_inline_imgs&&false!==TS.model.expandable_state["img_"+n+a.src];if(f&&u){d=false;m=TS.i18n.t("(Not automatically expanded because {img_width}x{img_height} is too large to display inline.)","templates_builders")({img_width:a.width,img_height:a.height});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}else if(f&&l){var p=TS.i18n.t("Open original in new tab","templates_builders")();var h="<a "+TS.utility.makeRefererSafeLink(o)+' target="_blank" title="'+p+'">';if(TS.model.show_inline_img_size_pref_reminder&&!TS.model.shown_inline_img_size_pref_reminder_once){m=TS.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>. \t\t\t\t\t\tYou can also <a class="cursor_pointer" onclick="TS.ui.prefs_dialog.start(\'messages_media\', \'#prefs_inline_media\')">change your preferences</a> to allow images of any file size to auto expand.)',"templates_builders")({file_size:TS.utility.convertFilesize(a.bytes),real_src:_.escape(a.src),referer_link_a_tag:h});TS.model.shown_inline_img_size_pref_reminder_once=true}else m=TS.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>.)',"templates_builders")({file_size:TS.utility.convertFilesize(a.bytes),real_src:_.escape(a.src),referer_link_a_tag:h});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}}var g=a.bytes&&true!==r?'<span class="inline_img_bytes '+(c?"hidden":"")+'"> ('+TS.utility.convertFilesize(a.bytes)+")</span>":"";var S={collapser_class:"msg_inline_img_collapser",expander_class:"msg_inline_img_expander",real_src:a.src,expand_it:s};var T=TS.templates.inline_attachment_toggler({inline_attachment:S});return g+c+(d?T:"")},buildInlineImgDiv:function e(t,n,r){r=r||{};var i=TS.model.inline_imgs[t];if(!i)return"";var a=TS.inline_imgs.shouldExpand(n,i,r);var s=i.link_url||t;var o=!r.flush_with_attachment&&i.width>0&&i.height>0;var l;if(i.internal_file_id)l=TS.files.getFileById(i.internal_file_id);var u="";var d="clear_both msg_inline_img_holder msg_inline_holder";if(!a)d+=" hidden";var c=i.height<50;var m=i.width<200;var f=m||c;if(f){d+=" overflow_preview_actions";if(m)d+=" overflow_preview_actions_width"}if(l)d+=" file_container";d+=" msg_inline_holder_rounded";if(!o)d+=" file_container_fixed_dimensions";u+='<div data-real-src="'+_.escape(i.src)+'" class="'+d+'" ';if(i.internal_file_id)u+='data-file-id="'+i.internal_file_id+'" ';if(o)u+='style="width:'+i.width+'px;" ';u+=">";var p="ctrl";if(TS.model.is_mac)p="cmd";var h=TS.i18n.t("{cmd_key}+click to open original in new tab","templates_builders")({cmd_key:p});var g=r&&r.hasOwnProperty("maybe_show_file_viewer")?r.maybe_show_file_viewer:true;var S;if(i.internal_file_id)if(l&&0===l.mimetype.indexOf("image/")){S=g;if("dropbox"===l.external_type||"gdrive"===l.external_type||"box"===l.external_type||"onedrive"===l.external_type){var T=l.thumb_720?l.thumb_720:l.thumb_360;u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+h+'" class="file_viewer_external_link" data-src="'+_.escape(T)+'"data-link-url="'+_.escape(s)+'">'}else if(S)u+='<a href="'+s+'" target="_blank" class="file_viewer_channel_link file_viewer_link" data-file-id="'+i.internal_file_id+'">';else u+='<a href="'+s+'" target="_blank" title="'+h+'" class="file_preview_link thumbnail_link" data-file-id="'+i.internal_file_id+'">'}else u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" class="'+l.filetype+'">';else{var v="";var b="";if(g)v="file_viewer_external_link";else b=TS.i18n.t("Click to open original in new tab","templates_builders")();u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+b+'" class="'+v+'" data-src="'+_.escape(i.src)+'" data-link-url="'+_.escape(i.link_url)+'"';if(i.width)u+=' data-width="'+_.escape(i.width)+'"';if(i.height)u+=' data-height="'+_.escape(i.height)+'"';if(i.rotation)u+=' data-rotation="'+_.escape(i.rotation)+'"';if(i.content_type)u+=' data-content-type="'+_.escape(i.content_type)+'"';u+=">"}if(o)u=u.replace("<a ",'<a style="width:'+i.width+'px;" ');u+='<div class="msg_inline_img_container">';u+='<div class="file_preview_preserve_aspect_ratio" ';if(o)if(!l||!f){var y="calc("+i.height+" / "+i.width+" * 100% )";u+='style="padding-top: -moz-'+y+"; padding-top: -webkit-"+y+"; padding-top: "+y+';" '}else u+='style="padding-top: '+i.height+'px;" ';else{var w=574;var k=300;var x=w/k;var C=i.display_w||i.width;var M=i.display_h||i.height;var I=C/M;var A;var E;if(C<=w&&M<=k){A=C;E=M}else if(x>I){A=C*k/M;E=k}else{A=w;E=M*w/C}u+='style="width: '+Math.round(A)+"px; height: "+Math.round(E)+'px;"'}u+=">";i.proxied_src=TS.utility.getImgProxyURLWithOptions(i.src,{});var F=_.escape(i.proxied_src||i.src);var O="msg_inline_img msg_inline_child";var B='style="background-image:url('+F+');"';var H='src="'+F+'"';u+='<figure class="'+O+'" '+B+">";u+="<img "+H+" />";u+="</figure>";u+="</div>";u+="</div>";u+="</a>";if(l)u+=TS.templates.message_file_preview_actions({file:l,download:"hosted"===l.mode,new_window:true});u+="</div>";return u},buildInlineEmailDiv:function e(t,n){var r=TS.files.getFileById(t);if(!r)return"";var i={file:r,is_message:true,to_more_count:r.to.length-1,cc_more_count:r.cc.length-1,msg_dom_id:n};return TS.templates.file_email(i)},buildInlineAttachmentToggler:function e(t,n){var r=TS.model.inline_attachments[t];if(!r)return"";var i=TS.inline_attachments.shouldExpand(n,r);var a={real_src:r.from_url,expand_it:i};var s=TS.templates.inline_attachment_toggler({inline_attachment:a});return s},buildInlineRoomPreviewToggler:function e(t){var n=TS.inline_room_previews.shouldExpand(t);var r={collapser_class:"msg_inline_room_preview_collapser",expander_class:"msg_inline_room_preview_expander",expand_it:n};var i=TS.templates.inline_attachment_toggler({inline_attachment:r});return" "+i},buildInlineAudioToggler:function e(t,n){var r=TS.model.inline_audios[t];if(!r)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_audios.shouldExpand(n,r),src:r.src,media_type:"audio"})},buildInlineAudioDiv:function e(t,n,r){var i=TS.model.inline_audios[t];if(!i)return"";var a=TS.inline_audios.shouldExpand(n,i);var s={src:i.src,expand_it:a,content:r};var o=TS.templates.attachment_inline_audio_div({inline_audio:s});return o},buildInlineOtherToggler:function e(t,n){var r=TS.model.inline_others[t];if(!r)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_others.shouldExpand(n,r),src:r.src,media_type:"other"})},buildInlineOtherDiv:function e(t,n,r){var i=TS.model.inline_others[t];if(!i)return"";var a=TS.inline_others.shouldExpand(n,i);return'<div data-real-src="'+_.escape(i.src)+'" class="clear_both msg_inline_other_holder msg_inline_holder '+(a?"":"hidden")+'">'+r+"</div>"},buildInlineVideoTogglerAndDiv:function e(t,n){var r=TS.model.inline_videos[t];if(!r)return"";return TS.templates.builders.buildInlineVideoToggler(t,n)+" "+TS.templates.builders.buildInlineVideoDiv(t,n)},buildInlineVideoToggler:function e(t,n,r){var i=TS.model.inline_videos[t];if(!i)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_videos.shouldExpand(n,i),src:i.src,title:r?"":i.title,media_type:"video",is_keyboard_navigable:true})},buildInlineVideoDiv:function e(t,n){var r=TS.model.inline_videos[t];if(!r)return"";var i=TS.inline_videos.shouldExpand(n,r);var a=r.link_url||t;var s=true;if(!r.html)s=false;var o={real_src:r.src,data_url:t,referrer_safe_url_attributes:TS.utility.makeRefererSafeLink(a),show_play:s,proxied_src_or_src:r.proxied_src||r.src,display_w:r.display_w,display_h:r.display_h,expand_it:i};var l=TS.templates.message_inline_video({inline_video:o});return l},buildComments:function e(t){var n;var r=t.comments;var i="";for(var a=0;a<r.length;a+=1){n=TS.members.getPotentiallyUnknownMemberById(r[a].user);i+=TS.templates.builders.buildCommentHTML({file:t,comment:r[a],show_comment_actions:true,member:n})}return i},buildCommentHTML:function e(t){return TS.templates.comment(t)},buildCommentStandalone:function e(t,n){var r=TS.utility.members.getEntityFromFile(n);var i;if("snippet"===n.mode)i=TS.i18n.t("snippet","comments")();else if("post"===n.mode)i=TS.i18n.t("post","comments")();else if("space"===n.mode)i=TS.i18n.t("space","comments")();else if("hosted"===n.mode||"external"===n.mode)i=TS.i18n.t("file","comments")();return TS.templates.comment_standalone({comment:t,file:n,file_type:i,entity:r,current_user_id:TS.model.user.id})},buildTeamListHTML:function e(t,n,r){var i=TS.members.allocateTeamListMembers(t);var a=i.members;var s=i.disabled_members;var o=i.deleted_bots;var l=i.bots;var u=i.restricted_members;var d=i.ultra_restricted_members;var c=false;if(l.length||o.length)c=true;var _=false;if(u.length||d.length||r)_=true;var m=false;if(s.length||r)m=true;var f=false;var p=false;var h;f=""!==TS.model.team.plan&&!TS.model.user.is_restricted;h=TS.model.user_groups.filter(function(e){return!e.date_delete});p=!h.length;var g=$("#team_tabs");var S=TS.permissions.members.canEditUserGroups();var T=TS.permissions.members.canCreateAndDeleteUserGroups();g.html(TS.templates.user_group_tabs({show_members:!!a.length,members:r?[]:a,show_restricted_members:_,restricted_members:r?[]:u.concat(d),show_disabled_members:m,disabled_members:r?[]:s,show_user_groups:f,user_groups:h,show_user_groups_edit:S,show_user_groups_add:T,is_enterprise:TS.boot_data.page_needs_enterprise}));var v={full_profile_filter:true,is_long_list_view:n,include_bots:true,include_deleted:false};TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",v);$("#team_filter input").bind("focus",function(){$("#team_filter .icon_search").addClass("indifferent_grey")}).bind("blur",function(){$("#team_filter .icon_search").removeClass("indifferent_grey")});if(f){var b=g.find(".tab_action:not(#search)");var y=$("#team_block");g.find("li a").on("click",function(){var e=$(this).data("action");var t=TS.permissions.members.canEditUserGroups();var n=TS.permissions.members.canCreateAndDeleteUserGroups();b.addClass("hidden");if("user_group_edit"===e){if(!t&&!n)return;b.removeClass("hidden");y.addClass("hidden")}else y.removeClass("hidden");g.find("#"+e).removeClass("hidden")})}$("#team_tabs").find("li.tab").on("click",function(e){var t=$(e.currentTarget).find("a").data("name");TS.model.ui_state.tab_name=t;TS.storage.storeUIState(TS.model.ui_state);var n=$("#search");if(TS.client)TS.ui.utility.updateClosestMonkeyScroller($("#team_list_members"));if(TS.web&&TS.web.members&&TS.web.members.lazyload)TS.web.members.lazyload.trigger("resize");$("#team_list_members").trigger("resize");if("user_groups"===t){TS.view.rebuildUserGroupList();n.toggleClass("hidden",!TS.model.user_groups.length)}else n.removeClass("hidden")});return TS.templates.team_list({members:a,bots:l,show_bots:c,show_restricted_members:_,restricted_members:u,ultra_restricted_members:d,show_disabled_members:m,disabled_members:s,deleted_bots:o,show_user_groups:f,user_groups:h,show_user_groups_help:p,is_long_list_view:n})},buildUserGroupHTML:function e(t,n){return TS.templates.user_group_list_item({user_group:t,is_flexpane:n})},buildUserGroupListHTML:function e(t,n){var r;var i=[];var a=[];var s=TS.permissions.members.canCreateAndDeleteUserGroups();for(var o=0;o<t.length;o+=1){r=t[o];if(r.date_delete){r.can_delete=!r.auto_type&&!r.is_external;a.push(r)}else i.push(r)}var l=!n&&!i.length&&!a.length||n&&!i.length;return TS.templates.user_group_list({user_groups:i,disabled_user_groups:a,show_toggle:s,is_flexpane:n,show_user_groups_help:l})},makeChannelPrefix:function e(t){if(!t)return"";if(t.is_group||t.is_private)return'<ts-icon class="ts_icon_lock"></ts-icon>';else if(t.is_channel)return"#";return""},makeChannelLink:function e(t,n,r,i){if(!t)return"ERROR: MISSING CHANNEL";var a=_.trim(TS.templates.builders.maybeMakeSharedIcon(t,r,i));var s=TS.utility.getChannelStringIdentifierForUrl(t);var o=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+s+'"':"";var l=TS.templates.builders.makeChannelPrefix(t);return'<a href="/archives/'+s+'" '+o+' class="channel_link" data-channel-id="'+t.id+'">'+(n?"":l)+t.name+a+"</a>"},maybeMakeSharedIcon:function e(t,n,r){var i="";if(TS.shared.isModelObOrgShared(t))i=TS.templates.shared_channel_icon({tooltip:n,tooltip_position:r});else if(TS.shared.isModelObShared(t))i=TS.templates.shared_channels_icon({tooltip:true,tooltip_position:r,shared_team_ids:t.shared_team_ids});return new Handlebars.SafeString(i)},makeChannelLinkEnterpriseSearchResult:function e(t){var n=t.permalink;var r='target="'+TS.templates.builders.newWindowName()+'"';return'<a href="'+n+'"'+r+' data-channel-id="'+t.channel.id+'">#'+t.channel.name+"</a>"},makeChannelPath:function e(t){return"/messages/"+TS.utility.getChannelStringIdentifierForUrl(t)},makeChannelLinkAriaLabelSafe:function e(t){if(!t)TS.warn("No valid channel to make channel link aria label");var n=_.escape(t.name);var i=TS.model.active_channel_id===t.id?TS.i18n.t("active channel","templates_builders")():TS.i18n.t("channel","templates_builders")();var a=r(t);var s=null;if(TS.templates.builders.showDraftIcon(t))s=TS.i18n.t("draft","messages")();var o=n+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeGroupLink:function e(t,n,r,i){if(!t)return"ERROR: MISSING GROUP";var a="";if(t.is_shared)a=TS.templates.shared_channel_icon({tooltip:r,tooltip_position:i});var s=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+t.id+'"':"";return'<a href="/archives/'+t.id+'" '+s+' class="group_link" data-group-id="'+t.id+'">'+(n?"":TS.model.group_prefix)+t.name+a+"</a>"},makeGroupLinkAriaLabelSafe:function e(t){if(!t)TS.warn("No valid group to make private channel link aria label");var n=_.escape(t.name);var i=TS.model.active_group_id===t.id?TS.i18n.t("active channel","templates_builders")():TS.i18n.t("channel","templates_builders")();var a=r(t);var s=null;if(TS.templates.builders.showDraftIcon(t))s=TS.i18n.t("draft","messages")();var o=n+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeTeamsThatHaveComplianceExportsBlurb:function e(t){if(!t||!t.is_shared)return"";var n;if(t.is_global_shared)n=_.filter(TS.model.enterprise_teams,"has_compliance_export");else n=_(t.shared_team_ids).map(function(e){return TS.enterprise.getTeamById(e)}).filter("has_compliance_export").value();var r=TS.i18n.listify(_.map(n,"name")).join("");var i=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t('{team_or_teams} {teams_count, plural, =1 {has} other {have}} <a href="https://get.slack.help/hc/{locale}/articles/204897248-Understanding-Slack-data-exports" target="_blank">Compliance Exports</a> enabled which allows their Workspace Owners to export communication history.',"templates_builders")({team_or_teams:r,teams_count:r.length,locale:TS.i18n.zdLocale()}):TS.i18n.t('{team_or_teams} {teams_count, plural, =1 {has} other {have}} <a href="https://get.slack.help/hc/{locale}/articles/204897248-Understanding-Slack-data-exports" target="_blank">Compliance Exports</a> enabled which allows their Team Owners to export communication history.',"templates_builders")({team_or_teams:r,teams_count:r.length,locale:TS.i18n.zdLocale()});return new Handlebars.SafeString(i)},makeMpimLink:function e(t,n){if(!t)return"ERROR: MISSING MPIM";var r;var i;var a=TS.mpims.getMpimArchivesPath(t);if(TS.utility.shouldLinksHaveTargets())r=TS.mpims.getMpimArchivesPath(t);if(n)i=TS.mpims.getTooltipText(t);return TS.templates.mpim_link({target:r,href:a,title:i,mpim:t})},makeMemberPreviewLink:function e(t,n){if(!t)return"";if(true!==n)n=false;var r=TS.boot_data.feature_name_tagging_client||TS.boot_data.feature_shared_channels_client?t.id:_.escape(t.name);var i=TS.templates.builders.makeMemberColorClass(t);var a;var s;if(t.is_service){s=TS.utility.shouldLinksHaveTargets()?'target="/services/'+t.id+'"':"";i+=" app_preview_link";a='<a href="/services/'+t.id+'" '+s+' class="message_sender service_link '+i+'">'}else{s=TS.utility.shouldLinksHaveTargets()?'target="/team/'+r+'"':"";i+=t.is_bot?" app_preview_link":" member member_preview_link";i+=" "+TS.templates.builders.makeMemberTypeBadgeClass(t);a='<a href="/team/'+r+'" '+s+' class="message_sender '+i+'" data-member-id="'+t.id+'">'}if(n&&t.id==TS.model.user.id)a+=TS.i18n.t("You","templates_builders")();else a+=TS.members.getPrefCompliantMemberName(t,true);a+=TS.templates.builders.makeMemberTypeBadgeCompact(t,false);a+="</a>";if(t.is_bot||t.is_service)a+='<span class="bot_label">'+TS.i18n.t("APP","templates_builders")()+"</span>";if(t.is_unknown)a=TS.templates.unknown_member();return a},showDraftIcon:function e(t){if(!_.isObject(t))return false;var n;var r=t.id;n=t.last_msg_input;if(!n&&t.presence){var i=TS.ims.getImByMemberId(t.id);n=i&&i.last_msg_input;r=i&&i.id}var a=TS.shared.getActiveModelOb();if(a){var s=a.id;if(s&&s==r&&!TS.client.activeChannelIsHidden())n=null}if(t.is_channel)if(t.is_archived||!t.is_member)n=null;if(t.is_group&&!t.is_mpim)if(t.is_archived)n=null;if(!TS.permissions.members.canPostInChannel(t))n=null;if(_.trim(n))return true;return false},makeProfileImage:function e(t,n){if(_.isString(t)){var r=TS.members.getMemberById(t);if(r)t=r;else t=TS.bots.getBotById(t)}if(!t)return false;var i=n.hash.is_lazy||false;var a=t.profile||t.icons||{};var s=n.hash.title||false;var o;if(a.emoji)o="64";else o="48";var l=n.hash.size||o;var u=Object.keys(TS.constants.avatar_size_map).reduce(function(e,t){if(t===l&&m(a,t))return t;return e},o);var d={entity:t,size:l,css_classes:f(t,l),image:c(t,m(a,u)),is_lazy:i,is_targettable:TS.utility.shouldLinksHaveTargets(),title:s};function c(e,t){var n=[];n.push("url('"+t+"')");return n.join(",")}function m(e,t){var n="image_"+t;if(e.hasOwnProperty(n)){if(TS.environment.is_retina)return e[TS.constants.avatar_size_map[t].retina]||e[TS.constants.avatar_size_map[t].standard];return e[TS.constants.avatar_size_map[t].standard]}return false}function f(e,t){var n=[];n.push("thumb_"+t);if(e.is_bot){n.push("is_bot");n.push("app_preview_link")}else n.push("member_preview_link");return n.join(" ")}return new Handlebars.SafeString(TS.templates.member_profile_image(d))},makeMemberPreviewLinkImage:function e(t,r,i,a,s,o,l){var u;if("object"===("undefined"===typeof t?"undefined":n(t)))u=t;else u=TS.members.getPotentiallyUnknownMemberById(t);if(!u||!u.profile)return"";i=true===i;a=true===a;s=true===s;o=true===o;l="string"===typeof l?l:false;if("USLACKBOT"===t&&l)u=TS.utility.slackbot.getWithFeels(l);var d=TS.templates.builders.getImageStyleForMemberPreviewImage(u,r,i);var c={omit_link:a,omit_badge:s,lazy:i,member:u,size:r,include_restricted_overlay:!o||true,bg_img_style:d};return TS.templates.member_preview_link_image(c)},getImageStyleForMemberPreviewImage:function e(t,n,r){var i;var a;var s;a="background-image: ";s=[];switch(n){case 20:case 24:if(TS.environment.is_retina)i=t.profile.image_48;else i=t.profile.image_24;break;case 32:if(TS.environment.is_retina)i=t.profile.image_72;else i=t.profile.image_32;break;case 36:case 48:if(TS.environment.is_retina)i=t.profile.image_72;else i=t.profile.image_48;break;case 72:if(TS.environment.is_retina)i=t.profile.image_192;else i=t.profile.image_72;break;case 192:if(TS.environment.is_retina)i=t.profile.image_512||t.profile.image_192;else i=t.profile.image_192;break;case 512:if(TS.environment.is_retina)i=t.profile.image_1024||t.profile.image_512||t.profile.image_192;else i=t.profile.image_512||t.profile.image_192;break;default:if(TS.environment.is_retina)i=t.profile.image_72;else i=t.profile.image_48}s.push("url('"+i+"')");if(512===n){var o=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;s.push("url('"+o+"')")}if(r)a=s.length?s.join(", "):"";else a=s.length?a+s.join(", "):"";return a},makeMemberPreviewCardLinkImage:function e(t){var n=TS.members.getPotentiallyUnknownMemberById(t);if(!n||!n.profile)return"";var r=TS.boot_data.feature_name_tagging_client||TS.boot_data.feature_shared_channels_client?n.id:n.name;var i=TS.templates.builders.makeMemberPreviewCardLinkImageBackground(t);var a=TS.utility.shouldLinksHaveTargets()?'target="/team/'+r+'"':"";return['<a href="/team/',r,'" ',a,' class="member_preview_link member_image thumb_512" data-member-id="',n.id,'" data-thumb-size="512" style="background-image: ',i,'" aria-hidden="true"></a>'].join("")},makeMemberPreviewCardLinkImageBackground:function e(t){var n=TS.members.getPotentiallyUnknownMemberById(t);if(!n||!n.profile)return"";var r;if(TS.environment.is_retina)r=n.profile.image_1024||n.profile.image_512||n.profile.image_192;else r=n.profile.image_512||n.profile.image_192;var i=TS.environment.is_retina?n.profile.image_72:n.profile.image_48;var a=TS.model.mac_version&&(0===TS.utility.compareSemanticVersions(TS.model.mac_version,"10.7")||0===TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8"))?"-webkit-":"";var s=[a+"linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0) 34%, rgba(0,0,0,0.2) 66%, rgba(0,0,0,0.2) 83%, rgba(0,0,0,0.6))","url('"+r+"')","url('"+i+"')"];return s.join(", ")},makeMemberLinkAriaLabelSafe:function e(t){if(!t)TS.warn("No valid direct message object to make member link aria label");var n=t.member;var i=t.model_ob;var a="";if(n&&i){var s=_.escape(TS.ims.getDisplayNameOfUserForIm(i));var o=TS.model.active_im_id===n.id?TS.i18n.t("active direct message","templates_builders")():TS.i18n.t("direct message","templates_builders")();var l=TS.templates.makeMemberPresenceStateAriaLabel(n);var u=r(i);var d=null;if(TS.templates.builders.showDraftIcon(i))d=TS.i18n.t("draft","messages")();a=s+", "+o+", "+l+(u?", "+u:"")+(d?", "+d:"")}return new Handlebars.SafeString(a)},makePendingUserImage:function e(t,n){if(!t||!n)return"";var r=[];var i=[];var a;switch(n){case 24:a=48;break;case 36:a=72;break;default:a=48}var s="/img/new_channel_modal/airplane_"+a.toString()+".png";i.push("url('"+vvv(s)+"')");var o=i.join(",");var l={restricted:t.invite_prefs&&"restricted"===t.invite_prefs.type,img_classes:r.join(" "),bg_img_urls:o,size:n};return TS.templates.pending_user_image(l)},newWindowName:function e(){if("web"===TS.boot_data.app||"calls"===TS.boot_data.app)return"_self";return"new_"+a.toString()},getBotIdentifier:function e(t){if(!t.bot_id&&!t.username)return null;var n=TS.bots.getBotByMsg(t);var r=!t.username&&n&&n.name?n.name:t.username;var i=n?n.id:"NOBOTID";return i+"_"+r},getBotName:function e(t){var n=t.username;if(!n){var r=TS.bots.getBotByMsg(t);if(r&&r.name)n=r.name}return n},getBotNameWithLink:function e(t){var n=t.username;var r=TS.bots.getBotByMsg(t);var i=TS.templates.builders.makeBotLink(r,t.username);if(!n)if(r&&r.name)n=r.name;return new Handlebars.SafeString(i.start_a+_.escape(n)+i.end_a)},makeBotLink:function e(t){var n="";var r="";if(t&&!t.deleted){n='<a class="app_preview_link" target="/services/'+t.id+'" href="/services/'+t.id+'">';r="</a>"}else{n='<a class="app_preview_link">';r="</a>"}return{start_a:n,end_a:r}},makeFiletypeHTML:function e(t){if(t.external_type)return TS.templates.builders.makeExternalFiletypeHTML(t);var n="";n+='<a href="'+t.url_private_download+'" ';n+='target="'+t.url_private_download+'" ';n+='title="'+TS.i18n.t("Download this file","templates_builders")()+'" ';n+='data-file-id="'+t.id+'" ';n+='class="subtle_silver file_ssb_download_link">';n+=TS.utility.convertFilesize(t.size)+" ";n+="<span>"+t.pretty_type+"</span>";if("snippet"===t.mode)n+=" "+TS.i18n.t("snippet","templates_builders")();n+="</a>";return n},makeExternalFiletypeHTML:function e(t){if(!t.is_external)return;var n="";switch(t.external_type){case"gdrive":switch(t.filetype){case"gsheet":n=TS.i18n.t("Spreadsheet from Google Drive","templates_builders")();break;case"gdoc":n=TS.i18n.t("Document from Google Drive","templates_builders")();break;case"gpres":n=TS.i18n.t("Presentation from Google Drive","templates_builders")();break;case"gdraw":n=TS.i18n.t("Drawing from Google Drive","templates_builders")();break;default:n=TS.i18n.t("<span>{file_type}</span> from Google Drive","templates_builders")({file_type:t.pretty_type})}break;case"dropbox":n=TS.i18n.t("<span>{file_type}</span> from Dropbox","templates_builders")({file_type:t.pretty_type});break;case"box":n=TS.i18n.t("<span>{file_type}</span> from Box","templates_builders")({file_type:t.pretty_type});break;case"onedrive":n=TS.i18n.t("<span>{file_type}</span> from OneDrive","templates_builders")({file_type:t.pretty_type});break;default:n=TS.i18n.t("File","templates_builders")()}return n},makeUnshareLink:function e(t,n){var r=(t.is_channel?"#":"")+t.name;var i=TS.i18n.t("Unshare from {channel}","templates_builders")({channel:r});return'<a class="unshare_link ts_tip ts_tip_top ts_tip_float ts_tip_unshare_link ts_tip_multiline" onclick="TS.files.promptForFileUnshare(\''+n.id+"', '"+t.id+'\')"><span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+i+'</span></span><i class="ts_icon ts_icon_minus_circle_small"></i></a>'},updateFileShareLabels:function e(t){var n=$('.file_share_label[data-file-id="'+t.id+'"]');n.each(function(){$(this).replaceWith(TS.templates.builders.makeFileShareLabel(t))});if(t.is_shared){$('.file_share_shared_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').addClass("hidden")}else{$('.file_share_shared_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').removeClass("hidden")}if(t.is_public){$('.file_share_private_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').removeClass("hidden")}else{$('.file_share_private_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').addClass("hidden")}},makeFileShareLabel:function e(t){var n='<span class="file_share_label" data-file-id="'+t.id+'">';var r=TS.templates.builders.makeFileGroupChannelList(t);if(!r.length){if(!t.is_public&&t.user!==TS.model.user.id)n+=TS.i18n.t("shared with you","templates_builders")()}else n+=TS.i18n.t("in {share_list}","templates_builders")({share_list:r});n+="</span>";return n},makeFileGroupChannelList:function e(t){var n=[];var r;var i;var a;for(a=0;a<t.channels.length;a+=1){i=TS.channels.getChannelById(t.channels[a]);if(!i)continue;r='<span class="no_wrap">';r+=TS.templates.builders.makeChannelLink(i,t);r+="&nbsp;"+TS.templates.builders.makeUnshareLink(i,t);r+="</span>";n.push(r)}var s;for(a=0;a<t.groups.length;a+=1){s=TS.groups.getGroupById(t.groups[a]);if(!s)continue;r='<span class="no_wrap">';r+=TS.templates.builders.makeGroupLink(s,t);r+="&nbsp;"+TS.templates.builders.makeUnshareLink(s,t);r+="</span>";n.push(r)}if(!n.length)return"";return n.join(", ")},makeFileCommentHelpHTML:function e(t){if(t&&t.is_public&&(t.channels&&t.channels.length||t.groups&&t.groups.length)){var n=[];if(t.channels&&t.channels.length)n=n.concat(t.channels);if(t.groups&&t.groups.length)n=n.concat(t.groups);return TS.i18n.t("Commenting in {channel_names}","templates_builders")({channel_names:TS.templates.builders.makeLinksFromChannelOrGroupIds(n)})}return""},makeLinksFromChannelOrGroupIds:function e(t,n){n=n||{};t=TS.utility.parseJSONOrElse(t,t);t=_.isArray(t)?t:[t];var r=0;var i=n.new_lines?" block":"";var a=t.map(function(e){return TS.channels.getChannelById(e)||TS.groups.getGroupById(e)}).filter(function(e){if(!e)r+=1;return!!e});var s=TS.sorter.search("",{groups:a},{allow_empty_query:true});var o=s.sort().map(function(e){var t='<span class="no_wrap'+i+'">';t+=e.is_channel?TS.templates.builders.makeChannelLink(e):TS.templates.builders.makeGroupLink(e);t+="</span>";return t});if(r){var l=TS.i18n.t("{private_channel_or_group_count, plural, =1{# private channel}other{# private channels}}","templates_builders")({private_channel_or_group_count:r});o.push('<span class="no_wrap'+i+'">'+l+"</span>")}if(n.new_lines)return o.join("");return TS.i18n.listify(o,{no_escape:true}).join("")},makeMessageShareLabelSafe:function e(t){var n='<span class="message_share_label">';var r="";if(t.is_channel)r=TS.templates.builders.makeChannelLink(t);else if(t.is_group)r=TS.templates.builders.makeGroupLink(t);n+=TS.i18n.t("in {channel}","templates_builders")({channel:r});n+="</span>";return new Handlebars.SafeString(n)},makeMessageLinkLabelSafe:function e(t){var n=TS.i18n.t("From URL:","templates_builders")()+" <a "+TS.utility.makeRefererSafeLink(t)+' class="external_link"title="'+_.escape(t)+'"target="_blank">'+_.escape(t)+"</a>";return new Handlebars.SafeString(n)},makeSHRoomParticipantList:function e(t){var n=t.date_end?t.participant_history:t.participants;var r=_.compact(n.map(function(e){var t=TS.members.getMemberById(e);if(t&&t.is_unknown)return TS.templates.unknown_member();else if(t)return _.escape(TS.members.getPrefCompliantMemberName(t));return})).join(", ");return new Handlebars.SafeString(r)},makeSHRoomSharedList:function e(t){if(!t.channels||!t.channels.length)return"";var n=[];var r;var i;var a;for(var s=0;s<t.channels.length;s+=1){a=TS.shared.getModelObById(t.channels[s]);if(!a)continue;if(a.is_channel)r=TS.templates.builders.makeChannelLink(a);else if(a.is_group)r=TS.templates.builders.makeGroupLink(a);else if(a.is_im){i=TS.members.getMemberById(a.user);if(!i)continue;r=TS.templates.builders.makeMemberPreviewLink(i)}else continue;n.push(r)}if(!n.length)return"";return n.join(", ")},buildFileSharingControls:function e(t,n,r,i,a){var s;var o;if(TS.client){if(!TS.client.activeChannelIsHidden())o=TS.shared.getActiveModelOb()}else if(TS.web&&TS.web.space)o=TS.shared.getModelObById(TS.web.space.getOriginChannel());if(!o)s="channel";else if(o.is_im)s="im";else if(o.is_mpim)s="mpim";else if(o.is_group||o.is_private)s="group";else if(o.is_channel)s="channel";if(o&&TS.channels.isChannelRequired(o)&&!TS.permissions.members.canPostInChannel(o))o={};var l=[];var u=[];var d=[];if("group"===s&&u&&!u.length)s="channel";r=r||"";$("#file_sharing_div").remove();var c=false;var m=false;if(!t)c=true;else if(t.user===TS.model.user.id)c=true;else if(t.user){var f=TS.members.getMemberById(t.user);if(f&&f.is_external)m=TS.teams.getTeamNameByMember(f)}var p=TS.i18n.t("Files are private until they are shared in a public channel.","templates_builders")();if(t){if(t.is_public)if(TS.boot_data.feature_teams_to_workspaces)p=TS.i18n.t("Files you share into a channel are visible to all members.","templates_builders")();else p=TS.i18n.t("Files you share into a channel are visible to all team members.","templates_builders")();if(t.type&&-1!=t.type.indexOf("application/vnd.google-apps")){var h=t.display_type||t.type;if(TS.model.team.name)p=TS.i18n.t("Anyone at {team_name} with the link will be able to edit this Google {file_type}","templates_builders")({team_name:TS.model.team.name,file_type:_.capitalize(h.replace("application/vnd.google-apps",""))});else p=TS.i18n.t("Anyone with the link will be able to edit this Google {file_type}","templates_builders")({file_type:_.capitalize(h.replace("application/vnd.google-apps",""))})}}var g=TS.web&&TS.web.space&&c&&!TS.model.team.prefs.disable_file_editing&&!t.channels.concat(t.groups).concat(t.ims).length;return TS.templates.file_sharing({share_context:s,channels:l,groups:u,members:d,model_ob:o,file:t,file_sharing_notice:p,is_owner:c,owner_team:m,has_title:i,hide_checkbox:n,comment:r,selection:a,show_channel_join_note:o&&o.is_channel&&!o.is_member&&!o.is_archived,enable_collab_editing:g})},buildNonDefaultNotificationBlock:function e(t){t=t||"";var n="";var r;var i=TS.notifs.getCorGsNotUsingGlobalNotificationSetting();if(i.everything.length){n+='<div class="'+t+'">'+TS.i18n.t("Set to notify for <strong>all activity</strong>:","templates_builders")();for(r=0;r<i.everything.length;r+=1)n+=" "+("C"===i.everything[r].id.charAt(0)?"#":"")+i.everything[r].name+(r!=i.everything.length-1?",":"");n+="</div>"}if(i.mentions.length){n+='<div class="'+t+'">'+TS.i18n.t("Set to notify only for <strong>Highlight Words</strong>:","templates_builders")();for(r=0;r<i.mentions.length;r+=1)n+=" "+("C"===i.mentions[r].id.charAt(0)?"#":"")+i.mentions[r].name+(r!=i.mentions.length-1?",":"");n+="</div>"}if(i.nothing.length){n+='<div class="'+t+'">'+TS.i18n.t("Set to <strong>never notify</strong>:","templates_builders")();for(r=0;r<i.nothing.length;r+=1)n+=" "+("C"===i.nothing[r].id.charAt(0)?"#":"")+i.nothing[r].name+(r!=i.nothing.length-1?",":"");n+="</div>"}return n},strBuilder:function e(t,n){return t.replace(/\${([a-z_]+)}/g,function(e,t){if(t.indexOf("_html")>-1)return n[t];return _.escape(n[t])})},buildRxnTitle:function e(t,n){if(TS.boot_data.feature_i18n_reactions)return TS.templates.builders.buildRxnTitleI18n(t,n);if(!n)return;var r;var i=":"+t.name+":";if(TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)i=TSFEmoji.translateEmojiStringToLocal(i,TS.i18n.locale());if(t.is_handy||t.is_poll&&!t.count){r=_.escape(i||t.name);return TS.i18n.t("Add reaction {emoji}","rxn")({emoji:r})}var a=false;var s=!TS.boot_data.feature_name_tagging_client;var o=true;var l;r=_.escape(i||t.name);l=TS.i18n.t("{reactionCount, plural, other{reacted with {emoji}}}","rxn")({emoji:r,reactionCount:t.count});if(!TS.emoji.isValidName(t.name)&&!t.url)l+=" "+TS.i18n.t("(emoji has been removed)","rxn")();l=' <span class="subtle_silver">'+l+"</span>";if(1==t.count){if(t.user_reacted)return TS.i18n.t("You (click to remove)","rxn")()+l;return _.escape(TS.members.getPrefCompliantMemberNameById(t.member_ids[0],a,s,o))+l}var u=t.member_ids.length!=t.count;var d=t.member_ids.map(function(e,t){var n;if(TS.model.user.id===e)n=0===t?TS.i18n.t("You","rxn")():TS.i18n.t("you","rxn")();else n=TS.members.getPrefCompliantMemberNameById(e,a,s,o);return n});if(u)d.push(TS.i18n.t("others","rxn")());return _.escape(TS.i18n.listify(d,{no_escape:true}).join(""))+l},buildRxnTitleI18n:function e(t,n){if(!n)return;if(TS.boot_data.feature_i18n_reactions){var r;var i=":"+t.name+":";if(TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)i=TSFEmoji.translateEmojiStringToLocal(i,TS.i18n.locale());if(t.is_handy||t.is_poll&&!t.count){r=_.escape(i||t.name);return TS.i18n.t("Add reaction {emoji}","rxn")({emoji:r})}var a=false;var s=!TS.boot_data.feature_name_tagging_client;var o=true;r=_.escape(i||t.name);if(!TS.emoji.isValidName(t.name)&&!t.url)r+=TS.i18n.t("(emoji has been removed)","rxn")();if(1===t.count){if(t.user_reacted)return TS.i18n.t('You (click to remove) <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({emoji:r});return TS.i18n.t('{user} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({user:TS.members.getPrefCompliantMemberNameById(t.member_ids[0],a,s,o),emoji:r})}var l=false;var u=t.member_ids.length!=t.count;var d=t.member_ids.map(function(e,t){var n;if(TS.model.user.id===e){l=true;n=0===t?TS.i18n.t("You","rxn")():TS.i18n.t("you","rxn")()}else n=TS.members.getPrefCompliantMemberNameById(e,a,s,o);return n});if(u)d.push(TS.i18n.t("others","rxn")());if(l)return TS.i18n.t('{users_and_you} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users_and_you:_.escape(TS.i18n.listify(d,{no_escape:true}).join("")),emoji:r});return TS.i18n.t('{users} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users:_.escape(TS.i18n.listify(d,{no_escape:true}).join("")),emoji:r})}return""},buildRxnHtml:function e(t){var n;if(t.url)n='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+t.url+');"></span>';else if(TS.emoji.isValidName(t.name)){var r=t.is_handy&&TS.emoji.isNameSkinToneModifiable(t.name)?TS.emoji.getChosenSkinToneModifier():"";n=TS.emoji.graphicReplace(":"+t.name+":"+r,{no_skin_tone_squares:t.is_handy})}else n=TS.emoji.MISSING_EMOJI_HTML;var i=TS.templates.builders.buildRxnTitle(t);var a=[];if(t.user_reacted)a.push("user_reacted");if(t.is_handy)a.push("is_handy");if(t.is_hidden)a.push("hidden");return TS.templates.rxns_rxn({name:t.name,url:t.url,css_classes:a.join(" "),emoji_html:new Handlebars.SafeString(n),title:i,count:t.count,is_handy:!!t.is_handy})},updateRxnHtml:function e(t,n){var r=t.children('.rxn[data-emoji="'+n.name+'"]');if(r.length){r.find(".emoji_rxn_count").attr("aria-label",n.count);r.toggleClass("user_reacted",n.user_reacted);var i=true;var a=TS.templates.builders.buildRxnTitle(n,i);var s;var o=r.find(".ts_tip_tip_inner");if(!o.length)o=r.find(".ts_tip_multiline_inner");if(o.length){s=o.html();if(s!=a)TS.tips.updateTipTitle(r,a)}else{s=r.prop("title");if(s!=a)TS.tips.updateTipTitle(r,a)}if(n.animate_it_dramatically)setTimeout(n.animate_callback,0);else if(n.animate_it)setTimeout(n.animate_callback,0)}else{t.children(".rxn_hover_container").before($(TS.templates.builders.buildRxnHtml(n)));r=t.children('.rxn[data-emoji="'+n.name+'"]');if(n.animate_it_dramatically)r.css("opacity",0).transition({opacity:1},300,n.animate_callback);else if(n.animate_it)r.css("opacity",0).transition({opacity:1},300,n.animate_callback)}},updateRxnPanels:function e(t,n,r){var i=TS.rxns.getExistingRxnsByKey(t);var a=$("."+TS.templates.makeRxnKeyDomClass(t));var s=function e(a){var s;var o;if(i)i.forEach(function(e){s=e.name==n;o=s&&r==TS.model.user.id;TS.templates.builders.updateRxnHtml(a,{animate_it:s,animate_it_dramatically:o,name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(i,e.name),member_ids:e.users,rxn_key:t})});var l=a.children(".rxn");l.each(function(e,t){var n=$(t);var r=String(n.data("emoji"));if(!TS.rxns.doesRxnsHaveRxn(i,r)){n.addClass("going_away");n.transition({opacity:0},300,function(){n.remove()})}});TS.ui.messages.maybeUpdateMessageHoverContainer(a.closest("ts-message"));var u=a.children(".rxn_hover_container").find(".rxn.is_handy");u.each(function(e,t){var n=$(t);var r=String(n.data("emoji"));n.toggleClass("hidden",TS.rxns.doesRxnsHaveSkinlessRxn(i,r))})};a.each(function(e,n){var r=$(n);if(!i){r.empty();TS.ui.messages.maybeUpdateMessageHoverContainer(r.closest("ts-message"));return}if(!r.children().length)r=$(TS.templates.builders.rxnPanel(t)).replaceAll(r);s(r)})},rxnPanel:function e(t){if(!t)return;var n=[];var r={};var i="";var a=TS.rxns.getExistingRxnsByKey(t);var s="";var o=function e(){if(a){a=_.sortBy(a,function(e){return TS.emoji.isValidName(e.name)?0:1});a.forEach(function(e){s+=TS.templates.builders.buildRxnHtml({name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(a,e.name),member_ids:e.users,rxn_key:t})})}_.each(_.keys(r.items),function(e){i+=TS.templates.builders.buildRxnHtml({name:e,is_handy:true,is_hidden:TS.rxns.doesRxnsHaveSkinlessRxn(a,e),rxn_key:t})})};o();return TS.templates.rxns_panel({css_classes:n.join(" "),rxn_key:t,rxns_html:new Handlebars.SafeString(s),handy_rxns_html:new Handlebars.SafeString(i),id_class:TS.templates.makeRxnKeyDomClass(t),has_hovers:!r.is_poll})},buildHistoryNavBtnHtml:function e(){var t=TS.model.prefs.no_omnibox_in_channels;var n=TS.model.prefs.prev_next_btn;var r=0;if(!n)r+=2;if(!t)r+=1;var i=TS.templates.footer_nav_btn({id:"left_arrow_btn",col:r,type:"ts_icon_arrow_large_left",name:"Previous",mac_or_pc:TS.model.is_mac?"⌘":"Alt",prev_or_next:"ts_icon_arrow_left_medium"});var a=TS.templates.footer_nav_btn({id:"right_arrow_btn",col:r,type:"ts_icon_arrow_large_right",name:"Next",mac_or_pc:TS.model.is_mac?"⌘":"Alt",prev_or_next:"ts_icon_arrow_right_medium"});var s=TS.templates.footer_nav_btn({id:"quickswitcher_btn",col:r,type:"ts_icon_filter",name:"Quick Switcher",mac_or_pc:TS.model.is_mac?"⌘ K":"Alt K"});var o="";if(!n)o+=i+a;if(!t)o+=s;return o},filePreviewBackIcon:function e(){return'<i class="ts_icon ts_icon_chevron_medium_left back_icon"></i>'},buildQuickSwitcherBtnHtml:function e(){var t=TS.i18n.t("Quick Switcher","templates_builders")();if(TS.model.is_our_app||TS.model.prefs.k_key_omnibox)t+=[" ",'<span class="subtle_silver">(',TS.model.is_mac?"&#8984K":"Ctrl+K",")</span>"].join("");return'<i class="ts_icon ts_icon_filter"></i><span id="quick_switcher_label" class="ts_tip_tip">'+t+"</span>"},atLabel:function e(t){if("group"===t)t="channel";var n=_.keyBy(TS.model.BROADCAST_KEYWORDS,"ms_name")[t].name||t;return"@"+n},makeMemberTypeBadge:function e(t,n,r,i){if(!TS.boot_data.page_needs_enterprise)return"";n=parseInt(n,10);if(isNaN(n))n=16;if("boolean"!==typeof r)r=false;if("boolean"!==typeof i)i=false;var a={size:"member_type_badge_"+n,big:n>=20,is_standalone:r,with_tooltip:i};if(t.is_external)return"";if(t.is_ultra_restricted)return TS.templates.member_type_guest_badge(a);if(t.is_restricted)return TS.templates.member_type_restricted_badge(a);return""},makeMemberTypeBadgeClass:function e(t){if(!TS.boot_data.page_needs_enterprise)return"";if(!t.is_restricted)return"";return"has_member_type_badge"},makeMemberColorClass:function e(t){var n="color_";if(t)n+=t.id+" color_"+t.color;else n+="unknown";return n},makeMemberTypeBadgeCompact:function e(t,n){if(!TS.boot_data.page_needs_enterprise)return"";if("boolean"!==typeof n)n=false;var r={icon_class:"",with_tooltip:n,tooltip:{member_type:"",type_description:""}};var i;if(TS.boot_data.feature_teams_to_workspaces)i=TS.boot_data.page_needs_enterprise?TS.i18n.t("organization directory","templates_builders")():TS.i18n.t("workspace directory","templates_builders")();else i=TS.boot_data.page_needs_enterprise?TS.i18n.t("organization directory","templates_builders")():TS.i18n.t("team directory","templates_builders")();if(t.is_external)return"";else if(t.is_ultra_restricted){r.icon_class="ts_icon_single_channel_guest";r.tooltip.member_type=TS.i18n.t("Single-Channel Guests","templates_builders")();r.tooltip.type_description=TS.i18n.t("see a partial {directory_name} and can only access messages and files from the channel they belong to.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(r)}else if(t.is_restricted){r.icon_class="ts_icon_restricted_user";r.tooltip.member_type=TS.i18n.t("Multi-Channel Guests","templates_builders")();r.tooltip.type_description=TS.i18n.t("see only a partial {directory_name} and can only access messages and files from selected channels.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(r)}return""},getMemberTypeClass:function e(t){if(t.is_restricted)return" ra";return""},makeTeamlabel:function e(t){if(!t)return"ERROR: MISSING TEAM ID";var n="";var r;var i=TS.model.enterprise_teams;if(i)r=_.find(i,function(e){return e.id===t});else return"ERROR: UNABLE TO GET TEAMS INFO";n='<span class="org_team_tag_name">'+_.escape(r.name)+"</span>";return n},loadingHTML:function e(){var t=cdn_url+"/9c217/img/loading_hash_animation_@2x.gif";var n=cdn_url+"/9c217/img/loading_hash_animation.gif";var r=TS.i18n.t("loading&hellip;","templates_builders")();return'<div class="loading_hash_animation"><img src="'+t+'" alt="'+r+'" srcset="'+n+" 1x, "+t+' 2x" /><br />'+r+"</div>"},buildThreadMsgHTML:function e(t,n,r,i){var a=!!_.get(i,"inline");var s=a?TS.templates.makeMsgDomId(t.ts):TS.templates.makeMsgDomIdInThreadsView(t.ts);return TS.templates.builders.msgs.buildHTML({msg_dom_id:s,model_ob:n,msg:t,is_threads_view:true,is_new_reply:TS.utility.msgs.isMsgReply(t)&&r&&t.ts>r.initial_last_read,relative_ts:true,enable_slack_action_links:true})},buildThreadParticipantListHTML:function e(t){var n=_.map(t.replies,"user");var r=_.map(t.replies,"bot_id");n=n.concat(r);n=_.without(n,"U00",void 0);if("tombstone"!==t.subtype&&t.user)n.unshift(t.user);n=_.uniq(n);if(_.includes(n,TS.model.user.id)){n=_.without(n,TS.model.user.id);n.push(TS.model.user.id)}var i=_.map(n,function(e){var t;if("B"===e.charAt(0))t=TS.bots.getBotNameById(e);else if(e===TS.model.user.id)t=TS.i18n.t("you","threads")();else t=TS.members.getPrefCompliantMemberNameById(e);return t});if(1===n.length){if(n[0]===TS.model.user.id)return TS.i18n.t("Just you","threads")();return _.escape(i[0])}else if(2===n.length){if(n[1]===TS.model.user.id)return TS.i18n.t("{user_name} and you","threads")({user_name:_.escape(i[0])});return TS.i18n.t("{user_name1} and {user_name2}","threads")({user_name1:_.escape(i[0]),user_name2:_.escape(i[1])})}else if(3===n.length){if(n[2]===TS.model.user.id)return TS.i18n.t("{user_name1}, {user_name2}, and you","threads")({user_name1:_.escape(i[0]),user_name2:_.escape(i[1])});return TS.i18n.t("{user_name1}, {user_name2}, and {user_name3}","threads")({user_name1:_.escape(i[0]),user_name2:_.escape(i[1]),user_name3:_.escape(i[2])})}else if(n.length>3){var a=n.length-2;var s=_.drop(i,2);var o=25;if(s.length>o){s=_.take(s,o);s.push(TS.i18n.t("others","threads")())}var l=TS.i18n.listify(s,{no_escape:true}).join("");return TS.templates.thread_participants_with_overflow({num_others:a,user_name1:i[0],user_name2:i[1],other_names:l})}},buildBroadcastRepliersSummaryHTML:function e(t){var n=t.reply_count;var r=t.replies;if(!r||!r.length)return"";var i=_.map(r,"user");i=_.uniq(i);var a=i.length;var s=_.map(i,function(e){if("U00"===e)return null;var t=e.charAt(0);var n;if("B"===t)n=TS.bots.getBotById(e);else n=TS.members.getPotentiallyUnknownMemberById(e);return n});s=_.compact(s);if(!n||!s.length)return"";if(1===n)return TS.i18n.t("1 reply","threads")();var o=!!_.find(s,{is_self:true});if(o){s=_.reject(s,{is_self:true});s.push(TS.model.user)}var l=_.map(s,function(e){if(e.is_bot)return e.name;else if(e.is_self)return TS.i18n.t("you","threads")();return TS.members.getPrefCompliantMemberName(e)});if(1===s.length){if(o)return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from you","threads")({reply_count:n});return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name}","threads")({reply_count:n,user_name:_.escape(l[0])})}else if(2===s.length){if(o)return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name} and you","threads")({reply_count:n,user_name:_.escape(l[0])});return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1} and {user_name2}","threads")({reply_count:n,user_name1:_.escape(l[0]),user_name2:_.escape(l[1])})}else if(3===s.length){if(o)return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and you","threads")({reply_count:n,user_name1:_.escape(l[0]),user_name2:_.escape(l[1])});return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and {user_name3}","threads")({reply_count:n,user_name1:_.escape(l[0]),user_name2:_.escape(l[1]),user_name3:_.escape(l[2])})}else if(s.length>3){var u=_.drop(l,2);if(u.length<a-2)u.push(TS.i18n.t("others","threads")());var d=TS.i18n.listify(u,{no_escape:true}).join("");return TS.templates.thread_broadcast_repliers_with_overflow({reply_count:n,num_others:a-2,user_name1:l[0],user_name2:l[1],other_names:d})}return""},getFileDisplayName:function e(t){if(!t)return;var n;if(/(snippet)/.test(t.mode))n=TS.i18n.t("{file_pretty_name} snippet","message")({file_pretty_name:t.pretty_type});else if(/(email)/.test(t.mode))n=TS.i18n.t("email","message")();else if(/(post|space)/.test(t.mode))n=TS.i18n.t("post","message")();else if((t.thumb_360||t.thumb_360_gif)&&-1!==t.mimetype.indexOf("image/"))n=TS.i18n.t("image","message")();else n=TS.i18n.t("file","message")();return n},test:function e(){var t={};Object.defineProperty(t,"_buildStarComponents",{get:function e(){return i},set:function e(t){i=t}});return t}});var e=8;var t=false;function r(e){var t="";var n=e.unread_highlight_cnt;var r=e.unread_cnt;if(n&&!e.is_im)t+=n+" "+TS.i18n.t("unread highlight","templates_builders")()+" ";else if(r)t+=r+" "+TS.i18n.t("unread","templates_builders")()+" ";if(r)t+=TS.i18n.t("{count, plural, =1 {message} other {messages}}","templates_builders")({count:r});return t}function i(e,t,n){if(!e)return{};if(t&&"string"===typeof t&&("channel"===e||"group"===e||"mpim"===e||"im"===e))t=TS.shared.getModelObById(t);if(!t)return{};if("message"===e&&n&&"string"===typeof n){var r=n;n=TS.channels.getChannelById(r);if(!n)n=TS.ims.getImById(r);if(!n)n=TS.groups.getGroupById(r)}var i={};var a=[];var s=[];s=["star","ts_icon","ts_icon_star_o","ts_icon_inherit"];var o="ts_tip_top";var l=t.id||t.ts;var u=n?n.id:null;if("message"===e){if(!u)return{};i["data-msg-id"]=l;i["data-c-id"]=u;if(TS.utility.msgs.isTempMsg(t))s.push("invisible")}else if("file"===e)i["data-file-id"]=l;else if("file_comment"===e){i["data-comment-id"]=l;i["data-file-id"]=u;s.push("star_comment")}else if("channel"===e){o="ts_tip_bottom";i["data-channel-id"]=l}else if("group"===e){o="ts_tip_bottom";i["data-group-id"]=l}else if("im"===e){if(TS.apps.isAppSpaceEnabled()&&TS.apps.isCurrentModelViewAnApp())e="app";o="ts_tip_bottom";i["data-im-id"]=l}else if("mpim"===e){o="ts_tip_bottom";i["data-mpim-id"]=l}else{TS.error("buildStar needs to handle star item type:"+e);return{}}s=_.concat(s,o);if(t.is_starred){s.push("starred","ts_icon_star");s.splice(s.indexOf("ts_icon_star_o"),1)}s.push("star_"+e);$.each(i,function(e,t){a.push(e+'="'+t+'"')});var d={message:TS.i18n.t("message","templates_builders")(),file:TS.i18n.t("file","templates_builders")(),file_comment:TS.i18n.t("file comment","templates_builders")(),channel:TS.i18n.t("channel","templates_builders")(),group:TS.i18n.t("channel","templates_builders")(),im:TS.i18n.t("direct message","templates_builders")(),app:TS.i18n.t("app","templates_builders")(),mpim:TS.i18n.t("direct message","templates_builders")()};return{attributes:a,class_names:s,html_attrs:i,readable_type:d[e],is_starred:t.is_starred}}var a=Date.now()})()},4245:function(e,t,n){(function(){"use strict";TS.registerModule("templates.builders.msgs",{buildHTML:function t(n,r){if(r)TS.dir(0,n);try{var i=n.msg;var a=n.model_ob;var s=n.prev_msg;var o=!!n.highlight;var l=!!n.no_attachments;var u=!!n.standalone;var d=!!(u||n.hide_actions);var c=!!n.full_date;if(TS.model.prefs.fuller_timestamps&&!c)c=!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(i.ts),new Date);var m=!!n.relative_ts;var f=n.jump_link?new Handlebars.SafeString(n.jump_link):"";var p=!!n.starred_items_list;var h=n.starred_items_actions;var g=n.container_id?"#"+n.container_id:"";var S=!!n.enable_slack_action_links;var T=!!(n&&n.highlight_as_new);var v="";var b=TS.utility.members.getEntityFromMessage(i);var y=true;var w=TS.interop.datetime.toDateObject(i.ts);var k=false;var x=false;var C=!!i.is_pending;var M=i.user;var I;var A=i.is_ephemeral;var E=TS.templates.makeMsgDomId(i.ts);var F=TS.utility.msgs.getMsgActions(i,a);if(!M)M=TS.templates.builders.getBotIdentifier(i);var O=TS.utility.msgs.shouldHaveBotLabel(i,b);var B;var H;var D;var P;E=n.msg_dom_id||E;var j=!!n.is_in_conversation;var R=!!n.is_threads_view;if(false){i=_.cloneDeep(i);i.text+=" <slack-action://BSLACKBOT/help/files/D026MK7NF|testing>"}if(O){var L=TS.bots.getBotInfoByMsg(i);if(L){B=_.get(L,"app_id");H=_.get(L,"bot_id");D=_.get(L,"team_id")?L.team_id:_.get(i,"source_team_id")}P=true}if(s){I="file_comment"===s.subtype&&s.comment?s.comment.user:s.user;if(!I)I=TS.templates.builders.getBotIdentifier(s)}if(!i.no_display&&!u)if(s){var U=TS.interop.datetime.toDateObject(s.ts);if(i.subtype&&"file_comment"===i.subtype&&i.comment)M=i.comment.user;if(-1!=TS.utility.msgs.automated_subtypes.indexOf(i.subtype)||"thread_broadcast"===i.subtype)y=true;else if(I==M&&-1===TS.utility.msgs.automated_subtypes.indexOf(s.subtype))if(!i.subtype&&s.subtype&&"file_comment"===s.subtype)y=true;else{if(!s.subtype||TS.templates.builders.getBotIdentifier(s)){var N=s.thread_ts||s.ts;var G=i.thread_ts==N;var W=!i.thread_ts&&!s.thread_ts;if(G||W)y=false}if(TS.utility.msgs.isTempMsg(i)&&("bot_message"===i.type||"USLACKBOT"===i.user))y=true}if(!C&&!TS.interop.datetime.isSameDay(w,U)&&!j){k=true;var q=$(g+" div.day_divider");if(q.length>0){var z;var K=$(q[q.length-1]);if(K.length){z="";try{z=TS.templates.messages_day_divider({ts:K.data("ts")})}catch(e){if(!e.message)e.message="";e.message+=" $last_divider.data('ts'):"+K.data("ts");TS.info("Problem with TS.templates.messages_day_divider 2.1: "+JSON.stringify(e))}K.replaceWith(z)}if(q.length>1){var V=$(q[q.length-2]);if(V.length){z="";try{z=TS.templates.messages_day_divider({ts:V.data("ts")})}catch(e){if(!e.message)e.message="";e.message+=" $second_last_divider.data('ts'):"+V.data("ts");TS.info("Problem with TS.templates.messages_day_divider 3.1: "+JSON.stringify(e))}V.replaceWith(z)}}}}if(!C&&TS.interop.datetime.distanceInMinutes(w,U)>TS.model.msg_activity_interval)x=true}else if(!j)x=true;if(x)y=true;if("message"!==i.type)y=true;if("me_message"===i.subtype||s&&"me_message"===s.subtype)y=true;var Y=true;if(u)Y=false;var J=false;var Q=TS.rxns.getExistingRxnsByKey(i._rxn_key);if(Q)J=true;if(n.for_mention_rxn_display)y=false;var X;var Z;var ee="#msgs_div"===g||"#unread_msgs_div"===g;if(TS.client&&TS.client.highlights&&!u){X=ee&&TS.client.highlights.msgIsHighlight(a.id,i.ts);Z=ee&&TS.client.highlights.msgIsHighlightUnfurl(a.id,i.ts)}d=!!(d||C);var te={msg:i,model_ob:a,member:b,actions:F,show_user:y,unprocessed:C,highlight:o,do_inline_imgs:Y,msg_dom_id:E,standalone:u,hide_actions:d,full_date:c,relative_ts:m,jump_link:f,show_resend_controls:i.ts in TS.model.display_unsent_msgs,starred_items_list:p,starred_items_actions:h,no_attachments:l,is_ephemeral:A,enable_slack_action_links:S,is_bot:O,bot_id:H,app_id:B,team_id:D,is_app_data_enabled:P,highlight_as_new:T,show_star:!p&&!A,has_rxns:J,for_mention_display:n.for_mention_display,for_mention_rxn_display:n.for_mention_rxn_display,for_search_display:n.for_search_display,for_top_results_search_display:n.for_top_results_search_display,ts_tip_delay_class:"ts_tip_delay_600",is_root_msg:n.is_root_msg,is_in_conversation:j,is_threads_view:R,file_title_only:"file_reaction"===i.subtype,is_slackbot_response:"slackbot_response"===i.subtype,show_channel_highlight:X,is_highlighted_unfurl:Z,show_briefing_feedback:n.briefing||o};if(F.add_rxn||F.add_file_rxn||F.add_file_comment_rxn)te.show_rxn_action=true;te.star_components=TS.templates.builders.buildStarComponents("message",i,a);var ne=true;if(u)ne=false;if(TS.utility.msgs.isFileMsg(i))ne=false;te.selectable=ne;if(j)te.msg_dom_id=TS.templates.makeMsgDomIdInConversation(i.ts);if(TS.utility.msgs.isMsgReply(i))te.show_reply_action=false;else{var re=true;te.show_reply_action=TS.replies.canReplyToMsg(a,i,re)&&!n.is_root_msg;if(!te.show_reply_action&&TS.utility.msgs.isFileMsg(i)&&i.file)te.show_comment_action=true}var ie=i.ts==i.thread_ts;if((ie||!i.thread_ts)&&j&&TS.client){te.format_for_thread_root=true;if(a.is_im||a.is_mpim)te.model_ob_name=TS.i18n.t("Direct message","messages")();else te.model_ob_name=TS.i18n.t("in {channel_display_name}","messages")({channel_display_name:TS.shared.getDisplayNameForModelOb(a)})}if(ie&&i.reply_count&&!j&&!u&&!n.for_search_display&&!n.for_top_results_search_display&&!n.is_threads_view)te.show_reply_bar=true;te.is_tombstone="tombstone"===i.subtype;te.is_new_reply=!!n.is_new_reply;if(TS.boot_data.feature_new_broadcast&&TS.utility.msgs.isMsgReply(i)&&"thread_broadcast"===i.subtype&&!j&&!u&&!n.is_threads_view){te.is_broadcast=true;te.show_reply_action=true}if(te.is_broadcast&&i.root){te.root_repliers_summary=new Handlebars.SafeString(TS.templates.builders.buildBroadcastRepliersSummaryHTML(i.root));if("tombstone"!==i.root.subtype){var ae=i.root.text;var se=_.first(i.root.attachments);if(_.get(se,"is_msg_unfurl")){var oe=se.from_url&&i.root.text==="<"+se.from_url+">";if(!ae||oe)ae=se.text}if(ae){var le=TS.format.formatBroadcastExcerpt(ae,i.root);if(le.length>150)le=TS.utility.truncateHTML(le,150);te.root_excerpt=new Handlebars.SafeString(le)}}}var ue;if("file_share"===i.subtype||"file_mention"===i.subtype)ue=i.file;else if("file_comment"===i.subtype)ue=i.comment;else ue=i;if(ue&&ue.pinned_to&&ue.pinned_to.length>0)te.is_pinned=_.some(ue.pinned_to,function(e){return e===a.id});else te.is_pinned=false;if(te.is_pinned)te.pin_html=TS.templates.builders.buildPinInfoHtml(i);else te.pin_html="";if(TS.client&&TS.client.highlights&&!u){te.is_recap=X;if(TS.client.highlights.shouldRenderHighlightsUI(a.id,i.ts))te.highlights_html=TS.templates.builders.buildHighlightsInfoHtml({recap:{data:TS.client.highlights.getHighlight(a.id,i.ts)}});te.show_recap_debug=TS.client.highlights.canShowRecapDebug(a.id,i.ts);te.highlight_is_leaving_feedback=TS.client.highlights.msgIsLeavingFeedback(a.id,i.ts)}if(TS.boot_data.feature_sli_briefing&&TS.highlights_briefing&&n.briefing)te.show_recap_debug="sli_debug_info"===TS.highlights_briefing.sli_recaps_debug_group;if(!i.subtype&&(n.for_search_display||n.for_top_results_search_display)&&i.file)if(i.comment)te.star_components=TS.templates.builders.buildStarComponents("file_comment",i.comment,i.file);else te.star_components=TS.templates.builders.buildStarComponents("file",i.file,null);if(!TS.utility.msgs.isTempMsg(i)&&!i.is_ephemeral){if(n.for_search_display&&TS.boot_data.page_needs_enterprise&&i.team&&TS.model.team_id!=i.team&&i.channel&&!i.channel.is_shared&&i.permalink)te.permalink=i.permalink;else te.permalink=TS.utility.msgs.constructMsgPermalink(a,i.ts,i.thread_ts);te.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(a,i.ts,i.thread_ts)}if(n.for_top_results_search_display&&TS.boot_data.page_needs_enterprise)if(i.team&&TS.model.team.id!=i.team&&!i.channel.is_shared){te.abs_permalink=i.permalink;te.archive_link=i.permalink;te.permalink=i.permalink}if("file_share"===i.subtype||"file_mention"===i.subtype||"file_reaction"===i.subtype){if(i.file){te.file=i.file;te.edit=TS.files.getFileActions(i.file).edit;te.download=!("snippet"===i.file.mode||"post"===i.file.mode||"space"===i.file.mode||i.file.is_external);te.new_window=!te.edit&&!te.download;te.abs_permalink=i.file.permalink;if(!p)te.star_components=TS.templates.builders.buildStarComponents("file",i.file,null);$.extend(te,TS.files.getFileTemplateArguments(i.file,360));te.is_message=true;te.lightbox=true;if("file_share"===i.subtype&&i.upload){if("email"===i.file.mode)te.is_added=true;te.icon_class=TS.utility.getImageIconClass(i.file,"thumb_80")}else if(i.file.user!=i.user)te.uploader=TS.utility.members.getEntityFromFile(i.file);if("file_share"===i.subtype&&i.upload&&i.file.initial_comment)te.show_initial_comment=true}var de=TS.templates.builders.msgs.buildFileShareMetaText(i);te.file_share_html=new Handlebars.SafeString(de)}else if("file_comment"===i.subtype){if(s&&!s.no_display&&s.file&&i.file&&i.file.id==s.file.id)if(!k)te.is_file_convo_continuation=true;te.show_comment_quote_icon=true;if(s&&!s.no_display&&s.file&&i.file&&i.file.id==s.file.id){if("file_share"===s.subtype&&s.upload&&s.file.initial_comment)if(!k)te.show_comment_quote_icon=false;if("file_comment"===s.subtype)if(!k)te.show_comment_quote_icon=false}te.file=i.file;te.icon_class=TS.utility.getImageIconClass(i.file,"thumb_40");te.comment=i.comment;te.member=TS.utility.members.getEntityFromMessage(i);if(i.file&&i.file.user!=i.comment.user)te.uploader=TS.utility.members.getEntityFromFile(i.file);if(!p)te.star_components=TS.templates.builders.buildStarComponents("file_comment",i.comment,i.file)}var ce=e(i,te);te.msg_classes=ce.join(" ");v+=TS.templates.message(te);v=TS.format.replaceHighlightMarkers(v);return v}catch(e){var _e="";if(i){_e="msg.ts:"+i.ts;delete n.model_ob;try{n.msg=_.cloneDeep(i);n.msg.text="REDACTED";_e+=" "+JSON.stringify(n,null,"  ")}catch(e){}}if(!e.message)e.message="";e.message+=" "+_e;TS.warn("Problem in TS.templates.builders.msgs.buildHTML with args: "+JSON.stringify(e.message));if(TS.boot_data.feature_tinyspeck)return TS.templates.message_failed({subtype:i&&i.subtype?i.subtype:"",msg_ts:i?i.ts:"",model_ob_id:a?a.id:""});return""}},buildFileShareMetaText:function e(r,i){if(!r||!r.file)return"";var a="file_share"===r.subtype&&r.upload;var s=r.file.user!=r.user&&!a;var o=!t(r);var l;if(s&&o)if("file_share"===r.subtype&&r.upload)if(r.file.initial_comment)if(n.test(r.file.mode))l=TS.i18n.t("added and commented on {uploader_name_possessive_html} {file_display_name}","message");else l=TS.i18n.t("uploaded and commented on {uploader_name_possessive_html} {file_display_name}","message");else if(n.test(r.file.mode))l=TS.i18n.t("added {uploader_name_possessive_html} {file_display_name}","message");else return TS.i18n.t("uploaded {uploader_name_possessive_html} {file_display_name}","message");else if("file_mention"===r.subtype)l=TS.i18n.t("mentioned {uploader_name_possessive_html} {file_display_name}","message");else l=TS.i18n.t("shared {uploader_name_possessive_html} {file_display_name}","message");else if("file_share"===r.subtype&&r.upload)if(r.file.initial_comment)if(n.test(r.file.mode))l=TS.i18n.t("added and commented on this {file_display_name}","message");else l=TS.i18n.t("uploaded and commented on this {file_display_name}","message");else if(n.test(r.file.mode))l=TS.i18n.t("added this {file_display_name}","message");else l=TS.i18n.t("uploaded this {file_display_name}","message");else if("file_mention"===r.subtype)l=TS.i18n.t("mentioned this {file_display_name}","message");else l=TS.i18n.t("shared this {file_display_name}","message");var u=TS.templates.builders.getFileDisplayName(r.file);var d=TS.utility.members.getEntityFromFile(r.file);var c;if(i){var _=TS.members.getPrefCompliantMemberName(d);c=TS.i18n.fullPossessiveString(_)}else{var m=TS.templates.builders.makeMemberPreviewLink(d,false);var f=TS.i18n.possessive(TS.members.getPrefCompliantMemberName(d));var p="client"===TS.boot_data.app?'target="'+r.file.permalink+'" ':"";var h='<a href="'+r.file.permalink+'" '+p+'data-file-id="'+r.file.id+'">';var g=TS.i18n.t("{uploader_name}{uploader_name_affix}","message")({uploader_name:m,uploader_name_affix:f});c="</a> "+g+h}return l({uploader_name_possessive_html:c,file_display_name:u})}});function e(e,t){var n=["message"];if(e.subtype)if("channel_join"===e.subtype||"group_join"===e.subtype)n.push("joined","automated");else if("channel_leave"===e.subtype||"group_leave"===e.subtype)n.push("left","automated");else if("channel_topic"===e.subtype||"group_topic"===e.subtype)n.push("topic","automated");else if("channel_name"===e.subtype||"group_name"===e.subtype)n.push("rename","automated");else if("channel_purpose"===e.subtype||"group_purpose"===e.subtype)n.push("purpose","automated");else if("channel_archive"===e.subtype||"group_archive"===e.subtype)n.push("archived","automated");else if("channel_unarchive"===e.subtype||"group_unarchive"===e.subtype)n.push("unarchived","automated");else if("bot_message"===e.subtype)n.push("bot_message");else if("sh_room_shared"===e.subtype)n.push("sh_shared","automated");else if("sh_room_created"===e.subtype)n.push("sh_created","automated");else if("bot_add"===e.subtype||"bot_remove"===e.subtype||"bot_enable"===e.subtype||"bot_disable"===e.subtype)n.push("bot_change","automated");else if("reminder_add"===e.subtype||"reminder_delete"===e.subtype)n.push("reminder_change","automated");if(e.alert_type)if("shared_channel_join"===e.alert_type)n.push("highlight_yellow_bg");if(TS.boot_data.feature_fix_files)n.push("feature_fix_files");if(e.no_display)n.push("hidden");if(t.for_search_display)n.push("for_search_display");if(t.for_top_results_search_display)n.push("for_top_results_search_display");if(t.starred_items_list)n.push("for_star_display");if(t.for_mention_display)n.push("for_mention_display");if(t.for_mention_rxn_display)n.push("for_mention_rxn_display");if(t.is_ephemeral)n.push("ephemeral");if(t.unprocessed)n.push("unprocessed");if(t.show_resend_controls)n.push("resend");if(t.highlight)n.push("highlight");if(t.highlight_as_new)n.push("new");if(t.app_id)n.push("is_app");if(t.is_pinned)n.push("is_pinned");if(t.show_channel_highlight&&TS.boot_data.feature_sli_recaps_interface)n.push("show_recap");if(t.is_highlighted_unfurl&&TS.boot_data.feature_sli_recaps_interface)n.push("is_recap_unfurl");if(t.highlight_feedback_options&&TS.boot_data.feature_sli_recaps_interface)n.push("has_feedback_options");if(t.highlight_is_leaving_feedback&&TS.boot_data.feature_sli_recaps_interface)n.push("is_leaving_feedback");if(t.highlight_has_left_feedback&&TS.boot_data.feature_sli_recaps_interface)n.push("has_left_feedback");if(t.standalone)n.push("standalone");else n.push("dirty_hover_container");if(t.show_user)n.push("first");else{if(t.file)n.push("first");if(t.is_in_conversation)n.push("first")}if(t.file){n.push("file_reference");if(t.is_mention)n.push("file_mention");else n.push("file_share")}if(t.comment)if(t.is_file_convo_continuation)n.push("comment_continuation");else n.push("first");if(t.is_root_msg)n.push("selected");if(t.is_new_reply)n.push("new_reply");if(t.is_tombstone)n.push("deleted");if(TS.boot_data.feature_sli_recaps){if(t.is_recap){n.push("is_recap");if(TS.boot_data.feature_sli_recaps_interface)n.push("show_recap_highlight")}if(t.show_recap_debug)n.push("show_recap_debug")}if(TS.boot_data.feature_new_broadcast)if(t.is_broadcast)n.push("thread_broadcast");if(_.get(t.member,"is_unknown"))n.push("member_is_unknown");return n}function t(e){return e.file.name===TS.utility.welcome_post.WELCOME_POST_NAME&&"USLACKBOT"===e.user&&e.file.user===TS.model.user.id}var n=/(snippet)/})()},4246:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("templates.helpers",{onStart:function e(){TS.templates.helpers.register()},register:function r(){Handlebars.registerHelper("debugger",function(){});Handlebars.registerHelper("i18n_ns",function(e){if(!_.isObject(this)){TS.warn('Cannot set i18n namespace "'+e+'". Chances are you’ve inadvertently changed the context in a Handlebars partial to something that’s not an object.');return}if(this._i18n_ns)if(this._i18n_ns_history)this._i18n_ns_history.push(this._i18n_ns);else this._i18n_ns_history=[this._i18n_ns];this._i18n_ns=e});Handlebars.registerHelper("_i18n_ns_end",function(){if(this._i18n_ns_history&&this._i18n_ns_history.length)this._i18n_ns=this._i18n_ns_history.pop()});Handlebars.registerHelper("i18n_img",function(e){var t=e.fn(this);var n=e&&e.hash&&e.hash.locales?e.hash.locales:null;if(n){n=n.replace(/\s/g,"");if(n.split(",").indexOf(TS.i18n.locale())>-1)t=t.replace(/(\..+$)/,"."+TS.i18n.locale()+"$1")}return t});Handlebars.registerHelper("t",function(e){var t;if("string"===typeof e){t=e;e=arguments[1]}else t=e.fn();var n;if(void 0!==e.hash.ns)n=e.hash.ns;else if(void 0!==this._i18n_ns)n=this._i18n_ns;else n=e.data.root&&e.data.root._i18n_ns?e.data.root._i18n_ns:"";var r=this;if(!_.isObject(r))r={this:r};var i={};var a;_.forOwn(e.hash,function(e,t){i[t]=r[t];r[t]=Handlebars.Utils.escapeExpression(e)});var s=t.match(/{[^\s}]+}/g);if(s&&s.length){var o=function e(t){var n=t.split(".");if(n.length>1){var i=0;var a=n.length;var s=r;for(i;i<a;i+=1){s=s[n[i]];if(void 0===s)return}return s}return r[t]};var l;var u=0;var d=s.length;for(u;u<d;u+=1){a=s[u].substr(1,s[u].length-2);if(void 0===e.hash[a]){l=o(a);if(void 0!==l){i[a]=r[a];r[a]=Handlebars.Utils.escapeExpression(l)}}}}if(e.hash.debug){TS.info("debug handlerbars t helper");TS.info(this)}t=TS.i18n.t(t,n)(r);_.forOwn(i,function(e,t){r[t]=e});return t});Handlebars.registerHelper("zdLocale",function(){return TS.i18n.zdLocale()});Handlebars.registerHelper("convertTimestampToMilliseconds",function(e){return 1e3*e});Handlebars.registerHelper("i18n_number",function(e){return TS.i18n.number(e)});Handlebars.registerHelper("listify",function(e,t){if(t.hash.map)e=_.map(e,t.hash.map);var n=_.get(t.hash,"conjunction");var r=_.get(t.hash,"strong");var i=_.get(t.hash,"no_escape");var a=_.get(t.hash,"item_prefix");var s=TS.i18n.listify(e,{conj:n,strong:r,no_escape:i,item_prefix:a});return new Handlebars.SafeString(s.join(""))});Handlebars.registerHelper("ifInArray",function(e,t,n){if(t.indexOf(e)>-1)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getDisplayNames",function(e){var t=e.map(function(e){var t=_.isString(e)?e:e.id;return TS.members.getPrefCompliantMemberNameById(t,true,false)});return t});Handlebars.registerHelper("isClient",function(e){if("client"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChrome",function(e){if(TS.model.is_chrome_desktop||TS.model.is_chrome_mobile)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isFF",function(e){if(TS.model.is_FF)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isSafariDesktop",function(e){if(TS.model.is_safari_desktop)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWeb",function(e){if("web"===TS.boot_data.app||"space"===TS.boot_data.app||"calls"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isMac",function(e){if(TS.model.is_mac)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWin",function(e){if(TS.model.is_win)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isLin",function(e){if(TS.model.is_lin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isOurApp",function(e){if(TS.model.is_our_app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("unlessOurApp",function(e){return Handlebars.helpers.isOurApp.call(this,{fn:e.inverse,inverse:e.fn,hash:e.hash})});Handlebars.registerHelper("isMacAppStorebuild",function(e){if(TSSSB.call("isAppStoreBuild")&&navigator.userAgent.match("MacAppStore"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("feature",function(e){var t=e.hash.flag;if(1==TS.qs_args[t]||1==TS.boot_data[t])return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("pageNeedsEnterprise",function(e){if(TS.boot_data.page_needs_enterprise)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("sharedChannelsEnabled",function(e){if(TS.boot_data.page_needs_enterprise||TS.boot_data.feature_shared_channels_client)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChannelRequired",function(e,t){return TS.channels.isChannelRequired(e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("experiment",function(e){var t=e.hash.name;var n=e.hash.group||"treatment";if(TS.experiment.getGroup(t)===n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("enterprisePOEmail",function(){if(TS.boot_data.page_needs_enterprise)return TS.model.enterprise.primary_owner.email;return""});Handlebars.registerHelper("versioned_x_icon",function(){return cdn_url+"/52b9/img/enterprise/icon_times_in_circle.svg"});Handlebars.registerHelper("comments",function(e){return new Handlebars.SafeString(TS.templates.builders.buildComments(e))});Handlebars.registerHelper("comment_standalone",TS.templates.builders.buildCommentStandalone);Handlebars.registerHelper("star",function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildStar(e,t,n))});Handlebars.registerHelper("starWithTip",function(e,t,n){return new Handlebars.SafeString(TS.templates.builders.buildStarWithTip(e,t,n))});Handlebars.registerHelper("inlineRoomPreviewToggler",TS.templates.builders.buildInlineRoomPreviewToggler);Handlebars.registerHelper("isInlineFilePreviewExpanded",function(e){var n=e.hash.container_id;var r=e.hash.file_id;var i=360;var a=false;var s=t(r,i);if(s)a=TS.inline_imgs.shouldExpand(n,TS.model.inline_imgs[s]);else a=TS.inline_file_previews.shouldExpand(n,r);if(a)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("shouldTruncateInlineFilePreview",function(e,t){if("string"===typeof e)e=TS.files.getFileById(e);if(e&&TS.inline_file_previews.shouldTruncate(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("shouldNotTruncateInlineFilePreview",function(e,t){return Handlebars.helpers.shouldTruncateInlineFilePreview.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("isInlineFilePreviewTruncated",function(e,t,n){if("string"===typeof t)t=TS.files.getFileById(t);if(t&&TS.inline_file_previews.isTruncated(e,t))return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("isInlineFilePreviewNotTruncated",function(e,t,n){return Handlebars.helpers.isInlineFilePreviewTruncated.call(this,e,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})});Handlebars.registerHelper("formatActionLink",function(e,t,n){if(!e)return"";var r="<"+e.url+"|"+e.title+">";var i=TS.format.formatWithOptions(r,t,{no_highlights:true,no_specials:true,enable_slack_action_links:true===n});return new Handlebars.SafeString(i)});Handlebars.registerHelper("ellipsize",function(e,t){TS.info("len"+t);return TS.utility.ellipsize(e,t)});Handlebars.registerHelper("stripWhitespace",function(e){return e.replace(/\s+/g,"")});Handlebars.registerHelper("cash",function(e){var t=e.hash.all_digits||false;var n=e.hash.currency_code||"USD";var r=parseInt(e.hash.value,10);var i=TS.utility.money.formatMoney(r,n,{all_digits:t});return i});Handlebars.registerHelper("possessive",function(e){return TS.i18n.possessive(e)});Handlebars.registerHelper("fullPossessiveString",function(e){return TS.i18n.fullPossessiveString(e)});Handlebars.registerHelper("possessiveForMemberById",function(e){var t=TS.members.getMemberById(e);if(!t)return"";return Handlebars.helpers.possessiveForMember(t)});Handlebars.registerHelper("possessiveForMember",function(e){var t=TS.members.getPrefCompliantMemberName(e);return TS.i18n.possessive(t)});Handlebars.registerHelper("concatStr",function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).join("")});Handlebars.registerHelper("initialsSafe",function(e){if("string"!==typeof e)return"";var t=e.split(" ").slice(0,2);var n="";for(var r=0;r<t.length;r+=1)n+=t[r][0];return new Handlebars.SafeString(n)});Handlebars.registerHelper("json",function(e){if("object"===("undefined"===typeof e?"undefined":n(e))&&null!==e&&"json"===e.name)return JSON.stringify(this);return JSON.stringify(e)});Handlebars.registerHelper("prettyJson",function(e){if("object"===("undefined"===typeof e?"undefined":n(e))&&null!==e&&"json"===e.name)return JSON.stringify(this,null,2);return JSON.stringify(e,null,2)});Handlebars.registerHelper("currentTeamName",function(){return TS.model.team.name||""});Handlebars.registerHelper("currentTeamHostSafe",function(){return new Handlebars.SafeString(window.location.hostname)});Handlebars.registerHelper("canUserCreateGroups",function(e){return TS.permissions.members.canCreateGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canCreateMpims",function(e){return TS.permissions.members.canCreateMpims()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromChannels",function(e){return TS.permissions.members.canKickFromChannels()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromGroups",function(e){return TS.permissions.members.canKickFromGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("shouldShowMemberEmail",function(e){return e.is_self||TS.model.team.prefs.display_email_addresses});Handlebars.registerHelper("teamUsesCustomizedCustomStatusPresets",function(e){return TS.model.team.prefs.uses_customized_custom_status_presets?e.fn(this):e.inverse(this)});Handlebars.registerHelper("numberWithMax",function(e,t){if(e>=t)return t-1+"+";return e});Handlebars.registerHelper("convertFilesize",function(e){return TS.utility.convertFilesize(e)});Handlebars.registerHelper("roundToThree",function(e){return TS.utility.roundToThree(e)});Handlebars.registerHelper("toDate",function(e){return TS.interop.datetime.toDate(e)});Handlebars.registerHelper("toCalendarDate",function(e){return TS.interop.datetime.toCalendarDate(e)});Handlebars.registerHelper("toCalendarDateShort",function(e){var t={shortenMonth:true};return TS.interop.datetime.toCalendarDate(e,t)});Handlebars.registerHelper("toCalendarDateOrNamedDay",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e)});Handlebars.registerHelper("toCalendarDateIfYesterdayOrToday",function(e){return TS.interop.datetime.toCalendarDateIfYesterdayOrToday(e)});Handlebars.registerHelper("toCalendarDateOrNamedDayShort",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e,{shortenMonth:true})});Handlebars.registerHelper("toTime",function(e,t,n){if(!e||_.isObject(e))e=window.moment().unix();return TS.interop.datetime.toTime(e,{do24hrTime:TS.utility.date.do24hrTime(),includeMeridiem:false!==t,includeSeconds:true===n})});Handlebars.registerHelper("toTimeShort",function(e){if(TS.utility.date.do24hrTime())return TS.interop.datetime.toTime(e,{timeFormat:"HH:mm"});return TS.interop.datetime.toTime(e,{timeFormat:"h:mm"})});Handlebars.registerHelper("toTimeAgo",function(e){return TS.interop.datetime.toTimeAgo(e,{alwaysAgo:true})});Handlebars.registerHelper("toTimeAgoShort",function(e,t){t=_.isBoolean(t)?t:false;var n=TS.interop.datetime.toTimeAgo(e,{compact:t,alwaysAgo:true});var r='<span class="relative_ts" data-ts="'+_.escape(e)+'" data-really-short="'+!!t+'">'+_.escape(n)+"</span>";return new Handlebars.SafeString(r)});Handlebars.registerHelper("toTimeDuration",function(e){return TS.interop.datetime.toTimeDuration(e)});Handlebars.registerHelper("msgTsTitle",function(e,t){var n;var r;var i=TS.model.unread_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInUnreadView(e.ts);var a=TS.model.threads_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInThreadsView(e.ts);var s=TS.client&&TS.ui.replies.activeConvoThreadTs()===e.thread_ts&&_.isString(t)&&TS.templates.makeMsgDomIdInConversation(e.ts)===t;if(i)r=TS.i18n.t("Jump to conversation","templates_helpers")();else if(a)if(e.ts===e.thread_ts)r=TS.i18n.t("Open in channel","templates_helpers")();else r=TS.i18n.t("Open in sidebar","templates_helpers")();else if(s)if(e.ts===e.thread_ts)r=TS.i18n.t("Open in channel","templates_helpers")();var o=TS.i18n.t("{date} at {time}","templates_helpers")({date:TS.interop.datetime.toCalendarDateOrNamedDay(e.ts,{shortenMonth:true}),time:TS.interop.datetime.toTime(e.ts,{do24hrTime:TS.utility.date.do24hrTime(),includeSeconds:true})}).replace(/\s/g,"&nbsp;");if(r)n=r+'<br><span class="subtle_silver no_wrap">'+o+"</span>";else n=o;return new Handlebars.SafeString(n)});Handlebars.registerHelper("toHour",function(e){return TS.interop.datetime.toHour(e)});Handlebars.registerHelper("memberLocalTime",function(e){var t=e&&e.tz?e.tz:"America/Los_Angeles";var n=TS&&TS.boot_data&&TS.boot_data.dst_offsets&&TS.boot_data.dst_offsets[e.tz]&&TS.boot_data.dst_offsets[e.tz].tz_offset?TS.boot_data.dst_offsets[e.tz].tz_offset:-25200;var r=TS.interop.datetime.memberLocalTime(Date.now(),{timeZone:t,timeZoneOffset:n,do24hrTime:TS.utility.date.do24hrTime()});var i=TS.i18n.t('<span class="timezone_value">{local_time}</span> local time',"date_utilities")({local_time:r});return new Handlebars.SafeString(i)});Handlebars.registerHelper("memberUTCOffset",function(e){return TS.utility.date.memberUTCOffset(e)});Handlebars.registerHelper("isInDifferentTimeZone",function(e,t){if(e.tz_offset!==TS.model.user.tz_offset)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isToday",function(e,t){if(TS.interop.datetime.isToday(TS.interop.datetime.toDateObject(e)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("toMonthYearFormat",function(e){return TS.interop.datetime.toCalendarDate(e,{excludeDay:true})});Handlebars.registerHelper("if_equal",function(t,n){n=e(n);if(t==n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("if_not_equal",function(t,n){n=e(n);if(t!=n.hash.compare)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("if_gt",function(e,t){if(e>t.hash.compare)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("if_lt",function(e,t){if(e<t.hash.compare)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("or",function(t,n,r){r=e(r);if(t||n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("and",function(t,n,r){r=e(r);if(t&&n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("foreach",function(e,t){if(t.inverse&&!e.length)return t.inverse(this);return e.map(function(n,r){var i={index:r,value:n,length:e.length};i.first=0===r;i.last=r===e.length-1;return t.fn(i)}).join("")});Handlebars.registerHelper("repeat",function(e,t){var n="";for(var r=0;r<e;r+=1)n+=t.fn(r);return n});Handlebars.registerHelper("makeDayDividerDomId",function(e){return TS.templates.makeDayDividerDomId(e)});Handlebars.registerHelper("formatFileTitle",function(e){if(!e||!e.title)return"";var t=e.title;t=_.unescape(t);t=_.escape(t);return new Handlebars.SafeString(TS.format.formatWithOptions(t,null,{no_specials:true}))});Handlebars.registerHelper("formatMessageByType",function(e,t,n,r,i){return new Handlebars.SafeString(TS.templates.builders.formatMessageByType(e,t,n,r,i))});Handlebars.registerHelper("formatAttachments",function(e,t,n,r){return new Handlebars.SafeString(TS.templates.builders.formatAttachments(e,t,n,r))});Handlebars.registerHelper("formatMessage",function(e,t){return new Handlebars.SafeString(TS.format.formatDefault(e,t))});Handlebars.registerHelper("formatNoHighlightsNoSpecials",function(e,t){return TS.format.formatNoHighlightsNoSpecials(e,t)});Handlebars.registerHelper("formatMessageAttachmentPartEscaped",TS.utility.attachments.formatMessageAttachmentPart);Handlebars.registerHelper("formatMessageAttachmentPart",function(e,t,n,r,i,a){return new Handlebars.SafeString(TS.utility.attachments.formatMessageAttachmentPart(e,t,n,r,i,a))});Handlebars.registerHelper("formatMessageAttachmentSlackFooter",function(e){var t=TS.format.formatJustText(TS.format.cleanMsg(e));return new Handlebars.SafeString(t)});Handlebars.registerHelper("formatTopicOrPurpose",function(e){return new Handlebars.SafeString(TS.utility.formatTopicOrPurpose(e))});Handlebars.registerHelper("unFormatMessage",function(e,t){return TS.format.unFormatMsg(e,t)});Handlebars.registerHelper("formatMessageResult",function(e){e=TS.format.formatJustText(e);e=TS.utility.msgs.handleSearchHighlights(e);return e});Handlebars.registerHelper("formatCurrentStatus",function(e){return new Handlebars.SafeString(TS.format.formatCurrentStatus(e))});Handlebars.registerHelper("formatCurrentStatusWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("rxnPanel",function(e){var t=TS.templates.builders.rxnPanel(e);if(!t)return"";return new Handlebars.SafeString(t)});Handlebars.registerHelper("makeRefererSafeLink",function(e){if("string"!==typeof e.hash.url)return"";return new Handlebars.SafeString(TS.utility.makeRefererSafeLink(e.hash.url))});Handlebars.registerHelper("makeSafeForDomId",TS.utility.makeSafeForDomId);Handlebars.registerHelper("makeMsgAttachmentTextExpanderDomId",TS.templates.makeMsgAttachmentTextExpanderDomId);Handlebars.registerHelper("makeMsgDomId",TS.templates.makeMsgDomId);Handlebars.registerHelper("makeMsgLabelDomId",TS.templates.makeMsgLabelDomId);Handlebars.registerHelper("makeMSRDomId",TS.templates.makeMSRDomId);Handlebars.registerHelper("makeMSRDomIdWithModule",TS.templates.makeMSRDomIdWithModule);Handlebars.registerHelper("makeSHRoomClass",TS.templates.makeSHRoomClass);Handlebars.registerHelper("makeMemberColorClass",function(){return TS.templates.builders.makeMemberColorClass.apply(this,arguments)});Handlebars.registerHelper("buildMsgHTMLForSearch",function(){var e=TS.templates.builders.buildMsgHTMLForSearch.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("buildMsgHTMLForSearchTopResults",function(){var e=TS.templates.builders.buildMsgHTMLForSearchTopResults.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("ifExtracts",function(e,t){if(e.previous||e.previous_2||e.next||e.next_2)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("willForceExtracts",function(e,t){if(!e.previous&&!e.next||TS.search.view.resultHasExtracts(e))return t.inverse(this);var n=TS.search.query;var r=n.split(" ");var i;var a;var s=false;for(i=0;i<r.length;i+=1){a=_.trim(r[i]);if(a.length>0&&!TS.search.keyword_modifier_pair_regex.test(a)){s=true;break}}if(!s)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("formatAttachmentExtracts",function(e,t){var n=e.color||"e3e4e6";return TS.templates.search_attachment_extracts({attachment:e,message:t,bg_color:n})});Handlebars.registerHelper("getAttachmentAuthorMemberId",function(e){var t=TS.utility.attachments.getDecoratedAttachment(e);if(!t)return"";return t._slack_author_id||""});Handlebars.registerHelper("concatMsgExtracts",function(e){if(!e.extracts||0===e.extracts.length)return"";var t=TS.templates.builders.search_ellipsis;var n=e.extracts.map(function(n){if(n.text)n.text=n.text.replace(/&&gt;t;>&gt;/g,"&gt;&gt;&gt;");var r=TS.format.replaceHighlightMarkers(n.text);if(TSF.jumbomoji_rx.match(r))return TS.format.formatDefault(r,e);var i=TS.format.formatWithOptions(n.text,e,{custom_linebreak:t});i=TS.utility.msgs.handleSearchHighlights(i);return i});var r=n.join(t);if(e.extracts[0].truncated_head)r=t+r;if(e.extracts[e.extracts.length-1].truncated_tail)r+=t;return r});Handlebars.registerHelper("concatAttachmentExtracts",function(e,t){var n=[];var r=e.extracts;var i;var a=TS.templates.builders.search_ellipsis;if(!r||0===r.length)return"";["title","text"].forEach(function(e){if(r[e])r[e].forEach(function(e){var r=TS.format.formatWithOptions(e.text,t,{custom_linebreak:a});r=TS.utility.msgs.handleSearchHighlights(r);if(0===n.length&&e.truncated_head)r=a+r;i=e;n.push(r)})});var s=n.join(a);if(s&&i&&i.truncated_tail)s+=a;if(!s&&r.fields&&!r.fallback)r.fields.forEach(function(e){var t=_.escape(e.value.text);t=TS.utility.msgs.handleSearchHighlights(t);if(e.value.truncated_head)t=a+t;if(e.value.truncated_tail)t+=a;s+="<strong>"+_.escape(e.title)+"</strong> &bull; "+t+"<br>"});if(!s&&e.fallback){var o=e.fallback;if(r.fallback&&r.fallback.length>0)o=r.fallback[0].text;var l=TS.format.formatWithOptions(o,t,{custom_linebreak:a});l=TS.utility.msgs.handleSearchHighlights(l);return l}return s});Handlebars.registerHelper("newWindowName",TS.templates.builders.newWindowName);Handlebars.registerHelper("nl2br",function(e){if(!e)return e;e=_.escape(e);return e.replace(/\n/g,"<br />").replace(/&amp;#95;/g,"_")});Handlebars.registerHelper("smartnl2br",function(e){if(!e)return e;e=_.escape(e);e=e.replace(/\n\r\n\r/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\r\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(e.replace(/&amp;#95;/g,"_"))});Handlebars.registerHelper("truncate",function(e,t){var n=truncate(e,t);return n.replace(/&#64;/g,"@")});Handlebars.registerHelper("truncateToNearestWordBoundary",TS.utility.truncateToNearestWordBoundary);Handlebars.registerHelper("proxyImgUrls",function(e){var t=$("<div>"+e+"</div>");t.find("img").each(function(){var e=$(this).attr("src");var t=$(this).attr("width");var n=$(this).attr("height");var r;if(t&&n)r=TS.utility.getImgProxyURL(e,t,n);else r=TS.utility.getImgProxyURL(e);$(this).attr("src",r)});return t.html()});Handlebars.registerHelper("stripImageTags",function(e){var t=$("<div>"+e+"</div>");var n=t.find("img").remove().end().html();return new Handlebars.SafeString(n)});Handlebars.registerHelper("generalName",function(){var e=TS.channels.getGeneralChannel();return e?e.name:""});Handlebars.registerHelper("makeChannelDomId",function(e){return TS.templates.makeChannelDomId(e)});Handlebars.registerHelper("makeLinksFromChannelOrGroupIds",function(e){return new Handlebars.SafeString(TS.templates.builders.makeLinksFromChannelOrGroupIds(e,{new_lines:true}))});Handlebars.registerHelper("makeChannelDragData",function(e){return TS.templates.makeChannelDragData(e)});Handlebars.registerHelper("makeFileDragData",function(e){return TS.templates.makeFileDragData(e)});Handlebars.registerHelper("firstListedChannel",function(){var e=TS.channels.getChannelsForUser()[0];if(e)return"#"+e.name});Handlebars.registerHelper("ChannelNameMaxLength",function(){return TS.model.channel_name_max_length});Handlebars.registerHelper("ChannelPurposeMaxLength",function(){return TS.model.channel_purpose_max_length});Handlebars.registerHelper("ChannelTopicMaxLength",function(){return TS.model.channel_topic_max_length});Handlebars.registerHelper("makeUnreadMsgsDomId",function(e){return TS.templates.makeUnreadMsgsDomId(e)});Handlebars.registerHelper("getCorGNameWithPrefixById",function(e,t){var n=TS.shared.getModelObById(e);if(!n){var r="getCorGNameWithPrefixById: Could not find model ob for ID "+e;TS.warn(r);if(t)return;return e}if(n.is_group)return TS.model.group_prefix+n.name;else if(n.is_channel)return TS.templates.builders.makeChannelPrefix(n)+n.name;if(t)return;return e});Handlebars.registerHelper("makeChannelPrefix",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(e))});Handlebars.registerHelper("makeChannelLink",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelLink(e))});Handlebars.registerHelper("makeChannelPath",TS.templates.builders.makeChannelPath);Handlebars.registerHelper("makeChannelLinkEnterpriseSearchResult",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelLinkEnterpriseSearchResult(e))});Handlebars.registerHelper("makeChannelLinkById",function(e){var t=TS.channels.getChannelById(e);if(t)return TS.templates.builders.makeChannelLink(t)});Handlebars.registerHelper("makeChannelLinkAriaLabelSafe",TS.templates.builders.makeChannelLinkAriaLabelSafe);Handlebars.registerHelper("makeUnreadHighlightDomId",function(e){return TS.templates.makeUnreadHighlightDomId(e)});Handlebars.registerHelper("makeChannelDomClass",function(e){var t="";if(TS.model.active_channel_id==e.id&&!TS.client.activeChannelIsHidden())t+="active ";if(e.unread_cnt>0)t+="unread ";if(e.unread_highlight_cnt>0)t+="mention ";if(e.is_starred)t+="is_starred ";if(TS.notifs.isCorGMuted(e.id))t+="muted_channel ";if(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))t+="show_in_list_even_though_no_unreads ";return t});Handlebars.registerHelper("makeChannelOrGroupLinkById",function(e,t){var n=TS.shared.getModelObById(e);var r="";if(n.is_mpim)r=TS.templates.builders.makeMpimLink(n,false);else if(n.is_group)r=TS.templates.builders.makeGroupLink(n,t);else if(n.is_channel)r=TS.templates.builders.makeChannelLink(n,t);return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeChannelOrGroupSSBLinkById",function(e){var t=TS.shared.getModelObById(e);if(!t)return;var n;var r="slack://channel?team="+TS.model.team.id+"&id="+e;if(t.is_group||t.is_private){n=TS.model.group_prefix+t.name;return"<a href="+r+">"+n+"</a>"}else if(t.is_channel){var i=TS.channels.getChannelById(e);n="#"+i.name;return"<a href="+r+">"+n+"</a>"}});Handlebars.registerHelper("isThereComplianceExportsTeam",function(e,t){if(!TS.boot_data.page_needs_enterprise)return t.inverse(this);var n=false;if(e.is_shared){var r;if(e.is_global_shared)r=TS.model.enterprise_teams;else r=_.map(e.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)});n=r.some(function(e){return e.has_compliance_export})}return n?t.fn(this):t.inverse(this)});Handlebars.registerHelper("makeTeamsThatHaveComplianceExportsBlurb",TS.templates.builders.makeTeamsThatHaveComplianceExportsBlurb);Handlebars.registerHelper("isEnterpriseTeam",function(e){return TS.boot_data.page_needs_enterprise?e.fn(this):e.inverse(this)});Handlebars.registerHelper("isLocalTeam",function(t,n){n=e(n);if(!TS.boot_data.page_needs_enterprise)return n.inverse(this);if(t==TS.model.team.id)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("currentEnterpriseName",function(){if(!TS.boot_data.page_needs_enterprise)return"";return TS.model.enterprise.name||""});Handlebars.registerHelper("isOnEnterpriseTeam",function(e){if(!TS.boot_data.page_needs_enterprise)return e.inverse(this);return TS.model.user.enterprise_user.teams.indexOf(e.hash.team_id)>-1?e.fn(this):e.inverse(this)});Handlebars.registerHelper("makeTeamlabel",function(e,t){var n=TS.templates.builders.makeTeamlabel(e,t);return new Handlebars.SafeString(n)});Handlebars.registerHelper("makeExternalTeamNameList",function(e){if(!e)return"";var t=TS.i18n.listify(_.map(e,TS.teams.getTeamNameById)).join("");if(t)return new Handlebars.SafeString(t)});Handlebars.registerHelper("makeGroupDomId",function(e){return TS.templates.makeGroupDomId(e)});Handlebars.registerHelper("groupPrefix",function(){return new Handlebars.SafeString(TS.model.group_prefix)});Handlebars.registerHelper("makeGroupLink",function(){var e=TS.templates.builders.makeGroupLink.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeGroupLinkById",function(e){var t=TS.groups.getGroupById(e);if(t)return TS.templates.builders.makeGroupLink(t)});Handlebars.registerHelper("makeGroupLinkAriaLabelSafe",TS.templates.builders.makeGroupLinkAriaLabelSafe);Handlebars.registerHelper("makeGroupDomClass",function(e){var t="";if(TS.model.active_group_id==e.id&&!TS.client.activeChannelIsHidden())t+="active ";if(e.unread_cnt>0)t+="unread ";if(e.unread_highlight_cnt>0)t+="mention ";if(e.is_starred)t+="is_starred ";if(TS.notifs.isCorGMuted(e.id))t+="muted_channel ";if(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))t+="show_in_list_even_though_no_unreads ";return t});Handlebars.registerHelper("mpimMemberCount",function(e){return TS.mpims.getMemberCount(e)});Handlebars.registerHelper("mpimDisplayName",function(e,t,n,r,i){t=true===t;i=true===i;var a=TS.mpims.getDisplayName(e,t,true===n,r,i);if(t||i)return new Handlebars.SafeString(a);return a});Handlebars.registerHelper("makeMpimDomClass",function(e){var t="";if(!e)return t;if(e.id===TS.model.active_mpim_id&&!TS.client.activeChannelIsHidden())t+="active ";if(e.unread_cnt>0||e.unread_highlight_cnt>0)t+="unread mention ";if(TS.notifs.isCorGMuted(e.id))t+="muted_channel ";if(e.is_starred)t+="is_starred ";if(_.trim(e.last_msg_input))t+="show_in_list_even_though_no_unreads ";return t});Handlebars.registerHelper("makeMpimDomId",function(e){return TS.templates.makeMpimDomId(e)});Handlebars.registerHelper("makeMpimLink",function(e,t){var n=TS.templates.builders.makeMpimLink(e,t);return new Handlebars.SafeString(n)});Handlebars.registerHelper("mpimArchivesPath",function(e){return TS.mpims.getMpimArchivesPath(e)});Handlebars.registerHelper("isCorGMuted",function(e,t){if(TS.notifs.isCorGMuted(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("currentUserId",function(){return TS.model.user.id});Handlebars.registerHelper("makeMemberDomId",function(e){return TS.templates.makeMemberDomId(e)});Handlebars.registerHelper("makeChannelListDomId",function(e){return TS.templates.makeChannelListDomId(e)});Handlebars.registerHelper("makeMemberPresenceDomClass",function(e){return TS.templates.makeMemberPresenceDomClass(e.id)});Handlebars.registerHelper("makeMemberPresenceIcon",function(e){if(!TS.client)TS.warn("Presence icons should not be used outside of the client application, because they rely on a WS connection to keep presence up to date. Rendering anyway, but be careful out there!");return new Handlebars.SafeString(TS.templates.makeMemberPresenceIcon(e))});Handlebars.registerHelper("makeMemberTypeBadge",function(){var e=TS.templates.builders.makeMemberTypeBadge.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberTypeBadgeCompact",function(){var e=TS.templates.builders.makeMemberTypeBadgeCompact.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberStatusDomClass",function(e){return TS.templates.makeMemberStatusDomClass(e.id)});Handlebars.registerHelper("makeMemberDomClass",function(e){var t="";if(!e)return t;if(!e.is_self&&"away"===e.presence)t+="away ";if(TS.model.active_im_id){var n=TS.ims.getImById(TS.model.active_im_id);if(n.user==e.id&&!TS.client.activeChannelIsHidden())t+="active "}var r=TS.ims.getImByMemberId(e.id);if(r){if(r.unread_cnt>0||r.unread_highlight_cnt>0)t+="unread mention ";if(r.is_starred)t+="is_starred ";if(_.trim(r.last_msg_input))t+="show_in_list_even_though_no_unreads "}return t});Handlebars.registerHelper("showDraftIcon",function(e,t){if(TS.templates.builders.showDraftIcon(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeMemberListDomClass",function(e){var t="member ";if("away"===e.presence)t+="away ";return t});Handlebars.registerHelper("makeMemberPreviewLink",function(){var e=TS.templates.builders.makeMemberPreviewLink.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberPreviewLinkById",function(e,t){if(true!==t)t=false;var n=TS.members.getPotentiallyUnknownMemberById(e)||TS.bots.getBotById(e);if(!n)return new Handlebars.SafeString(_.escape(e));return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(n,t))});Handlebars.registerHelper("makeMemberPreviewLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeMemberPreviewCardLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewCardLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeProfileImage",TS.templates.builders.makeProfileImage);Handlebars.registerHelper("makePendingUserImage",function(){return new Handlebars.SafeString(TS.templates.builders.makePendingUserImage.apply(this,arguments))});Handlebars.registerHelper("emojiGraphicReplace",function(e,t){var n={};if(t&&"string"===typeof t)n.force_style=t;else n.obey_emoji_mode_pref=true;return new Handlebars.SafeString(TS.emoji.graphicReplace(e,n))});Handlebars.registerHelper("emojiGraphicReplaceByName",function(e){return TS.emoji.graphicReplace(":"+e+":")});Handlebars.registerHelper("emojiModePref",function(){return TS.model.prefs.emoji_mode});Handlebars.registerHelper("makeUsernameImage",function(e,t){var n;var r;var i;var a;var s;var o=TS.bots.getBotByMsg(e);if(e.icons)s=e.icons;else if(o&&o.icons)s=o.icons;if(s)if(s.image_36&&!TS.environment.is_retina)n=s.image_36;else if(s.image_72&&TS.environment.is_retina)n=s.image_72;else if(s.image_48)n=s.image_48;else if(s.emoji&&":"===s.emoji.substr(0,1)&&":"===s.emoji.substr(s.emoji.length-1,1))i=s.emoji;var l=TS.templates.builders.makeBotLink(o,e.username);var u=e&&e.is_ephemeral&&"slackbot"===e.username?TS.members.getMemberById("USLACKBOT"):null;switch(t){case 24:r="thumb_24";a=cdn_url+"/66f9/img/avatars/ava_0002-24.png";if(u)a=u.profile.image_24;break;case 32:r="thumb_32";a=cdn_url+"/0180/img/avatars/ava_0002-32.png";if(u)a=u.profile.image_32;break;case 36:r="thumb_36";a=cdn_url+"/66f9/img/avatars/ava_0002-48.png";if(u)a=u.profile.image_48;break;case 72:r="thumb_72";a=cdn_url+"/66f9/img/avatars/ava_0002-72.png";if(u)a=u.profile.image_72;break;case 192:r="thumb_192";a=cdn_url+"/7fa9/img/avatars/ava_0002-192.png";if(u)a=u.profile.image_192;break;default:r="thumb_48";a=cdn_url+"/7fa9/img/avatars/ava_0002-192.png";if(u)a=u.profile.image_48}var d;if(n)d=l.start_a+'<img style="border: 0" src="'+n+'" class="member_image '+r+'" />'+l.end_a;else if(i)d=l.start_a+'<div style="border: 0" class="member_image '+r+'">'+TS.emoji.graphicReplace(_.escape(i))+"</div>"+l.end_a;else if(u)d=l.start_a+'<img src="'+a+'" class="member_image '+r+'" />'+l.end_a;else d=l.start_a+'<img src="'+a+'" class="member_image bot_icon_default '+r+'" />'+l.end_a;return new Handlebars.SafeString(d)});Handlebars.registerHelper("getMemberPreviewLinkImageArgs",function(e,t,r,i,a,s,o){var l;if("object"===("undefined"===typeof e?"undefined":n(e)))l=e;else l=TS.members.getMemberById(e);if(!l||!l.profile)return"";r=true===r;i=true===i;a=true===a;s=true===s;o="string"===typeof o?o:false;if("USLACKBOT"===e&&o)l=TS.utility.slackbot.getWithFeels(o);var u;var d;var c;d="background-image: ";c=[];switch(t){case 20:case 24:if(TS.environment.is_retina)u=l.profile.image_48;else u=l.profile.image_24;break;case 32:if(TS.environment.is_retina)u=l.profile.image_72;else u=l.profile.image_32;break;case 36:case 48:if(TS.environment.is_retina)u=l.profile.image_72;else u=l.profile.image_48;break;case 56:case 72:if(TS.environment.is_retina)u=l.profile.image_192;else u=l.profile.image_72;break;case 192:if(TS.environment.is_retina)u=l.profile.image_512||l.profile.image_192;else u=l.profile.image_192;break;case 512:if(TS.environment.is_retina)u=l.profile.image_1024||l.profile.image_512||l.profile.image_192;else u=l.profile.image_512||l.profile.image_192;break;default:if(TS.environment.is_retina)u=l.profile.image_72;else u=l.profile.image_48}c.push("url('"+u+"')");if(512===t){var _=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;c.push("url('"+_+"')")}if(r)d=c.length?c.join(", "):"";else d=c.length?d+c.join(", "):"";var m={omit_link:i,omit_badge:a,lazy:r,member:l,size:t,include_restricted_overlay:!s||true,bg_img_style:d};return m});Handlebars.registerHelper("getGuestBadgeSize",function(e){var t;switch(e){case 24:t=10;break;case 32:case 36:case 48:t=16;break;case 72:t=24;break;case 192:t=48;break;case 512:t=96;break;default:t=16}return t});Handlebars.registerHelper("getTeamBadgeSize",function(e){var t;switch(e){case 32:case 36:case 48:t=16;break;case 72:t=22;break;case 192:case 512:break;default:t=16}return t});Handlebars.registerHelper("getMemberNameById",function(e){var t=TS.members.getMemberById(e);return t?t.name:e});Handlebars.registerHelper("getPrefCompliantMemberNameById",function(e){return TS.members.getPrefCompliantMemberNameById(e)});Handlebars.registerHelper("getMemberNameNoModel",function(e,t){if(TS.boot_data.name_tagging_client)return e.display_name||e.real_name||t;return e.real_name||t});Handlebars.registerHelper("getPrefCompliantMemberName",function(e,t,n){return TS.members.getPrefCompliantMemberName(e,true===t,true===n)});Handlebars.registerHelper("getMemberAsContentsString",function(e){return TS.format.texty.getMemberAsContentsString(e)});Handlebars.registerHelper("shouldShowMemberRestrictionBanner",function(t,n){n=e(n);if(_.isString(t))t=TS.members.getMemberById(t);if(!t)return n.inverse(this);var r=t.is_restricted||t.is_external&&TS.boot_data.feature_shared_channels_client;if(r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("shouldUseUnifiedMemberDisplay",function(t){t=e(t);if(TS.boot_data.feature_shared_channels_client||TS.boot_data.feature_name_tagging_client)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessUseUnifiedMemberDisplay",function(e){return Handlebars.helpers.shouldUseUnifiedMemberDisplay.call(this,{fn:e.inverse,inverse:e.fn,hash:e.hash})});Handlebars.registerHelper("getTeamNameByMember",function(e){return TS.teams.getTeamNameByMember(e)});Handlebars.registerHelper("getTeamById",function(e){return TS.teams.getTeamById(e)});Handlebars.registerHelper("getTeamNameById",function(e){return TS.teams.getTeamNameById(e)});Handlebars.registerHelper("getMemberPreviewLinkTarget",function(e){var t=TS.boot_data.feature_name_tagging_client||TS.boot_data.feature_shared_channels_client?e.id:e.name;if(TS.utility.shouldLinksHaveTargets())return new Handlebars.SafeString('target="/team/'+t+'"');return""});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("getMemberSecondaryName",function(e){return TS.members.getMemberSecondaryName(e)});Handlebars.registerHelper("memberHasSecondaryName",function(e,t){var n=false;if(e)n=!!TS.members.getMemberSecondaryName(e);if(n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasSecondaryName",function(e,t){return Handlebars.helpers.memberHasSecondaryName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("memberHasProfileFieldDisplayName",function(e,t){var n=false;if(e)n=!!TS.members.getMemberProfileFieldDisplayName(e);if(n)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasProfileFieldDisplayName",function(e,t){return Handlebars.helpers.memberHasProfileFieldDisplayName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("getMemberRealName",function(e){return TS.members.getMemberRealName(e)});Handlebars.registerHelper("getMemberUsernameAndRealNameInCorrectOrder",function(e){var t=["member_username","member_real_name"];var n=TS.members.getMemberUsernameAndRealNameInCorrectOrder(e);if(!n.is_username_first)t.reverse();var r=n.names_in_order.map(function(e,n){var r=_.get(t,n,"");return'<span class="'+r+'">'+_.escape(e)+"</span>"}).join("");return new Handlebars.SafeString(r)});Handlebars.registerHelper("getMemberProfileFieldDisplayNameandRealNameInCorrectOrder",function(e){var t=_.escape(TS.members.getPrefCompliantMemberName(e));var n;if(e.is_self)n=TS.i18n.t("(you)","templates_helpers")();else n=_.escape(TS.members.getMemberSecondaryName(e));var r='<span class="member_real_name">'+t+"</span>";var i='<span class="member_preferred_name">'+n+"</span>";return new Handlebars.SafeString(r+i)});Handlebars.registerHelper("getMemberCurrentStatusEmoji",function(e,t){t=t||{};t=t.hash||t;return Handlebars.helpers.formatCurrentStatusWithoutAnimations(TS.members.getMemberCurrentStatus(e).emoji,_.assign({transform_missing_emoji:true,show_icon_for_emoji_in_as_text_mode:true},t))});Handlebars.registerHelper("getMemberCurrentStatusText",function(e){return Handlebars.helpers.formatCurrentStatusWithoutAnimations(TS.members.getMemberCurrentStatus(e).text,{prevent_copy_paste:false})});Handlebars.registerHelper("getMemberCurrentStatusForDisplay",function(e){return new Handlebars.SafeString(TS.members.getMemberCurrentStatusForDisplay(e))});Handlebars.registerHelper("getMemberCurrentStatusForDisplayWithoutAnimations",function(e){return new Handlebars.SafeString(TS.members.getMemberCurrentStatusForDisplay(e,{stop_animations:true}))});Handlebars.registerHelper("seesCurrentStatusInProfileView",function(t,n){n=e(n);if(t.profile.status_text||t.profile.status_emoji||"client"===TS.boot_data.app&&t.is_self)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("getTeamCustomStatusPresets",function(){return TS.team.getTeamCustomStatusPresets()});Handlebars.registerHelper("getDisplayNameOfUserForIm",function(e){if(!e)return"MISSING_IM";return TS.ims.getDisplayNameOfUserForIm(e)});Handlebars.registerHelper("getIMIdByMemberId",function(e){var t=TS.ims.getImByMemberId(e);return t?t.id:""});Handlebars.registerHelper("memberHasIm",function(e){var t=e.hash.member;var n=false;if(t)if(TS.ims.getImByMemberId(t.id))n=true;if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberHasImUnreadCount",function(e){var t=e.hash.member;var n=false;if(t){var r=TS.ims.getImByMemberId(t.id);if(r&&r.unread_cnt)n=true}if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("getUnreadCountForIMByMemberId",function(e){var t=TS.ims.getImByMemberId(e);if(t)return t.unread_cnt;return""});Handlebars.registerHelper("makeMemberLinksWithDisplayNames",function(e){if(!e)return"";return e.split(/\s*,\s*/).map(function(e){return TS.templates.builders.makeMemberPreviewLink(TS.members.getMemberById(e))}).join(", ")});function i(e){var t=TS.members.getMemberById(e.user);var n={im_exists:!TS.ims.isImWithDeletedMember(e),im_member_id:t.id,im_name:TS.ims.getDisplayNameOfUserForIm(e),im_id:e.id,member_color:"color_"+(t?t.id+" color_"+t.color:"unknown")};if(TS.utility.shouldLinksHaveTargets()){var r="/messages/@"+t.id;if(TS.boot_data.feature_name_tagging_client)r="/messages/"+e.id;if(TS.ims.isImWithDeletedMember(e))r=TS.templates.builders.newWindowName();n.target=r}return TS.templates.search_im_link(n)}Handlebars.registerHelper("makeIMLink",function(e){return new Handlebars.SafeString(i(e))});Handlebars.registerHelper("makeIMLinkById",function(e){var t=TS.ims.getImById(e);if(t)return new Handlebars.SafeString(i(t))});function a(e){var t=_.escape(e.username);var n;var r=TS.bots.getBotByMsg(e);if(e.icons)n=e.icons;else if(r&&r.icons)n=r.icons;if(!t&&r&&r.name)t=_.escape(r.name);var i=TS.templates.builders.makeBotLink(r,e.username);if(!n)return i.start_a+t+i.end_a;var a;if(n.emoji&&":"===n.emoji.substr(0,1)&&":"===n.emoji.substr(n.emoji.length-1,1))a=i.start_a+TS.emoji.graphicReplace(_.escape(n.emoji))+i.end_a+" "+i.start_a+t+i.end_a;else if(n.image_36&&!TS.environment.is_retina)a=i.start_a+'<img src="'+n.image_36+'" class="inline_bot_icon">'+i.end_a+" "+i.start_a+t+i.end_a;else if(n.image_72&&TS.environment.is_retina)a=i.start_a+'<img src="'+n.image_72+'" class="inline_bot_icon">'+i.end_a+" "+i.start_a+t+i.end_a;else if(n.image_48)a=i.start_a+'<img src="'+n.image_48+'" class="inline_bot_icon">'+i.end_a+" "+i.start_a+t+i.end_a;else a=i.start_a+t+i.end_a;return a}Handlebars.registerHelper("getBotNameAndIcon",a);Handlebars.registerHelper("getBotName",TS.templates.builders.getBotName);Handlebars.registerHelper("getBotNameWithLink",TS.templates.builders.getBotNameWithLink);function s(e){if(!e)return"color_unknown";return"color_bot_"+TS.utility.makeSafeForDomClass(e)}Handlebars.registerHelper("getBotColorClassByUserName",s);function o(e){var t=TS.members.getMemberById(e);if(!t)return"color_unknown";return"color_"+t.id+" color_"+t.color}Handlebars.registerHelper("getMemberColorClassById",o);Handlebars.registerHelper("getMemberColorClassByImId",function(e){var t=TS.ims.getImById(e);if(!t)return"color_unknown";return o(t.user)});Handlebars.registerHelper("makeMemberLinkAriaLabelSafe",TS.templates.builders.makeMemberLinkAriaLabelSafe);Handlebars.registerHelper("msgIsFromSelf",function(e){var t=e.hash.msg;var n=t.user;if(!n&&"file_comment"===t.subtype&&t.comment)n=t.comment.user;var r=TS.members.getMemberById(n);if(!r)return e.inverse(this);if(r.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsSelf",function(e){var t=TS.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsAdmin",function(e){var t=TS.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsAdmin",function(e){if(TS.model.user.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsOwner",function(e){if(TS.model.user.is_owner)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsRA",function(e){if(TS.model.user.is_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsURA",function(e){if(TS.model.user.is_ultra_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("tinyspeck",function(e){if(TS.boot_data.feature_tinyspeck)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("makeUnshareLinkById",function(e){var t=TS.files.getFileById(TS.web.file.file_id);var n=TS.shared.getModelObById(e);if(n)return TS.templates.builders.makeUnshareLink(n,t)});Handlebars.registerHelper("makeUnshareLink",function(e){var t=TS.files.getFileById(TS.web.file.file_id);return TS.templates.builders.makeUnshareLink(e,t)});Handlebars.registerHelper("makeFileDomId",function(e){return TS.templates.makeFileDomId(e)});Handlebars.registerHelper("makeFileCommentsDomId",function(e){return TS.templates.makeFileCommentsDomId(e)});Handlebars.registerHelper("makeFileContentsDomId",function(e){return TS.templates.makeFileContentsDomId(e)});Handlebars.registerHelper("makeFileCommentHelpHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileCommentHelpHTML(e))});Handlebars.registerHelper("makeFileHeader",function(e,t){var n=TS.files.getFileActions(e);n.file=e;n.is_post="space"===e.mode||"post"===e.mode;n.download="hosted"===e.mode;n.member=t;return TS.templates.file_header(n)});Handlebars.registerHelper("makeFilePreviewHeader",function(e,t,n){var r=TS.files.getFileActions(e);r.file=e;r.member=t;r.download="hosted"===e.mode;r.edit_link="post"===e.mode?e.edit_link:e.permalink;r.is_post="space"===e.mode||"post"===e.mode;r.is_snippet="snippet"===e.mode;r.preview=true;if(TS.boot_data.feature_file_threads&&n)r.model_ob=n;return new Handlebars.SafeString(TS.templates.file_header(r))});Handlebars.registerHelper("makeFileSize",function(e){return TS.utility.convertFilesize(e.size)+" "+e.pretty_type});Handlebars.registerHelper("formatSpaceHtml",function(e){function t(e){if(e.childNodes)for(var n=0;n<e.childNodes.length;n+=1)t(e.childNodes[n]);if(e.nodeType==Node.TEXT_NODE){var r=_.escape(e.textContent);var i=TS.emoji.graphicReplace(TS.emoji.replaceEmoticons(r),{include_title:true,include_text:false});if(i!==r){var a=$("<span>").html(i)[0];[].slice.apply(a.childNodes).forEach(function(t){e.parentNode.insertBefore(t,e)});e.parentNode.removeChild(e)}}}var n=$("<div>").html(e);t(n[0]);if(TS.utility&&TS.utility.attachments)TS.utility.attachments.unfurlPlaceholders(n);return new Handlebars.SafeString(n.html())});Handlebars.registerHelper("fileIsImage",function(e){var t=TS.files.getFileById(e.hash.id);if(!t)return e.inverse(this);if(t.mimetype&&0===t.mimetype.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("mimeTypeIsImage",function(e){if(e.hash.type&&0===e.hash.type.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("fileDefaultIsNewWindow",function(t){t=e(t);var n=TS.files.getFileById(t.hash.id);if(!n)return t.inverse(this);var r=n.mimetype&&0===n.mimetype.indexOf("image/")&&-1===n.mimetype.indexOf("svg");var i="pdf"===n.filetype;if(r||i)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("fileIconTypeDownload",function(){var t=Array.prototype.slice.call(arguments);var n=e(t.pop());var r=t[0];if("string"===typeof r)r=TS.files.getFileById(r);if(!r)return n.inverse(this);var i="external"===r.mode;var a=r.mimetype&&0===r.mimetype.indexOf("image/")&&-1===r.mimetype.indexOf("svg");var s="pdf"===r.filetype;if(i||a||s)return n.inverse(this);return n.fn(this)});Handlebars.registerHelper("nonImageCanUseFSFV",function(e,t){if(!e)return t.inverse(this);if(TS.model.pdf_viewer_enabled&&"hosted"===e.mode&&TS.files.fileIsPDF(e)&&e.size<=5e7)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeFilePrivacyLabel",function(e){var t="";if(e.is_public)t=TS.i18n.t("Shared","templates_helpers")();else if(e.groups.length>0||e.ims.length>0)t=TS.i18n.t("Private","templates_helpers")();else t=TS.i18n.t("Draft","templates_helpers")();return t});Handlebars.registerHelper("makeExternalFiletypeHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeExternalFiletypeHTML(e))});Handlebars.registerHelper("makeFileShareLabel",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileShareLabel(e))});Handlebars.registerHelper("makeFileGroupChannelList",function(e){return TS.templates.builders.makeFileGroupChannelList(e)});Handlebars.registerHelper("nl2brAndHighlightSearchMatches",function(e){if(!e)return;e=_.escape(e);e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("maybeGetIconForTeamProfileField",function(e){var t=["slack","apple","android","twitter","github","google","windows","youtube","skype","facebook","asana","linkedin","tumblr","instagram","soundcloud","flickr","pinterest","tripit","hangouts","viber","line"];e=e.toLowerCase();if(t.indexOf(e)>-1)return'<i class="ts_icon ts_icon_'+e+'"></i>'});Handlebars.registerHelper("getVisibleTeamProfileFieldsForMember",function(e,t){var n=TS.team.getVisibleTeamProfileFieldsForMember(e);return new Handlebars.SafeString(TS.templates.team_profile_fields({fields:n,lazy_load_profile_fields:t&&t.hash.lazy_load_profile_fields}))});Handlebars.registerHelper("isSkypeTeamProfileField",function(e,t){if("text"===e.type&&"skype"===e.label.toLocaleLowerCase())return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getSafeSkypeURLComponent",function(e){var t=e.match(/^[a-zA-Z][a-zA-Z0-9.,\-_@]{5,31}/);return t?t[0]:""});Handlebars.registerHelper("highlightSearchMatches",function(e){if(!e)return;e=_.escape(e);return TS.utility.msgs.handleSearchHighlights(e)});Handlebars.registerHelper("highlightSearchMatchesInSpacesHtml",function(e){if(!e)return;var t=Handlebars.helpers.formatSpaceHtml(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(t))});Handlebars.registerHelper("highlightSearchMatchesInFileTitle",function(e){if(!e)return;e=_.unescape(e);e=_.escape(e);e=TS.emoji.graphicReplace(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("searchFilter",function(){if(!TS.search.filter)return;return TS.search.filter});Handlebars.registerHelper("searchSort",function(){if(!TS.search.sort)return;return TS.search.sort});Handlebars.registerHelper("makeUnreadMessagesDomId",function(e){return TS.templates.makeUnreadMessagesDomId(e)});Handlebars.registerHelper("makeUnreadGroupMessagesDomId",function(e){return TS.templates.makeUnreadGroupMessagesDomId(e)});Handlebars.registerHelper("makeUnreadDmsDomId",function(e){return TS.templates.makeUnreadDmsDomId(e)});Handlebars.registerHelper("makeSentMessagesDomId",function(e){return TS.templates.makeSentMessagesDomId(e)});Handlebars.registerHelper("makeSentGroupMessagesDomId",function(e){return TS.templates.makeSentGroupMessagesDomId(e)});Handlebars.registerHelper("makeSentDmsDomId",function(e){return TS.templates.makeSentDmsDomId(e)});Handlebars.registerHelper("makeIssueListDomId",function(e){return TS.templates.makeIssueListDomId(e)});Handlebars.registerHelper("math",function(e,t,n){if(arguments.length<4){n=t;t="+"}e=parseFloat(e);n=parseFloat(n);return{"+":e+n,"-":e-n,"*":e*n,"/":e/n,"%":e%n}[t]});Handlebars.registerHelper("loadingHTML",function(){return new Handlebars.SafeString(TS.templates.builders.loadingHTML())});Handlebars.registerHelper("versioned_loading_animation",function(){return cdn_url+"/9c217/img/loading.gif"});Handlebars.registerHelper("versioned_loading_hash_animation",function(){return cdn_url+"/9c217/img/loading_hash_animation_@2x.gif"});Handlebars.registerHelper("versioned_mac_dock_badge",function(){return cdn_url+"/9135/img/prefs_mac_dock_badge@2x.png"});Handlebars.registerHelper("versioned_prefs_messages_clean",function(){return cdn_url+"/e5d8/img/prefs_messages_clean@2x.png"});Handlebars.registerHelper("versioned_prefs_messages_compact",function(){return cdn_url+"/e5d8/img/prefs_messages_compact@2x.png"});Handlebars.registerHelper("versioned_services_box_32",function(){return cdn_url+"/2fac/plugins/box/assets/service_32.png"});Handlebars.registerHelper("versioned_services_gdrive_16",function(){return cdn_url+"/66f9/img/services/gdrive_16.png"});Handlebars.registerHelper("versioned_services_onedrive_32",function(){return cdn_url+"/436da/plugins/onedrive/assets/service_32.png"});Handlebars.registerHelper("versioned_slackbot_48",function(){return cdn_url+"/2fac/plugins/slackbot/assets/service_48.png"});Handlebars.registerHelper("versioned_slackbot_72",function(){return cdn_url+"/0180/img/slackbot_72.png"});Handlebars.registerHelper("versioned_theme_thumb_brinjal",function(){return cdn_url+"/436da/img/themes/brinjal@2x.png"});Handlebars.registerHelper("versioned_theme_thumb_chocolate",function(){return cdn_url+"/436da/img/themes/chocolate@2x.png"});Handlebars.registerHelper("versioned_theme_thumb_default",function(){return cdn_url+"/436da/img/themes/aubergine@2x.png"});Handlebars.registerHelper("versioned_theme_thumb_hoth",function(){return cdn_url+"/436da/img/themes/hoth@2x.png"});Handlebars.registerHelper("versioned_theme_thumb_monument",function(){return cdn_url+"/436da/img/themes/monument@2x.png"});Handlebars.registerHelper("versioned_theme_thumb_ocean",function(){return cdn_url+"/436da/img/themes/ochin@2x.png"});Handlebars.registerHelper("versioned_theme_thumb_solanum",function(){return cdn_url+"/436da/img/themes/solanum@2x.png"});Handlebars.registerHelper("versioned_theme_thumb_workhard",function(){return cdn_url+"/436da/img/themes/workhard@2x.png"});Handlebars.registerHelper("versioned_twitter_64",function(){return cdn_url+"/66f9/img/services/twitter_64.png"});Handlebars.registerHelper("versioned_upload_file_icon",function(e){if("1x"===e)return cdn_url+"/a079/img/upload_file_icon.png";else if("2x"===e)return cdn_url+"/a079/img/upload_file_icon@2x.png"});Handlebars.registerHelper("versioned_default_application_icon",function(){return cdn_url+"/bfaba/img/apps/default_new_app_icon.png"});Handlebars.registerHelper("versioned_join_shared_channel",function(e){if("1x"===e)return cdn_url+"/742c/img/join-channel/join_shared_channel.png";else if("2x"===e)return cdn_url+"/742c/img/join-channel/join_shared_channel@2x.png"});Handlebars.registerHelper("versioned_join_team_channel",function(e){if("1x"===e)return cdn_url+"/742c/img/join-channel/join_team_channel.png";else if("2x"===e)return cdn_url+"/742c/img/join-channel/join_team_channel@2x.png"});Handlebars.registerHelper("versioned_signin_no_teams",function(e){if("1x"===e)return cdn_url+"/7c9e4/img/enterprise/signin-no-teams.png";else if("2x"===e)return cdn_url+"/7c9e4/img/enterprise/signin-no-teams@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_coming_soon",function(e){if("1x"===e)return cdn_url+"/436da/img/enterprise/ent_basic_analytics_coming_soon.png";else if("2x"===e)return cdn_url+"/436da/img/enterprise/ent_basic_analytics_coming_soon@2x.png"});Handlebars.registerHelper("versioned_slack_logo_240",function(){return cdn_url+"/66f9/img/slack_logo_240.png"});Handlebars.registerHelper("versioned_file_drop_blue",function(){return cdn_url+"/c3881/img/file-drop-blue@2x.png"});Handlebars.registerHelper("versioned_focus_rocks",function(){return cdn_url+"/883cf/img/focus-rocks-0.png"});Handlebars.registerHelper("versioned_ill_team",function(e){if("1x"===e)return cdn_url+"/436da/img/quick_promo/ill_team.png";else if("2x"===e)return cdn_url+"/436da/img/quick_promo/ill_team@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_upsell_banner_image",function(){return cdn_url+"/436da/img/enterprise/ent_basic_analytics_upsell_banner_image.gif"});Handlebars.registerHelper("pinToLabel",function(e){var t="";if(e.is_channel)t+="#";if(e.is_im||e.is_mpim)t+=TS.i18n.t("this conversation","pins")();else t+=_.escape(e.name);return new Handlebars.SafeString(t)});Handlebars.registerHelper("preventWidow",function(e){var t=e.split(" ");if(t.length>1){t[t.length-2]+="&nbsp;"+t[t.length-1];t.pop();e=t.join(" ")}return new Handlebars.SafeString(e)});Handlebars.registerHelper("numberWithCommas",function(e){return TS.utility.numberWithCommas(e)});Handlebars.registerHelper("buildReplyBarHTML",function(e,t){return new Handlebars.SafeString(TS.templates.builders.buildReplyBarHTML(e,t))});Handlebars.registerHelper("makeSHRoomParticipantList",TS.templates.builders.makeSHRoomParticipantList);Handlebars.registerHelper("makeSHRoomSharedList",TS.templates.builders.makeSHRoomSharedList);Handlebars.registerHelper("atLabel",function(e){return TS.templates.builders.atLabel(e)});Handlebars.registerHelper("renderAttachmentActions",function(e,t){return new Handlebars.SafeString(TS.templates.builders.buildAttachmentActions(e,t))});Handlebars.registerHelper("renderAttachmentActionSelectOption",function(e,t){var n=_.merge({},e,{is_group_item:t.hash.is_group_item});var r=TS.templates.attachment_actions_select_option(n);return new Handlebars.SafeString(r)});Handlebars.registerHelper("renderAttachmentMedia",function(e,t){var n;var r=TS.utility.attachments.getMediaType(e);var i;switch(r){case"other":if(e.other_html)n=TS.templates.builders.buildInlineOtherDiv(e.other_html,t,e.safe_other_html);break;case"video":if(e.video_html&&e.thumb_url){i=e.from_url||e.thumb_url;n=TS.templates.builders.buildInlineVideoDiv(i,t)}break;case"image":if(e.image_url){i=e.from_url||e.image_url;var a={};a.flush_with_attachment=true;a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;n=TS.templates.builders.buildInlineImgDiv(i,t,a)}break;case"audio":if(e.audio_html)n=TS.templates.builders.buildInlineAudioDiv(e.audio_html,t,e.safe_audio_html);else if(e.audio_url)n=TS.templates.builders.formatSoundUrl(e)}if(n)return new Handlebars.SafeString(n)});Handlebars.registerHelper("getMemberTypeClass",TS.templates.builders.getMemberTypeClass);Handlebars.registerHelper("inlineSaver",function(e){var t=TS.templates.inline_saver({hide_text:e.hash.hide_text,target:e.hash.target});return new Handlebars.SafeString(t)});Handlebars.registerHelper("dangerouslyRenderHTML",function(e){return new Handlebars.SafeString(e)});Handlebars.registerHelper("attachmentMediaCaret",function(e,t){var n="";var r=TS.utility.attachments.getMediaType(e);var i;switch(r){case"video":i=e.from_url||e.thumb_url;n=TS.templates.builders.buildInlineVideoToggler(i,t,true);break;case"audio":i=e.audio_html||e.audio_url;n=TS.templates.builders.buildInlineAudioToggler(i,t);break;case"other":n=TS.templates.builders.buildInlineOtherToggler(e.other_html,t);break;case"image":i=e.from_url||e.image_url;var a={};a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;n=TS.templates.builders.buildInlineImgToggler(i,t,false,a);break;default:n=TS.templates.builders.buildInlineAttachmentToggler(e.from_url,t)}if(n)n='<span class="media_caret">'+n+"</span>";return new Handlebars.SafeString(n)});Handlebars.registerHelper("isMsgReply",function(e){var t=e.hash.msg;var n=TS.utility.msgs.isMsgReply(t);if(n)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("buildMsgHTMLForThreadsView",function(e,t,n,r){var i=TS.templates.builders.buildThreadMsgHTML(e,t,n,r);return new Handlebars.SafeString(i)});Handlebars.registerHelper("buildThreadParticipantListHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.buildThreadParticipantListHTML(e))});Handlebars.registerHelper("supportsTextyTakesOver",function(e){if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("supportsTextyMentions",function(e){if(TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("getTeamIconOfSize",function(e,t){if(e&&e.icon)return e.icon["image_"+t];return null});Handlebars.registerHelper("listItemCount",function(e){if(_.isUndefined(e)){TS.error("The template helper listItemCount failed because it was passed undefined");return 0}e=TS.utility.parseJSONOrElse(e,e);if(_.isString(e)&&e.length)return e.split(",").length;return e.length});Handlebars.registerHelper("getIconSizeToFit",function(e){var t=[230,132,102,88,68,44,34];if(e>=_.first(t))return _.first(t);if(e<=_.last(t))return _.last(t);var n=_.first(t);for(var r=0;r<t.length;r+=1)if(t[r]>=e)n=t[r];return n});Handlebars.registerHelper("prefsNotificationExampleAll",function(){var e=TS.model.team.name;if(!TS.model.is_mac)e=TS.i18n.t("from {team_name}","prefs")({team_name:e});var t=TS.templates.prefs_notification_example({name:e,text:TS.i18n.t("Good morning everyone!","prefs")()});return new Handlebars.SafeString(t)});Handlebars.registerHelper("prefsNotificationExampleMentions",function(){var e=TS.model.team.name;if(!TS.model.is_mac)e=TS.i18n.t("from {team_name}","prefs")({team_name:e});var t=":wave:";var n=TS.emoji.getChosenSkinTone();if(n)t+=":"+n+":";var r=TS.emoji.graphicReplace(t);var i=TS.templates.prefs_notification_example({name:e,text:new Handlebars.SafeString(TS.i18n.t("{wave_emoji} Hi <strong>@{username}</strong>","prefs")({wave_emoji:r,username:_.escape(TS.model.user.name)}))});return new Handlebars.SafeString(i)});Handlebars.registerHelper("prefsNotificationSettingReadable",function(e){if(!e.desktop&&!e.mobile)return"";var t="";if(e.desktop===e.mobile)if("everything"===e.desktop)t+=TS.i18n.t("<strong>Desktop and Mobile:</strong> All new messages","prefs")();else if("mentions"===e.desktop)t+=TS.i18n.t("<strong>Desktop and Mobile:</strong> Direct messages, mentions &amp; keywords","prefs")();else t+=TS.i18n.t("<strong>Desktop and Mobile:</strong> Nothing","prefs")();else{if(e.desktop)if("everything"===e.desktop)t+=TS.i18n.t("<strong>Desktop:</strong> All new messages","prefs")();else if("mentions"===e.desktop)t+=TS.i18n.t("<strong>Desktop:</strong> Direct messages, mentions &amp; keywords","prefs")();else t+=TS.i18n.t("<strong>Desktop:</strong> Nothing","prefs")();if(e.desktop&&e.mobile)t+="<br>";if(e.mobile)if("everything"===e.mobile)t+=TS.i18n.t("<strong>Mobile:</strong> All new messages","prefs")();else if("mentions"===e.mobile)t+=TS.i18n.t("<strong>Mobile:</strong> Direct messages, mentions &amp; keywords","prefs")();else t+=TS.i18n.t("<strong>Mobile:</strong> Nothing","prefs")()}return new Handlebars.SafeString(t)})},test:function n(){return{_optionsFnInverseBooleanHelper:e,_inlineImgSrcForFile:t}}});var e=function e(t){if("function"!==typeof t.fn)t.fn=function(){return true};if("function"!==typeof t.inverse)t.inverse=function(){return false};return t};var t=function e(t,n){if("string"===typeof t)t=TS.files.getFileById(t);if(!t)return false;if(!TS.files.fileIsImage(t))return false;if(!n)n=480;return TS.files.getThumbSrcForFile(t,{max_size:n})}})()},4247:function(e,t){(function(){"use strict";TS.registerModule("utility.date",{fake_ts_unique_padder:"x",do24hrTime:function e(){return TS.model.user&&TS.model.prefs&&TS.model.prefs.time24},memberUTCOffset:function t(n){var r=e(n);var i=r/60/60;if(i<0)return"(UTC"+i+")";else if(i>0)return"(UTC+"+i+")";return"(UTC)"}});var e=function e(t){var n=-28800;if(t&&t.tz_offset&&"undefined"!==typeof t.tz_offset||0===t.tz_offset)n=t.tz_offset;return n}})()},4248:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("utility.msgs",{automated_subtypes:["channel_join","channel_leave","channel_topic","channel_purpose","channel_archive","channel_unarchive","group_join","group_leave","group_topic","group_purpose","group_archive","group_unarchive","group_name","channel_name","play_sound","pinned_item","unpinned_item","sh_room_shared","sh_room_created","bot_enable","bot_disable","bot_add","bot_remove","reminder_add","reminder_delete","reply_broadcast"],file_subtypes:["file_comment","file_mention","file_share","file_upload"],allowed_embed_attributes:["class","name","id","src","width","oldwidth","height","oldheight","frameborder","title","scrolling","allowtransparency","allowfullscreen","oallowfullscreen","msallowfullscreen","webkitallowfullscreen","mozallowfullscreen","controls","autoplay","loop","muted","poster","preload","webkit-playsinline","type"],ephemeral_msgs_map:{},messageIncludesMember:function e(t,n){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!n){TS.warn("messageIncludesMember: WTF no msg?");return}if(TS.utility.msgs.memberSentMessage(t,n))return true;var r=n.text;var i=TS.format.calculateOptions(n,{});var a=TSF.getTokensArray($.trim(r),i.tsf_mode,{jumbomoji:!i.no_jumbomoji});var s;for(var o=0,l=a.length;o<l;o+=1){s=a[o];if(0===s.indexOf("<")&&0===s.indexOf("<@")){var u=s.replace(/<|>/g,"");var d=TS.utility.msgs.getMemberIdFromMemberMarkup(u);if(d&&d==t.id)return true}}return false},memberSentMessage:function e(t,n){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!n){TS.warn("messageIncludesMember: WTF no msg?");return}return!!(n.user&&n.user==t.id)||!!(n.comment&&n.comment.user==t.id)},allUnknownUsersInMessage:function e(t){var n=[];var r=t.text;var i=TS.format.calculateOptions(t,{});var a=TSF.getTokensArray($.trim(r),i.tsf_mode,{jumbomoji:!i.no_jumbomoji});for(var s=0;s<a.length;s+=1){var o=a[s];if(0===o.indexOf("<")&&0===o.indexOf("<@")){var l=o.replace(/<|>/g,"");var u=TS.utility.msgs.getMemberIdFromMemberMarkup(l);var d=TS.members.getPotentiallyUnknownMemberById(u);if(!d)d=TS.members.getMemberByName(u);if(!d)if(n.indexOf(u)<0)n.push(u)}}return n},appendMsg:function e(t,n){t.unshift(TS.utility.msgs.makeSureMsgObIsValid(n))},setMsgs:function e(t,n){for(var r=0;r<n.length;r+=1)n[r]=TS.utility.msgs.makeSureMsgObIsValid(n[r]);TS.utility.msgs.sortMsgs(n);t.msgs=n;return t.msgs},spliceMsg:function e(t,n){var r=t.indexOf(n);if(r>-1)t.splice(r,1)},getNonTempMsgFromUserMatchingText:function e(t,n,r){if(!t&&0!==t)return null;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i.user!=n)continue;if(TS.utility.msgs.isTempMsg(i))continue;if(i.text==t)return i}return null},getMsgByProp:function e(t,n,r){if(!n&&0!==n)return null;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i[t]==n)return i}return null},getEditableMsgByProp:function e(t,n,r){if(!n&&0!==n||!r)return null;var i;for(var a=0;a<r.length;a+=1){i=r[a];if(i.subtype&&"me_message"!==i.subtype&&"thread_broadcast"!==i.subtype)continue;if(i[t]==n)return i}return null},getEditableReplyByProp:function e(t,n,r,i){if(!n&&0!==n||!r||!i)return null;var a;if(TS.ui.replies.activeConvoModelId()===r.id&&TS.ui.replies.activeConvoThreadTs()===i)a=TS.ui.replies.getActiveMessages();else if(TS.model.threads_view_is_showing){var s=TS.client.threads.getThread(r,i);a=s&&s.replies?s.replies:[]}var o=_.findLast(a,function(e){var r=!(e.subtype&&"me_message"!==e.subtype);var i=e[t]===n;return r&&i});return o},sortMsgs:function e(t){function n(e,t){if(e.ts<t.ts)return 1;if(e.ts>t.ts)return-1;return 0}t.sort(n)},isMsgRolledUp:function e(t){if(!t._jl_rolled_up_in)return false;return t._jl_rolled_up_in!==t.ts},isMsgHidden:function e(t){if(!t)return true;if(t.no_display)return true;if(t._hidden_reply)return true;return false},getPrevDisplayedMsg:function e(t,n){var r;var i=false;for(var a=0;a<n.length;a+=1){r=n[a];if(i){if(!TS.utility.msgs.isMsgHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}else if(r.ts==t)i=true}return null},getDisplayedMsgs:function e(t){var n=[];var r;for(var i=0;i<t.length;i+=1){r=t[i];if(!TS.utility.msgs.isMsgHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))n.push(r)}return n},getDisplayedMsgAfterTS:function e(t,n){var r;for(var i=n.length-1;i>-1;i-=1){r=n[i];if(r.ts>t)if(!TS.utility.msgs.isMsgHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}return null},getDisplayedMsgBeforeTS:function e(t,n){var r;for(var i=0;i<n.length;i+=1){r=n[i];if(r.ts<t)if(!TS.utility.msgs.isMsgHidden(r)&&!TS.utility.msgs.isMsgRolledUp(r))return r}return null},getUnreadCountableMsgAfterTS:function e(t,n){var r;for(var i=n.length-1;i>-1;i-=1){r=n[i];if(r.ts>t)if(TS.utility.msgs.msgCanCountAsUnread(r))return r}return null},getMarkMsgTSForUnreadPoint:function e(t,n,r){var i;var a;if(r.oldest_msg_ts&&t==r.oldest_msg_ts)i="0000000000.000000";else{a=TS.utility.msgs.getPrevDisplayedMsg(t,n)||TS.utility.msgs.getMsg(t,n);if(a)i=a.ts}if(!i)return null;while(i&&!TS.utility.msgs.getUnreadCountableMsgAfterTS(i,n)){a=TS.utility.msgs.getPrevDisplayedMsg(i,n);if(a)i=a.ts;else i=null}if(!i)return null;return i},getMsg:function e(t,n){if(!n)return null;return TS.utility.msgs.getMsgByProp("ts",t,n)},canEditMsg:function e(t,n){if(t.user!==TS.model.user.id)return false;if(TS.utility.msgs.isAutomatedMsg(t))return false;if(TS.utility.msgs.isFileMsg(t))return false;if(t&&"reply_broadcast"===t.subtype)return false;if(t&&"tombstone"===t.subtype)return false;if(n&&n.is_self_im)return true;if(TS.model.team.prefs.msg_edit_window_mins>-1&&(Date.now()-TS.interop.datetime.toDateObject(t.ts))/6e4>TS.model.team.prefs.msg_edit_window_mins)return false;return true},isAutomatedMsg:function e(t){if(!t)return false;return TS.utility.msgs.isAutomatedSubtype(t.subtype)},isAutomatedSubtype:function e(t){if(!t)return false;return TS.utility.msgs.automated_subtypes.indexOf(t)>=0},isFileMsg:function e(t){if(!t)return false;return TS.utility.msgs.isFileSubtype(t.subtype)},isFileSubtype:function e(t){if(!t)return false;return TS.utility.msgs.file_subtypes.indexOf(t)>=0},getMsgActions:function e(t,n){if(!t)return;n=n||TS.shared.getActiveModelOb();var r={edit_msg:TS.utility.msgs.canEditMsg(t,n),delete_msg:true};var i=false;if(t.user==TS.model.user.id)i=true;var a=TS.utility.teams.isMsgFromOtherTeam(t);if(t.file&&"email"===t.file.mode)r.open_original=true;if(!TS.model.team.prefs.allow_message_deletion){if(a)if(TS.boot_data.page_needs_enterprise&&TS.model.user.enterprise_user.is_owner)r.delete_msg=true;else r.delete_msg=false;else if(!TS.model.user.is_admin)r.delete_msg=false;else if(TS.model.active_im_id)if(!i&&"USLACKBOT"!==t.user&&"bot_message"!==t.subtype)r.delete_msg=false}else if("tombstone"===t.subtype)r.delete_msg=false;else if("retention"===t.subtype)r.delete_msg=false;else if(a)if(TS.boot_data.page_needs_enterprise&&(i||TS.model.user.enterprise_user.is_owner))r.delete_msg=true;else r.delete_msg=false;else if(TS.model.active_im_id){if(!i&&"USLACKBOT"!==t.user&&"bot_message"!==t.subtype)r.delete_msg=false}else if(!i){if(!TS.model.user.is_admin)r.delete_msg=false}else if(TS.utility.msgs.isAutomatedMsg(t)){var s=["pinned_item","sh_room_created","sh_room_shared","reply_broadcast"];if(!TS.model.user.is_admin&&!_.includes(s,t.subtype))r.delete_msg=false}if(TS.boot_data.feature_new_broadcast)if("thread_broadcast"===t.subtype)r.remove_broadcast=r.delete_msg;if(t.is_ephemeral)r.delete_msg=true;else{if(TS.client&&"pinned_item"!==t.subtype&&"unpinned_item"!==t.subtype&&"sh_room_created"!==t.subtype&&"sh_room_shared"!==t.subtype){if(TS.pins.canUserPinHere(n))if(TS.pins.isMessagePinned(t,n))r.unpin_msg=true;else r.pin_msg=true;if("tombstone"===t.subtype){r.unpin_msg=false;r.pin_msg=false}var o=["channel_join","channel_leave","group_join","group_leave"];if(_.includes(o,t.subtype))r.pin_msg=false}if("file_comment"===t.subtype)r.add_file_comment_rxn=true;else if(TS.utility.msgs.isFileMsg(t))r.add_file_rxn=true;else if("tombstone"===t.subtype)r.add_rxn=false;else r.add_rxn=true;if(TS.clipboard.canWriteText()){r.copy_link=true;if("tombstone"===t.subtype)r.copy_link=false}}if(TS.client)r.mark_unread=true;var l=!t.thread_ts||t.thread_ts==t.ts;r.jump_to_original=true;if(TS.replies.canReplyToMsg(n,t))r.reply=true;r.jump_to_original=l;if(r.mark_unread&&!l)r.mark_unread=false;var u=["bot_message","file_share","file_mention","file_comment","me_message","reply_broadcast","thread_broadcast"];if(!t.is_ephemeral&&(!t.subtype||-1!==u.indexOf(t.subtype)))r.remind_me=true;if(r.jump_to_original||r.copy_link||r.mark_unread||r.remind_me)r.has_private_actions=true;if(r.copy_link||r.add_rxn||r.add_file_rxn||r.add_file_comment_rxn||r.pin_msg||r.unpin_msg)r.has_public_actions=true;if(!t.is_ephemeral&&!TS.utility.msgs.isTempMsg(t))if("file_share"===t.subtype||"file_mention"===t.subtype)r.share_file=true;else if("tombstone"===t.subtype)r.share_message=false;else r.share_message=!TS.ims.isImWithDeletedMember(n)&&(!n.is_archived||n.is_channel);return r},validateMsg:function e(t,n,r){if(!n.ts){TS.error("msg lacks a ts ("+t+")");TS.dir(0,n);return false}if(TS.utility.msgs.getMsg(n.ts,r)){TS.warn("msg "+n.ts+" already exists! ("+t+")");TS.dir(0,n);return false}return true},findMsg:function e(t,n){var r;if(TS.useReactMessages()){r=TS.redux.messages.getMessageByTimestamp(n,t);if(r)return r}var i=TS.shared.getModelObById(n);if(i){r=i.msgs&&TS.utility.msgs.getMsg(t,i.msgs);if(r)return r;r=i._archive_msgs&&TS.utility.msgs.getMsg(t,i._archive_msgs);if(r)return r;if(TS.ui.replies){r=TS.ui.replies.getActiveMessage(i,t);if(r)return r}if(TS.client){r=TS.client.threads.getMessage(i,t);if(r)return r}if(!r&&TS.model.unread_view_is_showing&&TS.client){r=TS.client.unread.getMessage(i,t);if(r)return r}}var a=TS.mentions.getMentionByMsgId(t);if(a)return a.message;return null},replaceMsg:function e(t,n,r,i){var a=TS.utility.msgs.getMsg(n.ts,t.msgs);if(!a&&t._archive_msgs)a=TS.utility.msgs.getMsg(n.ts,t._archive_msgs);if(!a&&TS.ui.replies)a=TS.ui.replies.getActiveMessage(t,n.ts);if(!a&&TS.client)a=TS.client.threads.getMessage(t,n.ts);if(!a&&TS.client)a=TS.client.unread.getMessage(t,n.ts);if(TS.useReactMessages())TS.redux.messages.replaceMessage(TS.utility.msgs.processImsg(n,t.id));if(!a){if(!r)TS.error("unknown msg:"+n.ts+" in "+t.id);return}n._rxn_key=a._rxn_key;if(!n.pinned_to)n.pinned_to=a.pinned_to;if(!("is_starred"in n))n.is_starred=a.is_starred;if(TS.boot_data.feature_sli_recaps&&!n.recap&&a.recap)n.recap=a.recap;var s=null;if(n.comment&&n.file){var o=TS.files.getFileById(n.file.id);if(o){TS.files.editCommentOnFile(n.comment,o);s=TS.files.getFileCommentById(o,n.comment.id)}}n=TS.utility.msgs.processImsg(n,t.id);if(s)n.comment=s;var l=_.union(Object.keys(n),Object.keys(a)).filter(function(e){return n[e]!=a[e]});if(!l.length&&!i){TS.info("Not signalling message change because it doesn't look like anything has changed for "+n.ts+" in "+t.id);return}_.each(_.keys(a),function(e){delete a[e]});_.forOwn(n,function(e,t){a[t]=e});if(t.is_im)TS.ims.message_changed_sig.dispatch(t,a,l);else if(t.is_group&&t.is_mpim)TS.mpims.message_changed_sig.dispatch(t,a,l);else if(t.is_group&&!t.is_mpim)TS.groups.message_changed_sig.dispatch(t,a,l);else if(t.is_channel&&t.is_mpim)TS.mpims.message_changed_sig.dispatch(t,a,l);else if(t.is_channel)TS.channels.message_changed_sig.dispatch(t,a,l);if(TS.boot_data.feature_new_broadcast&&_.includes(l,"_hidden_reply")){var u=!TS.utility.msgs.isTempMsg(a);if(t.is_im)TS.ims.calcUnreadCnts(t,u);else if(t.is_group&&t.is_mpim)TS.mpims.calcUnreadCnts(t,u);else if(t.is_group&&!t.is_mpim)TS.groups.calcUnreadCnts(t,u);else if(t.is_channel&&t.is_mpim)TS.mpims.calcUnreadCnts(t,u);else if(t.is_channel)TS.channels.calcUnreadCnts(t,u)}if(TS.boot_data.feature_new_broadcast&&TS.utility.msgs.msgHasReplies(a)&&!TS.useReactMessages())TS.replies.updateThreadBroadcastRoots(t,a)},removeEphemeralMsg:function e(t,n){var r=TS.groups.getGroupById(t)||TS.channels.getChannelById(t);if(!r)return;if(r.is_channel)TS.channels.removeMsg(t,TS.utility.msgs.getMsg(n,r.msgs));else if(r.is_mpim)TS.mpims.removeMsg(t,TS.utility.msgs.getMsg(n,r.msgs));else if(r.is_group)TS.groups.removeMsg(t,TS.utility.msgs.getMsg(n,r.msgs))},getMemberFromMemberMarkup:function e(t){var n=TS.utility.msgs.getMemberIdFromMemberMarkup(t);var r=TS.members.getPotentiallyUnknownMemberById(n);if(!r)r=TS.members.getMemberByName(n);return r},getMemberIdFromMemberMarkup:function e(t){var n=t.substr(1);if(n)n=n.split("|")[0];return n},makeSureMsgObIsValid:function e(t){return t},api_url_prefix:"api::",doApiUrl:function e(t){if(!TS.client){alert(TS.i18n.t("This link will not work in the archives.","msgs")());return}t=t.replace(TS.utility.msgs.api_url_prefix,"");var n=t.split("?");var r=n[0];var i={};if(n.length>1){var a=n[1].split("&");for(var s=0;s<a.length;s+=1){var o=a[s].indexOf("=");if(-1!=o){var l=a[s].substring(0,o);var u=a[s].substring(o+1);i[l]=unescape(u)}}}TS.api.call(r,i)},new_api_url_prefix:"slack-action://",doNewApiUrl:function e(t){if(!TS.client){alert(TS.i18n.t("This link will not work in the archives.","msgs")());return}var n=t.replace(TS.utility.msgs.new_api_url_prefix,"").split("/");var r=n.shift();var i=n.join("/");TS.api.call("chat.action",{bot:r,payload:decodeURIComponent(i)})},getHighlightWordsRegex:function e(){if(!TS.model.highlight_words_regex)TS.utility.msgs.makeHighlightWordsRegex();return TS.model.highlight_words_regex},makeHighlightWordsRegex:function e(){var t;var n=[];for(var r=0;r<TS.model.highlight_words.length;r+=1){t=TS.format.swapOutAts(TS.model.highlight_words[r]);t=TS.utility.regexpEscape(t);if("don"===t)t+="(?!['’]t)";n.push(t)}TS.model.highlight_words_regex=new RegExp("(\\b|_|\\s|^)("+n.join("|")+")(\\b|_|\\s|$)","i")},msgContainsMention:function e(t,n,r,i,a){var s=TS.utility.msgs.getHighlightWordsRegex();var o="bot_message"===t.subtype;var l=TS.utility.msgs.isMsgReply(t);function u(e){if(!e)return false;if(TS.model.you_regex.test(e))return true;if(!n&&TS.model.here_regex.test(e))return true;if(!i&&!l&&TS.model.everyone_regex.test(e))return true;if(!a&&!l&&TS.model.channel_regex.test(e))return true;if(!l&&TS.model.group_regex.test(e))return true;for(var t in TS.model.your_user_group_regex)if(TS.model.your_user_group_regex[t].test(e))return true;if(o)return false;e=e.replace(/<!subteam\^(\w+\d+)\|@(.+)>/g,"");e=TS.format.swapOutAts(e);if(s.test(e)&&!r)return true;return false}if("pinned_item"===t.subtype)return false;if(!t.ignore_if_attachments_supported&&u(t.text))return true;var d;var c;if(t.attachments)for(var _=0;_<t.attachments.length;_+=1){d=t.attachments[_];if(d.from_url)continue;if(u(d.title))return true;if(u(d.pretext))return true;if(u(d.text))return true;if(u(d.footer))return true;if(!d.fields||!d.fields.length)continue;for(var m=0;m<d.fields.length;m+=1){c=d.fields[m];if(u(c.value))return true}}return false},getMsgMentionData:function e(t,n){var r={mentions:false,non_channel_mentions:false};var i=TS.utility.msgs.getHighlightWordsRegex();var a="bot_message"===t.subtype;var s=TS.utility.msgs.isMsgReply(t);function o(e){if(l(e)){r.non_channel_mentions=true;r.mentions=true;return true}if(u(e))r.mentions=true;return false}function l(e){if(!e)return false;if(TS.model.you_regex.test(e))return true;if(a)return false;e=TS.format.swapOutAts(e);if(i.test(e)&&!n)return true;return false}function u(e){if(!e)return false;if(TS.model.everyone_regex.test(e)&&!s)return true;if(TS.model.channel_regex.test(e)&&!s)return true;if(TS.model.group_regex.test(e)&&!s)return true;return false}if(!t.ignore_if_attachments_supported&&o(t.text))return r;var d;var c;if(t.attachments)for(var _=0;_<t.attachments.length;_+=1){d=t.attachments[_];if(d.from_url)continue;if(o(d.title))return r;if(o(d.pretext))return r;if(o(d.text))return r;if(o(d.footer))return r;if(!d.fields||!d.fields.length)continue;for(var m=0;m<d.fields.length;m+=1){c=d.fields[m];if(o(c.value))return r}}return r},msgCanCountAsUnread:function e(t){if(TS.utility.msgs.isMsgHidden(t))return false;if("channel_join"===t.subtype&&t.inviter&&t.user==TS.model.user.id)return true;if("group_join"===t.subtype&&t.inviter&&t.user==TS.model.user.id)return true;if(t.user==TS.model.user.id)return false;if("channel_join"===t.subtype)return false;if("channel_leave"===t.subtype)return false;if("group_join"===t.subtype)return false;if("group_leave"===t.subtype)return false;if("mpim_notify_disabled"===t.subtype)return false;if(t.comment&&t.comment.user==TS.model.user.id)return false;if(t.dnd_suppressed)return false;return true},countAllUnreads:function t(){if(e)return;TS.model.all_unread_highlights_cnt=0;TS.model.all_unread_cnt=0;TS.model.all_unread_cnt_to_exclude=0;TS.model.all_unread_highlights_cnt_to_exclude=0;var n;var r;var i=TS.channels.getChannelsForUser();i.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session||TS.notifs.isCorGMuted(e.id))return;n=parseInt(e.unread_cnt,10)||0;r=parseInt(e.unread_highlight_cnt,10)||0;TS.model.all_unread_cnt+=n;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(e,n,r)});TS.model.groups.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session||TS.notifs.isCorGMuted(e.id))return;n=parseInt(e.unread_cnt,10)||0;r=parseInt(e.unread_highlight_cnt,10)||0;TS.model.all_unread_cnt+=n;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(e,n,r)});TS.model.ims.forEach(function(e){n=parseInt(e.unread_cnt,10)||0;r=parseInt(e.unread_cnt,10)||0;TS.model.all_unread_cnt+=n;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(e,n,r)});TS.model.mpims.forEach(function(e){n=parseInt(e.unread_cnt,10)||0;r=parseInt(e.unread_cnt,10)||0;TS.model.all_unread_cnt+=n;TS.model.all_unread_highlights_cnt+=r;TS.utility.msgs.maybeExcludeUnreads(e,n,r)});if(TS.model.threads_has_unreads)TS.model.all_unread_cnt+=1;if(TS.model.threads_mention_count)TS.model.all_unread_highlights_cnt+=TS.model.threads_mention_count},maybeExcludeUnreads:function e(t,n,r){if(!t)return;if(!n&&!r)return;if(!TS.shared.isModelObOrgShared(t))return;if(!TS.shared.isRelevantTeamForSharedModelOb(t)){if(TS.model.is_our_app&&TS.has_pri[o])TS.log(o,"Excluding unread of "+n+" and highlight of "+r+" for shared channel "+t.id+" because this is NOT the relevant team.");TS.model.all_unread_cnt_to_exclude+=n;TS.model.all_unread_highlights_cnt_to_exclude+=r}else if(TS.has_pri[o]&&TS.model.is_our_app)TS.log(o,"Using unread of "+n+" and highlight of "+r+" for shared channel "+t.id+" because this IS the relevant team.")},doesMsgHaveRxnFromUser:function e(t,n){return TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t._rxn_key),n)},doesMsgHaveRxn:function e(t,n){return TS.rxns.doesRxnsHaveRxn(TS.rxns.getExistingRxnsByKey(t._rxn_key),n)},recordEmojiInHash:function e(t,n){if(!t)return false;if(!n)return false;var r=true;var i=TS.utility.findAllTeamEmojiInStr(t,r);if(!i.length)return false;var a=false;var s;for(var o=0;o<i.length;o+=1){s=TS.emoji.isValidName(i[o]);if(!s){TS.error(i[o]+" invalid");continue}if(!parseInt(n[s],10))n[s]=0;n[s]+=1;a=true}return a},reCalcAndCountSomeUnreads:function e(t){if(!t||!t.length)return;var n;var r;var i;for(n=0;n<t.length;n+=1){i=TS.shared.getModelObById(t[n]);if(!i){TS.warn("reCalcAndCountSomeUnreads: WTF no model_ob for id "+t[n]);continue}r=TS.shared.getControllerForModelOb(i);if(!r){TS.warn("reCalcAndCountSomeUnreads: WTF no controller for model_ob.id "+i.id);continue}if(!r.calcUnreadCnts){TS.warn("reCalcAndCountSomeUnreads: WTF no calcUnreadCnts on controller for model_ob.id "+i.id);continue}r.calcUnreadCnts(i)}},reCalcAndCountAllUnreads:function e(){var t=TS.channels.getChannelsForUser();var n=true;TS.utility.msgs.startBatchUnreadCalc();t.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session)return;if(n&&TS.shared.didDeferMessageHistoryById(e.id))return;TS.channels.calcUnreadCnts(e)});TS.model.groups.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session)return;if(n&&TS.shared.didDeferMessageHistoryById(e.id))return;TS.groups.calcUnreadCnts(e)});TS.model.ims.forEach(function(e){if(n&&TS.shared.didDeferMessageHistoryById(e.id))return;TS.ims.calcUnreadCnts(e)});TS.model.mpims.forEach(function(e){if(n&&TS.shared.didDeferMessageHistoryById(e.id))return;TS.mpims.calcUnreadCnts(e)});TS.utility.msgs.finishBatchUnreadCalc()},startBatchUnreadCalc:function t(){if("0"==TS.qs_args.unread_batch)return;e=true},finishBatchUnreadCalc:function t(){e=false;TS.utility.msgs.countAllUnreads()},whatisunread:function e(){var t=[];TS.channels.getChannelsFilteredBy("unread_cnt").forEach(function(e){t.push("C:"+e.name+" "+e.unread_cnt)});TS.groups.getGroupsFilteredBy("unread_cnt").forEach(function(e){t.push("G:"+e.name+" "+e.unread_cnt)});TS.ims.getImsFilteredBy("unread_cnt").forEach(function(e){t.push("D:"+e.name+" "+e.unread_cnt)});TS.mpims.getMpimsFilteredBy("unread_cnt").forEach(function(e){t.push("G:"+e.name+" "+e.unread_cnt)});TS.info("unreads: "+t.join(","))},maybeSetOldestMsgsTsAfterMsgAdded:function e(t){if(t.oldest_msg_ts)return;if(t.latest)return;TS.utility.msgs.setOldestMsgsTs(t)},setOldestMsgsTs:function e(t){var n=TS.utility.msgs.getOldestValidTs(t);if(n){if(TS.pri)TS.console.log(58,"setOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> '+n);t.oldest_msg_ts=n;TS.storage.storeOldestTs(t.id,t.oldest_msg_ts);if(t._latest_via_users_counts)t._latest_via_users_counts=void 0}},resetOldestMsgsTs:function e(t){if(TS.pri)TS.console.log(58,"resetOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> null');t.oldest_msg_ts=null;TS.storage.storeOldestTs(t.id,null)},getOlderMsgsStatus:function e(t){var n=t.msgs;var r=t.oldest_msg_ts;var i=TS.shared.getLatestMsgTs(t)||null;var a=false;var s="ERROR";var o=false;var l=0;if(r&&TS.utility.msgs.getMsg(r,n))a=true;if(!i)if(n.length){o=false;l=1;s="There are NOT older messages than these."}else{o=false;l=2;s="THIS IS A BRAND NEW CHANNEL SAY SOMETHING"}else if(a||t.is_limited){o=false;l=3;s="We have the oldest msg: "+r+". is_limited:"+t.is_limited}else{o=true;l=4;if(r)s="There are older messages than these. oldest_msg_ts: "+r;else s="There are older messages than these. oldest_msg_ts: unknown"}return{text:s,more:o,code:l,is_limited:t.is_limited}},getMostRecentValidTs:function e(t){if(!t)return null;var n;var r=t.msgs||[];for(var i=0;i<r.length;i+=1){n=r[i];if(!TS.utility.msgs.isTempMsg(n)){if(TS.pri&&i>0)TS.console.log(58,"getMostRecentValidTs ("+t.id+"): "+n.ts+" at msgs["+i+"] of "+r.length);return n.ts}}var a=TS.shared.getLatestMsgTs(t)||null;if(TS.pri)TS.console.log(58,"getMostRecentValidTs ("+t.id+"): did not find most recent valid ts. getLatestMsgTs() returned "+a);return a},getOldestValidTs:function e(t){var n;if(!t||!t.msgs)return null;var r=t.msgs.length-1;for(var i=r;i>-1;i-=1){n=t.msgs[i];if(!TS.utility.msgs.isTempMsg(n)){if(TS.pri&&i!==r)TS.console.log(58,"getOldestValidTs("+t.id+"): "+n.ts+" at msgs["+i+"] of "+r);return n.ts}}if(TS.pri)TS.console.warn(58,"getOldestValidTs("+t.id+"): none found. msgs.length = "+r);return null},getHistoryFetchJobKey:function e(t,n){var r=t;if(n)r+="_"+n;return r},processImsg:function e(t,n){TS.utility.msgs._slurpExtraData(t,n);return TS.utility.msgs._makeInternalMsgObject(t,n)},processImsgFromHistory:function e(t,n){var r=TS.utility.msgs.processImsg(t,n);t.channel=n;if("message_deleted"===t.subtype)TS.ms.msg_handlers.subtype__message_deleted(t);else if("message_changed"===t.subtype)TS.ms.msg_handlers.subtype__message_changed(t);return r},_makeInternalMsgObject:function e(t,r){var i={type:"message",ts:t.ts};if(TS.useReactMessages())i.channel=r;if(t.source_team)i.source_team_id=t.source_team;if("USLACKBOT"===t.user&&t.slackbot_feels)i.slackbot_feels=t.slackbot_feels;if(t.thread_ts){i.thread_ts=t.thread_ts;if(t.parent_ts)i.parent_ts=t.parent_ts;if(t.parent_user_id)i.parent_user_id=t.parent_user_id;if(t.hasOwnProperty("reply_count"))i.reply_count=parseInt(t.reply_count,10);if(TS.boot_data.feature_new_broadcast){if(t.thread_ts!==t.ts&&"thread_broadcast"!==t.subtype)i._hidden_reply=true;if("thread_broadcast"===t.subtype&&t.root){i.root=t.root;if(TS.useReactMessages())i.root.channel=r}}else if(t.thread_ts!==t.ts)i._hidden_reply=true}if("reply_broadcast"===t.subtype){if(t.broadcast_thread_ts)i.broadcast_thread_ts=t.broadcast_thread_ts;if(t.channel)i.channel_id=t.channel;if(TS.boot_data.feature_new_broadcast)if(t.new_broadcast)i.no_display=true}if(t.replies)i.replies=t.replies;if(t.hasOwnProperty("subscribed"))i._subscribed=t.subscribed;if(t.hasOwnProperty("unread_count"))i._unread_count=t.unread_count;if(t.last_read)i._last_read=t.last_read;if("tombstone"===t.subtype&&t.hidden&&t.replies&&t.replies.length>0)delete t.hidden;if("channel_topic"===t.type||"channel_purpose"===t.type||"channel_join"===t.type||"channel_leave"===t.type)t.subtype=t.type;if(TS.utility.msgs.shouldHideChannelJoinOrLeaveMsg(t,r))i.no_display=true;if("group_join"===t.subtype||"group_purpose"===t.subtype||"group_topic"===t.subtype){var a=TS.shared.getModelObById(r);if(a&&a.is_mpim)i.no_display=true}if(t.inviter)i.inviter=t.inviter;if(t.hidden)i.hidden=t.hidden;if(t.no_notifications)i.no_notifications=t.no_notifications;if(t.ignore_if_attachments_supported)i.ignore_if_attachments_supported=t.ignore_if_attachments_supported;if(t.hidden||t.no_display)i.no_display=true;if(t.ignore_if_attachments_supported&&(!t.attachments||!t.attachments.length))i.no_display=true;if(t.edited)i.edited=t.edited;if(t.user)i.user=t.user;if(t.attachments)i.attachments=t.attachments;if(t.img_vids)i.img_vids=t.img_vids;if(t.bot_profile)i.bot_profile=t.bot_profile;var s;if(t.imgs){i.img_vids=i.img_vids||{};var o;for(s in t.imgs){if(i.img_vids[s])continue;o=t.imgs[s];o.img_vid_type="img";i.img_vids[s]=o}}if(t.videos){i.img_vids=i.img_vids||{};var l;for(s in t.videos){if(i.img_vids[s])continue;l=t.videos[s];l.img_vid_type="video";i.img_vids[s]=l}}if(t.icons)i.icons=t.icons;if(t.bot_id)i.bot_id=t.bot_id;if(t.is_ephemeral)i.is_ephemeral=t.is_ephemeral;if(t._alert_even_though_temp)i._alert_even_though_temp=t._alert_even_though_temp;if(t.is_starred)i.is_starred=t.is_starred;if(t.reactions)delete t.reactions;if(t._rxn_key)i._rxn_key=t._rxn_key;if(t.pinned_to)i.pinned_to=t.pinned_to;if(t.topic)i.topic=t.topic;if(t.name)i.name=t.name;if(t.old_name)i.old_name=t.old_name;if(t.purpose)i.purpose=t.purpose;if(t.text){if(_.isString(t.text))i.text=t.text;else TS.error("ERROR: invalid imsg.text type: "+n(t.text)+" "+TS.utility.stringifyJSONOrElse(t.text,null,2,"(and it is not JSON.stringifiable)"));if(TS.boot_data.feature_parsed_mrkdwn)TS.utility.msgs.cacheFormatting(i)}if(t.sound)i.sound=t.sound;if("mrkdwn"in t)i.mrkdwn=!!t.mrkdwn;if("hex_swatches"in t)i.hex_swatches=!!t.hex_swatches;if(t.dnd_suppressed)i.dnd_suppressed=t.dnd_suppressed;if(t.recap)i.recap=t.recap;if(t.alert_type)i.alert_type=t.alert_type;if(t.subtype){i.subtype=t.subtype;if("bot_message"===i.subtype)if(t.username)i.username=t.username;if("sh_room_created"===t.subtype||"sh_room_shared"===t.subtype)if(t._room_id)i._room_id=t._room_id;else if(t.room){var u=TS.rooms.getRoomById(t.room.id);if(u)i._room_id=u.id;else{TS.error("no room, no_display = true "+i.ts);i.no_display=true}}else i.no_display=true;if("file_share"===t.subtype||"file_mention"===t.subtype||"file_comment"===t.subtype){if(t.upload)i.upload=true;if(t.file){var d=TS.files.getFileById(t.file.id);if(d)i.file=d;else{TS.error("no file, no_display = true "+i.ts);i.no_display=true}}else i.no_display=true;if("file_comment"===t.subtype)if(t.comment)if(i.file)i.comment=TS.files.addCommentToFile(t.comment,i.file);else i.comment=t.comment;else i.no_display=true}if("pinned_item"===t.subtype){if(t.item_type)i.item_type=t.item_type;if("F"===t.item_type){if(t.item){var c=TS.files.getFileById(t.item.id);i.item=c}}else if("Fc"===t.item_type||"C"===t.item_type||"G"===t.item_type||"D"===t.item_type)i.item=t.item;i.no_display=true}}return i},cacheFormatting:function e(t){if(!t)throw new Error("Message object is required");t.cached_formatting=TSF.getTokensArray(t.text,"NORMAL",{jumbomoji:!!TS.model.prefs.jumbomoji})},clearCachedFormatting:function e(t){if(!t)throw new Error("Message object is required");delete t.cached_formatting},maybeFetchUserDataFromLS:function e(t){if(!t){TS.warn("maybeFetchUserDataFromLS: WTF no model_ob?");return}if(a[t.id])return;if(!t.last_msg_input){t.last_msg_input=TS.storage.fetchLastMsgInput(t.id);t.has_draft=!!t.last_msg_input;if(t.last_msg_input&&TS.has_pri[l])TS.log(l,'Got last_msg_input for "'+t.id+'": length = '+(t.last_msg_input.length||"unknown"))}a[t.id]=true},processAttachments:function e(t){if(!t)return;var n;for(var r=0;r<t.length;r+=1){n=t[r];if(!n){TS.warn("attachment is null!");continue}if(n.slack_file_id&&!n._slack_file_is_deleted){var i=TS.files.getFileById(n.slack_file_id);if(i)n._slack_file=i;else if(n._slack_file)n._slack_file=TS.files.upsertFile(n._slack_file).file}if(n.mrkdwn_in&&_.isArray(n.mrkdwn_in)&&n.mrkdwn_in.length){n.mrkdwn_in_hash={};for(var a=0;a<n.mrkdwn_in.length;a+=1)n.mrkdwn_in_hash[n.mrkdwn_in[a]]=true}if(!n.mrkdwn_in_hash)n.mrkdwn_in_hash={};delete n.mrkdwn_in;n.hex_swatches=!!n.hex_swatches;if(n.audio_html||n.audio_url)TS.inline_audios.makeInternalInlineAudio(n.audio_html||n.audio_url,n);if(n.other_html)TS.inline_others.makeInternalInlineOther(n);else if(n.video_html){var s=n.video_html_width&&parseInt(n.video_html_width,10)>parseInt(n.thumb_width,10)?n.video_html_width:n.thumb_width;var o=n.video_html_height&&parseInt(n.video_html_height,10)>parseInt(n.thumb_height,10)?n.video_html_height:n.thumb_height;TS.inline_videos.makeInternalInlineVideo(n.from_url||n.thumb_url,{title:n.title,html:TS.utility.msgs.filterHTMLForEmbeds(n.video_html),thumbnail:{url:n.thumb_url,width:s,height:o,link_url:n.from_url||n.title_url}})}else if(n.image_url)TS.inline_imgs.makeInternalInlineImg(n.from_url||n.image_url,{src:n.image_url,width:n.image_width,height:n.image_height,link_url:n.from_url||n.title_url||n.image_url,bytes:n.image_bytes,rotation:n.rotation,content_type:n.content_type});TS.inline_attachments.massageAttachment(n,r)}},_slurpExtraData:function e(t,n){TS.utility.msgs.processAttachments(t.attachments);t._rxn_key=TS.rxns.getRxnKey("message",t.ts,n);if(t.reactions){TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions}if(t.img_vids)_.forOwn(t.img_vids,function(e,t){if("img"===e.img_vid_type)TS.inline_imgs.makeInternalInlineImg(t,e);else if("video"===e.img_vid_type)TS.inline_videos.makeInternalInlineVideo(t,e)});if(t.imgs)_.forOwn(t.imgs,function(e,n){t.imgs[n].from_url=n;TS.inline_imgs.makeInternalInlineImg(n,e)});if(t.videos)_.forOwn(t.videos,function(e,n){t.videos[n].from_url=n;TS.inline_videos.makeInternalInlineVideo(n,e)});if("file_share"===t.subtype||"file_mention"===t.subtype||"file_comment"===t.subtype)if(t.file&&!t.file.id)TS.error("WTF no file id on file in imsg.subtype:"+t.subtype+" "+t.ts);else if(t.file){TS.files.upsertAndSignal(t.file);if("file_share"===t.subtype||"file_mention"===t.subtype);if("file_comment"===t.subtype)if(t.comment){var r=TS.files.getFileById(t.file.id);if(r)TS.files.addCommentToFile(t.comment,r);else TS.warn("WTF no file? id:"+t.file.id)}else TS.error("WTF no comment in imsg.subtype:"+t.subtype+" "+t.ts)}if("sh_room_created"===t.subtype||"sh_room_shared"===t.subtype)if(t.room&&!t.room.id)TS.error("WTF no room id on room in imsg.subtype:"+t.subtype+" "+t.ts);else if(t.room)TS.rooms.upsertAndSignal(t.room);else TS.error("WTF no room on imsg.subtype:"+t.subtype+" "+t.ts);if("pinned_item"===t.subtype)if("F"===t.item_type&&t.item&&t.item.id&&!t.item.is_deleted)TS.files.upsertAndSignal(t.item)},constructMsgPermalink:function e(t,n,r){if(!t)return"";var i;if(_.isString(t))i=t;else i=t.id;var a="/archives/"+i+"/p"+n.replace(".","");if(r&&r!==n)a+="?thread_ts="+r+"&cid="+i;return a},constructAbsoluteMsgPermalink:function e(t,n,r){var i=TS.boot_data.team_url.slice(0,-1)+TS.utility.msgs.constructMsgPermalink(t,n,r);return i},constructConversationPermalink:function e(t,n){var r;if(_.isString(t))r=t;else r=t.id;return"/conversation/"+r+"/p"+n.replace(".","")},isTempMsg:function e(t){return!t.ts||t.ts.indexOf(TS.utility.date.fake_ts_unique_padder)>-1},shouldMarkUnreadsOnMessageFetch:function e(t){if("1"==TS.qs_args.no_unread_marking_on_msgs_fetch)return false;var n;if(t){n=TS.shared.getActiveModelOb();if(!n||n.id!==t.id)return false}if(TS.pri&&n)TS.console.log(58,"shouldMarkUnreadsOnMessageFetch: returning TRUE for active model_ob of "+n.id);return true},ipsum:function e(){var e=["Build Something People Want","We know that we have built something which is genuinely useful: almost any team which adopts Slack as their central application for communication would be significantly better off than they were before.","That means we have something people want.","However, almost all of them have no idea that they want Slack.","How could they?","They’ve never heard of it.","And only a vanishingly small number will have imagined it on their own.","They think they want something different (if they think they want anything at all).","They definitely are not looking for Slack.","(But then no-one was looking for Post-it notes or GUIs either.)","Just as much as our job is to build something genuinely useful, something which really does make people’s working lives simpler, more pleasant and more productive, our job is also to understand what people think they want and then translate the value of Slack into their terms.","A good part of that is “just marketing,” but even the best slogans, ads, landing pages, PR campaigns, etc., will fall down if they are not supported by the experience people have when they hit our site, when they sign up for an account, when they first begin using the product and when they start using it day in, day out.","Therefore, “understanding what people think they want and then translating the value of Slack into their terms” is something we all work on.","It is the sum of the exercise of all our crafts.","We do it with copy accompanying signup forms, with fast-loading pages, with good welcome emails, with comprehensive and accurate search, with purposeful loading screens, and with thoughtfully implemented and well-functioning features of all kinds.","Marketing from Both Ends","Much has been written about “product-market fit” in the last few years, probably as a result of the popularity of the lean startup movement (though the idea has been around much longer).","The term refers to the degree to which a product could be successful, given sufficient promotion, appropriate pricing, adequate customer support and so on (before you find that fit, all the pushing in the world won’t get you up the hill).","In this classic post on Marc Andreessen’s old blog, he calls getting to product-market fit the “only thing that matters” for startups and offers a way of thinking about the life of the startup that divides it into two distinct phases: before product-market fit and after.","Once the product fits the market, a company is able to step on the gas, spending to promote a product that will actually sell.","The things you need to do before are very different from the things you need to do after (generally test & iterate vs scale & optimize).","We are right in the middle of that first phase.","It seems we are doing well and there are many encouraging signs, but we’re definitely still in the first phase and it is very, very hard to tell how far we have to go to cross over into the promised land (the last 10% is 90% of the work, etc.)","So, we should be working carefully from both the product end and the market end:","Doing a better and better job of providing what people want (whether they know it or not)","Communicating the above more and more effectively (so that they know they want it)","In the best case, there is a dialectic at play here: the product itself and the way people use it should suggest new ways of articulating the value — and refinements to how we communicate the value should lead to principles which clarify decision-making around product features and design.","Our position is different than the one many new companies find themselves in: we are not battling it out in a large, well-defined market with clear incumbents (which is why we can’t get away with “Other group chat products are poisonous. Slack is toasted.”).","Despite the fact that there are a handful of direct competitors and a muddled history of superficially similar tools, we are setting out to define a new market.","And that means we can’t limit ourselves to tweaking the product; we need to tweak the market too.","Sell the innovation, not the product","The best — maybe the only? — real, direct measure of “innovation” is change in human behaviour.","In fact, it is useful to take this way of thinking as definitional: innovation is the sum of change across the whole system, not a thing which causes a change in how people behave.","No small innovation ever caused a large shift in how people spend their time and no large one has ever failed to do so.","By that measure, Slack is a real and large innovation.","It is not as eye-catching as self-driving cars or implantable chips — it is not basic research-y kind of stuff.","But, for organizations that adopt it, there will be a dramatic shift in how time is spent, how communication happens, and how the team’s archives are utilized.","There will be changes in how team members relate to one another and, hopefully, significant changes in productivity.","We are unlikely to be able to sell “a group chat system” very well: there are just not enough people shopping for group chat system (and, as pointed out elsewhere, our current fax machine works fine).","That’s why what we’re selling is organizational transformation.","What we are selling is not the software product — the set of all the features, in their specific implementation — because there are just not many buyers for this software product.","(People buy “software” to address a need they already know they have or perform some specific task they need to perform, whether that is tracking sales contacts or editing video.)","However, if we are selling “a reduction in the cost of communication” or “zero effort knowledge management” or “making better decisions, faster” or “all your team communication, instantly searchable, available wherever you go” or “75% less email” or some other valuable result of adopting Slack, we will find many more buyers.","That’s why what we’re selling is organizational transformation.","The software just happens to be the part we’re able to build & ship (and the means for us to get our cut).","We’re selling a reduction in information overload, relief from stress, and a new ability to extract the enormous value of hitherto useless corporate archives.","We’re selling better organizations, better teams.","That’s a good thing for people to buy and it is a much better thing for us to sell in the long run.","We will be successful to the extent that we create better teams.","To see why, consider the hypothetical Acme Saddle Company.","They could just sell saddles, and if so, they’d probably be selling on the basis of things like the quality of the leather they use or the fancy adornments their saddles include; they could be selling on the range of styles and sizes available, or on durability, or on price.","Or, they could sell horseback riding.","Being successful at selling horseback riding means they grow the market for their product while giving the perfect context for talking about their saddles.","It lets them position themselves as the leader and affords them different kinds of marketing and promotion opportunities (e.g., sponsoring school programs to promote riding to kids, working on land conservation or trail maps).","It lets them think big and potentially be big.","Because the best possible way to find product-market fit is to define your own market.","This isn’t a new idea.","There are many brands whose marketing activities or positioning has them selling something other than (and usually larger than) their product: Harley Davidson sells motorcycle riding, but it especially sells freedom and independence.","Most luxury brands sell something that comes down to “being better than you are” (richer, better looking, more attractive to those you find desirable, etc.)","My favorite recent example is Lululemon: when they started, there was not a large market for yoga-specific athletic wear and accessories.","They sold yoga like crazy: helping people find yoga studios near their homes, hosting free classes, sponsorships and scholarships, local ambassadors and training, etc.","And as a result, they sold just under $1.4 billion worth of yoga-specific athletic wear and accessories in their most recent fiscal year.","But going back to the Acme Saddle Company, the better analogy to what we are doing now is to imagine them selling horseback riding … about 4,000 years ago.","It is almost inevitable that centralized internal communication systems will gradually replace email for most organizations over the next 10-20 years and we should do what we can to accelerate the trend and “own it”.","We are at the beginning of a transition.","We have an opportunity to both define the category and push hard for the whole market’s growth.","We’d be crazy not to take it, because the best possible way to find product-market fit is to define your own market."];return e},removeFileSharesAndMentions:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];if(("file_share"===i.subtype||"file_mention"===i.subtype)&&i.file&&i.file.id==n.id)if(t.is_mpim)TS.mpims.removeMsg(t.id,i);else if(t.is_group)TS.groups.removeMsg(t.id,i);else if(t.is_channel)TS.channels.removeMsg(t.id,i);else TS.ims.removeMsg(t.id,i)}},removeFileComments:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];if("file_comment"===i.subtype&&i.file&&i.file.id==n.id)if(t.is_mpim)TS.mpims.removeMsg(t.id,i);else if(t.is_group)TS.groups.removeMsg(t.id,i);else if(t.is_channel)TS.channels.removeMsg(t.id,i);else TS.ims.removeMsg(t.id,i)}},removeFileReferences:function e(t,n){if(!TS.client)return;var r=t.msgs;var i;for(var a=r.length-1;a>-1;a-=1){i=r[a];if(i.attachments){var s=TS.inline_attachments.getAttachmentBySlackFileId(i.attachments,n);if(s&&!s._slack_file_is_deleted){s._slack_file_is_deleted=true;delete s._slack_file;if(t.id==TS.model.active_im_id)TS.ims.message_changed_sig.dispatch(t,i);else if(t.id==TS.model.active_channel_id)TS.channels.message_changed_sig.dispatch(t,i);else if(t.id==TS.model.active_group_id)TS.groups.message_changed_sig.dispatch(t,i);else if(t.id==TS.model.active_mpim_id)TS.mpims.message_changed_sig.dispatch(t,i)}}}},updateFileMsgs:function e(t,n){var r=t.msgs;var i=!(r&&r.length)||TS.model.archive_view_is_showing&&t.is_channel&&false===t.is_member;r=i?t._archive_msgs:r;if(!r||!r.length)return;var a;var s=function e(t){if(!t)return false;if(!t.attachments)return false;if(!t.attachments.length)return false;if(TS.inline_attachments.getAttachmentBySlackFileId(t.attachments,n.id))return true;return false};for(var o=r.length-1;o>-1;o-=1){a=r[o];if(!n.is_deleted&&("file_share"===a.subtype||"file_mention"===a.subtype||"file_comment"===a.subtype)&&a.file&&a.file.id==n.id);else if(s(a));else continue;if(!n.is_tombstoned){if("hosted"===n.mode||"external"===n.mode||"snippet"===n.mode)if(n.comments.length||!n.is_tombstoned){if(t.id==TS.model.active_im_id)TS.ims.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_channel_id)TS.channels.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_group_id)TS.groups.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_mpim_id)TS.mpims.message_changed_sig.dispatch(t,a)}else continue;TS.view.rebuildMsgFile(a,n,i)}else if(t.id==TS.model.active_im_id)TS.ims.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_channel_id)TS.channels.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_group_id)TS.groups.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_mpim_id)TS.mpims.message_changed_sig.dispatch(t,a)}},updateCommentReferences:function e(t){if(!t)return;var n=TS.shared.getAllModelObsForUser();_.forEach(n,function(e){_.forEach(e.msgs,function(e){if(!e.file||e.file.id!==t.id)return;if(!e.comment)return;var n=_.find(t.comments,{id:e.comment.id});if(n)e.comment=n})})},tryToEditLastMsgFromShortcut:function e(t){var n=TS.shared.getActiveModelOb();if(!n)return;var r=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,n.msgs);if(!r){TS.sounds.play("beep");alert(TS.i18n.t("Found no recent messages from you to edit :(","msgs")());return}var i=TS.format.unFormatMsg(r.text,r);var a=TS.utility.msgs.wordReplace(i,t);if(i==a){TS.sounds.play("beep");return}TS.msg_edit.commitEdit(r,TS.shared.getActiveModelOb(),a)},getEditLastShortcutCmd:function e(t){var n=t.split("/");if(5!=n.length&&4!=n.length)return;if("s"!==n[1])return;var r=n[2];var i=n[3];var a=5==n.length&&("g"===n[4]||"gi"===n[4]||"ig"===n[4]);var s=5==n.length&&("i"===n[4]||"gi"===n[4]||"ig"===n[4]);if(!r)return;return{str:r,rpl:i,g:a,i:s}},wordReplace:function e(t,n){if(!n)return t;var r=(n.g?"g":"")+(n.i?"i":"");var i="[\\s\\n\\r\\t.,'\"+!?\\-_|]";var a=TS.utility.regexpEscape(n.str);var s=new RegExp("(^|"+i+"+)(?:"+a+")(?="+i+"+|$)",r);return t.replace(s,"$1"+n.rpl)},maybeTruncateMsgs:function e(t){if(!t)return;if(!t.msgs)return;if(!t.msgs.length)return;if(!TS.model.active_cid||!TS.shared.getActiveModelOb())return;var n=TS.model.initial_msgs_cnt+1;var r=Math.min(TS.model.hard_msg_limit,2*n);var i=1e3;var a=0;var s=2e4;var o=t.msgs;var l=TS.utility.msgs.getDisplayedMsgs(o);var u=Date.now();var d=t.has_fetched_history_after_scrollback?u-t.fetched_history_after_scrollback_time:u;if(l.length>r&&(t.id!=TS.shared.getActiveModelOb().id||t.scroll_top<i&&d>s))n=r;else{if(l.length-50<=n)return;if(t.last_made_active){var c=u-t.last_made_active;if(c<a)return}if(-1!=t.scroll_top)return}if(t.history_is_being_fetched)return;var _=[];while(TS.utility.msgs.getDisplayedMsgs(o).length>n)_.push(o.pop());if(t.is_limited){TS.info("Truncated "+t.id+" and reset is_limited");t.is_limited=false}if(t.id==TS.shared.getActiveModelOb().id)TS.view.removeMsgsAfterTruncation(_)},checkForMsgsToTruncate:function e(){if(!TS.model)return;if(!TS.model.channels)return;var t=TS.model.channels;var n;var r;for(r=0;r<t.length;r+=1){n=t[r];if(n.id==TS.model.active_channel_id)continue;if(!n.is_member)continue;if(n.is_archived)continue;TS.utility.msgs.maybeTruncateMsgs(n)}var i=TS.model.ims;var a;for(r=0;r<i.length;r+=1){a=i[r];if(a.id==TS.model.active_im_id)continue;TS.utility.msgs.maybeTruncateMsgs(a)}var s=TS.model.groups;var o;for(r=0;r<s.length;r+=1){o=s[r];if(o.id==TS.model.active_group_id)continue;if(o.is_archived)continue;TS.utility.msgs.maybeTruncateMsgs(o)}var l=TS.model.mpims;var u;for(r=0;r<l.length;r+=1){u=l[r];if(u.id==TS.model.active_mpim_id)continue;TS.utility.msgs.maybeTruncateMsgs(u)}},getEphemeralMsgsByCidAndType:function e(t,n){var r;var i=[];var a=TS.shared.getModelObById(t);if(!a)return i;_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,s){if(e.ephemeral_type==n&&e.c_id==t){r=TS.utility.msgs.getMsg(s,a.msgs);if(!r)return;i.push(r)}});return i},removeAllEphemeralMsgsByType:function e(t,n,r){var i;var a;_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,s){if(e.ephemeral_type==t){if(n&&n!=e.c_id)return;if(r&&r!=e.thread_ts)return;i=TS.shared.getModelObById(e.c_id);if(!i)return;a=TS.utility.msgs.getMsg(s,i.msgs);if(!a)return;if(i.is_im)TS.ims.removeMsg(i.id,a);else if(i.is_mpim)TS.mpims.removeMsg(i.id,a);else if(i.is_channel)TS.channels.removeMsg(i.id,a);else if(i.is_group)TS.groups.removeMsg(i.id,a);delete TS.utility.msgs.ephemeral_msgs_map[s]}})},hasImgs:function e(t){if(!t)return false;if(t.img_vids)_.forOwn(t.img_vids,function(e){if("img"===e.img_vid_type)return true});else if(t.attachments)for(var n=0;n<t.attachments.length;n+=1)if(t.attachments[n].image_url)return true;return false},ingestMessagesFromBootData:function e(t){if(!TS.boot_data.msgs)return;var n=TS.boot_data.msgs[t.id];var r=[];if(n){var i;for(var a=0;a<n.length;a+=1){i=n[a];if(!i.ts)continue;r.push(TS.utility.msgs.processImsg(i,t.id))}}TS.utility.msgs.setMsgs(t,r)},handleSearchHighlights:function e(t){return TS.format.replaceHighlightMarkers(t,'<span class="match">',"</span>")},findAllMsgsBySubtype:function e(t){var n;var r;var i;var a=TS.shared.getAllModelObsForUser();var s={};for(n=0;n<a.length;n+=1){i=a[n];if(!i.msgs)continue;for(r=0;r<i.msgs.length;r+=1){if(t!=i.msgs[r].subtype)continue;s[i.name]=s[i.name]||{id:i.id};s[i.name]["msg_index_"+r]=i.msgs[r]}}TS.info(JSON.stringify(s,null,"\t"))},handleFailedMsgSend:function e(t,n,r){var i=TS.utility.msgs.getMsg(t,n.msgs);if(i){var a;var s;if(r&&i.thread_ts){a=TS.utility.msgs.findMsg(i.thread_ts,n.id);s=i._was_reply_broadcast}if(n.is_mpim){TS.mpims.removeMsg(n.id,i);if(r)TS.mpims.sendMsg(n.id,TS.format.unFormatMsg(i.text,i),a,s)}else if(n.is_channel){TS.channels.removeMsg(n.id,i);if(r)TS.channels.sendMsg(n.id,TS.format.unFormatMsg(i.text,i),a,s)}else if(n.is_group){TS.groups.removeMsg(n.id,i);if(r)TS.groups.sendMsg(n.id,TS.format.unFormatMsg(i.text,i),a,s)}else{TS.ims.removeMsg(n.id,i);if(r)TS.ims.sendMsg(n.id,TS.format.unFormatMsg(i.text,i),a,s)}delete TS.model.unsent_msgs[i.ts];delete TS.model.display_unsent_msgs[i.ts]}else TS.error("no msg?: "+t)},msgMightBeRolledUp:function e(t){return t.subtype&&-1!=TS.model.join_leave_subtypes.indexOf(t.subtype)},msgRollUpWorker:function e(t,n,r,i){delete n._jl_rollup_hash;delete n._jl_rolled_up_in;if(!TS.utility.msgs.msgMightBeRolledUp(n))return;i.push(n);if(0!==t&&TS.utility.msgs.msgMightBeRolledUp(r[t-1]))return"continue";i[0]._jl_rollup_hash={msg_ids:[],users:{}};var a=i[0]._jl_rollup_hash;var s;for(var o=0;o<i.length;o+=1){s=i[o];a.users[s.user]=a.users[s.user]||{};var l=a.users[s.user];a.msg_ids.push(s.ts);s._jl_rolled_up_in=i[0].ts;if("channel_join"===s.subtype||"group_join"===s.subtype){l.inviter=s.inviter;l.joined=true;l.is_in=true}else if("channel_leave"===s.subtype||"group_leave"===s.subtype){l.left=true;l.is_in=false}}return"swap"},shouldHaveBotLabel:function e(t,n){var r=t.subtype&&"bot_message"===t.subtype&&"USLACKBOT"!==t.user;var i=n&&n.is_bot&&!n.is_slackbot;return r||i},checkConsistencyViaApi:function e(t){if(!TS.boot_data.feature_msg_consistency)return;if(!TS.model.ms_connected)return;var n=TS.shared.getModelObById(t);if(!n||!n.msgs||!n.msgs.length)return;if(n.is_archived)return;if(n.history_is_being_fetched)return;if(n._consistency_has_been_checked)return;if(n._consistency_is_being_checked)return;var r=TS.utility.msgs.getOldestValidTs(n);if(!r)return;var a=TS.utility.msgs.getMostRecentValidTs(n);var s="checkConsistencyViaApi for: "+t;n._consistency_is_being_checked=true;var o={channel:n.id,oldest:r,count:1e3,inclusive:true,ignore_replies:true,include_pin_count:true};if(a)o.latest=a;if(TS.has_pri[u])TS.log(u,s+", range = "+o.oldest+" -> "+(o.latest||"now"));TS.api.call(TS.shared.getHistoryApiMethodForModelOb(n),o).then(function(e){var r=TS.utility.msgs.checkConsistency(t,e.data.messages);if(r){i+=1;TS.metrics.store("inconsistent_history_cnt",i,{is_count:true});TS.error(s+" NOT GOOD!")}else{n._consistency_has_been_checked=true;if(TS.has_pri[u])TS.log(u,s+" all good!")}}).catch(function(e){TS.error(s+" err:"+e)}).finally(function(){n._consistency_is_being_checked=false})},checkConsistency:function e(t,n){var r=TS.shared.getModelObById(t);if(!r||!r.msgs||!r.msgs.length)return;var i=[];var a="checkConsistency for: "+t;if(TS.has_pri[u])TS.log(u,a+" from_msgs.length:"+n.length+" model_ob.msgs.length:"+r.msgs.length);n.forEach(function(e,n){if(!TS.utility.msgs.getMsg(e.ts,r.msgs)){e=TS.utility.msgs.processImsg(e,t);i.push(e);TS.error(a+" found and fixed an inconsistency at i:"+n+", ts="+e.ts)}});if(!i.length)return false;if(1==i.length){if(r.is_mpim)TS.mpims.addMsg(t,i[0]);else if(r.is_group)TS.groups.addMsg(t,i[0]);else if(r.is_im)TS.ims.addMsg(t,i[0]);else if(r.is_channel)TS.channels.addMsg(t,i[0])}else TS.shared.addMsgs(r,i);return true},filterHTMLForEmbeds:function e(n){if(!n)return n;var i;var a=new DOMParser;var s=a.parseFromString(n,"text/html")||a.parseFromString(n,"text/xml");var o="";var l;if(s)l=$(s.body);if(!l)return n;if(l){i=l.find(r);if(i.length)o=TS.utility.sanitizeHTML(i.first()[0].outerHTML,t,TS.utility.msgs.allowed_embed_attributes)}a=null;s=null;l=null;i=null;return o},areMsgsSameDay:function e(t,n){var r=TS.interop.datetime.toDateObject(t.ts);var i=TS.interop.datetime.toDateObject(n.ts);return TS.interop.datetime.isSameDay(r,i)},maybeCalcUnreadCnts:function e(t){if(!TS.client||!TS.client._should_defer_initial_msg_history)return;if(!t){TS.warn("maybeCalcUnreadCnts: WTF no model_ob?");return}if(t._needs_unread_recalc&&1==t.unread_cnt){var n=TS.shared.getControllerForModelOb(t);if(!n){TS.warn("maybeCalcUnreadCnts: WTF no controller for id "+t.id+"?");return}var r=false;n.calcUnreadCnts(t,r);t._needs_unread_recalc=false}},maybeSetPrevLastRead:function e(t,n){if(!t)return;var r=TS.utility.msgs.getMostRecentValidTs(t);if(n!=r)TS.utility.msgs.setPrevLastRead(t,n);else TS.utility.msgs.setPrevLastRead(t,t.last_read)},setPrevLastRead:function e(t,n){if(!t)return;if(!t._prev_last_read&&t.unread_cnt&&!TS.notifs.isCorGMuted(t.id))t._prev_last_read=n;else{var r=TS.utility.msgs.getMostRecentValidTs(t);var i=TS.utility.msgs.getMsg(r,t.msgs);if(i&&"pinned_item"===i.subtype)t._prev_last_read=n}},maybeClearPrevLastRead:function e(t){t=t||TS.shared.getActiveModelOb();if(t&&t._prev_last_read)t._prev_last_read=void 0},maybeClearUsersCountsInfo:function e(t){if(!t)return;if(!TS.shared.getUserCountsInfoById(t.id))return;if(TS.has_pri[d])TS.log(d,"Deleting users_counts_info for "+t.id);TS.shared.deleteUserCountsInfoForId(t.id)},isMsgReply:function e(t){if(!t)return false;return t.thread_ts&&t.thread_ts!=t.ts},msgHasReplies:function e(t){if(!t)return false;return t.ts===t.thread_ts&&!!t.reply_count},userRepliedToMsg:function e(t){if(!t||!t.replies)return false;var n=_.find(t.replies,function(e){return e.user===TS.model.user.id});return!!n},startUpdatingRelativeTimestamps:function e(t){s.start(t)},stopUpdatingRelativeTimestamps:function e(t){s.stop(t)},shouldHideChannelJoinOrLeaveMsg:function e(t,n){if(!TS.boot_data.feature_hide_join_leave)return false;var r=TS.members.getMemberById(t.user);var i=_.get(r,"is_bot",false);if("channel_join"===t.subtype||"member_joined_channel"===t.type){var a=_.isObject(n)?n:TS.channels.getChannelById(n);if(!a)return false;var s=_.includes(TS.model.team.prefs.default_channels,a.id);var o=!!t.inviter;var l=a.num_members;if(_.isUndefined(a.num_members)){var u=TS.membership&&TS.membership.getMembershipCounts(a);if(u.counts)l=_.get(u,"counts.member_count")}var d=_.isUndefined(l)?false:l>20;if(!i&&!s&&!o&&d)return true}else if("channel_leave"===t.subtype||"member_left_channel"===t.type)if(!i)return true;return false},extractMsgDisplayContext:function e(t){var n=t.closest("#unread_msgs_div, #sli_briefing");if(n.is("#unread_msgs_div"))return"all_unreads";if(n.is("#sli_briefing"))return"briefing";return null},extractLinkType:function e(t,n,r){if(n.data("member-id")||t.data("member-id"))return"user";if(n.data("channel-id")||t.data("channel-id"))return"channel";if(n.data("file-id")||t.data("file-id"))return"file";if(r&&r.match(/\.slack\.com\/archives\//))return"message";var i=r&&!TS.utility.url.getHostName(r).match(/\.slack\.com/);if(i)return"external";return"internal"},extractLinkItemId:function e(t,n,r){if("user"===r)return n.data("member-id")||t.data("member-id");if("channel"===r)return n.data("channel-id")||t.data("channel-id");if("file"===r)return n.data("file-id")||t.data("file-id");return null},extractLinkAction:function e(t,n){if(n.hasClass("file_preview_action")){if(n.hasClass("file_ssb_download_link"))return"file_ssb_download_link";else if(n.hasClass("file_new_window_link"))return"file_new_window_link";else if(n.hasClass("file_comment_link"))return"file_comment_link";return"file_preview_action"}if(t.hasClass("file_viewer_external_link"))return"file_viewer_external_link";if(t.hasClass("file_viewer_link"))return"file_viewer_link";if(n.hasClass("file_preview_link"))return"file_preview_link";if(n.hasClass("file_header"))return"file_header";if(n.parent()&&n.parent().hasClass("rest_text_expander"))return"rest_text_expander";return null},extractLinkAttachmentField:function e(t){var n=t.parent();if(n.hasClass("attachment_source_icon"))return"attachment_source_icon";if(n.hasClass("attachment_source_name"))return"attachment_source_name";if(n.hasClass("attachment_author_name"))return"attachment_author_name";if(n.hasClass("attachment_title"))return"attachment_title";return null},isRawLink:function e(t,n){if(!t||!n)return false;if(!t.is("a"))return false;var r=n.replace(/(^\w+:|^)\/\//,"");return t.text()===n||t.text()===r},charsOverLimit:function e(t,n){if(!_.isNumber(n))n=TS.interop.constants.MAX_MESSAGE_INPUT_BYTES;if(t.length<=n/4)return 0;var r=0;var i=[];var a=0;for(var s=0;s<t.length;s++){var o=t.charCodeAt(s);if(o<55296||o>57343){i.push(o);r+=TS.utility.bytesInUnicodeCodePoint(o)}if(o>=56320&&o<=57343){i.push(65533);r+=1}if(o>=55296&&o<=56319)if(s==t.length-1){i.push(65533);r+=1}else{var l=t.charCodeAt(s+1);if(l>=56320&&l<=57343){var u=1023&o;var d=1023&l;var c=66560+u+d;i.push(c);r+=TS.utility.bytesInUnicodeCodePoint(c);s+=1}else{i.push(65533);r+=1}}if(r<=n)a=i.length}return i.length-a},getUnreadMsgTimestampsWithoutHighlights:function e(t){if(!t||!t.unread_cnt)return[];var n=parseFloat(t.last_read);return _.reduce(t.msgs,function(e,r){if(parseFloat(r.ts)>n&&!TS.client.highlights.msgIsHighlight(t.id,r.ts)&&!TS.client.highlights.isMsgBeingRequested(t.id,r.ts))e[r.ts]=true;return e},{})},shouldSendSlashCommand:function e(t){if("/"===t.substr(0,1)&&"//"!==t.substr(0,2))return true;if("／"===t.substr(0,1))return true;return false}});var e=false;var t=["video","iframe","source"];var r=t.join(",");var i=0;var a={};var s=function(){var e=null;var t=[];function n(n){if(_.includes(t,n))return;t.push(n);if(null===e)e=setInterval(i,6e4)}function r(n){_.pull(t,n);if(!t.length){clearInterval(e);e=null}}function i(){_.forEach(t,function(e){$(e).find(".relative_ts").each(function(){var e=$(this).attr("data-ts");var t=$(this).data("really-short");var n=TS.interop.datetime.toTimeAgo(e,{compact:t});if(n!==$(this).text())$(this).text(n)})})}return{start:n,stop:r}}();var o=67;var l=667;var u=773;var d=888})()},4249:function(e,t){(function(){"use strict";TS.registerModule("utility.members",{checkMemberMatch:function e(t,n,r){if(TS.boot_data.feature_name_tagging_client)return!r&&t.profile&&t.profile.email&&t.profile.email.match(n)||t.profile&&t.profile.real_name_normalized&&t.profile.real_name_normalized.match(n)||t.profile&&t.profile.real_name&&t.profile.real_name.match(n)||t.profile&&t.profile.display_name_normalized&&t.profile.display_name_normalized.match(n)||t.profile&&t.profile.display_name&&t.profile.display_name.match(n);return t.name&&t.name.match(n)||!r&&t.profile&&t.profile.email&&t.profile.email.match(n)||t.profile&&t.profile.real_name_normalized&&t.profile.real_name_normalized.match(n)||t.profile&&t.profile.real_name&&t.profile.real_name.match(n)},filterMembersByQuery:function e(t,n){n=_.toString(n).trim().toLowerCase().replace(/^@/,"");if(!n)return t;var r=new RegExp(TS.utility.regexpEscape(n),"i");return t.filter(function(e){return TS.utility.members.checkMemberMatch(e,r)})},getBroadcastKeywordsForUser:function e(){var t=TS.shared.getActiveModelOb();if(!t)return[];var n=[];var r=[];var i=TS.boot_data.page_needs_enterprise&&TS.channels.isChannelRequired(t)&&t.is_shared;if(t.is_general&&TS.permissions.members.canAtMentionEveryone(t.id)&&!i)n=_.filter(TS.model.BROADCAST_KEYWORDS,function(e){return"BKeveryone"===e.id||"BKall"===e.id});if(TS.permissions.members.canAtChannelOrGroup(t.id)&&(t.is_channel||t.is_group)&&(!t.is_general||TS.permissions.members.canAtMentionEveryone(t.id))&&!i)r=_.filter(TS.model.BROADCAST_KEYWORDS,function(e){return"BKchannel"===e.id||"BKgroup"===e.id||"BKhere"===e.id});return n.concat(r)},isMember:function e(t){var n=_.get(t,"id[0]");return"U"===n||"W"===n},isMemberRelevantToModel:function e(t,n){if(!_.isObject(t))t=TS.members.getMemberById(t);if(!t)return false;if(t.is_slackbot)return true;if(t.deleted)return false;if(!_.isObject(n))n=TS.shared.getModelObById(n)||TS.shared.getActiveModelOb();if(TS.boot_data.page_needs_enterprise&&n&&!n.is_shared)return t._is_local;return true},isMemberElement:function e(t){if(t.hasAttribute("data-member-id"))return true;if(t.hasAttribute("data-member-name"))return true;if(t.classList.contains("internal_member_link"))return true;return false},isMemberNonBotNonDeletedNonSelf:function e(t){var n=t&&!t.deleted&&!t.is_bot&&!t.is_slackbot;return n&&!t.is_self},getEntityFromMessage:function e(t){if(!t)return false;var n;if("USLACKBOT"===t.user&&t.file&&t.file.bot_id)n=TS.utility.members.getEntityFromFile(t.file);else n=t.comment?TS.members.getPotentiallyUnknownMemberById(t.comment.user):TS.members.getPotentiallyUnknownMemberById(t.user);return n},getUsernamesMentionedInString:function e(t){var n=_.toLower(t).match(/\B@\w+/g);if(!n)return[];return _(n).map(function(e){return e.replace(/^@/,"")}).uniq().compact().value()},getEntityFromFile:function e(t){if(!t)return false;var n;if("USLACKBOT"===t.user&&t.bot_id){n=TS.bots.getBotById(t.bot_id);if(!n)n={};n.is_bot=true;n.is_service=true}else n=TS.members.getPotentiallyUnknownMemberById(t.user);return n}})})()},4250:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("utility",{onStart:function e(){TS.utility.makeRefererSafeLink=_.memoize(TS.utility.makeRefererSafeLink);if(TS.useSocket())if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(TS.utility.resetRefererSafeLinkCache);else TS.ms.connected_sig.add(TS.utility.resetRefererSafeLinkCache);if(TS.prefs&&TS.prefs.team_hide_referers_changed_sig)TS.prefs.team_hide_referers_changed_sig.add(TS.utility.resetRefererSafeLinkCache);i=TS.i18n.t("me","utility")();a=TS.i18n.t("you","utility")()},keymap:{alt:18,ctrl:17,cmd_ff:224,cmd_other:91,cmd_right:93,esc:27,shift:16,tab:9,del:8,delete:46,enter:13,left:37,up:38,right:39,down:40,pageup:33,pagedown:34,end:35,home:36,space:32,semicolon:59,equals_sign:187,minus_sign:189,comma:188,period:190,left_square_bracket:219,right_square_bracket:221,V:86,a:65,e:69,b:66,k:75,i:73,z:90,y:89,insert:45},email_regex:new RegExp("^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$","i"),regexpEscape:function e(t,n){n=Math.min(n||5e5,5e5);if(t.length>n)t=t.slice(0,n);return _.escapeRegExp(t)},ensureInArray:function e(t,n){if(t.indexOf(n)>-1)return false;t.push(n);return true},compareVersions:function e(t,n){if(!t.major)t.major=0;if(!t.minor)t.minor=0;if(!n.major)n.major=0;if(!n.minor)n.minor=0;if(t.major===n.major){if(t.minor==n.minor)return 0;return t.minor>n.minor?1:-1}return t.major>n.major?1:-1},makeComparableVersion:function e(t){var n=t.split("-")[0];return _.reduce(n.split("."),function(e,t){return 1e3*e+parseInt(t,10)},0)},compareSemanticVersions:function e(t,n){var r=TS.utility.makeComparableVersion(t);var i=TS.utility.makeComparableVersion(n);if(r===i)return 0;return r>i?1:-1},isAppVersionBefore:function e(t){if(!TS.model.is_our_app){if("dev"===TS.boot_data.version_ts)throw new Error("Cannot check app version because we are not in the app, silly goose.");return false}return-1===TS.utility.compareSemanticVersions(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch,t)},doRectsOverlap:function e(t,n){return!(n.left>t.right||n.right<t.left||n.top>t.bottom||n.bottom<t.top)},doesRectContainRect:function e(t,n,r,i){r=r||0;if(n.top<t.top-r)return false;if(n.bottom>t.bottom+r)return false;if(i)return true;if(n.left<t.left-r)return false;if(n.right>t.right+r)return false;return true},shouldLinksHaveTargets:function e(){return!!(TS.client||TS.web&&TS.web.space)},parseJSONOrElse:function e(t,n){if(""===t)return n;try{return JSON.parse(t)}catch(e){return n}},stringifyJSONOrElse:function e(t,n,r,i){try{return JSON.stringify(t,n,r)}catch(e){if("function"===typeof i)return i(e);return i}},ordinalNumber:function e(t){return TS.i18n.t("{number_str, selectordinal, one{#st}two{#nd}few{#rd}other{#th}}","utilities")({number_str:t.toString()})},getChannelStringIdentifierForUrl:function e(t){var n=t.id;var r=t.name;var i=t.is_im;if((TS.boot_data.feature_shared_channels_client||TS.boot_data.feature_name_tagging_client)&&(i||t.is_mpim))return n;if(t.is_channel||t.is_group)return n;if(i)return"@"+r;return r},getChannelNameFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r="messages"==n[0]||"archives"==n[0];if(!r)return"";return decodeURIComponent(n[1])},getMessageTimestampFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r="messages"==n[0]||"archives"==n[0];if(!r)return"";var i=n[2];if(!i||"p"!=i[0]||17!=i.length)return"";i=i.substr(1,10)+"."+i.substr(11);return decodeURIComponent(i)},getFlexNameFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r={messages:true,archives:true}[n[0]];var i=r?2:1;var a=n[i];if(!a)return"";return decodeURIComponent(a)},getFlexExtraFromUrl:function e(t){var n=TS.utility.getPathFromSlackUrl(t);if(!n)return"";var r={messages:true,archives:true}[n[0]];var i=r?3:2;var a=n[i];if(!a)return"";return decodeURIComponent(a).replace(/%2F/g,"/")},isUnreadViewPath:function e(t){return 0===t.indexOf("/unreads")},isThreadsViewPath:function e(t){return 0===t.indexOf("/threads")},isAppSpaceViewPath:function e(t){return 0===t.indexOf("/app-space")},isSlackUrl:function e(t){return g.test(t)},getPathFromSlackUrl:function e(t){var n=t.match(g);var r=TS.boot_data.feature_cross_team_deeplink?2:1;var i=n&&n[r];if(!i)return;var a=t.split(i);var s=a[1].split("?")[0];return(i+s).split("/")},getTeamFromSlackUrl:function e(t){var n=t.match(g);var r=n&&n[1];return r},refashionUrl:function e(t,n,r,i){var a=t.split(/\.com\/+(messages|unreads|threads|app-space)/);var s=a[0]+".com";var o=a[2].split("?");var l=o[1]?"?"+o[1]:"";var u=[n,r,i].filter(function(e){return e}).join("/")+"/";return s+u+l},dataURItoBlob:function e(t){return TS.utility.base64StrtoBlob(TS.utility.base64StrFromDataURI(t))},base64StrFromDataURI:function e(t){return t.split(",")[1]},base64StrtoBlob:function e(t){var n=atob(t);var r=new ArrayBuffer(n.length);var i=new Uint8Array(r);for(var a=0;a<n.length;a+=1)i[a]=n.charCodeAt(a);var s=new DataView(r);var o=new Blob([s]);return o},ellipsize:function e(t,n){if(!t)return t;if(!n||!parseInt(n,10))n=50;if(t.length>n){var r=t.substr(0,n/2);var i=t.substr(-n/2,t.length);t=r+"..."+i}return t},makeSafeForDomId:function e(t){return String(t).replace(/\./g,"_")},makeSafeForDomClass:function e(t){return t.replace(/\s/g,"_")},getImageIconClass:function e(t,n){var r=n;var i=80;var a=80;if(t&&(t.thumb_360_w<i||t.thumb_360_h<a))if(t.thumb_360_w>t.thumb_360_h)r="landscape";else if(t.thumb_360_w<t.thumb_360_h)r="portrait";else r="square";return r},getAppliedClasses:function e(t){return _.reduce(t,function(e,t,n){if(t)e.push(n);return e},[]).join(" ")},convertFilesize:function e(t,n,r){if(0===t)return r?"0 bits":"0 bytes";var i=r?1024:1e3;if(Math.abs(t)<i)return t+"B";var a=r?["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]:["kB","MB","GB","TB","PB","EB","ZB","YB"];var s=-1;do{t/=i;s+=1}while(Math.abs(t)>=i&&s<a.length-1);return n?t.toFixed(n)+a[s]:Math.round(t)+a[s]},numberWithCommas:function e(t){var n=TS.i18n.locale();var r=TS.i18n.locales_number_formatting[n]||TS.i18n.locales_number_formatting.default;if(void 0===t||null===t)return"";var i=t.toString().split(".");i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,r.thousands_separator);return i.join(r.decimal_symbol)},numberWithK:function e(t){if(t>999){t=Math.round(t/1e3*10)/10;return TS.utility.numberWithCommas(t)+"K"}return TS.utility.numberWithCommas(t)},cleanChannelName:function e(t){var n=XRegExp("[^\\pL\\pM\\pN_-]+","g");var r=XRegExp("[\\pM\\pM\\pM]","g");var i=/^[-_]+?$/;t=t.toLowerCase();t=t.replace(/^#+/g,"");t=t.replace(/ /g,"-");t=t.replace(n,"_");t=t.replace(/-+/g,"-");t=t.replace(/_+/g,"_");if(i.test(t)||r.test(t))return null;return t},openInNewTab:function e(t,n){if(0===t.indexOf("/")&&TS.boot_data.team_url){var r=TS.boot_data.team_url;r=r.substr(0,r.length-1);t=r+t}var i=t;var a="";var s=i.indexOf("?");var o=TS.utility.urlNeedsRefererHiding(t);if(-1!==s){if(o)t=_.escape(t.substring(0,s));var l=i.substring(s+1,i.length);i=i.substring(0,s);if(l.length){var u=TS.utility.url.queryStringParse(l);_.forEach(u,function(e,n){if(o)t=TS.utility.url.setUrlQueryStringValue(t,n,e||"");else a+='<input type="hidden" name="'+_.escape(n)+'" value="'+_.escape(e||"")+'">'})}}if(o){a='<input type="hidden" name="url" value="'+_.escape(t)+'">';i="https://"+TS.boot_data.redir_domain+"/link"}$("<form>"+a+"</form>").attr({method:"GET",action:i,target:n}).appendTo("body").submit().remove()},isScalar:function e(t){return/boolean|number|string/.test("undefined"===typeof t?"undefined":n(t))},sanitizeHTML:function t(n,r,i,a){var s=function e(t){var n=t.tagName.toLowerCase();if(r.indexOf(n)<0)return null;Array.prototype.slice.apply(t.attributes).forEach(function(e){if(i.indexOf(e.name)<0)t.attributes.removeNamedItem(e.name)});Array.prototype.slice.apply(t.children).forEach(function(n){var r=e(n);if(!r)t.removeChild(n)});return t};e=e||new DOMParser;var o=e.parseFromString(n,"text/html")||e.parseFromString(n,"text/xml");var l=o.body;if(1!=l.children.length)return"";var u=s(l.children[0]);l=null;o=null;if(u)return a?u:u.outerHTML;return""},getChildTextNodes:function e(t){var n=[];if(!t)return n;if(t instanceof Text){n.push(t);return n}var r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,false);var i=r.nextNode();while(i){n.push(i);i=r.nextNode()}return n},getAttributesFromHTMLString:function t(n){e=e||new DOMParser;var r=e.parseFromString(n,"text/html")||e.parseFromString(n,"text/xml");var i=r.body;if(1!=i.children.length)return{};var a={};[].slice.apply(i.children[0].attributes).forEach(function(e){a[e.name]=e.value});i=null;r=null;return a},findUrls:function e(t){return t.match(c)||[]},linkify:function e(t,n,r,i){if(!t)return t;t=t.replace(c,function(e){var t;if(0===e.toLowerCase().indexOf("www.")){if(!r)return e;t="http://"+e}else t=e;if(i)return"<"+t+"|"+e+">";return"<a "+TS.utility.makeRefererSafeLink(t)+' target="'+(n||"")+'">'+e+"</a>"});return t},linkifyInternal:function e(t,n){return TS.utility.linkify(t,"",n,true)},getCursorPosition:function e(t){if(TS.utility.contenteditable.supportsTexty()){if(_.isString(t))t=$(t);return TS.utility.contenteditable.cursorPosition(t)}var n;var r;var i;if(t instanceof HTMLElement)n=t;else n=$(t).get(0);r={start:0,end:0,length:0};if("selectionStart"in n){r.start=n.selectionStart;r.end=n.selectionEnd;r.length=Math.abs(n.selectionEnd-n.selectionStart)}else if("selection"in document){n.focus();i=document.selection.createRange();r.length=document.selection.createRange().text.length;i.moveStart("character",-n.value.length);r.start=i.text.length-r.length;r.end=r.start+r.length}return r},setCursorPosition:function e(t,n,r){if(TS.utility.contenteditable.supportsTexty()){if(_.isString(t))t=$(t);return TS.utility.contenteditable.cursorPosition(t,n,r)}var i;var a;i=$(t).get(0);if(i)if(i.setSelectionRange){i.focus();if(r)i.setSelectionRange(n,n+r);else i.setSelectionRange(n,n)}else if(i.createTextRange){a=i.createTextRange();if(r){a.moveStart("character",n);a.moveEnd("character",r-n)}else a.move("character",n);a.select()}},preg_quote:function e(t){return(""+t).replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1")},getActiveElementProp:function e(t){if(!document.activeElement)return"";if("NODENAME"===t){if(!document.activeElement.nodeName)return"";return document.activeElement.nodeName.toUpperCase()}return document.activeElement[t]},isTabCompleteShowing:function e(){if(!TS.utility.isFocusOnInput())return false;var t=$(document.activeElement);if(!t.tab_complete_ui)return false;if(!t.tab_complete_ui("instance"))return false;if(t.tab_complete_ui("isShowing")||t.tab_complete_ui("wasJustHidden"))return true;return false},isFocusOnInput:function e(){var t=TS.utility.getActiveElementProp("NODENAME");if(""==t)return false;if("INPUT"===t)return true;if("TEXTAREA"===t)return true;if("SELECT"===t)return true;if(TS.utility.contenteditable.isContenteditable(document.activeElement))return true;return false},unformatTopicOrPurpose:function e(t){if(TS.boot_data.feature_name_tagging_client)return TS.format.unFormatMsg(t);return t},formatTopicOrPurpose:function e(t,n){if(TS.boot_data.feature_name_tagging_client){t=TS.format.formatWithOptions(t,{},{no_preformatted:!!n});t=t.replace(/(<br[^>]*>)/,'<span class="hidden br_ellipsis">…</span>$1');return t}t=TS.format.unFormatMsg(t);t=TS.format.cleanMsg(t);t=TS.utility.linkifyInternal(t,true);t=TS.format.formatWithOptions(t,{},{no_preformatted:!!n});t=t.replace(/(<br[^>]*>)/,'<span class="hidden br_ellipsis">…</span>$1');return t},removeLinksFromTabFlow:function e(t){return t.replace(S,'$1 tabindex="-1"$2')},populateInput:function e(t,n,r){if(!n)n="";var i=$(t);TS.utility.contenteditable.value(i,n);if(_.isNumber(r))TS.utility.contenteditable.cursorPosition(i,r);if(!TS.utility.contenteditable.supportsTexty()){i.data("textchange_lastvalue",n);i.trigger("autosize").trigger("autosize-resize");i.trigger("textchange")}},populateThreadInputs:function e(t,n,r){if(TS.ui.replies.activeConvoModelId()===n&&TS.ui.replies.activeConvoThreadTs()===r)TS.ui.replies.populateReplyInput(t);if(TS.model.threads_view_is_showing)TS.ui.thread.findAndPopulateInput(t,n,r)},urlNeedsRefererHiding:function e(t){if(!t)return false;t=t.toLowerCase();if(0!==t.indexOf("https://")&&0!==t.indexOf("http://")&&0!==t.indexOf("ftp://")&&0!==t.indexOf("sftp://"))return false;var n=true;var r=TS.utility.url.getHostName(t,n);var i=getRefererHidingWhiteList();if(i&&i.indexOf&&-1!==i.indexOf(r))return false;return true},referer_safe_url_map:{},makeRefererSafeLink:function e(t){if("string"!==typeof t){TS.error("Expected url to be a string, got: "+("undefined"===typeof t?"undefined":n(t)));return}t=TS.format.replaceHighlightMarkers(t);var r=t.replace(/&amp;/g,"&");if(r.match(/javascript:/gi))r="#";var i=true;var a=TS.utility.sanitizeHTML('<a href="'+r+'"></a>',["a"],["href"],i)||null;if(a)r=a.href;r=_.escape(r);r=r.replace(/&amp;/g,"&");if(t&&t.lastIndexOf("/")!==t.length-1)if(r&&r.lastIndexOf("/")===r.length-1)r=r.slice(0,-1);r=r||"#";var s='href="'+r+'"';var o="onclick";var l=u();if(!TS.model||!TS.model.is_our_app)if(l&&l.rewrite_on_right_click)o="onmousedown";if(!TS.utility.urlNeedsRefererHiding(t))return s;if(TS.utility.externalURLsNeedRedirecting()){var d=encodeURIComponent(r);var c="https://"+TS.boot_data.redir_domain+"/link?url="+d+(l&&l.redirect_type?"&v="+l.redirect_type:"");var m=_.escape(d);TS.utility.referer_safe_url_map[m]=r;s+=' data-referer-safe="1" '+o+'="this.href=&quot;'+c+'&quot;" onmouseover="this.href=TS.utility.referer_safe_url_map[&quot;'+m+'&quot;]" data-referer-original-href="'+r+'" rel="noreferrer"'}else s+=' rel="noreferrer"';return s},resetRefererSafeLinkCache:function e(){if(TS.utility.makeRefererSafeLink&&TS.utility.makeRefererSafeLink.cache)TS.utility.makeRefererSafeLink.cache.clear()},makeSureAllExternalLinksAreRefererSafe:function e(t){var n=Date.now();var r=[];if(TS.utility.externalURLsNeedRedirecting()){t.find("a[href]:not([data-referer-safe])").each(function(){var e=$(this);var t=e.attr("href");if(!TS.utility.urlNeedsRefererHiding(t))return;r.push(this.outerHTML);e.removeAttr("href");var n=this.outerHTML.replace("<a",function(){return"<a "+TS.utility.makeRefererSafeLink(t)+" "});e.replaceWith(n);r[r.length-1]+="\n->\n"+n});if(TS.model&&TS.model.team&&TS.has_pri[v]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(v,"#"+t.attr("id")+" had "+r.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to fix it took "+(Date.now()-n)+"ms");TS.dir(v,r)}else TS.log(v,"#"+t.attr("id")+" had "+r.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to check it took "+(Date.now()-n)+"ms")}else{t.find("a[href]:not([rel])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){if(TS.utility.urlNeedsRefererHiding(t)){r.push(this.outerHTML);e.attr("rel","noreferrer");r[r.length-1]+="\n->\n"+this.outerHTML}}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[v]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(v,"#"+t.attr("id")+" had "+r.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to add rel it took '+(Date.now()-n)+"ms");TS.dir(v,r)}else TS.log(v,"#"+t.attr("id")+" had "+r.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to check it took '+(Date.now()-n)+"ms")}},makeSureAllLinksHaveTargets:function e(t){var n=Date.now();var r=[];t.find("a[href]:not([target])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){r.push(this.outerHTML);e.attr("target",t);r[r.length-1]+="\n->\n"+this.outerHTML}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[v]&&TS.boot_data.feature_tinyspeck)if(r.length){TS.log(v,"#"+t.attr("id")+" had "+r.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to add targets it took "+(Date.now()-n)+"ms");TS.dir(v,r)}else TS.log(v,"#"+t.attr("id")+" had "+r.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to check it took "+(Date.now()-n)+"ms");TS.utility.makeSureAllExternalLinksAreRefererSafe(t)},sortTable:function e(t,n,r,i,a){r="desc"===r?"desc":"asc";a="desc"===a?"desc":"asc";function s(e){return function(t,n){var s=o(t,e);var l=o(n,e);if($.isNumeric(s)&&$.isNumeric(l)){if(s==l&&i){s=o(t,i);l=o(n,i);if($.isNumeric(s)&&$.isNumeric(l)){if(a!=r)return l-s;return s-l}if(a!=r)return TS.i18n.sorter(l,s);return TS.i18n.sorter(s,l)}return s-l}return TS.i18n.sorter(s,l)}}function o(e,t){return $(e).children("td").eq(t).attr("data-sort-val")}var l=t.find("tr:gt(0)").toArray().sort(s(n));if("desc"===r)l=l.reverse();for(var u=0;u<l.length;u+=1)t.append(l[u])},getPercSmartly:function e(t,n){if(!t||!n)return"0%";var r=t/n*100;if(100!=r&&100==Math.round(r))return"99%";if(r<.7)return"<1%";return Math.round(r)+"%"},isCursorWithinTBTs:function e(t){var n=TS.utility.contenteditable.cursorPosition(t);var r=TS.utility.contenteditable.value(t);var i=r.substr(0,n.end);var a=i.match(/```/g);if(!a)return false;var s=a.length;if(s%2)return true;return false},hex2rgb:function e(t){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:void 0},rgb2hex:function e(t){if(/^#[0-9A-F]{6}$/i.test(t))return t;var n=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(!n)n=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.?\d+)\)$/);if(!n)return;function r(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}return"#"+r(n[1])+r(n[2])+r(n[3])},setImmediate:function e(t){m(t)},immediateDebounce:function e(t){var n=false;return function(){if(n)return;var e=this;var r=arguments;n=true;m(function(){n=false;t.apply(e,r)})}},debounce:function e(t,n){var r;return function(){var e=this;var i=arguments;clearTimeout(r);r=setTimeout(function(){t.apply(e,i)},n)}},debounceWithPromise:function e(t,n){var r;return function(){var e=this;var i=arguments;if(r)r.cancel();r=new Promise(function(e){setTimeout(e,n)}).then(function(){return t.apply(e,i)});return r}},throttleFunc:function e(t,n,r){var i={};var a=function e(){var r=Array.prototype.slice.apply(arguments);var a=_.some(r,_.isObject);if(a)TS.error("You're passing non-scalar arguments to a function throttled with TS.utility.throttleFunc; it will likely not work as you want");var s="f-"+r.join("-");if(i[s]&&i[s].context!==this)throw new Error("Cannot use this function with different `this` contexts across different calls "+this+" "+i[s].context);i[s]=i[s]||{requested:Date.now(),timeout:0,context:this};if(i[s].timeout||e.always_wait)i[s].requested=Date.now();else t.apply(i[s].context,r);if(i[s].timeout)return;i[s].timeout=setTimeout(function e(){var a=Date.now()-i[s].requested;if(a>=n){t.apply(i[s].context,r);delete i[s]}else i[s].timeout=setTimeout(e,n-a)},n)};a.always_wait=!!r;return a},cmdKey:function e(t){if(!t)return false;if(TS.model.is_mac)return!!t.metaKey;return!!t.ctrlKey},looksLikeKeyboardShortcut:function e(t){var n=t.ctrlKey||t.altKey||t.metaKey;if(!n)return false;if(t.keyCode===TS.utility.keymap.alt||t.keyCode===TS.utility.keymap.ctrl||t.keyCode===TS.utility.keymap.cmd_ff||t.keyCode===TS.utility.keymap.cmd_other||t.keyCode===TS.utility.keymap.cmd_right)return false;var r=String.fromCharCode(t.keyCode);if(/^(\w|[$-/:-?{-~!"^_`[\]])$/i.test(r))return true;return true},isForwardDeleteKey:function e(t){if(t.keyCode===TS.utility.keymap.delete)return true;if(TS.model.is_mac&&t.ctrlKey&&"d"===t.key)return true;return false},isBoldKey:function e(t){if(!t)return false;return t.keyCode===TS.utility.keymap.b&&TS.utility.cmdKey(t)},isItalicKey:function e(t){if(!t)return false;return t.keyCode===TS.utility.keymap.i&&TS.utility.cmdKey(t)},throttle:function(){var e;var t;e={delay:200,timer_group:"generic"};t={timers:{},queues:{}};function n(e){var n;var r;if(t.timers[e]){if(t.queues[e])for(n=0,r=t.queues[e].length;n<r;n+=1)if(t.queues[e][n])t.queues[e][n]();t.queues[e]=null;t.timers[e]=null}}function r(r,i,a){if(!r)return false;i=i||e.timer_group;if(!t.timers[i]){a=a||e.delay;t.timers[i]=window.setTimeout(function(){n(i)},a)}if(!t.queues[i])t.queues[i]=[];if(t.queues[i].indexOf){if(-1===t.queues[i].indexOf(r))t.queues[i].push(r)}else t.queues[i].push(r)}return{method:r}}(),getImgProxyURL:function e(t,n,r){return TS.utility.getImgProxyURLWithOptions(t,{width:n,height:r})},getImgProxyURLWithOptions:function e(t,n){if(!t)return t;if(!TS.boot_data.image_proxy_url)return t;var r=TS.boot_data.image_proxy_url;if(0===t.indexOf(r))return t;var i=getRefererHidingWhiteList();var a;if(!n.emoji&&0===t.indexOf("https://")){a=t.replace(/^https:\/\//,"");var s=true;var o=TS.utility.url.getHostName(t,s);if(i&&-1!==i.indexOf(o)){if(n.stop_animations&&"slack-imgs.com"===o){var l=TS.utility.url.urlQueryStringParse(a).o1;var u;if(n.stop_animations||false===TS.model.prefs.a11y_animations)u=l?l+".gu":"gu";else u=l&&l.replace(/\.gu|gu/,"");return TS.utility.url.setUrlQueryStringValue(t,"o1",u)}return t}}if(0===t.indexOf("/img/"))return t;if(TS.boot_data.feature_imgproxy_multicloud)r+="/mc";r=TS.utility.url.setUrlQueryStringValue(r,"c","1");var d=[];var c=parseInt(n.width,10);var _=parseInt(n.height,10);if(c&&_){d.push("wi"+c);d.push("he"+_);if(TS.boot_data.feature_use_imgproxy_resizing)d.push("si")}if(n.rotate)d.push("ro");if(n.render_svg)d.push("sv2");if(n.convert_ico)d.push("ip");if(n.stop_animations||false==TS.model.prefs.a11y_animations)d.push("gu");if(d.length>0)r=TS.utility.url.setUrlQueryStringValue(r,"o1",d.join("."));return TS.utility.url.setUrlQueryStringValue(r,"url",t)},rAF:function(){var e=["ms","moz","webkit","o"];var t=window.requestAnimationFrame;var n;for(n=0;n<e.length&&!t;n+=1)t=window[e[n]+"RequestAnimationFrame"];if(!t){var r=0;return function(e){var t=Date.now();var n=Math.max(0,16-(t-r));var i=window.setTimeout(function(){e(t+n)},n);r=t+n;return i}}return function(e){return t.call(window,e)}}(),cancelRAF:function(){var e=["ms","moz","webkit","o"];var t=window.cancelAnimationFrame;var n;for(n=0;n<e.length&&!t;n+=1)t=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];if(!t)return function(e){clearTimeout(e)};return function(e){t.call(window,e)}}(),startAnimation:function e(t){return h.subscribe(t)},getLocationHashString:function e(t){t=t||document;var n=t.location.hash;if(n&&n.length)return n.substr(1);return n},getYoutubeIdFromURL:function e(t){var n="";t=t.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);if(void 0!==t[2]){n=t[2].split(/[^0-9a-z_-]/i);n=n[0]}else n=t;return n},loadUrlInWindowIfOnline:function e(t,n){n=n||document;TS.api.call("api.test",{},function(e){if(e){$("body").addClass("hidden");n.location=t}else TS.generic_dialog.alert(TS.i18n.t("You can’t perform that action because you are not online :(","utility")())})},externalURLsNeedRedirecting:function e(){if(TS.model.team&&TS.model.team.prefs&&TS.model.team.prefs.hide_referers&&!TS.model.is_our_app)return true;return false},swapInRedirUrlForIframe:function e(t,n){n=n||u();if(!n)return t;if(!n.iframe_redirect_type)return t;var r=$(t);var i=r.attr("src");if(!i)return t;if("1"==TS.qs_args.test_iframe_referers)i="https://"+document.location.host+"/referertester.html?"+Date.now();i="https://"+TS.boot_data.redir_domain+"/link?v="+n.iframe_redirect_type+"&url="+encodeURIComponent(i);r.attr("src",i);t=r[0].outerHTML;if("1"==TS.qs_args.test_iframe_referers)TS.info("html with redir:"+t);return t},setCssFromHeightAndWidthAttrs:function e(t){var n=$(t);n.css({height:n.attr("height"),width:n.attr("width")});return n[0].outerHTML},isArrowKey:function e(t){var n=TS.utility.keymap;if(t==n.down)return true;if(t==n.up)return true;if(t==n.right)return true;if(t==n.left)return true;return false},isPageKey:function e(t){var n=TS.utility.keymap;if(t==n.pageup)return true;if(t==n.pagedown)return true;if(t==n.home)return true;if(t==n.end)return true;return false},isNumericKey:function e(t){if(t>=48&&t<=57)return true;return false},getFileIDFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));var n=document.createElement("a");n.href=TS.model.files_url;var r=n.host;var i=document.createElement("a");i.href=t;var a;try{a=_.trimStart(i.pathname,"/")}catch(e){var s=true;TS.console.logError(e,"invalid_pathname_bug input="+t+", files_url="+TS.model.files_url,void 0,s);return null}var o=[r,"files.dev.slack.com","files.staging.slack.com","files.slack.com"];if(TS.model.enterprise&&TS.model.enterprise.domain)if(!TS.boot_data||"dev"!==TS.boot_data.version_ts)o.push(TS.model.enterprise.domain+".enterprise.slack.com");else o.push(TS.model.enterprise.domain+".enterprise.dev.slack.com");if(-1===o.indexOf(i.host))return null;var l;var u;if(0===a.indexOf("files/")){u=a.split("/");if(u.length<3)return null;var d=u[1];if(!d)return null;if(!(TS.members.getMemberByName(d)||TS.members.getMemberById(d)))return null;l=u[2]}else if(0===a.indexOf("files-pri/")){u=a.split("/");if(u.length<3)return null;var c=u[1];if(c.indexOf("-")<0)return null;var m=c.split("-");if(2!==m.length)return null;l=m[1]}else return null;if(!l)return null;if("F"!==l.substr(0,1))return null;if(l.length<2)return null;if(l.length>15)return null;return l},getBotIDFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));t=t.replace("https://","").replace("http://","");var n=TS.model.bots_url.replace("https://","").replace("http://","");if(0===t.indexOf(n))t=t.replace(n,"services");while(0===t.indexOf("/"))t=t.substr(1);if(0!==t.indexOf("services/"))return null;var r=t.split("/");if(r.length<2)return null;var i=r[1];if(!i)return null;if("B"!==i.substr(0,1))return null;if(i.length<2)return null;if(i.length>15)return null;return i},getMemberIdFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));t=t.replace("https://","").replace("http://","");var n=TS.model.team_url.replace("https://","").replace("http://","");if(0===t.indexOf(n))t=t.replace(n,"team");while(0===t.indexOf("/"))t=t.substr(1);if(0!==t.indexOf("team/"))return null;var r=t.split("/");if(r.length<2)return null;var i=r[1];if(!i)return null;var a=TS.members.getMemberById(i)||TS.members.getMemberByName(i);if(a)return a.id;return null},normalizeDevHost:function e(t){return t.replace(/\.dev[0-9]*.slack.com/i,".dev.slack.com").replace(/\.staging.slack.com/i,".slack.com")},platformSupportsHtmlNotifications:function e(){if(TS.model.win_ssb_version&&window.winssb){if(window.winssb.app.canShowHtmlNotifications)return window.winssb.app.canShowHtmlNotifications();return false!==window.winssb.app.willUseHwAcceleration}return false},platformSupportsImgEmojiInHtmlNotifications:function e(){return TS.model.win_ssb_version&&(TS.model.win_ssb_version>.9||.9==TS.model.win_ssb_version&&TS.model.win_ssb_version_minor>=5)},findAllTeamEmojiInStr:function e(t,n){t=$.trim(t);var r=[];if(!t)return r;r=t.match(TS.emoji.getColonsRx())||r;var i=[];r=r.filter(function(e){if(TS.emoji.isValidName(e))return true;e.split("::").forEach(function(e){var t=TS.emoji.isValidName(e);if(!t)return;i.push(":"+t+":")});return false});r=r.concat(i);if(n)r=_.uniq(r);TS.dir(248,r);return r},areSimpleObjectsEqual:function e(t,r){if(t===r)return true;if(void 0===t&&r)return false;if(void 0===r&&t)return false;if(("undefined"===typeof t?"undefined":n(t))!==("undefined"===typeof r?"undefined":n(r)))return false;if(null===t&&r)return false;if(null===r&&t)return false;if(t.length!==r.length)return false;var i;for(i in r){if("undefined"===typeof t[i]&&"undefined"!==typeof r[i])return false;if(r[i])switch(n(r[i])){case"object":if(!e(t[i],r[i]))return false;break;case"function":if(String(r[i])!=String(t[i]))return false;break;default:if(r[i]!==t[i])return false}else if(t[i])return false}for(i in t)if("undefined"===typeof r[i]&&"undefined"!==typeof t[i])return false;return true},deepDiffObjects:function e(t,r){if(_.isEmpty(t))return{};else if(_.isEmpty(r))return t;var i={};_.each(t,function(e,t){var a=r[t];if(a===e)return;if(("undefined"===typeof e?"undefined":n(e))!==("undefined"===typeof a?"undefined":n(a)))i[t]=e;else if(_.isArray(e))i[t]=_.difference(e,a);else if(_.isPlainObject(e)){var s=TS.utility.deepDiffObjects(e,a);if(!_.isEmpty(s))i[t]=s}else i[t]=e});return i},appendLogToUrlWithLimit:function e(t,n){if(!t)return t;t+=-1==t.indexOf("?")?"?":"&";if(!n)return t;var r=2e3-t.length;return t+n.substr(0,r)},makeWebWorker:function e(t,n){var r=URL.createObjectURL(new Blob(["(",t,")()"],{type:"application/javascript"}));var i=new Worker(r);URL.revokeObjectURL(r);i.onmessage=n;return i},extractAllModelObIds:function e(r,i){i=i&&String(i)||"";var a="search."===i.substr(0,7);var s=[];var l=[];var u=function e(t,n){if("channel"===t)return true;if("id"===t&&a&&"channel"===n)return true;return false};var d=function e(t,r){if("object"!==("undefined"===typeof t?"undefined":n(t)))return;l.push(t);_.forOwn(t,function(e,t){if("string"===typeof e)if(u(t,r)){if(TS.utility.strLooksLikeAChannelId(e))TS.utility.ensureInArray(s,e)}else TS.format.extractIds(e).c_ids.forEach(function(e){TS.utility.ensureInArray(s,e)})});_.forOwn(t,function(t,r){if("object"===("undefined"===typeof t?"undefined":n(t))){if(-1!=l.indexOf(t))return;if(Array.isArray(t)&&("channels"===r||"ims"===r||"groups"===r))t.forEach(function(e){if("string"===typeof e)TS.utility.ensureInArray(s,e)});else e(t,r)}})};d(r,"_DATA");if("search.messages"===i&&TS.boot_data.page_needs_enterprise)T(r,s);if(TS.shouldLog("794"))o(r,i,s,t);return s},extractAllTeamIds:function e(t){var n=[];_.toPairs(t).forEach(function(e){var t=e[0];var r=e[1];if(_.isArray(r)){if("messages"===t||"teams"===t||"users"===t)_.forEach(r,function(e){var t=TS.utility.extractAllTeamIds(e);n.push(t)})}else if(_.isObject(r)){var i=TS.utility.extractAllTeamIds(r);n.push(i)}else if(_.isString(r))if("team"===t||"source_team"===t||"user_team"===t||"team_id"===t)if(TS.utility.strLooksLikeATeamId(r))n.push(r)});return _(n).flatten().uniq().value()},extractAllMemberIds:function e(t,i,a){i=i&&String(i)||"";var s=[];var l=[];var u=[];var d=[];var c=function e(t){if("user"===t)return true;if("inviter"===t)return true;if("accepted_user"===t)return true;if("created_by"===t)return true;return false};var m=function e(t){if(!_.isObject(t))return;d.push(t);var r;Object.keys(t).forEach(function(e){r=t[e];if("string"===typeof r)if(c(e)){if(TS.interop.utility.looksLikeMemberId(r))if(TS.utility.ensureInArray(s,r)){l.push("string"===typeof t.channel&&t.channel||"object"===n(t.channel)&&t.channel&&t.channel.id||a||void 0);u.push("string"===typeof t.team&&t.team||"object"===n(t.team)&&t.team&&t.team.id||void 0)}}else TS.format.extractIds(r).m_ids.forEach(function(e){if(TS.utility.ensureInArray(s,e)){l.push(void 0);u.push(void 0)}})});Object.keys(t).forEach(function(i){r=t[i];if("object"===("undefined"===typeof r?"undefined":n(r))){if(-1!=d.indexOf(r))return;if(Array.isArray(r)&&("members"===i||"users"===i))r.forEach(function(e){if(TS.interop.utility.looksLikeMemberId(e)){if(TS.utility.ensureInArray(s,e)){l.push("string"===typeof t.id&&t.channel||a||void 0);u.push("string"===typeof t.team&&t.team||"object"===n(t.team)&&t.team&&t.team.id||void 0)}}else if(e&&"object"===("undefined"===typeof e?"undefined":n(e))&&e.id)if(TS.interop.utility.looksLikeMemberId(e.id))s.push(e.id)});else e(r)}})};m(t);s=_(s).uniq().value();if(TS.shouldLog("794"))o(t,i,s,r);return{c_ids:l,t_ids:u,m_ids:s}},extractAllBotIds:function e(t){var n=t.bot_id?[t.bot_id]:[];var r;_.values(t).forEach(function(e){if(_.isObject(e)){r=TS.utility.extractAllBotIds(e);n.push(r)}else if(_.isString(e)){r=_(TS.utility.findUrls(e)).map(TS.utility.getBotIDFromURL).compact().value();n.push(r)}});return _(n).flatten().uniq().value()},strLooksLikeAChannelId:function e(t){if("string"!==typeof t||t.length<9)return false;if(t&&TS.model.channel_id_prefixes.indexOf(t.charAt(0))>-1)return true;return false},strLooksLikeATeamId:function e(t){if(!_.isString(t)||t.length!==TS.model.model_ob_id_length)return false;if(t&&"T"===t.charAt(0)&&t.match(/^[A-Z0-9]+$/))return true;return false},strGetWordCount:function e(t){return t.trim().split(/\s+/).length},truncateToNearestWordBoundary:function e(t,n){if(t.string)t=t.string;if(t.length<=n)return t;var r="…";var i=t.substring(0,n);var a=i.lastIndexOf(" ");if(a>0&&a>n-15)return i.substring(0,a)+r;return i.substring(0,i.length-1)+r},truncateAndEscape:function e(t,n){if(t.length<=n)return _.escape(t);return _.escape(t.substring(0,n-1))+"&hellip;"},truncateHTML:function(){var e;try{if(window.DOMParser){e=new DOMParser;if(!e.parseFromString("","text/html"))e=null}}catch(t){e=null}function t(e,n,r){var i=_.toArray(n.childNodes);_.forEach(i,function(i){if(e>=r){n.removeChild(i);return}if(i.nodeType===Node.TEXT_NODE){var a=i.textContent;if(e+a.length>r){i.textContent=a.substring(0,r-e);e+=r-e}else e+=i.textContent.length}else e=t(e,i,r)});return e}return function(n,r){try{var i;if(e){var a=e.parseFromString(n,"text/html");i=a.body}else{var s=jQuery.parseHTML("<div>"+n+"</div>");i=s[0]}var o=t(0,i,r);if(o>=r){var l=document.createTextNode("…");i.appendChild(l)}return i.innerHTML}catch(e){TS.error(e);return n}}}(),isSpaceClickEventSafe:function e(t,n){if(t.target){var r=$(t.target).closest("[href]");if(!r[0])return true;if(!r.closest(".post_body").length&&!r.closest("ts-rocket").length)return true;var i=r[0].protocol;if(i&&false===/^https?:$/.test(i)){TS.warn("not following bad link from a post preview");t.preventDefault();return false}if(r.data("original-href")){TS.warn("not following possibly spoofed link from a post preview");t.preventDefault();var a=r.data("referer-original-href")||r.attr("href");if(!n)s(r.data("original-href"),r.attr("href"),a);return false}}return true},getCachedScript:function e(t,n){n=$.extend(n||{},{dataType:"script",cache:true,url:t});return jQuery.ajax(n)},disableElement:function e(t,n){t=$(t);t.attr("disabled",n);t.attr("aria-disabled",n)},strToApparentlyRndPerc:function e(t){return parseFloat("."+TS.utility.strToApparentlyRndNum(t))},strToApparentlyRndNum:function e(t){if(!t)return NaN;t=String(t);var n=t.substr(Math.round(t.length/2),1);t=n+t.split("middle").reverse().join();var r="";for(var i=t.length-1;i>-1;i-=1)r+=(t.charCodeAt(i)*(i+1)).toString().substr(-1,1);return parseInt(r,10)},enableFeatureForUser:function e(t){if(t<0||t>100){TS.warn("TS.utility.enableFeatureForUser() expects a number between 0 and 100");return false}return _.random(0,100)<t},roundToThree:function e(t){return+(Math.round(t+"e+3")+"e-3")},convertBytesToMegabytes:function e(t){return t/1024/1024},convertKilobytesToMegabytes:function e(t){return t/1024},queryIsMaybeSelf:function e(t){t=_.toLower(t);if("me"===t||"you"===t||t===i||t===a)return true;return false},openAuthenticatedInBrowser:function e(t){var n=null!==TS.model.desktop_app_version;if(n&&parseFloat(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor)>=2.6){var r=TS.boot_data.team_url+"web/open"+t;TSSSB.call("openAuthenticatedInBrowser",r)}else window.open(t)},getFontDescriptorForElement:function e(t){var n=t instanceof jQuery?t:$(t);return[n.css("font-style"),n.css("font-weight"),n.css("font-size"),n.css("font-family")].join(" ")},measureTextWidth:function e(t,n){if(!t)return 0;this._measure_text_width_canvas=this._measure_text_width_canvas||document.createElement("canvas");var r=this._measure_text_width_canvas.getContext("2d");r.font=n;return r.measureText(t).width},bytesInUnicodeCodePoint:function e(t){if(t<0||t>1114111)throw new RangeError("Invalid unicode code point {"+t+"}");if(t<128)return 1;if(t<2048)return 2;if(t<65536)return 3;if(t<=1114111)return 4},test:{clearAndGetRefererPolicy:function e(){l=void 0;return u()},getRefererPolicy:function e(){return u()},setSlackUrlRe:function e(t){g=t}}});var e;var t=/(?:"|<#)([CGD][0-9a-zA-Z]{8,10})(?:"|\||>)/g;var r=/(?:"|<@)([WU][0-9a-zA-Z]{8,10})(?:"|\||>)/g;var i;var a;var s=function e(t,n,r){var i="";var a="";i+='<ts-icon class="ts_icon_warning yolk_orange small_right_margin"></ts-icon> ';i+=TS.i18n.t("Caution: Tricky Link","utility")();a+="<p>";a+='  <span class="inline_block">'+TS.i18n.t("The link you clicked (<strong>{url}</strong>) is tricky.","utility")({url:_.escape(r)})+"</span>";a+='  <span class="inline_block">'+TS.i18n.t("It has been formatted to look like another web address (<strong>{url}</strong>).","utility")({url:_.escape(t)})+"</span>";a+="</p>";a+="<p>"+TS.i18n.t("Are you sure you want to follow it?","utility")()+"</p>";TS.generic_dialog.start({title:i,body:a,show_cancel_button:false,show_secondary_go_button:true,secondary_go_button_text:TS.i18n.t("Let’s risk it","utility")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){window.open(n)},go_button_text:TS.i18n.t("Take me back to safety","utility")(),esc_for_ok:true,enter_always_gos:true})};var o=function e(t,n,r,i){var a=function e(t,n){var r=[];var i=n.exec(t);while(i){r.push(i[1]);i=n.exec(t)}return r};var s=JSON.stringify(t);var o=_.uniq(a(s,i));if(o.length!=r.length){TS.warn(n+"   A: "+o.join(", "));TS.info(n+" ids: "+r.join(", "));if(o.length>r.length)TS.info(n+" dif: "+_.difference(o,r).join(", "));else TS.info(n+" dif: "+_.difference(r,o).join(", "))}};var l;var u=function e(){if(!_.isUndefined(l))return l;var t=window.boot_data;if(!t){TS.warn("window.boot_data not available");l=null;return l}var n={iframe_redirect_type:4,redirect_type:3,rewrite_on_right_click:true};var r=TS.console&&TS.console.warn;if(!window.bowser){if(r)TS.console.warn(8675309,"window.bowser undefined, defaulting to restrictive referrer policy");l=n;return l}if(bowser.chrome&&bowser.version>=4.1||bowser.opera&&bowser.version>=15){l={iframe_redirect_type:4,redirect_type:null,rewrite_on_right_click:false};return l}if(bowser.ie){l={iframe_redirect_type:4,redirect_type:3,rewrite_on_right_click:true};return l}if(bowser.firefox){l={iframe_redirect_type:bowser.version>=36?4:2,redirect_type:3,rewrite_on_right_click:bowser.version<36};return l}if(bowser.safari&&bowser.version>=5||navigator.userAgent.match(/(Slack_SSB)/g)){l={iframe_redirect_type:2,redirect_type:null,rewrite_on_right_click:false};return l}if(navigator.userAgent&&navigator.userAgent.match(/phantomjs/i))r=false;if(r)TS.console.warn(8675309,"browser not recognized, defaulting to restrictive referrer policy");l=n;return n};var d=null;window.getRefererHidingWhiteList=function(){if(d)return d;d=["slack.com","slack-files.com","slack-imgs.com",TS.boot_data.redir_domain];return d};var c=/((ftp|http|https):\/\/|\bw{3}\.)[a-z0-9\-.]+[a-z]+(:[a-z0-9]*)?\/?([@a-z0-9\-._?,'/\\+&amp;%:!$#=~])*/gi;var m=window.setImmediate;if(!m)if(window.MutationObserver){var f=document.createElement("div");var p=[];new MutationObserver(function(){var e=p.slice();p.length=0;e.forEach(function(e){e()})}).observe(f,{attributes:true});m=function e(t){if(!p.length)f.setAttribute("yes","no");p.push(t)}}else m=function e(t){setTimeout(t,0)};var h=function(){var e=false;var t=[];function n(){if(!e)return;t.forEach(function(e){e()});TS.utility.rAF(n)}function r(r){var i={start:function i(){t.push(r);if(!e){e=true;TS.utility.rAF(n)}},stop:function n(){t.splice(t.indexOf(r),1);if(!t.length)e=false}};i.start();return i}return{subscribe:r,subscribers:t,isRunning:function t(){return e}}}();var g=/\.slack\.com\/((?:messages|archives|unreads|threads)\/)/;if(TS.boot_data.feature_cross_team_deeplink)g=/([^.:/]+)(?:\.[^.]+)?\.slack\.com\/((?:messages|archives|unreads|threads)\/)/;var S=/(<a\b[^>]*)(>)/gi;function T(e,t){var n=TS.model.team.id;_.remove(t,function(t){var r=_.find(e.messages.matches,function(e){return e.channel.id==t},this);var i=_.get(r,"channel.is_shared")||_.get(r,"channel.is_org_shared");if(r&&_.get(r,"team")!=n&&_.startsWith(t,"C")&&!i)return t})}var v=365})()},4254:function(e,t){(function(){"use strict";TS.registerModule("format",{hex_rx:/(\W|^)(#[A-Fa-f0-9]{6})(\b)/g,replaceUnicodeDoppelgangers:function e(t){if(!t)return"";t=t.replace(/\u00A0/g," ");t=t.replace(/\u000D/g,"\n");t=t.replace(/\u000A/g,"\n");return t},replaceHighlightMarkers:function e(t,n,r){if(!t)return"";n=n||"";r=r||"";return t.replace(/\ue000/g,n).replace(/\ue001/g,r)},hasOnlyValidMemberIds:function e(t){if(!_.isString(t))return true;return _.every(t.match(i),TS.members.getMemberById)},formatSlugs:function e(t,n){if(!_.isString(t))t="";if(!_.isInteger(n))n=0;var r=n;var a=_.escape(t);var s=a.replace(i,function(e,t,i,a,s){var o="";if(a.length>TS.model.model_ob_id_length){o=a.slice(TS.model.model_ob_id_length);a=a.slice(0,TS.model.model_ob_id_length);i="@"+a}var l=R(TS.members.getMemberById,a,TS.members.getMemberByName,i);var u=l.model_ob;if(!u)return e;var d=D(u);var c=s+t.length;if(c<n)r-=i.length-d.txt.length;return t+d.html+o});return{cursor:{end:r,length:0,start:r},html:s}},cleanMsg:function e(t){return P(t,{do_specials:true})},cleanInternalMsg:function e(t){return P(t,{do_specials:false})},cleanCommandText:function e(t){if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)t=TSFEmoji.translateEmojiStringToCanonical(t,TS.i18n.locale());if(!TS.boot_data.feature_name_tagging_client)return t;return P(t,{do_specials:false,human_readable:true})},doEmoticonConversion:function e(t){m.length=0;t=t.replace(s,T);t=t.replace(o,T);t=t.replace(l,T);t=TS.emoji.replaceEmoticons(t);t=TS.format.deTokenizeStr(m,t);return t},tokenizeStr:function e(t,n,r){if(!n)return"";r=r||"";var i=0===n.indexOf("\n")?"\n":"";var a=y(i+p+(f+=1)+Date.now());a=r+a+r;t.push({str:n,token:a});return a},deTokenizeStr:function e(t,n){var r;var i=t.length-1;for(i;i>-1;i-=1){r=t[i];n=n.replace(r.token,r.str.replace(/\$/g,"$$$$"))}return n},unFormatMsg:function e(t,n){return TS.format.formatWithOptions(t,n,{for_edit:true})},formatJustText:function e(t){return TS.format.formatWithOptions(t)},formatDefault:function e(t,n){return TS.format.formatWithOptions(t,n)},formatNoHighlightsNoSpecials:function e(t,n){return TS.format.formatWithOptions(t,n,{no_highlights:true,no_specials:true})},formatNoHighlightsNoSpecialsNoInlineImgs:function e(t,n){return TS.format.formatWithOptions(t,n,{no_highlights:true,no_specials:true,do_inline_imgs:false})},formatNoHighlightsNoInlineImgs:function e(t,n){return TS.format.formatWithOptions(t,n,{do_inline_imgs:false,no_highlights:true})},formatNoSpecials:function e(t,n){return TS.format.formatWithOptions(t,n,{no_specials:true})},formatNotification:function e(t,n){return TS.format.formatWithOptions(t,n,{for_growl:true})},formatCurrentStatus:function e(t,n,r){r=r||{};return TS.format.formatWithOptions(t,n,_.assign({no_jumbomoji:true,no_linking:true,no_specials:true,no_highlights:true,no_emoji_text:true,prevent_copy_paste:true},r))},formatBroadcastExcerpt:function e(t,n){var r="&hellip;<br>";var i=r+'<span class="multiline_block">';var a="</span>";var s=TS.format.formatWithOptions(t,n,{no_highlights:true,no_hex_colors:true,do_inline_imgs:false,enable_slack_action_links:false,do_theme_install_buttons:false,no_jumbomoji:true,no_linking:true,custom_linebreak:r,token_overrides:{"<PRE:START>":i,"<PRE:END>":a,"<QUOTE:START>":i,"<QUOTE:END>":a,"<CODE:START>":"<span>","<CODE:END>":"</span>","<PARA:BREAK>":r}});if(_.startsWith(s,r))s=s.substring(r.length);return s},extractIds:function e(t){var n=[];var r=[];var i=t.match(/<[#@]+(.*?)>/g);if(i)i.forEach(function(e){var t;var i;if(0===e.indexOf("<@")){t=e.replace(/<|>/g,"");i=TS.utility.msgs.getMemberIdFromMemberMarkup(t);if(TS.interop.utility.looksLikeMemberId(i))TS.utility.ensureInArray(r,i)}else{t=e.replace(/<|>|#/g,"");i=t.split("|")[0];if(TS.utility.strLooksLikeAChannelId(i))TS.utility.ensureInArray(n,i)}});return{c_ids:n,m_ids:r}},calculateOptions:function e(t,n){return w(t,n)},formatWithOptions:function e(t,n,r){if(!$.trim(t))return"";var i=w(n,r);var a=k(t,n,i);return a},applyStringifyTransformsToChildren:function e(t,n){if(!t)return false;if(!_.isObject(n))n={};if(!t.childElementCount)return false;var r=1===t.childNodes.length&&1===t.firstChild.nodeType&&t.firstChild.hasAttribute("data-stringify-requires-siblings");if(r)return;_.each(t.querySelectorAll("pre br"),function(e){e.parentElement.replaceChild(document.createTextNode("\n"),e)});var i=_.filter(t.querySelectorAll("*"),function(e){if(!L(e))return false;if(_.isFunction(n.excludeFn)&&n.excludeFn(e))return false;var t;if(_.isFunction(n.customFn)&&n.customFn(e))t=n.customFn(e);else t=TS.format.stringifyNode(e);var r=t!==e.textContent;if(r)e.textContent=t;return r});return i.length>0},formatSelection:function e(t,n){if(!t||!t.rangeCount)return;if(!_.isObject(n))n={};if(1!==t.rangeCount){TS.info("TS.format.formatSelection: found "+t.rangeCount+" ranges");return}var r=t.getRangeAt(0);var i;if(_.isElement(r.commonAncestorContainer)){if($(r.commonAncestorContainer).is(".ql-editor"))return t.toString();if(TS.model.is_safari_desktop){var a=r.commonAncestorContainer.querySelectorAll("ts-message");if(a.length>1)return}var s=r.commonAncestorContainer.cloneNode();s.appendChild(r.cloneContents());s.classList.add("offscreen","user_select_text");r.commonAncestorContainer.parentElement.appendChild(s);var o="\ufeff";s.innerHTML=s.innerHTML.replace(/&nbsp;/g,o);if(s.lastChild&&!s.lastChild.textContent)s.removeChild(s.lastChild);TS.format.applyStringifyTransformsToChildren(s,n);var l=TS.selection.snapshot();t=TS.selection.selectNodeContents(s);i=t.toString();var u=new RegExp(o,"g");i=i.replace(/ {2}/g," ").replace(u," ");s.parentElement.removeChild(s);l()}else i=t.toString();i=TS.format.replaceUnicodeDoppelgangers(i);i=i.replace(/^\n+/,"");i=i.replace(/\n+$/,"");return i},formatSelectionAsHTML:function e(t){if(!t||!t.rangeCount)return"";if(1!==t.rangeCount)TS.info("TS.format.formatSelection: found "+t.rangeCount+" ranges");var n=t.getRangeAt(0);var r=document.createElement("div");r.appendChild(n.cloneContents());return r.innerHTML},stringifyNode:function e(t){if(!t)return"";if(!L(t))return t.textContent;var n=t.textContent;_.each(u,function(e,r){if(t.hasAttribute(r))n=e(t,n)});return n},swapInAts:function e(t){if(!t)return t;return t.replace(new RegExp(h,"g"),"@").replace(new RegExp(g,"g"),"-").replace(new RegExp(S,"g"),"_")},swapOutAts:function e(t){if(!t)return t;return t.replace(/@/g,h).replace(/-/g,g).replace(/_/g,S)},test:function e(){var t={encodeSpecialFormattingChars:b,encodeSpecialFormattingCharsAndColon:y,getTokenMap:d};Object.defineProperty(t,"_hasStringifyTransformations",{get:function e(){return L},set:function e(t){L=t}});return t}});var e=[];var t=[];var n={};TS.model.BROADCAST_KEYWORDS.forEach(function(r){e.push(r.ms_name);n[r.ms_name]=r.name;t.push({regex:new RegExp("^@("+r.name+"|"+TS.i18n.deburr(r.name)+")[.|\\-|_]*$"),cmd:r.cmd,name:"!"+r.name});if(r.ms_name!==r.name)t.push({regex:new RegExp("^@"+r.ms_name+"[.|\\-|_]*$"),cmd:r.cmd,name:"!"+r.ms_name});if(r.alias){e.push(r.alias);t.push({regex:new RegExp("^@"+r.alias+"[.|\\-|_]*$"),cmd:"<!"+r.alias+">",name:"!"+r.alias})}});var r=/((?:#[A-Fa-f0-9]{6} {0,}, {0,}){7})(#[A-Fa-f0-9]{6})(\b)/g;var i=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|“|‘|')(@([\w|.|-]+))/g;if(!TS.boot_data.feature_localization&&TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_name_tagging_client)i=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|“|‘|')(@([\w.\-+]+))/g;if(TS.boot_data.feature_localization&&!TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_name_tagging_client)i=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|“|‘|')(@([^~`!@#$%^&*()+=[\]{}\\|;:'"”’,<>/?\s]+))/g;if(TS.boot_data.feature_localization&&TS.boot_data.feature_shared_channels_client&&!TS.boot_data.feature_name_tagging_client)i=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|“|‘|')(@([^~`!@#$%^&*()=[\]{}\\|;:'"”’,<>/?\s]+))/g;var a=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|“|‘|')(#([^~`!@#$%^&*()+=[\]{}\\|;:'"”’,.<>/?\s]+))/g;var s=/(^|\s|[_*?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])```([\s\S]*?)?```(?=$|\s|[_*?.,\-!^;:})\]%$#+=\u2000-\u206F\u2E00-\u2E7F…"])/g;var o=/(^|\s|[?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])`([^`]*?\S *)?`/g;var l=/(^|\n)&gt;(?![\W_](?:&lt;|&gt;|[|/\\[\]{}()Dpb](?=\s|$)))(([^\n]*)(\n&gt;[^\n]*)*)/g;var u={"data-stringify-text":function e(t){return t.getAttribute("data-stringify-text")},"data-stringify-prefix":function e(t,n){return t.getAttribute("data-stringify-prefix")+n},"data-stringify-suffix":function e(t,n){return n+t.getAttribute("data-stringify-suffix")}};var d=function e(){var t={"<QUOTE:START>":'<div class="special_formatting_quote"><div class="quote_bar"><div class="shim"></div></div><div class="content dynamic_content_max_width">',"<QUOTE:PREFIX>":'<span class="copyonly">&gt;</span>',"<LONGQUOTE:PREFIX>":'<span class="copyonly">&gt;&gt;&gt;</span>',"<QUOTE:END>":"</div></div>","<LINK:END>":"</a>","<LINE:BREAK>":"<br>","<PARA:BREAK>":'<span class="para_break"><i class="copy_only"><br></i></span>',"<SPACE:HARD>":"&nbsp;"};t["<B:START>"]='<b data-stringify-prefix="*" data-stringify-suffix="*" data-stringify-requires-siblings>';t["<B:END>"]="</b>";t["<STRIKE:START>"]='<strike data-stringify-prefix="~" data-stringify-suffix="~" data-stringify-requires-siblings>';t["<STRIKE:END>"]="</strike>";t["<CODE:START>"]='<code class="special_formatting" data-stringify-prefix="`" data-stringify-suffix="`" data-stringify-requires-siblings>';t["<CODE:END>"]="</code>";t["<I:START>"]='<i data-stringify-prefix="_" data-stringify-suffix="_" data-stringify-requires-siblings>';t["<I:END>"]="</i>";t["<PRE:START>"]='<pre class="special_formatting" data-stringify-prefix="```" data-stringify-suffix="```" data-stringify-requires-siblings>';t["<PRE:END>"]="</pre>";return t};var c=d();var m=[];var f=0;var p="^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}".split("").sort(function(){return.5-Math.random()}).join("");var h="thisreplacementtokenallowsustotreatatsymbolsasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var g="thisreplacementtokenallowsustotreatdashesasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var S="thisreplacementtokenallowsustotreatdashesasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var T=function e(t,n){var r=t.slice(n.length);return n+TS.format.tokenizeStr(m,r)};var v=function e(t){if(TS.boot_data.feature_tinyspeck){var n=TS.interop.format.locateHighlightWords(t,TS.model.highlight_words);_.forEachRight(n,function(e){var n=e.index;var r=n+e.length;var i=t.slice(n,r);var a=t.slice(0,n);var s='<span class="mention">'+i+"</span>";var o=t.slice(r);t=a+s+o});return t}var r=TS.model.highlight_words.concat();r.sort(function e(t,n){return n.length-t.length});var i=false;if(-1!=t.indexOf("@")){i=true;t=TS.format.swapOutAts(t)}var a;r.forEach(function(e){if(i)e=TS.format.swapOutAts(e);e=TS.utility.regexpEscape(e);if("don"===e)e+="(?!['’]t)";e=_.escape(e);if(i)a=new RegExp("(\\b(?!.)|_|\\s|^)("+e+")(\\b|,*)((?!.)|_|\\s|$)","ig");else a=new RegExp("(\\b|_|\\s|^)("+e+")(\\b)(|_|\\s|$)","ig");var n=0;t=t.replace(a,function(e,t,r,i,a,s,o){if("&"===o.substr(s-1,1)&&";"===o.substr(s+e.length,1))return e;if(o.substr(0,s).match(/</))for(var l=s;l>=n;l-=1){if("<"===o.charAt(l))return t+r+i;if(">"===o.charAt(l))break}n=s+e.length;return t+'<span class="mention">'+r+"</span>"+i+a})});if(i)return TS.format.swapInAts(t);return t};var b=function e(t){if(!t)return"";return t.replace(/\*/g,"&ast;").replace(/_/g,"&#95;").replace(/`/g,"&#96;")};var y=function e(t){if(!t)return"";return b(t).replace(/:/g,"&#58;")};var w=function e(t,n){n=n||{};var r=!!n.do_inline_imgs||void 0;var i=!!n.for_growl||void 0;var a=!!n.for_edit||void 0;var s=!!n.no_highlights||void 0;var o=!!n.no_specials||void 0;var l=!!n.enable_slack_action_links||void 0;var u=!!n.no_jumbomoji||void 0;var d=!!n.no_preformatted||void 0;var c=n.custom_linebreak||void 0;var m=!!n.stop_animations||void 0;var f=!!n.no_emoji_text||void 0;var p=!!n.transform_missing_emoji||void 0;var h=!!n.show_icon_for_emoji_in_as_text_mode||void 0;var g=!!n.ignore_emoji_mode_pref||void 0;var S=!!n.prevent_copy_paste||void 0;var T=TS.boot_data.feature_new_broadcast&&!!n.no_linking||void 0;var v=TS.boot_data.feature_new_broadcast&&n.token_overrides||void 0;var b=n.emoji_mode;if(!_.isString(b)&&TS.model&&TS.model.prefs)b=TS.model.prefs.emoji_mode;if(true!==u)u=!TS.model.prefs.jumbomoji;s=t&&"no_highlights"in t?!!t.no_highlights:!!s;if(!_.isBoolean(o))if(t&&"mrkdwn"in t)o=false===t.mrkdwn;else o=false;if(a)o=true;var y=t&&t.no_emoji;var w=!(r&&(!t||"bot_message"!==t.subtype));if(true!==w)w=!!TS.model.prefs.hide_hex_swatch;var k=!w&&TS.client&&TS.model.team;var x="NORMAL";if(o)x="NOMRKDWN";if(i)x="GROWL";if(a)x="EDIT";return{tsf_mode:x,no_highlights:s,no_emoji:y,no_hex_colors:w,do_inline_imgs:r,enable_slack_action_links:l,do_theme_install_buttons:k,no_jumbomoji:u,no_preformatted:d,custom_linebreak:c,stop_animations:m,no_emoji_text:f,transform_missing_emoji:p,show_icon_for_emoji_in_as_text_mode:h,ignore_emoji_mode_pref:g,prevent_copy_paste:S,no_linking:T,token_overrides:v,emoji_mode:b}};var k=function e(t,n,i){var a=i.tsf_mode;var s=i.no_highlights;var o=i.no_emoji;var l=i.no_hex_colors;var u=i.do_inline_imgs;var d=i.enable_slack_action_links;var m=i.do_theme_install_buttons;var f=i.no_jumbomoji;var p=i.no_preformatted;var h=i.custom_linebreak;var g=i.stop_animations;var S=i.no_emoji_text;var T=i.transform_missing_emoji;var b=i.show_icon_for_emoji_in_as_text_mode;var y=i.ignore_emoji_mode_pref;var w=i.prevent_copy_paste;var k=i.no_linking;var O=i.token_overrides;var H=i.emoji_mode;var D=c;if(h||O){var P=O||{};if(h)P["<LINE:BREAK>"]=h;D=_.extend({},D,P)}var j=[];if(m){var R=(t.match(r)||[]).length;var L=[];var N=0;t=t.replace(r,function(e,t,n){N+=1;var r=R>1?E(e,N):E(e);L.push(r);var i=R>1?" ("+N+")\t":"";return t+TS.format.tokenizeStr(j,"<nobr>",",")+n+i+TS.format.tokenizeStr(j,"</nobr>")});t+=TS.format.tokenizeStr(j,F(L))}var G=TS.boot_data.feature_parsed_mrkdwn&&"NORMAL"===a&&n&&n.cached_formatting&&t===n.text;var W;if(G)W=n.cached_formatting;else W=TSF.getTokensArray($.trim(t),a,{jumbomoji:!f});if(p)W=W.map(B);if(k)W=_.reject(W,U);var q="";var z;var K;var V;var Y;var J;var Q;var X;var Z;var ee;var te;var ne;var re;var ie;var ae;var se;var oe;var le;var ue;var de;if("GROWL"===a||"EDIT"===a)for(Y=0;Y<W.length;Y+=1){V=W[Y];if(0===V.indexOf("<"))if(D[V])TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got something in the formatting map? '+V);else if(0===V.indexOf("<!"))q+=I(a,V);else if(0===V.indexOf("<@")){de=M(a,V);q+=de}else if(0===V.indexOf("<#"))q+=x(a,V);else TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got '+V);else if(-1==V.indexOf("<"))if("EDIT"===a){if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)V=TSFEmoji.translateEmojiStringToLocal(V,TS.i18n.locale());q+=_.unescape(V)}else if(TS.utility.platformSupportsHtmlNotifications()){if(TS.utility.platformSupportsImgEmojiInHtmlNotifications())q+=TS.emoji.graphicReplace(V,{force_img:true,stop_animations:g})}else{var ce=_.unescape(V);ce=TS.emoji.maybeUnifiedReplace(ce);if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)V=TSFEmoji.translateEmojiStringToLocal(V,TS.i18n.locale());q+=ce}else TS.error("token has a < in it but it is not the first character!\n"+V)}else{var _e="";var me;var fe;var pe;for(Y=0;Y<W.length;Y+=1){V=W[Y];if(0===V.indexOf("<"))if(D[V]){q+=D[V];if(V==TSF.LINK_END){q+=_e;_e=""}}else if(0===V.indexOf("<!"))q+=I(a,V,s,k);else if(0===V.indexOf("<@")){de=M(a,V,s,k);q+=de}else if(0===V.indexOf("<#"))q+=x(a,V,k);else if(0===V.indexOf(TSF.LINK_START.split(" ")[0])){var he=function(e){var t=$.trim(e.replace(TSF.LINK_START.split(" ")[0],""));return t.substr(0,t.length-1)}(V);var ge=TS.utility.getBotIDFromURL(he);var Se;var Te="";var ve;var be="";if(ge){ve=TS.bots.getBotById(ge);if(!ve){TS.warn("No bot found for "+ge);if(n.user){Se=_.get(TS.members.getMemberById(n.user),"profile.team");ve={id:ge,name:TS.bots.getBotNameByBotLink(n.text),source_team_id:Se}}}}if(ge&&ve){pe=true;Z=TS.utility.shouldLinksHaveTargets()?'target="'+he+'" ':"";fe=s?ve.name:v(ve.name);if(W[Y+1]&&W[Y+1]==he)fe=he;fe=fe.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");if(ve.app_id)Te=ve.app_id;if(ve.source_team_id)be="data-team-id="+ve.source_team_id+" ";q+='<a href="'+he+'" '+Z+'data-bot-id="'+ge+'" data-app-id="'+Te+'" '+be+'class="internal_bot_link app_preview_link">'+fe}else if(0===he.indexOf(TS.utility.msgs.api_url_prefix+"chat.help"))if(d){me=_.escape(JSON.stringify(""+he));q+='<a onclick="TS.utility.msgs.doApiUrl('+me+')" class="api_url">'}else q+='<a class="api_url muted">(Disabled) ';else if(0===he.indexOf(TS.utility.msgs.new_api_url_prefix))if(d){me=_.escape(JSON.stringify(""+he));q+='<a onclick="TS.utility.msgs.doNewApiUrl('+me+')" class="api_url">'}else q+='<a class="api_url muted">(Disabled) ';else if(0===he.indexOf("javascript:"))q+='<a onclick="TS.client.msg_pane.maybeClick(this)" data-maybe-click="'+he.replace("javascript:","")+'">';else if(TS.client&&TS.client.core_url&&0===he.indexOf(TS.client.core_url))q+='<a target="_self" href="'+he+'">';else{var ye=TS.utility.getFileIDFromURL(he);var we=false;if(ye&&TS.model&&TS.model.user&&TS.model.user.is_primary_owner){var ke=TS.files?TS.files.getFileById(ye):false;if(ke&&TS.utility.welcome_post&&ke.name==TS.utility.welcome_post.WELCOME_POST_NAME)we=true}var xe=we?"file_new_window_link welcome_post_slackbot_message":"file_preview_link";var Ce=ye?' class="no_jumbomoji '+xe+'"':"";var Me=ye?' data-file-id="'+ye+'"':"";q+="<a "+TS.utility.makeRefererSafeLink(he)+' target="_blank"'+Ce+Me+">";if(_e)TS.error("WTF we should have no attach_html");_e="";var Ie;if(n&&n.ts&&u){Ie=TS.inline_attachments.getAttachmentByFromUrl(n.attachments,he);if(Ie&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(Ie,n)))_e=TS.templates.builders.buildAttachmentHTML({attachment:Ie,url:he,msg:n,show_initial_caret:true})}}}else if(0===V.indexOf(TSF.JUMBOMOJI_COLONS.split(" ")[0]))q+=C(V,{tsf_mode:a,no_emoji:o,do_jumbomoji:!f,stop_animations:g,no_emoji_text:S,transform_missing_emoji:T,show_icon_for_emoji_in_as_text_mode:b,ignore_emoji_mode_pref:y,emoji_mode:H});else if(0===V.indexOf(TSF.EMOJI_COLONS.split(" ")[0]))q+=C(V,{tsf_mode:a,no_emoji:o,do_jumbomoji:false,stop_animations:g,no_emoji_text:S,transform_missing_emoji:T,show_icon_for_emoji_in_as_text_mode:b,ignore_emoji_mode_pref:y,emoji_mode:H});else if(0===V.indexOf(TSF.HEX_BLOCK.split(" ")[0]))q+=A(a,V,l);else TS.error("markup token not handled:"+V);else if(-1===V.indexOf("<"))if(pe)pe=false;else{if(!s)V=v(V);if(w)V=_.map($.parseHTML(V),function(e){if(e.nodeType===Node.TEXT_NODE)return'<span class="prevent_copy_paste" aria-label="'+_.escape(e.textContent)+'"></span>';return e.outerHTML}).join("");q+=V}else TS.error("token has a < in it but it is not the first character!\n"+V)}}if(n&&("sh_room_created"===n.subtype||"sh_room_shared"===n.subtype)){var Ae=TS.ui.growls.extractFromNameFromCorGMessage(n);if(Ae){if("GROWL"!==a||TS.utility.platformSupportsHtmlNotifications())Ae=_.escape(Ae);Ae+=": "}q="sh_room_created"===n.subtype?TS.i18n.t("{from_name} Started a call","string_format")({from_name:Ae}):TS.i18n.t("{from_name} Shared a call","string_format")({from_name:Ae})}q=TS.format.deTokenizeStr(j,q);return q};var x=function e(t,n,r){var i=n.replace(/<|>|#/g,"");var a=i.split("|");var s=a[0];var o=TS.channels.getChannelById(s);var l;if(TS.boot_data.feature_tinyspeck){var u=a[1];var d=o?o.name:"";var c=TS.interop.format.formatChannelName({fallbackName:u,isUserRestricted:TS.model.user.is_restricted,channelName:d});if(!o||"GROWL"===t||"EDIT"===t||r)return c;l=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+o.id+'"':"";return'<a href="/archives/'+o.id+'" '+l+' data-channel-name="'+o.name+'" data-channel-id="'+o.id+'" class="internal_channel_link">'+c+"</a>"}if(o){if("GROWL"===t||"EDIT"===t||r)return"#"+o.name;l=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+o.id+'"':"";return'<a href="/archives/'+o.id+'" '+l+' data-channel-name="'+o.name+'" data-channel-id="'+o.id+'" class="internal_channel_link">#'+o.name+"</a>"}if(a.length>1&&a[1])return"#"+a[1];else if(TS.model.user.is_restricted)return"#unknown-channel";return"#deleted-channel"};var C=function e(t,n){n=n||{};var r=t.split(" ")[1].replace(">","");if(n.no_emoji)return r;var i;if(n.transform_missing_emoji&&!TS.emoji.isValidName(r))i=TS.emoji.MISSING_EMOJI_HTML;else if(n.show_icon_for_emoji_in_as_text_mode&&"as_text"===n.emoji_mode)i=TS.emoji.graphicReplace(r,{show_icon_for_emoji_in_as_text_mode:true});else i=TS.emoji.graphicReplace(r,{obey_emoji_mode_pref:!n.ignore_emoji_mode_pref,include_title:true,include_text:!n.no_emoji_text,jumbomoji:n.do_jumbomoji,stop_animations:n.stop_animations});if(i&&-1!==i.indexOf(">>"))TS.warn("TS.emoji.graphicReplace may be malformed: "+i);return i};var M=function e(t,n,r,i){var a=n.replace(/<|>/g,"");if(TS.boot_data.feature_name_tagging_client){var s=TS.utility.msgs.getMemberIdFromMemberMarkup(a);if(!TS.interop.utility.looksLikeMemberId(s))return a}var o=TS.utility.msgs.getMemberFromMemberMarkup(a);if(o&&"EDIT"!==t&&"GROWL"!==t)if(o.is_unknown)return TS.templates.unknown_member();else if(o.is_non_existent&&TS.interop.utility.looksLikeMemberId(o.id))return TS.templates.message_member_non_existent({id:o.id});if(!o){if("GROWL"===t)return n;var l=a.split("|");if(l.length>1&&l[1])return"@"+l[1];if(!TS.boot_data.feature_shared_channels_client&&TS.interop.utility.looksLikeMemberId(a))setTimeout(function(){if(!TS.members.getMemberById(a)){var e="member_not_found_in_markup";var s=true;TS.console.logError({item:n,guts:a,tsf_mode:t,no_highlights:r,no_linking:i},"",e,s)}},3e4);return a}var u=["internal_member_link"];var d={"member-id":o.id,"member-name":o.name,"stringify-text":"@"+o.id};if(o.is_bot&&o.profile){var c=_.get(o.profile,"bot_id");if(c){d["bot-id"]=c;var m=TS.bots.getBotById(c);if(_.get(m,"app_id"))d["app-id"]=m.app_id}u=_.pull(u,"internal_member_link");u.push("app_preview_link")}var f="";_.forEach(d,function(e,t){f+="data-"+t+'="'+e+'" '});var p="@"+o.name;var h;if(TS.boot_data.feature_texty_mentions){if(TS.boot_data.feature_name_tagging_client){p=TS.members.getPrefCompliantMemberName(o,true,true);u.push("ts_tip ts_tip_top ts_tip_lazy ts_tip_float ts_tip_member");f+='data-tip-member="'+o.id+'" '}if("EDIT"===t){if(TS.boot_data.feature_name_tagging_client)return"<@"+o.id+"|"+p+">";return"@"+o.name}if("GROWL"===t||!TS.permissions.members.canUserSeeMember(o))return p;h=TS.utility.shouldLinksHaveTargets()?'target="/team/'+o.id+'" ':"";if(o.id==TS.model.user.id)u.push("mention");if(i)return p;f+='data-member-label="'+p+'" ';return'<a href="/team/'+o.id+'" '+h+f+'class="'+u.join(" ")+'">'+p+"</a>"}if("EDIT"===t||"GROWL"===t)return"@"+o.name;if(TS.permissions.members.canUserSeeMember(o)&&!i){h=TS.utility.shouldLinksHaveTargets()?'target="/team/'+o.name+'" ':"";if(!r)p=v(p);return'<a href="/team/'+o.name+'" '+h+f+'class="'+u.join(" ")+'">'+p+"</a>"}return p};var I=function t(r,i,a,s){if(TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_default_shared_channels){var o=TS.shared.getActiveModelOb()||{};if(o.is_shared&&TS.channels.isChannelOrgDefault(o)){a=true;s=true}}var l=i.replace(/<|>/g,"");var u=l.split("|");var d=u[0].substr(1);if(_.includes(e,d)){if(TS.boot_data.feature_tinyspeck||TS.boot_data.feature_texty_mentions){var c=TS.interop.format.formatBroadcastCommand({type:d,featureLocalization:TS.boot_data.feature_localization,featureNameTaggingClient:TS.boot_data.feature_name_tagging_client});if("GROWL"===r||"EDIT"===r||s)return c;return'<b class="mention" data-broadcast-id="BK'+d+'" data-stringify-text="'+c+'">'+c+"</b>"}if("GROWL"===r||"EDIT"===r||s){if("EDIT"===r&&TS.boot_data.feature_name_tagging_client)return"<@BK"+d+"|@"+d+">";return"@"+d}if(TS.boot_data.feature_localization)d=n[d]||d;return'<b class="mention">@'+d+"</b>"}var m=u[1]?u[1]:d;if(-1!==d.indexOf("^")){var f=d.split("^");d=f.shift();if("date"===d&&f.length>=2){var p=f[0];var h=f[1];var g=TS.interop.datetime.formatDate(p,h,{fallbackString:m});var S=f.length>2?f[2]:"";if("GROWL"===r||"EDIT"===r||!S||s)return g;return"<a "+TS.utility.makeRefererSafeLink(S)+' target="_blank">'+g+"</a>"}else if("team"===d&&1===f.length){var T=m;var b=TS.teams.getTeamById(f[0]);if(b)T=b.name;if("GROWL"===r||"EDIT"===r)return"*"+T+"*";return TS.templates.format_team({team:b,fallback:T})}else if("subteam"===d&&1===f.length){var y=TS.user_groups.getUserGroupsById(f[0]);if(y&&y.handle){var w=TS.utility.shouldLinksHaveTargets()?'target="/usergroups/'+y.id+'" ':" ";var k=_.escape(y.handle);var x=a||"EDIT"===r?"@"+k:v("@"+k);var C=["internal_user_group_link"];if("GROWL"===r||"EDIT"===r){if("EDIT"===r&&TS.boot_data.feature_name_tagging_client)return"<@"+y.id+"|"+x+">";return"@"+y.handle}if(s)return x;if(TS.boot_data.feature_texty_mentions){x="@"+k;if(!a&&-1!==TS.model.highlight_words.indexOf("@"+k))C.push("mention")}return'<a href="/usergroups/'+y.id+'" '+w+'data-user-group-id="'+y.id+'" class="'+C.join(" ")+'" data-stringify-text="@'+k+'">'+x+"</a>"}if("GROWL"!==r&&"EDIT"!==r)return m}else{if("GROWL"===r||"EDIT"===r)return"<"+m+">";return"&lt;"+m+"&gt;"}}else{if("GROWL"===r||"EDIT"===r)return"<"+m+">";return"&lt;"+m+"&gt;"}return""};var A=function e(t,n,r){var i=n.split(" ")[1].replace(">","");if(!r)return' <div class="inline_color_block" style="background:'+i+';"></div>';return""};var E=function e(t,n){var r="Switch sidebar theme";if(n)r+=" ("+n+")";return'<a data-theme="'+_.escape(t)+'" class="btn btn_small btn_outline very_small_top_margin very_small_bottom_margin tiny_right_margin theme_installer_btn">'+r+"</a>"};var F=function e(t){if(t&&t.length)return'<br/><span class="theme_install_btns">'+t.join(" ")+"</span>";return""};function O(e,t,n){var r=e.lastIndexOf(" ",n);var i=-1!==r?r+1:0;var a=e.substring(i,n+t.length);var s=TS.utility.findUrls(a).length>0;return s}function B(e){switch(e){case TSF.PRE_START:return TSF.CODE_START;case TSF.PRE_END:return TSF.CODE_END}return e}function H(e){var t=document.createElement("div");t.innerHTML=e;return t.textContent}function D(e){var t=TS.members.getPrefCompliantMemberName(e);var n=_.escape(t);var r=TS.templates.member_slug({member_username:e.name,member_id:e.id,member_name:new Handlebars.SafeString(n)}).trim();return{html:r,txt:H(r)}}function P(e,n){if(!e)return"";if(!n)n={};if(TS.utility.contenteditable.supportsTexty())e=TS.format.replaceUnicodeDoppelgangers(e);var r=[];if(TS.boot_data.feature_name_tagging_client){if(TS.boot_data.feature_ignore_code_mentions)e=TSF.replaceFormatContents(r,e,{replace_pre:true,replace_code:true});var s=[];e=TS.format.texty.replaceFormatMentions(s,e,n.do_specials);if(n.do_specials)e=TSF.getTokensString(e,"CLEAN",{jumbomoji:TS.model.prefs.jumbomoji});s.forEach(function(t){e=e.replace(t.placeholder,t.mention)})}else{if(n.do_specials)e=TSF.getTokensString(e,"CLEAN",{jumbomoji:TS.model.prefs.jumbomoji});if(TS.boot_data.feature_ignore_code_mentions)e=TSF.replaceFormatContents(r,e,{replace_pre:true,replace_code:true});e=e.replace(i,function(r,i,a,s,o){if("/"===i&&O(e,r,o))return r;var l="";var u=a.toLowerCase();var d;for(var c=0;c<t.length;c++)if(t[c].regex.test(u)){d=t[c].cmd;l=u.substr(t[c].name.length);c=t.length}if(d)return i+d+l;var _=TS.members.getMemberByName;if(TS.boot_data.feature_shared_channels_client)_=function e(t){return TS.members.getMemberByNameAndTeamId(t,TS.model.team.id)};var m=R(TS.members.getMemberById,s,_,a);if(m.model_ob){var f;if(n.human_readable)f="@"+m.model_ob.name;else f="<@"+m.model_ob.id+">";return i+f+m.extra}m=R(TS.user_groups.getUserGroupsById,s,TS.user_groups.getUserGroupsByHandle,a);if(m.model_ob){var p;if(n.human_readable)p="@"+m.model_ob.handle;else p="<!subteam^"+m.model_ob.id+"|@"+m.model_ob.handle+">";return i+p+m.extra}return i+a})}e=e.replace(a,function(t,r,i,a,s){if("/"===r&&O(e,t,s))return t;var o=R(TS.channels.getChannelById,i.substr(1),TS.channels.getChannelByName,i);if(o.model_ob){var l;if(n.human_readable)l="#"+o.model_ob.name;else l="<#"+o.model_ob.id+"|"+o.model_ob.name+">";return r+l+o.extra}return r+i});if(TS.model.prefs.convert_emoticons&&"as_text"!==TS.model.prefs.emoji_mode)e=TS.format.doEmoticonConversion(e);if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)e=TSFEmoji.translateEmojiStringToCanonical(e,TS.i18n.locale());if(TS.boot_data.feature_ignore_code_mentions){if(TS.boot_data.feature_name_tagging_client)r=r.map(function(e){var t=TS.format.texty.convertContentsStringToContents(e.str);e.str=_.reduce(t.contents,function(e,t){return e+t.insert},"");if(n.do_specials)e.str=TSF.getTokensString(e.str,"CLEAN",{jumbomoji:TS.model.prefs.jumbomoji});return e});e=TSF.swapOutPlaceholders(r,e)}return e}function j(e){if(!TS.boot_data.feature_shared_channels_client)return false;var t=e.split("+");if(2!==t.length)return false;var n=t[0];var r=t[1];if(!TS.utility.strLooksLikeATeamId(r)){var i=TS.teams.getTeamByDomain(r);r=i?i.id:false}if(!r)return false;return TS.members.getMemberByNameAndTeamId(n,r)}function R(e,t,n,r){var i;var a="";var s;if(_.isFunction(e)&&_.isString(t)){i=t.substring(0,TS.model.model_ob_id_length);s=e(i);if(s)a=t.substring(TS.model.model_ob_id_length)}if(!s)s=n(r);if(!s&&_.isString(t))s=j(t);var o=[".","..","...","....","-","--","_","…"];var l=0;while(!s&&l<o.length){var u=o[l];if(r&&r.substr(r.length-u.length,u.length)==u){i=r.substr(0,r.length-u.length);s=n(i);if(!s)s=j(i.replace(/^@/,""));if(s)a=u}l+=1}return{model_ob:s,extra:a}}var L=function e(t){if(!t||t instanceof Text)return false;return _.some(u,function(e,n){return t.hasAttribute(n)})};var U=function e(t){if(!N)N=TSF.LINK_START.split(" ")[0];if(_.startsWith(t,N))return true;if(t===TSF.LINK_END)return true;return false};var N})()},4256:function(e,t){(function(){"use strict";TS.registerModule("menu",{$menu:null,$submenu:null,$submenu_origin:null,$submenu_parent:null,$menu_header:null,$menu_items:null,$menu_list_container:null,$menu_list:null,$menu_footer:null,menu_lazy_load:null,user_group:null,end_tim:0,$target_element:null,$secondary_target_element:null,members_html_cache:null,large_list_trigger:1500,large_dom_trigger:500,watching_members_model:false,menu_items_hidden:true,has_submenu:false,menu_closed_sig:new signals.Signal,onStart:function e(){},buildIfNeeded:_.once(function(){TS.menu.$menu=$(TS.templates.menu());var e=TS.menu.$menu;if("mobile"!==TS.boot_data.app&&"0"!=TS.qs_args.new_scroll){if(TS.client)e.appendTo($("#client-ui"));else e.appendTo($("body"));if(!TS.environment.supports_custom_scrollbar){var t="1"==TS.qs_args.debug_scroll;e.find("#menu_items_scroller").monkeyScroll({debug:t})}e.detach()}TS.menu.$menu_header=e.find("#menu_header");TS.menu.$menu_body=e.find(".menu_body");TS.menu.$menu_list_container=e.find("#menu_list_container");TS.menu.$menu_list=e.find("#menu_list");TS.menu.$menu_items=e.find("#menu_items");TS.menu.$menu_footer=e.find("#menu_footer")}),handleTopicKeydown:function e(t){var n=TS.utility.keymap;if(t.which==n.enter&&!t.shiftKey&&!t.altKey){var r=$(t.target);var i=TS.shared.getActiveModelOb();var a=$.trim(r.val());if(i.topic.value===a){TS.menu.end();return}if(i.is_group)TS.groups.setTopic(i.id,a);else if(i.is_channel)TS.channels.setTopic(i.id,a);TS.menu.end()}},startWithList:function e(t,n,r){if(!n||!n.length)return;if(TS.menu.isRedundantClick(t))return;r=r||{};TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(n.html());TS.menu.$menu.addClass(r.menu_class);if(r.close_on_click||r.onClick)TS.menu.$menu_items.on("click.menu","li",function(e){if("function"===typeof r.onClick)r.onClick(e);if(r.close_on_click)TS.menu.end()});TS.menu.start(t,void 0,r);if(r.attach_to_target_at_full_width)TS.menu.$menu.css({width:"100%",top:"calc(100% + 3px)",left:"0"});else{var a=i(r.align_right);TS.menu.positionAt(TS.menu.$target_element,a.left,a.top)}},startWithDatePicker:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_date_picker_items());TS.menu.$menu_items.on("click.menu","li",TS.menu.onDatePickerItemClick);TS.menu.$menu.attr("data-qa","date_picker_menu");var n=$("#date_picker_cal_container");TS.ui.date_picker.startJumpToDatePicker(n);TS.menu.$menu.addClass("date_picker")},onDatePickerItemClick:function t(n){var r=$(this).attr("id");var i=TS.shared.getActiveModelOb();if($(this).hasClass("disabled")){TS.menu.end();return}if("date_picker_back_item"===r){n.preventDefault();e=true;if(i.is_channel||i.is_mpim)TS.menu.channel.startWithChannel(n,i.id);else if(i.is_im)TS.menu.member.startWithMember(n,i.user,false,false,true);else if(i.is_group)TS.menu.group.startWithGroup(n,i.id);TS.menu.$menu.removeClass("date_picker");return}TS.warn("not sure what to do with clicked element id:"+r)},startWithMessageActions:function e(t,n,r,i){if(TS.client&&!TS.model.ms_connected){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var s=TS.utility.msgs.getMsg(n,r);i=i||TS.shared.getActiveModelOb();if(!s)s=TS.ui.replies.getActiveMessage(i,n);if(!s&&TS.model.threads_view_is_showing)s=TS.client.threads.getMessage(i,n);if(!s&&TS.model.unread_view_is_showing)s=TS.client.unread.getMessage(i,n);var o=TS.utility.msgs.getMsgActions(s,i);var l=TS.model.unread_view_is_showing;var u=o.mark_unread&&!s.is_briefing_message&&(TS.utility.msgs.getMarkMsgTSForUnreadPoint(n,r,i)||l)&&!TS.model.archive_view_is_showing&&!s.is_ephemeral;o.mark_unread=!!u;var d={msg:s,actions:o,model_ob:i,is_all_unreads_showing:TS.model.unread_view_is_showing,is_channel_or_group:i.is_channel&&!i.is_mpim||i.is_group&&!i.is_mpim};var c=$(t.target);d.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(i,s.ts,s.thread_ts);if("file_share"===s.subtype||"file_mention"===s.subtype)if(s.file)d.abs_permalink=s.file.permalink;if(TS.replies.canReplyToMsg(i,s)){d.can_subscribe=true;d.subscription=TS.replies.getSubscriptionState(i.id,s.ts);d.context=TS.ui.thread.getContextForEl(c);if(!d.subscription)TS.replies.promiseToGetSubscriptionState(i.id,s.ts).then(function(e){a(i.id,s.ts,e)});d.prefs_threads_everything=_.get(TS,"model.prefs.threads_everything")}d.is_in_conversation=c.closest("ts-conversation").length>0;var m=c.closest("#threads_msgs").length>0;var f=d.is_in_conversation||m;var p=TS.boot_data.feature_sli_briefing&&c.closest("#sli_briefing").length>0;o.mark_unread=o.mark_unread&&!f&&!p;if(f&&"tombstone"===s.subtype)o.has_private_actions=false;if(TS.boot_data.feature_new_broadcast)if("thread_broadcast"===s.subtype){if(!f&&o.delete_msg)o.delete_msg=false;if(f&&o.remove_broadcast||i.is_channel&&!i.is_member)o.remove_broadcast=false}TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_message_action_items(d));TS.menu.$menu_items.on("click.menu","li",TS.menu.onMessageActionClick);TS.log("enabled reminders msg action menu");TS.menu.has_submenu=true;var h=TS.menu.$menu_items.find("#remind_me");h.on("highlighted",function(){h.submenu({items_html:TS.templates.remind_me_items(),onclick:_.partial(TS.menu.onMessageRemindClick,i,s,f)})}).on("unhighlighted",function(){if(TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active"))h.submenu("destroy")});TS.menu.start(t);TS.menu.$target_element=c.closest("[data-action]");TS.menu.$target_element.addClass("active");TS.menu.$secondary_target_element=c.closest("ts-message");TS.menu.$secondary_target_element.addClass("active");var g=0;var S=c.width()+10;if(TS.client&&!TS.model.ui_state.flex_visible)S=-(TS.menu.$menu.width()+10);var T=TS.menu.$menu.find("#edit_link");if(0===T.length)T=TS.menu.$menu.find("#rxn_link");if(T.length>0){var v=TS.menu.$menu.offset().top;var b=T.offset().top;g=-(b-v+T.height()/2-5)}TS.menu.positionAt(c,S,g);TS.menu.keepInBounds()},onMessageActionClick:function e(t){t.preventDefault();if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var n=$(this);var r=n.attr("id");var i=n.data("msg-ts");var a=n.data("model-ob-id");var s=n.data("rxn-key");var o=a?TS.shared.getModelObById(a):TS.shared.getActiveModelOb();var l;if("edit_link"===r){var u=n.data("edit-state");TS.msg_edit.startEdit(i,o,u)}else if("delete_link"===r)TS.msg_edit.startDelete(i,o);else if("open_in_channel"===r){l=n.attr("data-thread-ts");TS.client.ui.tryToJump(o.id,l)}else if("open_thread_in_flexpane"===r){var d=TS.utility.msgs.findMsg(i,o.id);if(d&&TS.replies&&TS.replies.canReplyToMsg(o,d)){l=d.thread_ts||d.ts;TS.ui.replies.openConversation(o,l)}}else if("toggle-subscription-status"===r){var c=n.data("subscribed");var m;var f=TS.utility.msgs.findMsg(i,a);if(f&&f.replies&&f.replies.length)m=_.last(f.replies).ts;n.addClass("disabled");TS.replies.setSubscriptionState(a,i,!c,m);var p=c?"THREADS_UNFOLLOW_CLICKED":"THREADS_FOLLOW_CLICKED";var h=n.data("context");var g=_.get(f,".reply_count",0)+1;TS.ui.thread.trackEvent(a,i,h,p,{num_msg_in_thread:g})}else if("pin_link"===r)TS.pins.startPinMessage(i,o);else if("unpin_link"===r)TS.pins.unPinMessage(i,o);else if("rxn_link"===r)TS.ui.react_emoji_menu.start({e:t,rxn_key:s});else if("mark_unread"===r)if(TS.model.unread_view_is_showing)TS.client.ui.unread.setUnreadPoint(i);else{TS.info("setting unread point on "+o.id+" due to message action click ("+i+")");TS.client.msg_pane.setUnreadPoint(i)}else if("copy_link"===r){TS.clipboard.writeText($(this).data("permalink"));var S=TS.menu.$secondary_target_element;var T={message_timestamp:i,channel_id:a,channel_type:a[0]||"",member_id:S.data("member-id"),app_id:S.data("app-id"),bot_id:S.data("bot-id")};TS.clog.track("MSG_LINK_COPY",T)}else if("open_original_link"===r);else if("share_message_link"===r)TS.ui.share_message_dialog.start(i,o);else if("remove_broadcast_link"===r)TS.msg_edit.startRemoveBroadcast(i,o);else if("remind_me"===r)return;TS.menu.end()},onMessageRemindClick:function e(t,n,r,i){var a=$(i.target).data("msg-action");if("remind"===a){var s={time:$(i.target).data("remind-length"),message_channel:t.id,message_ts:n.ts};if("thread_broadcast"===n.subtype&&!r)s.respond_in_channel=true;TS.api.call("reminders.addFromMessage",s,function(){})}TS.menu.end()},startWithCommentActions:function e(t,n,r){if(TS.client&&!TS.model.ms_connected){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.files.getFileById(n);if(!i)return;var a=TS.files.getFileCommentById(i,r);if(!a)return;var s=TS.shared.getActiveModelOb();var o=TS.files.getFileCommentActions(a,i);TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_comment_action_items({model_ob:s,file:i,comment:a,actions:o}));var l=$(t.target);TS.menu.$menu_items.on("click.menu","li",function(e){var t=l.closest(".comment_actions");TS.menu.onCommentActionClick(e,t)});TS.menu.start(t);var u=0;var d=-(TS.menu.$menu.width()+10);var c=TS.menu.$menu.find("#edit_file_comment");if(0===c.length)c=TS.menu.$menu.find("#rxn_file_comment");if(c.length>0){var _=TS.menu.$menu.offset().top;var m=c.offset().top;u=-(m-_+c.height()/2-5)}TS.menu.positionAt(l,d,u);TS.menu.keepInBounds()},onCommentActionClick:function e(t,n){t.preventDefault();var r=$(t.target).closest("[id]");var i=r.attr("id");var a=r.data("rxn-key");var s=TS.shared.getActiveModelOb();if("edit_file_comment"===i)TS.ui.comments.startEdit(r.data("file-id"),r.data("comment-id"),n);else if("delete_file_comment"===i)TS.ui.comments.startDelete(r.data("file-id"),r.data("comment-id"));else if("rxn_file_comment"===i)TS.ui.react_emoji_menu.start({e:t,rxn_key:a});else if("pin_comment"===i&&s)TS.pins.startPinFileComment(r.data("comment-id"),r.data("file-id"),s);else if("unpin_comment"===i&&s)TS.pins.unPinFileComment(r.data("comment-id"),r.data("file-id"),s);else{TS.warn("not sure what to do with clicked element id:"+i);return}TS.menu.end()},startWithSpaceWeb:function e(t,n,r){var i=5;if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var a=TS.files.getFileById(n);if(!a)return;var s=TS.files.getFileActions(a);var o=a.channels.concat(a.groups).concat(a.ims);var l=a.user==r&&o.length&&"uneditable"!==a.state;var u={file:a,actions:s,can_write_to_clipboard:TS.clipboard.canWriteText(),can_enable_collab_editing:l,collab_enabled:"locked"!==a.state&&"uneditable"!==a.state};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_space_action_items(u));TS.menu.$menu_items.on("click.menu","li",TS.menu.onSpaceClickWeb);TS.kb_nav.setSubmitItemHandler(TS.menu.onSpaceClickWeb);TS.menu.start(t);var d=$(".space_btn_more");$("#toggle_input").bind("change",function(){t.preventDefault();var e=$("#toggle_collab_editing");var n=$(this);e.addClass("disabled");n.prop("disabled",true);TS.web.space.lockEditingPrivilegesWithCallback(n.prop("checked"),function(t){var r=t&&t.data;var i=r?"locked"!==r.state:!n.prop("checked");e.removeClass("disabled");n.prop("disabled",false);n.prop("checked",i)})});var c=-TS.menu.$menu.outerWidth()+d.outerWidth();var _=d.outerHeight()+i;TS.menu.positionAt(d,c,_)},onSpaceClickWeb:function e(t){var n=$(this).attr("id");var r=TS.files.getFileById($(this).data("file-id"));if(!r)return;if("keyboard_shortcuts"===n){t.preventDefault();TS.ui.shortcuts_dialog.start(true)}else if("learn_more"===n);else if("feedback"===n){t.preventDefault();TS.web.space.provideFeedback()}else if("delete_space"===n){t.preventDefault();TS.web.file.deleteFile(r.id)}else if("copy_space_link"===n){t.preventDefault();if(TS.clipboard.canWriteText())TS.clipboard.writeText(r.permalink);else TS.warn("User clicked copy link, but we can't write to the clipboard right now")}else if("create_public_space_link"===n){t.preventDefault();TS.files.createPublicURL(r)}else if("view_public_space_link"===n){t.preventDefault();TS.web.space.showPublicUrlDialog()}else if("print_space"===n){window.print();t.preventDefault()}else if("toggle_collab_editing"===n)return;else{t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}TS.menu.end()},startWithTeamAndUser:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.startWithTeamAndUserRebuild(t);if(TS.boot_data.page_needs_enterprise)TS.menu.listenForRebuildWorthiness()},did_start_slack_menu_signal_listeners:false,listenForRebuildWorthiness:function e(){TS.menu.did_start_slack_menu_signal_listeners=true;TS.client.user_added_to_team_sig.add(TS.menu.startWithTeamAndUserRebuild);TS.client.user_removed_from_team_sig.add(TS.menu.startWithTeamAndUserRebuild)},stopListeningForRebuildWorthiness:function e(){TS.menu.did_start_slack_menu_signal_listeners=false;TS.client.user_added_to_team_sig.remove(TS.menu.startWithTeamAndUserRebuild);TS.client.user_removed_from_team_sig.remove(TS.menu.startWithTeamAndUserRebuild)},startWithTeamAndUserRebuild:function t(n){TS.menu.clean();TS.menu.submenu_template_args={};var r=TS.model&&TS.model.team&&TS.boot_data.feature_tinyspeck;var i=TS.environment.is_dev;var a=r||i;var s=TS.boot_data.feature_global_nav&&$(n.target).closest("#global_nav_user_menu_btn").length;var o={user:TS.model.user,team:TS.model.team,team_name:TS.model.team.name,logout_url:TS.boot_data.logout_url,signin_url:TS.boot_data.signin_url,help_url:TS.boot_data.help_url,show_version_info:a,current_team_is_in_enterprise:false,current_team_gets_logout_url:true,show_apps_link:TS.apps.isAppSpaceEnabled()&&TS.apps.isAppmin(),show_customize_link:TS.model.user.is_admin||!TS.model.team.prefs.emoji_only_admins||!TS.model.team.prefs.slackbot_responses_only_admins||!TS.model.team.prefs.loading_only_admins,show_statistics_link:TS.model.user.is_admin||!TS.model.team.prefs.stats_only_admins&&!TS.model.user.is_restricted,is_our_app:TS.model.is_our_app,show_team_subdivider:TS.model.user.is_admin,can_invite:TS.ui.admin_invites.canInvite(),can_view_shared_invites:TS.ui.shared_invites_modal.userCanViewSharedInvitesModal(),is_user_menu:s};var l=Object.keys(TS.boot_data.other_accounts).length;if(l)o.other_accounts=TS.boot_data.other_accounts;if(TS.model.team.enterprise_id)o.current_team_is_in_enterprise=true;var u=false;var d=_.merge({},TS.boot_data.other_accounts);var c={};for(var m in d)if(d[m].enterprise_id){if(!o.other_enterprise_accounts){u=true;o.other_enterprise_accounts=_(d).filter(function(e){return e.enterprise_id}).groupBy("enterprise_id").map(function(e){var t={};t.enterprise_id=e[0].enterprise_id;t.enterprise_name=e[0].enterprise_name;if(TS.model.user.enterprise_user&&t.enterprise_id===TS.model.user.enterprise_user.enterprise_id){var n=TS.model.enterprise_teams;var r=[];TS.model.user.enterprise_user.teams.forEach(function(t){if(t===TS.model.team.id)return;var i=n.filter(function(e){return e.id===t})[0];if(!i)return;r.push({team_id:t,team_url:e[0].team_url.replace(/\/[a-z0-9]+\./i,"/"+i.domain+"."),team_name:i.name})});r=r.sort(function(e,t){if(e.team_name<t.team_name)return-1;if(e.team_name>t.team_name)return 1;return 0});t.enterprise_teams=r}else t.enterprise_teams=e;t.is_currently_logged_into=false;if(t.enterprise_id===TS.model.team.enterprise_id){t.is_enterprise_currently_logged_into=true;if(o.current_team_is_in_enterprise)o.current_team_gets_logout_url=false;o.enterprise_logout_url=TS.boot_data.enterprise_logout_url;o.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}else{t.needs_other_enterprise_logout=true;t.logout_url=TS.enterprise.workspaces.createLogoutURL(t.enterprise_id,TS.boot_data.logout_url)}return t}).value();if(TS.model.user.enterprise_user)o.other_enterprise_accounts=o.other_enterprise_accounts.sort(function(e,t){if(e.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return-1;if(t.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return 1;return 0})}}else{d[m].logout_url=TS.enterprise.workspaces.createLogoutURL(d[m].team_id,TS.boot_data.logout_url);c[d[m].team_id]=d[m]}if(u)if(Object.keys(c).length)o.other_accounts=c;else if(Object.keys(o.other_enterprise_accounts).length)delete o.other_accounts;if(o.current_team_is_in_enterprise){o.current_team_gets_logout_url=false;o.enterprise_logout_url=TS.boot_data.enterprise_logout_url;o.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}if(TS.boot_data.page_needs_enterprise){if((u||o.current_team_is_in_enterprise)&&(o.other_enterprise_accounts&&Object.keys(o.other_enterprise_accounts).length||o.other_accounts&&Object.keys(o.other_accounts).length))o.show_switch_teams_submenu=true;o.can_show_leave_workspace=TS.permissions.enterprise.canUserLeaveTeam(TS.model.user,TS.model.team)}o.show_shared_channels=TS.boot_data.page_needs_enterprise&&!TS.model.user.is_restricted;TS.menu.$menu.addClass("team_menu slack_menu");TS.menu.$menu.attr("data-qa","team_menu");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_body.html(TS.templates.menu_slack_menu(o));TS.menu.$menu_items.addClass("hidden");var f=TS.menu.$menu_body;f.on("click.menu","li",TS.menu.onTeamAndUserItemClick);f.on("click.menu",".member_preview_link",function(e){e.preventDefault();TS.client.ui.previewMember(TS.model.user.id)});f.on("mouseenter.section_header","> div.section_header",TS.kb_nav.clearHighlightedItem);TS.kb_nav.setSubmitItemHandler(TS.menu.onTeamAndUserItemClick);if(TS.boot_data.page_needs_enterprise){TS.menu.submenu_template_args.administration={};TS.menu.submenu_template_args.switch_teams=o}var p=55;if(TS.model.is_electron&&TS.model.is_mac&&TSSSB.call("isMainWindowFrameless")&&!TS.boot_data.feature_global_nav)p+=7;if(TS.boot_data.page_needs_enterprise&&"string"===typeof n)e=true;TS.menu.has_submenu=true;TS.menu.submenu_template_args.member_current_status_item={member:TS.model.user};TS.menu.start(n,void 0,{needs_to_remain_open:function e(){return TS.ui.react_emoji_menu.is_showing}});if(s)TS.menu.positionAt($("#global_nav_user_menu_btn"),10,p-13);else TS.menu.positionAt($("#team_menu"),10,p);TS.view.members.updateUserDisplayName();TS.view.members.updateUserCurrentStatus();f.on("highlighted","li:not(.divider)",TS.menu.onTeamAndUserItemMouseenter)},onTeamAndUserItemMouseenter:function e(t){if(!$(this).hasClass("has_submenu")||"member_current_status_item"===$(this).attr("id"))if(TS.menu._current_status_input&&TS.menu._current_status_input.isEdited())return;if(TS.menu.$submenu&&TS.menu.$submenu_parent)TS.menu.$submenu_parent.submenu("destroy");if($(t.currentTarget).hasClass("has_submenu")){var n=$(this).attr("id")||$(this).data("action");var r=TS.menu.$menu_body;var i={};if(TS.menu.submenu_template_args[n])i=TS.menu.submenu_template_args[n];switch(n){case"administration":if(TS.model.user.enterprise_user&&(TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner)){i.show_org_settings=true;i.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}TS.menu.$submenu_parent=r.find("#administration");TS.menu.$submenu_parent.submenu({items_html:TS.templates.administration_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"switch_teams":TS.menu.$submenu_parent=r.find("#switch_teams");TS.menu.$submenu_parent.submenu({items_html:TS.templates.switch_teams_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"member_current_status_item":TS.menu.$submenu_parent=r.find("#member_current_status_item");TS.menu.$submenu_parent.submenu({items_html:TS.templates.current_status_submenu(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick,ondestroy:TS.menu._unregisterCurrentStatusInput});TS.menu._registerCurrentStatusInput();break;case"team_invitations":if(!TS.ui.shared_invites_modal.userCanViewSharedInvitesModal())break;TS.menu.$submenu_parent=r.find("#team_invitations");TS.menu.$submenu_parent.submenu({items_html:TS.templates.shared_invites_modal()});TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"impression",ui_element:"share_invite_link_modal"},referring_ui_context:{step:"invite_people",ui_element:"invite_people_menu"}},referring_event_id:"INAPP_INVITES"});TS.ui.shared_invites_modal.start()}}},onTeamAndUserItemSubmenuClick:function e(t){var n=$(t.target).closest("li");var r=n.attr("id")||n.data("action");switch(r){case"team_settings":case"manage_team":case"switch_team":case"logout":case"enterprise_logout":case"org_settings":break;default:if(!t||!t.target||"_blank"!==t.target.getAttribute("target"))t.preventDefault();return}if(TS.menu.$submenu&&TS.menu.$submenu_parent)TS.menu.$submenu_parent.submenu("destroy");TS.menu.end()},onTeamAndUserItemClick:function e(n){clearTimeout(TS.menu.end_time);var r=$(this);if(r.is("[disabled]")||r.hasClass("disabled")){n.preventDefault();return}var i=r.attr("id");if(!i&&r.hasClass("switch_team"))i="switch_team";switch(i){case"leave_workspace":n.preventDefault();TS.ui.leave_team_dialog.start(TS.model.team.id);break;case"workspaces":n.preventDefault();TS.ui.workspaces.start();break;case"shared_channels":n.preventDefault();TS.ui.enterprise_shared_channels_invites.start();break;case"version_info":n.preventDefault();TS.ui.showVersionInfo();break;case"member_account_item":n.preventDefault();TS.client.ui.previewMember(TS.model.user.id);break;case"team_settings":case"manage_team":case"team_billing":case"team_pricing":case"team_services":case"team_customize":case"team_statistics":break;case"team_apps":TS.metrics.count("team_menu_download_apps");n.preventDefault();TS.magic_login.execute({fallback_to_browser:true,browser_uri:"/downloads",app_uri:"/ssb/open"});break;case"team_invitations":if(TS.ui.shared_invites_modal.userCanViewSharedInvitesModal())return;n.preventDefault();TS.ui.admin_invites.start();var a=TS.clog.parseParams(this.getAttribute("data-clog-params"));TS.clog.track(this.getAttribute("data-clog-event"),a);break;case"member_prefs_item":n.preventDefault();TS.ui.prefs_dialog.start();break;case"team_help":n.preventDefault();t("team_menu");break;case"add_team":if(TSSSB.call("signInTeam"))n.preventDefault();break;case"member_presence":n.preventDefault();TS.members.toggleUserPresence();TS.menu.end_time=setTimeout(TS.menu.end,1e3);return;case"logout":n.preventDefault();if(TS.client)TS.client.windows.closeAll();TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url);break;case"enterprise_login":if(TSSSB.call("signInTeam"))n.preventDefault();break;case"enterprise_logout":break;case"switch_team":var s=$(this).data("user-id");if(TSSSB.call("displayTeam",s))n.preventDefault();else{var o=$(this).find("a").attr("href");if(o&&-1==o.indexOf("?"))$(this).find("a").attr("href",[o,TS.getQsArgsForUrl()].join("?"))}break;default:n.preventDefault();return}TS.menu.end()},startWithNotificationsMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var n=TS.dnd.memberDndStatus();var r=TS.shared.getActiveModelOb();var i;if(r.is_mpim)i=TS.mpims.getDisplayName(r,false,false);else if(r.is_channel||r.is_group)i="#"+r.name;else i=r.name;var a={user:TS.model.user,model_ob:r,model_ob_name:i,in_dnd:n.in_dnd,is_snoozing:n.snoozed,readable_end_time:n.readable_end_time,cmd_key:TS.model.is_mac?"⌘":"ctrl",meta_key:TS.model.is_mac?"opt":"alt"};TS.menu.has_submenu=true;TS.menu.$menu.addClass("notifications_menu");TS.menu.$menu_header.html(TS.templates.notifications_header(a));TS.menu.$menu_items.html(TS.templates.notifications_items(a));TS.menu.$menu_items.on("click.menu","li",TS.menu.onNotificationsMenuItemClick);var s=TS.menu.$menu_items.find("#adjust_snooze_time");s.on("highlighted",function(){s.submenu({items_html:TS.templates.snooze_items(),onclick:TS.menu.onNotificationsMenuItemClick})}).on("unhighlighted",function(){if(TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active"))s.submenu("destroy")});TS.menu.start(t);TS.menu.positionAt($("#team_menu .notifications_menu_btn"),-10,24)},onNotificationsMenuItemClick:function e(t){var n=$(t.target).closest("[data-dnd-menu-action]");if(!n.length)return;var r=n.data("dnd-menu-action");var i=TS.dnd.memberDndStatus();if("turn_off"===r){if(i.snoozed)TS.dnd.endSnooze();else if(i.in_dnd)TS.dnd.endDnd()}else if("snooze"===r){var a=parseInt(n.data("snooze-length"),10);if(a&&!isNaN(a))TS.dnd.setSnooze(a)}else if("dnd_schedule"===r)TS.ui.prefs_dialog.start("notifications","#prefs_dnd");else if("enter_focus_mode"===r){if(!TS.boot_data.feature_focus_mode)return;TS.ui.focus_mode.start()}else if("channel_settings"===r){var s=TS.shared.getActiveModelOb();TS.ui.channel_prefs_dialog.start(s.id)}else if("notif_prefs"===r)TS.ui.prefs_dialog.start("notifications");TS.menu.end()},startWithFlexMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();var n;if(TS.boot_data.page_needs_enterprise)n=TS.i18n.t("Organization Directory","menu")();else n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Workspace Directory","menu")():TS.i18n.t("Team Directory","menu")();TS.menu.$menu_items.html(TS.templates.menu_flexpane_items({special_flex_panes:TS.boot_data.special_flex_panes,show_downloads:TS.model.supports_downloads,is_enterprise:TS.boot_data.page_needs_enterprise,show_user_groups:""!==TS.model.team.plan&&!TS.model.user.is_restricted,directory_title:n}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onFlexMenuItemClick);TS.menu.start(t);TS.menu.$menu.addClass("flex_menu");TS.menu.$menu.attr("data-qa","flex_menu");var r=$("#flex_menu_toggle");var i=-(TS.menu.$menu.width()-r.width());var a=6+r.height();TS.menu.positionAt(r,i,a);TS.help.updateIcon();TS.client.whats_new.updateIcon();$("#flex_menu_toggle").addClass("menu_open");$("#flex_menu_callout").bind("click",function(){TS.menu.end()})},onFlexMenuItemClick:function e(n){var r=200;var i=$(this);var a=$(this).data("tab-id");if(a){var s=a;setTimeout(function(){if("files"===s){TS.client.ui.files.toggleFileList("all");TS.client.ui.files.filterFileList("all")}else if("team"===s)TS.client.ui.showTeamList();else if("groups"===s)TS.client.ui.showGroupsList();else{if("whats_new"===s){var e=!i.find("#whats_new_count").hasClass("hidden");if(e)TS.clog.track("WHATSNEW_ACTION",{action:"open_pane_badged",trigger:"flex_menu",step:TS.client.whats_new.getNewestID()});else TS.clog.track("WHATSNEW_ACTION",{action:"open_pane",trigger:"flex_menu",step:TS.client.whats_new.getNewestID()})}TS.client.ui.flex.openFlexTab(s)}},r)}else if($(this).data("filetype")){var o=$(this).data("filetype");var l=$("#file_list");if(!l.length||!l.children().length)if(TS.view.files.last_files_html)TS.view.files.last_files_html="";setTimeout(function(){TS.client.ui.files.toggleFileList("all");TS.client.ui.files.filterFileList(o);TS.view.files.setButtonState(o)},r)}else{var u=$(this).attr("id");if("help"===u){n.preventDefault();setTimeout(function(){t("flex_menu")},r)}}TS.menu.end()},startWithUserGroupMenu:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.user_group=TS.user_groups.getUserGroupsById(n);TS.menu.$menu.addClass("no_min_width");var r=TS.permissions.members.canCreateAndDeleteUserGroups()&&!TS.menu.user_group.date_delete;var i=TS.permissions.members.canCreateAndDeleteUserGroups()&&TS.menu.user_group.date_delete;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.user_group_items({show_user_groups_edit:TS.permissions.members.canEditUserGroups(),show_user_groups_disable:r,show_user_groups_enable:i}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onUserGroupMenuItemClick);TS.menu.start(t);TS.menu.positionAt($("#user_group_menu_toggle"),-(TS.menu.$menu.width()-$("#user_group_menu_toggle").width()),37)},onUserGroupMenuItemClick:function e(){var t=$(this).data("action");if("edit_info"===t)TS.ui.admin_user_groups.editInfo(TS.menu.user_group);else if("edit_members"===t)TS.ui.admin_user_groups.editMembers(TS.menu.user_group);else if("disable"===t)TS.ui.admin_user_groups.disable(TS.menu.user_group);else if("enable"===t)TS.ui.admin_user_groups.enable(TS.menu.user_group);else if("delete"===t)TS.ui.admin_user_groups.remove(TS.menu.user_group);TS.menu.end()},startWithSearchFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var n={search_exclude_bots:TS.model.prefs.search_exclude_bots,search_only_my_channels:TS.model.prefs.search_only_my_channels,search_only_current_team:TS.model.prefs.search_only_current_team,result_type:"messages"===TS.search.filter?"messages":"files",is_enterprise:TS.boot_data.page_needs_enterprise};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_search_filter_items(n));TS.menu.start(t);r();var i=$("#search_filter_menu_label");TS.menu.positionAt(i,-8,i.height()+10);$("#search_only_my_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_my_channels",value:!$(this).prop("checked")})});$("#search_exclude_bots_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_exclude_bots",value:!$(this).prop("checked")})});$("#search_only_current_team_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_current_team",value:!$(this).prop("checked")})});TS.menu.search_filter_is_showing=true;$("#search_filter_menu_label").addClass("active")},startWithMentionsFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var n={exclude_at_channels:TS.model.prefs.mentions_exclude_at_channels,exclude_at_user_groups:TS.model.prefs.mentions_exclude_at_user_groups,show_user_group_filter:true};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_mentions_filter_items(n));TS.menu.start(t);r();var i=$("#mentions_filter_menu_label");TS.menu.positionAt(i,-8,i.height()+10);$("#exclude_at_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_channels",value:!$(this).prop("checked")})});$("#exclude_at_user_groups_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_user_groups",value:!$(this).prop("checked")})});$("#mentions_filter_menu_label").addClass("active")},startWithEditTeamProfileListActions:function e(t,n,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var i=$(t.target);var a=TS.team.getTeamProfileFieldById(i.data("id"));var s={id:a.id,hidden:!!(a&&a.is_hidden),is_scim:r.is_scim};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.admin_menu_edit_team_profile_list_action_items(s));TS.menu.$menu_items.on("click.menu","li",n);TS.menu.start(t);TS.menu.positionAt(i.find('[data-action="edit_team_profile_list_menu"]'),-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},startWithAllUnreadsSortOrderMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var n={sort_order:TS.client.unread.getSortOrder(),is_paid_team:""!==TS.model.team.plan};TS.menu.has_submenu=true;TS.menu.$menu.addClass("all_unreads_sort_order_menu selectable");TS.menu.$menu_items.html(TS.templates.unread_sort_order_menu(n));TS.menu.$menu_items.on("click.menu","li",TS.menu.onAllUnreadsSortOrderMenuItemClick);TS.menu.addSubmenu(".priority",TS.templates.menu_help_submenu({icon:"ts_icon_emoji_objects",title:TS.i18n.t("Sorted by science","all_unreads")(),message:TS.i18n.t("This sorts your unreads based on how you use Slack.","all_unreads")()}),_.noop,true);TS.menu.start(t);TS.menu.positionAt($(".channel_header_info_count"),105,20)},onAllUnreadsSortOrderMenuItemClick:function e(t){var n=$(t.target).closest("[data-sort-order]");if(!n.length)return;var r=n.data("sortOrder");if(r===TS.client.unread.getSortOrder()){TS.menu.end();return}TS.model.prefs.all_unreads_sort_order=r;TS.prefs.setPrefByAPI({name:"all_unreads_sort_order",value:r});TS.prefs.all_unreads_sort_order_changed_sig.dispatch(r);TS.client.ui.unread.updateChannelHeader();TS.client.unread.reload();TS.menu.end()},startWithSearchableMemberListFilter:function e(t,n,r){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i={everyone_count:0,admins_count:0,guests_count:0,enterprise_filter_options:TS.boot_data.page_needs_enterprise};if(TS.features.isEnabled("retire_team_site_directory"))i.bots_count=0;if(TS.boot_data.page_needs_enterprise){_.merge(i,{is_enterprise:true,org_name:TS.model.team.enterprise_name,team_name:TS.model.team.name,everyone_count:0,org_members_count:0,org_admins_count:0,org_guests_count:0});if(TS.features.isEnabled("retire_team_site_directory"))_.merge(i,{org_bots_count:0})}_.each(n,function(e,t){i[t+"_count"]=e});if(TS.boot_data.feature_shared_channels_client){var a=[];_.each(n.external_teams,function(e,t){a.push({count:e,id:t,name:TS.teams.getTeamNameById(t)})});_.merge(i,{ext_teams:a.sort(TS.i18n.mappedSorter("name"))})}TS.menu.$menu.width($(t.target).outerWidth());TS.menu.$menu.addClass("searchable_member_list_filter_menu");TS.menu.$menu_items.html(TS.templates.searchable_member_list_filter_items(i));TS.menu.$menu_items.on("click.menu","li",function(e){TS.menu.end();r(e)});TS.menu.start(t);TS.menu.positionAt($(".searchable_member_list_filter"),16,56)},startWithSharedInvitesMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_items.html(TS.templates.shared_invites_modal());TS.menu.start(t);TS.menu.$menu_items.on("click",'[data-action="admin_invites_modal"]',function(){TS.menu.end()});TS.menu.keepInBounds()},startWithSoundsMenu:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var r=TS.boot_data.notification_sounds;r=_.reject(r,{value:"none"});var i={notification_sounds:r};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_sound_items(i));TS.menu.start(t);TS.menu.$menu_items.on("click.menu",'[data-action="set_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();n(t);TS.menu.end()}).on("click.menu",'[data-action="play_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();TS.sounds.play(t,{ignore_mute:true})});TS.menu.keepInBounds()},startWithGeneric:function e(t,n,r){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var i="";_.each(n,function(e){i+=TS.templates.menu_generic_item({label:e.label,value:e.value})});TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(i);TS.menu.start(t);TS.menu.$menu_items.on("click.menu","a[data-value]",function(){t.preventDefault();r($(this).data("value"));TS.menu.end()});TS.menu.keepInBounds()},positionAt:function e(t,n,r){n=n||0;r=r||0;var i=t.offset();var a=i.left+n;var s=i.top+r;TS.menu.$menu.css({top:s,left:a})},isRedundantClick:function e(t){if(TS.isPartiallyBooted()){t.preventDefault();TS.incremental_boot.userDidInteractWithUI();return true}if(t&&TS.menu.last_e&&(t.target==TS.menu.last_e.target||t.currentTarget==TS.menu.last_e.currentTarget))return true;return false},isLarge:function e(){return TS.menu&&TS.menu.$menu&&TS.menu.$menu.find("li").length>TS.menu.large_dom_trigger},start:function t(r,i,a){a=a||{};TS.menu.last_e=r;if(!e){var s=$(r.target).offset();var o=s.left+$(r.target).width()+10;var l=s.top;if(i){o=r.pageX+10;l=r.pageY+10}}if(_.isFunction(a.needs_to_remain_open))TS.menu.needs_to_remain_open=a.needs_to_remain_open;$(".tooltip").hide();TS.tips.hideAll();$(r.currentTarget).addClass("active");TS.menu.$target_element=$(r.currentTarget);TS.model.menu_is_showing=true;var u=TS.menu.$menu;if(a.onClose)u.one("closed",a.onClose);if(a.menu_class)u.addClass(a.menu_class);var d=TS.menu.isLarge();if(!e)u.css({top:l,left:o});var c=u.find("#menu_items_scroller");c.scrollTop(0);if(a.attach_to_target_at_full_width)TS.menu.$target_element.after(u);else if(TS.client)u.appendTo($("#client-ui"));else u.appendTo($("body"));if(a.keep_menu_open_if_target_clicked_again)TS.menu.$menu.addClass("keep_menu_open_if_target_clicked_again");if(!d&&!e){u.css("opacity",0);u.stop().transition({opacity:1},200)}else u.css("opacity",1);u.find(".menu_close").on("click",TS.menu.end);if(!a.ignore_bounds)TS.menu.keepInBounds();TS.ui.utility.updateClosestMonkeyScroller(c,true);if(TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents)TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=TS.menu.$menu_items.find(".lazy").lazyload({container:$("#menu_items_scroller"),all_images_same_size:true,throttle:250});if(!a.ignore_bounds)$(window).bind("resize",TS.menu.keepInBounds);$(window.document).bind("keydown",TS.menu.onKeyDown);$("html").bind("mousedown touchstart",TS.menu.onMouseDown);var m=u.find(".menu_list");var f=m.length?m:u.find("#menu_items");if(TS.menu.has_submenu)TS.kb_nav.start(f,"li:not(.divider)",u,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists});else TS.kb_nav.start(f,"li:not(.divider)");var p=m.length?m.first().find("a, button").first():null;if(TS.ui&&TS.ui.a11y)TS.ui.a11y.focusAndAddTabindex(p);e=false;n=a.on_esc},clean:function e(){TS.menu.$menu_footer.empty();TS.menu.$menu_header.removeClass("hidden");TS.menu.$menu.removeClass("no_min_width no_max_width profile_preview flex_menu search_filter_menu popover_menu no_icons team_menu file_menu notifications_menu all_unreads_sort_order_menu searchable_member_list_filter_menu selectable member_file_filter_menu app_card keep_menu_open_if_target_clicked_again member_file_filter_menu").css("max-height","");TS.menu.$menu.removeAttr("data-qa");TS.menu.$menu.find("#menu_items_scroller").css("max-height","");TS.menu.$menu.find(".arrow, .arrow_shadow").remove();TS.menu.$menu_items.off("mouseenter.section_header");TS.menu.$menu.removeClass("narrow_menu");TS.menu.$menu_body.off("mouseenter.section_header");TS.menu.needs_to_remain_open=void 0;TS.menu.$menu.removeClass("date_picker");if(TS.boot_data.page_needs_enterprise){TS.menu.$menu_list_container.html('<div id="menu_list" role="menu"></div>').removeClass("populated");TS.menu.$menu_list=TS.menu.$menu.find("#menu_list");TS.menu.$menu.off("keydown","#file_member_filter .member_filter")}TS.menu.$menu.removeAttr("data-model-ob-id");TS.menu.$menu.removeAttr("data-thread-ts");if(TS.SearchableMemberList&&TS.SearchableMemberList.get("member_file_filter_menu")){TS.menu.$menu.find(".searchable_member_list").remove();TS.SearchableMemberList.get("member_file_filter_menu").destroy()}if(TS.menu.$menu.find(".member_item")){TS.menu.$menu.find(".member_item").remove();TS.menu.$menu.find(".list_items").css("height",0)}n=null},end:function t(){if(_.isFunction(TS.menu.needs_to_remain_open)&&TS.menu.needs_to_remain_open())return;if(TS.menu.$submenu&&TS.menu.$submenu_parent)TS.menu.$submenu_parent.submenu("destroy");TS.menu.$menu.width("");TS.model.menu_is_showing=false;TS.menu.menu_items_hidden=true;TS.menu.has_submenu=false;TS.menu.$submenu_parent=null;TS.menu.submenu_template_args={};if(TS.menu.did_start_slack_menu_signal_listeners)TS.menu.stopListeningForRebuildWorthiness();var n=TS.menu.$menu;var r=function e(){if(TS.model.menu_is_showing)return;setTimeout(function(){if(!TS.model.menu_is_showing)TS.menu.last_e=null},50);n.detach();TS.menu.$menu_header.empty();TS.menu.$menu_footer.empty();TS.menu.$menu_items.empty();TS.menu.$menu_items.removeClass("hidden");TS.menu.$menu_body.empty();TS.menu.clean()};if(!TS.menu.isLarge()&&!e)n.stop().transition({opacity:0},200,r);else r();n.trigger("closed");if(TS.menu.$target_element){TS.menu.$target_element.removeClass("active");TS.menu.$target_element=null}if(TS.menu.$secondary_target_element){TS.menu.$secondary_target_element.removeClass("active");TS.menu.$secondary_target_element=null}TS.menu.user_group=null;TS.menu.$menu_header.unbind("click.menu");TS.menu.$menu_items.off("click.menu");TS.menu.$menu_body.off("click.menu");$(window).unbind("resize",TS.menu.keepInBounds);$(window.document).unbind("keydown",TS.menu.onKeyDown);$("html").unbind("mousedown touchstart",TS.menu.onMouseDown);TS.members.view.team_filter_changed_sig.remove(TS.kb_nav.clearHighlightedItem);$(".file_list_item.active").removeClass("active");TS.tips.unhideAll();TS.menu.search_filter_is_showing=false;$("#search_filter_menu_label").removeClass("active");$("#mentions_filter_menu_label").removeClass("active");$("#flex_menu_toggle").removeClass("menu_open");$("#channel_actions_toggle").removeClass("active");if(TS.boot_data.feature_texty_takes_over&&$("#menu_member_dm_input").length)TS.utility.contenteditable.unload($("#menu_member_dm_input"));n.removeClass("narrow_menu");setTimeout(function(){TS.menu.file.file_list_menu_up=false;$(".inline_file_preview_container.file_menu_open, .file_container.file_menu_open").removeClass("file_menu_open")},100);if(TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents){TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=null}TS.kb_nav.end();if(TS.client&&"team"!==TS.model.ui.active_tab_id&&"details"!==TS.model.ui.active_tab_id)TS.client.flex_pane.stopLocalTimeInterval();TS.menu.menu_closed_sig.dispatch()},onKeyDown:function e(t){var r=TS.utility.keymap;var i=t.which;var a=t.metaKey||t.ctrlKey||t.altKey;if(i==r.esc){if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.hasFocus($("#menu_member_dm_input")))return;t.stopPropagation();t.preventDefault();TS.menu.end();if(n)n()}else if(!a&&!TS.utility.isArrowKey(i)&&i!=r.tab&&i!=r.enter){TS.kb_nav.clearHighlightedItem();TS.utility.contenteditable.focus($("#menu_member_dm_input"))}},onLeftKeyDownIfSubmenuExists:function e(){var t=false;if(TS.menu.$submenu&&TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu_origin);var n=TS.menu.$menu.find(".menu_list");var r=n.length?n:TS.menu.$menu.find("#menu_items");TS.kb_nav.start(r,"li:not(.divider)",TS.menu.$menu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists});if(-1===["member_current_status_item","switch_teams"].indexOf(TS.menu.$submenu_origin.attr("id")))TS.menu.$submenu_origin.submenu("destroy");t=true}return t},onRightKeyDownIfSubmenuExists:function e(){var t=false;if(TS.kb_nav.getHighlightedItem()&&TS.kb_nav.getHighlightedItem().data("has-submenu"))if(!TS.menu.$submenu)TS.kb_nav.getHighlightedItem().submenu({items_html:TS.templates.snooze_items(),onclick:TS.menu.onNotificationsMenuItemClick});if(TS.menu.$submenu){if(TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.menu.end()}else{TS.menu.$submenu.addClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu.find("li:not(.divider)").first());TS.kb_nav.start(TS.menu.$submenu.find("ul"),"li:not(.divider)",TS.menu.$submenu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists})}t=true}return t},onMouseDown:function e(t){var n=$(t.target);if(TS.menu.$menu&&TS.menu.$menu.hasClass("keep_menu_open_if_target_clicked_again")&&n.is(TS.menu.$target_element))return;if(0===n.closest("#menu, .submenu, .trap_menu_clicks").length||n.hasClass("popover_mask"))TS.menu.end()},keepInBounds:function e(){if(window.requestAnimationFrame)TS.utility.rAF(TS.menu.keepInBoundsThrottled);else TS.menu.keepInBoundsThrottled()},keepInBoundsThrottled:function e(){var t=TS.menu.$menu;var n=10;var r=t.dimensions_rect();var i={top:0+n,right:$(window).width()-n,bottom:$(window).height()-(n+14),left:0+n};if(TS.utility.doesRectContainRect(i,r))return;if(r.left<i.left)t.css("left",i.left);else if(r.right>i.right)t.css("left",Math.max(i.left,i.right-r.width));if(r.top<i.top)t.css("top",i.top);else if(r.bottom>i.bottom)t.css("top",Math.max(i.top,i.bottom-r.height+$(window).scrollTop()))},addSubmenu:function e(t,n,r,i){var a=TS.menu.$menu_items.find(t);a.on("highlighted",function(){a.submenu({items_html:n,onclick:r,help:i})}).on("unhighlighted",function(){if(TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active"))a.submenu("destroy")})},_registerCurrentStatusInput:function e(){TS.menu._unregisterCurrentStatusInput();TS.menu._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#slack_menu_current_status_submenu"),onEscape:TS.menu.end,onSave:TS.menu.end});TS.menu.$menu_body.find("#member_current_status_item").on("click.current_status_item",function(){if(TS.menu._current_status_input)TS.menu._current_status_input.focus()})},_unregisterCurrentStatusInput:function e(){if(TS.menu._current_status_input){TS.menu._current_status_input.destroy();TS.menu._current_status_input=null}TS.menu.$menu_body.find("#member_current_status_item").off(".current_status_item")}});var e=false;var t=function e(t){TS.help_modal.start();TS.clog.track("HELP_MODAL_ACTION",{action:"open_modal",trigger:t})};var r=function e(){var t=TS.menu.$menu;t.addClass("popover_menu");t.prepend('<span class="arrow"></span><span class="arrow_shadow"></span>')};var i=function e(t){var n=3;var r=TS.menu.$target_element.outerHeight()+n;var i=0;if(t)i=TS.menu.$target_element.outerWidth()-TS.menu.$menu.outerWidth();return{left:i,top:r}};var a=function e(t,n,r){if(!TS.model.menu_is_showing)return;var i=$("#toggle-subscription-status");if(i.attr("data-model-ob-id")!==t||i.attr("data-msg-ts")!==n)return;i.attr("data-subscribed",r.subscribed);i.removeClass("disabled");TS.menu.keepInBounds()};$.widget("TS.submenu",{_create:function e(){this.element.data("has-submenu",true);var t=TS.i18n.t("submenu","menu_source")();var n='<div class="menu submenu'+(this.options.help?" submenu_help":"")+'" data-origin-id="'+this.element.attr("id")+'" data-model-ob-id="'+this.element.data("modelObId")+'"><ul aria-hidden="true" aria-label="'+t+'">'+this.options.items_html+"</ul></div>";var r=7;var i=11;var a=TS.menu.$menu.offset().left+TS.menu.$menu.width()+r;var s=this.element.offset().top-i;this.$submenu=$(n);this.$submenu.appendTo("body");TS.menu.$submenu=this.$submenu;TS.menu.$submenu_origin=this.element;if(a+this.$submenu.width()>window.innerWidth){var o=TS.menu.$menu.offset().left-r;var l=window.innerWidth-a;if(o>l)a=TS.menu.$menu.offset().left-this.$submenu.width()-r}if(s+this.$submenu.height()>window.innerHeight){var u=s;var d=window.innerHeight-s;if(u>d)s=window.innerHeight-this.$submenu.height()-i}this.$submenu.css({position:"absolute",left:a+"px",top:s+"px"});var c=this.options.onclick;if(c)this.$submenu.on("click",function(e){c.call(this,e)})},_destroy:function e(){TS.menu.$submenu=null;TS.menu.$submenu_origin=null;if(this.options.ondestroy)this.options.ondestroy();this.$submenu.remove()}})})();var n},4257:function(e,t){(function(){"use strict";TS.registerModule("menu.app",{onStart:function e(){},active_app:null,active_app_bot_id:null,app_item_click_sig:new signals.Signal,startWithApp:function t(n,r,i,a,s,o){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;if(!s){TS.menu.buildIfNeeded();TS.menu.clean()}if(!i)i=TS.model.user.team_id;TS.menu.app.active_app_bot_id=r;TS.menu.app.active_app_team_id=i;function l(e){var t=_.get(e,"bot_user.id");var n=TS.shared.getActiveModelOb();if(t&&(TS.model.active_channel_id||TS.model.active_group_id))return TS.membership.ensureChannelMembershipIsKnownForUsers(n.id,[t]).then(function(){return e});return e}function u(t){TS.menu.app.active_app=t;if(s)if(TS.boot_data.feature_shared_channels_client&&TS.menu.app_team_id)TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);else TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id);else e(n,a,o)}return TS.apps.promiseToGetFullAppProfile(r,i,null,true).then(l).then(u)},onAppItemClick:function e(t){var n=$(this);var r=n.data("action");var i=_.get(TS.menu.app.active_app,"bot_user");if("view_details"===r)if(TS.apps.isAppSpaceEnabled()&&i&&i.id)TS.ims.startImByMemberId(i.id).then(function(){TS.client.ui.app_space.toggleView("about")});else TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);else if("files"===r){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(TS.menu.app.active_app.bot_user.id)}else if("remove_from_channel"===r){t.preventDefault();if(TS.model.active_channel_id)TS.channels.kickMember(TS.model.active_channel_id,TS.menu.app.active_app.bot_user.id);else if(TS.model.active_group_id)TS.groups.kickMember(TS.model.active_group_id,TS.menu.app.active_app.bot_user.id)}else if("invite_to_channel"===r){t.preventDefault();TS.ui.invite.showInviteMemberToChannelDialog(TS.menu.app.active_app.bot_user.id)}TS.clog.track("USER_CARD_CLICK",{app_id:TS.menu.app.active_app.id,bot_id:TS.menu.app.active_app_bot_id});TS.menu.app.end()},end:function e(){TS.menu.app.active_app=null;TS.menu.end()}});var e=function e(t,n,r){var i;if(r&&TS.boot_data.feature_i18n_app_space){i={app_id:TS.menu.app.active_app.id,bot_id:TS.menu.app.active_app_bot_id,support_url:TS.menu.app.active_app.support_url};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_app_items(i));TS.menu.$menu_footer.addClass("hidden").empty();TS.menu.start(t,n);var a=$("#channel_actions_toggle");TS.menu.positionAt(a,6,a.height())}else{i=TS.apps.constructTemplateArgsForCardAndProfile(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);var s=_.get(TS.menu.app.active_app,"bot_user.id");TS.menu.$menu_header.html(TS.templates.menu_app_card_header(i));TS.menu.$menu_items.html(TS.templates.menu_app_card_items(i));TS.menu.$menu_footer.html(TS.templates.menu_app_card_footer(i));TS.menu.$menu_header.find(".emoji_replace_on_load").each(function(){var e=$(this).html();e=TS.emoji.graphicReplace(e);$(this).html(e)});TS.menu.start(t,n,{menu_class:"app_card"});if(s){var o=TS.utility.keymap;var l=false;$("[data-js=app_card_dm]").bind("keydown",function(e){var t=$(this);if(e.which==o.enter&&!e.shiftKey&&!l)if(""!==$.trim(t.val())){e.preventDefault();TS.ims.startImByMemberId(TS.menu.app.active_app.bot_user.id,false,t.val());TS.menu.app.end();l=true}})}if(!i.hide_link_to_app_profile)TS.menu.$menu_header.on("click",function(){var e=_.get(TS.menu.app.active_app,"bot_user");if(TS.apps.isAppSpaceEnabled()&&e&&e.id)TS.ims.startImByMemberId(e.id).then(function(){TS.client.ui.app_space.toggleView("about")});else TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);TS.menu.$menu_header.off();TS.clog.track("USER_CARD_CLICK",{app_id:TS.menu.app.active_app?TS.menu.app.active_app.id:"",bot_id:TS.menu.app.active_app_bot_id});TS.menu.app.end()});else TS.menu.$menu_header.off();TS.menu.$menu_items.on("click.menu","[data-member-profile-link]",function(e){e.preventDefault();TS.client.ui.previewMember($(this).data("member-profile-link"))});TS.menu.keepInBounds()}TS.menu.$menu_items.on("click.menu","li",TS.menu.app.onAppItemClick)}})()},4258:function(e,t){(function(){"use strict";TS.registerModule("menu.channel",{onStart:function e(){},channel:null,startWithChannel:function t(n,r){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;if(!TS.model.menu_is_showing)e=void 0;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.channel.channel=TS.channels.getChannelById(r)||TS.mpims.getMpimById(r);var i=TS.menu.channel.channel;var a=TS.model.team.prefs.allow_email_ingestion;TS.menu.$menu_header.addClass("hidden").empty();var s={channel:i,user:TS.model.user,show_email_item:a};if(TS.notifs.isCorGMuted(i.id))s.channel_is_muted=true;if(i.is_mpim){s.show_mpim_create=TS.permissions.members.canCreateMpims();s.show_mpim_convert=TS.permissions.members.canCreateGroups()&&!TS.shared.isModelObShared(i);s.show_export_history=TS.permissions.members.canExportMessageHistory(TS.menu.channel.channel);if(""!==TS.model.team.plan&&TS.model.team.prefs.allow_retention_override)s.show_message_retention=true}else{s.can_delete_channel=TS.model.user.is_admin&&i.is_channel&&!TS.channels.isChannelRequired(i);if(!TS.channels.isChannelRequired(i)||TS.permissions.members.canPostInChannel(i))if(0===i.purpose.last_set&&!TS.model.user.is_ultra_restricted&&i.is_member)s.show_purpose_item=true;if(i.is_member&&(!TS.channels.isChannelRequired(i)||TS.permissions.members.canPostInChannel(i)))s.show_advanced_item=true;if(TS.boot_data.page_needs_enterprise){var o=TS.permissions.members.canCreateConvertOrgSharedChannels();if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels){if(s.show_advanced_item)if(o)s.show_manage_teams=true;else s.show_advanced_item=false}else{if(!TS.shared.isModelObOrgShared(i)&&o&&!TS.channels.isChannelRequired(i))s.show_convert_item=true;if(TS.shared.isModelObOrgShared(i))if(s.show_advanced_item)if(o)s.show_manage_teams=!i.is_global_shared||TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels;else s.show_advanced_item=false}s.is_not_allowed_integrations=true}s.is_moved=i.is_moved}if(TS.apps.permissions.areXoxaAppsInstalled()&&TS.boot_data.feature_workspace_token_apps_in_client)s.show_add_apps=true;TS.menu.$menu_items.html(TS.templates.menu_channel_items(s));TS.menu.$menu_header.bind("click.menu",TS.menu.channel.onChannelHeaderClick);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.channel.onChannelItemClick);TS.menu.start(n);TS.menu.$menu.attr("data-qa","channel_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs();if(!e)e=$(n.target).closest("#channel_name").length;var l=e?$("#channel_name"):$("#channel_actions_toggle");var u=l.height();var d=e?u+6:u;var c=e?18:6;TS.menu.positionAt(l,c,d)},onChannelHeaderClick:function e(t){t.preventDefault()},onChannelItemClick:function e(t){var n=$(this).attr("id");var r=TS.menu.channel.channel;if($(this).hasClass("disabled")){TS.menu.channel.end();return}if("channel_join_item"===n){t.preventDefault();if(TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==TS.menu.channel.channel.id)TS.channels.joinById(TS.menu.channel.channel.id);else TS.channels.displayChannel({id:TS.menu.channel.channel.id})}else if("channel_details_item"===n){t.preventDefault();if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)$("#details_tab").highlight(null,"channel_page_details_highlighter");else TS.client.ui.flex.openFlexTab("details")}else if("channel_display_item"===n){t.preventDefault();TS.channels.displayChannel({id:TS.menu.channel.channel.id})}else if("channel_close_archived_item"===n){t.preventDefault();TS.channels.closeArchivedChannel(TS.menu.channel.channel.id)}else if("channel_leave_item"===n){t.preventDefault();TS.channels.leave(TS.menu.channel.channel.id)}else if("channel_email_item"===n);else if("channel_manage_teams_item"===n){t.preventDefault();if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels)TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"manage_teams");else TS.ui.channel_manage_teams_dialog.start(TS.menu.channel.channel.id)}else if("channel_advanced_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id)}else if("channel_convert_item"===n){t.preventDefault();if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels)TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"manage_teams");else TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"convert_shared")}else if("channel_delete_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"delete")}else if("channel_unarchive_item"===n){t.preventDefault();TS.api.call("channels.unarchive",{channel:TS.menu.channel.channel.id},function(e,t){if(e)return;var n;if("restricted_action"===t.error)if(TS.boot_data.feature_teams_to_workspaces)n=TS.i18n.t("<p>You don’t have permission to un-archive channels.</p><p>Talk to your Workspace Owner.</p>","channel_menu")();else n=TS.i18n.t("<p>You don’t have permission to un-archive channels.</p><p>Talk to your Team Owner.</p>","channel_menu")();else n=TS.i18n.t("Un-archiving failed with error","channel_menu")+' "'+t.error+'"';setTimeout(TS.generic_dialog.alert,100,n)})}else if("channel_archives_item"===n);else if("channel_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);return}else if("channel_mute_item"===n){t.preventDefault();TS.notifs.muteOrUnmuteCorG(r.id)}else if("channel_invite_item"===n){t.preventDefault();TS.ui.channel_invite_modal.startInviteToChannelModal(TS.menu.channel.channel.id)}else if("channel_notification_prefs"===n){t.preventDefault();TS.ui.channel_prefs_dialog.start(r.id)}else if("channel_add_service_item"===n);else if("channel_mpim_message_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(r.id,"retention")}else if("channel_mpim_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(r.id,"export")}else if("channel_create_mpim_item"===n){t.preventDefault();setTimeout(function(){TS.ui.im_browser.startWithMpim(r)},1)}else if("convert_to_private_channel"===n){t.preventDefault();var i=TS.shared.getActiveModelOb();TS.ui.mpim_conversion_modal.startMpimConversionModal(i)}else if("channel_add_apps_item"===n){t.preventDefault();TS.ui.apps_browser.startAddApps()}else{TS.warn("not sure what to do with clicked element id:"+n);return}TS.menu.channel.end()},startWithChannelPickerForChange:function e(n,r){if(TS.menu.isRedundantClick(n))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.members.getMemberById(r);var a=[];var s=[];$.each(TS.channels.getUnarchivedChannelsForUser(),function(e,t){if(!i.channels.hasOwnProperty(t.id))a.push(t)});$.each(TS.groups.getUnarchivedGroups(),function(e,t){if(!i.groups.hasOwnProperty(t.id))s.push(t)});var o={user_id:r,channels:a,groups:s};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(o));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(o)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickChangeChannel);TS.menu.start(n);var l=$(n.target).closest(".pill");if("mobile"===TS.boot_data.app)TS.menu.positionAt(l,16-l.offset().left,0);else TS.menu.positionAt(l,-TS.menu.$menu.width()+l.outerWidth(),l.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});t();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickChangeChannel:function e(){var t=$(this).data("user-id");var n=$(this).data("channel-id");var r=$(this).data("group-id");if(n)TS.api.call("users.admin.changeURAChannel",{user:t,channel:n},TS.web.admin.onMemberURAChanged);else if(r)TS.api.call("users.admin.changeURAChannel",{user:t,channel:r},TS.web.admin.onMemberURAChanged);TS.menu.channel.end()},startWithChannelPickerForInvite:function e(n,r){if(TS.menu.isRedundantClick(n))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.members.getMemberById(r);var a=[];var s=[];$.each(TS.channels.getUnarchivedChannelsForUser(),function(e,t){if(!i.channels.hasOwnProperty(t.id))a.push(t)});$.each(TS.groups.getUnarchivedGroups(),function(e,t){if(!i.groups.hasOwnProperty(t.id))s.push(t)});var o={user_id:r,channels:a,groups:s};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(o));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(o)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickInviteChannel);TS.menu.start(n);var l=$(n.target).closest(".pill");if("mobile"===TS.boot_data.app)TS.menu.positionAt(l,16-l.offset().left,0);else TS.menu.positionAt(l,10-l.width(),l.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});t();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickInviteChannel:function e(){var t=$(this).data("user-id");var n=$(this).data("channel-id");var r=$(this).data("group-id");if(n)TS.api.call("channels.invite",{users:t,channel:n},TS.web.admin.onMemberInviteChannel);else if(r)TS.api.call("groups.invite",{users:t,channel:r},TS.web.admin.onMemberInviteGroup);TS.menu.channel.end()},startWithChannelPicker:function e(n,r,i){if(TS.menu.isRedundantClick(n))return;TS.menu.buildIfNeeded();TS.menu.clean();var a=[];var s=[];var o=[];r.forEach(function(e){if(e.is_mpim)o.push(e);else if(e.is_group||e.is_private)s.push(e);else if(e.is_channel)a.push(e)});var l={user_id:TS.model.user.id,channels:a,groups:s,mpims:o};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(l));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(l)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",i);TS.menu.start(n);t();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},end:function e(){TS.menu.channel.channel=null;TS.menu.end()}});var e;var t=function e(){var t=TS.menu.$menu.find(".no_results");var n=TS.menu.$menu.find(".icon_close");var r=TS.menu.$menu.find(".menu_filter");var i="";n.click(function(){r.val("").trigger("change");r.focus()});TS.menu.$menu_items.children("li").each(function(){var e=$(this).data("channel-id");if(e){var t=TS.channels.getChannelById(e);if(t.is_private)$(this).data("name",t.name);else if(t)$(this).data("name","#"+t.name);return}var n=$(this).data("group-id");if(n){var r=TS.groups.getGroupById(n);if(r)$(this).data("name",r.name)}var i=$(this).data("mpim-id");if(i){var a=TS.mpims.getMpimById(i);if(a)$(this).data("mpim",a)}});r.on("keyup change paste",TS.utility.debounce(function(){var e=$(this).val();if(e){if(i!==e){var r=false;var a=new RegExp(TS.utility.regexpEscape(e),"i");var s=[];var o=e.split(/[,| ]/).filter(function(e){return!!e});for(var l=0;l<o.length;l+=1)s.push(new RegExp("^"+TS.utility.regexpEscape(o[l]),"i"));n.removeClass("hidden");TS.menu.$menu_items.children("li").removeClass("hidden").each(function(){var e=$(this).data("name");var t=$(this).data("mpim");if(e){var n=e.match(a);if(n){r=true;return}}else if(t)if(TS.mpims.checkMpimMatch(t,s)){r=true;return}$(this).addClass("hidden")});if(r)t.addClass("hidden");else{t.removeClass("hidden");t.find(".query").text(e)}TS.kb_nav.clearHighlightedItem()}}else{TS.menu.$menu_items.children("li.hidden").removeClass("hidden");t.addClass("hidden");n.addClass("hidden");if(i!==e)TS.kb_nav.clearHighlightedItem()}i=e;TS.ui.utility.updateClosestMonkeyScroller(TS.menu.$menu.find("#menu_items_scroller"),true)},250));r.focus()}})()},4261:function(e,t){(function(){"use strict";TS.registerModule("menu.file",{onStart:function e(){},reported_no_file_reader:false,startWithNewFileOptions:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();TS.menu.$menu.addClass("file_menu");TS.menu.$menu_header.addClass("hidden").empty();var r=window.File&&"disable_all"!==TS.model.team.prefs.disable_file_uploads;var i;var a;if(r)if("disable_all_except_images"===TS.model.team.prefs.disable_file_uploads){if(TS.boot_data.feature_tinyspeck)i=TS.i18n.t("Add an image from…","menu_file")();a=TS.i18n.t("an image","menu_file")()}else{if(TS.boot_data.feature_tinyspeck)i=TS.i18n.t("Add a file from…","menu_file")();a=TS.i18n.t("a file","menu_file")()}else{if(!TS.menu.file.reported_no_file_reader){TS.menu.file.reported_no_file_reader=true;TS.info("TS.menu: No File support?  navigator.userAgent: "+navigator.userAgent)}if(TS.boot_data.feature_tinyspeck)i=TS.i18n.t("Add from…","menu_file")();a=""}var s=TS.boot_data.feature_email_ingestion&&TS.model.team.prefs.allow_email_ingestion;var o=TS.utility.box.isBrowserSupported()&&TS.model.prefs.box_enabled;var l=TS.boot_data.feature_arugula;var u=window.Dropbox&&Dropbox.isBrowserSupported()&&TS.model.prefs.dropbox_enabled;var d=TS.model.team.prefs.gdrive_enabled_team;var c=TS.features.isEnabled("onedrive_picker")&&TS.model.team.prefs.onedrive_enabled_team;var _=0;if(o)_+=1;if(u)_+=1;if(d)_+=1;if(c)_+=1;var m=_>1;var f=TS.templates.menu_file_new_file_items({should_show_upload_file:r,should_show_email:s,should_show_box:o,should_show_dropbox:u,should_show_gdrive:d,should_show_onedrive:c,should_show_arugula:l,add_from:i,file_type:a,use_cloud_submenu:m});TS.menu.$menu_items.html(f);if(d){TS.menu.addSubmenu("#gdrive_create_submenu",TS.templates.menu_file_gdrive_doc_type_items(),TS.menu.file.onGDriveDocumentTypeItemClick);TS.menu.has_submenu=true}if(c){TS.menu.addSubmenu("#onedrive_create_submenu",TS.templates.menu_file_onedrive_doc_type_items(),TS.menu.file.onOneDriveDocumentTypeItemClick);TS.menu.has_submenu=true}if(m){var p=TS.templates.menu_file_cloud_service_items({should_show_box:o,should_show_dropbox:u,should_show_gdrive:d,should_show_onedrive:c});TS.menu.addSubmenu("#cloud_submenu",p,TS.menu.file.onNewFileOptionsItemClick);TS.menu.has_submenu=true}TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onNewFileOptionsItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.file.onNewFileOptionsItemClick);var h=n&&"primary_file_button"===n.attr("id");var g;if(TS.client&&h){g=function e(){if(TS.utility.contenteditable.supportsTexty())TS.utility.contenteditable.focus(TS.client.msg_input.$input);else TS.client.ui.$msg_input.focus()};TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_button"}}})}TS.menu.start(t,false,{on_esc:g});TS.menu.$menu.attr("data-qa","file_menu");if(h)TS.menu.positionAt(n,1,-(TS.menu.$menu.height()+6));else TS.menu.positionAt(n,n.width()-TS.menu.$menu.width(),n.outerHeight()+10)},onGDriveDocumentTypeItemClick:function n(r){var i=$(r.target);var a=i.data("doc-type");var s=i.data("doc-display-type");if(!a)return;var o=TS.templates.loading_indicator();t.remove();e.append(o);TS.files.gdrive.createAndShare(a,s);TS.menu.file.end();e.toggleClass("active",true);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_gdrive_"+a.toLowerCase()}}})},onOneDriveDocumentTypeItemClick:function e(t){TS.log(9999,"boop");TS.log(9999,t)},onGDriveCreateComplete:function n(r,i){if(r&&i)if($("#allow_popups_banner").is(":visible"))TS.client.ui.addEphemeralBotMsg({text:TS.i18n.t("It looks like your browser is blocking popups so here’s a link to your <{url}|document>","menu_file")({url:i.data.url}),ephemeral_type:"created_google_drive_document"});e.find(".ts_icon").remove();e.toggleClass("active",false).append(t)},onNewFileOptionsItemClick:function e(t){var n=$(this).closest("[data-which]");if(!n.length)n=$(t.target).closest("[data-which]");var r=n.data("which");var i;if("choose"===r){t.preventDefault();TS.client.ui.files.$upload.trigger("click");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_upload"}}})}else if("email"===r);else if("snippet"===r){t.preventDefault();TS.client.msg_input.startSnippet();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_snippet"}}})}else if("post"===r)TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_post"}}});else if("box"===r){t.preventDefault();TS.files.openBoxChooser();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_box"}}})}else if("dropbox"===r){t.preventDefault();TS.files.openDropboxChooser();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_dropbox"}}})}else if("gdrive_import"===r){t.preventDefault();TS.files.gdrive.openPickerWindow();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_gdrive"}}})}else if("gdrive_create_submenu"===r)t.preventDefault();else if("onedrive_import"===r){t.preventDefault();TS.files.onedrive.openPickerWindow();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_onedrive"}}})}else if("cloud_submenu"===r)t.preventDefault();else if("space"===r){t.preventDefault();i=TS.utility.cmdKey(t);TS.files.createAndOpenNewSpace(null,i);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_space"}}})}else if("arugula"===r){t.preventDefault();i=TS.utility.cmdKey(t);TS.files.createAndOpenNewArugula(null,i);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_arugula"}}})}else{t.preventDefault();TS.warn("not sure what to do with clicked element:"+r)}TS.menu.file.end()},startWithFileFilter:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var r="all";if(TS.model.file_list_types)r=TS.model.file_list_types[0];var i=TS.boot_data.feature_email_ingestion&&TS.model.team.prefs.allow_email_ingestion||TS.model.team.plan;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_file_filter_items({active_type:r,show_email_item:i}));if(n)TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onSearchFileFilterItemClick);else TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileFilterItemClick);TS.menu.start(t);if(n)TS.menu.positionAt($("#search_results_container"),8,74);else TS.menu.positionAt($("#file_list_container"),8,44)},onFileFilterItemClick:function e(t){t.preventDefault();TS.client.ui.files.filterFileList($(this).data("filetype"));TS.view.files.setButtonState($(this).data("filetype"));TS.menu.file.end()},onSearchFileFilterItemClick:function e(t){t.preventDefault();TS.search.setFiletypeFilter($(this).data("filetype"));TS.view.files.setButtonState($(this).data("filetype"));TS.menu.file.end()},startWithFileMemberPromiseFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();TS.menu.$menu.append(TS.templates.menu_file_member_filter());TS.menu.$menu.addClass("member_file_filter_menu");TS.menu.start(t);TS.menu.positionAt($("#file_list_toggle_user"),0,35);var n=new TS.SearchableMemberList({$container:$(".member_file_filter_menu .searchable_member_list"),id:"member_file_filter_menu",show_filter_bar:false,compact_results:true,prevent_member_click_handler:true,suppress_presence:true});n.showInitial();n.member_clicked_sig.add(function(e,t){TS.client.ui.files.toggleFileList(t.id);TS.menu.file.end()})},onFileMemberFilterItemClick:function e(t){t.preventDefault();var n=$(t.currentTarget).data("member-id");TS.client.ui.files.toggleFileList(n);TS.menu.file.end()},onSearchFileMemberFilterItemClick:function e(t){t.preventDefault();var n=$(t.currentTarget).data("member-id");TS.search.setMember(n);TS.menu.file.end()},file_list_menu_up:false,startWithFileActions:function e(t,n){if(TS.client&&!TS.model.ms_connected){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var r=TS.files.getFileById(n);if(!r)return;var i=TS.files.getFileActions(r);var a=$(t.target);var s=a.closest(".file_actions");if(i.comment&&s.data("exclude-comment"))i.comment=false;if(i.download&&s.data("exclude-download"))i.download=false;if(i.open_original&&s.data("exclude-original"))i.open_original=false;if(i.rxn_file&&s.data("exclude-rxn"))i.rxn_file=false;if(i.pin_file&&(s.data("exclude-pin")||s.data("exclude-pin-file")))i.pin_file=false;if(i.unpin_file&&(s.data("exclude-pin")||s.data("exclude-unpin-file")))i.unpin_file=false;if(i.edit&&s.data("exclude-edit"))i.edit=false;if(i.edit_title&&s.data("exclude-edit-title"))i.edit_title=false;if(i.print&&s.data("exclude-print"))i.print=false;if(i.create_public_link&&s.data("exclude-create-public-link"))i.create_public_link=false;if(i.revoke_public_link&&s.data("exclude-revoke-public-link"))i.revoke_public_link=false;if(s.data("include-open-flexpane"))i.open_in_flexpane=true;if(s.data("include-open-file-page"))i.open_file_page=true;if(s.data("include-view-public-link"))i.view_public_link=true;var o=a.closest(".file_list_item").length>0;if(o){if("details"!==TS.model.ui_state.flex_name)i.share=false;TS.menu.file.file_list_menu_up=true}var l=a.closest(".inline_file_preview_container, .file_container");if(l.length>0){l.addClass("file_menu_open");i.new_window=false}TS.menu.$menu_header.addClass("hidden").empty();var u=false;if(i.edit||TS.client&&i.edit_title||i.create_public_link||i.revoke_public_link||i.print||i.save_to_dropbox||i.refresh)u=true;var d={file:r,actions:i,is_refreshing:TS.files.waiting_for_refresh[r.id],model_ob:TS.shared.getActiveModelOb(),show_workflow_divider:u};if(TS.model.unread_view_is_showing)d.source_model_ob_id=a.closest(".unread_group").data("modelId");if(TS.client)d.info_pane_visible="details"===TS.model.ui_state.flex_name;TS.menu.$menu_items.html(TS.templates.menu_file_action_items(d));if(TS.boot_data.feature_fix_files)TS.menu.$menu.addClass("no_icons");if(TS.web)TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickWeb);else if(TS.client)TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickClient);TS.menu.start(t);a.closest(".file_list_item").addClass("active");TS.menu.positionAt(a,-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},onFileActionClickClient:function e(t){var n=$(this).attr("id");var r=$(this).data("rxn-key");var i=TS.files.getFileById($(this).data("file-id"));var a=TS.shared.getActiveModelOb();var s=$(this).data("sourceModelId");if(!i){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===n){t.preventDefault();TS.view.files.shareInCurrentChannelOrIM(i.id,s)}else if("edit_file_snippet"===n){if(!i.is_truncated){t.preventDefault();TS.ui.snippet_dialog.startEdit(i.id)}}else if("edit_file_post"===n);else if("edit_file_space"===n||"open_new_window"===n){if(TS.client.windows.openFileWindow(i.id))t.preventDefault()}else if("edit_file_arugula"===n);else if("edit_file_title"===n){t.preventDefault();TS.client.ui.files.previewFile(i.id,"file_list");TS.files.editFileTitle(i.id)}else if("delete_file"===n){t.preventDefault();TS.view.files.delete(i.id)}else if("create_public_link"===n){t.preventDefault();if(TS.model.team.prefs.disallow_public_file_urls){var o;if(TS.boot_data.feature_external_files)o=TS.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this file.","menu_file")();else o=TS.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(o);return}TS.files.createPublicURL(i,function(e){if(e){if(TS.model.previewed_file_id)$("#file_preview_scroller").find(".file_actions_link").scrollintoview({duration:500,offset:"top",px_offset:-50});$(".file_public_link_"+i.id).highlightText();TS.ui.file_share.fileShowPublicUrlDialog(i)}})}else if("revoke_public_link"===n){t.preventDefault();TS.ui.file_share.fileRevokePublicLink(i.id)}else if("view_public_link"===n){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(i)}else if("refresh_file"===n){t.preventDefault();TS.files.refreshFile(i.id);TS.menu.$menu.find("#refresh_file .item_label").text(TS.i18n.t("Refreshing...","menu_file")()).end();return}else if("download_file"===n){var l=!(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing);if(TS.client&&TS.client.downloads.startDownload(i,l))t.preventDefault()}else if("open_original_file"===n);else if("comment_file"===n){t.preventDefault();if(TS.model.previewed_file_id!=i.id)TS.client.ui.files.previewFile(i.id,"file_list",false,true);else TS.utility.contenteditable.focus($("#file_comment"))}else if("save_to_dropbox"===n)return TS.api.callImmediately("files.getTempURL",{file:i.id},function(e,t){if(e)Dropbox.save(t.url,i.name)});else if("rxn_file"===n){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:r})}else if("share_private_file"===n){t.preventDefault();TS.files.shareOrReshareFile(i.id)}else if("pin_file"===n&&a){t.preventDefault();TS.pins.startPinFile(i.id,a)}else if("unpin_file"===n&&a){t.preventDefault();TS.pins.unPinFile(i.id,a)}else if("open_in_flexpane"===n){t.preventDefault();TS.client.ui.files.previewFile(i.id)}else if("copy_file_link"===n){t.preventDefault();TS.clipboard.writeText(i.permalink);var u=TS.members.getMemberById(i.user);var d={};if(u&&u.is_bot){var c=u.profile.bot_id;var _=TS.bots.getBotById(c);d.app_id=_?_.app_id:"";d.bot_id=c}TS.clog.track("MSG_LINK_COPY",d)}else if("star_file"===n){t.preventDefault();TS.stars.checkForStarClick(t)}else{t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}TS.menu.file.end()},onFileActionClickWeb:function e(t){var n=$(this).attr("id");var r=$(this).data("rxn-key");var i=TS.files.getFileById($(this).data("file-id"));var a=TS.shared.getActiveModelOb();if(!i){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===n){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("share_private_file"===n){t.preventDefault();TS.files.shareOrReshareFile(i.id)}else if("edit_file_snippet"===n);else if("edit_file_post"===n);else if("edit_file_space"===n||"open_new_window"===n);else if("edit_file_title"===n);else if("delete_file"===n){t.preventDefault();TS.web.file.deleteFile(i.id)}else if("create_public_link"===n){t.preventDefault();if(!TS.model.team.prefs.disallow_public_file_urls)TS.api.callImmediately("files.sharedPublicURL",{file:i.id},function(e,t){if(e){var n=$(".file_public_link_shared");n.slideToggle(100);TS.files.upsertAndSignal({id:i.id,public_url_shared:true});if(0===n.length)TS.ui.file_share.fileShowPublicUrlDialog(i)}else if(t.error&&"not_allowed"===t.error){TS.model.team.prefs.disallow_public_file_urls=true;var r;if(TS.boot_data.feature_external_files)r=TS.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this file.","menu_file")();else r=TS.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(r)}})}else if("revoke_public_link"===n){t.preventDefault();if(TS.web.file)TS.web.file.revokePublicURL(i);else TS.ui.file_share.fileRevokePublicLink(i.id)}else if("view_public_link"===n){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(i)}else if("refresh_file"===n){t.preventDefault();TS.files.refreshFile(i.id);TS.menu.$menu.find("#refresh_file .item_label").text("Refreshing...").end();return}else if("download_file"===n);else if("print_file"===n){window.print();t.preventDefault()}else if("open_original_file"===n);else if("comment_file"===n){t.preventDefault();TS.utility.contenteditable.focus($("#file_comment"))}else if("save_to_dropbox"===n)return TS.api.callImmediately("files.getTempURL",{file:i.id},function(e,t){if(e)Dropbox.save(t.url,i.name)});else if("rxn_file"===n){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:r})}else if("pin_file"===n&&a){t.preventDefault();TS.pins.startPinFile(i.id,a)}else if("unpin_file"===n&&a){t.preventDefault();TS.pins.unPinFile(i.id,a)}else if("copy_file_link"===n){t.preventDefault();TS.clipboard.writeText(i.permalink)}else if("open_file_page"===n);else{t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}TS.menu.file.end()},clean:function e(){TS.menu.clean()},end:function e(){TS.menu.end()}});var e=$('[data-js="primary_file_button"]');var t=e.find(".ts_icon_plus_thick")})()},4262:function(e,t){(function(){"use strict";TS.registerModule("menu.group",{onStart:function e(){},group:null,startWithGroup:function t(n,r){if(TS.menu.isRedundantClick(n))return;if(TS.client.ui.checkForEditing(n))return;if(!TS.model.menu_is_showing)e=void 0;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.group.group=TS.groups.getGroupById(r);var i=TS.menu.group.group;var a=TS.model.team.prefs.allow_email_ingestion;TS.menu.$menu_header.addClass("hidden").empty();var s={group:i,user:TS.model.user,show_email_item:a,leave_action:TS.groups.getLeaveAction(r),show_export_history:TS.permissions.members.canExportMessageHistory(i)};if(0===i.purpose.last_set&&!TS.model.user.is_ultra_restricted)s.show_purpose_item=true;if(TS.notifs.isCorGMuted(i.id))s.group_is_muted=true;s.show_advanced_item=true;if(TS.boot_data.page_needs_enterprise){var o=TS.permissions.members.canCreateConvertOrgSharedChannels();if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels){if(o){s.show_advanced_item=true;s.show_manage_teams=true}else if(i.creator!==TS.model.user.id&&i.is_org_shared)s.show_advanced_item=false}else{if(!i.is_shared&&o)s.show_convert_item=true;if(i.is_shared){if(i.creator!==TS.model.user.id)s.show_advanced_item=false;if(o){s.show_advanced_item=true;s.show_manage_teams=!i.is_global_shared||TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels}s.is_not_allowed_integrations=true}}}if(""!==TS.model.team.plan&&TS.model.team.prefs.allow_retention_override)s.show_message_retention=true;if(TS.apps.permissions.areXoxaAppsInstalled()&&TS.boot_data.feature_workspace_token_apps_in_client)s.show_add_apps=true;TS.menu.$menu_items.html(TS.templates.menu_group_items(s));TS.menu.$menu_header.bind("click.menu",TS.menu.group.onGroupHeaderClick);TS.menu.$menu_items.on("click.menu","li",TS.menu.group.onGroupItemClick);TS.menu.start(n);TS.menu.$menu.attr("data-qa","group_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs();$("#menu_group_topic_input").bind("keydown",TS.menu.handleTopicKeydown);if(!e)e=$(n.target).closest("#channel_name").length;var l=e?$("#channel_name"):$("#channel_actions_toggle");var u=l.height();var d=e?u+6:u;var c=e?18:6;TS.menu.positionAt(l,c,d)},onGroupHeaderClick:function e(t){t.preventDefault()},onGroupItemClick:function e(t){var n=$(this).attr("id");if($(this).hasClass("disabled")){TS.menu.end();return}if("group_display_item"===n){t.preventDefault();TS.groups.displayGroup({id:TS.menu.group.group.id})}else if("group_details_item"===n){t.preventDefault();if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)$("#details_tab").highlight(null,"channel_page_details_highlighter");else TS.client.ui.flex.openFlexTab("details")}else if("group_star_item"===n){t.preventDefault();TS.stars.checkForStarClick(t)}else if("group_mute_item"===n){t.preventDefault();TS.notifs.muteOrUnmuteCorG(TS.menu.group.group.id)}else if("group_email_item"===n);else if("group_files_item"===n){TS.client.ui.flex.openFlexTab("search");TS.search.setFilter("files");TS.view.resizeManually("TS.key_triggers");var r="in:"+TS.shared.getActiveModelOb().name+" ";TS.search.setInputVal(r)}else if("group_leave_item"===n){t.preventDefault();TS.groups.leave(TS.menu.group.group.id)}else if("group_unarchive_item"===n){t.preventDefault();TS.api.call("groups.unarchive",{channel:TS.menu.group.group.id})}else if("group_archives_item"===n);else if("group_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);return}else if("channel_manage_teams_item"===n){t.preventDefault();if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels)TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"manage_teams");else TS.ui.channel_manage_teams_dialog.start(TS.menu.group.group.id)}else if("group_advanced_item"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id)}else if("group_convert_item"===n){t.preventDefault();if(TS.boot_data.feature_removing_workspaces_from_cross_workspace_channels)TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"manage_teams");else TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"convert_shared")}else if("group_invite_item"===n){t.preventDefault();TS.ui.channel_invite_modal.startInviteToChannelModal(TS.menu.group.group.id)}else if("group_prefs"===n){t.preventDefault();TS.ui.channel_prefs_dialog.start(TS.menu.group.group.id)}else if("group_message_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"retention")}else if("group_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"export")}else if("group_add_service_item"===n);else if("group_add_apps_item"===n){t.preventDefault();TS.ui.apps_browser.startAddApps()}else{TS.warn("not sure what to do with clicked element id:"+n);return}TS.menu.end()}});var e})()},4263:function(e,t){(function(){"use strict";TS.registerModule("menu.member",{member:null,member_item_click_sig:new signals.Signal,onStart:function t(){e=new TS.PresenceList},startWithMember:function a(s,o,l,u,d){if(TS.menu.isRedundantClick(s))return;if(TS.client.ui.checkForEditing(s))return;if(!TS.model.menu_is_showing)t=void 0;TS.menu.buildIfNeeded();TS.menu.member.member=TS.members.getMemberById(o);var c=TS.menu.member.member;if(!c)return;if(!TS.permissions.members.canUserSeeMember(c))return;if(c.is_bot&&_.get(c.profile,"bot_id"))return TS.menu.app.startWithApp(s,_.get(c.profile,"bot_id"),null,false,false,d);TS.menu.clean();e.add(o);TS.menu.menu_closed_sig.addOnce(function(){e.clear()});var m=n(c,{is_header_menu:u,is_im_menu:d});if(m.channel_kick_name&&m.channel_kick_hidden){var f=TS.shared.getActiveModelOb();TS.membership.ensureChannelMembershipIsKnownForUsers(f.id,[c.id]).then(function(){if(!TS.model.menu_is_showing)return;if(TS.menu.last_e!==s)return;if(TS.membership.getUserChannelMembershipStatus(c.id,f).is_member)TS.menu.$menu_items.find("#member_kick_channel_item").removeClass("hidden")})}if(d)TS.menu.$menu_header.addClass("hidden").empty();else{TS.menu.$menu_header.html(TS.templates.menu_member_header(m));TS.client.flex_pane.startLocalTimeInterval()}if(!c.is_stranger)TS.menu.$menu_items.html(TS.templates.menu_member_items(m));if(!d&&!c.deleted)TS.clog.track("USER_CARD_DISPLAY",{});if(o==TS.model.user.id){var p="";if(!d)p+=TS.templates.menu_member_footer({member:c});TS.menu.$menu_footer.html(p)}else if(!d)TS.menu.$menu_footer.html(TS.templates.menu_member_footer({member:c}));TS.menu.start(s,l);var h=false;var g=$("#menu_member_dm_input");if(TS.boot_data.feature_texty_takes_over){var S=TS.members.getPrefCompliantMemberName(c);TS.utility.contenteditable.create(g,{modules:{tabcomplete:{searchOptions:{complete_member_specials:false},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members],positionMenu:function e(t){t.style.width=g.outerWidth()+"px";t.style.minWidth="0";TS.tabcomplete.positionUIRelativeToInput(t,g)}}},singleLineInput:true,onEnter:function e(t){var n=_.trim(TS.utility.contenteditable.value(g));if(!_.keys(t).length&&!h&&n.length){TS.ims.startImByMemberId(c.id,false,n);TS.menu.member.end();h=true;TS.clog.track("USER_CARD_DM",{})}return false},onEscape:function e(){TS.menu.end()},placeholder:TS.i18n.t("Message {name}","menu")({name:_.escape(S)})});TS.utility.contenteditable.enable(g)}else{var T=TS.utility.keymap;$("#menu_member_dm_input").bind("keydown",function(e){if(e.which==T.enter&&!e.shiftKey&&!h)if(""!==$.trim(g.val())){e.preventDefault();TS.ims.startImByMemberId(c.id,false,g.val());TS.menu.member.end();h=true;TS.clog.track("USER_CARD_DM",{})}})}if(c.is_self)TS.menu.$menu_header.find(".member_timezone_value a").on("click.timezone",function(e){e.preventDefault();TS.menu.member.end()});TS.menu.$menu_header.bind("click.menu",r);TS.menu.$menu_items.on("click.menu","li",i);TS.kb_nav.setSubmitItemHandler(i);if(d){if(!t)t=$(s.target).closest("#channel_name").length;var v=t?$("#channel_name"):$("#channel_actions_toggle");var b=v.height();var y=t?b+6:b;var w=t?18:6;TS.menu.positionAt(v,w,y);TS.menu.$menu.attr("data-qa","member_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs()}if(!d)TS.menu.keepInBounds()},startWithMemberPreview:function e(t,n,r,a){if(TS.menu.isRedundantClick(t))return;if(TS.client&&TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var s=$(t.target).closest(".member_preview_menu_target");if(!n)n=s.closest("[data-member-id]").data("member-id");TS.menu.member.member=TS.members.getMemberById(n);var o=TS.menu.member.member;var l=TS.ims.getImByMemberId(n);var u={member:o,is_team_directory:true,im_id:l&&l.id,hide_view_profile:a};TS.menu.$menu_header.addClass("hidden").empty();if(!o.deleted&&!o.is_slackbot&&n!=TS.model.user.id){if(!TS.model.user.is_ultra_restricted&&!o.is_ultra_restricted)u.show_channel_invite=true;if(TS.boot_data.page_needs_enterprise){var d=TS.model.team;if(d&&d.id!==o.team_id)u.show_call_action=false}}if(r)TS.menu.$menu_items.html(TS.templates.menu_member_items_short(u));else{TS.menu.$menu_items.html(TS.templates.menu_member_items(u));TS.menu.$menu_items.on("click.menu","li",{is_member_preview:a},i)}TS.menu.start(t);TS.kb_nav.setSubmitItemHandler(i);var c=s.outerWidth()-TS.menu.$menu.width()-1;TS.menu.positionAt(s,c,s.outerHeight()+5);TS.menu.keepInBounds()},startWithEditMemberProfilePhotoActions:function e(t,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var r=true===TS.model.user.profile.is_custom_image;var i=$(t.target);var a=i.is(".btn");var s={show_delete:r&&!a,is_iOS:TS.model.is_iOS};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_edit_member_profile_photo_action_items(s));TS.menu.$menu_items.on("click.menu","li",n);TS.menu.start(t);if(a)TS.menu.positionAt(i,0,i.outerHeight()+5);else TS.menu.positionAt(i.closest('[data-action="edit_member_profile_photo_menu"]'),36,156);TS.menu.keepInBounds()},startWithEnterpriseMemberHeader:function e(t){var n=15;if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var r={enterprise_name:$("[data-enterprise-name]").val(),signout_url:TS.boot_data.signout_url};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_enterprise_member_header(r));TS.menu.$menu_items.on("click.menu","li",a);TS.kb_nav.setSubmitItemHandler(a);TS.menu.start(t);var i=$("[data-header-menu-toggle]");var s=-TS.menu.$menu.outerWidth()+i.outerWidth();var o=i.outerHeight()+n;TS.menu.positionAt(i,s,o);t.preventDefault()},end:function e(){TS.menu.member.member=null;TS.menu.end()},test:function e(){var e={};Object.defineProperty(e,"_getTemplateArguments",{get:function e(){return n},set:function e(t){n=t}});return e}});var e;var t;var n=function e(t,n){n=n||{};var r={member:t,show_dm_item:!n.is_im_menu,show_email_item:TS.model.team.prefs.allow_email_ingestion,is_im_menu:n.is_im_menu,show_admin_info:t.is_admin&&t.team_id===TS.model.user.team_id};if(n.is_im_menu){r.im=TS.ims.getImByMemberId(t.id);if(TS.apps.permissions.areXoxaAppsInstalled()&&TS.boot_data.feature_workspace_token_apps_in_client)r.show_add_apps=true}if(n.is_header_menu&&t.id===TS.model.user.id){r.other_accounts=TS.boot_data.other_accounts;r.logout_url=TS.boot_data.logout_url;r.signin_url=TS.boot_data.signin_url}if(!t.deleted&&!t.is_slackbot&&t.id!==TS.model.user.id&&!TS.utility.teams.isMemberExternal(t))if(!TS.model.user.is_ultra_restricted&&!t.is_ultra_restricted)r.show_channel_invite=true;var i=TS.shared.getActiveModelOb();if(TS.model.active_channel_id||TS.model.active_group_id){var a=!TS.channels.isChannelRequired(i)||t.is_restricted;var s=!TS.utility.teams.isMemberExternal(t);var o=t.id!==TS.model.user.id;var l=s&&o;var u=a&&l;if(u){var d;var c=TS.membership.getUserChannelMembershipStatus(t.id,i);if(c.is_known)d=c.is_member;else{d=true;r.channel_kick_hidden=true}if(d)if(i.is_group&&TS.permissions.members.canKickFromGroups()||i.is_channel&&TS.permissions.members.canKickFromChannels())r.channel_kick_name=(TS.model.active_channel_id?"#":"")+i.name}}if("USLACKBOT"===t.id){var _=false;if(TS.model.user.is_admin)_=true;else if(!TS.model.team.prefs.slackbot_responses_disabled&&!TS.model.team.prefs.slackbot_responses_only_admins)_=true;r.show_slackbot_responses_item=_}if(TS.utility.calls.isEnabled()&&!t.is_bot&&"USLACKBOT"!==t.id){r.show_call_action=true;if(!t._is_local)r.show_call_action=false}if(""!==TS.model.team.plan&&TS.model.team.prefs.allow_retention_override)r.show_dm_retention=true;r.show_export_history=TS.permissions.members.canExportMessageHistory(i);return r};var r=function e(t){t.preventDefault();TS.client.ui.previewMember(TS.menu.member.member.id,"menu_member_header");TS.clog.track("USER_CARD_CLICK");TS.menu.member.end()};var i=function e(t){var n=$(this).attr("id");clearTimeout(TS.menu.end_time);if("member_photo_item"===n);else if("member_details_item"===n){t.preventDefault();if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)$("#details_tab").highlight(null,"channel_page_details_highlighter");else TS.client.ui.flex.openFlexTab("details")}else if("member_dm_retention"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.shared.getActiveModelOb().id,"retention")}else if("member_export_history"===n){t.preventDefault();TS.ui.channel_options_dialog.start(TS.shared.getActiveModelOb().id,"export")}else if("member_archives_item"===n);else if("member_jump_item"===n){t.preventDefault();TS.menu.startWithDatePicker(t);TS.menu.member.member_item_click_sig.dispatch(n);return}else if("member_star_item"===n){t.preventDefault();TS.stars.checkForStarClick(t)}else if("member_email_item"===n);else if("member_skype_item"===n);else if("member_account_item"===n);else if("member_prefs_item"===n){t.preventDefault();if(TS.generic_dialog.is_showing)TS.generic_dialog.cancel();TS.ui.prefs_dialog.start()}else if("member_files_item"===n){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(TS.menu.member.member.id)}else if("member_im_files_item"===n){TS.client.ui.flex.openFlexTab("search");TS.search.setFilter("files");TS.view.resizeManually("TS.key_triggers");var r="in:"+TS.shared.getActiveModelOb().name+" ";TS.search.setInputVal(r)}else if("member_dm_item"===n){t.preventDefault();TS.ims.startImByMemberId(TS.menu.member.member.id)}else if("member_invite_channel_item"===n){t.preventDefault();if(TS.client.channel_page.members_dialog.isShowing()){var i=TS.generic_dialog.current_setting;TS.generic_dialog.cancel()}TS.ui.invite.showInviteMemberToChannelDialog(TS.menu.member.member.id);if(i)TS.generic_dialog.start(i)}else if("member_create_group_item"===n){t.preventDefault();TS.ui.new_channel_modal.start("",false,[TS.menu.member.member.id])}else if("member_profile_item"===n){t.preventDefault();if(TS.menu.member.member.is_self){if(TS.generic_dialog.is_showing)TS.generic_dialog.cancel();TS.ui.edit_member_profile.start()}else TS.client.ui.previewMember(TS.menu.member.member.id)}else if("member_presence"===n){t.preventDefault();TS.members.toggleUserPresence();TS.menu.end_time=setTimeout(function(){TS.menu.member.end();TS.menu.member.member_item_click_sig.dispatch(n)},1e3);return}else if("logout"===n){t.preventDefault();if(TS.client)TS.client.windows.closeAll();TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url)}else if($(this).hasClass("switch_team")){t.preventDefault();var a=$(this).data("team-id");if(TSSSB.call("displayTeam",a))t.preventDefault();else{var s=$(this).find("a").attr("href");if(s&&-1==s.indexOf("?"))$(this).find("a").attr("href",s+="?"+TS.getQsArgsForUrl())}}else if("member_kick_channel_item"===n){t.preventDefault();if(TS.model.active_channel_id)TS.channels.kickMember(TS.model.active_channel_id,TS.menu.member.member.id);else if(TS.model.active_group_id)TS.groups.kickMember(TS.model.active_group_id,TS.menu.member.member.id)}else if("member_slackbot_responses"===n);else if("member_open_profile_item"===n);else if("member_call_item"===n)TS.utility.calls.startCallInModelOb(TS.menu.member.member);else if("member_add_apps_item"===n){t.preventDefault();TS.ui.apps_browser.startAddApps()}else{t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n);return}if(t.data&&t.data.is_member_preview)TS.clog.track("USER_PROFILE_CLICK");else TS.clog.track("USER_CARD_CLICK");TS.menu.member.end();TS.menu.member.member_item_click_sig.dispatch(n)};var a=function e(t){var n=$(this).attr("id");if("sign_out"===n)return;else if("view_account"===n)return;t.preventDefault();TS.warn("not sure what to do with clicked element id:"+n)}})()},4265:function(e,t){(function(){"use strict";TS.registerModule("cmd_handlers",{server_cmds:null,onStart:function e(){var t=true;s=TS.utility.throttleFunc(s,3e3,t);TS.prefs.team_allow_calls_changed_sig.add(o);if(!_.get(window,"desktop.app.toggleDevTools"))delete TS.cmd_handlers["/slackdevtools"];if(!TS.client||!TS.client.traces.canTrace())delete TS.cmd_handlers["/slacktrace"]},test:function e(){return{_maybeInviteUserToModelOb:f,_maybeInviteUserGroupToModelOb:p,_getUserIdentifier:h}},groupCmdsByType:function e(t){var n=[d(t),c(t),m(t)];var r=Array.prototype.concat.apply([],n);var i=r.filter(function(e){return e.cmds.length>0});return i},getAvailableUserCmds:function e(t){var n={};var r=TS.shared.getActiveModelOb();t=t||{};_.forOwn(TS.cmd_handlers,function(e,i){if(0!==i.indexOf("/"))return;if("function"===typeof e.autocomplete&&!e.autocomplete()||false===e.autocomplete||e.alias_of)return;if(t.in_thread&&!TS.cmd_handlers.isCmdSupportedInThreads(i))return;switch(i){case"/archive":case"/unarchive":if(TS.channels.isChannelRequired(r))return;if(TS.model.active_group_id&&TS.model.user.is_restricted)return;if(TS.model.active_channel_id&&!TS.permissions.members.canArchiveChannels())return;if(TS.model.active_im_id)return;if(TS.model.active_mpim_id)return;break;case"/kick":case"/remove":if(r.is_archived)return;if(TS.model.active_group_id&&!TS.permissions.members.canKickFromGroups())return;if(TS.model.active_channel_id&&!TS.permissions.members.canKickFromChannels())return;if(TS.model.active_im_id)return;if(TS.model.active_mpim_id)return;break;case"/join":case"/feed":if(TS.model.user.is_restricted)return;break;case"/invite":if(TS.model.user.is_ultra_restricted)return;break;case"/invite_people":if(!TS.ui.admin_invites.canInvite())return;break;case"/topic":case"/purpose":if(TS.model.active_im_id)return;if(TS.model.active_mpim_id)return;if(TS.model.user.is_restricted)return;if(TS.channels.isChannelRequired(r)&&!TS.permissions.members.canPostInChannel(r))return;break;case"/leave":if(TS.model.active_group_id)return}if("custom"===e.type||"service"===e.type)if(TS.prefs.commands_only_regular&&TS.model.user.is_restricted)return;n[i]=e});return n},parseArgs:function e(t){var n=t;if(TS.boot_data.feature_name_tagging_client)t=TS.format.texty.convertContentsStringForSlashCommands(t);var r={cmd:"",rest:"",words:[]};if(!_.isString(t))return r;var i=t.trim();if(!i)return r;r.words=i.split(/\s+/);r.cmd=r.words[0].toLowerCase();r.disp=r.words[0];r.rest=i.substring(r.cmd.length).trim();r.original_txt=n;return r},setUpCmds:function e(){if(!TS.boot_data.page_needs_custom_cmds){o();return Promise.resolve()}r();if(a()){var t=TS.storage.fetchCmds();TS.model.did_we_load_with_cmd_cache=true;TS.cmd_handlers.mergeInServerCmds(t.data);o();return Promise.resolve()}var n;var s=true;return TS.api.call("commands.list",{},n,s).then(function(e){if(!e.data.commands)return;i(e.data.commands,e.data.cache_ts)}).catch(_.noop)},removeCommand:function e(t,n){delete TS.cmd_handlers.server_cmds[t];i(TS.cmd_handlers.server_cmds,n)},updateCommand:function e(t,n){TS.cmd_handlers.server_cmds[t.name]=t;i(TS.cmd_handlers.server_cmds,n)},resetUpCmds:function e(){TS.storage.storeCmds("");s()},sortNames:function e(t){var n=t.sort(TS.i18n.sorter);function r(e,t){return e.filter(function(e){return-1!==t.indexOf(TS.cmd_handlers[e].type)})}var i=r(n,["client","core"]);var a=r(n,["custom"]);var s=r(n,["app","service"]);var o=s.filter(function(e){var t=TS.cmd_handlers[e];return!!(t.app||t.service_name)});o.sort(function(e,t){var n=TS.cmd_handlers[e];var r=TS.cmd_handlers[t];var i=n.service_name||TS.model.apps[n.app].name;var a=r.service_name||TS.model.apps[r.app].name;return TS.i18n.sorter(i,a)});var l=s.filter(function(e){var t=TS.cmd_handlers[e];return!(t.app||t.service_name)});l.sort();var u=[].concat(i,a,o,l);return u},getAppNameForCmdName:function e(t){var n=TS.cmd_handlers[t];if(!n)return"";var r;if(n.app&&TS.model.apps[n.app])r=TS.model.apps[n.app].name;else if(n.service_name)r=n.service_name;return r},mergeInServerCmds:function e(t){TS.cmd_handlers.server_cmds=t;var n;for(var r in TS.cmd_handlers){if(0!==r.indexOf("/"))continue;if("client"===TS.cmd_handlers[r].type)delete TS.cmd_handlers[r].override;else delete TS.cmd_handlers[r]}for(n in t){if(0!==n.indexOf("/"))continue;if(TS.cmd_handlers[n]&&!TS.cmd_handlers[n].can_be_overridden_by_server_cmd){TS.cmd_handlers[n].override=true;continue}TS.cmd_handlers[n]=TS.cmd_handlers.makeInternalCmdObject(t[n])}for(n in t){if(0!==n.indexOf("/"))continue;if(!TS.cmd_handlers[n].alias_of)continue;var i=TS.cmd_handlers[TS.cmd_handlers[n].alias_of];if(!i)continue;if("client"===i.type)continue;if(!i.aliases)i.aliases=[];i.aliases.push(n)}},makeInternalCmdObject:function e(t){return{autocomplete:true,alias_of:t.alias_of?t.alias_of:null,aliases:null,usage:t.usage||"",desc:t.desc||"",help_text:t.help_text||"",type:t.type||"",app:t.app||"",service_name:t.service_name||"",normalized:TS.i18n.deburr(t.name)}},addEphemeralFeedback:function e(t,n){n=_.defaults(n,{temporary:true});var r={text:t};if(n.input_txt)if(n.c_id&&n.thread_ts)TS.utility.populateThreadInputs(n.input_txt,n.c_id,n.thread_ts);else TS.utility.contenteditable.value(TS.client.ui.$msg_input,n.input_txt);if(!n.temporary)if(n.c_id&&n.thread_ts)TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.c_id);else TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);if(n.temporary)r.ephemeral_type="temp_slash_cmd_feedback";if(n.slackbot_feels)r.slackbot_feels=n.slackbot_feels;if(n.c_id&&n.thread_ts){r.channel=n.c_id;r.thread_ts=n.thread_ts;if(n.temporary)r.ephemeral_type="threads_temp_slash_cmd_feedback"}if(n.temporary)TS.client.ui.addOrFlashEphemeralBotMsg(r);else TS.client.ui.addEphemeralBotMsg(r)},runCommand:function e(t,n,r){if(!TS.cmd_handlers[t.cmd])return;if(n&&!TS.cmd_handlers.isCmdSupportedInThreads(t.cmd)){TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(t.cmd,t.original_txt,n,r);return}if(TS.model.last_active_cid)TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.last_active_cid);TS.cmd_handlers[t.cmd].func(t.cmd,t.rest,t.words,t.original_txt,n,r)},isCmdSupportedInThreads:function t(n){return n&&_.includes(e,n)},sendCmdNotSupportedInThreadsMsg:function e(t,n,r,i){var a;if(TS.cmd_handlers[t])a=TS.i18n.t("*{cmd}* is not supported in threads. Sorry!","threads")({cmd:t});else a=TS.i18n.t("*{cmd}* is not a valid command.","threads")({cmd:t});TS.cmd_handlers.addEphemeralFeedback(a,{input_txt:n,slackbot_feels:"sad_surprise",c_id:i.id,thread_ts:r.ts})},"/slackdevtools":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!_.get(window,"desktop.app.toggleDevTools"))return;var t=false;desktop.app.toggleDevTools(t)}},"/slackdebugunreads":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){var t=TS.shared.getAllModelObsForUser();if(!t||!t.length){TS.warn("/slackdebugunreads: Could not get list of model objects for user. :(");return}var n=[];var r=0;var i=0;_.each(t,function(e){if(!e.unread_cnt)return;var t;if(e.is_group)t="group";else if(e.is_mpim)t="mpim";else if(e.is_im)t="im";else if(e.is_channel)t="channel";else t="unknown";if((e.unread_cnt||e.unread_highlight_cnt)&&t){r+=1;n.push([e.id,"group"===t||"mpim"===t?" ("+t+"):":":",e.unread_cnt?" unread"+(e.is_im||e.is_mpim?" (highlight)":"")+" = "+e.unread_cnt:"",e.unread_highlight_cnt?" highlight = "+e.unread_highlight_cnt:"",TS.notifs.isCorGMuted(e.id)?" (muted)":""].join(""));i+=e.unread_cnt}else TS.warn("bad type for channel id "+e.id+"?",t)});if(!i)n.push("No unreads found across "+t.length+" channels??");var a=TS.model.all_unread_highlights_cnt;var s=TS.model.all_unread_cnt;if(TS.boot_data.feature_teams_to_workspaces)n=["🕵️📖 Unreads Report for user "+TS.model.user.id+" in workspace "+TS.model.team.id,i+" unreads across "+r+(1===r?" channel":" channels")].concat(n);else n=["🕵️📖 Unreads Report for user "+TS.model.user.id+" on team "+TS.model.team.id,i+" unreads across "+r+(1===r?" channel":" channels")].concat(n);if(TS.model.is_our_app){if(TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts){if(TS.model.all_unread_highlights_cnt_to_exclude){n.push("TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude);a=Math.max(0,a-TS.model.all_unread_highlights_cnt_to_exclude)}if(TS.model.all_unread_cnt_to_exclude){n.push("TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude);s=Math.max(0,s-TS.model.all_unread_cnt_to_exclude)}}n.push("SSB setBadgeCount details: all_unread_highlights_cnt = "+a+", all_unread_cnt = "+s+", bullet = "+((window.macgap||window.winssb?!!TS.model.prefs.mac_ssb_bullet:false)?"true":"false"))}TS.info(n.join("\n"))}},"/slackdebugwidget":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!TS.debug_widget)return;TS.debug_widget.toggle()}},"/slacktrace":{type:"client",autocomplete:function e(){return TS.client&&TS.client.traces.canTrace()},alias_of:null,aliases:null,desc:TS.i18n.t("Submit a performance profile to Slack","cmd_handlers")(),func:function e(t,n){if(!TS.client||!TS.client.traces.canTrace())return;TS.client.traces.startTrace(parseInt(n,10),{reason:"slashcommand"});TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Thank you for submitting a performance profile to Slack!","cmd_handlers")())}},"/away":{localized:"/"+TS.i18n.t("away","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t('Toggle your "away" status',"cmd_handlers")(),func:function e(t,n,r,i,a,s){TS.members.toggleUserPresence().then(function(e){var t=e.args.presence||TS.model.user.presence;var n;if("away"===t)n=":white_check_mark: "+TS.i18n.t("You are now marked as *away*.","cmd_handlers")();else n=":white_check_mark: "+TS.i18n.t("You are now marked as *active*.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false,c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false})}).catch(_.noop);if(n)TS.members.setUserStatus(n)}},"/prefs":{localized:"/"+TS.i18n.t("prefs","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Open the preferences dialog","cmd_handlers")(),func:function e(){TS.ui.prefs_dialog.start()}},"/shortcuts":{localized:"/"+TS.i18n.t("shortcuts","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/keys"],localized_aliases:["/"+TS.i18n.t("keys","cmd_handlers")()],desc:TS.i18n.t("Open the keyboard shortcuts dialog","cmd_handlers")(),func:function e(){TS.ui.shortcuts_dialog.start()}},"/keys":{localized:"/"+TS.i18n.t("keys","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/shortcuts",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/shortcuts"].func()}},"/open":{localized:"/"+TS.i18n.t("open","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/join"],localized_aliases:["/"+TS.i18n.t("join","cmd_handlers")()],desc:TS.i18n.t("Open a channel","cmd_handlers")(),args:[{name:TS.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){if(1==r.length)TS.ui.channel_browser.start();else{var o=n;if(TS.boot_data.feature_name_tagging_client){var l=_.trim(i.substr(t.length));var u=TS.format.texty.convertContentsStringToContents(l);o=TS.format.texty.convertContentsToStringForDisplay(u)}o=TS.utility.cleanChannelName(o);var d=TS.channels.getChannelByName(o);var c=TS.groups.getGroupByName(o);if(d){if(d.is_member)TS.channels.displayChannel({id:d.id});else if(!TS.model.user.is_restricted)TS.channels.joinById(d.id,function(e,t){if(!e){var n=TS.i18n.t("There was a problem joining “{channel_name}”, sorry!","cmd_handlers")({channel_name:o});if("is_archived"==t.error)n=TS.i18n.t("“{channel_name}” has been archived, so can’t be opened.","cmd_handlers")({channel_name:o});if(s&&a)TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(n,{temporary:false,slackbot_feels:"sad_surprise"})}})}else if(c){if(!c.is_archived||c.was_archived_this_session)TS.groups.displayGroup({id:c.id})}else if(TS.permissions.members.canCreateChannels())TS.ui.new_channel_modal.start(o);else{var m=TS.i18n.t("I couldn’t find a channel named “{channel_name}”, sorry!","cmd_handlers")({channel_name:o});if(s&&a)TS.cmd_handlers.addEphemeralFeedback(m,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(m,{temporary:false,slackbot_feels:"sad_surprise"})}}}},"/join":{localized:"/"+TS.i18n.t("join","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/open",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/open"].func(t,n,r,i,a,s)}},"/msg":{localized:"/"+TS.i18n.t("msg","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/dm"],localized_aliases:["/"+TS.i18n.t("dm","cmd_handlers")()],desc:TS.i18n.t("Send a DM message to another user","cmd_handlers")(),args:[{name:"@user",optional:false},{name:TS.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){var o=r.length>1?r[1]:"";var l;var u;var d=g(o);if(!d)if(o){var c=o.replace("#","");l=TS.channels.getChannelByName(c);if(!l)l=TS.groups.getGroupByName(c);if(!l){if(TS.boot_data.feature_teams_to_workspaces)u=TS.i18n.t("A valid member name is required.","cmd_handlers")();else u=TS.i18n.t("A valid team member name is required.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}}else $("#direct_messages_header").trigger("click.open_dialog").scrollintoview({duration:500});var _=n.replace(o,"");if(d){if(d.deleted){u=TS.i18n.t("That user has been deactivated","cmd_handlers")()+" :disappointed:";if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}TS.ims.startImByMemberId(d.id,false,_)}else if(l){if(l.is_archived){u=TS.i18n.t("That {channel} has been archived","cmd_handlers")({channel:l.is_channel?TS.i18n.t("channel","cmd_handlers")():TS.i18n.t("private channel","cmd_handlers")()});if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}if(l.is_channel)TS.channels.displayChannel({id:l.id,and_send_txt:_});else TS.groups.displayGroup({id:l.id,and_send_txt:_})}}},"/invite":{localized:"/"+TS.i18n.t("invite","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Invite another member to a channel","cmd_handlers")(),args:[{name:"@user",optional:false},{name:TS.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,n,r,i){var a=r.length>1?r[1]:"";var s=g(a);var o;if(a)if(TS.boot_data.feature_name_tagging_client)o=TS.user_groups.getUserGroupsById(a.substr(1));else o=TS.user_groups.getUserGroupsByHandle(a);if(!s&&!o&&a){if(TS.boot_data.feature_teams_to_workspaces)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid member name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid team member name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s&&s.deleted){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("That user has been deactivated.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s&&s.is_ultra_restricted){var l=TS.utility.parseJSONOrElse(_.get(s,"profile.guest_channels"),[])[0];if(l===TS.model.active_channel_id);else if(l){if(TS.model.user.is_admin)if(TS.boot_data.feature_teams_to_workspaces)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is a Single-Channel Guest and can’t be added to a second channel. To invite {user} to this channel, you’ll need to <{team_url}admin#restricted|upgrade their membership> to a Multi-Channel Guest. ​Note: This will add a billable seat to your workspace.","cmd_handlers")({user:_.escape(a),team_url:TS.boot_data.team_url}),{input_txt:i,slackbot_feels:"sad_surprise"});else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is a Single-Channel Guest and can’t be added to a second channel. To invite {user} to this channel, you’ll need to <{team_url}admin#restricted|upgrade their membership> to a Multi-Channel Guest. ​Note: This will add a billable seat to your team.","cmd_handlers")({user:_.escape(a),team_url:TS.boot_data.team_url}),{input_txt:i,slackbot_feels:"sad_surprise"});else if(TS.boot_data.feature_teams_to_workspaces)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is a Single-Channel Guest and can’t be added to a second channel. Your Workspace Admin can upgrade their membership to a Multi-Channel Guest.","cmd_handlers")({user:_.escape(a)}),{input_txt:i,slackbot_feels:"sad_surprise"});else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is a Single-Channel Guest and can’t be added to a second channel. Your Team Admin can upgrade their membership to a Multi-Channel Guest.","cmd_handlers")({user:_.escape(a)}),{input_txt:i,slackbot_feels:"sad_surprise"});return}else if(!TS.model.user.is_admin){if(TS.boot_data.feature_teams_to_workspaces)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is a Single-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:_.escape(a)}),{input_txt:i,slackbot_feels:"sad_surprise"});else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is a Single-Channel Guest. Only your Team Admin can invite them to a channel.","cmd_handlers")({user:_.escape(a)}),{input_txt:i,slackbot_feels:"sad_surprise"});return}}if(s&&s.is_app_user){var u=TS.shared.getActiveModelOb();TS.apps.permissions.addAppToResource(s,u,i);return}var d=r.length>2?r[2]:"";if(d){if(!s&&!o){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}var c=TS.channels.getChannelByName(d);var m=TS.groups.getGroupByName(d);if(c){if(s)f(s,c,i);else if(o)p(o,c,i)}else if(m){if(s)f(s,m,i);else if(o)p(o,m,i)}else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"})}else if(TS.model.active_channel_id){var h=TS.channels.getChannelById(TS.model.active_channel_id);if(s)f(s,h,i);else if(o)p(o,h,i);else TS.ui.channel_invite_modal.startInviteToChannelModal(TS.model.active_channel_id)}else if(TS.model.active_group_id){var S=TS.groups.getGroupById(TS.model.active_group_id);if(s)f(s,S,i);else if(o)p(o,S,i);else TS.ui.channel_invite_modal.startInviteToChannelModal(TS.model.active_group_id)}else if(TS.model.active_mpim_id){var T=TS.mpims.getMpimById(TS.model.active_mpim_id);if(s&&T)f(s,T,i);else TS.ui.im_browser.startWithMpim(T)}else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"})}},"/invite_people":{localized:"/"+TS.i18n.t("invite_people","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Invite people to your workspace","cmd_handlers")():TS.i18n.t("Invite people to your Slack team","cmd_handlers")(),args:[{name:"name@example.com, ...",optional:true}],func:function e(t,n){if(TS.ui.admin_invites.canInvite()){n=n&&n.trim();if(n)TS.ui.admin_invites.populateInvites(n.split(/\s*,\s*|\s+/).map(function(e){return{email:e}}));TS.ui.admin_invites.start()}else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You don’t have permission to invite people.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/dm":{localized:"/"+TS.i18n.t("dm","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/msg",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/msg"].func(t,n,r,i,a,s)}},"/archive":{localized:"/"+TS.i18n.t("archive","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Archive the current channel","cmd_handlers")(),func:function e(){var t=TS.shared.getActiveModelOb();if(t.is_archived||TS.channels.isChannelRequired(t))return;if(TS.model.active_channel_id){if(!TS.permissions.members.canArchiveChannels())return;var n=TS.channels.getChannelById(TS.model.active_channel_id);TS.channels.ui.showArchiveChannelDialog(n)}else if(TS.model.active_group_id){if(TS.model.user.is_restricted)return;var r=TS.groups.getGroupById(TS.model.active_group_id);TS.channels.ui.showArchiveGroupDialog(r)}}},"/leave":{localized:"/"+TS.i18n.t("leave","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/close","/part"],localized_aliases:["/"+TS.i18n.t("close","cmd_handlers")(),"/"+TS.i18n.t("part","cmd_handlers")()],desc:TS.i18n.t("Leave a channel","cmd_handlers")(),func:function e(t,n,r){if(1==r.length){var i=TS.shared.getActiveModelOb();if(i.is_channel)if(i.is_mpim)TS.channels.closeMpim(i.id);else if(i.is_archived)TS.channels.closeArchivedChannel(i.id);else TS.channels.leave(i.id);else if(i.is_im)TS.ims.closeIm(i.id);else if(i.is_mpim)TS.mpims.closeMpim(i.id);else if(i.is_group)if(i.is_archived)TS.shared.closeArchivedChannel(i.id);else TS.groups.leave(i.id);else if(TS.boot_data.feature_teams_to_workspaces)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel or member name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel or team member name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}else{var a=TS.channels.getChannelByName(n);if(a)TS.channels.leave(a.id);else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}}},"/star":{localized:"/"+TS.i18n.t("star","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,desc:TS.i18n.t("Stars the current channel or conversation","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o;if(s&&a)TS.stars.toggleStarOnMsg(a.ts,s,function(){o=a.is_starred?TS.i18n.t("Ok, I starred this thread","cmd_handlers")():TS.i18n.t("Ok, I unstarred this thread","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(o,{c_id:s.id,thread_ts:a.ts})});else TS.stars.toggleStar(function(e){if(e.is_starred)o=TS.i18n.t("Ok, I starred {channel}","cmd_handlers")({channel:e.name});else o=TS.i18n.t("Ok, {channel} is unstarred","cmd_handlers")({channel:e.name});TS.cmd_handlers.addEphemeralFeedback(o)})}},"/close":{localized:"/"+TS.i18n.t("close","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,n,r){TS.cmd_handlers["/leave"].func(t,n,r)}},"/part":{localized:"/"+TS.i18n.t("part","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,n,r){TS.cmd_handlers["/leave"].func(t,n,r)}},"/topic":{localized:"/"+TS.i18n.t("topic","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Set the channel topic","cmd_handlers")(),args:[{name:TS.i18n.t("new topic","cmd_handlers")(),optional:true}],func:function e(t,n,r,i){var a=TS.shared.getActiveModelOb();if(TS.model.user.is_restricted||TS.channels.isChannelRequired(a)&&!TS.permissions.members.canPostInChannel(a)){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Setting the topic is a restricted action.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(n.length>TS.model.channel_topic_max_length){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Topics cannot exceed {max_characters} characters.","cmd_handlers")({max_characters:TS.model.channel_topic_max_length}),{input_txt:i,slackbot_feels:"sad_surprise"});return}var s=n;if(TS.boot_data.feature_name_tagging_client)s=_.trim(i.substr(t.length));if(TS.model.active_channel_id)if(s)TS.channels.setTopic(TS.model.active_channel_id,s);else $("#channel_topic_text").click().focus().select();else if(TS.model.active_group_id)if(s)TS.groups.setTopic(TS.model.active_group_id,s);else $("#channel_topic_text").click().focus().select();else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Regrettably, DMs do not have topics","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/togglethemes":{localized:"/"+TS.i18n.t("togglethemes","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.prefs.setPrefByAPI({name:"messages_theme",value:"light_with_avatars"===TS.model.prefs.messages_theme?"dense":"light_with_avatars"})}},"/search":{localized:"/"+TS.i18n.t("search","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/s"],localized_aliases:["/"+TS.i18n.t("s","cmd_handlers")()],desc:TS.i18n.t("Perform a search","cmd_handlers")(),args:[{name:TS.i18n.t("your text","cmd_handlers")(),optional:true}],func:function e(t,n){TS.client.ui.flex.openFlexTab("search");TS.view.resizeManually("TS.search.view.showResults");TS.search.autocomplete.search(n,true);TS.clog.track("SEARCH_OPEN",{open_method:"command"})}},"/s":{localized:"/"+TS.i18n.t("search","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/search",aliases:null,desc:"",func:function e(t,n){TS.cmd_handlers["/search"].func(t,n)}},"/rename":{localized:"/"+TS.i18n.t("rename","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Rename a channel","cmd_handlers")(),args:[{name:TS.i18n.t("new name","cmd_handlers")(),optional:true}],func:function e(t,n){if(TS.model.user.is_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You don’t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(!TS.model.active_channel_id&&!TS.model.active_group_id){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("IM channels cannot be renamed.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var r=TS.shared.getActiveModelOb();if(TS.model.active_channel_id||TS.model.active_group_id)if(!TS.model.user.is_admin&&r.creator!=TS.model.user.id){if(TS.boot_data.feature_teams_to_workspaces)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Only Workspace Admins (or the channel creator) are allowed to rename channels.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Only Team Admins (or the channel creator) are allowed to rename channels.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var i=_.escape(n)||r.name;TS.ui.channel_options_dialog.start(r.id,"rename",{name:i})}},"/beep":{localized:"/"+TS.i18n.t("beep","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.sounds.play("new_message")}},"/upload":{localized:"/"+TS.i18n.t("upload","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(t,n){var r=TS.utility.base64StrtoBlob(n);TS.client.ui.file_pasted_sig.dispatch(r)}},"/colors":{localized:"/"+TS.i18n.t("colors","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colours"],localized_aliases:["/"+TS.i18n.t("colours","cmd_handlers")()],desc:TS.i18n.t("View any custom colors you have set for other members","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=TS.members.getMembersForUser();var l;var u="";for(var d=0;d<o.length;d+=1){l=o[d];if(l.member_color!=l.color)u+=l.name+": "+l.member_color+"\n"}var c=u?TS.i18n.t("You have overridden colors as follows:","cmd_handlers")()+"\n"+u:TS.i18n.t("No user color overrides have been set.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(c,{temporary:false,c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(c,{temporary:false})}},"/colours":{localized:"/"+TS.i18n.t("colours","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/colors",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/colors"].func(t,n,r,i,a,s)}},"/color":{localized:"/"+TS.i18n.t("color","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colour"],localized_aliases:["/"+TS.i18n.t("colour","cmd_handlers")()],desc:TS.i18n.t("Set a custom color for another member","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=r.length>1?r[1]:"";var l=r.length>2?r[2].replace(/#/g,""):"";var u;var d=g(o);if(!d){u=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("A valid member name is required.","cmd_handlers")():TS.i18n.t("A valid team member name is required.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}var c;if(d)if(TS.boot_data.feature_name_tagging_client)c=TS.members.getPrefCompliantMemberName(d,true,true);else c="@"+d.name;if(l&&(6!=l.length||!("#"+l).match(TS.format.hex_rx))){u=TS.i18n.t("A valid 6 character hex code is required, like `FF0000`.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i});return}TS.members.setMemberUserColor(d,l);TS.model.prefs.user_colors=JSON.stringify(TS.model.user_colors);TS.prefs.setPrefByAPI({name:"user_colors",value:TS.model.prefs.user_colors});if(l)u=TS.i18n.t("You’ve set your custom color for {user} to {color}","cmd_handlers")({user:c,color:"#"+l});else u=TS.i18n.t("You’ve removed your custom color for {user}.","cmd_handlers")({user:c});if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i})}},"/colour":{localized:"/"+TS.i18n.t("colour","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/color",aliases:null,desc:"",func:function e(t,n,r,i,a,s){TS.cmd_handlers["/color"].func(t,n,r,i,a,s)}},"/colortest":{localized:"/"+TS.i18n.t("colortest","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(t,n){var r=null;if(n)try{r=JSON.parse(n)}catch(e){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Not a good value for colors: ","cmd_handlers")()+n,{slackbot_feels:"sad_surprise"});return}if(!r||!r.length)r=["#DDCFFA","#2EF645","#F38303","#E702AE","#3C986D","#9D6158","#F43368","#97C10A","#7491F9","#9E63A3","#FACE41","#35A5CC","#39A93E","#4FECA8","#CA5B34","#E2A974","#2BCFCB","#F89BA7","#89868A","#6A7841","#ADC498","#B1DBDD","#B849C3","#9CDB81","#E72F36","#A16A28","#F68CCF","#317C84","#58851C","#FC4A97","#5774BB","#97B7FE","#C64D97","#CB4A5C","#F68B6B","#81EE4F","#B7ED6D","#756D8E","#3AED69","#81E7FB","#91ECB7","#ED8947","#57AF19","#28BC89","#4A9788","#D645DF","#B498FE","#71C8F9","#C07B1D","#16BD60","#EFCAE3","#A4E0BB","#478AAF","#59953E","#886CA7","#F0C3F1","#29AF70","#80A5F8","#636BB8"];var i;for(i=0;i<r.length;i+=1)r[i]=r[i].replace("#","");var a=TS.members.getMembersForUser();for(i=0;i<a.length;i+=1)TS.members.setMemberUserColor(a[i],r[_.random(0,r.length-1)])}},"/discon":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){if(TS.isSocketManagerEnabled())TS.interop.SocketManager.disconnect();else TS.ms.disconnect()}},"/sleepsleep":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){if(TS.isSocketManagerEnabled())TS.interop.SocketManager.sleep();else TS.ms.sleep()}},"/sleepsleep2":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.sleep()}else{TS.ms.sleep();TS.ms.setReconnectUrl("")}}},"/wakewake":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){if(TS.isSocketManagerEnabled())TS.interop.SocketManager.wake();else TS.ms.wake()}},"/discon2":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.model.break_token=true;if(TS.isSocketManagerEnabled())TS.interop.SocketManager.disconnect();else TS.ms.disconnect()}},"/discon4":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.debugClearFastReconnectUrl();TS.interop.SocketManager.disconnect()}else{TS.ms.setReconnectUrl("");TS.ms.disconnect()}}},"/emo":{localized:"/"+TS.i18n.t("emo","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/emote","/emoji"],localized_aliases:["/"+TS.i18n.t("emote","cmd_handlers")(),"/"+TS.i18n.t("emoji","cmd_handlers")()],desc:"",func:function e(){var t={target:TS.client.ui.$msg_input};TS.ui.react_emoji_menu.start({e:t})}},"/emoji":{localized:"/"+TS.i18n.t("emoji","cmd_handlers")(),type:"client",autocomplete:false,alias_of:"/emo",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/emo"].func()}},"/emote":{localized:"/"+TS.i18n.t("emote","cmd_handlers")(),type:"client",autocomplete:false,alias_of:"/emo",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/emo"].func()}},"/editlast":{localized:"/"+TS.i18n.t("editlast","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.i18n.t("Edit the last message you posted","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=s||TS.shared.getActiveModelOb();var l;if(!o)return;n=$.trim(n);if(!n){l=TS.i18n.t("You must enter some text!","cmd_handlers")();if(o&&a)TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,c_id:o.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i});return}var u;if(o&&a)u=TS.utility.msgs.getEditableReplyByProp("user",TS.model.user.id,o,a.ts);else{var d=_.reject(o.msgs,TS.utility.msgs.isMsgReply);u=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,d)}if(!u){l=TS.i18n.t("Found no recent messages from you to edit.","cmd_handlers")();if(o&&a)TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,slackbot_feels:"sad_surprise",c_id:o.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,slackbot_feels:"sad_surprise"});return}TS.msg_edit.commitEdit(u,o,n)}},"/deletelast":{localized:"/"+TS.i18n.t("deletelast","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.i18n.t("Delete the last message you posted","cmd_handlers")(),func:function e(t,n,r,i,a,s){var o=s||TS.shared.getActiveModelOb();if(!o)return;var l;if(o&&a)l=TS.utility.msgs.getEditableReplyByProp("user",TS.model.user.id,o,a.ts);else{var u=_.reject(o.msgs,TS.utility.msgs.isMsgReply);l=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,u)}if(!l){var d=TS.i18n.t("Found no recent messages from you to delete.","cmd_handlers")();if(o&&a)TS.cmd_handlers.addEphemeralFeedback(d,{slackbot_feels:"sad_surprise",c_id:o.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(d,{slackbot_feels:"sad_surprise"});return}TS.msg_edit.startDelete(l.ts,o)}},"/collapse":{localized:"/"+TS.i18n.t("collapse","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Collapse all files in the current channel (opposite of /expand)","cmd_handlers")(),func:function e(){TS.inline_imgs.collapseAllInCurrent();TS.inline_videos.collapseAllInCurrent();TS.inline_attachments.collapseAllInCurrent();TS.inline_audios.collapseAllInCurrent();TS.inline_others.collapseAllInCurrent();TS.inline_file_previews.collapseAllInCurrent();TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("I’ve collapsed all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/expand":{localized:"/"+TS.i18n.t("expand","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Expand all files in the current channel (opposite of /collapse)","cmd_handlers")(),func:function e(){TS.inline_imgs.expandAllInCurrent();TS.inline_videos.expandAllInCurrent();TS.inline_attachments.expandAllInCurrent();TS.inline_audios.expandAllInCurrent();TS.inline_others.expandAllInCurrent();TS.inline_file_previews.expandAllInCurrent();TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("I’ve expanded all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/attach_align":{localized:"/"+TS.i18n.t("attach_align","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){$("body").toggleClass("attachments_flush_with_avatar")}},"/attach_thumb_align":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){window.attach_thumb_align_title=!window.attach_thumb_align_title;TS.client.msg_pane.rebuildMsgsWithReason("/attach_thumb_align command")}},"/remove":{localized:"/"+TS.i18n.t("remove","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/kick"],localized_aliases:["/"+TS.i18n.t("kick","cmd_handlers")()],desc:TS.i18n.t("Remove a person from the current channel","cmd_handlers")(),args:[{name:"@user",optional:false}],func:function e(t,n,r,i){if(TS.model.active_channel_id&&!TS.permissions.members.canKickFromChannels()){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Removing from channels is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(TS.model.active_group_id&&!TS.permissions.members.canKickFromGroups()){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Removing from private channels is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var a=TS.shared.getActiveModelOb();if(a.is_archived){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You can’t remove anyone from *{channel}* while it is archived.","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}),{slackbot_feels:"sad_surprise"});return}n=$.trim(n);if(!n){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Please specify someone to remove!","cmd_handlers")(),{input_txt:i});return}var s=g(n);if(!s){var o=TS.format.texty.convertContentsStringToContents(_.trim(i.substr(t.length)));TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("*{input}* is not a recognized member name.","cmd_handlers")({input:_.escape(TS.format.texty.convertContentsToStringForDisplay(o))}),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s.is_app_user){TS.apps.permissions.removeAppFromResource(s,a,i);return}if(TS.model.active_im_id||TS.model.active_mpim_id){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You can’t remove someone from a DM.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(TS.channels.isChannelRequired(a)&&!s.is_restricted&&!s.is_bot){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You can’t remove this member from *{channel}*!","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}));return}TS.membership.ensureChannelMembershipIsKnownForUsers(a.id,[s.id]).then(function(){var e=TS.membership.getUserChannelMembershipStatus(s.id,a);if(!e.is_member){var n=TS.format.texty.convertContentsStringToContents(_.trim(i.substr(t.length)));TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("*{user}* is not a member of this {channel}.","cmd_handlers")({user:_.escape(TS.format.texty.convertContentsToStringForDisplay(n)),channel:a.is_channel?TS.i18n.t("channel","cmd_handlers")():TS.i18n.t("private channel","cmd_handlers")()}),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s.is_self){TS.client.ui.onSubmit("/leave");return}if(a.is_channel)TS.channels.kickMember(a.id,s.id);else if(a.is_group)TS.groups.kickMember(a.id,s.id)})}},"/kick":{localized:"/"+TS.i18n.t("kick","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/remove",aliases:null,desc:"",func:function e(t,n,r,i){TS.cmd_handlers["/remove"].func(t,n,r,i)}},"/feedback":{localized:"/"+TS.i18n.t("feedback","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Send feedback to Slack","cmd_handlers")(),args:[{name:TS.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){if(!n){TS.utility.openInNewTab("/help/requests/new","_blank");return}TS.generic_dialog.start({title:TS.i18n.t("Send feedback","cmd_handlers")(),body:'<p class="bold">'+TS.i18n.t("Looks like you are trying to send us some feedback! Yes?","cmd_handlers")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, send it","cmd_handlers")(),onGo:function e(){var r={command:t,text:TS.format.cleanCommandText(n),channel:TS.model.active_cid,client_token:TS.interop.client_action_token.generateAndEnqueue()};if(s&&a){r.channel=s.id;r.thread_ts=a.ts}var o=n;if(TS.boot_data.feature_name_tagging_client)o=i;TS.api.call("chat.command",r,function(e,t,n){TS.client.ui.onAPICommand(e,t,n,o)})},onCancel:function e(){if(s&&a)TS.utility.populateThreadInputs(i,s.id,a.ts);else TS.utility.populateInput(TS.client.ui.$msg_input,i)}})}},"/shrug":{localized:"/"+TS.i18n.t("shrug","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Appends ¯\\_(ツ)_/¯ to your message","cmd_handlers")(),args:[{name:TS.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,n,r,i,a,s){var o=_.trim(i.substr(t.length));if(o&&" "!==o.substr(o.length-1))o+=" ";o+="¯\\_(ツ)_/¯ ";if(!s)s=TS.shared.getActiveModelOb();TS.client.ui.sendMessage(s,o,a)}},"/showfallbacks":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.model.show_attachment_fallback=!TS.model.show_attachment_fallback;TS.client.msg_pane.rebuildMsgsWithReason("/showfallbacks command")}},"/macgap.app.enabledevelopertools()":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){if(window.macgap&&window.macgap.app&&window.macgap.app.enableDeveloperTools)macgap.app.enableDeveloperTools()}},"/toggle_debugging_prefs":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.ui.prefs_dialog.start("advanced","#prefs_debug")}},"/slack_diagnostic_report":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){l()}}});var e=["/shrug","/prefs","/shortcuts","/keys","/toggle_debugging_prefs","/away","/search","/togglethemes","/feedback","/slack_diagnostic_report","/msg","/dm","/s","/editlast","/deletelast","/star","/beep","/colors","/colours","/color","/colour","/active"];if(TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE)e.push("/"+TS.i18n.t("active","cmd_handlers")());var t;var n={localized:null,type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Start a call","cmd_handlers")(),args:[{name:TS.i18n.t("help","cmd_handlers")(),optional:true}],can_be_overridden_by_server_cmd:true,func:function e(t,n){var r=TS.shared.getActiveModelOb();var i=TS.members.getMemberById(r.user);if(TS.boot_data.page_needs_enterprise){var a=TS.model.team;if(TS.shared.isModelObShared(r)||i&&a&&i.team_id!==a.id){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You are not allowed to use this command here.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}}if("help"===n.trim()){if(TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()){if(TS.boot_data.feature_teams_to_workspaces)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("To call someone, use `/call` in a direct message to them.","cmd_handlers")());else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("To call a teammate, use `/call` from your Direct Message conversation with that person.","cmd_handlers")());return}var s;if(r.is_mpim)s=TS.i18n.t("To call {group_name}, use `/call` in this group conversation.","cmd_handlers")({group_name:TS.shared.getDisplayNameForModelOb(r)});else if(r.is_im)s=TS.i18n.t("To call {user}, use `/call` in this Direct Message conversation.","cmd_handlers")({user:TS.shared.getDisplayNameForModelOb(r)});else s=TS.i18n.t("To start a call in {channel}, use `/call` here","cmd_handlers")({channel:TS.shared.getDisplayNameForModelOb(r)});TS.cmd_handlers.addEphemeralFeedback(s);return}if(n.trim().match(/--server=/)){var o=n.trim().replace(/--server=/g,"");var l=TS.storage.fetchCallsState();l.call_server_override=o;TS.storage.storeCallsState(l)}if(TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()){if("Slack"!==TS.model.team.prefs.calling_app_name){TS.utility.calls.startCallInModelOb(r,true);return}TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Group calls aren’t available on the free plan. Try using `/call` in a Direct Message conversation!","cmd_handlers")());return}else if(r.is_slackbot_im){var u=[TS.i18n.t("I’m on the other line. Sorry!","cmd_handlers")(),TS.i18n.t("Thanks for calling me! I’m afraid I only accept calls from my mother, Sundays at 2pm.","cmd_handlers")(),TS.i18n.t("I’m washing my hair right now…can’t come to the phone!","cmd_handlers")(),TS.i18n.t("It’s awfully nice of you to try calling me. But — shh! — I’m quite afraid of the phone!","cmd_handlers")()+" :grimacing:",TS.i18n.t("Thank you so much for calling, but I can’t talk right now, I’m watching my stories.","cmd_handlers")()];var d=_.shuffle(u)[0];TS.cmd_handlers.addEphemeralFeedback(d);return}else if(i&&(i.is_bot||i.id==TS.model.user.id)){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Unfortunately, {user} is busy right now, and can’t answer your call.","cmd_handlers")({user:TS.members.getPrefCompliantMemberName(i,false,true)}),{slackbot_feels:"sad_surprise"});return}TS.utility.calls.startCallInModelOb(r,true)}};var r=function n(){if(t||TS.i18n.locale()===TS.i18n.DEFAULT_LOCALE)return;t=true;var r;var i;_.forOwn(TS.cmd_handlers,function(t,n){if(0!==n.indexOf("/"))return;r=TS.cmd_handlers[n].localized?TS.cmd_handlers[n].localized.toLowerCase():null;if(r&&r!==n&&!TS.cmd_handlers[r]){TS.cmd_handlers[r]=_.clone(TS.cmd_handlers[n]);TS.cmd_handlers[r].localized=null;TS.cmd_handlers[n].autocomplete=false;i=TS.i18n.deburr(r);if(r!==i){TS.cmd_handlers[r].normalized=i;if(!TS.cmd_handlers[i])TS.cmd_handlers[i]=_.clone(TS.cmd_handlers[n])}if(_.includes(e,n))e.push(r)}})};var i=function e(t,n){TS.model.commands_cache_ts=n;var r={data:t,cache_ts:TS.model.commands_cache_ts};if(TS.boot_data.feature_localization)r.locale=TS.i18n.locale();TS.storage.storeCmds(r);TS.cmd_handlers.mergeInServerCmds(t);o()};var a=function e(){var t=TS.storage.fetchCmds();if(!t)return false;if(TS.model.commands_cache_ts!==t.cache_ts)return false;if(TS.boot_data.feature_localization&&TS.i18n.locale()!==t.locale)return false;return true};var s=function e(){TS.cmd_handlers.setUpCmds()};var o=function e(){var t="/"+TS.i18n.t("call","cmd_handlers")();var r=TS.i18n.deburr(t);if(!TS.utility.calls.isEnabled()){if(TS.cmd_handlers["/call"]&&"client"===TS.cmd_handlers["/call"].type)_.unset(TS.cmd_handlers,"/call");if(TS.cmd_handlers[t]&&"client"===TS.cmd_handlers[t].type)_.unset(TS.cmd_handlers,t);if(t!==r&&TS.cmd_handlers[r]&&"client"===TS.cmd_handlers[r].type)_.unset(TS.cmd_handlers,t)}else if(!TS.cmd_handlers["/call"])if("/call"===t)TS.cmd_handlers["/call"]=n;else{TS.cmd_handlers[t]=_.clone(n);var i=_.clone(n);i.autocomplete=false;i.localized=null;TS.cmd_handlers["/call"]=i;if(t!==r){TS.cmd_handlers[t].normalized=r;if(!TS.cmd_handlers[r])TS.cmd_handlers[r]=i}}};var l=function e(){TS.info("Generating diagnostic report...");var t=u();var n;var r=TS.i18n.t("This will take a minute &mdash; hang tight.","cmd_handlers")();TS.generic_dialog.start({title:TS.i18n.t("Building diagnostic report","cmd_handlers")(),body:r,show_cancel_button:true,show_go_button:false,go_button_text:TS.i18n.t("Send Report to Slack","cmd_handlers")(),onCancel:function e(){if(t.isPending()){TS.info("Cancelling diagnostic report");t.cancel()}},onGo:function e(){TS.info("Sending diagnostic report to Zendesk...");TS.api.call("help.issues.create",{title:"Slack diagnostic report",text:"Please see attached file.",attach_text:n,tags:"slack_diagnostic_report"}).catch(function(){TS.generic_dialog.alert(TS.i18n.t('Oops! That didn’t work &mdash; please give it another try. If problems persist, please <a href="/help/requests/new">contact support</a>.',"cmd_handlers")(),"Something went wrong","Close")}).finally(function(){TS.generic_dialog.cancel()});TS.generic_dialog.div.find(".btn").addClass("disabled").attr("disabled",true);return false}});t.then(function(e){n=e;TS.info(e);TS.generic_dialog.div.find("h3").text(TS.i18n.t("Diagnostic report ready","cmd_handlers")());TS.generic_dialog.div.find(".modal-body").html(TS.i18n.t("Click the button below to send the report to Slack.","cmd_handlers")());TS.generic_dialog.div.find(".btn.dialog_go").removeClass("hidden");TS.generic_dialog.div.find(".btn.dialog_cancel").text(TS.i18n.t("Close","cmd_handlers")())})};var u=function e(){var t=performance.now();var n={};n["rtm.start"]=TS.api.call("rtm.start",{}).then(function(e){return{latency:performance.now()-t,size_bytes:JSON.stringify(e.data).length}}).catch(function(e){return{error:e}});var r={exclude_members:true};n.channels=TS.api.call("channels.list",r).then(function(e){return{remote:_.map(e.data.channels,"id").sort(),local:_.map(TS.model.channels,"id").sort(),for_user:_.map(TS.channels.getChannelsForUser(),"id").sort()}}).catch(function(e){return{error:e}});n.groups=TS.api.call("groups.list",{mpim_aware:true}).then(function(e){return{remote:_.map(e.data.groups,"id").sort(),local:_.map(TS.model.groups,"id").sort()}}).catch(function(e){return{error:e}});n.ims=TS.api.call("im.list").then(function(e){return{remote:_.map(e.data.ims,"id").sort(),local:_.map(TS.model.ims,"id").sort()}}).catch(function(e){return{error:e}});n.mpims=TS.api.call("mpim.list").then(function(e){return{remote:_.map(e.data.groups,"id").sort(),local:_.map(TS.model.mpims,"id").sort()}}).catch(function(e){return{error:e}});n.members=TS.api.call("users.list").then(function(e){return{remote:_.map(e.data.members,"id").sort(),local:_.map(TS.model.members,"id").sort(),for_user:_.map(TS.members.getMembersForUser(),"id").sort()}}).catch(function(e){return{error:e}});n["channel pane"]=new Promise(function(e){var t=$("#channels_scroller li").map(function(e,t){var n=$(t);if(n.hasClass("channel"))return n.find("[data-channel-id]").attr("data-channel-id");else if(n.hasClass("group"))return n.find("[data-group-id]").attr("data-group-id");else if(n.hasClass("member"))return n.find("[data-member-id]").attr("data-member-id");else if(n.hasClass("mpim"))return n.find("[data-mpim-id]").attr("data-mpim-id");return null}).toArray();e(t)});n["version info"]=TS.api.call("test.versionInfo").then(function(e){return{active_version_ts:TS.boot_data.version_ts,latest_version_ts:_.get(e.data,"version_ts"),min_version_ts:_.get(e.data,"min_version_ts")}});return Promise.props(n).then(function(e){var n=Object.keys(e).map(function(t){return[t,_.repeat("-",t.length),JSON.stringify(e[t])].join("\n")});var r=["Slack Diagnostic Report","-----------------------","Date: "+TS.makeLogDate().trim(),"Time to generate: "+_.round((performance.now()-t)/1e3,2)+" seconds","User agent: "+navigator.userAgent,"Logged-in user:"+TS.model.user.id,"",n.join("\n\n"),"","-------------","End of report"];return r.join("\n")})};var d=function e(t){var n=false;if(TS.boot_data.page_needs_enterprise){var r=TS.shared.getActiveModelOb();if(TS.shared.isModelObShared(r))n=true}return{cmds:t.filter(function(e){return("core"===e.type||"client"===e.type)&&!(n&&"/call"===e.name)}),id:"core",name:"Slack"}};var c=function e(t){return{cmds:t.filter(function(e){return"custom"===e.type}),id:"custom",name:TS.model.team.name}};var m=function e(t){var n=t.filter(function(e){return"app"===e.type||"service"===e.type});var r=n.filter(function(e){return!!(e.service_name||e.app)});var i=n.filter(function(e){return!(e.service_name||e.app)});var a={};r.forEach(function(e){var t=TS.cmd_handlers.getAppNameForCmdName(e.name);if(!a[t])a[t]=[];a[t].push(e)});var s=TS.apps.sortNames(Object.keys(a));var o=s.map(function(e){return{cmds:a[e],id:"app",name:e}});o.push({cmds:i,id:"app",name:"Other"});return o};var f=function e(t,n,r){if(!_.isObject(t))throw new Error("Expected user to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");if(!_.isString(r))throw new Error("Expected input_txt to be a string");TS.membership.ensureChannelMembershipIsKnownForUsers(n.id,[t.id]).then(function(){var e=TS.membership.getUserChannelMembershipStatus(t.id,n);if(e.is_member){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is already in this channel.","cmd_handlers")({user:h(t)}),{input_txt:r});return}if(!n.is_mpim&&TS.boot_data.page_needs_enterprise&&!TS.permissions.channels.canMemberJoinChannel(n,t)){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is not a member of {team_name}.","cmd_handlers")({user:h(t),team_name:TS.model.team.name}),{input_txt:r,slackbot_feels:"sad_surprise"});return}if(n.is_mpim)TS.ui.im_browser.startWithMpim(n,[t.id]);else if(n.is_private||n.is_group)TS.ui.invite.showInviteMembersPreSelected(n.id,[t.id]);else TS.api.call("channels.invite",{channel:n.id,users:t.id})})};var p=function e(t,n,r){if(!_.isObject(t))throw new Error("Expected ug to be an object");if(!_.isObject(n))throw new Error("Expected model_ob to be an object");if(!_.isString(r))throw new Error("Expected input_txt to be a string");TS.membership.ensureChannelMembershipIsKnownForUsers(n.id,t.users).then(function(){var e=t.users.filter(function(e){if(TS.boot_data.page_needs_enterprise){var t=TS.members.getMemberById(e);if(!TS.permissions.channels.canMemberJoinChannel(n,t))return false}var r=TS.membership.getUserChannelMembershipStatus(e,n);return!r.is_member});if(!e.length){var i=TS.i18n.t("All of the users in that user group are already in this channel.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:r});return}if(n.is_private||n.is_group)TS.ui.invite.showInviteMembersPreSelected(n.id,e);else e.forEach(function(e){TS.api.call("channels.invite",{channel:n.id,users:e})})})};var h=function e(t){if(!_.isObject(t))throw new Error("Expected user to be an object");if(TS.boot_data.feature_name_tagging_client)return TS.members.getPrefCompliantMemberName(t,false,true);return"@"+t.name};var g=function e(t){if(TS.boot_data.feature_name_tagging_client)return TS.members.getMemberById(t);else if(TS.boot_data.feature_shared_channels_client){var n=t.match(/^@([\w.-]+)\+([\w.-]+)$/);if(n&&n.length>1)return TS.members.getMemberByNameAndTeamDomain(n[1],n[2])}return TS.members.getMemberByName(t)}})()},4266:function(e,t){(function(){"use strict";TS.registerModule("stars",{member_stars_fetched_sig:new signals.Signal,member_stars_being_fetched_sig:new signals.Signal,channel_starred_sig:new signals.Signal,channel_unstarred_sig:new signals.Signal,has_more:false,fetched_once:false,onStart:function e(){TS.files.team_file_changed_sig.add(o);TS.files.team_file_deleted_sig.add(TS.stars.maybeUpdateUserStarredList);TS.files.team_file_comment_deleted_sig.add(TS.stars.maybeUpdateUserStarredList);TS.channels.message_changed_sig.add(a);TS.ims.message_changed_sig.add(a);TS.mpims.message_changed_sig.add(a);TS.groups.message_changed_sig.add(a);n=$("#member_stars_more_btn")},maybeUpdateUserStarredList:function e(t){if(!TS.client)return;if(!TS.model.team)return;if(r||!TS.stars.fetched_once){i=true;return}s(t)},maybeRemoveStarredListItem:function e(t){if(!TS.client)return;var n=_.findIndex(TS.model.user.stars,function(e){if(e.type!==t.type)return false;switch(e.type){case"message":return e.message.ts===t.message.ts;case"file":return e.file.id===t.file_id;case"file_comment":return e.comment.id===t.comment.id}return false});if(-1!==n)TS.model.user.stars.splice(n,1);if("stars"!==TS.model.ui_state.flex_name)return;var r;var i;if("file"===t.type){i=".star_item #file_"+t.file_id;r=$(i).parent(".star_item")}else if("message"===t.type){i='.star_item .message[data-ts="'+t.message.ts+'"]';r=$(i).parent(".star_item")}else if("file_comment"===t.type){i='.star_item .star_comment[data-comment-id="'+t.comment.id+'"]';r=$(i).parents(".star_item")}else return;r.remove()},fetchUserStarredItems:function e(){var t=u();if(!TS.stars.fetched_once)TS.stars.fetched_once=true;return TS.api.call("stars.list",t,l)},userStarStatusHasChanged:function e(t,n,r){d(n,r);if("message"===n.type){c(n.message.ts,n.channel,t,false);if(TS.useReactMessages())TS.redux.messages.replaceMessage(_.assign({channel:n.channel},n.message))}else if("file"===n.type){if(n.file.is_starred!=t)f(n.file.id,t)}else if("file_comment"===n.type){if(n.comment.is_starred!=t)m(n.comment.id,n.file.id,t)}else if("channel"===n.type){var i=TS.channels.getChannelById(n.channel);if(!i)TS.warn("userStarStatusHasChanged channel_id:"+n.channel+" not found");else if(i.is_starred!=t)p(n.channel,t)}else if("group"===n.type){var a=TS.groups.getGroupById(n.channel);if(!a)a=TS.mpims.getMpimById(n.channel);if(!a)TS.warn("userStarStatusHasChanged group_id:"+n.channel+" not found");else if(a.is_starred!=t)if(a.is_mpim)S(n.channel,t);else h(n.channel,t)}else if("im"===n.type){var s=TS.ims.getImById(n.channel);if(!s)TS.warn("userStarStatusHasChanged im_id:"+n.channel+" not found");else if(s.is_starred!=t)g(n.channel,t)}else TS.error("userStarStatusHasChanged needs to handle star item type:"+n.type)},checkForStarClick:function e(t){if(!t.target)return false;var n=$(t.target);var r;if(n.closest(".star").length)r=n.closest(".star");else r=n.closest(".star_link");var i=false;if(!r||!r.length)if(n.is("button.file_star"))r=n.children(".star");else if(n.closest(".starred_icon").length){i=true;r=n.closest(".starred_icon")}if(!r||!r.length)return false;if(r.hasClass("not-clickable"))return false;var a=r.hasClass("starred");var s={};var o;if(i){var l=TS.shared.getModelObById(r.data("c-id"));if(l){s.channel=l.id;a=l.is_starred;o=function e(t){if(l.is_channel)p(s.channel,t);else if(l.is_im)g(s.channel,t);else if(l.is_mpim)S(s.channel,t);else if(l.is_group)h(s.channel,t)}}}else if(r.hasClass("star_message")){s.channel=r.data("c-id");s.timestamp=r.data("msg-id");o=function e(t){c(s.timestamp,s.channel,t,true)}}else if(r.hasClass("star_file")){s.file=r.data("file-id");o=function e(t){f(s.file,t)}}else if(r.hasClass("star_file_comment")){s.file_comment=r.data("comment-id");o=function e(t){m(s.file_comment,r.data("file-id"),t)}}else if(r.hasClass("star_channel")){s.channel=r.data("channel-id");o=function e(t){p(s.channel,t)}}else if(r.hasClass("star_group")){s.channel=r.data("group-id");o=function e(t){h(s.channel,t)}}else if(r.hasClass("star_im")||r.hasClass("star_app")){s.channel=r.data("im-id");var u=false;if(TS.apps.isAppSpaceEnabled()&&r.hasClass("star_app"))u=true;o=function e(t){g(s.channel,t,u)}}else if(r.hasClass("star_mpim")){s.channel=r.data("mpim-id");o=function e(t){S(s.channel,t)}}else{TS.error("checkForStarClick doesn't know what to do with a click on "+r[0].outerHTML);return false}t.preventDefault();o(!a);if(a)TS.api.call("stars.remove",s,function(e,t){if(e)return;if("not_starred"===t.error)o(false);else o(true)});else TS.api.call("stars.add",s,function(e,t){if(e)return;if("already_starred"===t.error)o(true);else o(false)});return true},updateFileStar:function e(t,n){f(t,n)},toggleStarOnMsg:function e(t,n,r){if(!t||!n)return;var i=TS.utility.msgs.findMsg(t,n.id);if(!i)return;var a={channel:n.id,timestamp:t};var s=i.is_starred?"stars.remove":"stars.add";TS.api.call(s,a,function(e,t){if(e){if(r)r(n)}else if(t.error)TS.error(t.error)})},toggleStar:function e(t,n){var r=n?TS.shared.getModelObById(n):TS.shared.getActiveModelOb();if(!r||TS.client.activeChannelIsHidden())return;var i=r.is_starred;var a={};a.channel=r.id;if(!i)TS.api.call("stars.add",a,function(e,n){if(e){if(t)t(r)}else if(n.error)TS.error(n.error)});else TS.api.call("stars.remove",a,function(e,n){if(e){if(t)t(r)}else if(n.error)TS.error(n.error)})}});var e=1;var t=20;var n;var r=false;var i=false;var a=function e(t,n){if(true===n.is_starred)TS.stars.maybeUpdateUserStarredList()};var s=function e(n){r=true;i=false;TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,true);var a=true;var s=u();s.page=1;s._update=true;s.count=Math.max(TS.model.user.stars.length,t);if(n&&n.delta)s.count+=n.delta;TS.api.call("stars.list",s,l,a)};var o=function e(t){if(t.hasOwnProperty("is_starred")){f(t.id,t.is_starred,t.id);TS.files.updateFileListItem(t,$(".star_item"))}};var l=function t(a,s,o){r=false;TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,false);if(i){TS.stars.maybeUpdateUserStarredList();return}if(!a){TS.stars.member_stars_fetched_sig.dispatch({error:"api_not_ok"});return}for(var l=0;l<s.items.length;l+=1){var u=s.items[l];TS.stars.userStarStatusHasChanged(true,u,"stars.list")}if(1==o.page)TS.model.user.stars=s.items;else{TS.model.user.stars=TS.model.user.stars.concat(s.items);TS.model.user.stars=_.uniqWith(TS.model.user.stars,_.isEqual)}if(n.data("ladda"))n.data("ladda").stop();TS.stars.has_more=s.paging.pages>s.paging.page;if(!o._update)e+=1;TS.stars.member_stars_fetched_sig.dispatch(null,TS.model.user)};var u=function n(){var r={user:TS.model.user.id,exclude:"Ch,Gh,Dh",page:e,count:t};return r};var d=function e(t,n){var r;if("message"===t.type){t.message._rxn_key=TS.rxns.getRxnKey("message",t.message.ts,t.channel);if("channel_topic"===t.message.type||"channel_purpose"===t.message.type||"channel_join"===t.message.type||"channel_leave"===t.message.type)t.message.subtype=t.message.type;t.message.type="message"}else if("file"===t.type||"file_comment"===t.type)if(t.file){r=TS.files.upsertAndSignal(t.file);t.file=r.file;if("file_comment"===t.type)if(t.comment)t.comment=TS.files.addCommentToFile(t.comment,t.file);else{TS.error("WTF no comment in type "+t.type+" in "+n);return false}}else{TS.error("WTF no file in type "+t.type+" in "+n);return false}else if("channel"===t.type);else if("group"===t.type);else if("im"===t.type);else{TS.error("need to handle star item type:"+t.type+" in "+n);return false}return true};var c=function e(t,n,r,i){var a=TS.shared.getModelObById(n);var s;if(a)s=TS.utility.msgs.findMsg(t,n);var o='.star_message[data-msg-id="'+t+'"][data-c-id="'+n+'"]';var l=$(o);if(i){var u={};var d=r?"STAR_ADD_CLICKED":"STAR_REMOVE_CLICKED";if(TS.model.unread_view_is_showing){_.merge(u,TS.client.ui.unread.getTrackingData(t));TS.client.ui.unread.incrementTrackingSeqId()}_.merge(u,TS.ui.thread.getTrackingPayloadForEl(l));if("threads_view"===TS.ui.thread.getContextForEl(l))TS.client.ui.threads.incrementTrackingSeqId();TS.clog.track(d,u)}T(l,r,s,o)};var m=function e(t,n,r){var i=TS.files.getFileById(n);var a;if(!i)TS.warn("updateFileCommentStar file_id:"+n+" not found");else a=TS.files.getFileCommentById(i,t);var s='.star_comment[data-comment-id="'+t+'"]';T($(s),r,a,s)};var f=function e(t,n){var r=TS.files.getFileById(t);if(!r)TS.warn("updateFileStar file_id:"+t+" not found");var i='.star_file[data-file-id="'+t+'"]';T($(i),n,r,i)};var p=function e(t,n){var r=TS.channels.getChannelById(t);if(!r)TS.warn("updateChannelStar channel_id:"+t+" not found");r.is_starred=n;var i='.star_channel[data-channel-id="'+t+'"]';T($(i),n,r,i);if(TS.client){TS.client.channel_pane.rebuild("channels","starred");var a=TS.shared.getModelObById(t);if(!a)return;if(n)TS.stars.channel_starred_sig.dispatch(a);else TS.stars.channel_unstarred_sig.dispatch(a)}};var h=function e(t,n){var r=TS.groups.getGroupById(t);if(!r)TS.warn("updateGroupStar group_id:"+t+" not found");r.is_starred=n;var i='.star_group[data-group-id="'+t+'"]';T($(i),n,r,i);if(TS.client)TS.client.channel_pane.rebuild("channels","starred")};var g=function e(t,n,r){var i=TS.ims.getImById(t);if(!i)TS.warn("updateImStar im_id:"+t+" not found");i.is_starred=n;var a="";if(r)a='.star_app[data-im-id="'+t+'"]';else a='.star_im[data-im-id="'+t+'"]';T($(a),n,i,a);if(TS.client)TS.client.channel_pane.rebuild("ims","starred")};var S=function e(t,n){var r=TS.mpims.getMpimById(t);if(!r)TS.warn("updateMpimStar mpim_id:"+t+" not found");r.is_starred=n;var i='.star_mpim[data-mpim-id="'+t+'"]';T($(i),n,r,i);if(TS.client)TS.client.channel_pane.rebuild("ims","starred","apps")};var T=function e(t,n,r){if(n){if(!t.hasClass("starred"))t.addClass("starred ts_icon_star").removeClass("ts_icon_star_o")}else t.removeClass("starred ts_icon_star").addClass("ts_icon_star_o");if(r)r.is_starred=n}})()},4269:function(e,t){(function(){"use strict";TS.registerModule("inline_attachments",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,shouldExpand:function e(t,n){if(TS.model.expandable_state["attach_"+t+n.from_url])return true;if(false===TS.model.expandable_state["attach_"+t+n.from_url])return false;return true},shouldShow:function e(t,n){if(t.is_share)return true;if(n&&"reply_broadcast"===n.subtype)return true;if("twitter"===t.service_name&&"bot_message"===n.subtype)return true;if(!t.from_url)return true;if(n.standalone_attachment)return true;if(n&&n.text)if(-1==n.text.indexOf(t.from_url))if(TS.model.ampersands_are_inconsistent_in_from_urls){if(-1==n.text.indexOf(t.from_url.replace(/&/g,"&amp;")))return true}else return true;if(TS.model.prefs.expand_inline_imgs){if(t.audio_html)return true;if(t.other_html)return true;if(t.video_html)return true;if(t.image_url)return true;if(t.service_name&&"twitter"===t.service_name.toString().toLowerCase())return true}return!!TS.model.prefs.expand_non_media_attachments},expandAllInCurrent:function e(){TS.inline_attachments.no_scrolling=true;$(".msg_inline_attachment_expander").trigger("click");TS.inline_attachments.no_scrolling=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_attachment_collapser").trigger("click")},expand:function e(t,n){TS.model.expandable_state["attach_"+t+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var s=function e(){return $(this).data("real-src")==n};var o=i.find(".inline_attachment").filter(s);o.removeClass("hidden");i.find(".msg_inline_attachment_expander").filter(s).addClass("hidden");i.find(".msg_inline_attachment_collapser").filter(s).removeClass("hidden");o.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_attachments.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);i.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else o.scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_attachments.expand_sig.dispatch(t)},collapse:function e(t,n){TS.model.expandable_state["attach_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=function e(){return $(this).data("real-src")==n};var s=i.find(".inline_attachment").filter(a);if(!s.length)s=i.find(".msg_inline_attachment_holder").filter(a);s.css("visibility","hidden");i.find(".msg_inline_attachment_expander").filter(a).removeClass("hidden");i.find(".msg_inline_attachment_collapser").filter(a).addClass("hidden");TS.inline_attachments.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineAttachmentClick:function e(t){if(!t.target)return;var n=$(t.target);var r;var i;var a=n.closest(".message");i=a.data("ts");r=a.attr("id");var s=n.closest(".msg_inline_attachment_expander");if(s.length){t.preventDefault();if(!r)return;TS.inline_attachments.expand(r,s.data("real-src"))}var o=n.closest(".msg_inline_attachment_collapser");if(o.length){t.preventDefault();if(!r)return;TS.inline_attachments.collapse(r,o.data("real-src"))}var l=n.closest(".rest_text_expander");if(l.length){t.preventDefault();var u=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var d=l.parent().find(".short_text");var c;var m=l.parent().find(".more_text");if(l.data("show-text")){if(m.length){m.addClass("hidden");c=l.find("a span");l.data("hide-text",c.text());c.text(l.data("show-text"));l.data("show-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_down").addClass("ts_icon_caret_right")}}else{var f=d.attr("data-all-text");if(f){d.html(f);d.data("all-text","")}if(m.length)m.removeClass("hidden");if(m.length&&l.data("hide-text")){c=l.find("a span");l.data("show-text",c.text());c.text(l.data("hide-text"));l.data("hide-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_right").addClass("ts_icon_caret_down")}else l.css("display","none")}d.css("opacity",0).transition({opacity:1},300);TS.inline_attachments.rest_texts_expanded[l.attr("id")]=true;if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(d);if(TS.client&&u){TS.client.ui.instaScrollMsgsToBottom(false);d.scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}}var p=n.closest(".delete_attachment_link");if(p.length){t.preventDefault();var h=p.data("attachment-id").toString();var g=a.attr("data-model-ob-id");var S=TS.shared.getModelObById(g);if(!S){alert("missing model_ob");return}if(!h){alert("missing attachment-id");return}var T=S.id;var v=TS.utility.msgs.getMsg(i,S.msgs);var b="";if(TS.model.user.is_admin){var y=_.find(v.attachments,{id:h});if(y&&y.from_url){var w=TS.inline_attachments.makeBlackListSelect(y.from_url);var k=TS.i18n.t("Disable future attachments from this website?","inline_attachments")();b='<p class="large_left_margin '+(w&&"no_bottom_margin")+'">';b+='<label class="checkbox normal" style="font-size: 16px;">';b+='<input id="attachment_blacklist_cb" type="checkbox" class="small_right_margin" />';b+=k;b+="</label>";if(w)b+=w;b+="</p>"}}var x=TS.i18n.t("Are you sure you wish to remove this attachment from the message?","inline_attachments")();var C='<p class="'+(b?"small_bottom_margin":"")+'">'+x+"</p>"+b;TS.generic_dialog.start({title:TS.i18n.t("Remove attachment","inline_attachments")(),body:C,go_button_text:TS.i18n.t("Yes, remove","inline_attachments")(),onShow:function e(){$("#attachment_blacklist_cb").bind("change",function(){var e=!!$("#attachment_blacklist_cb").prop("checked");TS.info(e);if(e)$("#attachment_blacklist_select").prop("disabled",false);else $("#attachment_blacklist_select").prop("disabled",true)})},onGo:function e(){if(v.is_ephemeral){v.attachments=TS.inline_attachments.removeAttachmentById(v.attachments,h);TS.utility.msgs.replaceMsg(S,v,false,true)}else{var t=!!$("#attachment_blacklist_cb").prop("checked");var n=t?$("#attachment_blacklist_select").val():"none";var r=t?$("#attachment_blacklist_select").find(":selected").data("url"):"";var a={channel:T,ts:i,attachment:h,blacklist_type:n,blacklist_url:r};TS.dir(0,a);TS.api.call("chat.deleteAttachment",a,function(e){if(e){if(TS.web){v.attachments=TS.inline_attachments.removeAttachmentById(v.attachments,h);TS.utility.msgs.replaceMsg(S,v)}}else{var t=TS.i18n.t("Attachment removing failed!","inline_attachments")();TS.generic_dialog.alert(t)}})}}})}},makeBlackListSelect:function e(t){if(!t)return"";t=_.escape(t).replace("https://","").replace("http://","");var n="";var r=t.split("/");var i=r[0];var a=r[r.length-1];var s=TS.i18n.t("All links from {host}","inline_attachments")({host:i});var o=TS.i18n.t("Just the link {url}","inline_attachments")({url:t});n+='<label class="select small full_width">\r';n+='<select id="attachment_blacklist_select" disabled="disabled" class="small" style="margin-bottom: 4px;">\r';n+='<option value="all" data-url="'+i+'">'+s+"</option>\r";n+='<option value="just" data-url="'+t+'">'+o+"</option>\r";if(a!=i){TS.info(a);var l=r.concat();l.length-=1;var u=l.join("/");if(u!=i){u+="/";var d=TS.i18n.t("All links under {host_path}","inline_attachments")({host_path:u});n+='<option value="under" data-url="'+u+'">'+d+"</option>\r"}}n+="</select>\r";n+="</label>\r";return n},rest_texts_expanded:{},shouldExpandText:function e(t){return!!TS.inline_attachments.rest_texts_expanded[t]},renderStandaloneAttachment:function e(t){TS.inline_attachments.massageAttachment(t,0);if(t.image_url&&!TS.model.inline_imgs[t.from_url]){if(!t.from_url)t.from_url=t.image_url;TS.inline_imgs.makeInternalInlineImg(t.from_url,{link_url:t.from_url,bytes:t.image_bytes,src:t.image_url,width:isNaN(t.image_width)?null:t.image_width,height:isNaN(t.image_height)?null:t.image_height,should_expand:true})}if(t.video_html&&!TS.model.inline_videos[t.from_url])TS.inline_videos.makeInternalInlineVideo(t.from_url,{src:t.thumb_url,html:t.video_html,proxied_src:t.proxied_thumb_url,title:t.title,display_h:t.video_html_height,display_w:t.video_html_width,thumbnail:{link_url:t.from_url,url:t.thumb_url,height:t.thumb_height,width:t.thumb_width}});var n=TS.interop.datetime.makeTsStamp();var r=TS.templates.builders.buildAttachmentHTML({attachment:t,msg:{enable_slack_action_links:false,text:t.from_url,ts:n,url:t.from_url,standalone_attachment:t.standalone_attachment||false},can_delete:false,maybe_show_file_viewer:false,has_content:TS.utility.attachments.hasContent(t),from_post:true,model_ob:TS.shared.getModelObById(t.channel_id)});var i=TS.templates.makeMsgDomId(n);return'<div class="message standalone-attachment" id="'+i+'" data-ts="'+n+'">'+r+"</div>"},massageAttachment:function e(t,n){t._index=n;if("id"in t)t.id=t.id.toString();var r=500;var i=3;var a="";var s=0;if(t.text){var o="";var l="";var u="";var d;var c=0;var _=false;for(var m=0;m<t.text.length;m+=1){d=t.text.charAt(m);if(l||"<"===d){l+=d;if(u||"|"===d)u+=d;if(">"===d){a+=l;s+=u.length-2;if(s>r)_=true;l="";u=""}}else{if("\n"===d)c+=1;if(c>i+1){o=t.text.replace(a,"");break}a+=d;s+=1;if(s>r)_=true;if(_&&" "===d){o=t.text.replace(a,"");break}}}t._short_text=a==t.text?"":a;var f=a.match(/```/g);var p=o.match(/```/g);if(f&&p)t._short_text+="```"}t._floated_thumb_display_height=75;t._floated_thumb_display_width=75;if(t.thumb_height&&t.thumb_width)if(t.thumb_height>t.thumb_width)t._floated_thumb_display_width=parseInt(t.thumb_width*(t._floated_thumb_display_height/t.thumb_height),10);else t._floated_thumb_display_height=parseInt(t.thumb_height*(t._floated_thumb_display_width/t.thumb_width),10);var h=TS.utility.getImgProxyURL(t.thumb_url,t._floated_thumb_display_width,t._floated_thumb_display_height);if(h!=t.thumb_url)t.proxied_thumb_url=h;else delete t.proxied_thumb_url},getAttachmentByFromUrl:function e(t,n){if(!t)return null;for(var r=0;r<t.length;r+=1){if(!t[r]){TS.info(n);TS.dir(0,t);continue}if(!t[r].from_url)continue;if(t[r].from_url==n)return t[r];if(TS.model.ampersands_are_inconsistent_in_from_urls)if(t[r].from_url.replace(/&/g,"&amp;")==n)return t[r]}return null},getAttachmentBySlackFileId:function e(t,n){if(!t)return null;if(!n)return null;for(var r=0;r<t.length;r+=1){if(!t[r])continue;if(t[r].slack_file_id==n)return t[r]}return null},removeAttachmentById:function e(t,n){if(!t)return null;var r=[];for(var i=0;i<t.length;i+=1)if(t[i].id!=n)r.push(t[i]);return r}})})()},4270:function(e,t){(function(){"use strict";TS.registerModule("inline_others",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){},shouldExpand:function e(t,n){if(TS.model.expandable_state["vid_"+t+n.src])return true;if(false===TS.model.expandable_state["vid_"+t+n.src])return false;if(n.internal_file_id)return TS.model.prefs.expand_internal_inline_imgs;return TS.model.prefs.expand_inline_imgs},expandAllInCurrent:function e(){var t=$(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)");if(!t.length)return;TS.inline_others.no_scrolling=true;t.trigger("click");TS.inline_others.no_scrolling=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_media_toggler[data-media-type=other].expanded").trigger("click")},expand:function e(t,n){TS.model.expandable_state["vid_"+t+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var s=function e(){return $(this).data("real-src")==n};var o=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(s):null;if(!o||!o.length)o=i.find(".msg_inline_other_holder").filter(s);o.removeClass("hidden");i.find(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)").filter(s).addClass("expanded");if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere();o.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_others.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);i.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else i.find(".msg_inline_other").last().scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_others.expand_sig.dispatch(t);if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere()},collapse:function e(t,n){TS.model.expandable_state["vid_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=function e(){return $(this).data("real-src")==n};var s=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(a):null;if(!s||!s.length)s=i.find(".msg_inline_other_holder").filter(a);s.css("visibility","hidden");i.find(".msg_inline_media_toggler[data-media-type=other].expanded").filter(a).removeClass("expanded");s.find(".msg_inline_other_iframe_div").html("");TS.inline_others.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineOtherClick:function e(t){if(!t.target)return;var n=$(t.target);var r;var i=n.closest(".message");r=i.attr("id");if(!r)return;var a=n.closest(".msg_inline_media_toggler[data-media-type=other]");if(a.length){t.preventDefault();var s=a.data("real-src");if(a.hasClass("expanded"))TS.inline_others.collapse(r,s);else TS.inline_others.expand(r,s)}},makeInternalInlineOther:function t(n){var r=400;var i=500;if(n.other_html_width>r){n.other_html_height=parseInt(n.other_html_height*(r/n.other_html_width),10);n.other_html_width=r}if(n.other_html_height>i){n.other_html_width=parseInt(n.other_html_width*(i/n.other_html_height),10);n.other_html_height=i}var a;if(n.google_map_config)a=TS.utility.parseJSONOrElse(n.google_map_config,void 0);if(a&&a.center&&"string"!==typeof a.center.lat){a.scrollwheel=false;var s="googmap_"+(e+=1);n.other_html='<div class="google-maps" id="'+s+'" style="width:100%; min-width:'+_.escape(n.other_html_width)+"px; height:"+_.escape(n.other_html_height)+'px;"></div>\t\t\t<script>TS.inline_others.runGoogleMapCode("'+s+"\", '"+JSON.stringify(a)+"')<\/script>";n.safe_other_html=n.other_html}else{if(-1==n.other_html.indexOf("oldwidth")){n.other_html=n.other_html.replace(" width=",' width="'+n.other_html_width+'" oldwidth=');n.other_html=n.other_html.replace(" height=",' height="'+n.other_html_height+'" oldheight=')}n.safe_other_html=n.other_html;n.safe_other_html=TS.utility.swapInRedirUrlForIframe(n.safe_other_html);n.safe_audio_html=TS.utility.setCssFromHeightAndWidthAttrs(n.safe_audio_html)}TS.model.inline_others[n.other_html]={src:_.escape(n.other_html),attachment:n}},runGoogleMapCode:function e(t,n){if(!window.google)return;if(!n)return;var r=JSON.parse(n);var i=new google.maps.Map(document.getElementById(t),r);if(!r.query)return;var a=new google.maps.Geocoder;var s="number"===typeof r.max_results?r.max_results:10;if(s<0)s=Number.MAX_VALUE;var o=function e(){google.maps.event.clearListeners(i,"bounds_changed");var t=i.getBounds();var n=0;var o=function e(t){new google.maps.Marker({map:i,position:t.geometry.location});n+=1};var l=function e(a,l){var u=false;if(l==google.maps.GeocoderStatus.OK)a.slice(0,s).forEach(function(e){o(e);u=u||!e.partial_match});else TS.warn("Geocoder failed due to: "+l);if(!u&&n<s){var d=new google.maps.places.PlacesService(i);var c=function e(t,r){if(r==google.maps.places.PlacesServiceStatus.OK)t.slice(0,s-n).map(o);else TS.warn("PlacesService failed due to: "+r)};d.nearbySearch({bounds:t,name:r.query},c)}};a.geocode({address:r.query,bounds:t},l)};google.maps.event.addListener(i,"bounds_changed",o)}});var e=0})()},4271:function(e,t){(function(){"use strict";TS.registerModule("msg_edit",{editing:false,editing_in_msg_pane:false,editing_in_convo_pane:false,deleting_from_editing:false,current_msg:null,current_model_ob:null,mousedown_active:false,edit_interv:0,onStart:function e(){},onCountDownInterval:function e(){if(!TS.msg_edit.current_msg)return;if(-1==TS.model.team.prefs.msg_edit_window_mins||_.get(TS.msg_edit.current_model_ob,"is_self_im")){$("#edit_countdown").empty();return}var t=TS.interop.datetime.toDateObject(TS.msg_edit.current_msg.ts).getTime()+60*TS.model.team.prefs.msg_edit_window_mins*1e3;var n=Math.floor((t-Date.now())/1e3);if(n<1)$("#edit_countdown").html(TS.i18n.t("(your time to edit ran out)","msg_edit")()+"&nbsp&nbsp&nbsp&nbsp");else if(n<61)$("#edit_countdown").html(TS.i18n.t("(you have <strong>{seconds_count, number}</strong> seconds)","msg_edit")({seconds_count:n})+"&nbsp&nbsp&nbsp&nbsp");else $("#edit_countdown").empty()},cancelEditingINothingHasChanged:function e(){if(!TS.msg_edit.editing)return true;var t=TS.format.unFormatMsg(TS.msg_edit.current_msg.text);var n=TS.utility.contenteditable.value($("#message_edit_form").find("#msg_text"));if(n===t){TS.msg_edit.onCancelEdit();return true}return false},editExpiration:function e(n){if(n>0){var r=t(n);if(TS.model.user.is_admin){if(TS.boot_data.feature_teams_to_workspaces)return'<p class="no_bottom_margin">'+TS.i18n.t('In this workspace, you can’t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")({msg_edit_duration_text:r})+"</p>";return'<p class="no_bottom_margin">'+TS.i18n.t('On this team, you can’t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Team&nbsp;Settings</a>.',"msg_edit")({msg_edit_duration_text:r})+"</p>"}if(TS.boot_data.feature_teams_to_workspaces)return'<p class="no_bottom_margin">'+TS.i18n.t("In this workspace, you can’t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")({msg_edit_duration_text:r})+"</p>";return'<p class="no_bottom_margin">'+TS.i18n.t("On this team, you can’t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in Team&nbsp;Settings.","msg_edit")({msg_edit_duration_text:r})+"</p>"}if(TS.model.user.is_admin){if(TS.boot_data.feature_teams_to_workspaces)return'<p class="no_bottom_margin">'+TS.i18n.t('In this workspace, you can’t edit messages after the fact. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")()+"</p>";return'<p class="no_bottom_margin">'+TS.i18n.t('On this team, you can’t edit messages after the fact. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Team&nbsp;Settings</a>.',"msg_edit")()+"</p>"}if(TS.boot_data.feature_teams_to_workspaces)return'<p class="no_bottom_margin">'+TS.i18n.t("In this workspace, you can’t edit messages after the fact. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")()+"</p>";return'<p class="no_bottom_margin">'+TS.i18n.t("On this team, you can’t edit messages after the fact. Admins can adjust this in Team&nbsp;Settings.","msg_edit")()+"</p>"},startEdit:function t(n,r,i,a){if($("#message_edit_form").length&&!TS.msg_edit.cancelEditingINothingHasChanged()){TS.msg_edit.promptEdit();return}if(!n){TS.error("no msg_ts?");return null}if(!r){TS.error("no model_ob?");return null}if(!r.msgs){TS.error("no model_ob.msgs?");return null}if(!a)a=TS.utility.msgs.getMsg(n,e(r));if(!a)a=TS.ui.replies.getActiveMessage(r,n);if(TS.model.threads_view_is_showing&&!a)a=TS.client.threads.getMessage(r,n);if(!a){TS.error("no msg in msgs?");return null}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.entities.messagesMeta.toggleEditingMessage({ts:n,isEditing:true}));return}var s=TS.format.unFormatMsg(a.text);var o=i&&i.force_reopen;if(!o){var l=Date.now();var u=TS.interop.datetime.toDateObject(a.ts);var d=l-u;var c=d/6e4;if(TS.model.team.prefs.msg_edit_window_mins>=0&&c>TS.model.team.prefs.msg_edit_window_mins&&!r.is_self_im){TS.warn("Editing unavailable on channel "+r.id+", msg with ts = "+a.ts+". now = "+l+", elapsed (minutes) = "+c+", msg_edit_window_mins = "+TS.model.team.prefs.msg_edit_window_mins);var m=TS.model.team.prefs.msg_edit_window_mins>0?TS.i18n.t("This message can’t be edited","msg_edit")():TS.i18n.t("Messages can’t be edited","msg_edit")();TS.generic_dialog.alert(TS.msg_edit.editExpiration(TS.model.team.prefs.msg_edit_window_mins),m,TS.i18n.t("Got It","msg_edit")());return}}var f=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var p;if("convo"===i){TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=true;p=TS.msg_edit.getDivForMsgInConvoPane(a.ts)}else{TS.msg_edit.editing_in_msg_pane=true;TS.msg_edit.editing_in_convo_pane=false;p=TS.msg_edit.getDivForMsgInMsgPane(a.ts)}if(!p.length){TS.error("no msg div for edit");return null}TS.msg_edit.current_msg=a;TS.msg_edit.current_model_ob=r;p.addClass("hidden");var h=s;if(i&&i.text)h=i.text;var g=TS.templates.message_edit_form({msg:a,edit_text:h,permalink:TS.utility.msgs.constructMsgPermalink(r,a.ts,a.thread_ts),include_emo:!!TS.client,relative_ts:TS.utility.msgs.isMsgReply(a)});p.after(g);var S=$("#message_edit_form");var T=S;var v=S.find("#msg_text");if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()){TS.utility.contenteditable.create(v,{modules:{tabcomplete:{positionMenu:function e(t){t.style.width=v.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,v)}}},onEnter:function e(){TS.msg_edit.checkAndSubmit(v,S);return false},onEscape:function e(){if(!TS.model.menu_is_showing&&!TS.model.dialog_is_showing)setTimeout(TS.msg_edit.onCancelEdit,0)},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(v)}});TS.utility.contenteditable.enable(v);v.on("keyup",function(){var e=TS.utility.contenteditable.cursorPosition(v);if(!e.length){var t=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);if(!TS.client||S.outerHeight()<t.height)T.find(".edit_controls").scrollintoview({px_offset:-50})}});TS.utility.contenteditable.value(v,h)}TS.msg_edit.checkLengthAndUpdateMessage(v);TS.info("message_edit_form added");TS.msg_edit.editing=true;S.bind("destroyed",function(){TS.utility.contenteditable.unload($("#message_edit_form #msg_text"));TS.info("message_edit_form removed");TS.msg_edit.editing=false;TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=false;if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())TSSSB.call("inputFieldRemoved",v.get(0));S=null;v=null;TS.msg_edit.resetEditUI()});if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())v.TS_tabComplete({complete_cmds:false,complete_channels:true,complete_user_groups:true,complete_emoji:true,complete_member_specials:true,no_tab_out:true,onComplete:function e(t,n){TS.utility.populateInput(v,t,n)},sort_by_membership:true,include_self:!!TS.boot_data.feature_name_tagging_client,model_ob:r});var b={id:"msg_edit_tab_ui",scroll_with_element:!!TS.client,model_ob:r};var y=v.closest("#col_flex").length>0;if(y){b.min_width=300;b.narrow=!!TS.client}v.tab_complete_ui(b);if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())TSSSB.call("inputFieldCreated",v.get(0));S.bind("submit",function(e){e.preventDefault();var t=TS.utility.contenteditable.value(v);if(t===s){TS.msg_edit.onCancelEdit();return}if(!t){var i=TS.utility.msgs.getMsgActions(a,r);var o=TS.boot_data.feature_new_broadcast&&p.attr("id")===TS.templates.makeMsgDomIdInConversation(n)||p.attr("id")===TS.templates.makeMsgDomIdInThreadsView(n);if(TS.boot_data.feature_new_broadcast&&i.remove_broadcast&&!o)TS.msg_edit.startRemoveBroadcast(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,true);else if(i.delete_msg)TS.msg_edit.startDelete(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelEdit,true);else TS.msg_edit.onConfirmEdit("~"+a.text.replace(/~/g,"")+"~");return}var l=TS.ui.needToBlockAtChannelKeyword(t,null,TS.msg_edit.current_model_ob.id);if(l){if(TS.boot_data.feature_teams_to_workspaces)TS.generic_dialog.alert("<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <strong>{blocked_keyword}</strong> messages.","msg_edit")({blocked_keyword:_.escape(l)})+"</p>");else TS.generic_dialog.alert("<p>"+TS.i18n.t("A Team Owner has restricted the use of <strong>{blocked_keyword}</strong> messages.","msg_edit")({blocked_keyword:_.escape(l)})+"</p>");return}if(!$.trim(t))return;TS.msg_edit.onConfirmEdit(t)});if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty()){v.bind("textchange",function(){TS.msg_edit.checkLengthAndUpdateMessage(v)}).bind("keyup",function(){var e;var t=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);if(window.getSelection){e=window.getSelection();if(e&&e.toString&&!e.toString())if(!TS.client||S.outerHeight()<t.height)T.find(".edit_controls").scrollintoview({px_offset:-50})}}).bind("keydown",function(e){if(e.which==TS.utility.keymap.enter&&(e.ctrlKey||e.altKey)){if(!TS.model.is_mac||TS.model.is_FF||TS.model.is_electron||TS.model.is_chrome_desktop){var t=v.getCursorPosition();var n=v.val();v.val(n.substr(0,t)+"\n"+n.substr(t));v.trigger("autosize").trigger("autosize-resize");v.setCursorPosition(t+1)}}else if(e.which==TS.utility.keymap.enter)if(!(TS.model.prefs.enter_is_special_in_tbt&&TS.utility.isCursorWithinTBTs(v)&&!e.shiftKey))if(TS.model.prefs.enter_is_special_in_tbt&&TS.utility.isCursorWithinTBTs(v)&&e.shiftKey){e.preventDefault();TS.msg_edit.checkAndSubmit(v,S)}else if(v.tab_complete_ui("isShowing"))e.preventDefault();else if(!e.shiftKey&&!e.altKey){e.preventDefault();TS.msg_edit.checkAndSubmit(v,S)}}).autosize({boxOffset:18});$("body").bind("keydown.close_message_edit_form",function(e){if(e.which==TS.utility.keymap.esc){if(v.tab_complete_ui("isShowing")||v.tab_complete_ui("wasJustHidden"))return;if(!TS.model.menu_is_showing&&!TS.model.dialog_is_showing)setTimeout(TS.msg_edit.onCancelEdit,0)}})}S.find("#commit_edit").bind("click",function(){TS.msg_edit.checkAndSubmit(v,S)});S.find("#cancel_edit").bind("click",function(){TS.msg_edit.onCancelEdit()});S.bind("mousedown",function(){TS.msg_edit.mousedown_active=true});S.bind("mouseup",function(){TS.msg_edit.mousedown_active=false});var w=S.find(".emo_menu");w.removeClass("hidden");w.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:"#msg_text"})});if(TS.client&&f)TS.client.ui.instaScrollMsgsToBottom(false);var k=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);if(!TS.client||S.outerHeight()<k.height)T.find(".edit_controls").scrollintoview({duration:500,px_offset:-50,complete:function e(){TS.msg_edit.focusAndSetCursorPosition(v,i)}});else{TS.msg_edit.focusAndSetCursorPosition(v,i);T.find(".edit_controls").scrollintoview({duration:500,px_offset:-50})}if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty())$("#message_edit_form [contenteditable=true]").attr("spellcheck",!!TS.model.prefs.webapp_spellcheck);else $("#msg_text").attr("spellcheck",!!TS.model.prefs.webapp_spellcheck);TS.msg_edit.onCountDownInterval();TS.msg_edit.edit_interv=setInterval(TS.msg_edit.onCountDownInterval,1e3)},isMessageTooLong:function e(t){var n=TS.format.cleanMsg(TS.utility.contenteditable.value(t));if(TS.features.isEnabled("message_input_byte_limit"))return TS.utility.msgs.charsOverLimit(n);return n.length>TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH},updateTooLongWarning:function e(t,n){var r=$(t).parent().find(".edit_warning");if(n){r.removeClass("hidden");if(TS.features.isEnabled("message_input_byte_limit"))r.text(TS.i18n.t("Your message is {diff_count, plural, =1{# character}other{# characters}} too long.","msg_input")({diff_count:n}))}else $(t).parent().find(".edit_warning").addClass("hidden")},checkLengthAndUpdateMessage:function e(t){var n=TS.msg_edit.isMessageTooLong(t);TS.msg_edit.updateTooLongWarning(t,n);return!n},checkAndSubmit:function e(t,n){if(TS.msg_edit.checkLengthAndUpdateMessage(t))n.submit()},onConfirmEdit:function e(t){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}if(!t){TS.error("no edited_text?");return null}var n=TS.msg_edit.editing_in_convo_pane;TS.msg_edit.commitEditInternal(t);TS.msg_edit.resetEditUI();if(TS.client)if(n){var r=true;TS.ui.replies.focusReplyInput(r)}else TS.view.focusMessageInput()},onCancelEdit:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.editing_in_convo_pane;TS.msg_edit.resetEditUI();if(TS.client)if(t){var n=true;TS.ui.replies.focusReplyInput(n)}else TS.view.focusMessageInput()},resetEditUI:function e(){clearInterval(TS.msg_edit.edit_interv);if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}TS.msg_edit.getDivBeingEdited().removeClass("hidden");$("#message_edit_container").remove();if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())$("body").unbind("keydown.close_message_edit_form")},getDivBeingEdited:function e(){if(TS.msg_edit.editing_in_msg_pane)return TS.msg_edit.getDivForMsgInMsgPane(TS.msg_edit.current_msg.ts);if(TS.msg_edit.editing_in_convo_pane)return TS.msg_edit.getDivForMsgInConvoPane(TS.msg_edit.current_msg.ts);return $()},getDivForMsgInMsgPane:function e(t){var n=TS.model.unread_view_is_showing;var r=TS.model.threads_view_is_showing;if(n)return $("#"+TS.templates.makeMsgDomIdInUnreadView(t));else if(r)return $("#"+TS.templates.makeMsgDomIdInThreadsView(t));return $("#"+TS.templates.makeMsgDomId(t))},getDivForMsgInConvoPane:function e(t){return $("#"+TS.templates.makeMsgDomIdInConversation(t))},getAllDivsForMsg:function e(t){var n=TS.msg_edit.getDivForMsgInMsgPane(t);return n.add(TS.msg_edit.getDivForMsgInConvoPane(t))},commitEditInternal:function e(t){TS.msg_edit.commitEdit(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,t)},commitEdit:function e(n,r,i,a,s){if(!n){TS.error("no msg?");return null}if(!r){TS.error("no model_ob?");return null}if(!a)a=0;if(!s)s=100;TS.api.call("chat.update",{channel:r.id,ts:n.ts,text:TS.format.cleanMsg(i),_attempts:a,_delay_ms:s},function(e,a,s){if(e){if(TS.web||r.is_channel&&!r.is_member){var o=_.extend({},n,{text:a.text,edited:{ts:TS.interop.datetime.makeTsStamp(null,{padder:"0"})}});TS.utility.msgs.replaceMsg(r,o)}}else{if(!a||!a.error)TS.generic_dialog.alert(TS.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.i18n.t("Message editing failed","msg_edit")());else if("message_not_found"===a.error){if(s._attempts<10){s._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitEdit(n,r,i,s._attempts,s._delay_ms)},s._delay_ms);return}if(r.is_channel)TS.channels.removeMsg(r.id,n);else if(r.is_im)TS.ims.removeMsg(r.id,n);else if(r.is_mpim)TS.mpims.removeMsg(r.id,n);else if(r.is_group)TS.groups.removeMsg(r.id,n);TS.generic_dialog.alert(TS.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.i18n.t("Message editing failed","msg_edit")())}else if("edit_window_closed"===a.error){var l="<p>"+TS.i18n.t("Sorry, but messages can only be edited for <strong>{msg_edit_duration_text}</strong> after posting.","msg_edit")({msg_edit_duration_text:t(TS.model.team.prefs.msg_edit_window_mins)})+"</p>";if(TS.model.user.is_admin)if(TS.boot_data.feature_teams_to_workspaces)l+="<p>"+TS.i18n.t('(To adjust the message editing window, visit <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.)',"msg_edit")()+"</p>";else l+="<p>"+TS.i18n.t('(To adjust the message editing window, visit <a href="/admin/settings#message_editing" target="_new">Team&nbsp;Settings</a>.)',"msg_edit")()+"</p>";TS.generic_dialog.alert(l,TS.i18n.t("Message editing failed","msg_edit")())}else if("msg_too_long"===a.error)TS.generic_dialog.alert(TS.i18n.t("Sorry, your message is too long. Please shorten it and try again.","msg_edit")(),TS.i18n.t("Message editing failed","msg_edit")());else TS.generic_dialog.alert(TS.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.i18n.t("Message editing failed","msg_edit")());TS.msg_edit.startEdit(n.ts,r,{text:i,force_reopen:true})}})},promptEdit:function e(){if("none"!==$("#message_editing_info").css("display")){$("#message_edit_container").scrollintoview({duration:300,px_offset:0});return}$("#message_editing_info").css("display","");$("#message_editing_info").css("opacity",0);$("#message_edit_container").scrollintoview({duration:300,px_offset:0,complete:function e(){$("#message_editing_info").transition({opacity:1},250)}})},startDelete:function t(n,r,i,a){if(!n){TS.error("no msg_ts?");return null}if(!r){TS.error("no model_ob?");return null}if(!r.msgs){TS.error("no model_ob.msgs?");return null}var s;if(TS.useReactMessages())s=TS.redux.messages.getMessageByTimestamp(r.id,n);if(!s)s=TS.utility.msgs.getMsg(n,e(r));if(!s)s=TS.ui.replies.getActiveMessage(r,n);if(TS.model.threads_view_is_showing&&!s)s=TS.client.threads.getMessage(r,n);if(!s){TS.error("no msg in msgs?");return null}TS.msg_edit.deleting_from_editing=!!a;TS.msg_edit.current_msg=s;TS.msg_edit.current_model_ob=r;var o=TS.msg_edit.getAllDivsForMsg(s.ts);var l='<p class="bottom_margin">'+TS.i18n.t("Are you sure you want to delete this message? This cannot be undone.","msg_edit")()+"</p>";if(s.subtype){var u;if(s.file){u="file";if("snippet"===s.file.mode)u="snippet";else if("post"===s.file.mode)u="post"}var d="";if("file_upload"===s.subtype){if("file"===u)d=TS.i18n.t("Note that deleting this message will not delete the file that was uploaded.","msg_edit")();else if("snippet"===u)d=TS.i18n.t("Note that deleting this message will not delete the snippet that was uploaded.","msg_edit")();else if("post"===u)d=TS.i18n.t("Note that deleting this message will not delete the post that was uploaded.","msg_edit")()}else if("file_share"===s.subtype){if("file"===u)d=TS.i18n.t("Note that deleting this message will not unshare the file.","msg_edit")();else if("snippet"===u)d=TS.i18n.t("Note that deleting this message will not unshare the snippet.","msg_edit")();else if("post"===u)d=TS.i18n.t("Note that deleting this message will not unshare the post.","msg_edit")()}else if("file_comment"===s.subtype)d=TS.i18n.t("Note that deleting this message will not delete the comment.","msg_edit")();if(d)l+="<p>"+d+"</p>"}o.addClass("delete_mode");TS.generic_dialog.start({title:TS.i18n.t("Delete message","msg_edit")(),body:l+TS.templates.builders.msgs.buildHTML({msg:s,model_ob:r,standalone:true}),go_button_text:TS.i18n.t("Delete","msg_edit")(),go_button_class:"btn_danger",onGo:function e(){if(TS.msg_edit.deleting_from_editing)TS.msg_edit.onCancelEdit();TS.msg_edit.commitDeleteInternal(i)},onCancel:function e(){TS.msg_edit.onCancelDelete()}});TS.generic_dialog.div.find("img.msg_inline_img.hidden").each(function(e,t){var n=$(t);n.prop("src",n.data("real-src"));n.removeClass("hidden")})},onCancelDelete:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.getAllDivsForMsg(TS.msg_edit.current_msg.ts);t.removeClass("delete_mode");if(TS.msg_edit.deleting_from_editing)TS.utility.contenteditable.focus($("#msg_text"))},commitDeleteInternal:function e(t){TS.msg_edit.commitDelete(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelDelete,t)},commitDelete:function t(n,r,i,a,s,o,l){if(!n){TS.error("no msg?");return null}if(!r){TS.error("no model_ob?");return null}var u=r.id;if(!o)o=0;if(!l)l=100;if(n.is_ephemeral||TS.utility.msgs.isTempMsg(n)){if(r.is_channel)TS.channels.removeMsg(r.id,n);else if(r.is_im)TS.ims.removeMsg(r.id,n);else if(r.is_mpim)TS.mpims.removeMsg(r.id,n);else if(r.is_group)TS.groups.removeMsg(r.id,n)}else{if(n._jl_rollup_hash&&n._jl_rollup_hash.msg_ids){var d=n._jl_rollup_hash.msg_ids;d.forEach(function(t){if(t==n.ts)return;TS.api.call("chat.delete",{channel:u,ts:t,_attempts:o,_delay_ms:l},function(t,o,l){if(t||"message_not_found"===o.error){if("message_not_found"===o.error)if(l._attempts<10){l._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(n,r,i,a,s,l._attempts,l._delay_ms)},l._delay_ms);return}if(TS.web||r.is_channel&&!r.is_member)if(r.is_channel)TS.channels.removeMsg(r.id,TS.utility.msgs.getMsg(l.ts,e(r)));else if(r.is_im)TS.ims.removeMsg(r.id,TS.utility.msgs.getMsg(l.ts,e(r)));else if(r.is_mpim)TS.mpims.removeMsg(r.id,TS.utility.msgs.getMsg(l.ts,e(r)));else if(r.is_group)TS.groups.removeMsg(r.id,TS.utility.msgs.getMsg(l.ts,e(r)))}})})}TS.api.call("chat.delete",{channel:u,ts:n.ts,_attempts:o,_delay_ms:l},function(e,t,o){if(e||"message_not_found"===t.error){if("message_not_found"===t.error)if(o._attempts<10){o._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(n,r,i,a,s,o._attempts,o._delay_ms)},o._delay_ms);return}if(TS.web||r.is_channel&&!r.is_member)if(r.is_channel)TS.channels.removeMsg(r.id,n);else if(r.is_im)TS.ims.removeMsg(r.id,n);else if(r.is_mpim)TS.mpims.removeMsg(r.id,n);else if(r.is_group)TS.groups.removeMsg(r.id,n);if(a)a()}else{if(i)i();if(!s){var l;if(t&&t.error)l=TS.i18n.t("The message was not deleted. The error was: {error}","msg_edit")({error:t.error});else l=TS.i18n.t("The message was not deleted. The error was: unknown","msg_edit")();TS.generic_dialog.start({title:TS.i18n.t("Delete Message Failed","msg_edit")(),body:l,show_cancel_button:false,esc_for_ok:true})}}if(TS.web){var u=!TS.utility.msgs.getDisplayedMsgs(r.msgs).length;if(u){var d=$(".pager .previous a");if(d.attr("href"))window.location=d.attr("href");else TS.reload(false,"TS.msg_edit.commitEdit")}}})}},$last_clicked_cb:null,startBatchDelete:function e(){$("#msgs_div").addClass("selecting_messages");$("#channel_actions_div").addClass("hidden");$("#batch_delete_div").removeClass("hidden");TS.msg_edit.batchDeleteSelectionChanged()},cancelBatchDelete:function e(){TS.msg_edit.selectNoneBatchDelete();$("#msgs_div").removeClass("selecting_messages");$("#channel_actions_div").removeClass("hidden");$("#batch_delete_div").addClass("hidden")},doBatchDelete:function t(){var n=$("#msgs_div").find(".msg_select_cb:checked");var r=TS.shared.getActiveModelOb();if(n.length){var i=n.length;if(1==i){TS.msg_edit.startDelete(n.eq(0).closest(".message").data("ts"),r,TS.msg_edit.cancelBatchDelete);return}var a='<p class="small_bottom_margin">'+TS.i18n.t("Are you sure you want to delete {count, plural, =1 {this message} other {these messages}}? This cannot be undone! Note that deleting these messages will not delete any files or file comments.","msg_edit")({count:i})+"</p>";var s;var o;for(var l=0;l<i;l+=1){if(o&&!o.no_display)s=o;var u=n.eq(l).closest(".message").data("ts");o=TS.utility.msgs.getMsg(u,e(r));if(!o)continue;a+=TS.templates.builders.msgs.buildHTML({msg:o,prev_msg:s,model_ob:r,standalone:true})}var d=function e(t){function n(e){TS.msg_edit.commitDelete(e,r,i,i,true)}function i(){if(t.length)setTimeout(function(){n(t.pop())},100);else{TS.generic_dialog.cancel();TS.generic_dialog.start({title:"",body:TS.i18n.t("Messages deleted.","msg_edit")(),show_cancel_button:false,esc_for_ok:true})}}TS.generic_dialog.start({title:"",body:"<p>"+TS.i18n.t("Deleting messages...","msg_edit")()+"</p>",show_cancel_button:false,show_go_button:false});i()};TS.generic_dialog.start({title:TS.i18n.t("Delete Messages","msg_edit")(),body:a,go_button_text:TS.i18n.t("Yes, delete these messages","msg_edit")(),go_button_class:"btn_danger",onGo:function t(){var a=[];for(var s=0;s<i;s+=1){var o=n.eq(s).closest(".message").data("ts");if(!o){alert("no msg_ts");return}var l=TS.utility.msgs.getMsg(o,e(r));if(!l){alert("no msg");return}a.push(l)}TS.msg_edit.cancelBatchDelete();d(a)}})}},batchDeleteSelectionChanged:function e(t,n){var r=TS.msg_edit.$last_clicked_cb;if(r&&t&&n){var i=$("#msgs_div").find(".msg_select_cb:visible");var a=i.index(r);var s=i.index(t);if(a>s){s=a;a=i.index(t)}var o="checked"===r.prop("checked");for(var l=a;l<=s;l+=1)i.eq(l).prop("checked",o)}r=t;TS.msg_edit.$last_clicked_cb=r;var u=TS.i18n.t("0 messages","msg_edit")();var d=$("#msgs_div").find(".msg_select_cb:checked");$("#msgs_div").find(".multi_delete_mode").removeClass("multi_delete_mode");if(d.length){u=TS.i18n.t("{count, plural, =1 {# message} other {# messages}}","msg_edit")({count:d.length});$("#batch_delete_button").removeClass("disabled");d.each(function(){$(this).closest(".message").addClass("multi_delete_mode")})}else $("#batch_delete_button").addClass("disabled");$("#batch_delete_count_span").html(u)},selectAllBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",true);TS.msg_edit.batchDeleteSelectionChanged()},selectNoneBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",false);TS.msg_edit.batchDeleteSelectionChanged()},startRemoveBroadcast:function e(t,n,r){var i=TS.utility.msgs.findMsg(t,n.id);if(!i){TS.error("Cannot find "+t+" for startRemoveBroadcast");return}TS.msg_edit.deleting_from_editing=!!r;TS.msg_edit.current_msg=i;TS.msg_edit.current_model_ob=n;var a=TS.msg_edit.getDivForMsgInMsgPane(t);var s=n.is_channel||n.is_group&&!n.is_mpim;var o=TS.templates.builders.msgs.buildHTML({msg:i,model_ob:n,standalone:true});var l=TS.templates.thread_confirm_remove_broadcast({is_channel_or_group:s,msg_html:new Handlebars.SafeString(o)});a.addClass("delete_mode");var u;if(s)u=TS.i18n.t("Remove from channel","msg_edit")();else u=TS.i18n.t("Remove from conversation","msg_edit")();TS.generic_dialog.start({title:u,body:l,go_button_text:TS.i18n.t("Remove message","msg_edit")(),onGo:function e(){if(TS.msg_edit.deleting_from_editing)TS.msg_edit.onCancelEdit();TS.api.call("chat.delete",{channel:n.id,ts:i.ts,broadcast_delete:true}).then(function(){if(TS.web)if(n.is_channel)TS.channels.removeMsg(n.id,i);else if(n.is_im)TS.ims.removeMsg(n.id,i);else if(n.is_mpim)TS.mpims.removeMsg(n.id,i);else if(n.is_group)TS.groups.removeMsg(n.id,i)}).catch(function(e){TS.error("Failed to remove broadcast "+i.ts);TS.error(e);if(TS.msg_edit.current_msg===i)TS.msg_edit.onCancelDelete()})},onCancel:function e(){TS.msg_edit.onCancelDelete()}})},pauseEditing:function e(){if(!TS.msg_edit.editing)return;var t=$("#msg_text");var n=TS.utility.contenteditable.value(t);var r=TS.utility.contenteditable.cursorPosition(t);var i={msg_ts:TS.msg_edit.current_msg.ts,model_ob:TS.msg_edit.current_model_ob,text:n,cursor_start:r.start,cursor_length:r.length};TS.msg_edit.resetEditUI();return i},resumeEditing:function e(t){if(TS.msg_edit.editing)return;if(!t)return;if(TS.model.active_cid!==t.model_ob.id)return;TS.msg_edit.startEdit(t.msg_ts,t.model_ob,t)},focusAndSetCursorPosition:function e(t,n){TS.utility.contenteditable.focus(t);TS.utility.rAF(function(){if(n&&_.isFinite(n.cursor_start)&&_.isFinite(n.cursor_length))TS.utility.contenteditable.cursorPosition(t,n.cursor_start,n.cursor_length);else TS.utility.contenteditable.cursorPosition(t,1e8,0)})}});var e=function e(t){return TS.model.archive_view_is_showing&&t._archive_msgs?t._archive_msgs:t.msgs};var t=function e(t){return TS.interop.datetime.toTimeDuration(t,{units:"minutes"})}})()},4272:function(e,t){(function(){"use strict";TS.registerModule("ui.fs_modal",{is_showing:false,transition_duration:250,start:function s(o){if(TS.ui.fs_modal.is_showing){S(o);return}l=_.defaults({},o,u);TS.ui.fs_modal.is_showing=true;TS.tips.hideAll();d();if(l.modal_class)e.addClass(l.modal_class);if(l.modal_bg_class)t.addClass(l.modal_bg_class);if(l.modal_contents_container_class)e.find(".contents_container").addClass(l.modal_contents_container_class);r=e.find(".contents");i=e.find("#fs_modal_sidebar");a=e.find("#fs_modal_header");var h;if(l.body_template_html){h=l.body_template_html;if(l.body)TS.warn("Both body and body_template_html were passed in settings to TS.ui.fs_modal.start(). Using body_template.")}else h=TS.templates.fs_modal_generic_contents({settings:l,fs_modal_header:_.includes(l.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(l.modal_class,"fs_modal_footer")});r.html(h);if(l.header_html)a.replaceWith(l.header_html);if(l.sidebar_html)i.html(l.sidebar_html);if(l.modal_gallery)v();e.on("click",".dialog_go",c);e.on("click",".dialog_secondary_go",m);e.on("click",".dialog_cancel",p);$(window.document).off(".fs_modal");$(window.document).on("keydown.fs_modal",f);n.on("click",function(){if(l.esc_for_ok)c();else p()});$("html").addClass("fs_modal_active");setTimeout(function(){if(t)t.addClass("active");if(e)e.addClass("active")},0);if(e.find("input").length)e.find("input").first().focus();else if(document.activeElement&&document.activeElement!==document.body)document.activeElement.blur();if(l.onShow)l.onShow();if(l.onShowComplete){var g=false;var b=T();var y=setTimeout(function(){g=true;l.onShowComplete();e.off(b+".fs_modal_show_complete")},600);e.one(b+".fs_modal_show_complete",function(){if(!g){clearTimeout(y);l.onShowComplete()}})}document.activeElement.blur()},close:function e(t){p(t)},bindBackButton:function e(t){$("#fs_modal_back_btn").off("click.fs_modal").on("click.fs_modal",t)},unbindBackButton:function e(){$("#fs_modal_back_btn").off("click.fs_modal")},showBackButton:function e(){$("#fs_modal_back_btn").removeClass("hidden")},hideBackButton:function e(){$("#fs_modal_back_btn").addClass("hidden")},activate:function n(){e.addClass("active");t.addClass("active")},deactivate:function n(){e.removeClass("active");t.removeClass("active")},setHeaderTitle:function e(t){if(!a.length)return;a.find("h3").text(t)},showFooter:function t(){if(!s.length)return;e.addClass("fs_modal_footer");s.removeClass("hidden")},hideFooter:function t(){if(!s.length)return;e.removeClass("fs_modal_footer");s.addClass("hidden")}});var e;var t;var n;var r;var i;var a;var s;var o=0;var l=null;var u={title:"",body:"",body_template_html:null,show_go_button:true,show_secondary_go_button:false,show_cancel_button:true,go_button_text:TS.i18n.t("OK","fs_modal")(),go_button_class:"",secondary_go_button_text:TS.i18n.t("OK 2","fs_modal")(),secondary_go_button_class:"",cancel_button_text:TS.i18n.t("Cancel","fs_modal")(),disable_default_controls:false,disable_esc:false,onGo:null,onSecondaryGo:null,onCancel:null,onEnd:null,esc_for_ok:false,onShow:null,enter_always_gos:false,fullscreen:false,modal_class:null,modal_bg_class:null,modal_contents_container_class:null,modal_gallery:null,sidebar_html:null,header_html:null};var d=function o(){t=null;e=null;a=null;s=null;n=null;r=null;i=null;var u={settings:l,fs_modal_header:_.includes(l.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(l.modal_class,"fs_modal_footer"),fs_modal_sidebar:_.includes(l.modal_class,"fs_modal_sidebar"),disable_default_controls:l.disable_default_controls};var d=TS.templates.fs_modal(u);$("body").append(d);t=$("#fs_modal_bg");e=$("#fs_modal");a=$("#fs_modal_header");s=$("#fs_modal_footer");n=$("#fs_modal_close_btn")};var c=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}if(l.onGo){if(false!==l.onGo())p()}else p()};var m=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}if(l.onSecondaryGo){if(false!==l.onSecondaryGo())p()}else p()};var f=function e(t){if(t.which==TS.utility.keymap.enter&&("BODY"===TS.utility.getActiveElementProp("NODENAME")||l.enter_always_gos)){if(l.show_go_button){c();t.preventDefault()}}else if(t.which==TS.utility.keymap.esc){if(l.disable_esc)return;if(l.esc_for_ok)c();else{p();if(l.clog_name)TS.clog.track(l.clog_name+"_ACTION",{action:"close_modal",trigger:"esc_key"})}}};var p=function n(r){if(y(r)){if(e)e.removeClass("active");if(t)t.removeClass("active");setTimeout(function(){$("html").removeClass("fs_modal_active")},TS.ui.fs_modal.transition_duration);if(l.onCancel)l.onCancel();g()}};var h=function n(){e.remove();t.remove();TS.ui.fs_modal.is_showing=false};var g=function e(){setTimeout(function(){h()},TS.ui.fs_modal.transition_duration);$(window.document).off("keydown.fs_modal");if(l.onEnd)l.onEnd();TS.tips.unhideAll()};var S=function n(r){e.removeClass("active");if(l.onCancel)l.onCancel();var i=t.attr("id",null).addClass("fs_modal_bg");setTimeout(function(){e.remove();TS.ui.fs_modal.is_showing=false;TS.ui.fs_modal.start(r);setTimeout(i.remove.bind(i),TS.ui.fs_modal.transition_duration)},TS.ui.fs_modal.transition_duration)};var T=function t(){var n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(var r in n)if(void 0!==e[0].style[r])return n[r]};var v=function t(){var n=e.find("[data-modal-items]");o=l.modal_gallery.index;TS.ui.fs_modal.hideFooter();if(o)e.find('[data-modal-gallery-index="'+o+'"]').removeClass("hidden");else e.find("[data-modal-gallery-index]").first().removeClass("hidden");e.on("click","[data-modal-gallery-direction]",function(){var e=$(this).data("modal-gallery-direction");o+=e;n.find("[data-modal-gallery-index]").addClass("hidden");n.find('[data-modal-gallery-index="'+o+'"]').removeClass("hidden");b()});b()};var b=function t(){var n=e.find('[data-modal-gallery-direction="-1"]');var r=e.find('[data-modal-gallery-direction="1"]');var i=e.find("[data-modal-slideshow-count]");var a=e.find("[data-modal-slideshow-total]");var s=l.modal_gallery.total_items;if(0===o)n.prop("disabled",true);else n.prop("disabled",false);if(o===s)r.prop("disabled",true);else r.prop("disabled",false);i.html(o+1);a.html(s+1)};var y=function e(t){if(t)return true;if(TS.ui.lazy_filter_select.is_list_open)return false;if(TS.ui.react_emoji_menu.is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.dialog_is_showing)return false;if(TS.utility.isTabCompleteShowing())return false;return true}})()},4273:function(e,t){(function(){"use strict";TS.registerModule("ui.admin_edit_team_profile",{onStart:function e(){$("body").on("click",'[data-action="edit_team_profile_modal"]',TS.ui.admin_edit_team_profile.start)},start:function e(){if(C())a()}});var e;var t;var n;var r=[];var i=50;var a=function e(){var t={body_template_html:TS.templates.admin_edit_team_profile_modal(),onShow:s,onCancel:o};TS.ui.fs_modal.start(t)};var s=function n(){e=$("#edit_team_profile_container");t=$("body");e.on("click",'[data-action="edit_team_profile_to_custom"]',v);e.on("click",'[data-action="edit_team_profile_to_add"]',T);e.on("click",'[data-action="edit_team_profile_to_edit"]',b);e.on("click",'[data-action="edit_team_profile_to_hide"]',y);e.on("click",'[data-action="edit_team_profile_to_delete"]',w);e.on("click",'[data-action="edit_team_profile_cancel"]',S);e.on("click",'[data-action="edit_team_profile_confirm_edit"]',h);e.on("click",'[data-action="edit_team_profile_confirm_hide"]',m);e.on("click",'[data-action="edit_team_profile_confirm_delete"]',c);e.on("click",'[data-action="edit_team_profile_remove_option"]',E);e.on("click",'[data-action="edit_team_profile_add_option"]',F);e.on("focusin",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',H);e.on("focusout",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',D);e.on("input",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',B);e.on("click",'[data-action="edit_team_profile_list_menu"]',L);e.on("input","input",V);t.on("keydown.admin_submit",l);u().then(S).catch(TS.error)};var o=function i(){M(true);e=null;r=[];n=null;t.off("keydown.admin_submit");t=null;if(TS.web&&TS.web.account_profile)TS.web.account_profile.render();if(TS.web&&TS.web.members)TS.web.members.render()};var l=function e(t){if(t.which==TS.utility.keymap.enter){$(n).find('button[type="submit"]').trigger("click");return false}};var u=function e(){return TS.team.ensureTeamProfileFields()};var d=function e(t,n){if(!t)return;return TS.api.call(t,n).then(function(e){if(TS.web)if("team.profile.delete"===t)TS.team.upsertTeam({profile:JSON.parse(n.profile)});else TS.team.upsertTeam(e.data);return Promise.resolve(e)},function(e){return Promise.reject(e)})};var c=function e(t){var n=$(t.target);var r=n.data("id");if(!r)n=n.closest("[data-id]");r=n.data("id");if(!r)return;var i=TS.team.getTeamProfileFieldById(r);if(!i)return;g("team.profile.delete",[r]).then(function(){S()},_.noop)};var m=function e(t){p(t,true)};var f=function e(t){p(t,false)};var p=function e(t,n){var r=$(t.target);var i=r.data("id");if(!i)r=r.closest("[data-id]");i=r.data("id");if(!i)return;var a=TS.team.getTeamProfileFieldById(i);if(!a)return;a=$.extend({},a);a.is_hidden=n;if(n)a.ordering=R();g("team.profile.set",[a]).then(function(){return TS.api.call("team.profile.get")}).then(function(e){TS.model.team.profile.fields=_.get(e,"data.profile.fields");S();K(i)},_.noop)};var h=function t(n){var r=e.find("#edit_team_profile_edit");if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);Ladda.stopAll();$("#edit_team_profile_confirm_edit_btn").addClass("disabled");return}var i=$(n.target);var a=i.data("id");if(!a)i=i.closest("[data-id], [data-type]");a=i.data("id");var s=e.find('input[name="label"]');var o=e.find('input[name="hint"]');var l=TS.team.getTeamProfileFieldById(a)||{};var u=JSON.stringify(l);l=$.extend({},l);l.type=l.type||i.data("type")||"text";l.label=s.val().trim();l.hint=o.val().trim();l.ordering=void 0!==l.ordering?l.ordering:R();if("options_list"===l.type)l.possible_values=e.find('input[name^="option_"]').map(function(){return $(this).val().trim()}).toArray();function d(){S();K(a)}if(JSON.stringify(l)==u){d();Ladda.stopAll()}else g("team.profile.set",[l]).then(d,_.noop)};var g=function e(t,n){n=n&&n.length?n:TS.model.team.profile.fields;var r={profile:JSON.stringify({fields:n})};return d(t,r).catch(function(e){if("no_perms"===e.data.error||"missing_scope"===e.data.error)TS.generic_dialog.start({body:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Sorry! An owner in your workspace has restricted who can customize your members’ profile.","team_profile")():TS.i18n.t("Sorry! An owner on your team has restricted who can customize your team’s profile.","team_profile")(),show_cancel_button:false,esc_for_ok:true,fullscreen:false,onEnd:TS.ui.fs_modal.close});else if("field_bad_order"===e.data.error){TS.error("Failed to create profile field: "+e.data.error);return TS.generic_dialog.alert(TS.i18n.t("Apologies, but the maximum number of profile fields you can add is {max_no_of_fields, number}. Please remove some existing fields if you’d like to add different ones.","team_profile")({max_no_of_fields:i}))}else{TS.error("Failed to customize profile: "+e.data.error);return TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","team_profile")())}}).finally(Ladda.stopAll)};var S=function t(){r.length=0;r.push({back:t});var n={};n.team_profile_fields=G();n.hidden_team_profile_fields=W();n.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_list(n);e.find("#edit_team_profile_header").text(TS.i18n.t("Customize profile","team_profile")()).removeClass("hidden center_and_narrow");var a;if(TS.model.team.profile&&TS.model.team.profile.fields.length>=50)a='<div class="alert alert_info"><i class="ts_icon ts_icon_info_circle"></i>'+TS.i18n.t("You have reached the maximum number of fields that can be added to profiles.","team_profile")()+"</div>";else a=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Expand your members’ profiles by adding additional fields below","team_profile")():TS.i18n.t("Expand your team’s profiles by adding additional fields below","team_profile")();e.find("#edit_team_profile_value_note").html(a).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_list").html(i);N("#edit_team_profile_list");j();x();M(true)};var T=function t(){r.push({back:t});var n={};n.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_add(n);e.find("#edit_team_profile_header").text(TS.i18n.t("Select a field type","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_add").html(i);N("#edit_team_profile_add");x();M()};var v=function t(){r.push({back:t});var n=TS.templates.admin_edit_team_profile_custom();e.find("#edit_team_profile_header").text(TS.i18n.t("Create a new field","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").text(TS.i18n.t("Which type of field would you like to create?","team_profile")()).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_custom").html(n);N("#edit_team_profile_custom");x();M();P()};var b=function t(n){var i=$(n.target);if(i.hasClass("ts_icon_grabby_patty"))return false;var a=i.data("id");if(!a)i=i.closest("[data-id], [data-type]");a=i.data("id");var s={};var o;if(!a){s.type=i.data("type");s.label=i.data("label");o=TS.i18n.t("Customize profile field","team_profile")()}else{s=TS.team.getTeamProfileFieldById(a);if(!s)return;o=TS.i18n.t("Edit profile field","team_profile")()}n.stopPropagation();r.push({back:t,event:n});var l=TS.templates.admin_edit_team_profile_edit(s);e.find("#edit_team_profile_header").text(o).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_edit").html(l);N("#edit_team_profile_edit");I();A();P();Ladda.bind("#edit_team_profile_confirm_edit_btn");x();M();V()};var y=function t(n){var i=$(n.target);var a=i.data("id");if(!a)i=i.closest("[data-id]");a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;n.stopPropagation();r.push({back:t,event:n});var o=TS.templates.admin_edit_team_profile_hide({id:s.id,can_delete:!_.get(s,"options.is_scim",false)});var l=TS.i18n.t('Hide "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("All data entered for this field will no longer be visible on your members’ profiles. You can un-hide it later.","team_profile")():TS.i18n.t("All data entered for this field will no longer be visible on your team’s profiles. You can un-hide it later.","team_profile")();e.find("#edit_team_profile_value_note").text(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_hide").html(o);N("#edit_team_profile_hide");Ladda.bind("#edit_team_profile_confirm_hide_btn");k();M()};var w=function t(n){var i=$(n.target);var a=i.data("id");if(!a)i=i.closest("[data-id]");a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;n.stopPropagation();r.push({back:t,event:n});var o=TS.templates.admin_edit_team_profile_delete(s);var l=TS.i18n.t('Delete "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.i18n.t("<strong>Are you sure?</strong> All data associated with this field will be permanently deleted. This <strong>cannot be undone</strong>.","team_profile")();e.find("#edit_team_profile_value_note").html(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_delete").html(o);N("#edit_team_profile_delete");Ladda.bind("#edit_team_profile_confirm_delete_btn");k();M()};var k=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var x=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var C=function e(){if(!(TS.model.team&&TS.model.team.plan))return false;var t=TS.model.user;if(!t)return false;if("admin"===TS.model.team.prefs.who_can_change_team_profile)return t.is_admin;if("owner"===TS.model.team.prefs.who_can_change_team_profile)return t.is_owner;return true};var M=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){r.pop();var e=r.pop();e.back(e.event)});TS.ui.fs_modal.showBackButton()}};var I=function t(){var n=e.find(".option_row");if(n.length>=3)n.addClass("show_remove_action");else n.removeClass("show_remove_action")};var A=function t(){B({target:e.find('.option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]')})};var E=function e(t){$(t.target).closest(".row.option_row").remove();V();I();A();O()};var F=function t(){var n=TS.templates.admin_edit_team_profile_option_row({index:e.find(".row.option_row").length});e.find("#option_rows").append(n).find(".row.option_row").last().find("input").focus();V();I();O()};var O=function t(){if(50===e.find(".row.option_row").length)e.find('[data-action="edit_team_profile_add_option"]').addClass("hidden").next().removeClass("hidden");else e.find('[data-action="edit_team_profile_add_option"]').removeClass("hidden").next().addClass("hidden")};var B=function t(n){var r=$(n.target);var i=r.val();if(i)i=i.trim();if(void 0!==i&&!i.length)i=r.data("default");e.find('.profile_field_preview [data-id="'+r.data("target")+'"]').text(i)};var H=function t(n){var r=e.find('.profile_field_preview [data-id="'+$(n.target).data("target")+'"]');var i=r.closest("select");if(i.length)r=i;r.addClass("highlight_yellow_bg")};var D=function t(n){var r=e.find('.profile_field_preview [data-id="'+$(n.target).data("target")+'"]');var i=r.closest("select");if(i.length)r=i;r.removeClass("highlight_yellow_bg")};var P=function t(){var n=e.find(".edit_team_profile_lazy_filter_select");if(!n.length)return;var r={append:true,classes:"disabled",preselected_ids:[TS.members.getMemberByName("slackbot").id]};TS.ui.people_picker.make(n,r)};var j=function t(){e.find("#edit_team_profile_list_drag_and_drop_area").sortable({items:".visible_row[data-id]",handle:".ts_icon_grabby_patty",forcePlaceholderSize:true}).on("sortupdate",function(e){e.stopPropagation();var t=[];$(this).find(".row[data-id]").each(function(e){var n=TS.team.getTeamProfileFieldById($(this).data("id"));if(n&&n.ordering!=e){n.ordering=e;t.push({id:n.id,ordering:e})}});TS.team.sortTeamProfileFieldsByOrdering();g("team.profile.reorder",t)})};var R=function e(){if(!TS.model.team.profile.fields.length)return 0;return _.max(TS.model.team.profile.fields.map(function(e){return e.ordering}))+1};var L=function e(t){t.stopPropagation();var n=$(t.target).closest("[data-id]").get(0);var r={};r.is_scim=$(t.target).closest("[data-is-scim]").data("is-scim");var i=jQuery.Event("click",{target:n,currentTarget:n});TS.menu.startWithEditTeamProfileListActions(i,U,r)};var U=function e(t){t.preventDefault();var n=$(t.target).closest("[data-id]");if(n.is('[data-action="edit_team_profile_to_show"]'))f(t);else if(n.is('[data-action="edit_team_profile_to_hide"]'))y(t);else if(n.is('[data-action="edit_team_profile_to_delete"]'))w(t);TS.menu.end()};var N=function t(r){var i=["#edit_team_profile_loading","#edit_team_profile_list","#edit_team_profile_add","#edit_team_profile_custom","#edit_team_profile_edit","#edit_team_profile_hide","#edit_team_profile_delete"].filter(function(e){return e!==r}).join(", ");e.find(i).addClass("hidden");e.find(r).removeClass("hidden");n=r};var G=function e(){var t=TS.team.getVisibleTeamProfileFields();return t.length?t:null};var W=function e(){var t=TS.team.getHiddenTeamProfileFields();return t.length?t:null};var q=function e(){return TS.model.team.profile.fields.reduce(function(e,t){e[t.label.toLowerCase()]=true;return e},{})};var z=function e(){var t=q();var n=[{type:"text",label:TS.i18n.t("Address","team_profile")()},{type:"date",label:TS.i18n.t("Birthdate","team_profile")()},{type:"user",label:TS.i18n.t("Direct Reports","team_profile")()},{type:"link",label:TS.i18n.t("Facebook","team_profile")()},{type:"link",label:TS.i18n.t("Flickr","team_profile")()},{type:"link",label:TS.i18n.t("GitHub","team_profile")()},{type:"link",label:TS.i18n.t("Instagram","team_profile")()},{type:"link",label:TS.i18n.t("LinkedIn","team_profile")()},{type:"user",label:TS.i18n.t("Manager","team_profile")()},{type:"link",label:TS.i18n.t("Pinterest","team_profile")()},{type:"text",label:TS.i18n.t("Skype","team_profile")()},{type:"link",label:TS.i18n.t("SoundCloud","team_profile")()},{type:"date",label:TS.i18n.t("Start Date","team_profile")()},{type:"link",label:TS.i18n.t("Tumblr","team_profile")()},{type:"link",label:TS.i18n.t("Twitter","team_profile")()},{type:"link",label:TS.i18n.t("YouTube","team_profile")()}].filter(function(e){return!t[e.label.toLowerCase()]});return n.length?n:[]};var K=function t(n){var r=n?"[data-id="+n+"]":".visible_row[data-id]";var i=e.find("#edit_team_profile_list").find(r).last();var a=-2*i.outerHeight();i.highlight(1500,"",null,0);i.scrollintoview({duration:200,px_offset:a,direction:"y"})};var V=function t(){$("#edit_team_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e.find("#edit_team_profile_edit"),{quiet:true,fast:true}))}})()},4274:function(e,t){(function(){"use strict";TS.registerModule("ui.edit_member_profile",{onStart:function e(){TS.members.changed_profile_sig.add(pe);if(TS.view)TS.view.resize_sig.add(Te);$("body").on("click",'[data-action="edit_member_profile_modal"]',function(e){e.preventDefault();TS.ui.edit_member_profile.start();TS.clog.track("USER_PROFILE_CLICK")})},start:function e(){d()},handleDrag:function e(t){if(TS.boot_data.feature_take_profile_photo)if(t)K();else V()},handleDrop:function e(t){if(TS.boot_data.feature_take_profile_photo){V();B(t)}},_registerCurrentStatusInput:function e(){TS.ui.edit_member_profile._unregisterCurrentStatusInput();TS.ui.edit_member_profile._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#edit_member_profile_container"),has_presets_menu:true,has_form_context:true})},_unregisterCurrentStatusInput:function e(){if(TS.ui.edit_member_profile._current_status_input){TS.ui.edit_member_profile._current_status_input.destroy();TS.ui.edit_member_profile._current_status_input=null}}});var e;var t;var n;var r;var i;var a;var s;var o=[];var l;var u;var d=function e(){var t={body_template_html:TS.templates.edit_member_profile_modal(),onShow:c,onGo:ae,onCancel:m,go_button_text:TS.i18n.t("Save Changes","edit_profile")(),go_button_class:"edit_member_profile_confirm_edit_btn ladda-button",modal_class:"fs_modal_header fs_modal_footer",title:TS.i18n.t("Edit your profile","edit_profile")()};TS.ui.fs_modal.start(t)};var c=function n(){e=$("#edit_member_profile_container");t=$("body");if(be())$("#fs_modal_footer").prepend(TS.templates.edit_member_profile_footer({can_edit_team_profile:true}));if(TS.boot_data.feature_take_profile_photo)h();e.on("click",'[data-action="edit_member_profile_cancel_photo"]',W);e.on("click",'[data-action="edit_member_profile_confirm_photo_delete"]',F);e.on("click",'[data-action="edit_member_profile_confirm_photo_crop"]',O);e.on("click",'[data-action="edit_member_profile_photo_menu"]',le);e.on("click",'[data-action="edit_member_profile_upload_image"]',ue);e.on("click",'[data-action="edit_member_profile_to_delete"]',de);e.on("click",'[data-action="edit_member_profile_take_photo"]',Z);e.on("click",'[data-action="edit_member_profile_capture_photo"]',x);t.on("change.photo",'[data-action="edit_member_profile_upload_photo"]',B);t.on("keydown.member_submit",f);e.on("input","input",me).on("change","select",me);e.on("input",'[data-plastic-type="date"]',ve);e.on("dragenter",".member_image_upload",Y);e.on("dragleave",".member_image_upload",J);p().then(W).catch(TS.error)};var m=function a(){N();v();e=null;n=null;r=null;i=null;o=[];s=null;u=null;if(t){t.off("change.photo");t.off("keydown.member_submit");t=null}if(TS.client)TS.ui.edit_member_profile._unregisterCurrentStatusInput();if(TS.web&&TS.web.account_profile)TS.web.account_profile.render();if(TS.web&&TS.web.members)TS.web.members.render()};var f=function e(t){if(t.which==TS.utility.keymap.enter){var n=$(s).find('button[type="submit"]');if(n.length)n.trigger("click");else ae();return false}};var p=function e(){return TS.team.ensureTeamProfileFields()};var h=function e(){if(!TS.boot_data.feature_take_profile_photo)return;var t=g();u={};u.is_supported=!!t;u.is_accepted=true;u.is_enabled=false;u.video_el=null;u.video_stream=null;u.get_media=t};var g=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;if(t)return function(e){return new Promise(function(n,r){t.call(navigator,e,n,r)})};return null};var S=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(u.is_enabled){$(u.video_el).removeClass("no_opacity");return}var t=true;var n=700;var r=$("#edit_member_profile_photo_preview_overlay");r.addClass("no_opacity");l=function e(){t=false;r.addClass("no_opacity")};var i=function e(){t=false;r.addClass("no_opacity");$(u.video_el).removeClass("no_opacity")};var a=function e(){if(t)r.removeClass("no_opacity")};setTimeout(a,n);var s={video:{width:1280,height:720}};u.get_media(s).then(T).then(i).catch(y)};var T=function e(t){return new Promise(function(e){var n=t;var r=window.URL||window.webkitURL;if(r)n=r.createObjectURL(t);u.video_el=$("#edit_member_profile_photo_preview_video").get()[0];u.is_accepted=true;u.is_enabled=true;u.video_stream=t;$(u.video_el).attr("src",n);u.video_el.addEventListener("loadeddata",e)})};var v=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u||!u.is_enabled)return;b();u.video_el.pause();u.video_el.src="";u.video_el=null;u.video_stream.getVideoTracks()[0].stop();u.video_stream=null;u.is_enabled=false};var b=function e(){if(u.video_el)$(u.video_el).addClass("no_opacity");var t=$("#edit_member_profile_photo_preview_overlay");t.addClass("no_opacity");var n=$("#edit_member_profile_photo_capture_button");n.removeClass("hidden");var r=$("#edit_member_profile_photo_capture_countdown");r.addClass("hidden")};var y=function e(t){switch(t.name){case"PermissionDeniedError":case"PermissionDismissedError":u.is_accepted=false;w();break;case"NotFoundError":k();break;default:G()}};var w=function e(){return TS.generic_dialog.alert(TS.i18n.t("It looks like you’ve blocked Slack from accessing your camera. Just change your browser’s settings to allow Slack to take a photo now.","edit_profile")(),TS.i18n.t("Please enable your camera","edit_profile")()).then(W)};var k=function e(){return TS.generic_dialog.alert(TS.i18n.t("Sorry! Your camera could not be found!","edit_profile")()).then(W)};var x=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u.is_enabled)return;C().then(I).then(A).then(E).then(P).then(j).then(R).then(L).catch(U)};var C=function e(){if(!TS.boot_data.feature_take_profile_photo)return;return new Promise(function(e,t){if(!u.is_enabled){TS.warn("Camera not enabled");t()}TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Smile for the camera!","edit_profile")());var n=$("#edit_member_profile_photo_capture_button");n.addClass("hidden");var r=$("#edit_member_profile_photo_capture_countdown");r.removeClass("hidden");M(3,false,e,t)})};var M=function e(t,n,r,i){if(!TS.boot_data.feature_take_profile_photo)return;l=function e(){n=true};if(n){TS.info("Profile photo capture aborted");i(new Error("abort"));return}if(0===t){r();return}var a=$("#edit_member_profile_photo_countdown_progress");var s=$("#edit_member_profile_photo_countdown_text");a.circleProgress({value:1,size:64,animation:{duration:1e3},fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2}).on("circle-animation-progress",function(){s.html(parseInt(t,10))});setTimeout(function(){t-=1;e(t,n,r,i)},1e3)};var I=function e(){b();te();ge(0)};var A=function e(){if(!TS.boot_data.feature_take_profile_photo)return;return new Promise(function(e){var t=document.createElement("canvas");var n=t.getContext("2d");t.width=u.video_el.videoHeight;t.height=u.video_el.videoHeight;var r=(u.video_el.videoWidth-t.width)/-2;n.translate(t.width,0);n.scale(-1,1);n.drawImage(u.video_el,r,0,u.video_el.videoWidth,u.video_el.videoHeight);var i=t.toDataURL("image/png",1);e(i)})};var E=function e(t){if(!TS.boot_data.feature_take_profile_photo)return;var n;if(t.split(",")[0].indexOf("base64")>=0)n=atob(t.split(",")[1]);else n=unescape(t.split(",")[1]);var r=t.split(",")[0].split(":")[1].split(";")[0];var i=new Uint8Array(n.length);for(var a=0;a<n.length;a+=1)i[a]=n.charCodeAt(a);var s=new Blob([i],{type:r});s.lastModifiedDate=new Date;s.name="camera_photo";var o={file:s,src:t};return o};var F=function e(){$("#edit_member_profile_cancel_photo_delete_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.deletePhoto",function(e){e.stopPropagation()});TS.api.call("users.deletePhoto").then(function(){if(TS.web)return TS.api.call("users.info",{user:TS.model.user.id}).then(function(e){delete e.data.ok;var t=$.extend(true,TS.model.user,e.data.user);TS.members.upsertMember(t);pe();W()},W);W()}).catch(function(e){TS.warn("Unable to delete profile photo");TS.error(e);return G()}).finally(function(){Ladda.stopAll();t.off("keydown.deletePhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_delete_btn").removeClass("disabled")})};var O=function e(){if(r)r.disable();$("#edit_member_profile_cancel_photo_crop_btn").addClass("disabled");$("#edit_member_profile_retake_photo_crop_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.uploadPhoto",function(e){e.stopPropagation()});var n=$("#edit_member_profile_photo");var i=$("#cropbox");var a=i.data("dimensions");a.id=n.data("src_id");TS.api.call("users.setPhoto",a).then(function(e){if(TS.web){delete e.data.ok;var t=$.extend(true,TS.model.user,e.data);TS.members.upsertMember(t);pe()}W()}).catch(function(e){TS.warn("Unable to upload cropped profile photo");TS.error(e);return G()}).finally(function(){Ladda.stopAll();t.off("keydown.uploadPhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_crop_btn").removeClass("disabled");$("#edit_member_profile_retake_photo_crop_btn").removeClass("disabled");i.removeData("dimensions")})};var B=function t(n){var r="change"===n.type?$(this):void 0;if(r){if(!r.val()){if(TS.model.is_iOS)TS.menu.end();return}n=r.get(0).files}if(n){if(TS.model.is_iOS)TS.menu.end();if(!n.length)return;te();ge(0);H(n[0]).then(D).then(P).then(j).then(R).then(L).catch(U);e.find('[data-action="edit_member_profile_upload_photo"]').val("")}};var H=function e(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(n){e({file:t,src:n.target.result})};r.onabort=function(){TS.info("Profile photo file read aborted");n(new Error("abort"))};r.onerror=function(e){TS.warn("Unable to read profile photo file");TS.error(e);n(e)};l=function e(){try{r.abort()}catch(e){TS.error(e)}};r.readAsDataURL(t)})};var D=function e(t){return t.file.type.match(/image\/(?:gif|png|jpeg)/i)?Promise.resolve(t):Promise.reject(new Error("format"))};var P=function e(t){return new Promise(function(e,n){i=new Image;i.onload=function(){e(t)};i.onerror=function(e){TS.warn("Unable to set profile photo file image src");TS.error(e);n(e)};i.src=t.src})};var j=function e(t){var n=TS.model.api_url+"users.preparePhoto";var r=new FormData;r.append("image",t.file);r.append("token",TS.model.api_token);return new Promise(function(e,t){var i=$.ajax({url:n,data:r,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();if(e.upload)e.upload.addEventListener("progress",function(e){if(e.lengthComputable)ge(e.loaded/e.total);else{TS.info("Upload length not computable");ge(1)}},false);return e}}).fail(function(e,n,r){l=null;t(new Error(r))}).done(function(n){l=null;if(n.ok)e(n);else t(new Error(n.error))});l=i.abort})};var R=function e(t){return new Promise(function(e,n){var r=$("#edit_member_profile_photo");var a=r.get(0);var s=function n(){i.src=t.url;$("#edit_member_profile_photo_preview").css("background","url("+t.url+")");r.css("opacity",0);ee();u();e()};var o=function e(t){TS.warn("Unable to set crop photo file image src");TS.error(t);u();n(t)};var u=function e(){a.removeEventListener("load",s);a.removeEventListener("error",o)};l=function t(){u();e()};r.attr("src",t.url).data("src_id",t.id);a.addEventListener("load",s);a.addEventListener("error",o)})};var L=function e(){function t(e){if(!i)return;var t=o.width();var n=t*i.width/e.crop_w;var r=t*i.height/e.crop_w;var a=n*e.crop_x*-1/i.width;var s=r*e.crop_y*-1/i.height;o.css({"background-size":n+"px","background-position":a+"px "+s+"px"})}function n(e){if(!i)return;var n={crop_x:Math.round(e.x),crop_y:Math.round(e.y),crop_w:Math.min(Math.round(e.w),i.height)};s.data("dimensions",n);t(n)}function a(){r.animateTo(c,function(){var e=this.tellSelect();e.w=i.width;n(e)});r.focus()}var s=$("#cropbox");var o=$("#edit_member_profile_photo_preview");var l=$("#edit_member_profile_photo");var u=l.width();var d=l.height();var c;if(!i)return;var _=Math.min(i.width,i.height);t({crop_x:(i.width-_)/2,crop_y:(i.height-_)/2,crop_w:_});$("#edit_member_profile_photo").css("opacity",0);l.Jcrop({aspectRatio:1,allowSelect:false,boxWidth:u,boxHeight:d,onSelect:n,onRelease:a,bgColor:"white",trueSize:[i.width,i.height]},function(){r=this;var e=this.getBounds();var t=Math.min(e[0],e[1]);var n=(e[0]-t)/2;var i=(e[1]-t)/2;c=[n,i,t,t];a()})};var U=function e(t){switch(t&&t.message){case"abort":break;case"format":case"bad_image":case"too_many_frames":re();break;case"too_large":ie();break;default:return G()}};var N=function e(){if(l){l();l=null}};var G=function e(){return TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")()).then(W)};var W=function t(){o.length=0;o.push({back:t});Se();N();v();i=null;var n=!e.find("#edit_member_profile_list").children().first().length;if(n){var r={member:TS.model.user,team:TS.model.team,team_member_profile_fields:TS.team.getVisibleTeamProfileFieldsForMember(TS.model.user,true)};var a=[];_.each(TS.boot_data.slack_timezones,function(e){a.push({label:e[0],val:e[1]})});r.timezone_options=a;r.member_tz=TS.model.user.tz||TS.boot_data.default_tz;var s=TS.templates.edit_member_profile_list(r);e.find("#edit_member_profile_list").html(s);if(TS.client)TS.ui.edit_member_profile._registerCurrentStatusInput()}ce("#edit_member_profile_list");TS.ui.fs_modal.showFooter();TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Edit your profile","edit_profile")());Ladda.bind(".edit_member_profile_confirm_edit_btn");me();fe();oe();_e(true);if(TS.boot_data.feature_take_profile_photo){z();Q()}};var q=function e(){return true===TS.model.user.profile.is_custom_image};var z=function t(){var n=e.find(".show_delete");if(q()){n.removeClass("hidden");e.find(".member_image_wrapped_no_photo").addClass("hidden");e.find(".member_image_wrapped").removeClass("hidden")}else{n.addClass("hidden");e.find(".member_image_wrapped_no_photo").removeClass("hidden");e.find(".member_image_wrapped").addClass("hidden")}};var K=function t(){if(q())e.find(".member_image_wrapped").addClass("hidden");else e.find(".member_image_wrapped_no_photo").addClass("hidden");e.find(".edit-profile-drop-overlay").removeClass("hidden");e.find(".member_image_upload").removeClass("hidden");$(".file_drop_icon").fadeIn({queue:false,duration:"slow"});$(".file_drop_icon").animate({top:"20px"},"slow")};var V=function t(){if(q())e.find(".member_image_wrapped").removeClass("hidden");else e.find(".member_image_wrapped_no_photo").removeClass("hidden");e.find(".member_image_upload").addClass("hidden");e.find(".edit-profile-drop-overlay").addClass("hidden");e.find(".file_drop_icon").css("top","-20px")};var Y=function t(){e.find(".member_image_upload").addClass("hovered")};var J=function t(){e.find(".member_image_upload").removeClass("hovered")};var Q=function t(){var n=e.find(".show_take");if(u.is_supported)n.removeClass("hidden");else n.addClass("hidden")};var X=function t(){var n=e.find("#edit_member_profile_retake_photo_crop_btn");if(u.is_supported&&u.is_enabled&&u.is_accepted)n.removeClass("hidden");else n.addClass("hidden")};var Z=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u||!u.is_supported)return;o.push({back:W});i=null;Se();S();ce("#edit_member_profile_photo_take");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Take a profile photo","edit_profile")());oe();_e()};var ee=function e(){o.push({back:W});if(TS.boot_data.feature_take_profile_photo)X();ce("#edit_member_profile_photo_crop");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Crop your photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_crop_btn");oe();_e()};var te=function e(){o.push({back:W});if(!n)he();ce("#edit_member_profile_photo_upload");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Uploading your photo…","edit_profile")());oe();_e()};var ne=function e(){o.push({back:e});ce("#edit_member_profile_photo_delete");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Remove profile photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_delete_btn");se();_e()};var re=function e(){o.push({back:W});ce("#edit_member_profile_photo_format_error");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Oh cripes","edit_profile")());oe();_e()};var ie=function e(){o.push({back:W});ce("#edit_member_profile_photo_oversize_error");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Dang","edit_profile")());oe();_e()};var ae=function t(){if(!TS.ui.validation.validate(e,{quiet:true,fast:true})){TS.ui.validation.validate(e);Ladda.stopAll();$(".edit_member_profile_confirm_edit_btn").addClass("disabled");return}var n=["first_name","last_name","title","phone"];if(TS.boot_data.feature_name_tagging_client)n=["real_name","display_name","title","phone"];if(TS.client)n=n.concat(["status_emoji","status_text"]);var r={};n.forEach(function(t){var n;var i;if(TS.boot_data.feature_texty&&"status_text"===t){n=e.find("#current_status_for_edit_profile");i=TS.utility.contenteditable.value(n)}else{n=e.find('input[name="'+t+'"]');i=n.val()}r[t]=i&&i.trim();if(!TS.boot_data.feature_texty)n.val("").val(i)});if(TS.client){var i=TS.ui.edit_member_profile._current_status_input;if(i&&i.isEdited())i.clogStatusChange(r.status_text,r.status_emoji,"EDIT_PROFILE")}(TS.model.team.profile.fields||[]).filter(function(e){return!e.is_hidden}).forEach(function(t){var n=TS.model.user.profile.fields||{};var i=ye(n[t.id]);var a=ye(i.value);var s=ye(i.alt);var o=e.find('input[name="'+t.id+'"], select[name="'+t.id+'"]');var l=e.find('input[name="'+t.id+'_alt"]');var u=ye(o.val());var d=ye(l.val());r.fields=r.fields||{};if(a!==u||s!==d)r.fields[t.id]={value:u&&u.trim(),alt:d&&d.trim()};if("text"===t.type&&"skype"===t.label.toLocaleLowerCase())r.skype=u&&u.trim();o.val("").val(u);l.val("").val(d)});var a={profile:JSON.stringify(r)};var s=e.find('[name="tz"]').val();if(s!==TS.model.user.tz){if(TS.web){TS.model.user.tz=s;TS.model.user.tz_offset=TS.boot_data.dst_offsets[s].tz_offset}TS.prefs.setPrefByAPI({name:"tz",value:s})}TS.api.call("users.profile.set",a).then(function(e){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if(TS.web){TS.model.user.profile=e.data.profile;TS.members.upsertMember(TS.model.user)}if(TS.client)TS.ui.edit_member_profile._unregisterCurrentStatusInput();TS.ui.fs_modal.close()}).catch(function(t){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if("ratelimited"===t.data.error)return TS.generic_dialog.alert(TS.i18n.t("You’re changing your profile too often! You might have better luck if you try again in a few minutes.","edit_profile")());if(TS.boot_data.feature_name_tagging_client){if("invalid_name_specials"===t.data.error)t.data.error="name_invalid_name_specials";if("invalid_name_maxlength"===t.data.error)t.data.error="name_invalid_name_maxlength";if("invalid_name_required"===t.data.error)t.data.error="name_invalid_name_required";var n=TS.ui.validation.getErrorMessage(t.data.error,{maxlength:80});if("real_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),n,{custom_for:"real_name_profile_field_warnings",should_truncate:false});return false}else if("display_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),n,{custom_for:"display_name_profile_field_warnings",should_truncate:false});return false}TS.ui.fs_modal.close();TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")())}return TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")())}).finally(Ladda.stopAll);if(TS.boot_data.feature_name_tagging_client)return false};var se=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var oe=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var le=function t(n){n.stopPropagation();if((!q()||$(n.target).is(".btn"))&&!TS.model.is_iOS)e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click");else TS.menu.member.startWithEditMemberProfilePhotoActions(n,ue)};var ue=function t(n){var r;if(TS.boot_data.feature_take_profile_photo)r=$(n.target).closest("ts-icon");else r=$(n.target).closest("li");if(r.is('[data-action="edit_member_profile_upload_image"]')){if(!TS.model.is_iOS){n.preventDefault();e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click");TS.menu.end()}}else if(r.is('[data-action="edit_member_profile_to_delete"]')){n.preventDefault();ne();TS.menu.end()}};var de=function e(t){var n=TS.boot_data.feature_take_profile_photo?$(t.target).closest("ts-icon"):$(t.target).closest("li");if(n.is('[data-action="edit_member_profile_to_delete"]')){t.preventDefault();ne();TS.menu.end()}};var ce=function t(n){var r=["#edit_member_profile_loading","#edit_member_profile_list","#edit_member_profile_photo_upload","#edit_member_profile_photo_crop","#edit_member_profile_photo_delete","#edit_member_profile_photo_take","#edit_member_profile_photo_size_error","#edit_member_profile_photo_format_error","#edit_member_profile_photo_oversize_error"].filter(function(e){return e!==n}).join(", ");e.find(r).addClass("hidden");e.find(n).removeClass("hidden");s=n};var _e=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){o.pop();var e=o.pop();e.back()});TS.ui.fs_modal.showBackButton()}};var me=function t(){$(".edit_member_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e,{quiet:true,fast:true}))};var fe=function t(){e.find(".edit_member_profile_lazy_filter_select").each(function(e,t){var n=$(t);var r=n.val().split(/\s*,\s*/);TS.ui.people_picker.make(n,{preselected_ids:r});n.on("change",function(){var e=TS.ui.people_picker.value(n).map(function(e){return e.member.id}).join(",");n.val(e);me()})})};var pe=function t(){if(!e)return;$("#edit_member_profile_photo_container .member_image").replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,192,false,true))};var he=function e(){n=$("#edit_member_profile_progress_circle").circleProgress({value:0,size:64,fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2})};var ge=function e(t){var r=parseFloat(t);if(!isNaN(r))n.circleProgress({value:r.toFixed(2)})};var Se=function e(){if(!r)return;r.destroy();r=null;$("#edit_member_profile_photo").css({width:"auto",height:"auto",display:"block",visibility:"visible",opacity:1})};var Te=function e(){if(r&&r.getOptions().disabled)return;Se();if(a)clearTimeout(a);a=setTimeout(function(){if(i&&!r)L()},300)};var ve=function e(t){var n=$(t.target);var r=$('input[name="'+n.attr("name")+'_alt"]');var i=n.val();if(i)i=i.trim();if(TS.ui.validation.validate(n,{quiet:true,fast:true}))r.val(TS.interop.datetime.convertISOtoUTCReadableDate(i))};var be=function e(){if(!TS.model.team.plan)return false;var t=TS.model.user;if(!t)return false;if(TS.model.user.enterprise_user)return TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner;if("admin"===TS.model.team.prefs.who_can_change_team_profile)return t.is_admin;if("owner"===TS.model.team.prefs.who_can_change_team_profile)return t.is_owner;return true};var ye=function e(t){return _.isUndefined(t)?"":t}})()},4275:function(e,t){(function(){"use strict";TS.registerModule("ui.validation",{completed_sig:new signals.Signal,onStart:function e(){$("body").on("input.validation paste.validation change.validation blur.validation","[data-validation]",TS.utility.debounce(function(e){if($(e.target).is(".ql-editor")||$(e.target).is(".ql-clipboard"))o($(e.target).closest(".ql-container"),{},e);else o($(e.target),{},e)},250));$("body").on("submit.validation","form[data-validation-form]",function(e){var t=$(e.target);var n=TS.ui.validation.validate(t);if(!n)e.preventDefault();TS.ui.validation.completed_sig.dispatch(t,{event:e,passed:n})})},validate:function e(t,n){n=n||{};var r=document;if(t){if(t.is("[data-validation]")){if(1===t.length)return o(t,n);return t.toArray().every(function(e){return o($(e),n)})}r=t.get(0)}var i=Array.prototype.slice.call(r.querySelectorAll("[data-validation]"));if(n&&n.fast)return i.every(function(e){return o($(e),n)});else if(n&&n.verbose){var a={};i.forEach(function(e){a[e.name]=o($(e),n)});return a}return i.reduce(function(e,t){return o($(t),n)&&e},true)},register:function e(t,n){if(s[t]){TS.warn(t+" cannot be registered because that key is already in use.");return}if("function"!==typeof n){TS.warn("Only functions can be registered as validators.");return}s[t]=n},showCustomValidation:function e(t,n,r,i){P(t,r.error_message||n,r.class,r,i)},getErrorMessage:function e(t,r){switch(t){case"invalid_name_required":return n.required();case"invalid_name_punctuation":return n.punctuation();case"invalid_name_maxlength":return n.maxlength({maxlength:r.maxlength});case"invalid_name_specials":return n.specials();case"name_taken":return n.name_taken({name:r.name});case"restricted_action":return a.restricted_action();case"name_invalid_name_required":return i.required();case"invalid_starts_with_at":return i.at_sign();case"name_invalid_name_maxlength":case"too_long":return i.maxlength({maxlength:r.maxlength});case"invalid_reserved_word":return i.reserved();case"name_invalid_name_specials":return i.specials();case"invalid_emoji_not_allowed":return i.emoji();default:return TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","ui_validation")()}},showError:function e(t,n,r,i){P(t,r.error_message||n,"validation_error",r,i)},showWarning:function e(t,n,r,i){P(t,r.warning_message||n,"validation_warning",r,i)},showSuccess:function e(t,n,r,i){P(t,r.success_message||n,"validation_success",r,i)},test:function e(){return{validations:s}}});var e=new RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:localhost)|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");var t=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=+$,\w]+@)?[A-Za-z0-9.-]+|(?:www\.|[-;:&=+$,\w]+@)[A-Za-z0-9.-]+)((?:\/[+~%/.\w-]*)?\??(?:[-+=&;%@.\w]*)#?(?:[.!/\\\w]*))?)/gi;var n={name_taken:TS.i18n.t("{name} is already taken by a channel, username, or user group.","ui_validation"),lowercase:TS.i18n.t("Channel names must be all lowercase. Try again?","ui_validation"),maxlength:TS.i18n.t("Blerg, that’s a bit too long! Channel names must be fewer than {maxlength} characters.","ui_validation"),required:TS.i18n.t("Don’t forget to name your channel.","ui_validation"),specials:TS.i18n.t("Channel names can’t contain spaces, periods, or most punctuation. Try again?","ui_validation"),punctuation:TS.i18n.t("Names can’t consist solely of punctuation. Please elaborate!","ui_validation")};var r={firstalphanumeric:TS.i18n.t("Usernames must start with a letter or number. Sorry about that!","ui_validation"),lowercase:TS.i18n.t("Sorry, usernames must be lowercase!","ui_validation"),maxlength:TS.i18n.t("Sorry, that’s a bit too long! Usernames must be fewer than {maxlength} characters.","ui_validation"),required:TS.i18n.t("Please fill in a username.","ui_validation"),specials:TS.i18n.t("Usernames can’t contain special characters. Sorry about that!","ui_validation")};var i={required:TS.i18n.t("Unfortunately, you can’t leave this blank.","ui_validation"),at_sign:TS.i18n.t("Names can’t start with the @ sign — that’s how your teammates will mention you in conversation.","ui_validation"),maxlength:TS.i18n.t("Unfortunately, names can’t be longer than {maxlength} characters.","ui_validation"),reserved:TS.i18n.t("That name’s already being used by Slack.","ui_validation"),specials:TS.i18n.t("Mostly, names can’t contain punctuation. (Apostrophes, spaces, and periods are fine.)","ui_validation"),emoji:TS.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation")};var a={restricted_action:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Sorry! An admin in your workspace has restricted who can create private channels.","ui_validation"):TS.i18n.t("Sorry! An admin on your team has restricted who can create private channels.","ui_validation")};var s={dateandformat:w,firstalphanumeric:C,hasnourl:h,isurlstrict:m,isurl:f,islink:p,lowercase:k,maxcsv:b,maxlength:S,mincsv:v,minlength:g,nospace:x,required:u,reservedwords:d,keywords:c,username:M,channel_name:A,shared_channel_name:E,team_name:F,is_email:O};var o=function e(t,n,r){n=n||{};if(t.is("[data-validation-for]"))n.custom_for=t.attr("data-validation-for");n.success_message=TS.i18n.t("Nice, thanks!","ui_validation")();if(t.is("[data-validation-success]"))n.success_message=t.attr("data-validation-success");if(t.is("[data-validation-warning]"))n.warning_message=t.attr("data-validation-warning");if(t.is("[data-validation-error]"))n.error_message=t.attr("data-validation-error");if(G(t))N(t,n);var i=l(t).every(function(e){if(-1===e.indexOf("="))return s[e.trim()](t,n);var r=e.split("=");return s[r[0]](t,n,r[1])});TS.ui.validation.completed_sig.dispatch(t,{event:r,passed:i});if(D(t,i,n))TS.ui.validation.showSuccess(t,n.success_message,n,3e3);return i};var l=function e(t){if(t.is("[data-validation]"))return _.compact(t.attr("data-validation").replace(/\s*(,|=)\s*/g,"$1").split(/\s+/));return[]};function u(e,t){if(e.is('input[type="radio"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.i18n.t("Please select an option","ui_validation")(),t)}else if(e.is('input[type="checkbox"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.i18n.t("Please select at least one option","ui_validation")(),t)}else if(e.is("select")){if(e.val())return true;TS.ui.validation.showWarning(e,TS.i18n.t("Please select an option","ui_validation")(),t)}else if(G(e)){if(W(e).trim())return true;TS.ui.validation.showWarning(e,TS.i18n.t("This field can’t be empty","ui_validation")(),t)}else TS.error("Error: cannot validate")}function d(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var r=W(e).trim().toLowerCase();var i=n.split(",");if(-1===i.indexOf(r))return true;TS.ui.validation.showWarning(e,TS.i18n.t('"{word}" is a reserved word. Try something else!',"ui_validation")({word:_.escape(r)}),t)}else TS.error("WTF: cannot validate")}function c(e,t){return d(e,t,TS.model.RESERVED_KEYWORDS.join(","))}function m(t,n,r){var i=TS.i18n.t("This doesn’t seem like a proper link. Sorry!","ui_validation")();if(t.is('input[type="radio"]')||t.is('input[type="checkbox"]')||t.is("select"))return true;if(G(t)){var a=W(t);if(!a)return true;var s=a.match(e);if(s&&1===s.length&&s[0]===a){if(!r)return true;var o=r.split(",");for(var l=0;l<o.length;l+=1)if("http"===o[l]){if(0===s[0].indexOf("http://")||0===s[0].indexOf("https://"))return true}else if(0===s[0].indexOf(o[l]+"://"))return true;else if("https"===o[l])i=TS.i18n.t("Please use https (for security).","ui_validation")()}TS.ui.validation.showWarning(t,i,n)}else TS.error("Error: cannot validate")}function f(e,t,n){var r=W(e);var i=TS.i18n.t("This doesn’t seem like a proper link. Sorry!","ui_validation")();var a;var s=false;var o=false;if(!r)return true;if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!G(e)){TS.error("Error: cannot validate");return}if(n){a=n.split(",");if(-1!=a.indexOf("https"))i=TS.i18n.t("Please use https (for security).","ui_validation")();if(-1!=a.indexOf("http")&&-1==a.indexOf("https"))a.push("https");for(var l=0;l<a.length;l+=1)if(0===r.indexOf(a[l]+"://"))s=true}else{s=true;if(-1==r.indexOf("://"))r="http://"+r}o=TS.utility.url.simpleIsUrl(r);if(o&&s)return true;TS.ui.validation.showWarning(e,i,t)}function p(e,n){var r=TS.i18n.t("This doesn’t seem like a proper link. Sorry!","ui_validation")();if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var i=W(e);if(!i)return true;var a=i.match(t);if(a&&1===a.length&&a[0]===i)return true;TS.ui.validation.showWarning(e,r,n)}else TS.error("Error: cannot validate")}function h(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var n=W(e);if(!n)return true;if(!TS.utility.findUrls(n).length)return true;TS.ui.validation.showWarning(e,TS.i18n.t("Unfortunately, custom messages can’t contain URLs.","ui_validation")(),t)}else TS.error("Error: cannot validate")}function g(e,t,n,r){return T(e,"minlength",t,n,r)}function S(e,t,n,r){return T(e,"maxlength",t,n,r)}function T(e,t,n,r,i){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var a=W(e);r=+r;if(void 0===a||isNaN(r)){TS.error("Error: no length to validate");return}if("minlength"===t){if(TS.interop.utility.getStringLength(a)>=r)return true;TS.ui.validation.showError(e,TS.i18n.t("This field can’t be less than {minlength, plural, =1{# character}other{# characters}}","ui_validation")({minlength:r}),n)}else if("maxlength"===t){if(!i)L(e,a.length,r,n);if(TS.interop.utility.getStringLength(a)<=r)return true;TS.ui.validation.showError(e,TS.i18n.t("This field can’t be more than {maxlength, plural, =1{# character}other{# characters}}","ui_validation")({maxlength:r}),n)}}else TS.error("Error: cannot validate")}function v(e,t,n){return y(e,"mincsv",t,n)}function b(e,t,n){return y(e,"maxcsv",t,n)}function y(e,t,n,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var i=W(e).trim();r=+r;if(void 0===i||isNaN(r)){TS.error("Error: no length to validate");return}if("mincsv"===t){if(i.split(/\s*,\s*/).length>=r)return true;TS.ui.validation.showError(e,TS.i18n.t("This field can’t have less than {minlength, plural, =1{# value}other{# values}}","ui_validation")({minlength:r}),n)}else if("maxcsv"===t){if(i.split(/\s*,\s*/).length<=r)return true;TS.ui.validation.showError(e,TS.i18n.t("This field can’t have more than {maxlength, plural, =1{# value}other{# values}}","ui_validation")({maxlength:r}),n)}}else TS.error("Error: cannot validate")}function w(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var r=W(e).trim();if(!r)return true;var i;var a;var s;var o;switch(n){case"Y-m-d":i="YYYY-MM-DD";a=r.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===r;if(s)o=H(r+"T00:00:00.000Z");break;case"m-d":i="MM-DD";a=r.match(/^[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===r;if(s)o=H("0000-"+r+"T00:00:00.000Z");break;default:TS.error("Error: cannot validate");return}if(s&&o)return true;if(!s)TS.ui.validation.showWarning(e,TS.i18n.t("This needs to be in the format {pattern}. Sorry!","ui_validation")({pattern:i}),t);else if(!o)TS.ui.validation.showWarning(e,TS.i18n.t("{value} doesn’t appear to be a valid date. Sorry!","ui_validation")({value:_.escape(r)}),t)}else TS.error("Error: cannot validate")}function k(e,t){var n=G(e)?W(e):e.val();var r=n===n.toLocaleLowerCase();if(r)return true;TS.ui.validation.showWarning(e,TS.i18n.t("This field must be lowercase only","ui_validation")(),t)}function x(e,t){var n=G(e)?W(e):e.val();var r=/\s/.test(n);if(!r)return true;TS.ui.validation.showWarning(e,TS.i18n.t("This field can’t contain spaces","ui_validation")(),t)}function C(e,t){var n=G(e)?W(e):e.val();var r=/^[^\W_]/.test(n);if(r)return true;TS.ui.validation.showWarning(e,TS.i18n.t("This first character must be a letter or number","ui_validation")(),t)}function M(e,t){var n=21;var i=$.extend({},t,{quiet:true});if(!u(e,i))TS.ui.validation.showWarning(e,r.required(),t);else if(!S(e,i,n,true))TS.ui.validation.showWarning(e,r.maxlength({maxlength:n+1}),t);else if(!x(e,i))TS.ui.validation.showWarning(e,r.specials(),t);else if(!B(e,i,/^[\w._-]+$/))TS.ui.validation.showWarning(e,r.specials(),t);else if(!C(e,i))TS.ui.validation.showWarning(e,r.firstalphanumeric(),t);else if(!k(e,i))TS.ui.validation.showWarning(e,r.lowercase(),t);else if(!d(e,t,TS.model.RESERVED_USERNAMES.join(",")))return false;else return true}function I(e,t){var r=$.extend({},t,{quiet:true});var i=21;if(!u(e,r)){TS.ui.validation.showWarning(e,n.required(),t);return true}if(!S(e,r,i,true)){TS.ui.validation.showWarning(e,n.maxlength({maxlength:i+1}),t);return true}if(!x(e,r)){TS.ui.validation.showWarning(e,n.specials(),t);return true}if(B(e,r,/^[-|_]+$/)){TS.ui.validation.showWarning(e,n.punctuation(),t);return true}}function A(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!G(e)){TS.error("Error: cannot validate");return}var r=W(e);var i=q(n);var a=_.includes(i,"fix");if(a)r=z(e);var s=I(e,t);if(s)return false;var o=TS.shared.getActiveModelOb()||{};if($(".channel_options_modal").is(":visible")&&r===o.name)return false;var l=TS.channels.getChannelByName(r)||TS.groups.getGroupByName(r)||TS.members.getMemberByName(r);if(!l)return true;TS.ui.validation.showWarning(e,TS.i18n.t('"{name}" is already taken by a channel, username, or user group.',"ui_validation")({name:_.escape(r)}),t)}function E(e,t,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!G(e)){TS.error("Error: cannot validate");return}var r=W(e);var i=q(n);var a=_.includes(i,"fix");if(a)r=z(e);var s=I(e,t);if(s)return false;var o=false;var l=TS.channels.getChannelByName(r)||TS.groups.getGroupByName(r)||TS.members.getMemberByName(r);var u=TS.shared.getActiveModelOb();if(!l)o=true;if(l&&l.id===u.id)o=true;if(l&&l.id!==u.id){TS.ui.validation.showWarning(e,TS.i18n.t("{name} has already been taken. Try something else!","ui_validation")({name:_.escape(r)}),t);return}return o}function F(e,t){t=t||{};var n=W(e).trim();var r=TS.validation.team_name(n);if(true!==r){t.should_truncate=false;if("empty"===r.error_key)TS.ui.validation.showCustomValidation(e,r.error_message,t);else TS.ui.validation.showError(e,r.error_message,t);return false}return true}function O(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(G(e)){var n=W(e);if(!n)return true;var r=n.match(TS.utility.email_regex);if(r&&1===r.length&&r[0]===n)return true;TS.ui.validation.showWarning(e,TS.i18n.t("This doesn’t seem like an email address. Sorry!","ui_validation")(),t)}else TS.error("Error: cannot validate")}function B(e,t,n){var r=G(e)?W(e):e.val();if(!n.test(r))TS.ui.validation.showWarning(e,TS.i18n.t("This field contains invalid characters","ui_validation")(),t);else return true}var H=function e(t){if(!isNaN(Date.parse(t))){var n=new Date(t);return!n.toISOString().indexOf(t)}};var D=function e(t,n,r){var i=$(document.querySelector('label[for="'+(r.custom_for||t.attr("name"))+'"]'));if(!i.length)return;return!(r&&r.quiet)&&n&&false===i.data("validation-ephemeral")};var P=function e(t,n,r,i,a){i=i||{};if(_.isUndefined(i.should_truncate))i.should_truncate=true;if(i&&i.quiet)return;var s=$(document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]'));if(!s.length)return;var o=s.data("validation-timeout");clearTimeout(o);var l=s.find(".validation_message");if(!l.length){l=$("<span />").addClass("validation_message").toggleClass("overflow_ellipsis",i.should_truncate);if(t.is("select"))l.insertBefore(s.find("select"));else l.appendTo(s)}if(!n){l.remove();return}R(t,s,r);l.get(0).title=n;l.fadeIn(100);s.data("validation-ephemeral",!!a);if(a)s.data("validation-timeout",setTimeout(function(){s.removeData("validation-ephemeral").removeData("validation-timeout");l.fadeOut(100,function(){R(t,s);l.remove()})},a))};var j=["validation_error","validation_warning","validation_success"];var R=function e(t,n,r){if(n.hasClass(r))return;t.removeClass(j.join(" "));t.addClass(r);n.removeClass(j.join(" "));n.addClass(r)};var L=function e(t,n,r,i){if(r-n<=6)U(t,n,r,i);else N(t,i)};var U=function e(t,n,r,i){var a=document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]');if(!a)return;var s=[n,r].join("/");$(a).attr("data-countdown",s).addClass("countdown");var o=window.getComputedStyle(a,":after");var l=parseFloat(o.width)||9*s.length;if(t.hasClass("no_validation_padding"))return;if(!t.data("countdown-padding-right"))t.data("countdown-padding-right",parseFloat(t.css("padding-right")));t.css("padding-right",l+parseFloat(o.right)+t.data("countdown-padding-right"))};var N=function e(t,n){var r=document.querySelector('label[for="'+(n.custom_for||t.attr("name"))+'"]');if(!r)return;$(r).removeClass("countdown");t.removeData("countdown-padding-right");t.css("padding-right","")};var G=function e(t){if(TS.utility&&TS.utility.contenteditable)return t.is("input")||t.is("textarea")||TS.utility.contenteditable.isContenteditable(t);return t.is("input")||t.is("textarea")};var W=function e(t){if(TS.utility&&TS.utility.contenteditable)return TS.utility.contenteditable.value(t);return t.val()};var q=function e(t){if(!_.isString(t))return[];return _(t).split(",").map(_.trim).compact().value()};var z=function e(t){var n=W(t);var r=n.toLowerCase().replace(/^#+/,"");if(r&&n!==r){var i=TS.utility.contenteditable.cursorPosition(t).start;if(r.length<n.length)i-=n.length-r.length;t.val(r);TS.utility.contenteditable.cursorPosition(t,i)}return r}})()},4278:function(e,t){(function(){"use strict";TS.registerModule("enterprise.workspaces",{showList:function e(n,r,i,a){var s=TS.enterprise.workspaces.getList(r,a);var o=$(".more_teams_available");var l="";if(s.length){s.forEach(function(e){l+=TS.enterprise.workspaces.getTeamCardHTML(e,i,true)});var u=TS.enterprise.workspaces.getList("teams_not_on",a);if("teams_on"===r&&u.length)o.attr("data-has-more","yes").removeClass("hidden");else o.attr("data-has-more","").addClass("hidden")}else{if("teams_on"===r)l+=TS.templates.not_on_any_workspaces();else l+=TS.templates.no_workspaces_to_join();o.attr("data-has-more","").addClass("hidden")}n.html(l).attr("data-list",r);t(n,r,i);return Promise.resolve(!!s.length)},getList:function e(t,n,r,i){if(!n)if("teams_not_on"===t)n="members";else n="join";if(!r)r="";r=r.toLowerCase();if(void 0===i)i=false;var a=[];if(i)if(TS.model.is_our_app)a=_.difference(TS.model.user.enterprise_user.teams,TSSSB.call("getSignedInTeamIds"));else a=_.difference(TS.model.user.enterprise_user.teams,[TS.model.team.id]);var s={teams_on:[],teams_not_on:[]};TS.model.enterprise_teams.forEach(function(e){if(TS.model.user.enterprise_user.teams.indexOf(e.id)>-1)if(a.indexOf(e.id)>-1)s.teams_not_on.push(e);else s.teams_on.push(e);else if(e.is_open||e.is_closed||e.is_assigned)s.teams_not_on.push(e)});return s[t].filter(function(e){return e.name.toLowerCase().indexOf(r)>-1||e.description&&e.description.toLowerCase().indexOf(r)>-1}).sort(function(e,t){if("name"===n){var r=e.name.toLowerCase();var i=t.name.toLowerCase();if(r<i)return-1;if(r>i)return 1;return 0}else if("creation"===n)return t.created-e.created;else if("join"===n)return t.joined_date-e.joined_date;else if("members"===n)return parseInt(t.user_counts.active_members,10)-parseInt(e.user_counts.active_members,10);return 0})},joinTeam:function e(t){var r=TS.enterprise.getTeamById(t);if(!r)return TS.generic_dialog.alert(TS.i18n.t("Invalid workspace","enterprise_dashboard")(),TS.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());if(!r.is_open&&!r.is_assigned)return TS.generic_dialog.alert(TS.i18n.t("This workspace is not available to join.","enterprise_dashboard")(),TS.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());var i={team:r.id};if("client"===TS.boot_data.app)i.enterprise_token=TS.model.enterprise_api_token;return TS.api.call("enterprise.teams.join",i,function(e,t,r){var i=TS.enterprise.getTeamById(r.team);var a=new Handlebars.SafeString(emoji.replace_colons(":sparkles:")+TS.i18n.t(" You’ve successfully joined <strong>{team_name}</strong>","enterprise_dashboard")({team_name:_.escape(i.name)}));if(e){if(TS.boot_data.feature_lazy_grid_teams)TS.teams.upsertTeam(_.merge({},TS.teams.getTeamById(r.team),{joined_date:t.joined_date}));else{i=_.merge({},TS.enterprise.getTeamById(r.team));i.joined_date=t.joined_date;TS.enterprise.upsertEnterpriseTeam(i)}n("success",a);return true}if("user_already_team_member"===t.error){n("success",a);return true}else if("team_is_not_open"===t.error){if(TS.boot_data.feature_teams_to_workspaces)n("error",TS.i18n.t("This workspace is not open to join.","enterprise_dashboard")());else n("error",TS.i18n.t("This team is not open to join.","enterprise_dashboard")());return false}if(TS.boot_data.feature_teams_to_workspaces)n("error",TS.i18n.t('Joining workspace failed with error "{error}"',"enterprise_dashboard")({error:t.error}));else n("error",TS.i18n.t('Joining team failed with error "{error}"',"enterprise_dashboard")({error:t.error}));return false})},requestToJoinTeam:function e(t){var n={team:t};if("client"===TS.boot_data.app)n.enterprise_token=TS.model.enterprise_api_token;return TS.api.call("enterprise.teams.joinrequests.create",n,function(e,t,n){if(TS.boot_data.feature_lazy_grid_teams)TS.teams.upsertTeam(_.merge({},TS.teams.getTeamById(n.team),{has_join_request:true}));else{var r=TS.enterprise.getTeamById(n.team);var i=_.merge({},r,{has_join_request:true});TS.enterprise.upsertEnterpriseTeam(i)}return e})},createLogoutURL:function e(t,n){var r=document.createElement("a");r.href=n;var i=r.protocol+"//"+r.host+"/signout/"+t+r.search+r.hash;r=null;return i},createURL:function e(t,n){var r=document.createElement("a");r.href=n;var i=r.protocol+"//"+t.domain+"."+r.host+"/";r=null;return i},getTeamCardHTML:function e(t,n,r){var i=TS.enterprise.workspaces.createURL(t,n);t.launch_url=i+"messages";t.site_url=i+"home";t.signout_url=TS.enterprise.workspaces.createLogoutURL(t.id,n);var a="enterprise_teams_launch_card";if(r)a="enterprise_teams_launch_card_wrapper";return TS.templates[a]({team:t,user:TS.model.user})},recordPageView:function t(n,r,i){if(!i)i="";var a={tracking_code:i,target_team_id:0};var s={action:"impression"};if(r)s.action_status=1;else s.action_status=2;switch(n){case"teams_on":a.anchor_page="your_workspaces";a.entity_key="your_workspaces_list";break;case"teams_not_on":a.anchor_page="find_workspaces";a.entity_key="workspaces_you_can_join_list"}TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamView:function t(n,r,i){if(!i)i="";var a={entity_key:"workspace_detail",target_team_id:n,tracking_code:i};var s={action:"impression",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamJoin:function t(n,r,i){if(!i)i="";var a={anchor_page:r,entity_key:"join_workspace",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLeave:function t(n,r,i){if(!i)i="";var a={anchor_page:r,entity_key:"leave_workspace",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLeaveConfirm:function t(n,r,i){if(!i)i="";var a={anchor_page:r,entity_key:"leave_workspace_confirm",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamRequestToJoin:function t(n,r,i){if(!i)i="";var a={anchor_page:r,entity_key:"request_to_join_workspace",target_team_id:n,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},showRequestDialog:function e(){var t="#generic_dialog";var n=".dialog_go";var r="enterprise.teams.creationrequests.create";var i="#input_ws_team_name";var a="#textarea_ws_team_message";var s="#ws_request_form";function o(){var e=$(t);var r=e.find(n);var i=TS.ui.validation.validate($(s));if(i){r.removeAttr("disabled");return true}r.attr("disabled",true);return false}TS.generic_dialog.start({title:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Request a new workspace","enterprise_workspaces")():TS.i18n.t("Request a New Team","enterprise_workspaces")(),body:TS.templates.ws_request_dialog(),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Send Request","enterprise_workspaces")(),onGo:function e(){var s=$(t);var o=$(i);var l=o.val();var u=$(a);var d=u.val();var c=s.find(n);c.addClass("ladda-button");c.attr("data-style","expand-right");var m=Ladda.create(c[0]);m.start();var f={name:l,reason:d};if("client"===TS.boot_data.app)f.enterprise_token=TS.model.enterprise_api_token;TS.api.callImmediately(r,f).then(function(){TS.ui.toast.show({type:"success",message:TS.i18n.t("Request to create <b>{team_name}</b> sent! You’ll be notified once it’s reviewed.","enterprise_workspaces")({team_name:_.escape(l)})});TS.generic_dialog.end();TS.generic_dialog.cancel()}).catch(function(e){if(!e||!e.data){TS.error("WTF: error, but no response or data on "+r+"?",e);return}var t=e.data;var n={name_taken:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Request failed: The name <b>{team_name}</b> is already taken by another workspace.","enterprise_workspaces")({team_name:_.escape(l)}):TS.i18n.t("Request failed: The team name <b>{team_name}</b> is already taken.","enterprise_workspaces")({team_name:_.escape(l)}),name_is_empty:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Request failed: A name is required.","enterprise_workspaces")():TS.i18n.t("Request failed: A team name is required.","enterprise_workspaces")(),name_too_long:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Request failed: The name you provided is too long.","enterprise_workspaces")():TS.i18n.t("Request failed: The team name you provided is too long.","enterprise_workspaces")(),reason_too_long:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Request failed: The reason you provided is too long.","enterprise_workspaces")():TS.i18n.t("Team request failed: The reason you provided is too long.","enterprise_workspaces")(),unknown:TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Request failed: The response error was <b>{error_message}</b>.","enterprise_workspaces")({error_message:t.error||"unknown"}):TS.i18n.t("Team request failed: The response error was <b>{error_message}</b>.","enterprise_workspaces")({error_message:t.error||"unknown"})};TS.ui.toast.show({type:"error",message:n[t.error]||n.unknown});TS.error(r+" failed with error: "+(t.error||"undefined"));m.stop()});return false}});$([i,a].join(",")).on("keyup change",o);$(i).focus();$(t).find(n).attr("disabled",true)}});var e="ENTERPRISE_DISCOVER_WORKSPACES";var t=function e(t,n,r){var i=t.parents();var a=i.find('[data-qa="teams_search"]');var s=i.find(".workspace_info");var o=i.find(".more_teams_available");var l=i.find(".title_bar");var u=$(".sort_by_container");var d=u.find('select[data-qa="sort-by-your"]');var c=u.find('select[data-qa="sort-by-find"]');t.off();a.off();s.off();o.off();d.off();c.off();var m=function e(n){return TS.enterprise.workspaces.joinTeam(n).then(function(e){if(e){var i=_.merge({},TS.model.user);i.enterprise_user.teams=_.uniq(i.enterprise_user.teams.concat(n));if("web"===TS.boot_data.app)TS.model.user=i;else TS.members.upsertMember(i);var a=TS.enterprise.getTeamById(n);t.find('[data-id="'+n+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(a,r))}return e})};a.on("input",function(){var i=$(this).val();var a;if("teams_on"===n)a=d.val();else a=c.val();var s=TS.enterprise.workspaces.getList(n,a,i);var o="";if(s.length)s.forEach(function(e){o+=TS.enterprise.workspaces.getTeamCardHTML(e,r,true)});else o+=TS.templates.no_workspace_results();if(TS.boot_data.feature_workspace_request){var l=$("#ws_request_create_link");if(i.length)l.removeClass("hidden");else l.addClass("hidden")}t.html(o).attr("data-list",n);e(t,n,r)});o.on("click",'[data-qa="find-more-teams"]',function(e){e.preventDefault();$('.enterprise_memberdash_header .menu_item_teams[data-qa="find-teams"]').click()});var f=function i(){var s=$(this).val();var o=a.val();var l=TS.enterprise.workspaces.getList(n,s,o);var u="";if(l.length)l.forEach(function(e){u+=TS.enterprise.workspaces.getTeamCardHTML(e,r,true)});else if("teams_on"===n)u+=TS.templates.not_on_any_workspaces();else u+=TS.templates.no_workspaces_to_join();t.html(u).attr("data-list",n);e(t,n,r)};d.on("change",f);c.on("change",f);var p=function e(i,u){if("string"!==typeof i)i=$(this).data("id");t.addClass("hidden");l.addClass("hidden");o.addClass("hidden");a.addClass("hidden").attr("disabled","disabled");s.html(TS.templates.team_info({list:n})).removeClass("hidden").attr("data-team-id",i);if(!u){var d=$("title").text();var c="teams_not_on"===n?"find-teams":"your-teams";window.history.pushState(i,d,"/signin/"+c+"/"+i)}var _={top_combined_channels:5,include_admins:true};var m=[];if(!TS.client)m.push(TS.api.call("users.info",{user:TS.boot_data.user_id}).then(function(e){TS.model.user=e.data.user}));m.push(TS.enterprise.ensureTeamInModel(i,_));return Promise.all(m).then(function(){return TS.enterprise.getTeamById(i)}).then(function(e){if(!e){s.attr("data-team-id","");return}var a=TS.enterprise.workspaces.createURL(e,r);e.launch_url=a+"messages";e.site_url=a+"home";s.html(TS.templates.team_info({list:n,team:e,user:TS.model.user})).attr("data-team-id",i);t.find('[data-id="'+e.id+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,r));var o;var l;if("teams_on"===n){o="your_workspaces";l="your_workspaces_list"}else{o="find_workspaces";l="workspaces_you_can_join_list"}TS.enterprise.workspaces.recordTeamView(e.id,o,l)})};t.on("click",".enterprise_team_card",p);s.on("click",".back_to_teams",function(e){e.preventDefault();window.history.back();t.removeClass("hidden");l.removeClass("hidden");a.removeClass("hidden").removeAttr("disabled");s.addClass("hidden").attr("data-team-id","");if("yes"===o.attr("data-has-more"))o.removeClass("hidden")});$(window).on("popstate",function(e){var n=e.originalEvent.state;if(n&&"T"===n[0]&&9===n.length){var r=true;p(n,r)}else{t.removeClass("hidden");l.removeClass("hidden");a.removeClass("hidden").removeAttr("disabled");s.addClass("hidden").attr("data-team-id","");if("yes"===o.attr("data-has-more"))o.removeClass("hidden")}});s.on("click",'button[data-qa="join-btn"]',function(){var e=Ladda.create(this);e.start();var t=$(this).data("id");var i=TS.enterprise.getTeamById(t);m(t).then(function(t){e.stop();if(t){var a=TS.enterprise.workspaces.createURL(i,r);i.launch_url=a+"messages";i.site_url=a+"home";s.html(TS.templates.team_info({list:n,team:i,user:TS.model.user}));var o;var l="workspace_detail";if("teams_on"===n)o="your_workspaces";else o="find_workspaces";TS.enterprise.workspaces.recordTeamJoin(i.id,o,l)}return t})});s.on("click",'[data-qa="leave-btn"]',function(e){e.preventDefault();var t=$(this).data("id");TS.ui.leave_team_dialog.start(t)});s.on("click",'button[data-qa="request-to-join-btn"]',function(e){e.preventDefault();var i=Ladda.create(this);i.start();var a=$(this).data("id");TS.enterprise.workspaces.requestToJoinTeam(a).then(function(){var e=TS.enterprise.getTeamById(a);t.find('[data-id="'+a+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,r));i.stop();var o=TS.enterprise.workspaces.createURL(e,r);e.launch_url=o+"messages";e.site_url=o+"home";s.html(TS.templates.team_info({list:n,team:e,user:TS.model.user}));var l;var u="workspace_detail";if("teams_on"===n)l="your_workspaces";else l="find_workspaces";TS.enterprise.workspaces.recordTeamRequestToJoin(e.id,l,u)}).catch(function(){i.stop()})});t.on("click",".enterprise_team_card a",function(e){e.stopPropagation()});var h=function e(t){if(TS.model.is_our_app){t.preventDefault();t.stopPropagation();var n=$(this).data("id");var r=_.map(TS.model.user.enterprise_user.teams,function(e){var t=TS.enterprise.getTeamById(e);return{name:TS.model.user.name,id:TS.model.user.id,team_id:t.id,team_name:t.name,team_url:TS.utility.enterprise.buildTeamUrl(t.domain)}}).sort(function(e,t){if(e.id===n)return-1;if(t.id===n)return 1;if(e.team_name<t.team_name)return-1;if(e.team_name>t.team_name)return 1;return 0});var i=true;TSSSB.call("didSignIn",r,i)}};t.on("click",".enterprise_team_card [data-name=launch_team_button]",h);s.on("click","[data-name=launch_team_button]",h);t.on("click",".enterprise_team_card .enterprise_team_menu",function(e){e.stopPropagation();var t=$(this).val();var r=$(this).data("id");var i=TS.enterprise.getTeamById(r);TS.menu.enterprise_team_signin.start(e,$(this),{list:n,team_id:r,team_site_url:t,should_show_leave_team:TS.permissions.enterprise.canUserLeaveTeam(TS.model.user,i)})});t.on("click",".enterprise_team_card .enterprise_team_join",function(e){e.stopPropagation();var t=Ladda.create(this);t.start();var r=$(this).data("id");m(r).then(function(e){t.stop();if(e){var i;var a;if("teams_on"===n){i="your_workspaces";a="your_workspaces_list"}else{i="find_workspaces";a="workspaces_you_can_join_list"}TS.enterprise.workspaces.recordTeamJoin(r,i,a)}})});t.on("click",".enterprise_team_card .enterprise_team_request",function(e){e.stopPropagation();var n=Ladda.create(this);n.start();var i=$(this).data("id");TS.enterprise.workspaces.requestToJoinTeam(i).then(function(){var e=TS.enterprise.getTeamById(i);n.stop();t.find('[data-id="'+i+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,r))}).catch(function(){n.stop()})});t.find(".not_on_any_workspaces").on("click",".find_teams",function(e){e.preventDefault();TS.enterprise.member_header.setPage("teams_not_on");TS.enterprise.signin.loadPage("teams_not_on")})};var n=function e(t,n){TS.ui.toast.show({type:t,message:n})}})()},4280:function(e,t){(function(){"use strict";TS.registerModule("help",{issues_sorted_sig:new signals.Signal,issues:[],more_url:null,fake_api_rsps:false,max_title_chars:100,onStart:function e(){if(!TS.client)return;var t=function e(){TS.api.call("help.issues.list",{},TS.help.onListIssues)};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(t);else TS.ms.connected_sig.addOnce(t)},getIssueById:function e(t){var n;for(var r=0;r<TS.help.issues.length;r+=1){n=TS.help.issues[r];if(n.id==t)return n}return null},onListIssues:function e(t,n){if(TS.help.fake_api_rsps){TS.help.more_url="/help";TS.help.issues=[{id:"T00001",title:"issue 1",ts:"1111111111",short_text:"blah blah blah blah blah",state:"resolved"},{id:"T00002",title:"issue 2",ts:"1141111111",short_text:"I think this is ok",state:"open"},{id:"T00003",title:"issue 3",ts:"1121111111",short_text:"but I am not so sure abotu this",state:"unread"},{id:"T00004",title:"issue 4",ts:"1161111111",short_text:"what about that?",state:"open"},{id:"T00005",title:"issue 5",ts:"1151111111",short_text:"fuck it all to hell",state:"open"},{id:"T00006",title:"issue 6",ts:"1171111111",short_text:"MORE BATTRY PLZ",state:"read"},{id:"T00007",title:"issue 7",ts:"1191111111",short_text:"halp",state:"unread"},{id:"T00008",title:"issue 8",ts:"191111111",short_text:"halp",state:"unread"},{id:"T00009",title:"issue 9",ts:"181111111",short_text:"halp",state:"unread"},{id:"T000010",title:"issue 10",ts:"171111111",short_text:"halp halp halp halp halp halp halp halp halp halp ...",state:"unread"}]}else if(t)TS.help.issues=n.issues;TS.help.sortIssues();TS.help.updateIcon()},sortIssues:function e(){var t={unread:4,open:3,read:2,resolved:1};var n;for(var r=0;r<TS.help.issues.length;r+=1){n=TS.help.issues[r];n._sorter=parseFloat((t[n.state]||5)+"."+n.ts)}TS.help.issues.sort(function e(t,n){if(t._sorter<n._sorter)return 1;if(t._sorter>n._sorter)return-1;return 0});TS.help.issues_sorted_sig.dispatch()},updateIcon:function e(){var t="normal";var n=0;var r;for(var i=0;i<TS.help.issues.length;i+=1){r=TS.help.issues[i];if("unread"===r.state){t="unread";n+=1}}$("#flex_menu_toggle").removeClass("normal open unread").addClass(t);$("#help_icon_circle_count, .help_icon_circle_count").addClass("hidden");if(n>9)n="9+";if(n)$("#help_icon_circle_count, .help_icon_circle_count").removeClass("hidden").text(n)},createIssue:function e(t,n){var r=t.title;var i=t.text;if(!r)return;i=i||"";var a={title:r,text:i};if(t.tags)a.tags=t.tags;TS.api.call("help.issues.create",a,function(e,t){if(!e&&TS.help.fake_api_rsps){var a={id:Date.now(),title:r,ts:Date.now()/1e3,short_text:i.substr(0,50),state:"open"};setTimeout(function(){TS.ms.msg_handlers.msgReceived({type:"issue_created",issue:a})},2e3)}if(n)n(e,TS.help.makeErrStr(t))})},fetchIssueDetails:function e(t,n){var r=TS.help.getIssueById(t);if(!r){if(n)n(false,r,"unknown issue");return}TS.api.call("help.issues.info",{id:t},function(e,t){var i;if(TS.help.fake_api_rsps){e=true;i=_.cloneDeep(r);i.comments=[{ts:112211111,from:"eeric",text:"comment 1"},{ts:112214444,from:"whoop",text:"comment 2"}]}else if(e)i=t.issue;TS.help.onIssueChange(i);if(n)n(e,r,TS.help.makeErrStr(t))})},markIssueRead:function e(t,n){var r=TS.help.getIssueById(t);if(!r){if(n)n(false,"unknown issue");return}if("unread"!==r.state){if(n)n(true);return}TS.api.call("help.issues.markRead",{id:t},function(e,t){if(!e&&TS.help.fake_api_rsps){var i=_.cloneDeep(r);i.state="read";setTimeout(function(){TS.ms.msg_handlers.msgReceived({type:"issue_change",issue:i})},2e3)}if(n)n(e,TS.help.makeErrStr(t))})},replyToIssue:function e(t,n,r){TS.api.call("help.issues.replyTo",{id:t,text:n},function(e,t){if(r)r(e,TS.help.makeErrStr(t),t&&t.error?t.error:"")})},markIssueResolved:function e(t,n){var r=TS.help.getIssueById(t);if(!r){if(n)n(false,"unknown issue");return}TS.api.call("help.issues.markResolved",{id:t},function(e,t){if(TS.help.fake_api_rsps||!e&&t&&"ticket_closed"===t.error){e=true;var i=_.cloneDeep(r);i.state="resolved";setTimeout(function(){TS.ms.msg_handlers.msgReceived({type:"issue_change",issue:i})},1e3)}if(n)n(e,TS.help.makeErrStr(t))})},onIssueChange:function e(t){var n=TS.help.getIssueById(t.id);if(n)TS.help.updateIssue(t,n);else TS.help.issues.push(t);TS.help.sortIssues();TS.help.updateIcon()},updateIssue:function e(t,n){_.forOwn(t,function(e,t){n[t]=e});if(n.comments)n.comments.sort(function e(t,n){if(t.ts<n.ts)return 1;if(t.ts>n.ts)return-1;return 0})},makeErrStr:function e(t){if(!t)return"missing data";if(t.ok)return null;if(t.error&&t.info&&TS.boot_data.feature_tinyspeck)try{return'api error: "'+t.error+'"<br><br><div class="admin-section" style="word-wrap: break-word; word-break: break-word;">api rsp: '+JSON.stringify(t).replace(/,/g,", ")+"</div>"}catch(e){}if(t.error)return'api error: "'+t.error+'"'}})})()},4281:function(e,t){(function(){"use strict";TS.registerModule("ui.share_dialog",{div:null,showing:false,delegate:void 0,onStart:function e(){TS.files.team_file_changed_sig.add(r);TS.files.team_file_comment_added_sig.add(i);TS.files.team_file_comment_deleted_sig.add(i)},onKeydown:function e(t){if(!TS.ui.share_dialog.showing)return;if(t.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")){TS.ui.share_dialog.go();t.preventDefault()}}else if(t.which==TS.utility.keymap.esc)if("BODY"===TS.utility.getActiveElementProp("NODENAME"))TS.ui.share_dialog.cancel()},start:function e(r,i,a,s,o,l){if(TS.client&&TS.client.ui.checkForEditing())return;n=false;t=r;var u=TS.files.getFileById(r);var d="file";if("post"===u.mode)d="file_post";else if("space"===u.mode)d="file_space";else if("snippet"===u.mode)d="file_snippet";else if("arugula"===u.mode)d="file_arugula";var c=TS.templates.builders.buildFileSharingControls(u,true,null,a);var _=i?"":TS.templates.builders.fileHTML(u,{for_share_dialog:true});var m={type:d,item:u,item_owner:TS.members.getMemberById(u.user),sharing_html:new Handlebars.SafeString(c),file_html:new Handlebars.SafeString(_),show_copy_link:u.permalink&&TS.clipboard.canWriteText()};m.icon_class=TS.utility.getImageIconClass(u,"thumb_80");if(!TS.ui.share_dialog.div)TS.ui.share_dialog.build();var f=TS.templates.share_dialog(m);f=TS.format.replaceHighlightMarkers(f);var p=TS.ui.share_dialog.div;p.html(f);var h=$("#file_comment_textarea");TS.ui.comments.bindInput(h,TS.ui.share_dialog.go);if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())h.autogrow();if(o)TS.utility.contenteditable.value(h,o);h=null;p.modal("show");p.find(".dialog_cancel").click(TS.ui.share_dialog.cancel);p.find(".dialog_go").click(TS.ui.share_dialog.go);TS.ui.file_share.bindFileShareDropdowns(false,{id:s},void 0,l);TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField()},go:function e(){if(n){TS.info("TS.ui.share_dialog stopping because already sharing");return}if(!TS.ui.share_dialog.showing){TS.error("not showing?");return}var r=$("#select_share_channels").lazyFilterSelect("value")[0];var i=_.trim(TS.format.cleanMsg(TS.utility.contenteditable.value($("#file_comment_textarea"))));var a=function e(){TS.shared.getShareModelObId(l,function(e){var n=false;TS.files.shareFile(t,e,i,n).then(function(){t=null;if(!TS.client)return;var n=TS.shared.getModelObById(e);if(!n)return;var r=TS.shared.getActiveModelOb();if(r&&r.id===n.id)TS.client.ui.instaScrollMsgsToBottom();else return TS.client.displayModelOb(n)})})};if(r&&r.model_ob&&r.model_ob.create_channel){var s=t;TS.ui.new_channel_modal.start(r.model_ob.name).then(function(e){t=s;l=e.id;a();return null}).catch(function(){TS.ui.share_dialog.start(s,false,false,false,i);return null});TS.ui.share_dialog.cancel();return false}if(TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var o=$("#share_dialog");var l=o.find("#share_model_ob_id").val();if(!l)if(r)l=r.model_ob.id;if(!l){TS.warn("model_ob_id is not set! "+$("#select_share_channels").val());return}if(TS.ui.share_dialog.delegate&&"function"===typeof TS.ui.share_dialog.delegate.submit)TS.ui.share_dialog.delegate.submit(o,a);else a();n=true;TS.ui.share_dialog.div.modal("hide")},cancel:function e(){t=null;TS.ui.share_dialog.div.modal("hide")},end:function t(){if(e&&e.detachEvents)e.detachEvents();e=null;TS.model.dialog_is_showing=false;TS.ui.share_dialog.showing=false;TS.ui.comments.unbindInput($("#file_comment_textarea"));TS.ui.share_dialog.div.empty();$(window.document).unbind("keydown",TS.ui.share_dialog.onKeydown)},build:function t(){$("body").append('<div id="share_dialog" class="modal hide fade"></div>');TS.ui.share_dialog.div=$("#share_dialog");var n=TS.ui.share_dialog.div;n.on("hidden",function(e){if(e.target!=this)return;TS.ui.share_dialog.end()});n.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.share_dialog.showing=true});n.on("shown",function(t){if(t.target!=this)return;var n=$("#select_share_channels").lazyFilterSelect("value");if(n.length<1)$("#select_share_channels").lazyFilterSelect("getInstance").$input.focus();else TS.utility.contenteditable.focus($("#file_comment_textarea"));$(window.document).bind("keydown",TS.ui.share_dialog.onKeydown);e=TS.ui.share_dialog.div.find("img.lazy").lazyload()})}});var e=null;var t;var n=false;var r=function e(n){if(TS.ui.share_dialog.showing&&t===n.id){a(n);s(n)}};var i=function e(n){if(TS.ui.share_dialog.showing&&t===n.id)s(n)};var a=function e(t){TS.templates.builders.updateFileShareLabels(t);$("#select_share_at_channel_list").html(TS.templates.builders.makeFileCommentHelpHTML(t))};var s=function e(t){var n=TS.templates.makeFileDomId(t);$("#"+n).replaceWith(TS.templates.builders.fileHTML(t,{for_share_dialog:true}));var r=$("#"+n).find("img.lazy");r.removeClass("lazy").attr("src",r.attr("data-original"))}})()},4282:function(e,t){(function(){"use strict";TS.registerModule("pins",{pins_fetched_sig:new signals.Signal,pinned_status_changed_sig:new signals.Signal,pinned_message_changed_sig:new signals.Signal,pinned_message_deleted_sig:new signals.Signal,onStart:function e(){TS.files.team_file_comment_deleted_sig.add(f);TS.files.team_file_deleted_sig.add(p);if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(h);else TS.ms.connected_sig.add(h);TS.channels.left_sig.add(g);TS.groups.left_sig.add(g)},fetchPins:function n(r){if(!r)return;t[r.id]=true;if(TS.isPartiallyBooted())return new Promise(function(e){var t=function t(){e(TS.pins.fetchPins(r))};if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.addOnce(t);else TS.ms.connected_sig.addOnce(t)});return TS.api.call("pins.list",{channel:r.id}).then(function(t){var n=t.data.items;TS.pins.upsertPinnedItems(n);r.pinned_items=n;r.pinned_items_count=n.length;r.has_pins=!!r.pinned_items_count;if(!r.is_channel||r.is_member)e[r.id]=true;TS.pins.pins_fetched_sig.dispatch(r,n)}).catch(function(e){TS.logError("Failed to fetch pins for model ob: "+r.id,e)}).finally(function(){delete t[r.id]})},arePinsCurrentlyBeingFetched:function e(n){return!!t[n.id]},havePinsBeenFetched:function t(n){return!!e[n.id]},startPinFile:function e(t,n){var r=TS.files.getFileById(t);if(!r)return;l("file",n,{file:r,type:"file"})},unPinFile:function e(t,n){var i=r(t,n);if(!i)return;var a={file:i,type:"file"};m(a,n,function(){d(n,a)})},startPinFileComment:function e(t,n,r){var i=TS.files.getFileById(n);if(!i)return;var a=TS.files.getFileCommentById(i,t);if(!a)return;l("comment",r,{file:i,comment:a,type:"file_comment"})},unPinFileComment:function e(t,n,r){var a=i(t,n,r);var s=TS.files.getFileById(n);if(!a||!s)return;var o={file:s,comment:a,type:"file_comment"};m(o,r,function(){d(r,o)})},startPinMessage:function e(t,n){t=t.toString();var r=TS.utility.msgs.findMsg(t,n.id);if(r)if("file_comment"===r.subtype)TS.pins.startPinFileComment(r.comment.id,r.file.id,n);else if(r.file)TS.pins.startPinFile(r.file.id,n);else l("message",n,{message:r,type:"message"})},unPinMessage:function e(t,n){t=t.toString();var r=a(t,n);if(r)if("file_comment"===r.subtype)TS.pins.unPinFileComment(r.comment.id,r.file.id,n);else if(r.file)TS.pins.unPinFile(r.file.id,n);else{var i={message:r,type:"message"};m(i,n,function(){d(n,i)})}},isMessagePinned:function e(t,n){if("file_comment"===t.subtype){if(!t.comment)return false;return!!i(t.comment.id,t.file.id,n)}else if(t.file)return!!r(t.file.id,n);return!!a(t.ts,n)},pinStatusHasChanged:function e(t,n,r,i,a){var l;var u;var d;var c;var _;var m;if("message"===r&&i){l=TS.utility.msgs.findMsg(n.message.ts,i.id);if(l){n.message=l;c=s(t,l,i)}}else if("file_comment"===r){m=TS.files.upsertFile(n.file);u=TS.files.getFileById(n.file.id);n.file=u;d=TS.files.getFileCommentById(u,n.comment.id);if(d){n.comment=d;c=s(t,d,i)}else{d=TS.files.addCommentToFile(n.comment,u);n.comment=d}c=c||"CHANGED"===m.status}else if("file"===r){m=TS.files.upsertFile(n.file);u=TS.files.getFileById(n.file.id);n.file=u;c=s(t,u,i);c=c||"CHANGED"===m.status}_=o(t,n,r,i,a);if(c||_)TS.pins.pinned_status_changed_sig.dispatch(i,n,t)},upsertPinnedItems:function e(t){t.forEach(function(e){if("file"===e.type){TS.files.upsertFile(e.file);e.file=TS.files.getFileById(e.file.id)}else if("file_comment"===e.type){TS.files.upsertFile(e.file);e.file=TS.files.getFileById(e.file.id);var t=TS.files.getFileCommentById(e.file,e.comment.id);if(!t)t=TS.files.addCommentToFile(e.comment,e.file);e.comment=t}})},replaceMsg:function e(t,n){if(!n.pinned_items)return;n.pinned_items.forEach(function(e){if("message"===e.type&&e.message.ts===t.ts){e.message=t;TS.pins.pinned_message_changed_sig.dispatch(n,e)}})},removeMsg:function e(t,n){if(!n.pinned_items)return;o(false,{message:{ts:t}},"message",n);TS.pins.pinned_message_deleted_sig.dispatch(n)},canUserPinHere:function e(t){if(!TS.client||!t)return false;if(!TS.permissions.members.canPostInChannel(t))return false;if(t.is_channel&&!t.is_member)return false;return true},updateCount:function e(t,n){if(!t)return;var r=t.pinned_items_count;t.pinned_items_count=TS.pins.havePinsBeenFetched(t)?_.get(t,"pinned_items.length"):n;if(r===t.pinned_items_count)return;t.has_pins=!!t.pinned_items_count;TS.pins.pinned_status_changed_sig.dispatch(t)},getPinData:function e(t){var n;var r=TS.shared.getActiveModelOb().pinned_items;if(_.isEmpty(r))return;_.forEach(r,function(e){if("file"===e.type&&("file_share"===t.subtype||"file_mention"===t.subtype)){if(t.file.id===e.file.id){n=e;return false}}else if("file_comment"===e.type&&"file_comment"===t.subtype){if(t.comment.id===e.comment.id){n=e;return false}}else if("message"===e.type)if(t.ts===e.message.ts){n=e;return false}});if(!n)return;var i={created:n.created,created_by:n.created_by};return i},getUnreadPins:function e(t){var n;var r=[];if(!t)return r;var i=t._marked_reason;if("0000000000.000000"===t.last_read&&"back"!==i)return r;if(TS.model.ui.is_window_focused)if("back"===i){var a=TS.utility.msgs.getDisplayedMsgAfterTS(t.last_read,t.msgs);if(a)n=parseFloat(a.ts)-1;else n=t.last_read}else if(t._prev_last_read&&(!i||"viewed"===i))n=t._prev_last_read;else n=t.last_read;else n=t.last_read;var s=t.pinned_items;if(_.isEmpty(s))return r;_.forEach(s,function(e){var t=TS.members.getMemberById(e.created_by);if(!t)return;if(e.created>Math.ceil(n))if(t.is_self&&"back"===i)r.push(e);else if(!t.is_self)r.push(e)});return r},test:function t(){return{fileDeleted:p,fileCommentDeleted:f,have_pins_been_fetched:e}}});var e={};var t={};var n=false;var r=function e(t,n){var r=TS.files.getFileById(t);if(!r||!r.pinned_to)return null;var i=-1!==r.pinned_to.indexOf(n.id);return i?r:null};var i=function e(t,n,r){var i=TS.files.getFileById(n);if(!i)return null;var a=TS.files.getFileCommentById(i,t);if(!a||!a.pinned_to)return null;var s=-1!==a.pinned_to.indexOf(r.id);return s?a:null};var a=function e(t,n){if(n.pinned_items){var a;for(var s=0;s<n.pinned_items.length;s+=1){a=n.pinned_items[s];if("message"===a.type&&a.message.ts===t)return a.message}}var o=TS.utility.msgs.findMsg(t,n.id);if(!o)return null;if("file_comment"===o.subtype){if(i(o.comment.id,o.file.id,n))return o}else if(o.file){if(r(o.file.id,n))return o}else if(o.pinned_to&&-1!==o.pinned_to.indexOf(n.id))return o;return null};var s=function e(t,n,r){var i=false;if(!n.pinned_to)n.pinned_to=[];if(t){if(-1===n.pinned_to.indexOf(r.id)){n.pinned_to.push(r.id);i=true}}else{var a=n.pinned_to.indexOf(r.id);if(-1!==a){n.pinned_to.splice(a,1);i=true}}return i};var o=function e(t,n,r,i,a){var s=false;if(!i.pinned_items)i.pinned_items=[];var o=-1;i.pinned_items.some(function(e,t){var i=false;if("message"===r&&"message"===e.type){if(e.message.ts===n.message.ts)i=true}else if("file"===r&&"file"===e.type){if(e.file.id===n.file.id)i=true}else if("file_comment"===r&&"file_comment"===e.type)if(e.comment.id===n.comment.id)i=true;if(i)o=t;return i});if(!TS.pins.havePinsBeenFetched(i)){i.pinned_items_count=i.pinned_items_count||0;var l=_.parseInt(a,10);if(!_.isNaN(l))i.pinned_items_count=l;else if(t)i.pinned_items_count+=1;else if(!t)i.pinned_items_count=Math.max(i.pinned_items_count-1,0);s=true}else if(!t&&-1!==o){i.pinned_items.splice(o,1);i.pinned_items_count=i.pinned_items.length;s=true}else if(t&&-1===o){i.pinned_items.unshift(n);i.pinned_items_count=i.pinned_items.length;s=true}i.has_pins=!!i.pinned_items_count;return s};var l=function e(t,n,r){var i="";var a="";var s="";switch(t){case"file":i=TS.i18n.t("Are you sure you want to pin this file to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.i18n.t("Pin file","pins")();s=TS.i18n.t("Yes, pin this file","pins")();break;case"comment":i=TS.i18n.t("Are you sure you want to pin this comment to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.i18n.t("Pin comment","pins")();s=TS.i18n.t("Yes, pin this comment","pins")();break;case"message":i=TS.i18n.t("Are you sure you want to pin this message to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(n)});a=TS.i18n.t("Pin message","pins")();s=TS.i18n.t("Yes, pin this message","pins")()}var o="<p>"+i+"</p>"+TS.client.channel_page.pinnedItemHtml(r,n);TS.generic_dialog.start({title:a,body:o,go_button_text:s,onGo:function e(){u(n,r)}})};var u=function e(t,n){var r=c(t,n);var i=TS.interop.datetime.makeTsStamp(null,{padder:"0"});TS.api.call("pins.add",r,function(e,r){if(!e){if("too_many_pins"===r.error){var a="message";if("file"===n.type)a="file";if("file_comment"===n.type)a="comment";TS.generic_dialog.start({title:TS.i18n.t("Couldn’t pin {type}","pins")({type:a}),body:"<p>"+TS.i18n.t("Sorry! You’ve hit the limit on how many pins you can have in this channel.","pins")()+"</p>",show_cancel_button:false})}else TS.info("pins.add got a not ok rsp: "+r.error);if("already_pinned"!==r.error)return}if(!TS.pins.havePinsBeenFetched(t))return;n.created=i;n.created_by=TS.boot_data.user_id;TS.pins.pinStatusHasChanged(true,n,n.type,t)})};var d=function e(t,n){var r=c(t,n);TS.api.call("pins.remove",r,function(e,r){if(!e)if("not_pinned"!==r.error)return;if(!TS.pins.havePinsBeenFetched(t))return;TS.pins.pinStatusHasChanged(false,n,n.type,t)})};var c=function e(t,n){var r={channel:t.id};if("message"===n.type)r.timestamp=n.message.ts;else if("file"===n.type)r.file=n.file.id;else if("file_comment"===n.type)r.file_comment=n.comment.id;return r};var m=function e(t,n,r){TS.client.channel_page.highlightPinnedItemForRemoval(t);var i=TS.client.channel_page.pinnedItemHtml(t,n);TS.generic_dialog.start({title:TS.i18n.t("Remove Pinned Item","pins")(),body:"<p>"+TS.i18n.t("Are you sure you want to remove this pinned item?","pins")()+"</p>"+i,go_button_text:TS.i18n.t("Yes, remove this pinned item","pins")(),onGo:r,onCancel:function e(){TS.client.channel_page.unHighlightPinnedItemForRemoval(t)}})};var f=function e(t,n,r){if(!r||!r.pinned_to)return;r.pinned_to.forEach(function(e){var t=TS.shared.getModelObById(e);if(!t)return;var n=o(false,{comment:r},"file_comment",t);if(n)TS.pins.pinned_status_changed_sig.dispatch(t)})};var p=function e(t){if(!t)return;if(t.pinned_to)t.pinned_to.forEach(function(e){var n=TS.shared.getModelObById(e);if(!n)return;var r=o(false,{file:t},"file",n);if(r)TS.pins.pinned_status_changed_sig.dispatch(n)});if(t.comments)t.comments.forEach(function(e){f(t,e.id,e)})};var h=function r(){if(n){e={};t={}}else n=true};var g=function n(){var r=TS.shared.getActiveModelOb();delete e[r.id];delete t[r.id]}})()},4284:function(e,t){(function(){"use strict";TS.registerModule("inline_file_previews",{expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){_();this.collapse_sig.add(a);this.expand_sig.add(s);$("#messages_container").on("keydown",".preview_show_more .preview_show_btn",i);$("#messages_container").on("keydown",".preview_show_less .preview_show_btn",i)},checkForInlineFilePreviewClick:function e(t){var n=$(t.target);var i;var a=n.closest(".message");if(0===a.length)return;if(n.hasClass("service_link")||n.closest(".service_link")>0)return;var s=a.attr("id");var u=n.closest(".msg_inline_file_preview_toggler");if(u.length>0){t.preventDefault();i=u.data("file-id");if(u.hasClass("collapsed"))r(s,i);else o(s,i);return true}var c=n.closest(".inline_file_preview_container, .file_container");if(0===c.length)return;var _=n.closest("ts-message");var m=""+_.data("ts");var f=_.data("model-ob-id");var p={message_timestamp:m,channel_id:f,channel_type:f?f.charAt(0):"",member_id:_.data("member-id"),app_id:_.data("app-id"),bot_id:_.data("bot-id")};if(n.closest(".preview_show.preview_show_more").length>0){t.preventDefault();l(t,a,c);TS.clog.track("PREVIEW_EXPAND",p);return true}if(n.closest(".preview_show.preview_show_less .preview_show_btn, .preview_show_less_header").length>0){t.preventDefault();d(t,a,c);TS.clog.track("PREVIEW_COLLAPSE",p);return true}if(n.closest("a").length)return false;i=c.data("file-id");var h=TS.files.getFileById(i);if(!h)return false;if("space"===h.mode||"post"===h.mode||"arugula"===h.mode||"email"===h.mode||"snippet"===h.mode)if(c.hasClass("inline_collapsed")){t.preventDefault();l(t,a,c);return true}return false},shouldTruncate:function e(t){if(!t)return false;if("snippet"===t.mode){if(t.lines_more>0||t.preview_is_truncated)return true}else if("post"===t.mode||"space"===t.mode){if(!t.preview)return false;if(t.preview.length>=400)return true;if(t.preview.split(" ").length>=50)return true;if(t.preview.split("\n").length>=4)return true;var n=t.preview.match(/<\/(?:h\d|p|li|pre|blockquote)>/g)||[];var r=t.preview.match(/<hr>/g)||[];var i=n.concat(r);if(i.length>=4)return true}else if("email"===t.mode)return true;return false},isTruncated:function t(n,r){if(!r)return false;return!e[n+"_"+r.id]},expandableState:function e(t,n){if(TS.model.expandable_state["inline_file_"+t+n])return true;if(false===TS.model.expandable_state["inline_file_"+t+n])return false},shouldExpand:function e(t,n){var r=TS.inline_file_previews.expandableState(t,n);if("boolean"===typeof r)return r;return true},expandAllInCurrent:function e(){t=true;$(".msg_inline_file_preview_toggler").each(function(e,t){var n=$(t);var i=n.data("file-id");var a=n.closest(".message").attr("id");r(a,i)});t=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_file_preview_toggler").each(function(e,t){var n=$(t);var r=n.data("file-id");var i=n.closest(".message").attr("id");o(i,r)})},test:function e(){return{actuallyExpandContent:u}}});var e={};var t=false;var n=false;var r=function e(n,r){TS.model.expandable_state["inline_file_"+n+r]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var i="#"+TS.utility.makeSafeForDomId(n);var a=$(i);if(!a.length)return;var s=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var o=function e(){return $(this).data("file-id")==r};var l=a.find(".inline_file_preview_container, .file_container").filter(o);a.find(".msg_inline_file_title_hider").filter(o).addClass("hidden");a.find('.msg_inline_file_preview_toggler[data-file-id="'+r+'"]').removeClass("collapsed").addClass("expanded");l.removeClass("hidden");if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere();l.css("opacity",0).stop().animate({opacity:1},300);if(!t)if(TS.client&&s){TS.client.ui.instaScrollMsgsToBottom(false);l.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"})}else l.scrollintoview({duration:200,offset:"bottom",px_offset:0,direction:"y"});TS.inline_file_previews.expand_sig.dispatch(n);if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(a)};var i=function e(t){if(13==t.which||32==t.which)n=true};var a=function e(){if(n)$(".preview_show_more .preview_show_btn").focus().addClass("focus-ring");n=false};var s=function e(){if(n)$(".preview_show_less .preview_show_btn").focus().addClass("focus-ring");n=false};var o=function e(t,n){TS.model.expandable_state["inline_file_"+t+n]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var r="#"+TS.utility.makeSafeForDomId(t);var i=$(r);if(!i.length)return;var a=function e(){return $(this).data("file-id")==n};var s=i.find(".inline_file_preview_container, .file_container").filter(a);i.find(".msg_inline_file_title_hider").filter(a).removeClass("hidden");i.find('.msg_inline_file_preview_toggler[data-file-id="'+n+'"]').removeClass("expanded").addClass("collapsed");s.addClass("hidden");TS.inline_file_previews.collapse_sig.dispatch(t);setTimeout(function(){if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(i)},0)};var l=function e(t,n,r){var i=r.data("file-id");var a=TS.files.getFileById(i);if(!a)return;if("post"===a.mode||"space"===a.mode||"snippet"===a.mode){var s=r.find(".preview_show_more .preview_show_btn");s.data("stashed_text",s.html()).empty();var o=new Spinner({lines:9,length:0,width:4,radius:5,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:25,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"-8px",left:"-4px",opacity:.1});o.spin(s.get(0));r.addClass("loading");TS.files.fetchFileInfo(i,function(e,t){o.stop();s.html(s.data("stashed_text"));r.removeClass("loading");if(t.content_html||t.content_highlight_html)u(n,t);TS.utility.welcome_post.clogWelcomePostExpand(t)})}else if("email"===a.mode)if(a.simplified_html)u(n,a);else{n.find(".email_content").addClass("loading");var l=setTimeout(function(){n.find(".inline_file_preview_container, .file_container").addClass("expanded")},1e3);TS.files.fetchFileInfo(i,function(e,t){clearTimeout(l);u(n,t);n.find(".email_content").removeClass("loading")})}};var u=function t(n,r){var i=n.attr("id");var a=i+"_"+r.id;e[a]=true;n.find(".inline_file_preview_container, .file_container").removeClass("inline_collapsed").addClass("inline_expanded");TS.inline_file_previews.expand_sig.dispatch(n);if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(n)};var d=function n(r,i,a){var s=i.attr("id");var o=a.data("file-id");var l=TS.files.getFileById(o);if(!l)return;var u=s+"_"+o;delete e[u];i.find(".inline_file_preview_container, .file_container").removeClass("inline_expanded").addClass("inline_collapsed");if(!t){var d=i[0].getBoundingClientRect();if(d.top<0)i.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"})}TS.inline_file_previews.collapse_sig.dispatch(i);if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(i)};var c;var _=function e(){if(c)clearInterval(c);var t=function e(){var t=$("#msgs_div .file_time_ago");var n=[];t.each(function(){var e=$(this).data("file-id");var t=TS.files.getFileById(e);if(!t){n.push($(this).text());return}n.push(TS.interop.datetime.toTimeAgo(t.updated));t=null});t.each(function(e,t){$(t).text(n[e]);t=null});t=null};t=TS.utility.throttleFunc(t,5e3);c=setInterval(t,6e4)}})()},4285:function(e,t){(function(){"use strict";TS.registerModule("rxns",{rxn_records_changed_sig:new signals.Signal,member_rxns_fetched_sig:new signals.Signal,member_rxns_being_fetched_sig:new signals.Signal,need_alerts:{},onStart:function e(){if(!TS.client)return;TS.prefs.preferred_skin_tone_changed_sig.add(I);TS.prefs.emoji_mode_changed_sig.add(I);x=function e(){};var t=function e(){};TS.client.login_sig.add(function(){x=TS.utility.throttleFunc(k,100);t=TS.utility.throttleFunc(o,1e3)});l=function e(n,r){t(n,void 0,void 0,r)}},upsertRxnsFromDataAndUpdateUI:function e(t,n){var r=m(t,n);if("NOOP"!==r.status)l(t);return r},getRxnKey:function e(t,n,r){if("message"===t&&!r)TS.error("getRxnKey: no c_id provided for message rxn_key");if("message"!==t&&r)TS.error("getRxnKey: c_id provided for but this is not a message rxn_key");return t+"-"+n+"-"+(r||"")},getRxnKeyByMsgType:function e(t){var n;if("file_upload"===t.subtype||"file_share"===t.subtype||"file_mention"===t.subtype||"file_reaction"===t.subtype){if(t.file)n=t.file._rxn_key}else if("file_comment"===t.subtype){if(t.comment)n=t.comment._rxn_key}else n=t._rxn_key;return n},getRxnKeyFromData:function e(t){var n;if("message"===t.type)n=t.ts||t.message.ts;else if("file"===t.type)n=t.file.id||t.file;else if("file_comment"===t.type)n=t.file_comment||t.comment.id;else throw new Error("item.type not handled");return TS.rxns.getRxnKey(t.type,n,t.channel)},getExistingRxnsByKey:function e(t){return i[t]||null},getRxnRecordByKey:function e(t){if(r[t])return r[t];for(var i=n.length-1;i>-1;i-=1)if(n[i].rxn_key===t){r[t]=n[i];return r[t]}return null},getNextRxnRecordThatNeedsAlert:function e(){var t;for(var r=n.length-1;r>-1;r-=1)if(TS.rxns.need_alerts[n[r].rxn_key])t=n[r];else break;return t},getRxnsFromData:function e(t){if("message"===t.type)return t.message&&t.message.reactions;if("file"===t.type)return t.file&&t.file.reactions;if("file_comment"===t.type)return t.comment&&t.comment.reactions;return null},doesRxnsHaveRxnFromMember:function e(t,n,r){var i=TS.emoji.nameToCanonicalName(n);if(!t)return false;var a=TS.rxns.getRxnFromRxns(t,n)||TS.rxns.getRxnFromRxns(t,i);if(!a)return false;if(!a.count)return false;if(!a.users)return false;return-1!==a.users.indexOf(r)},doesRxnsHaveRxnFromUser:function e(t,n){return TS.rxns.doesRxnsHaveRxnFromMember(t,n,TS.model.user.id)},doesRxnsHaveRxn:function e(t,n){if(!t)return false;return!!TS.rxns.getRxnFromRxns(t,n)},doesRxnsHaveSkinlessRxn:function e(t,n){if(!t)return false;var r=[n.replace(/(::skin-tone-[2-6])/,"")];TS.emoji.spliceSkinToneVariationsIntoAnArrayOfEmojiNames(r);for(var i=0;i<r.length;i+=1)if(TS.rxns.getRxnFromRxns(t,r[i]))return true;return false},countAllRxns:function e(t){if(!t)return 0;var n=0;t.forEach(function(e){n+=e.count||0});return n},countAllEmoji:function e(t){if(!t)return 0;return t.length},countAllUsersRxns:function e(t,n){if(!t)return 0;var r=0;t.forEach(function(e){if(e.users.indexOf(n)>-1)r+=1});return r},getAllUniqueRxners:function e(t,n){if(!t)return[];var r=[];t.forEach(function(e){if(!e)return;if(!e.count)return;if(!e.users)return;e.users.forEach(function(e){if(n==e)return;if(-1!=r.indexOf(e))return;r.push(e)})});return r},getRxnFromRxns:function e(t,n){if(!t)return null;return t.filter(function(e){return e.name==n})[0]||null},changeRxnsFromIMsg:function e(t){if(!t.item)return;TS.log(2006,"rxn updated from imsg by "+t.user);var n=false;if("message"===t.item.type&&t.item.ts)n=true;else if("file"===t.item.type&&"string"===typeof t.item.file)n=true;else if("file_comment"===t.item.type&&t.item.file_comment&&"string"===typeof t.item.file)n=true;if(!n)return;if(!y(t.item))return;var r=t.user==TS.model.user.id;var i=TS.rxns.getRxnKeyFromData(t.item);var a=TS.rxns.getExistingRxnsByKey(i);var s;var u="reaction_added"===t.type;s=d(u,_.cloneDeep(a)||[],t.reaction,t.user,t.url);var c=m(i,s);if(TS.has_pri[B])TS.dir(B,c,"handleRxnChangeFromMS upsert status:"+c.status);b(t);if("NOOP"===c.status)return;if(r&&!t._from_evt_log)o(i,t.reaction,t.user,t.item.type);else l(i,t.item.type);if(u)TS.log(2006,"Adding to "+i);else TS.log(2006,"Removing from "+i)},changeRxnsFromUserAction:function e(t,n,r){if(r)TS.log(2006,"Adding rxn to "+t+" from user action");else TS.log(2006,"Removing rxn from "+t+" from user action");var i=TS.emoji.nameToCanonicalName(n);var l=TS.rxns.getExistingRxnsByKey(t);var d=TS.rxns.getRxnFromRxns(l,n);if(r||!d)n=i;if(TS.has_pri[B])TS.log(B,"changeRxnsFromUserAction rxn_key:"+t+" name:"+n+" adding:"+r);if(r&&!TS.emoji.isValidName(n)&&!(d&&d.url)){TS.error('"'+n+'" is not a valid emoji');return}var m=TS.rxns.getExistingRxnsByKey(t)||[];if(r){var f=TS.rxns.countAllEmoji(m);var T=TS.rxns.countAllUsersRxns(m,TS.model.user.id);if(f>=50&&!TS.rxns.doesRxnsHaveRxn(m,n)){M(E);return}else if(T>=23){M(A);return}}var v=u(r,_.cloneDeep(m),n);if(TS.has_pri[B]){TS.dir(B,m,"existing_rxns");TS.dir(B,v,"new_rxns")}var b=c(t,v);if(TS.has_pri[B])TS.dir(B,b,"changeRxnsFromUserAction upsert status:"+b.status);if("NOOP"===b.status){TS.error("changeRxnsFromUserAction called but no NOOP?");return}o(t,n,TS.model.user.id);var y=r?"reactions.add":"reactions.remove";var w=g(t,{name:n});var k=$('[data-rxn-key="'+t+'"]');var x={};var C=k.closest("ts-message");var I=""+C.data("ts");var O=C.data("model-ob-id");x={message_timestamp:I,channel_id:O,channel_type:O?O.charAt(0):"",member_id:C.data("member-id"),app_id:C.data("app-id"),bot_id:C.data("bot-id")};var H=r?"REACTION_ADDED":"REACTION_REMOVED";if(TS.model.unread_view_is_showing&&w.timestamp){_.merge(x,TS.client.ui.unread.getTrackingData(w.timestamp));TS.client.ui.unread.incrementTrackingSeqId()}_.merge(x,TS.ui.thread.getTrackingPayloadForEl(k));if("threads_view"===TS.ui.thread.getContextForEl(k))TS.client.ui.threads.incrementTrackingSeqId();TS.clog.track(H,x);p(t);TS.api.call(y,w,function(e,i,l){h(t);TS.log(2006,y+" returned "+e+" for "+t);var d=false;if(e);else if(!r&&i.error&&"no_reaction"===i.error);else{if(i.error==E||i.error==A)M(i.error);else if(i.error==F)TS.warn("Attempted to add/remove invalid emoji and the API complained: "+l.name);var m=TS.rxns.getExistingRxnsByKey(t)||[];var f=u(!r,_.cloneDeep(m),n);var p=c(t,f);if(TS.has_pri[B])TS.dir(B,p,"changeRxnsFromUserAction UNDO upsert status:"+p.status);if("NOOP"===p.status){if(TS.has_pri[B])TS.log(B,"changeRxnsFromUserAction trying to undo because of API rsp, but no NOOP?")}else d=true}var g=function e(){if(TS.has_pri[B])TS.log(B,"maybeUpdateModel pending:"+a[t]+" _pending_last:"+s[t]);if(a[t])return false;if(!s.hasOwnProperty(t))return false;var n=c(t,s[t]);delete s[t];if(TS.has_pri[B])TS.dir(B,n,"maybeUpdateModel status:"+n.status);if("NOOP"===n.status)return false;o(t);S(t);return true};if(!g()&&!d)return;o(t)})},checkForRxnClick:function e(t){if(!t||!t.target)return;var n=$(t.target);var r=n.closest(".rxn");if(!r.length)return;var i=String(r.data("emoji"));var a=n.closest(".rxn_panel");var s=a.data("rxn-key");var o=r.hasClass("is_handy");var l;if(r.hasClass("menu_rxn"))TS.ui.react_emoji_menu.start({e:t,rxn_key:s});else{l=!r.hasClass("user_reacted");if(!l&&t.shiftKey)O(s);else{var u=o&&TS.emoji.isNameSkinToneModifiable(i)?":"+TS.emoji.getChosenSkinToneModifier():"";TS.rxns.changeRxnsFromUserAction(s,i+u,l)}}},getRxnRecords:function e(){return n},getRxnKeyParts:function e(t){var n=t.split("-");return{type:n[0],id:n[1],c_id:n[2]}},test:function e(){return{updateUI:o,addOrRemoveRxnFromRxns:d,upsertRxnsFromData:m,upsertRxns:f,incrementPendingCnt:p,decrementPendingCnt:h,fetchAndUpdateRxns:S,displayTooManyError:M,TOO_MANY_REACTIONS:A,TOO_MANY_EMOJI:E}},clearHandyRxnsDisplayDataCache:function e(){t=void 0},getMemberRxnsFromMessage:function e(t,n){if(!t||!n)return;var r=TS.rxns.getRxnKeyByMsgType(t);if(!r)return;var i=TS.rxns.getExistingRxnsByKey(r);if(!i)return;var a=i.filter(function(e){return _.includes(e.users,n)});return a},getHandyRxnsDisplayDataByRxnKey:function n(){if(!t){t={items:{}};e.forEach(function(e){var n=TS.emoji.isNameSkinToneModifiable(e)?TS.emoji.getChosenSkinToneModifier():"";var r=":"+e+":"+n;t.items[e]={html:new Handlebars.SafeString(TS.emoji.graphicReplace(r,{no_skin_tone_squares:true})),name:r,names:r}})}return t}});var e=["slightly_smiling_face","+1","white_check_mark","heart","eyes"];var t;var n=[];var r={};var i={};var a={};var s={};var o=function e(t,n,r,i){var a;var s=TS.rxns.getRxnKeyParts(t);if(s&&s.c_id){var o=TS.shared.getActiveModelOb();if(o&&o.id!==s.c_id)a=true}var l;var u=TS.boot_data.feature_initial_scroll_position?0:void 0;if(!a)l=TS.client&&TS.client.ui&&TS.client.ui.areMsgsScrolledToBottom(u);TS.templates.builders.updateRxnPanels(t,n,r);if("file"===i){TS.log("(Temporary) Rebuilding mentions due to file reaction.");TS.view.rebuildMentions()}if(TS.client&&l)TS.client.ui.instaScrollMsgsToBottom(true)};var l=function e(t,n){o(t,void 0,void 0,n)};var u=function e(t,n,r){return d(t,n,r,TS.model.user.id)};var d=function e(t,n,r,i,a){var s=TS.rxns.getRxnFromRxns(n,r);if(t){if(!s)n.push({users:[i],count:1,name:r,url:a});else if(TS.utility.ensureInArray(s.users,i))s.count+=1}else if(s){var o=s.users.indexOf(i)>=0;if(o){_.pull(s.users,i);s.count-=1;if(s.count<1||0===s.users.length)_.pull(n,s);if(!n.length)n=null}}return n};var c=function e(t,n){return f(t,n,true)};var m=function e(t,n){return f(t,n,false)};var f=function e(t,n,r){var o={status:"NOOP",what_changed:[],rxns:n};if(!r&&a[t]){s[t]=_.cloneDeep(n);if(TS.has_pri[B])TS.log(B,"_upsertRxns call ignored because !force && _pending_counts["+t+"]:"+a[t]);return o}var l=TS.rxns.getExistingRxnsByKey(t);if(n)if(l){if(!TS.utility.areSimpleObjectsEqual(l,n,"rxn_key:"+t)){o.status="CHANGED";i[t]=n}}else{o.status="ADDED";i[t]=n}else if(l){o.status="CHANGED";delete i[t]}o.rxns=i[t]||null;if(TS.useReactMessages())if(TS.redux.reactions.isInBulkUpsertMode())TS.redux.reactions.addToBulkUpsertPayload(t,n);else TS.redux.reactions.updateReaction(t,n);if(TS.has_pri[B])TS.dir(B,o,t);return o};var p=function e(t){if(!t)return;a[t]=a[t]||0;a[t]+=1;if(TS.has_pri[B])TS.log(B,"_incrementPendingCnt "+t+": "+a[t])};var h=function e(t){if(!a[t]){if(TS.has_pri[B])TS.log(B,"_decrementPendingCnt "+t+": "+a[t]);return}a[t]-=1;if(0===a[t])delete a[t];if(TS.has_pri[B])TS.log(B,"_decrementPendingCnt "+t+": "+a[t])};var g=function e(t,n){n=n||{};var r=TS.rxns.getRxnKeyParts(t);if("message"===r.type){n.channel=r.c_id;n.timestamp=r.id}else if("file"===r.type)n.file=r.id;else if("file_comment"===r.type)n.file_comment=r.id;else throw new Error("type not handled");return n};var S=function e(t,n){n=n||1;var r=2;var i=g(t,{full:true});if(TS.has_pri[B])TS.log(B,"_fetchAndUpdateRxns rxn_key:"+t+" attempt:"+n);p(t);TS.api.call("reactions.get",i,function(i,a){h(t);if(i){var s=TS.rxns.getRxnsFromData(a);var l=m(t,s);if(TS.has_pri[B])TS.dir(B,l,"_fetchAndUpdateRxns upsert status:"+l.status);if("NOOP"===l.status)return;o(t)}else TS.error("_fetchAndUpdateRxns got an err:"+JSON.stringify(a||null));if(n<r){n+=1;e(t,n)}})};var T=function e(t,n,r){if(!t)return null;if(!t.emoji)return null;if(!t.emoji.hasOwnProperty(n))return null;for(var i=0;i<t.emoji[n].length;i+=1)if(t.emoji[n][i].id===r)return t.emoji[n][i];return null};var v=function e(t){if(!TS.client)return false;if(t.user==TS.model.user.id)return false;if("message"===t.item.type&&"undefined"!==typeof t.item.message&&t.item.message.user!=TS.model.user.id)return false;if("file"===t.item.type&&"undefined"!==typeof t.item.file&&t.item.file.user!=TS.model.user.id)return false;if("file_comment"===t.item.type&&"undefined"!==typeof t.item.comment&&t.item.comment.user!=TS.model.user.id)return false;return true};var b=function e(t){if(!v(t))return;var n=TS.rxns.getRxnKeyFromData(t.item);if("reaction_added"===t.type){if("message"===t.item.type)var r=t.item.channel;var i=!t._from_evt_log&&"message"===t.item.type;w(t.reaction,n,t.user,t.event_ts,i,r,t.url)}else C(t.reaction,n,t.user)};var y=function e(t){if(!t)return false;if("message"===t.type){var n=TS.utility.msgs.findMsg(t.ts,t.channel);if(!n)return false;t.message=n;return true}else if("file"===t.type||"file_comment"===t.type){var r=TS.files.getFileById(t.file);if(!r)return false;t.file=r;if("file_comment"===t.type){var i=TS.files.getFileCommentById(r,t.file_comment);if(!i)return false;t.comment=i}return true}return false};var w=function e(t,i,a,s,o,l,u){s=s||TS.interop.datetime.makeTsStamp();o=!!o;var d=false;var c=r[i];if(!c){d=true;n[n.length]={rxn_key:i};r[i]=n[n.length-1];c=r[i]}c.last_update=s;if(o)TS.rxns.need_alerts[i]=TS.rxns.need_alerts[i]||s;c.emoji=c.emoji||{};c.source=l||"";c.url=u;c.emoji[t]=c.emoji.hasOwnProperty(t)&&c.emoji[t]||[];var _=c.emoji[t];var m=T(c,t,a);if(!m){_[_.length]={id:a};m=_[_.length-1]}m.when=s;TS.dir(877,n,t+" "+i+" "+a);var f=n.length;if(d&&f>1&&n[f-1].last_update<n[f-2].last_update)n.sort(function e(t,n){if(t.last_update<n.last_update)return-1;if(t.last_update>n.last_update)return 1;return 0});x(o)};var k=function e(t){TS.rxns.rxn_records_changed_sig.dispatch(t)};var x=function e(){k()};var C=function e(t,i,a){var s=TS.rxns.getRxnRecordByKey(i);var o=T(s,t,a);if(o&&s){_.pull(s.emoji[t],o);if(!s.emoji[t].length)delete s.emoji[t];if(!Object.keys(s.emoji).length){delete r[i];_.pull(n,s)}}TS.rxns.rxn_records_changed_sig.dispatch()};var M=function e(t){var n=TS.i18n.t("You've reached the reaction limit","rxns")();var r=[TS.i18n.t("For reasons of performance and productivity and brevity being the soul of wit, you can add up to 23 emoji to a message, but no more.","rxns")(),TS.i18n.t("Well done! You’ve added the maximum amount of emoji one person can add to one message. For reasons of performance, productivity and sharpened creative thinking, we cap the number of individual reacji to 23.","rxns")(),TS.i18n.t("Emotions! We all have them — but on Slack, you’re limited to 23 reactions per message.","rxns")(),TS.i18n.t("Alas! Slack only allows each user to add 23 emoji reactions to a message. We’re sorry about that. \n","rxns")()+"<center>"+TS.emoji.graphicReplace(":balloon:",{jumbomoji:true})+"</center>",TS.i18n.t("You're overreacting, we think.","rxns")()];var i=[TS.i18n.t("The human heart is a powerful thing; its capacity to feel is limitless! A message’s capacity is 50.","rxns")(),TS.i18n.t("Alas! Slack only allows each message a grand total of 50 emoji reactions.","rxns")(),TS.i18n.t("A single message can’t have more than 50 unique reactions. When we asked the engineers why they said, “we have to set limits somewhere,” and then we tried to frown but this error popped up. So that’s where we’re at.","rxns")()];if(t==A){var a=_.sample(r);TS.generic_dialog.alert(a,n)}else if(t==E){var s=_.sample(i);TS.generic_dialog.alert(s,n)}};var I=function e(){$(".msgs_holder").find("ts-message").each(function(){var e=$(this);TS.ui.messages.maybeUpdateMessageHoverContainer(e)})};var A="too_many_reactions";var E="too_many_emoji";var F="invalid_name";var O=function e(t){var n=TS.rxns.getExistingRxnsByKey(t);if(!n)return;n.forEach(function(e){if(!TS.rxns.doesRxnsHaveRxnFromUser(n,e.name))return;TS.rxns.changeRxnsFromUserAction(t,e.name,false)})};var B="888"})()},4286:function(e,t){(function(){"use strict";TS.registerModule("ui.new_channel_modal",{start:function t(n,r,i){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;TS.ui.fs_modal.start({body_template_html:'<div id="new_channel_modal_container"></div>',onShow:g,onEnd:S});e=$("#new_channel_modal_container");return TS.ui.new_channel_modal.startInContainer(e,n,r,i)},startInContainer:function i(a,s,o,l){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;e=a;n=false!==o;if(!TS.permissions.members.canCreateChannels())n=false;if(!TS.permissions.members.canCreateGroups())n=true;var u=TS.permissions.members.canCreateChannels()&&TS.permissions.members.canCreateGroups();s=TS.utility.cleanChannelName(s||"");l=l||[];e.html(TS.templates.channel_new_modal({title:s,is_public:n,can_toggle_private:u,compliance_exports_enabled_for_team:!!TS.model.team.prefs.compliance_export_start,is_ra:TS.model.user.is_restricted,can_create_shared_channel:TS.permissions.members.canCreateSharedChannel()}));t=Ladda.create(e.find(".new_channel_go")[0]);d(l);setTimeout(function(){p()},500);return new Promise(function(e,t){r={resolve:e,reject:t}})},go:function r(){var i=e.find(".title_input").val();var a=$("#invite_members_container").lazyFilterSelect("value");var s=[];var o=[];if(a)a.forEach(function(e){if(e.member)s.push(e.member.id);else o.push(e)});var l=_.trim(TS.utility.contenteditable.value(e.find("#channel_purpose_input")));if(t)t.start();if(n)c(i,l,s,o);else m(i,l,s,o)},end:function e(){T()},test:function e(){return{createPublicChannel:c,createPrivateChannel:m,showNameTakenAlert:f}}});var e;var t;var n;var r;var i=function t(){var n=e.find("#invite_members_container").find("input")[0];var r=e.find("#channel_purpose_input");e.on("keydown",function(e){if(e.which===TS.utility.keymap.enter&&document.activeElement!=n&&!TS.utility.contenteditable.hasFocus(r)){TS.ui.new_channel_modal.go();e.preventDefault()}else if(e.which===TS.utility.keymap.esc){TS.ui.fs_modal.close();e.preventDefault()}})};var a=function t(){var r=$("#channel_public_private_toggle");r.togglify();r.bind("change",function(){n=r.is(":checked");if(r.is(":checked")){e.find(".private_channel_item").addClass("hidden");e.find(".public_channel_item").removeClass("hidden")}else{e.find(".public_channel_item").addClass("hidden");e.find(".private_channel_item").removeClass("hidden")}})};var s=function e(){return new Promise(function(e){if(TS.model.user.is_admin)TS.api.call("users.admin.invited").then(function(t){var n=TS.pending_users.filterOutURAs(t.data.pending);if(n.length){n.forEach(function(e){TS.pending_users.sanitizeNameFields(e)});e(n)}else e([])});else e([])})};var o=function e(t){var n=true;var r=s();return function(e,i){if("@"===e.charAt(0))e=e.substring(1);var a;var s=false;if(n){n=false;if(_.get(t,"length"))s=true}if(s){var o=_.compact(t.map(TS.members.getMemberById));var u=o.map(function(e){return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve({items:u})}else if(i>0)return Promise.resolve({items:[]});a=l(e);return Promise.all([a,r]).then(function(t){var n=t[0];var r=t[1];if(_.isUndefined(r)||0===r.length)return n;var i=new RegExp("^"+TS.utility.regexpEscape(e),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(e),"i");r=r.filter(function(e){return TS.pending_users.checkUserMatch(e,i)||TS.pending_users.checkUserMatch(e,a)});n=n.concat(r).sort(function(e,t){return TS.pending_users.usersSorterByName(e,t)});return n})}};var l=function e(t){var n={query:t,filter:"everyone"};return TS.members.fetchAndUpsertMembersWithQuery(n).then(function(e){var n=[];if(""===t)n=TS.members.getMembersForUser();else n=e.objects;n=_.filter(n,function(e){if(e.is_self)return false;if(e.is_slackbot)return false;return true});return n.filter(function(e){return!(e.is_ultra_restricted||e.deleted||!e._is_local||e.is_app_user)}).map(function(e){return{member:e,lfs_id:String(e.id)}})})};var u=function e(t){var n;var r;var i;var a={append:true,per_page:50,approx_item_height:TS.boot_data.feature_shared_channels_client?36:50,placeholder_text:TS.i18n.t("Search by name","new_channel")(),template:function e(t){var n;if(t.member)n=TS.templates.channel_invite_member_small({member:t.member});else n=TS.templates.channel_invite_pending_user_small({invitee:t});return new Handlebars.SafeString(n)},tokenTemplate:function e(t){var n;if(t.member)n=TS.templates.channel_invite_member_token({member:t.member});else n=TS.templates.channel_invite_pending_user_token({invitee:t});return new Handlebars.SafeString(n)},tokenClass:function e(t){if(t.member)return TS.templates.builders.getMemberTypeClass(t.member);return"lfs_token_pending_user"},filter:function e(t,a){var s=t.member;if(n!==a){r=new RegExp("^"+TS.utility.regexpEscape(a),"i");i=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(a),"i");n=a}var o=true;if(s)return TS.utility.members.checkMemberMatch(s,r,o)||TS.utility.members.checkMemberMatch(s,i,o);return TS.pending_users.checkUserMatch(t,r)||TS.pending_users.checkUserMatch(t,i)},noResultsTemplate:function e(t){if(!t)return TS.i18n.t("No one found","new_channel")();return TS.i18n.t("No one found matching <strong>{query}</strong>","new_channel")({query:TS.utility.truncateAndEscape(t,50)})}};a.data_promise=o(t);$("#invite_members_container").lazyFilterSelect(a)};var d=function t(n){u(n);e.find(".lfs_input").attr("id","invite_members_input");e.find(".new_channel_go").click(TS.ui.new_channel_modal.go);e.find(".create_share_channel").click(function(){TS.ui.new_channel_modal.end();TS.ui.share_channel_dialog.start({title:$("#channel_create_title").val(),is_private:!$("#channel_public_private_toggle").is(":checked")})});i();a();e.find(".title_input").keydown(function(){e.find(".modal_input_note.mustard_yellow").each(function(){$(this).addClass("hidden")})});$("#channel_create_title").focus();e.find(".new_channel_cancel_btn").on("click",function(){var e=r&&r.reject;if(e)e();TS.ui.fs_modal.close()});var s=$("#save_channel");var o=$("#channel_create_title");function l(){var e=o.val();if(e&&e.length)TS.utility.disableElement(s,false);else TS.utility.disableElement(s,true)}if(s.length&&o.length){o.on("input",l);l()}if(TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()){var d=e.find("#channel_purpose_input");TS.utility.contenteditable.create(d,{singleLineInput:true,modules:{tabcomplete:{positionMenu:function e(t){t.style.width=d.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,d)},searchOptions:{complete_member_specials:false},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members]}},onTab:function e(){return TS.boot_data.feature_keyboard_navigation},onEnter:function e(){return false},onEscape:function e(){TS.ui.fs_modal.close()}});TS.utility.contenteditable.enable(d)}};var c=function n(r,i,a,s){TS.channels.create(r,{validate_name:true}).then(function(e){var t=e.data;if(i)TS.channels.setPurpose(t.channel.id,i);if(a&&a.length){_.pull(a,TS.model.user.id);if(a.length)TS.api.call("channels.invite",{channel:t.channel.id,users:a.join(",")})}if(s&&s.length)TS.pending_users.invitePendingUsersToChannel(s,t.channel.id);TS.ui.fs_modal.close()}).catch(function(n){n=n||{};var i=n.data?n.data.error:n.message;if(t)t.stop();var a=TS.ui.validation.getErrorMessage(i,{maxlength:22,name:r});TS.ui.validation.showWarning(e.find(".title_input"),a,{custom_for:"channel_create_title"})})};var m=function n(r,i,a,s){TS.groups.create(r,{and_invite_members_idsA:a,validate:true}).then(function(e){var t=e.data;if(i)TS.groups.setPurpose(t.group.id,i);if(s&&s.length)TS.pending_users.invitePendingUsersToChannel(s,t.group.id);TS.ui.fs_modal.close()}).catch(function(n){if(t)t.stop();var i=n.data.error;var a=TS.ui.validation.getErrorMessage(i,{maxlength:22,name:r});TS.ui.validation.showWarning(e.find(".title_input"),a,{custom_for:"channel_create_title"})})};var f=function t(){TS.channels.ui.channelCreateDialogShowNameTakenAlert(e)};var p=function e(){var t=new Date("March 17, 2017 10:00:00");var n=Math.floor(t.getTime()/1e3);if(TS.model.prefs.seen_intl_channel_names_coachmark)return;if("en-US"===TS.boot_data.browser_lang||"en-us"===TS.boot_data.browser_lang)return;if(TS.model.user.created>n)return;TS.model.prefs.seen_intl_channel_names_coachmark=true;TS.prefs.setPrefByAPI({name:"seen_intl_channel_names_coachmark",value:true},function(){TS.coachmark.start(TS.coachmarks.coachmarks.intl_channel_names)})};var h=function t(){if(e){e.find(".new_channel_go").off("click");e.find("#channel_public_private_toggle").off("change");e.off("keydown")}};var g=function e(){};var S=function e(){T()};var T=function n(){h();e=null;t=null;r=null}})()},4288:function(e,t){(function(){"use strict";TS.registerModule("ui.lazy_filter_select",{STYLES:{default:"default",filter_in_list:"filter_in_list",normal:"normal",small:"small"},onStart:function e(){$("select[data-lazy-filter-select], label[data-lazy-filter-select] select").addClass("hidden").lazyFilterSelect({use_data_attributes:true})},create:function t(n,r){if(r.use_data_attributes){var a=Object.keys(n.data());a.forEach(function(e){if(e.indexOf("lazyFilterSelect")>-1&&"TS-lazyFilterSelect"!==e&&""!==n.data(e)){var t=n.data(e);if("true"===t||"false"===t)t="true"===t;r[e.replace("lazyFilterSelect","").toLowerCase()]=t}})}if("SELECT"===n.prop("tagName"))if("undefined"===typeof r.single)r.single=!n.prop("multiple");var s=$.extend({},e,r);if(void 0===r.approx_divider_height)s.approx_divider_height*=1;if(void 0===r.approx_item_height)s.approx_item_height*=1;var o=$('<div class="lazy_filter_select">');if(s.classes)o.addClass(s.classes);if(n.prop("disabled"))s.disabled=true;if(s.disabled)o.addClass("disabled");s.style=_.get(TS.ui.lazy_filter_select.STYLES,s.style,TS.ui.lazy_filter_select.STYLES.default);if(ne(s)&&!s.single){TS.console.warn("Multi-select lazyFilterSelect instances can't use the 'filter_in_list' style. Using 'default' style instead.");s.style=TS.ui.lazy_filter_select.default}var l=TS.templates.lazy_filter_select_container({instance:s,aria_labelledby:n.attr("aria-labelledby"),STYLES:TS.ui.lazy_filter_select.STYLES});o.html(l);if(s.append)o.appendTo(n);else o.insertAfter(n);o.addClass(s.style+"_style");if(s.single)o.addClass("single");if(s.width)o.css("width",s.width);if(s.css)o.css(s.css);s.$container=o;s.$select=n;s.$input_container=o.find(".lfs_input_container");s.$lfs_value=o.find(".lfs_value");s.$input=o.find(".lfs_input");s.$list_container=o.find(".lfs_list_container");s.$list=o.find(".lfs_list");s.$status=o.find(".lfs_status");s.$status_loading_indicator=s.$status.find(".lfs_status_loading_indicator");s.$status_content=s.$status.find(".lfs_status_content");if(ne(s))s.$filter_input=o.find(".lfs_filter_input");else s.$filter_input=s.$input;s._page_number=1;s._slug_id_counter=1;s.run=B;if(s.data_promise){if(P(s))s._running_promise.cancel("Uhhh...");s._running_promise=D(s,"").then(function(e){s.data=e;s.run();i(s)},function(e){i(s);ie(s,e,"Something failed while trying to return the initial data for lazyFilterSelect.")})}else{if(s.data)s.data=s.data.slice();_.forEach(s.data,function(e,t,n){if(e&&e._is_interop_channel_object)n[t]=_.assign({},e)});s.run();i(s)}s.current_items_in_view_signal=new signals.Signal;return s},convertHTMLDataToRLFSData:x,is_list_open:false});var e={allow_item_unselect:false,allow_list_position_above:false,always_visible:false,append:false,approx_divider_height:28,approx_item_height:30,data_promise:null,data_qa:"lfs",disabled:false,filter:function e(t,n){var r=t.toString();n=n.toLowerCase();if(t instanceof jQuery||t instanceof HTMLElement){r=$(t).text();var i=$(t).attr("data-additional-search-field");if(i&&i.toLowerCase().indexOf(n)>-1)return true}return r.toLowerCase().indexOf(n)>-1},input_debounce_wait_time:void 0,listItemClass:null,max_selected_items:Infinity,min_query_length:0,monkey_scroll:true,no_default_selection:false,noResultsTemplate:function e(t){if(re(this)&&t.length<this.min_query_length)return TS.i18n.t("{query_length, plural, =0 {Start typing to see results…} other {Keep typing to see results…}}","lazy_filter_select")({query_length:t.length});return TS.i18n.t("No items matched {query}","lazy_filter_select")({query:"<strong>"+_.escape(t)+"</strong>"})},errorTemplate:function e(t){return t||TS.i18n.t("Couldn't load results.","lazy_filter_select")()},onInputBlur:_.noop,onInputFocus:_.noop,onReady:function e(){},onItemAdded:function e(){},onItemRemoved:function e(){},onKeyDown:function e(){},onMaxItemsSelected:function e(){},onListShown:_.noop,onListHidden:_.noop,adjustAvailableSpaceAbove:_.identity,adjustAvailableSpaceBelow:_.identity,placeholder_text:TS.i18n.t("Choose an option…","lazy_filter_select")(),filter_placeholder_text:TS.i18n.t("Search","lazy_filter_select")(),renderDividerFunc:null,render_item_func:null,restrict_input_container_height:false,restrict_preselected_item_removal:false,scroll_threshold:1e3,set_height:true,should_graphic_replace_emoji:false,single:false,sluggify:{enabled:false,delimiter:null,key_name:null,validator:null},style:TS.ui.lazy_filter_select.STYLES.default,template:function e(t){var n=t.toString();var r;var i;if(t instanceof jQuery||t instanceof HTMLElement){n=$(t).text();r=Z($(t).attr("data-additional-search-field"),this);i=Z($(t).attr("data-ts-icon"),this)}n=Z(n,this);if(r)n+=' <span class="addl_text">'+r+"</span>";if(i)n+=' <ts-icon class="addl_icon '+i+'"></ts-icon>';return new Handlebars.SafeString(n)},tokenClass:null,tokenTemplate:null,tokenTemplateSingle:null,use_data_attributes:false,_$active:null,_all_done_fetching:false,_list_built:false,_list_visible:false,_mouse:{},_page_number:1,_prevent_blur:false,_previous_val:"",_running_promise:null,_scroll_callback_was_called:false,_selected:[],_showing_status:false};$.widget("TS.lazyFilterSelect",{_create:function e(){this.instance=TS.ui.lazy_filter_select.create(this.element,this.options)},_destroy:function e(){this.instance.$container.remove();delete this.instance},blur:function e(){this.instance.$filter_input.blur()},clearValue:function e(){if(this.instance.single){if(this.instance._selected.length){var t=this.instance.$input_container.find(".lfs_item");F(this.instance,t)}}else A(this.instance)},container:function e(){return this.instance.$container},disable:function e(){c(this.instance)},disabled:function e(){return this.instance.disabled},enable:function e(){f(this.instance)},focus:function e(){this.instance.$filter_input.focus()},getInstance:function e(){return this.instance},hideList:function e(){T(this.instance,{force:true});le(this.instance)},recomputeHeight:function e(){Q(this.instance)},setValue:function e(t){var n=this.element[0].selectedIndex;this.element.val(t);if(this.element[0].selectedIndex<0)this.element[0].selectedIndex=0;var r=this.element[0].options[this.element[0].selectedIndex];if(this.instance.single){if(this.element[0].selectedIndex==n)return}else A(this.instance);var i=g(this.instance,$(r));L(this.instance,i)},forceSelectItem:function e(t){this.instance.$lfs_value.html(a(this.instance,t,{force_selected:true}));this.instance.$container.addClass("value")},showList:function e(){q(this.instance)},update:function e(t){J(this.instance,t)},updatePlaceholder:function e(t){this.instance.placeholder_text=t;this.instance.$input.prop("placeholder",t)},updateFilterPlaceholder:function e(t){if(!ne(this.instance))return;this.instance.filter_placeholder_text=t;this.instance.$filter_input.prop("placeholder",t)},value:function e(){return this.instance._selected}});var t=function e(t,r){if(!v(t))return;if(!r.trim())return;if(!d(t))return;var i={};i[t.sluggify.key_name]=r.trim();i.lfs_id=null;i.lfs_slug_id=t._slug_id_counter;t._slug_id_counter+=1;t._selected.push(i);var a=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(i),applied_classes:"lfs_token",slug_id:i.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");var s=$(a);s.insertBefore(t.$input);if(t.sluggify.validator)t.sluggify.validator(s);C(t,t.data);q(t);t.$filter_input.val("");t._previous_val="";n(t);t.onItemAdded(i);if(!d(t))t.onMaxItemsSelected()};var n=function e(t){if(!t.single){t.$input.prop("size",t.$filter_input.val().length+1);if(t.$filter_input.val().length+t._selected.length===0)W(t);else{t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var r=function e(t){if(t.data_promise)t.$list.on("scroll",function(){var e=$(this).scrollTop();var n=t.$list.height();var r=t.$list.find(".list_items").height();var i=r-e-n;if(i<=t.scroll_threshold&&!t._scroll_callback_was_called&&!t._all_done_fetching){u(t,t._previous_val,t._page_number+1);t._scroll_callback_was_called=true}else if(i>t.scroll_threshold&&t._scroll_callback_was_called){if(P(t))t._running_promise.cancel("User scrolled back and we do not need to add more data");t._scroll_callback_was_called=false}})};var i=function e(t){t.$container.on("mouseleave",ue.bind(null,t));t.$container.on("click",de.bind(null,t));t.$container.parents("label").on("click",ce.bind(null,t));t.$input_container.on("focus",_e.bind(null,t));t.$input.on("focus",me.bind(null,t));var n;if(_.isUndefined(t.input_debounce_wait_time))n=fe;else n=_.debounce(fe,t.input_debounce_wait_time);t.$filter_input.on("input",n.bind(null,t));t.$filter_input.on("keydown",pe.bind(null,t));t.$filter_input.on("blur",he.bind(null,t));t.$lfs_value.on("click",be.bind(null,t));t.$lfs_value.on("mousedown",ye.bind(null,t));t.$input_container.on("click",".lfs_token",we.bind(null,t));t.$input_container.on("mousedown",".lfs_token",ke.bind(null,t));t.$list_container.on("mousedown",xe.bind(null,t));t.$list_container.on("mouseup",Ce.bind(null,t));t.$list_container.on("mousemove",".lfs_item",Me.bind(null,t));t.$list_container.on("mouseleave",".lfs_item.active",Ie.bind(null,t));var r=null===_.get(TSSSB,"env.desktop_app_version")?"click":"mousedown";t.$list_container.on(r,".lfs_item",Ae.bind(null,t));t.onReady()};var a=function e(t,n,r){var i=$(n);r=r||{};var a=r.force_selected||b(t,n);var s=n.disabled||n.lfs_disabled;if(t.restrict_preselected_item_removal&&n.preselected)s=true;var o;if(r.should_tokenize&&_.isFunction(t.tokenTemplate))o=t.tokenTemplate(n);else if(t.single&&_.isFunction(t.tokenTemplateSingle))o=t.tokenTemplateSingle(n);else o=t.template(n);var l=Z(i.data("lfs-item-desc"),t);var u={active:""!==t._previous_val&&!a&&!s,disabled:s,lfs_token:r.should_tokenize,selected:a,single:t.single,group_item:i.hasClass("group_item")};if(_.isFunction(t.tokenClass))u[t.tokenClass(n)]=true;return TS.templates.lazy_filter_select_item({content:o,icon:i.data("lfs-item-icon"),desc:new Handlebars.SafeString(l),applied_classes:TS.utility.getAppliedClasses(u),lfs_id:n.lfs_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"")};var s="position_above";var o="show_status";var l=function e(t){if(!t._list_built&&!t._showing_status)return;t.$list_container.removeClass(s);var n=t.$list.css("max-height");t.$list.css({"max-height":0});var r=t.$list[0].scrollHeight;var i=parseInt(t.$list_container.css("padding-top"),10)+parseInt(t.$list_container.css("padding-bottom"),10)+parseInt(t.$list_container.css("border-top-width"),10)+parseInt(t.$list_container.css("border-bottom-width"),10)+parseInt(t.$list_container.css("margin-top"),10)+parseInt(t.$list_container.css("margin-bottom"),10);if(ne(t))i+=t.$filter_input.outerHeight()+parseInt(t.$filter_input.css("margin-bottom"),10);var a=parseInt(t.$list_container.css("max-height"),10);var o=2*t.approx_item_height+i;var l=Math.min(r+i,a);var u=$(window).height();var d=t.$input_container[0].getBoundingClientRect().bottom+parseInt(t.$input_container.css("margin-bottom"),10);var c=t.adjustAvailableSpaceBelow(u-d);if(t.allow_list_position_above){var _=t.$input_container[0].getBoundingClientRect().top+parseInt(t.$input_container.css("margin-top"),10);var m=t.adjustAvailableSpaceAbove(_);var f=m>=l;var p=c>=l&&c>o;if(f&&!p){c=m;t.$list_container.addClass(s)}}var h=Math.floor(Math.min(c,l)-i);t.$list.css({"max-height":h||n})};var u=function e(t,n,r){if(P(t))t._running_promise.cancel("Scrolling happened");if(t._all_done_fetching)return;t._running_promise=t.data_promise(n,r).then(function(e){var n=e;if(n.items)n=n.items;if(n&&n.length){t._page_number+=1;if(!t._current_data)t._current_data=t.data.slice();if("undefined"!==typeof e.all_items_fetched)t._all_done_fetching=!!e.all_items_fetched;if("undefined"!==typeof e.num_remaining&&0===e.num_remaining)t._all_done_fetching=true;var r;var i=parseInt(e.num_new,10)||0;r=n.slice(-i);if(r.length){if(e._replace_all_items||e.replace_all_items)t._current_data=r;else t._current_data=t._current_data.concat(r);m(t,t._current_data)}else t._all_done_fetching=true}else t._all_done_fetching=true},function(e){ie(t,e,"Something failed while trying to return the next batch of data for lazyFilterSelect.")})};var d=function e(t){return t._selected.length<t.max_selected_items};var c=function e(t){if(t.disabled)return;t.disabled=true;t.$container.addClass("disabled");t.$input.prop("disabled",true);t.$filter_input.prop("disabled",true)};var m=function e(t,r){I(t,r);C(t,r);var i=t._list_built&&(!t.data||0===t.data.length||t.always_visible);if(i)q(t,true);n(t)};var f=function e(t){if(!t.disabled)return;t.disabled=false;t.$container.removeClass("disabled");t.$input.prop("disabled",false);t.$filter_input.prop("disabled",false)};var p=function e(t,n){var r=t.data;var i=[];for(var a=0;a<r.length;a+=1){var s=r[a];if(s.lfs_group||s.is_divider){var o=[];for(var l=0;l<s.children.length;l+=1){var u=s.children[l];if(t.filter(u,n))o.push(u)}if(o.length>0)i.push({is_divider:true,lfs_group:true,label:s.label,children:o})}else if(t.filter(s,n))i.push(s)}return i};var h=function e(t){return t.attr("data-lfs-id")||t.prop("lfs_id")||null};var g=function e(t,n,r){var i=h(n);var a;if(r)a=t._selected;else{a=t.data_promise&&t._current_data?t._current_data:t.data;if(-1!==i.indexOf(".")){var s=parseInt(i.split(".")[0],10);a=a[s]?a[s].children:a[0].children}}var o=a.filter(function(e){return e.lfs_id===i});if(o.length)return o[0];return null};var S=function e(t,n){var r=parseInt(n.attr("data-lfs-slug-id"),10);var i=t._selected;var a=i.filter(function(e){return e.lfs_slug_id===r});if(a.length)return a[0];return null};var T=function e(t,n){n=n||{};var r=!t._list_visible||t.always_visible||t.disabled;if(r&&!n.force)return;t._list_visible=false;t.$list_container.removeClass("visible");t.$container.removeClass("list_visible");t.$input_container.removeClass("active");if(t._list_built)t.$list.longListView("setHidden",true);t._$active=null;t.onListHidden()};var v=function e(t){if(!t.sluggify.enabled)return false;else if(!t.sluggify.delimiter){TS.error("You must pass a delimiter regular expression to use sluggify with lazyFilterSelect.");return false}else if(!t.sluggify.key_name){TS.error("You must pass a key name to use sluggify with lazyFilterSelect.");return false}else if(t.single){TS.error("Sluggify only works in multi-select versions of lazyFilterSelect.");return false}return true};var b=function e(t,n){if(!t._selected.length)return false;var r=t._selected.filter(function(e){return e.lfs_id===n.lfs_id});return!!r.length};var y=function e(t){if(t instanceof jQuery)return!!t.attr("data-lfs-slug-id");return void 0!==t.lfs_slug_id};var w=function e(t,r,i){if(!v(t))return;if(!y(r))return;var a=$(r);var s=Z(a.data("lfs-item-desc"),t);t._slug_id_counter=Math.max(r.lfs_slug_id,t._slug_id_counter)+1;t._selected.push(r);var o;var l=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(r),icon:a.data("lfs-item-icon"),desc:new Handlebars.SafeString(s),applied_classes:"lfs_token",slug_id:r.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");o=$(l);o.insertBefore(t.$input);n(t);if(t.sluggify.validator)t.sluggify.validator(o);t.data=i.filter(function(e){return e.lfs_slug_id!==r.lfs_slug_id});return t.data};var k=function e(t){var n=t.children("option, optgroup");var r=n.length>0?[]:void 0;n.each(function(){if("OPTGROUP"===$(this).prop("tagName")){var e=$(this).children("option").toArray();if($(this).prop("disabled"))e=e.map(function(e){e.lfs_disabled=true;return e});r.push({is_divider:true,lfs_group:true,label:$(this).prop("label"),children:e})}else r.push(this)});return r};function x(e){var t=k(e);t=t.map(function(e,t){if(e instanceof HTMLOptionElement)e={id:String(e.lfs_id||t),original_item:e,label:$(e).text(),value:e.value,preselected:e.selected};return e});return t}var C=function e(t,n){if(!n)n=t.data;if(!n){ie(t);return}if(0===n.length){ae(t);return}le(t,{keep_input_active:true});if(!t._list_built){if(!t.data||0===t.data.length)t.data=n;z(t)}else{var r=M(n);t.$list.longListView("setItems",r,true);t._current_data=n;Q(t)}l(t)};var M=function e(t){var n=[];t.forEach(function(e){n.push(e);if(e.children&&e.children.length)for(var t=0;t<e.children.length;t+=1)n.push(e.children[t])});return n};var I=function e(t,n){if(!n)n=t.data;if(!n)return;var r="";var i=!t.single;var s=0;while(s<n.length){var o=n[s];if(y(o)){n=w(t,o,n);continue}if(o.children&&o.children.length)o.lfs_group=true;if(o.lfs_group||o.is_divider){o.is_divider=true;var l=s;for(var u=0;u<o.children.length;u+=1){var d=o.children[u];d.lfs_id=d.lfs_id||l+"."+u;if((d.selected||d.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,d))continue;t._selected.push(d);r+=a(t,d,{should_tokenize:i})}}}else{o.lfs_id=o.lfs_id||String(s);if((o.selected||o.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,o)){s+=1;continue}t._selected.push(o);r+=a(t,o,{should_tokenize:i})}}s+=1}if(r.length>0){t.$container.addClass("value");if(t.single)t.$lfs_value.html(r);else{$(r).insertBefore(t.$input);t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var A=function e(t){while(t.$input_container.find(".lfs_token").length>0)E(t)};var E=function e(t){var n=t.$input_container.find(".lfs_token").last();if(n.length)F(t,n)};var F=function e(t,n){if(t.disabled)return;if(y(n)){O(t,n);return}var r=g(t,n,true);if(r.disabled||t.restrict_preselected_item_removal&&r.preselected)return;t._selected=t._selected.filter(function(e){return e!==r});var i=t.$list.find('[data-lfs-id="'+r.lfs_id+'"]');i.removeClass("selected");n.remove();X(t);if(t.$filter_input.val().length+t._selected.length===0)W(t);if(0===t._selected.length)t.$container.removeClass("value");t.onItemRemoved(r)};var O=function e(t,n){if(!v(t))return;var r=S(t,n);t._selected=t._selected.filter(function(e){return e!==r});n.remove();X(t);if(t.$filter_input.val().length+t._selected.length===0)W(t);t.onItemRemoved(r)};var B=function e(){if(this.data&&0===this.data.length)TS.warn("Data passed to lazyFilterSelect is empty.");J(this,this.data);if(this.always_visible)q(this);if(this.restrict_input_container_height){this.$container.addClass("has_restricted_input_container_height");if(!TS.environment.supports_custom_scrollbar)this.$input_container.monkeyScroll()}};var H=function e(t,r,i){if(t.disabled)return;if(r===t._previous_val)return;t._all_done_fetching=false;t._previous_val=r;t._$active=null;n(t);t._page_number=1;if(t._list_built)t.$list.longListView("scrollToTop",true);if(t.data_promise){if(P(t))t._running_promise.cancel("User entered more text");t._running_promise=D(t,r).then(function(e){m(t,e);q(t,i)},function(e){ie(t,e,"Something failed while trying to return the filtered data for lazyFilterSelect.")})}else{q(t,i);var a=p(t,r);C(t,a);n(t)}};var D=function e(t,n){return new Promise(function(e,r){if(n.length<t.min_query_length){t._all_done_fetching=true;e([])}else{_.delay(function(){if(P(t))se(t)},650);t.data_promise(n).then(function(n){n=n||{};if(!_.isUndefined(n.all_items_fetched))t._all_done_fetching=!!n.all_items_fetched;if(0===n.num_remaining)t._all_done_fetching=true;var r=(n.items||n).slice();e(r);le(t,{keep_input_active:true})},function(e){r(e);le(t)})}})};var P=function e(t){return t._running_promise&&t._running_promise.isPending()};var j=function e(t,n){if(t.disabled)return;if(!t._list_visible){q(t);return}var r;if(!t._$active)r=t.$list.find(".lfs_item:not(.disabled, .hidden)").first();else r=t._$active[n](".lfs_item:not(.disabled, .hidden)").first();if(r.length){r.scrollintoview({duration:0});if(t._$active)t._$active.removeClass("active");r.addClass("active");t._$active=r}};var R=function e(t){return!(t.hasClass("selected")||t.hasClass("disabled"))};var L=function e(t,n){if(!d(t))return;if(t.single&&t._selected.length){var r=t.$list.find('[data-lfs-id="'+t._selected[0].lfs_id+'"]');r.removeClass("selected");t._selected.length=0;t.$lfs_value.empty()}t._selected.push(n);X(t);var i=$(a(t,n,{should_tokenize:!t.single}));if(_.isFunction(t.tokenClass))i.addClass(t.tokenClass(n));if(t.single)t.$lfs_value.html(i);else{i.addClass("lfs_token");i.insertBefore(t.$input)}if(!t.single){t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}t.$container.addClass("value");t.onItemAdded(n);if(!d(t))t.onMaxItemsSelected();if(!t.single)t.$filter_input.focus()};var U=function e(t){return j(t,"nextAll")};var N=function e(t){if(t.disabled)return;var n=t._$active;if(!n.length)return;if(!R(n))return;if(!d(t))return;n.addClass("selected");n.removeClass("active");t._$active=null;var r=g(t,n);L(t,r)};var G=function e(t){return j(t,"prevAll")};var W=function e(t){t.$input_container.addClass("empty");te(t)};var q=function e(t,n){if(t.disabled)return;TS.utility.rAF(function(){t.$filter_input.focus()});if(t._list_visible)return;if(t._showing_status&&t.always_visible)return;if(!t._list_built)z(t);if(t._list_built||t._showing_status){t._list_visible=true;t.$list_container.addClass("visible");t.$container.addClass("list_visible");if(!ne(t))t.$input_container.addClass("active");if(t._list_built)t.$list.longListView("setHidden",false)}if(t.single&&!n){t.$filter_input.val("");t._previous_val="";t.$filter_input.focus();if(re(t))t.data=[];C(t)}if(t.set_height){l(t);if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar)t.$list.monkeyScroll()}t.onListShown()};var z=function e(t){if(!t.data||0===t.data.length)return;var n=M(t.data);t._list_built=true;var i={items:n,approx_item_height:t.approx_item_height,approx_divider_height:t.approx_divider_height,preserve_dom_order:true,calcDividerHeight:function e(t){return t.outerHeight()},makeDivider:function e(){return $('<div class="lfs_group"></div>')},makeElement:function e(){return $(TS.templates.lazy_filter_select_item().replace(/(\r\n|\n|\r)/gm,""))},renderDivider:function e(n,r,i){if(t.renderDividerFunc)return t.renderDividerFunc(n,r,i);n.html(Z(r.label,t))},renderItem:function e(n,r,i){if(t.render_item_func)return t.render_item_func(n,r,i);var a=$(r);var s="active selected disabled single group_item lfs_token";var o={disabled:r.disabled||r.lfs_disabled,selected:b(t,r),single:t.single,group_item:a.hasClass("group_item")};if(_.isFunction(t.listItemClass))o[t.listItemClass(r)]=true;var l=TS.utility.getAppliedClasses(o);var u={"data-qa":t.data_qa+"-item-"+r.lfs_id,"data-lfs-id":r.lfs_id,title:r.title};n.attr(u).removeClass(s).addClass(l).html(t.template(r).string);if(a.data("lfs-item-icon")){var d="url("+a.data("lfs-item-icon")+")";var c=$('<span class="lfs_item_icon">').css("background-image",d);n.prepend(c)}if(a.data("lfs-item-desc")){var m=Z(a.data("lfs-item-desc"),t);var f=$('<span class="lfs_item_desc">').html(m);n.append(f)}}};t.$list.longListView(i);r(t);t.$list_items=t.$container.find(".list_items");TS.utility.rAF(function(){if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar)t.$list.monkeyScroll();t.$list.longListView("resizeImmediately");TS.utility.rAF(function(){t.current_items_in_view_signal.dispatch(t.$list.longListView("getCurrentItemsInView")||[])})});if(t.$list.longListView("getCurrentItemsInViewSignal"))t.$list.longListView("getCurrentItemsInViewSignal").add(function(e){t.current_items_in_view_signal.dispatch(e)})};var K=function e(t){t.stopPropagation();t.preventDefault()};var V=function e(t,n){if(t.single||!t.allow_item_unselect)return;var r=g(t,n,true);n.removeClass("selected");t._selected=t._selected.filter(function(e){return e!==r});t.$input_container.find('.lfs_item[data-lfs-id="'+r.lfs_id+'"]').remove();X(t);if(t.$filter_input.val().length+t._selected.length===0)W(t);if(0===t._selected.length)t.$container.removeClass("value");t.onItemRemoved(r)};var Y=function e(t,r){if(!v(t)||!y(r))return;var i=r.text().trim();if(r.length)O(t,r);t.$filter_input.val(i);n(t);t.$filter_input.select()};var J=function e(t,n){t.data=n||k(t.$select);if(t.data){t._selected=[];I(t);if(t.$filter_input.val().length){var r=t.$filter_input.val();t._previous_val="";H(t,r)}}};var Q=function e(t){if(t.restrict_input_container_height)TS.ui.utility.updateClosestMonkeyScroller(t.$input_container,true);if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar){l(t);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(t.$list,true)})}};var X=function e(t){if(t.append)return;var n=t._selected.filter(function(e){return e instanceof HTMLOptionElement}).map(function(e){return $(e).val()});t.$select.val(n).trigger("change")};var Z=function e(t,n){t=_.escape(t);if(_.get(n,"should_graphic_replace_emoji"))t=TS.emoji.graphicReplace(t);return t};var ee=function e(t){t.$input.attr("placeholder","");if(ne(t))t.$filter_input.attr("placeholder","")};var te=function e(t){t.$input.attr("placeholder",t.placeholder_text);if(ne(t))t.$filter_input.attr("placeholder",t.filter_placeholder_text)};var ne=function e(t){return t.style===TS.ui.lazy_filter_select.STYLES.filter_in_list};var re=function e(t){return _.isFunction(t.data_promise)&&t.min_query_length};var ie=function e(t,n,r){oe(t,t.errorTemplate(n),{internal_error_message:r,clear_active_items:true})};var ae=function e(t){var n=t.noResultsTemplate(t.$filter_input.val());oe(t,n,{clear_active_items:true})};var se=function e(t){var n=TS.i18n.t("Loading results…","lazy_filter_select")();oe(t,n,{show_loading_indicator:true})};var oe=function e(t,n,r){r=r||{};t._showing_status=true;if(r.internal_error_message)TS.error(r.internal_error_message);if(!ne(t))t.$input_container.addClass("active");if(r.show_loading_indicator)t.$status_loading_indicator.removeClass("hidden");if(r.clear_active_items)t._$active=null;t.$status_content.html(n);t.$list_container.addClass(o)};var le=function e(t,n){n=n||{};t._showing_status=false;if(!n.keep_input_active)t.$input_container.removeClass("active");t.$status_loading_indicator.addClass("hidden");t.$list_container.removeClass(o)};var ue=function e(t){t._prevent_blur=false};var de=function e(t){if(t.disabled)return;q(t)};var ce=function e(t,n){if(t.disabled)return;n.preventDefault();q(t)};var _e=function e(t){t.$input_container.click();t.$input.focus()};var me=function e(t){if(!t._input_is_focused){t._input_is_focused=true;t.$input_container.click();t.onInputFocus()}if(!t.single)t.$input_container.addClass("active")};var fe=function e(n){var r=n.$filter_input.val();if(v(n)&&r.match(n.sluggify.delimiter)){var i=r.split(n.sluggify.delimiter);i.forEach(function(e){if(e.length)t(n,e)})}else H(n,r,true)};var pe=function e(t,n){if(t.disabled)return;switch(n.keyCode){case TS.utility.keymap.down:K(n);U(t);break;case TS.utility.keymap.up:K(n);G(t);break;case TS.utility.keymap.enter:ge(t,n);break;case TS.utility.keymap.del:Se(t,n);break;case TS.utility.keymap.tab:Te(t,n);break;case TS.utility.keymap.esc:ve(t,n)}t.onKeyDown(n,n.isDefaultPrevented())};var he=function e(t){if(!t._prevent_blur){T(t);le(t)}t._input_is_focused=false;t.onInputBlur()};var ge=function e(t,n){if(t._$active&&t._$active.length&&t._list_visible){K(n);var r=t._$active;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,r));if(i)V(t,r);else{if(!d(t))return;N(t);var a=$(n.currentTarget);if(""!==a.val()){a.val("");t._previous_val="";C(t)}if(t.single){T(t);le(t)}}}};var Se=function e(t,n){if(""===t.$filter_input.val()){K(n);var r=t.$input_container.find(".lfs_token").last();if(v(t)&&y(r))Y(t,r);else E(t)}};var Te=function e(n,r){if(n.$filter_input.val().trim()&&v(n)){K(r);t(n,n.$filter_input.val())}else if(n.tab_to_nav){K(r);if(r.shiftKey)G(n);else U(n)}};var ve=function e(t,n){K(n);T(t);le(t);t.$filter_input.blur()};var be=function e(t,n){if(t.disabled)return;n.stopPropagation();q(t);t._prevent_blur=false};var ye=function e(t,n){if(1===n.which)t._prevent_blur=true};var we=function e(t,n){if(t.disabled)return;F(t,$(n.currentTarget));t._prevent_blur=false};var ke=function e(t,n){if(1===n.which)t._prevent_blur=true};var xe=function e(t,n){if(1===n.which)t._prevent_blur=true};var Ce=function e(t){if(t._prevent_blur)t.$filter_input.focus()};var Me=function e(t,n){if(t.disabled)return;if(n.clientX==t._mouse.lastX&&n.clientY==t._mouse.lastY)return;var r=$(n.currentTarget);if(t._$active)t._$active.removeClass("active");if(!r.hasClass("active")&&R(r)){r.addClass("active");t._$active=r}t._mouse.lastX=n.clientX;t._mouse.lastY=n.clientY};var Ie=function e(t,n){$(n.currentTarget).removeClass("active");t._$active=null};var Ae=function e(t,n){if(t.disabled)return;n.preventDefault();var r=$(n.currentTarget);t._$active=r;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,r));if(i)V(t,r);else{var a=R(r);if(!a&&!t.single)return;if(!d(t))return;if(!a&&t.single){T(t);n.stopPropagation();return}N(t);if(""!==t.$filter_input.val()){t.$filter_input.val("");t._previous_val="";C(t)}if(t.single){T(t);n.stopPropagation()}}t._prevent_blur=false}})()},4289:function(e,t){(function(){"use strict";TS.registerModule("ui.people_picker",{STYLES:{normal:"normal",small:"small"},onStart:function e(){},preload:function e(n){t(n)("");return n},make:function e(n,r){r=r||{};if(!r.append)n.addClass("hidden");r.style=_.get(TS.ui.people_picker.STYLES,r.style,TS.ui.people_picker.STYLES.normal);n.lazyFilterSelect({append:!!r.append,always_visible:!!r.always_visible,approx_item_height:r.approx_item_height||50,data_promise:t(r),placeholder_text:r.placeholder_text||TS.i18n.t("Search by name","people_picker")(),classes:"people_picker",scroll_threshold:2500,single:!!r.single,style:r.style,sluggify:r.sluggify,disabled:r.disabled,template:r.template||function(e){var t=TS.templates.member_small({member:e.member});return new Handlebars.SafeString(t)},tokenTemplate:r.tokenTemplate||function(e){var t=TS.templates.member_token({member:e.member});return new Handlebars.SafeString(t)},tokenClass:function e(t){return TS.templates.builders.getMemberTypeClass(t.member)},noResultsTemplate:r.noResultsTemplate||function(e){if(!e)return TS.i18n.t("No one found","people_picker")();return TS.i18n.t("No one found matching <strong>{query}</strong>","people_picker")({query:_.escape(e)})},onItemAdded:r.onItemAdded,onItemRemoved:r.onItemRemoved})},value:function e(t){return t.lazyFilterSelect("value")},clearValue:function e(t){return t.lazyFilterSelect("clearValue")},recomputeHeight:function e(t){return t.lazyFilterSelect("recomputeHeight")}});var e=["include_slackbot","include_self","include_bots","only_local_team","only_admins"];var t=function e(t){var r={};var i={};if(t.preselected_ids&&t.preselected_ids.length)_.forEach(t.preselected_ids,function(e){if(e)i[e]=true});var a={};if(t.omitted_ids&&t.omitted_ids.length)_.forEach(t.omitted_ids,function(e){if(e)a[e]=true});var s=function e(s,o){if("@"===s.charAt(0))s=s.substring(1);if(""===s&&t.empty_query_result){if(o>0)return Promise.resolve([]);return Promise.resolve(t.empty_query_result.map(function(e){return{member:e,lfs_id:String(e.id),preselected:!!i[e.id]}}))}if(""===s&&t.initial_load_promise){if(_.isUndefined(o))return t.initial_load_promise;t.initial_load_promise=n(t.initial_load_promise,i,a);return t.initial_load_promise}if(r.query!==s){r.query=s;r.include_org=TS.boot_data.page_needs_enterprise;r.include_slackbot=!!t.include_slackbot;r.include_self=t.include_self;r.full_profile_filter=false;r.include_bots=!!t.include_bots;r.only_local_team=!!t.only_local_team;r.only_admins=!!t.only_admins}var l=TS.members.ensureMembersArePresent(i).then(function(){return n(r,i,a)});if(""===s&&!t.initial_load_promise)t.initial_load_promise=l;return l};return s};var n=function t(n,r,i){return Promise.resolve().then(function(){var e=[];var t=_.keys(r);t.forEach(function(t){var n=TS.members.getMemberById(t);if(!n)e.push(t)});if(e.length)return TS.members.ensureMembersArePresent(e).catch(_.noop);return Promise.resolve()}).then(function(){return TS.members.promiseToSearchMembers(n).then(function(t){var a=[];if(""===t.query){var s=_.pick(n,e);a=TS.members.getMembersWithOptions(s)}else a=t.items;t.items=a.filter(function(e){return!i[e.id]}).map(function(e){if(e.member&&"undefined"!==typeof e.preselected)return e;return{member:e,lfs_id:String(e.id),preselected:!!r[e.id]}});return t})})}})()},4291:function(e,t){(function(){"use strict";TS.registerModule("dnd",{dnd_statuses_changed_sig:new signals.Signal,current_user_dnd_status_changed_sig:new signals.Signal,onStart:function e(){if(!TS.client)return;if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.connectedSig.add(h);TS.interop.SocketManager.disconnectedSig.add(g)}else{TS.ms.connected_sig.add(h);TS.ms.disconnected_sig.add(g)}var t=_.random(i,r);var n=Math.round(t*a);TS.dnd.setApiDelays(t,n);TS.dnd.debouncedCheckForChanges=TS.utility.throttleFunc(TS.dnd.checkForChanges,500,true);if(TS.boot_data.feature_tinyspeck)m=true;else m=TS.utility.enableFeatureForUser(1);TS.presence_manager.sub_list_changed.add(S)},memberDndStatus:function e(){var t=TS.dnd.calculateMemberDndFromTimestamp(TS.model.user);var n=t&&TS.model.dnd.snooze_enabled;var r=I(TS.model.user);var i;if(r&&n)i=F(r);else if(r){i=TS.interop.datetime.toTime(r,{do24hrTime:TS.utility.date.do24hrTime()});if(!TS.utility.date.do24hrTime())i=i.split(":00").join("")}return{in_dnd:t,snoozed:n,ends:r,readable_end_time:i}},setSnooze:function e(t){return TS.api.call("dnd.setSnooze",{num_minutes:t},function(e,n){if(!e){TS.warn("dnd.setSnooze failed");return}if(TS.has_pri[D])H("dnd.setSnooze to "+t+" minutes. New end time is "+$(n.snooze_endtime))})},endSnooze:function e(){return TS.api.call("dnd.endSnooze",{},function(e){if(!e){TS.warn("dnd.endSnooze failed");return}if(TS.has_pri[D])H("dnd.endSnooze succeeded")})},endDnd:function e(){return TS.api.call("dnd.endDnd",{},function(e){if(!e){TS.warn("dnd.endDnd failed");return}if(TS.has_pri[D])H("dnd.endDnd succeeded")})},calculateMemberDndFromTimestamp:function e(t,n){var r;if(!n)n=E();var i=M(t);var a=I(t);if(t.is_self&&TS.model.dnd.snooze_enabled&&a)if(a>n)return true;if(null==i||null==a)return false;r=a>n&&(i<=n||i>a);return r},isMemberInDnd:function e(t){return!!TS.redux.dnd.isMemberInDndById(t.id)},checkForChanges:function e(){if(!TS.model.ms_connected)return;if(m)TS.metrics.mark("dnd_check_for_changes");var t=false;var n=E();if(TS.model.dnd.snooze_enabled)if(n>=TS.model.dnd.snooze_endtime){TS.model.dnd.snooze_enabled=false;t=true}if(_.size(TS.model.dnd.team)>s){if(TS.has_pri[D])H("checkForChanges over limit, purging non-relevant dnd data");v()}var r=[];var i=[];var a=function e(a){if(!a||a.deleted)return;var s=TS.dnd.isMemberInDnd(a)||false;var o=TS.dnd.calculateMemberDndFromTimestamp(a,n);if(s!=o){f(a.id,o);if(a.is_self)t=true;i.push(a)}if(O(a,n))r.push(a)};_.forOwn(TS.model.dnd.team,function(e,t){var n=TS.members.getMemberById(t);a(n)});if(t&&!_.includes(i,TS.model.user))i.push(TS.model.user);if(i.length>0&&TS.has_pri[D])H("Processing DND status changes for "+i.length+" members");p(i);if(t){TS.dnd.current_user_dnd_status_changed_sig.dispatch();TSSSB.call("dndStatusChanged",TS.dnd.isMemberInDnd(TS.model.user));if(TS.has_pri[D])H("Current user DND status changed")}var o=0;r=_.filter(r,function(e){var t=TS.presence_manager.isSubscribedToMember(e.id);if(!t){delete TS.model.dnd.team[e.id];o+=1}return t});if(o&&TS.has_pri[D])H("checkForChanges discarded "+o+" stale members");TS.dnd.kickOffNextEventTimer();if(m)TS.metrics.measureAndClear("dnd_check_for_changes_lazy","dnd_check_for_changes");return r},debouncedCheckForChanges:function e(){},kickOffNextEventTimer:function e(){clearTimeout(u);var t=E();var n=b(t);if(TS.has_pri[D])H("next DND tick scheduled for "+$(n));var r=1e3*(n-t);d=n;u=setTimeout(function(){var e=TS.dnd.checkForChanges();if(e.length>1){TS.dnd.fetchMultipleMembers(e);if(TS.has_pri[D])H("DND refreshing "+e+" members")}else if(1===e.length){TS.dnd.refreshMember(e[0]);if(TS.has_pri[D])H("DND refreshing one member")}},r)},fetchMultipleMembers:function e(t){var n=k(t);if(n)return n.finally(TS.dnd.checkForChanges)},refreshMember:function e(t){var n=C(t);if(n)return n.finally(TS.dnd.checkForChanges)},updateUserPropsAndSignal:function e(t,n){if(!TS.model.dnd.team[t]){if(TS.has_pri[D])H("Ignoring new DND props for "+t);return}y(t,n);if(t===TS.model.user.id)TS.dnd.checkForChanges();else TS.dnd.debouncedCheckForChanges()},dndOverride:function e(t,n){var r=TS.shared.getModelObById(t);if(!r)return;var i=TS.utility.msgs.getMsg(n,r.msgs);if(!i)return;if(i._ignore_dnd)return;i._ignore_dnd=true;if(r.is_im)TS.ui.growls.growlImMessage(r,i);else TS.ui.growls.growlChannelOrGroupMessage(r,i)},debugInfo:function e(){var t=["DND debug info:"];t.push("next timer fires at "+$(d));t.push("_team_info_delay: "+o);t.push("_single_user_info_delay: "+l);t.push("_calcNextCheckTime: "+$(b()));var n="\n"+t.join("\n");TS.info(n)},debugMember:function e(t){var n=["DND member debugging:"];n.push("is in DND: "+!!TS.dnd.isMemberInDnd(t)+" ("+TS.dnd.calculateMemberDndFromTimestamp(t)+")");n.push("start: "+$(M(t),true));n.push("end  : "+$(I(t),true));n.push("next : "+$(A(t),true));n.push("stale? "+O(t));var r=I(t);if(r&&B(r))n.push("Probably a snooze");else if(r)n.push("Probably a scheduled DND");var i="\n"+n.join("\n");TS.info(i)},setApiDelays:function e(t,n){o=t;l=n},test:function e(){return{fetchUsersInfo:k,calcNextCheckTime:b,snoozeReadableCountdown:F,updateUserDndProps:y,timeWasProbablyASnooze:B,memberHasStaleTimes:O,ensureDndTimesForMemberIds:T,purgeNonRelevantData:v,requested_member_ids:c}}});var e=15;var t=300;var n=100;var r=1500;var i=10;var a=.01;var s=1500;var o=r;var l=i;var u;var d;var c={};var m=false;var f=function e(t,n){TS.redux.dnd.updateDndForMember(t,n)};var p=function e(t){t=_.filter(t,function(e){if(e.is_self)return true;return TS.presence_manager.isSubscribedToMember(e.id)});if(t.length)TS.dnd.dnd_statuses_changed_sig.dispatch(t)};var h=function e(t){if(!t){v();var n=TS.presence_manager.getSubList();if(!_.includes(n,TS.model.user.id))n.push(TS.model.user.id);var r=true;T(n,r)}TS.dnd.checkForChanges()};var g=function e(){clearTimeout(u)};var S=function e(){T(TS.presence_manager.getSubList())};var T=function e(t,n){if(!t||!t.length)return Promise.resolve();var r=_.map(t,TS.members.getMemberById);r=_.filter(r,function(e){return e&&!e.is_bot&&!e.deleted&&e._is_local});if(!n)r=_.filter(r,function(e){return!c[e.id]&&!TS.model.dnd.team[e.id]});if(!r.length)return Promise.resolve();t=_.map(r,"id");var i=_.groupBy(t);_.forEach(t,function(e){c[e]=true});if(TS.has_pri[D])H("_ensureDndTimesForMemberIds requesting "+t.length);if(m)TS.metrics.count("dnd_lookup_lazy",t.length);return TS.api.call("dnd.teamInfo",{users:t.join(",")}).then(function(e){var n=e.data;var r=[];if(n.users)_.forOwn(n.users,function(e,t){r.push(t);if(i[t])y(t,e)});if(TS.boot_data.feature_tinyspeck){var a=[];_.forEach(t,function(e){if(!TS.model.dnd.team[e]){if(TS.has_pri[D])H("dnd lookup failed for "+e);a.push(e)}});if(a.length){TS.metrics.count("dnd_lookup_failed",a.length);var s={requested:t,received:r,missing:a};TS.console.logError(s,"dnd_lookup_failed_members",null,true)}}TS.dnd.checkForChanges()}).catch(function(e){if(TS.boot_data.feature_tinyspeck)TS.console.logError(e,"dnd_lookup_request_failed")}).finally(function(){_.forEach(t,function(e){delete c[e]})})};var v=function e(){var t=_.groupBy(TS.presence_manager.getSubList());var n=[];_.forOwn(TS.model.dnd.team,function(e,r){if(t[r])return;if(r===TS.model.user.id)return;n.push(r);f(r,false)});var r=_.map(n,TS.members.getMemberById);r=_.compact(r);p(r);_.forEach(n,function(e){delete TS.model.dnd.team[e]});if(TS.has_pri[D])H("_purgeNonRelevantData dropped "+n.length)};var b=function n(r){var i;if(!r)r=E();var a=A(TS.model.user,r);if(a)i=a;var s=function e(t){if(t.id==TS.model.user.id)return;var n=A(t,r);if(!n)return;if(!i||n<i)i=n};_.forOwn(TS.model.dnd.team,function(e,t){var n=TS.members.getMemberById(t);if(n)s(n)});var o=t+r;if(!i||i>o)i=o;var l=e+r;if(i<l)i=l;return i};var y=function e(t,n,r){if(!r)r=TS.model.dnd.team;if(t===TS.model.user.id){if(n.dnd_enabled){TS.model.dnd.next_dnd_start_ts=n.next_dnd_start_ts;TS.model.dnd.next_dnd_end_ts=n.next_dnd_end_ts}else{TS.model.dnd.next_dnd_start_ts=null;TS.model.dnd.next_dnd_end_ts=null}if("snooze_enabled"in n)TS.model.dnd.snooze_enabled=n.snooze_enabled;if("snooze_endtime"in n)TS.model.dnd.snooze_endtime=n.snooze_endtime}if(n.dnd_enabled)r[t]={next_dnd_start_ts:n.next_dnd_start_ts,next_dnd_end_ts:n.next_dnd_end_ts};else r[t]={next_dnd_start_ts:null,next_dnd_end_ts:null}};var w=false;var k=function e(t){if(w)return;w=true;if(m)TS.metrics.count("dnd_lookup_lazy",t.length);var n=_.map(t,"id").join(",");return TS.api.call("dnd.teamInfo",{users:n},function(e,t){w=false;if(!e){TS.warn("dnd.teamInfo failed for a multi-user request");return}if(t.users)_.forOwn(t.users,function(e,t){y(t,e)})},true)};var x=[];var C=function e(t){if(-1!==x.indexOf(t.id))return;x.push(t.id);if(x.length>1)return;return new Promise(function(e,t){setTimeout(function(){var r=x;x=[];var i="dnd.info";var a={user:r[0]};if(r.length>1){i="dnd.teamInfo";a=r.length>n?{}:{users:r.join(",")}}if(m)TS.metrics.count("dnd_lookup_lazy",r.length);TS.api.call(i,a,function(n,i){if(!n){if(r.length>1)TS.warn("dnd.teamInfo failed for a multi-user request (bundled single-user fetches)");else{TS.warn("dnd.info failed for "+r[0]);t(new Error("dnd.info failed for "+r[0]))}return}if(i.users)_.forOwn(i.users,function(e,t){y(t,e)});else y(r[0],i);e()},true)},1e3*l)})};var M=function e(t){if(t.is_self)return TS.model.dnd.next_dnd_start_ts;var n=TS.model.dnd.team[t.id];if(!n)return null;return n.next_dnd_start_ts};var I=function e(t){if(t.is_self){if(TS.model.dnd.snooze_enabled)return TS.model.dnd.snooze_endtime;return TS.model.dnd.next_dnd_end_ts}var n=TS.model.dnd.team[t.id];if(!n)return null;return n.next_dnd_end_ts};var A=function e(t,n){if(!n)n=E();var r=M(t);var i=I(t);if(r&&i)if(r>n&&r<i)return r;if(i){if(i>n)return i;var a=i+o;if(a>=n)return a}return null};var E=function e(){return Math.floor(Date.now()/1e3)};var F=function e(t){var n=t-E();if(n<0)return TS.i18n.t("0s","dnd")();var r;var i;r=n/3600;if(r>=1){r=Math.floor(r);i=(n-3600*r)/60;i=Math.round(i);if(60===i){r+=1;return TS.i18n.t("{dnd_hours}h","dnd")({dnd_hours:r})}if(0===i)return TS.i18n.t("{dnd_hours}h","dnd")({dnd_hours:r});return TS.i18n.t("{dnd_hours}h {dnd_minutes}m","dnd")({dnd_hours:r,dnd_minutes:i})}i=n/60;if(i>=1){i=Math.round(i);if(60===i)return TS.i18n.t("1h","dnd")();return TS.i18n.t("{dnd_minutes}m","dnd")({dnd_minutes:i})}return TS.i18n.t("{dnd_remaining}s","dnd")({dnd_remaining:n})};var O=function e(t,n){if(!n)n=E();var r=I(t);if(!r||r>n)return false;var i=n-r;if(B(r))return true;return i>=o};var B=function e(t){var n=new Date(1e3*t);var r=n.getSeconds();var i=n.getMinutes();var a=0===r&&(0===i||30===i);return!a};var H=function e(t){TS.log(D,t)};var $=function e(t,n){if(!t)return"<null>";var r=new Date(1e3*t);if(n)return r.toTimeString()+" ("+r.toDateString()+")";return r.toTimeString()};var D=2002})()},4293:function(e,t){(function(){"use strict";TS.registerModule("ui.messages",{onStart:function t(){var n=$("body");n.on("click.msg_action","ts-message",function(t){if(TS.client&&TS.client.ui.checkForEditing(t))return;e(t)});n.delegate("ts-message.dirty_hover_container","mouseenter",function(e){TS.ui.messages.updateMessageHoverContainer($(e.currentTarget))})},maybeUpdateMessageHoverContainer:function e(t){if(!t.length)return;if(t.is(":visible"))TS.ui.messages.updateMessageHoverContainer(t);else t.addClass("dirty_hover_container")},updateMessageHoverContainer:function e(t){t.removeClass("dirty_hover_container");var n=t.data("model-ob-id");var r=n?TS.shared.getModelObById(n):TS.shared.getActiveModelOb();if(!r)return;var i=t.attr("data-ts");var a=TS.utility.msgs.getMsg(i,r.msgs);if(!a&&r._archive_msgs)a=TS.utility.msgs.getMsg(i,r._archive_msgs);if(!a&&TS.model.unread_view_is_showing)a=TS.client.unread.getMessage(r,i);if(!a)a=TS.ui.replies.getActiveMessage(r,i);if(!a)a=TS.client.threads.getMessage(r,i);if(!a){TS.error(i+" not found in "+n);return}var s=t.find("[data-js=action_hover_container]");var o=t.closest("ts-conversation").length>0;var l=t.closest("#threads_msgs").length>0;var u=TS.boot_data.feature_sli_briefing&&t.closest("#sli_briefing").length>0;var d=o||l;var c=!a.thread_ts||a.thread_ts===a.ts;var _="tombstone"===a.subtype&&r.is_channel&&!r.is_member;s.html(TS.templates.action_hover_items({msg:a,actions:TS.utility.msgs.getMsgActions(a,r),ts_tip_delay_class:"ts_tip_delay_60",is_in_threads_view:l,is_in_thread:d,is_root_msg:c,is_briefing_msg:u,hide_actions_menu:_,show_rxn_action:!!s.data("show_rxn_action"),show_reply_action:!!s.data("show_reply_action"),show_comment_action:!!s.data("show_comment_action"),abs_permalink:s.data("abs_permalink")}));s.toggleClass("narrow_buttons",s.children().length>3)}});var e=function e(t){if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();t.preventDefault();return}var n=$(t.target);var r=n.closest("[data-action]");if(r.length){var i=n.closest("ts-message");var a=i.data("model-ob-id");var s=a?TS.shared.getModelObById(a):TS.shared.getActiveModelOb();var o=i.attr("data-ts");var l=TS.utility.msgs.getMsg(o,s.msgs);var u=r.data("action");var d=false;if(!l){l=TS.utility.msgs.getMsg(o,s._archive_msgs);if(l)d=true}if(!l)l=TS.ui.replies.getActiveMessage(s,o);if(!l&&TS.model.threads_view_is_showing)l=TS.client.threads.getMessage(s,o);if(!l&&TS.model.unread_view_is_showing){l=TS.client.unread.getMessage({id:a},o);if(l){var c=TS.client.unread.getGroup(a);if(c)s=c.model_ob;else if(TS.highlights_briefing){var _=TS.highlights_briefing.getMessageFromCache(a,o);if(_)s=TS.shared.getModelObById(_.channel_id)}}}if(!l){TS.error("WTF no message to click?");return}var m=TS.rxns.getRxnKeyByMsgType(l);var f;switch(u){case"actions_menu":if(d)TS.menu.startWithMessageActions(t,i.data("ts"),s._archive_msgs,s);else TS.menu.startWithMessageActions(t,i.data("ts"),s.msgs,s);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_actions_menu_button"}}});break;case"reaction":if(TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_emoji_reaction");TS.ui.react_emoji_menu.start({e:t,rxn_key:m});TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_reaction_button"}}});break;case"pin":TS.pins.startPinMessage(o,s);break;case"unpin":TS.pins.unPinMessage(o,s);break;case"edit":TS.msg_edit.startEdit(o,s);break;case"delete":TS.msg_edit.startDelete(o,s);break;case"mark_unread":TS.info("_msgActionHandler: setting unread point on "+s.id+", ts = "+o+" (mark_unread)");TS.client.msg_pane.setUnreadPoint(o);break;case"reply":if(i.length){if(TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_reply");f=l.thread_ts||l.ts;if(TS.boot_data.feature_message_replies_inline)TS.ui.thread.startInlineThread(s,l,i);else TS.ui.replies.openConversationFromMessagePane(i,s,f)}TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_reply_button"}}});break;case"open_in_channel":if(TS.web){var p=TS.utility.msgs.constructMsgPermalink(s,o);window.location=p}else if(TS.client){if(TS.model.threads_view_is_showing)TS.client.ui.threads.trackThreadsViewClosed("OPEN_IN_CHANNEL");f=l.thread_ts||l.ts;TS.client.ui.tryToJump(s.id,f)}break;case"open_in_channel_from_briefing":if(TS.boot_data.feature_sli_briefing&&TS.highlights_briefing)TS.highlights_briefing.jumpToMessageInChannel(s.id,l.thread_ts||l.ts);break;case"open_conversation":break;case"copy_link":var h=TS.i18n.t("Copied!","messages_action_items")();TS.tips.updateFloater({title:h,classes_to_add:["success"]});TS.clipboard.writeText(r.data("permalink"));break;case"comment":if(TS.client){t.preventDefault();var g=TS.boot_data.feature_file_threads?"file_share_msg":"";var S=TS.boot_data.feature_file_threads?a:null;TS.client.ui.files.previewFile(l.file.id,g,false,true,S)}break;case"share_message":if(TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_share_message");TS.ui.share_message_dialog.start(l.ts,s);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_share_button"}}});break;case"add_handy_rxn":var T=r.data("name");var v=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(m),T);if(v)i.addClass("just_added_handy_rxn_from_actions");TS.rxns.changeRxnsFromUserAction(m,T,v);break;case"share_file":var b=l.file;if(!b)return;if(TS.client)TS.view.files.shareInCurrentChannelOrIM(b.id,a);else TS.ui.share_dialog.start(b.id);break;default:TS.error("WTF no action?")}}}})()},4294:function(e,t){(function(){"use strict";TS.registerModule("click",{onStart:function e(){n();t()},addHandler:function t(n,r,i){if(_.isFunction(n)){i=r;r=n;n=null}e.push({selector:n,fn:r,prevent_on_drag:i||false})},addClientHandler:function e(){if(!TS.client)return;return TS.click.addHandler.apply(this,arguments)},addWebHandler:function e(){if(!TS.web)return;return TS.click.addHandler.apply(this,arguments)},test:function r(){return{addAll:t,setupBinding:n,handlers:function t(){return e},resetHandlers:function t(){e=[]},unbind:function e(){$("body").off("click.ts_dot_click");$("body").off("mousedown.ts_dot_click_mousedown")}}}});var e=[];var t=function e(){TS.click.addClientHandler("#archive_msg_lim_btn, #archive_msg_lim_btn_treatment, #msg_lim_header_btn, #msg_lim_header_btn_treatment",function(e,t){TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"click",ui_element:t.data("data-clog-ui-element")}}})});TS.click.addClientHandler(function(e){if(TS.client.ui.checkForEditing(e))e.preventDefault()});TS.click.addWebHandler("#msgs_div",function(e){if(!TS.utility.isSpaceClickEventSafe(e))e.preventDefault()});TS.click.addClientHandler("#msgs_div .message[data-ts]",function(e){var t=$(e.target);var n=t.closest(".message").data("ts");if(n)n=n.toString();var r=TS.shared.getActiveModelOb();if(!n)return;if(e.altKey){e.preventDefault();TS.info("setting unread point on "+r.id+" due to alt+click on message with ts = "+n);TS.client.msg_pane.setUnreadPoint(n);return}if(TS.utility.cmdKey(e)&&e.shiftKey){e.preventDefault();var i=TS.utility.msgs.getMsg(n,r.msgs);TS.dir(0,i);if(r.is_im)TS.ui.growls.growlImMessage(r,i,false,true);else TS.ui.growls.growlChannelOrGroupMessage(r,i,false,true)}});TS.click.addClientHandler("ts-message .resend_temp_msg, ts-message .remove_temp_msg",function(e,t){var n=t.closest("ts-message");var r=n.attr("data-ts");if(!r)return;var i=n.attr("data-model-ob-id");var a=TS.shared.getModelObById(i);if(!a)return;e.preventDefault();var s=t.hasClass("resend_temp_msg");TS.utility.msgs.handleFailedMsgSend(r,a,s)});TS.click.addClientHandler(".top_results_search_message_result",function(e,t,n){var r=$(e.target);var i=r.closest(".search_message_result");var a=i.data("module-name")||"";var s=i.data("module-order")||0;var o=r.closest("ts-message");var l=o.data("iid")||"";if(r.attr("href"))return;if(r.parents(".rxn").length)return;var u=false;r.parentsUntil(".top_results_search_message_result").each(function(){if($(this).attr("href"))u=true});if(u)return;var d=TS.search.view.getMatchForSearchResult(t);if(!d)return;var c=d.match;e.preventDefault();if(TS.boot_data.page_needs_enterprise)if(c.team&&TS.model.team.id!=c.team&&!c.channel.is_shared&&c.permalink)TS.utility.openInNewTab(c.permalink,"_blank");var _=c.channel&&c.channel.id?c.channel.id:c.channel;var m=TS.shared.getModelObById(_);var f=c.thread_ts;if(f&&f!=c.ts){TS.ui.replies.openConversation(m,f,c.ts,n);return}var p={click_target_type:"top_results_jump_body",click_position:d.index,click_user_id:c.user,click_channel_id:c.channel.id,click_timestamp:c.ts,click_module_name:a,click_module_position:s,click_sort:TS.search.sort};if(TS.search.last_request_id)p.request_id=TS.search.last_request_id;if(l)p.click_iid=l;TS.clog.track("SEARCH_CLICK",p);TS.client.ui.tryToJump(_,c.ts)});TS.click.addClientHandler(".search_message_result a, .search_message_result button",function(e,t){var n=$(e.target);var r=TS.search.view.getMatchForSearchResult(t);if(!r)return;var i=r.match;var a;var s;var o;var l=n.closest(".search_message_result");var u=l.data("module-name")||"";var d=l.data("module-order")||0;var c=l.data("iid")||"";var _=n.closest("ts-message");var m=_.data("iid")||c;var f;if(n.hasClass("jump"))a="top_results_jump";else if(n.hasClass("search_jump"))a="jump";else if(n.hasClass("archive"))a="archive";else if(n.is(".channel_link, .internal_im_link, .mpim_link, .group_link"))a="channel";else if(n.hasClass("message_sender")){a="sender";f=n.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else if(n.hasClass("timestamp")){a="timestamp";f=n.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else if(n.hasClass("star")){a="star";f=n.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else if(n.attr("href")||n.attr("onclick"))a="link";if(a){var p={click_target_type:a,click_position:r.index,click_user_id:i.user,click_channel_id:i.channel.id,click_timestamp:i.ts,click_target_user_id:s,click_target_timestamp:o,click_module_name:u,click_module_position:d,click_sort:TS.search.sort};if(TS.search.last_request_id)p.request_id=TS.search.last_request_id;if(m)p.click_iid=m;TS.clog.track("SEARCH_CLICK",p)}});TS.click.addClientHandler(".search_message_result .sli_feedback",function(e,t){e.preventDefault();var n=$(e.target);var r=TS.search.view.getMatchForSearchResult(t);if(!r)return;var i={};var a="";var s={plus:TS.i18n.t('Search result is relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")(),circle:TS.i18n.t('Search result is somewhat relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")(),minus:TS.i18n.t('Search result is not relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")()};if(n.is(".selected")){i.undo=true;if(n.is(".sli_feedback_plus"))a=s.plus;else if(n.is(".sli_feedback_circle"))a=s.circle;else if(n.is(".sli_feedback_minus"))a=s.minus}else a=TS.i18n.t('oops!<br><span class="subtle_silver">remove my feedback</span>',"clicks")();TS.tips.updateTipTitle(n,a);n.toggleClass("selected");n.siblings(".sli_feedback").each(function(){$(this).removeClass("selected");var e="";if($(this).is(".sli_feedback_plus"))e=s.plus;else if($(this).is(".sli_feedback_circle"))e=s.circle;else if($(this).is(".sli_feedback_minus"))e=s.minus;TS.tips.updateTipTitle($(this),e)});if(n.is(".sli_feedback_plus"))i.value=5;else if(n.is(".sli_feedback_circle"))i.value=1;else if(n.is(".sli_feedback_minus"))i.value=-5;i.channel_id=r.match.channel.id;i.message_id=r.match.ts;i.permalink=r.match.permalink;i.query=TS.search.view.latest_msg_search_results.query;i.search_sort=TS.search.sort;i.search_exclude_bots=TS.model.prefs.search_exclude_bots;i.search_only_current_team=TS.model.prefs.search_only_current_team;i.search_exclude_channel=TS.model.prefs.search_exclude_channels;i.search_only_my_channels=TS.model.prefs.search_only_my_channels;TS.api.call("search.feedback",i)});TS.click.addClientHandler("ts-message .message_body a, ts-message .file_container a",function(e,t){var n;var r;var i;var a;var s;var o;var l;var u;var d;var c;var m;var f=$(e.target);n=t.closest("ts-message");r=""+n.data("ts");i=n.data("model-ob-id");var p=r&&i?TS.utility.msgs.findMsg(r,i):null;a=n.data("member-id");s=n.data("app-id");o=n.data("bot-id");l=t.data("referer-original-href")||t.attr("href");u={message_timestamp:r,channel_id:i,channel_type:i?i.charAt(0):"",member_id:a,app_id:s,bot_id:o,url:l||""};var h=TS.utility.msgs.extractMsgDisplayContext(n);if(h){u.link_origin=h;var g=null;if("briefing"==h&&TS.highlights_briefing)g=TS.highlights_briefing.last_request_id;else if("all_unreads"==h&&TS.client.unread)g=TS.client.unread.last_request_id;if(g)u.request_id=g}var S=TS.utility.msgs.isRawLink(f,l);if(S)u.link_is_raw=true;var T=TS.utility.msgs.extractLinkType(t,f,l);u.link_type=T;var v=TS.utility.msgs.extractLinkAction(t,f);if(v)u.link_action=v;var b=TS.utility.msgs.extractLinkItemId(t,f,T);if(b){u.item_id=b;u.item_type=b.charAt(0);if("channel"===T){var y=TS.channels.getChannelById(b);if(y&&null!==y.is_member)u.is_member=y.is_member}}var w=p&&p.attachments;if(w){var k=t.closest(".attachment_group").length>0;if(k){u.link_is_attachment=true;var x=TS.utility.msgs.extractLinkAttachmentField(t);if(x)u.link_attachment_field=x}}if(TS.model.unread_view_is_showing){_.merge(u,TS.client.ui.unread.getTrackingData(r));TS.client.ui.unread.incrementTrackingSeqId()}d=t.closest(".msg_inline_img_holder").length>0;c=t.attr("data-file-id");if(!c)c=t.closest("[data-file-id]").attr("data-file-id");m=c?TS.files.getFileById(c):null;if("gdrive"===_.get(m,"external_type")){if(!u.contexts)u.contexts={};if(!u.contexts.platform)u.contexts.platform={};u.contexts.platform.service_type="GSUITE";u.contexts.platform.app_id=9;u.contexts.platform.has_rich_preview=TS.files.fileHasRichPreview(m)}if(d||m&&TS.files.fileIsImage(m))TS.clog.track("MSG_PHOTO_EXPAND",u);TS.clog.track("MSG_LINK_CLICKED",u);var C=TS.utility.url.urlQueryStringParse(l).state;C=C?C.match(/(\{.*\})/g):null;C=C?C[0]:null;C=C?JSON.parse(C):null;if(C&&C.is_external_auth_url){var M="auto"===C.ask?"PLATFORM_APPS_TARGETED_SUGGESTIONS_SELECTED":"PLATFORM_APPS_TARGETED_SUGGESTIONS_JUST_THIS_ONCE_SELECTED";TS.clog.track(M,{app_id:C.service_type_id})}});TS.click.addClientHandler("ts-message .msg_inline_video_buttons_div .msg_inline_video_play_button",function(e,t){var n=t.closest("ts-message");var r=""+n.data("ts");var i=n.data("model-ob-id");var a=n.data("member-id");var s=n.data("app-id");var o=n.data("bot-id");var l=n.find(".msg_inline_video_new_window_button");var u=l.data("referer-original-href");var d=u||l.attr("href");var c={message_timestamp:r,channel_id:i,channel_type:i?i.charAt(0):"",member_id:a,app_id:s,bot_id:o,url:d||""};TS.clog.track("MSG_VIDEO_PLAY",c)});TS.click.addClientHandler(".member_preview_link, .member_preview_image",function(e,t,n){e.preventDefault();var r=t.closest("#member_preview_scroller");var i=t.data("member-id");if(i){if(e.shiftKey){e.preventDefault();var a=TS.members.getMemberById(i);TS.dir(0,a)}if(r.length&&i==TS.model.previewed_member_id)TS.menu.member.startWithMember(e,i);else if(r.length)TS.menu.member.startWithMember(e,i,true);else if("mentions"===n||"search_results"===n||"conversation"===n||"threads"===n){if("search_results"===n&&t.closest('[data-expert-search-module-name="experts"]').length)TS.sli_expert_search.handleExpertsClick(e,"experts","user");TS.menu.member.startWithMember(e,i)}else{var s=t.closest("#msgs_div, #archives_msgs_div, #unread_msgs_div, #sli_briefing");var o=t.closest("#all_members_container").length>0;if(TS.ui.share_dialog.showing)TS.ui.share_dialog.div.modal("hide");if(s.length||o)TS.menu.member.startWithMember(e,i);else TS.client.ui.previewMember(i,n||"team_list")}var l=t.closest("ts-message");var u=""+l.data("ts");var d=l.data("model-ob-id");i=l.data("member-id");var c=l.data("app-id");var _=l.data("bot-id");var m={message_timestamp:u,channel_id:d,channel_type:d?d.charAt(0):"",member_id:i,app_id:c,bot_id:_};TS.clog.track("USERNAME_CLICK",m)}else TS.warn("hmmm, no data-member-id?")});TS.click.addClientHandler(".app_profile a, .app_profile_slash_command",function(e,t){var n=t.closest(".app_profile");TS.clog.track("USER_PROFILE_CLICK",{app_id:n.data("app_id"),bot_id:n.data("bot_id")})});TS.click.addClientHandler('.bot_message .message_body a[href*="admin/billing"]',function(){TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"slackbot",action:"click",ui_element:"billing_link"}}})});TS.click.addClientHandler(".member_details a",function(e,t){if(!t.hasClass("member_preview_menu_target"))TS.clog.track("USER_PROFILE_CLICK")});TS.click.addClientHandler(".member",function(e,t){e.preventDefault();var n=t.data("member-id");if(n)TS.menu.member.startWithMember(e,n);else TS.warn("hmmm, no data-member-id?")});TS.click.addClientHandler(".theme_installer_btn",function(e,t){e.preventDefault();var n=t.data("theme");var r=false;if(n){n=n.replace(/ /g,"");n=n.replace(/,$/g,"");var i=n.split(",");n={column_bg:i[0],menu_bg:i[1],active_item:i[2],active_item_text:i[3],hover_item:i[4],text_color:i[5],active_presence:i[6],badge:i[7]};TS.prefs.last_theme_selected_in_UI="custom_theme";TS.prefs.setMultiPrefsByAPI({sidebar_theme:TS.prefs.last_theme_selected_in_UI,sidebar_theme_custom_values:JSON.stringify(n)});TS.model.prefs.sidebar_theme=TS.prefs.last_theme_selected_in_UI;TS.prefs.setSidebarThemeCustomValues(n);TS.view.prefs.sidebarThemePrefChanged(r)}});TS.click.addClientHandler(".internal_im_link",function(e,t){e.preventDefault();TS.ims.startImByMemberId(t.data("member-id"))});TS.click.addClientHandler(".group_link, .internal_group_link",function(e,t){e.preventDefault();TS.view.onGroupReferenceClick(e,t.data("group-id"))});TS.click.addClientHandler(".internal_im_call_link",function(e,t){if(!TS.utility.calls.isEnabled())return;e.preventDefault();TS.utility.calls.startCallInModelOb(TS.members.getMemberByName(t.data("member-name")))});TS.click.addClientHandler(".file_viewer_link",function(e,t){e.preventDefault();if(t.hasClass("file_viewer_channel_link"))TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:t.data("file-id"),show_control_btns:!t.closest("#file_preview_container").length})});TS.click.addClientHandler(".file_viewer_external_link",function(e,t){e.preventDefault();TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:t.data("file-id"),current_external_link:t[0]})});TS.click.addHandler(".inline_attachment.clickable, .inline_attachment.clickable + .reply_broadcast_rule",function(e,t){var n=["a",".media_caret",".delete_attachment_link",".msg_inline_video_buttons_div"].join(",");if($(e.target).closest(n).length)return;var r;if(t.is(".reply_broadcast")||t.closest(".reply_broadcast_rule").length)r=t.closest(".message_body").find('[data-action="open_conversation"]');else r=t.find(".attachment_from_url_link");if(r[0])r[0].click()},true);TS.click.addClientHandler(".internal_file_list_filter",function(e,t){e.preventDefault();TS.client.ui.files.showFileList();TS.client.ui.files.toggleFileList(t.data("file-list-filter"))});TS.click.addClientHandler("[data-expert-search-module-name] .channel_link",function(e,t){var n=t.parents("[data-expert-search-module-name]").data("expert-search-module-name");TS.sli_expert_search.handleExpertsClick(e,n,"channel")});TS.click.addClientHandler(".channel_link, .internal_channel_link",function(e,t){e.preventDefault();TS.view.onChannelReferenceClick(e,t.data("channel-id"))});TS.click.addClientHandler(".internal_member_link:not(.plastic_contenteditable_element)",function(e,t){e.preventDefault();if(t.data("member-id"))TS.view.onMemberReferenceClick(e,t.data("member-id"));else if(t.data("member-name"))TS.view.onMemberReferenceClick(e,t.data("member-name"))});TS.click.addClientHandler(".internal_user_group_link",function(e,t){e.preventDefault();TS.view.onUserGroupReferenceClick(e,t.data("user-group-id"))});TS.click.addClientHandler(".file_preview_link, .file_details_container .file_comment_btn, .back_from_file_comments",function(e,t,n){e.preventDefault();if(TS.ui.share_dialog.showing)TS.ui.share_dialog.div.modal("hide");var r=t.closest("[data-model-ob-id]").attr("data-model-ob-id");var i=t.attr("data-file-id");if(!i)i=t.closest("[data-file-id]").attr("data-file-id");var a=TS.files.getFileById(i);if(a&&a.is_deleted){TS.generic_dialog.alert("<p>"+TS.i18n.t("This file has been deleted.","clicks")()+"</p>");return}if("search_results"===n&&TS.files.fileIsImage(a)){TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:i,show_control_btns:false});return}var s=t.hasClass("file_comment_link");var o=t.hasClass("file_force_flexpane");if(!o){var l=s?"?comments=1":"";if(TS.client.windows.openFileWindow(i,l))return}TS.client.ui.files.previewFile(i,n||"file_list",false,s,r)});TS.click.addClientHandler('#share_dialog [data-action="copy_link"]',function(e,t){var n=t.data("link");if(!n||!TS.clipboard.canWriteText())return;TS.tips.updateFloater({title:TS.i18n.t("Copied!","share_dialog")(),classes_to_add:["success"]});TS.clipboard.writeText(n)});TS.click.addClientHandler(".msg_actions",function(e,t){var n=t.data("msg-ts");if(t.is(t)||t.closest(".msg_cog").length){e.preventDefault();if(TS.model.archive_view_is_showing){var r=TS.client.archives.getCurrentModelOb()||{};TS.menu.startWithMessageActions(e,n,r._archive_msgs)}else TS.menu.startWithMessageActions(e,n,TS.shared.getActiveModelOb().msgs)}});TS.click.addClientHandler(".comment_actions",function(e,t){var n=$(e.target);if(n.hasClass("comment_cog")){e.preventDefault();TS.menu.startWithCommentActions(e,t.data("file-id"),t.data("comment-id"))}});TS.click.addHandler(".file_actions",function(e,t){e.preventDefault();TS.menu.file.startWithFileActions(e,t.data("file-id"))});TS.click.addClientHandler(".file_ssb_download_link",function(e,t){var n=!(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing);var r=TS.files.getFileById(t.data("file-id"));var i={is_successful:false};if(r){i.is_successful=true;var a=TS.members.getMemberById(r.user);if(a&&a.is_bot){var s=a.profile.bot_id;var o=TS.bots.getBotById(s);i.app_id=o?o.app_id:"";i.bot_id=s}}TS.clog.track("FILE_DOWNLOAD",i);if(r&&TS.client.downloads.startDownload(r,n))e.preventDefault()});TS.click.addClientHandler(".msg_jump, .star_jump",function(e,t,n){e.preventDefault();var r=""+t.closest("[data-ts]").data("ts");if(!r){TS.error("error no msg_id to jump to?");return}var i=t.data("cid");var a=TS.shared.getModelObById(i);var s=t.closest("[data-thread-ts]").attr("data-thread-ts");if(s&&s!=r){TS.ui.replies.openConversation(a,s,r,n);return}TS.client.ui.tryToJump(i,r)});TS.click.addClientHandler(".search_message_result .search_jump",function(e,t,n){var r=TS.search.view.getMatchForSearchResult(t);if(!r)return;var i=r.match;e.preventDefault();var a=TS.search.view.firstResultWithExtracts(i);var s=i.channel&&i.channel.id?i.channel.id:i.channel;var o=TS.shared.getModelObById(s);var l=a.thread_ts;if(l&&l!=a.ts){TS.ui.replies.openConversation(o,l,a.ts,n);return}TS.client.ui.tryToJump(s,a.ts)});TS.click.addWebHandler("#msgs_div.selecting_messages ts-message",function(e){var t=$(e.target);if(t.attr("href")||t.hasClass("star"))return;var n=t.closest("ts-message");var r=n.find(".msg_select_cb");if(!t.is("input"))r.prop("checked",!r.prop("checked"));TS.msg_edit.batchDeleteSelectionChanged(r,e.shiftKey)});TS.click.addHandler(TS.rxns.checkForRxnClick);TS.click.addHandler(TS.stars.checkForStarClick);TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_imgs.checkForInlineImgClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_videos.checkForInlineVideoClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_audios.checkForInlineAudioClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_others.checkForInlineOtherClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_attachments.checkForInlineAttachmentClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(TS.inline_file_previews.checkForInlineFilePreviewClick);TS.click.addHandler(TS.inline_room_previews.checkForInlineRoomPreviewClick);TS.click.addClientHandler(".file_list_item",function(e,t,n){var r;var i=$(e.target);var a=t.data("file-id");var s=t.parent().children().index(t);var o={click_target_type:"file",click_position:s,click_file_id:a,click_module_name:"files",click_module_position:0,click_sort:TS.search.getSort("search.files"),request_id:TS.search.last_files_request_id};TS.clog.track("SEARCH_CLICK",o);r=!TS.menu.file.file_list_menu_up&&!i.is(".star")&&!i.closest("a").length&&!i.closest("button").length;if(r){e.preventDefault();if(TS.files.fileIsImage(a)){TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:a,show_control_btns:false});return}if(TS.ui.share_dialog.showing)TS.ui.share_dialog.div.modal("hide");TS.client.ui.files.previewFile(t.data("file-id"),n||"file_list",false)}});TS.click.addClientHandler("a.file_share, button.file_share",function(e,t){e.preventDefault();TS.view.files.shareInCurrentChannelOrIM(t.data("file-id"))});TS.click.addClientHandler(".snippet_edit_dialog_link",function(e,t){var n=TS.files.getFileById(t.data("file-id"));if(!n.is_truncated){e.preventDefault();TS.ui.snippet_dialog.startEdit(n.id)}});TS.click.addClientHandler(".file_new_window_link",function(e,t){if(TS.client.windows.openFileWindow(t.data("file-id"),""))e.preventDefault();else TS.utility.welcome_post.clogWelcomePostOpen(t)});TS.click.addClientHandler("a.show_parent_replies, a.show_replies, .reply_bar",function(e,t,n){e.preventDefault();var r=t.closest("ts-message");var i=r.attr("data-thread-ts");if(!i)return;var a=r.attr("data-model-ob-id");var s=TS.shared.getModelObById(a);if(!s)return;TS.ui.replies.openConversationFromMessagePane(r,s,i,null,n)});TS.click.addWebHandler(".reply_bar",function(e,t){var n=$(e.target);if(!n.is("a")){var r=t.closest("ts-message");var i=r.attr("data-thread-ts");if(!i)return;var a=r.attr("data-model-ob-id");var s=TS.shared.getModelObById(a);if(!s)return;var o=TS.utility.msgs.constructConversationPermalink(s,i);window.open(o)}});TS.click.addClientHandler('[data-action="open_conversation"]',function(e,t,n){e.preventDefault();var r=t.attr("data-model-ob-id");var i=TS.shared.getModelObById(r);if(!i)return;var a=t.attr("data-thread-ts");if(!a)return;var s=t.attr("data-ts");TS.ui.replies.openConversation(i,a,s,n)});TS.click.addClientHandler("#mentions_clear_notifications",function(e){e.preventDefault();TS.replies.markAllThreads()});TS.click.addClientHandler("#reply_container .reply_send, #file_reply_container .reply_send",function(e,t){e.preventDefault();TS.ui.replies.submitReply(e,t)});TS.click.addClientHandler("#threads_msgs .reply_send",function(e,t){e.preventDefault();TS.ui.thread.submitReply(e,t)});TS.click.addClientHandler("#reply_container .join_channel_from_thread",function(e,t){e.preventDefault();TS.ui.replies.joinChannelFromThread(e,t)});TS.click.addClientHandler("#threads_msgs .join_channel_from_thread",function(e,t){e.preventDefault();TS.ui.thread.joinChannelFromThread(e,t)});TS.click.addClientHandler(".thread_error_state_refresh_button",function(e){e.preventDefault();TS.client.threads.maybeReloadThreadsView()});TS.click.addClientHandler("#thread_notification_banner .banner_buttons .btn",function(e,t){e.preventDefault();var n=t.data("turn-on-pref");var r=$("#thread_notification_banner");var i=r.height();r.height(i);r.addClass("show_confirmation");r.height(92);TS.prefs.setPrefByAPI({name:"seen_threads_notification_banner",value:true});var a=TS.model.prefs.threads_everything!==n;if(a){TS.prefs.setPrefByAPI({name:"threads_everything",value:n});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{threads_everything:n.toString()}})}});TS.click.addClientHandler("#thread_notification_banner .close",function(e){e.preventDefault();var t=$("#thread_notification_banner");var n=t.height();t.height(n);t.height(0);if(!TS.model.prefs.seen_threads_notification_banner)TS.prefs.setPrefByAPI({name:"seen_threads_notification_banner",value:true})});TS.click.addClientHandler("#thread_notification_banner_pref_link",function(e){e.preventDefault();TS.ui.prefs_dialog.start("notifications","#prefs_threads_everything","prefs_notifications")});TS.click.addClientHandler("a.see_all_pins",function(e){if(TS.client&&TS.client.channel_page){e.preventDefault();TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showPinsSection();$("#channel_page_scroller .channel_page_pinned_items").highlight(null,"channel_page_pinned_items_highlighter")}});TS.click.addClientHandler("ts-thread .new_reply_indicator",function(e,t){var n=t.closest("ts-thread");if(!n.length)return;e.preventDefault();var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");TS.client.threads.showNewRepliesAndMarkThread(r,i)});TS.click.addClientHandler("ts-thread .view_all_replies_container",function(e,t){var n=t.closest("ts-thread");if(!n.length)return;e.preventDefault();if(t.hasClass("active"))return;t.addClass("active");var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");TS.client.threads.showPreviousReplies(r,i).finally(function(){t.removeClass("active")})});TS.click.addClientHandler("#msgs_div ts-thread .expand_inline_thread",function(e,t){e.preventDefault();var n=t.closest("ts-thread");if(!n.length)return;TS.ui.thread.expandInlineThread(n)});TS.click.addClientHandler("#msgs_div ts-thread .collapse_inline_thread",function(e,t){e.preventDefault();var n=t.closest("ts-thread");if(!n.length)return;TS.ui.thread.collapseInlineThread(n)});TS.click.addClientHandler("a[href]",function(e,t,n){var r;var i;var a=t.attr("href");if(TS.utility.isSlackUrl(a))a=a.toLowerCase();var s=a.indexOf("?")>-1;if(s){r=a.indexOf("?");i=a.slice(0,r)}var o={"/account/settings":true,"/admin":true,"/admin/billing":true,"/admin/settings":true,"/apps":true,"/customize":true,"/files":true,"/pricing":true,"/stats":true,"/help":true};if(o[a]||o[i]){e.preventDefault();TS.utility.openAuthenticatedInBrowser(a);return}if(TS.client.archives.maybeHandleArchiveLink(t,n)){if(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing)TS.ui.fs_modal.close();e.preventDefault();return}if(TS.utility.calls.maybeHandleCallLink(t)){e.preventDefault();return}if(!t.attr("target")&&0!==a.indexOf("skype:")){e.preventDefault();TS.utility.openInNewTab(a,TS.templates.builders.newWindowName());return}var l=TS.utility.getFileIDFromURL(a);if(l&&TS.client.windows.openFileWindow(l,"")){e.preventDefault();return}if(TS.ui.replies.maybeOpenConversationLink(t,n))e.preventDefault()});TS.click.addClientHandler(".search_message_result",function(e,t){var n=$(this);var r=$(e.target);if(r.attr("href")||r.attr("onclick"))return;if(r.parents().attr("href"))return;if(r.parents(".message").length&&window.getSelection&&window.getSelection().toString())return;if(t.hasClass("top_results_search_message_result"))return;var i=TS.search.view.getMatchForSearchResult(t);if(!i)return;if(n.hasClass("no_extracts"))return;e.preventDefault();TS.search.view.toggleExtractsForMatch(e,i)});TS.click.addClientHandler(".attachment_show_more",function(e,t){var n=TS.shared.getActiveModelOb();var r=t.data("msg-ts").toString();var i=TS.utility.msgs.findMsg(r,n.id);var a=i._shown_attachments;if(Number.isInteger(a)&&a+20<=i.attachments.length)i._shown_attachments+=20;else i._shown_attachments=i.attachments.length;if(r==TS.shared.getLatestMsgTs(n))TS.shared.markReadMsg(n.id,r,TS.model.marked_reasons.viewed);TS.client.msg_pane.rebuildMsgsWithReason("show more attachments")});TS.click.addClientHandler(".attachment_actions_interactions .btn",function(e){e.preventDefault();var t=TS.attachment_actions.handleActionEventAndGetContext($(e.target));if(t){if(TS.boot_data.feature_connecting_shared_channels&&TS.utility.attachments.isSharedChannelRequestMessage(t.message)){i(t);return}if(t.action.confirm)TS.attachment_actions.confirmAction(t.action,function(){TS.attachment_actions.action_triggered_sig.dispatch(t)});else TS.attachment_actions.action_triggered_sig.dispatch(t);var n=["Create a channel","Edit messages","Upload files"];var r=_.startsWith(t.action.name,"slackbot_help");if(_.includes(n,t.action.name)||r)TS.clog.track("GROWTH_HELP_SLACKBOT_V2",{action:"click",click_target:t.action.name,button_position:t.action.id,button_text:t.action.text,locale:TS.i18n.locale()})}});TS.click.addClientHandler("#threads_view_banner .clear_unread_messages",function(e){e.preventDefault();TS.client.threads.markAllNewThreads()});TS.click.addClientHandler("#threads_view_banner",function(e){e.preventDefault();if(TS.client.ui.threads.isAlternativeThreadsViewShowing()){TS.client.threads.maybeReloadThreadsView();return}TS.client.ui.threads.jumpToTop()});TS.click.addClientHandler(".app_preview_link",function(e,t){var n=t.closest("[data-bot-id]");if(TS.model.user.is_restricted||TS.model.user.is_ultra_restricted){var r=t.data("member-name");if(r){e.preventDefault();return TS.view.onMemberReferenceClick(e,r)}return}e.preventDefault();var i=n.data("bot-id");var a=n.data("team-id");var s=""+n.data("ts");var o=n.data("model-ob-id");var l=n.data("member-id");var u=n.data("app-id");if(i&&!a)a=_.get(TS.members.getMemberById(l),"team_id",null);var d={message_timestamp:s,channel_id:o,channel_type:o?o.charAt(0):"",member_id:l,app_id:u,bot_id:i};TS.clog.track("USERNAME_CLICK",d);if(i)if(t.closest(".dm_badge").length>0&&t.hasClass("member_image")){var c=l||_.get(TS.apps.getAppById(u),"bot_user.id");TS.ims.startImByMemberId(c).then(function(){TS.client.ui.app_space.toggleView("about")})}else if(TS.boot_data.feature_shared_channels_client&&a)TS.menu.app.startWithApp(e,i,a);else TS.menu.app.startWithApp(e,i,null,true);else TS.warn("hmm, no data-bot-id?")});TS.click.addClientHandler(".attachment_attribution a",function(e,t){var n=t.data("attribution-bot-id");var r=t.data("attribution-team-id");if(n){e.preventDefault();if(TS.boot_data.feature_shared_channels_client&&r)TS.menu.app.startWithApp(e,n,r);else TS.menu.app.startWithApp(e,n)}else TS.warn("hmm, no data-bot-id?")});TS.click.addHandler("[data-slash-command-autofill]",function(e,t){var n=TS.client.msg_input.$input;var r=TS.utility.contenteditable.value(n);var i=t.data("slash-command-autofill");var a=t.data("app_space_profile_slash_command")?"APP_SPACE_ABOUT_SLASH_COMMAND_CLICK":"APP_PROFILE_SLASH_COMMAND_CLICK";TS.clog.track(a,{app_id:TS.client.ui.app_space.active_app.id,bot_id:TS.client.ui.app_space.app_bot_id,contexts:{core:{app_id:TS.client.ui.app_space.active_app.id,bot_id:TS.client.ui.app_space.app_bot_id}}});if(TS.apps.isAppSpaceEnabled()&&"messages"!==TS.client.ui.app_space.active_view)TS.client.ui.app_space.toggleView("messages");if(!r){TS.utility.contenteditable.clear(n);TS.utility.contenteditable.insertTextAtCursor(n,i);if(!TS.utility.contenteditable.supportsTexty())n.TS_tabComplete("promiseToChoose",void 0,true)}TS.utility.contenteditable.value(n,i+" "+r);TS.utility.contenteditable.cursorPosition(n,i.length+1,r.length);TS.utility.contenteditable.focus(n);if(!TS.utility.contenteditable.supportsTexty())n.trigger("textchange")});if(TS.boot_data.feature_tinyspeck)TS.click.addClientHandler(".recap_highlight_debug",function(e){if("sli_debug_info"===TS.client.highlights.sli_recaps_debug_group){var t;if(TS.model.unread_view_is_showing){var n=$(e.target).parents("ts-message").data("model-ob-id");t=TS.shared.getModelObById(n)}else t=TS.shared.getActiveModelOb();var r=$(e.target).parents("ts-message").data("ts");var i=TS.client.highlights.getHighlight(t.id,r);TS.client.ui.debugger_flexpane.printJSON(i)}});TS.click.addClientHandler("[data-highlight-feedback]",function(e){var t=$(e.target).data("highlight-feedback");var n=$(e.target).closest("ts-message");var r=n.data("model-ob-id");var i=n.data("ts");TS.client.highlights.setDefaultFeedbackForHighlight(r,i,{feedback:t},TS.model.unread_view_is_showing?"all-unreads":"in-channel");$("#ts_tip_float_floater .ts_tip_tip").text(TS.i18n.t("Thank you!","highlights")())});TS.click.addClientHandler('[data-js="highlights_feedback_dropdown"]',function(e){var t=$(e.target).closest("ts-message");var n=t.data("model-ob-id");var r=t.data("ts");var i=TS.model.unread_view_is_showing?"all-unreads":"in-channel";TS.client.ui.highlights.openNegativeFeedbackMenu(e,n,r,i)});TS.click.addClientHandler('[data-js="sli_briefing_back_button"]',function(){TS.client.unread.showUnreadView();TS.highlights_briefing.clogBackButton()});TS.click.addClientHandler("[data-js=sli_expert_search_toggle]",function(e){if(TS.sli_expert_search)TS.sli_expert_search.toggleExpand(e)});if(TS.boot_data.feature_sli_channel_insights){TS.click.addClientHandler('[data-js="sli_channel_insights_cta"]',function(){TS.client.ui.channel_insights.open()});TS.click.addClientHandler("[data-js=sli_channel_insights_back]",function(){TS.client.ui.flex.openFlexTab("details")});TS.click.addClientHandler("[data-js=sli_channel_insights_week]",function(e){TS.client.ui.channel_insights.jumpToWeek($(e.target).data("ts"))});TS.click.addClientHandler("#channel_insights_tab .c-channel_insights__debug",function(e){TS.client.ui.channel_insights.debugHighlight($(e.target).data("ts"))})}};var n=function t(){var n={};$("body").on("mousedown.ts_dot_click_mousedown",function(e){n.x=e.clientX;n.y=e.clientY});$("body").on("click.ts_dot_click",function(t){if(t.isDefaultPrevented())return;if(TS.view&&TS.view.maybeFollowLink(t))return;if(TS.isPartiallyBooted()){t.preventDefault();return}var i=$(t.target);if(i.parents("[data-reactroot]").length)return;var s=r(t);var o;var l;for(var u=0;u<e.length;u+=1){o=e[u];l=null;if(o.prevent_on_drag&&(t.clientX!=n.x||t.clientY!=n.y))continue;else if(o.selector){l=i.closest(o.selector);if(!l.length)continue;o.fn(t,l,s);if(t.isDefaultPrevented()&&TS.has_pri[a])TS.log(a,"click on "+o.selector)}else o.fn(t,s);if(t.isDefaultPrevented())return}})};var r=function e(t){var n=$(t.target);if(n.closest("#search_results_container").length)return"search_results";if(n.closest("#member_stars_list").length)return"starred_items";if(n.closest("#member_mentions").length)return"mentions";if(n.closest("#file_list").length)return"file_list";if(n.closest("#file_preview_scroller").length)return"file_preview";if(n.closest("#member_preview_scroller").length)return"member_preview";if(n.closest("#convo_scroller").length)return"conversation";if(n.closest("#groups_tab").length)return"groups";if(n.closest("#threads_msgs_scroller_div").length)return"threads";if(n.closest("#channel_page_scroller").length){var r=TS.shared.getActiveModelOb();var i="channel_page";if(r.is_group&&!r.is_mpim)i="group_page";else if(r.is_im||r.is_mpim)i="im_page";return i}return null};var i=function e(t){var n=TS.utility.attachments.getSharedChannelInviteIdFromContext(t);if(!n)return;if("approve"===t.action.value)TS.ui.share_channel_dialog.showApproveRequestDialog({invite_id:n});else if("decline"===t.action.value)TS.api.call("channels.declineSharedInvite",{invite_id:n})};var a=2003})()},4297:function(e,t){(function(){"use strict";TS.registerModule("sorter",{onStart:function e(){},search:function e(t,n,r){return l(t,n,r)},printTest:function e(t,n){var r=TS.members.getActiveMembersWithSlackbotAndNotSelf();var i;var a;var s;var o=_.values(TS.boot_data.other_accounts);var l=TS.user_groups.getActiveUserGroups();var u=TS.model.emoji_map;var d=TS.utility.members.getBroadcastKeywordsForUser();var c=TS.model.NAMED_VIEWS;i=_.reject(TS.redux.channels.dangerouslyGetChannelsForUser(),"is_archived");a=_.reject(TS.redux.channels.dangerouslyGetGroups(),"is_archived");s=TS.channels.getAllVisibleMpimsForUser(TS.redux.channels.dangerouslyGetMpims());var m={members:r,channels:i,groups:a,mpims:s,teams:o,usergroups:l,emoji:u,broadcast_keywords:d,views:c};TS.sorter.search(t,m,_.extend({print:true},n))},test:function e(){var r={sortFuzzy:c,frecencyBonusPoints:m,getFilteredMatchesForFrecency:u,scoreMember:a,_scoreUserGroup:s,getSubQueryMatchers:t};Object.defineProperty(r,"_meta_fields",{get:function e(){return n},set:function e(t){n=t}});return r}});var e=function e(n,i){i=i||{};var l=null!=i.fuzzy_limit?i.fuzzy_limit:10;n=TS.i18n.deburr(n.toLocaleLowerCase());var u="@"===n.charAt(0);var d="#"===n.charAt(0);var c=":"===n.charAt(0);if(u||d||c)n=n.substring(1);var m={fuzzy_limit:l};var f={fuzzy_limit:l,search_forward_only:true};var p={fuzzy_limit:l,substrings_only:true,match_emoji_keywords:i.match_emoji_keywords};var h=TS.fuzzy.makeFuzzyMatcher(n,m);var g=TS.fuzzy.makeFuzzyMatcher(n,f);var S=t(n,f);var T=TS.fuzzy.makeFuzzyMatcher(n,p);return{query:n,only_channels:d,only_members:u,only_emoji:c,matchesChannel:function e(t){if(u||c)return false;if((i.allow_empty_query||d)&&!n){r(t.id,"jumper_score",0);return true}var a=h.score(t.name_normalized||t.name);r(t.id,"jumper_score",a);if(i.search_previous_channel_names&&t.previous_names&&t.previous_names.length){var s=_.map(t.previous_names,function(e){return{score:h.score(e),name:e}});r(t.id,"jumper_previous_name_scores",s);var o=_.some(s,function(e){return e.score<=l});var m=o&&a>l;if(m){var f=_.minBy(s,"score");t._jumper_previous_name_match=f&&f.name}else t._jumper_previous_name_match=null;return a<=l||o}return a<=l},matchesGroup:function e(t){if(d||u||c)return false;if(i.allow_empty_query&&!n){r(t.id,"jumper_score",0);return true}var a=h.score(t.name_normalized||t.name);r(t.id,"jumper_score",a);return a<=l},matchesMember:function e(t){if(d||c)return false;if((i.allow_empty_query||u)&&!n){r(t.id,"jumper_score",0);return true}var s=a(t,g,n,u);r(t.id,"jumper_score",s);return s<=l},matchesMpim:function e(t){if(d||u||c)return false;if(i.allow_empty_query&&!n){r(t.id,"jumper_score",0);return true}var s=TS.mpims.getMembersInDisplayOrder(t);s=_.compact(s);var o=S.map(function(e){var t=s.map(function(t){return a(t,e)});return _.min(t)});var m=_.sum(o);r(t.id,"jumper_score",m);return m<=l},matchesTeam:function e(t){if(d||u||c)return false;var n=h.score(t.team_name.toLocaleLowerCase());r(t.id,"jumper_score",n);return n<=l},matchesUserGroup:function e(t){if(d||c)return false;if((i.allow_empty_query||u)&&!n){r(t.id,"jumper_score",0);return true}var a=s(t,h);r(t.id,"jumper_score",a);return a<=l},matchesEmoji:function e(t){if(d||u)return false;if(i.allow_empty_query&&!n){r(t.id,"jumper_score",0);return true}var a=TS.i18n.deburr(t.display_name||t.name);var s=T.score(a);if(t.display_name&&t.display_name!==t.name){var o=T.score(t.name);if(o<s)s=o}r(t.id,"jumper_score",s);return s<=l},matchesBroadcastKeyword:function e(t){if(d||c)return false;if((i.allow_empty_query||u)&&!n){r(t.id,"jumper_score",0);return true}var a=o(t,h);r(t.id,"jumper_score",a);return a<=l},matchesView:function e(t){if(d||c)return false;var n=h.score(t.name.toLocaleLowerCase());if(Infinity===n&&t.alt_names)n=_.reduce(t.alt_names,function(e,t){return Math.min(e,h.score(t.toLocaleLowerCase()))},n);r(t.id,"jumper_score",n);return n<=l}}};var t=function e(t,n){var r=t.split(/[,| ]/).filter(function(e){return!!e});return r.map(function(e){e="@"===e.charAt("0")?e.substring(1):e;return TS.fuzzy.makeFuzzyMatcher(e,n)})};var a=function e(t,n,r,i){var a;if(TS.utility.queryIsMaybeSelf(r)&&t.is_self)return 0;if(TS.boot_data.feature_name_tagging_client){var s=Infinity;var o=Infinity;var l=Infinity;var u=Infinity;s=n.score(t._real_name_lc);if(t._real_name_lc!==t._real_name_normalized_lc)o=n.score(t._real_name_normalized_lc);if(t._display_name_lc){l=n.score(t._display_name_lc);if(t._display_name_lc!==t._display_name_normalized_lc)u=n.score(t._display_name_normalized_lc)}a=Math.min(s,o,l,u)}else{var d=Infinity;var c=Infinity;var _=Infinity;d=n.score(t.name);if(t._real_name_lc&&!i){c=n.score(t._real_name_lc);if(t._real_name_lc!==t._real_name_normalized_lc)_=n.score(t._real_name_normalized_lc)}a=Math.min(d,c,_)}return a};var s=function e(t,n){var r=Infinity;var i=Infinity;r=n.score(t.name);i=n.score(t.handle);var a=Math.min(r,i);return a};var o=function e(t,n){var r=Infinity;var i=Infinity;r=n.score(t.name);if(t.ms_name!==t.name)i=n.score(t.ms_name);if(!t.alias)return Math.min(r,i);var a=Infinity;a=n.score(t.alias);var s=Math.min(r,i,a);return s};var l=function t(n,a,s){var o=e(n,s||{});var l=[];var d=[];var f=[];var p=[];var h=[];var g=[];var S=[];var T=[];var v=[];var b=[];var y=[];var w=[];var k=[];var x=s.match_emoji_keywords?TS.emoji.findByKeyword(n):[];a.members=a.members||[];a.channels=a.channels||[];a.groups=a.groups||[];a.mpims=a.mpims||[];a.teams=a.teams||[];a.usergroups=a.usergroups||[];a.emoji=a.emoji||[];a.broadcast_keywords=a.broadcast_keywords||[];a.views=a.views||[];if(!o.only_channels&&!o.only_emoji){d=a.members.filter(function(e){if(TS.boot_data.feature_name_tagging_client){if(s.prefer_exact_match&&o.query&&(TS.members.getMemberProfileFieldDisplayName(e).toLocaleLowerCase()===o.query||TS.members.getMemberRealName(e).toLocaleLowerCase()===o.query)){r(e.id,"jumper_exact_match",true);l.push(e);return false}r(e.id,"jumper_exact_match",false)}else if(s.prefer_exact_match&&o.query&&e.name===o.query){r(e.id,"jumper_exact_match",true);l.push(e);return false}r(e.id,"jumper_exact_match",false);return o.matchesMember(e)});b=a.usergroups.filter(function(e){if(s.prefer_exact_match&&e.handle===o.query||e.name_lc===o.query){l.push(e);return false}return o.matchesUserGroup(e)});w=a.broadcast_keywords.filter(function(e){if(s.prefer_exact_match&&e.name===o.query){l.push(e);return false}return o.matchesBroadcastKeyword(e)})}if(!o.only_members&&!o.only_emoji)_.forEach(a.channels,function(e){if(s.prefer_exact_match&&e.name===o.query){r(e.id,"jumper_exact_match",true);l.push(e);return}r(e.id,"jumper_exact_match",false);var t=o.matchesChannel(e);if(!t)return;if(e.is_member)f.push(e);else if(e.is_archived)h.push(e);else p.push(e)});if(!o.only_channels&&!o.only_members&&!o.only_emoji){_.forEach(a.groups,function(e){if(s.prefer_exact_match&&e.name===o.query){r(e.id,"jumper_exact_match",true);l.push(e);return}r(e.id,"jumper_exact_match",false);var t=o.matchesGroup(e);if(!t)return;if(e.is_archived)S.push(e);else g.push(e)});T=a.mpims.filter(function(e){return o.matchesMpim(e)});v=a.teams.filter(function(e){if(s.prefer_exact_match&&e.team_name.toLocaleLowerCase()===o.query){r(e.id,"jumper_exact_match",true);l.push(e);return false}r(e.id,"jumper_exact_match",false);var t=o.matchesTeam(e);return t})}if(!o.only_channels&&!o.only_members)y=a.emoji.filter(function(e){if(s.prefer_exact_match&&(e.display_name||e.name)===o.query){r(e.id,"jumper_exact_match",true);l.push(e);return false}r(e.id,"jumper_exact_match",false);if(s.match_emoji_keywords&&x.length){var t=TS.emoji.nameToBaseName(e.display_name||e.name);if(-1!==x.indexOf(t))return true}return o.matchesEmoji(e)});if(TS.client&&a.views)if(!o.only_channels&&!o.only_members)k=a.views.filter(function(e){if(s.prefer_exact_match&&e.name===o.query){l.push(e);return false}return o.matchesView(e)});var C;var M;var I;C=d.concat(f,g,T,y,b,w,k);C.sort(_.partial(c,true));M=p.concat(v);M.sort(_.partial(c,true));I=S.concat(h);I.sort(_.partial(c,true));var A=C.concat(M,I);var E=A;if(s.prefer_exact_match&&l.length>0)for(var F=0;F<l.length;F+=1)E.unshift(l[F]);if(s.frecency){s.normalize=true;E=TS.ui.frecency.query(E,n,m,s)}if(s.limit)E=_.take(E,s.limit);if(s.frecency)E=u(E);if(s.print){var O="\n";_.forEach(E,function(e){var t=s.frecency?e.model_ob:e;if(s.frecency)O+="["+e.score+"] ";if(null!=i(t.id,"jumper_score"))O+="["+i(t.id,"jumper_score")+"] ";if(t.is_mpim)O+=TS.mpims.getDisplayName(t);else if(t.is_channel)O+="#"+t.name;else if(t.is_group)O+=t.name;else if(t.team_name)O+=t.team_name;else if(t.is_usergroup)O+="@"+t.name;else if(t.presence)O+="@"+t.name;else O+=e.model_ob.name;O+="\n"});TS.info(O)}return E};var u=function e(t){var n=[];if(TS.boot_data.page_needs_enterprise)t=_.uniqBy(t,function(e){return e.id});_.forEach(t,function(e){var t;if(TS.interop.utility.looksLikeMemberId(e.id)){var r=TS.members.getMemberById(e.id);if(r){n.push({model_ob:r,score:e.score});return}}var i=_.find(TS.boot_data.other_accounts,function(t){return t.id===e.id&&t.team_id!=TS.model.team.id});var a=0===e.id.indexOf("BK");var s=0===e.id.indexOf("V");if(i)t=i;else if(a)t=TS.model.getBroadcastKeywordById(e.id);else if(s)t=TS.model.getViewById(e.id);else t=TS.shared.getModelObById(e.id);if(t)n.push({model_ob:t,score:e.score})});return n};var d=function e(t){var n;if(t.is_mpim)n=TS.mpims.getDisplayNameLowerCase(t);else if(t.is_usergroup)n=t.handle;else if(t._name_lc)n=t._name_lc;else if(t.team_name)n=t.team_name.toLocaleLowerCase();else n=t.name;return n};var c=function e(t,n,r){if(n.is_mpim&&!r.is_mpim)return 1;if(r.is_mpim&&!n.is_mpim)return-1;if(!n.is_mpim&&!r.is_mpim){var a=i(n.id,"jumper_score")-i(r.id,"jumper_score");if(0!==a)return a}if(n.is_mpim&&r.is_mpim){var s=i(n.id,"jumper_score")-i(r.id,"jumper_score");if(0!==s)return s;var o=TS.mpims.getMemberCount(n)-TS.mpims.getMemberCount(r);if(0!==o)return o}var l=d(n);var u=d(r);if(t)return TS.i18n.sorter(l,u);if(l>u)return 1;if(u>l)return-1;return 0};var m=function e(t,n){if(t.is_mpim)return 0;var r=0;if(i(t.id,"jumper_exact_match"))r+=TS.ui.frecency.bonus_points.exact_match;else r+=f(t);if(i(t.id,"jumper_previous_name_scores"))r+=TS.ui.frecency.bonus_points.matches_previous_name;if(n.prefer_channel_members&&t.presence)if(n.model_ob&&p(t.id,n.model_ob))r+=TS.ui.frecency.bonus_points.member_of_this_channel;if(t.is_starred)r+=TS.ui.frecency.bonus_points.starred_channel;if(t.is_emoji)if("thumbsup"===t.name||"point_up"===t.name)r+=1;if(t.is_channel||t.is_group){if(t.is_archived)r+=TS.ui.frecency.bonus_points.archived_channel_or_group;if(t.is_channel&&n.prefer_channels_user_belongs_to)if(!t.is_archived&&!p(TS.model.user.id,TS.shared.getModelObById(t.id)))r+=TS.ui.frecency.bonus_points.not_in_channel}if(t.is_usergroup||t.is_broadcast_keyword)r+=TS.ui.frecency.bonus_points.usergroup_or_keyword;return r};var f=function e(t){var n=i(t.id,"jumper_score");if(!_.isFinite(n))return 0;var r=Math.pow(.5,n);return Math.round(TS.ui.frecency.bonus_points.fuzzy_match*r)};var p=function e(t,n){if(n.is_channel&&t===TS.model.user.id)return n.is_member;var r=TS.membership.getUserChannelMembershipStatus(t,n);return r.is_known&&r.is_member}})();var n={};var r=function e(t,r,i){if(!t||!r)return;if(!n[t])n[t]={};n[t][r]=i};var i=function e(t,r){if(!t||!r)return;if(!t||!n[t])return;return n[t][r]}},4299:function(e,t){(function(){"use strict";TS.registerModule("ui.enterprise_shared_channels_invites",{onStart:function e(){TS.ui.validation.register("valid_invite",De)},start:function e(){if(TS.boot_data.page_needs_enterprise)we()}});var e;var t;var n;var r=[];var i;var a=false;var s;var o=false;var l=[];var u=[];var d=[];var c=[];var m;var f=false;var p=function e(n){if(!n)return;var r=D(n,q(n));if(!r)return;t.find('.sci_send_email_container [data-action="replace_sent_emails"]').replaceWith(TS.templates.shared_channels_invites_sent_emails(r))};var h=1e3;var g;var S;var T=1e3;var v;var b=function e(n,r){if(!n)n=false;if(!r)r=false;t.find("#sci_channels_create .input_wrapper .spinner").toggleClass("hidden",n);if(r)y(!n)};var y=function e(n){if(S){clearTimeout(S);S=null}if(!n)n=false;var r=t.find("#sci_channels_create .input_wrapper .available");r.toggleClass("hidden",n);if(!n)S=setTimeout(function(){r.addClass("hidden")},T)};var w=function r(){TS.kb_nav.start(i.find(".list_items"),".channel_browser_row",i,{use_data_ordering:true,px_offset:35,scrollToStartImmediately:function e(){i.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){i.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){if(f)ee($(this),e)});i.find(".list_items").on("click",".channel_browser_row",function(e){ee($(this),e)});t.on("click",'[data-action="sci_to_create"]',xe);t.on("click",'[data-action="sci_channels_create"]',I);t.on("click",'[data-action="sci_cancel"]',Ce);t.on("change",'[type="radio"][name="share_with"]',Oe);t.on("click",'[data-action="sci_show_action"]',Se);var s='#sci_channels_create input[name="channel_name"]';var o=_.debounce(function(e){if(v&&v.isPending()){if(g){clearTimeout(g);g=null}g=setTimeout(function(e){o(e)},h,e);return}$(".validation_message").remove();$('label[for="channel_name"]').removeClass("validation_warning");e.removeClass("validation_warning");var t=false;var n=true;var r=true;var i=false;var a=$('#sci_channels_create [data-action="sci_channels_create"]');b();Ie(null,a,t,n);var s=TS.ui.validation.validate(e);if(s){var l=e.val().trim();v=TS.api.callImmediately("enterprise.nameTaken",{name:l,ignore_local_team:false},function(s,o){if(!s){r=true;i=false;b(r,i);TS.generic_dialog.alert("Something failed! "+o.error)}else{if(o.name_taken){r=true;i=false;b(r,i);n=true;Ie(null,a,t,n);TS.ui.validation.showWarning(e,'"'+_.escape(l)+'" is already taken by a channel, username, or user group.',{});return}r=true;i=true;b(r,i);n=false;t=true;Ie(null,a,t,n)}return null}).catch(function(){v=null;r=true;i=false;b(r,i)})}else{r=true;b(r)}},h,{leading:false,trailing:true});t.on("input",s,function(e){e.preventDefault();e.stopPropagation();o($(this))});t.on("input",'#sci_channels_create [data-validation]:not([name="channel_name"])',function(){var e=t.find("#sci_channels_create");Ie(e.find(F()),e.find('[data-action="sci_channels_create"]'),true)});n.on("textchange",function(){if(!a)return;A()}).on("keydown",function(e){if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()});m.on("change",function(){if(!a)return;var e=$(this).val();if(TS.model.ui_state){TS.model.ui_state.sort_shared_channel_browser_by=e;TS.storage.storeUIState(TS.model.ui_state)}be(e);A()});t.on("click",".clear_filter_icon",function(){n.val("").trigger("textchange").focus()});e.on("keyup.sci",X);t.on("click",'[data-action="sci_toggle_contents"]',Ae);t.on("click",'[data-action="sci_toggle_send_email"]',Fe);t.on("click",'[data-action="sci_toggle_copy_link"]',Ee);t.on("click",'[data-action="sci_send"]',me);t.on("click",'[data-action="sci_copy"]',K);t.on("click",'[data-action="sci_revoke"]',_e);t.on("input","input[data-invite-id]",function(e){var t=$(e.target).parent();var n=true;Ie(t,t.find('[data-action="sci_send"]'),n)})};var k=function e(){t.find(".showing_sci_action").removeClass("showing_sci_action")};var x=function e(t){$(t.target).closest(".sci_invite_container").find(".sci_copy_link_mini_container").addClass("hidden")};var C=function e(t){$(t.target).closest(".sci_invite_container").find(".sci_send_email_mini_container").addClass("hidden")};var M=function e(t,n){var r=[];if(t.length>0){r.push({is_divider:true,name:TS.i18n.t("Channels you can join","shared")()});r=r.concat(t)}if(n.length>0){r.push({is_divider:true,name:TS.i18n.t("Channels you belong to","shared")()});r=r.concat(n)}return r};var I=function e(){var n=t.find("#sci_channels_create");var r=n.find(F());if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);Ladda.stopAll();n.find('[data-action="sci_channels_create"]').addClass("disabled");return}var i={};var a=!n.find('[name="access"]').prop("checked");if(W())switch(n.find('[name^="share_with"]:checked').val()){case"specific":i.target_domains=n.find('[name="domains"]').val();break;case"external":i.target_domain=n.find('[name="domain"]').val();break;case"all":i.all_teams=true}else i.target_domain=n.find('[name="domain"]').val();var s=n.find('[name="channel_name"]').val();if(s)i.channel_name=s;var o=n.find('[name="purpose"]').val();if(o)i.purpose=o.trim();if(i.target_domain){i.is_private=a;ne(i).then(function(e){var t=e.data.invite_id;Me(e.data);return ie().then(function(e){pe(e.data.invites,a);ue(t)})}).catch(L).finally(Ladda.stopAll)}else te(i,a).then(function(e){var t;if(e.data.group){t=e.data.group.id;if(!e.data.group.is_member){TS.console.warn("A new shared private channel was just created ("+t+") but the creator was not listed as a member in the API response");e.data.group.is_member=true}TS.groups.upsertGroup(e.data.group);TS.groups.displayGroup({id:t})}else{t=e.data.channel.id;if(!e.data.channel.is_member){TS.console.warn("A new shared channel was just created ("+t+") but the creator was not listed as a member in the API response");e.data.channel.is_member=true}TS.channels.upsertChannel(e.data.channel);TS.channels.displayChannel({id:t})}TS.ui.fs_modal.close()}).catch(L).finally(Ladda.stopAll)};var A=function e(){var t=$.trim(n.val());if(""!==t)if(-1!==t.indexOf("#")){t=t.replace("#","","g");t=$.trim(t)}if(t){n.closest(".channel_browser_filter_container").addClass("active");r=B(t)}else{n.closest(".channel_browser_filter_container").removeClass("active");r=B()}if(0===r.length){He(t);N("#sci_no_shared_channels")}else N("#sci_channels_container");i.longListView("scrollToTop",true);i.longListView("setItems",r);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(i);i.longListView("resizeImmediately")});if(t)TS.kb_nav.highlightFirstItem();else TS.kb_nav.clearHighlightedItem()};var E=function e(t,n){return _.find(P(),function(e){return e.team.domain===t&&e.channel_name===n})||_.find(P(true),function(e){return e.team.domain===t&&e.channel_name===n})};var F=function e(){var n=['[name="channel_name"]','[name="purpose"]'];if(W())switch(t.find('[name^="share_with"]:checked').val()){case"specific":n.push('[name="domains"]');break;case"external":n.push('[name="domain"]')}else n.push('[name="domain"]');return n.join(", ")};var O=function e(){return W()?_.filter(TS.model.enterprise_teams,function(e){return e.id!==TS.model.team.id}):[]};var B=function e(t){var n=H();var r=H(true);var i=!(n.length||r.length);if(i)return;var a=Y(n,r);var s=[];var o=[];var l={};var u;var d;if(t){t=TS.utility.regexpEscape(t);d=new RegExp(t,"i")}a.forEach(function(e){var n=l.hasOwnProperty(e.id);if(n)return;if(!e.hasOwnProperty("name"))return;if(!n)l[e.id]=true;if(t){if(e.name.toLowerCase()===t.toLowerCase()){u=e;return}if(!e.name.match(d))return}if(e.is_member)o.push(e);else s.push(e)});if(u)if(u.is_member)o.unshift(u);else s.unshift(u);return M(s,o)};var H=function e(t){return t?l:d};var D=function e(t,n){return _.find(P(n),function(e){return e.invite_id==t})};var P=function e(t){return t?u:c};var j=function e(){var n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Anyone in your workspace can join","shared")():TS.i18n.t("Anyone on your team can join","shared")();if(W()){var r=_.escape(TS.model.enterprise.name);switch(t.find('[name^="share_with"]:checked').val()){case"specific":n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Specific workspaces at {name} can join","shared")({name:r}):TS.i18n.t("Specific teams at {name} can join","shared")({name:r});break;case"all":n=TS.i18n.t("Anyone at {name} can join","shared")({name:r})}}return n};var R=function e(){var n=TS.i18n.t("Restricted to invited members","shared")();if(W()){var r=_.escape(TS.model.enterprise.name);switch(t.find('[name^="share_with"]:checked').val()){case"specific":n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Restricted to invited members on specific {name} workspaces","shared")({name:r}):TS.i18n.t("Restricted to invited members on specific {name} teams","shared")({name:r});break;case"all":n=TS.i18n.t("Restricted to invited members at {name}","shared")({name:r})}}return n};var L=function e(t){var n;switch(t.data.error){case"invalid_target_domain":n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Darn&mdash;we couldn’t find a workspace with that domain. Try again?","shared")():TS.i18n.t("Darn&mdash;we couldn’t find a team with that domain. Try again?","shared")();break;case"name_taken":n=TS.i18n.t("Darn&mdash;that channel name is already taken. Try another?","shared")();break;case"invite_exists":n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("An invitation already exists for that workspace and channel.","shared")():TS.i18n.t("An invitation already exists for that team and channel.","shared")();break;case"shared_channel_exists":n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Good news! That workspace has already joined the shared channel.","shared")():TS.i18n.t("Good news! That team has already joined the shared channel.","shared")();break;case"not_paid":n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("Darn&mdash;that workspace has to upgrade to a paid Slack plan to join a shared channel.","shared")():TS.i18n.t("Darn&mdash;that team has to upgrade to a paid Slack plan to join a shared channel.","shared")();break;default:return U(t)}return TS.generic_dialog.alert(n)};var U=function e(t){var n=t.message||"";if(t.data&&t.data.error)n+=": "+t.data.error;TS.error(n);var r=TS.i18n.t("Sorry! Something went wrong. Please try again.","shared")();return TS.generic_dialog.alert(r)};var N=function e(n){var r=["#sci_loading","#sci_no_shared_channels","#sci_channels_container","#sci_channels_create","#sci_send","#sci_invites_container"].filter(function(e){return e!==n}).join(", ");t.find(r).addClass("hidden");t.find(n).removeClass("hidden")};var G=function e(){o=false;if(a)i.longListView("setHidden",true)};var W=function e(){return TS.boot_data.page_needs_enterprise};var q=function e(t){return!!D(t,true)};var z=function e(){var n=t.find("#sci_channels_create");if(TS.useReactLFS()){var r=document.getElementById("sci_teams_picker");var i=true;TS.ui.team_picker.make(r,{teams:O(),onValueChange:function e(t){var r=t.map(function(e){return e.team.domain}).join(",");n.find('[name="domains"]').val(r);var i=true;Ie(n.find(F()),n.find('[data-action="sci_channels_create"]'),i)}},i)}else n.find('[name="domains"]').each(function(e,t){var r=$(t);TS.ui.team_picker.make(r,{teams:O()});r.on("change",function(){var e=TS.ui.team_picker.value(r).map(function(e){return e.team.domain}).join(",");r.val(e);var t=true;Ie(n.find(F()),n.find('[data-action="sci_channels_create"]'),t)})})};var K=function e(t){var n=$(t.target);var r=n.parent();var i=r.find("input");var a=r.find("label > span");var s=i.get(0);var o=i.val();if(TS.clipboard.canWriteText())TS.clipboard.writeText(o);else Te(a);if(s)s.setSelectionRange(0,o.length)};var V=function e(){if(!P().length&&!H().length&&!P(true).length&&!H(true).length)Ce()};var Y=function e(t,n){return t.concat(n)};var J=function e(t){if("num_members"in t)return t.num_members||0;return t.active_members?t.active_members.length:0};var Q=function n(){Be(true);t=null;e.off("keyup.sci");e=null;TS.kb_nav.end();o=false;a=false;fe([]);fe([],true)};var X=function e(t){if(t.which!==TS.utility.keymap.enter)return;var n=$(t.target);if(n.is("input[data-invite-id]"))me(t);else if(n.is('input[name="domain"], input[name="channel_name"]')){TS.ui.startButtonSpinner($('#sci_channels_create [data-action="sci_channels_create"]').get(0));I(t)}};var Z=function r(){t=$("#sci_container");e=$("body");s=t.find(".list_container");i=s.find(".list");n=t.find("#channel_browser_filter");m=t.find("#channel_browser_sort");if(TS.model.ui_state&&TS.model.ui_state.sort_shared_channel_browser_by)m.find('option[value="'+TS.model.ui_state.sort_shared_channel_browser_by+'"]').attr("selected",true);oe().then(Ce).catch(L)};var ee=function e(t,n){if(t.hasClass("channel_link")){var r=t.data("channel-id");TS.view.onChannelReferenceClick(n,r)}else{var i=t.data("group-id");TS.view.onGroupReferenceClick(n,i)}TS.ui.fs_modal.close()};var te=function e(t,n){return TS.api.call(n?"enterprise.groups.createShared":"enterprise.channels.createShared",t)};var ne=function e(t){return TS.api.call("channels.inviteShared",t)};var re=function e(t){return TS.api.call(t?"groups.listShared":"channels.listShared")};var ie=function e(){return TS.api.call("channels.listSharedInvites")};var ae=function e(t){return TS.api.call("channels.revokeSharedInvite",t)};var se=function e(t){return TS.api.call("channels.sendSharedInvite",t)};var oe=function e(){var t=[re().reflect(),re(true).reflect()];return Promise.all(t).then(function(e){var t=[];e.forEach(function(e){if(e.isFulfilled())return;t.push(e.reason())});if(t.length)return Promise.reject(new Error("Some shared channels start APIs failed:\n"+t.join("\n")));fe(e[0].value().data.channels);fe(e[1].value().data.channels,true)})};var le=function e(n){if(!n)return;var r=D(n,q(n));if(!r)return;t.find("#sci_invite_container_"+n+' [data-action="replace_emailed_invites"]').replaceWith(TS.templates.shared_channels_invites_emailed_invitations(r))};var ue=function e(n){if(!n)return;var r=D(n,q(n));if(!r)return;var i=t.find("#sci_invite_container_"+n);if(i.length)i.replaceWith(TS.templates.shared_channels_invites_invite(r));else t.find("#sci_invites_container .sci_list_header").after(TS.templates.shared_channels_invites_invite(r));t.find("#sci_invites_container").removeClass("hidden")};var de=function e(n){if(!n)return;t.find("#sci_invite_container_"+n).remove();var r=t.find("#sci_invites_container");if(1===r.children().length)r.addClass("hidden")};var ce=function e(t,n){_.remove(P(n),function(e){return e.invite_id==t})};var _e=function e(t){var n=$(t.target);var r=n.data("invite-id");var i=q(r);ae({invite_id:r}).then(function(){ce(r,i);de(r);V()}).catch(L)};var me=function e(t){var n=$(t.target);var r=n.parent();if(!TS.ui.validation.validate(r,{quiet:true,fast:true})){TS.ui.validation.validate(r);r.find('[data-action="sci_send"]').addClass("disabled");return}var i=n.data("invite-id");var a=r.find("input");var s=a.val();if(!s)return;var o=q(i);var l={invite_id:i,email:s};se(l).then(function(){a.val("");return ie().then(function(e){pe(e.data.invites,o);le(i);p(i)})}).catch(L)};var fe=function e(t,n){if(t.length)t=t.map(function(e){var t=TS.shared.getModelObById(e.channel);return $.extend({},e,t)});if(n)l=t;else d=t};var pe=function e(t,n){if(n)u=t;else c=t};var he=function e(){var n=t.find("#sci_channels_create .placeholder_overlay");t.find('#sci_channels_create input[name="domain"]').on("input",function(e){n.toggleClass("hidden",!!$(e.target).val())})};var ge=function e(){t.find('#sci_channels_create [name="access"]').togglify({on_text:TS.i18n.t("Public","shared")(),off_text:TS.i18n.t("Private","shared")(),label:j(),off_label:R(),off_class:"ts_toggle_orange",initial_state:true})};var Se=function e(t){k();var n=$(t.currentTarget).addClass("showing_sci_action");if(n.is(".sci_send_email_container"))n.find("input").focus()};var Te=function e(t){var n=t.data("timeout");clearTimeout(n);t.removeClass("hidden").data("timeout",setTimeout(function(){t.addClass("hidden")},3e3))};var ve=function e(){if(o)return;if(!a){ke();o=true;return}if(a){o=true;i.longListView("setHidden",false);i.longListView("setItems",B(),true);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(i)})}};var be=function e(t){var n=["name","creator","created","members_high","members_low"];var r="name";if(-1!==n.indexOf(t))r=t;ye(H(),r);ye(H(true),r)};var ye=function e(t,n){if("name"===n)t.sort(function(e,t){if(e._name_lc>t._name_lc)return 1;if(t._name_lc>e._name_lc)return-1;return 0});else if("creator"===n)t.sort(function(e,t){var n;var r;n=TS.members.getMemberById(e.creator);r=TS.members.getMemberById(t.creator);if(n&&r){if(n._name_lc>r._name_lc)return 1;if(r._name_lc>n._name_lc)return-1;return 0}else if(n&&!r)return-1;else if(!n&&r)return 1;return 0});else if("created"===n)t.sort(function(e,t){if(e.created<t.created)return 1;if(t.created<e.created)return-1;return 0});else if("members_high"===n)t.sort(function(e,t){var n=J(e);var r=J(t);if(n<r)return 1;if(r<n)return-1;return 0});else if("members_low"===n)t.sort(function(e,t){var n=J(e);var r=J(t);if(n>r)return 1;if(r>n)return-1;return 0})};var we=function e(){var t=TS.permissions.members.canCreateConvertOrgSharedChannels();var n={body_template_html:TS.templates.shared_channels_invites_modal({show_create_shared_channel_btn:t}),onShow:Z,onCancel:Q,modal_class:"fs_modal_internal_scroll convert_to_shared_dialog"};TS.ui.fs_modal.start(n)};var ke=function e(){a=true;var t=B();var n={items:t,approx_item_height:60,preserve_dom_order:true,approx_divider_height:35,pin_dividers:true,makeElement:function e(t){var n=$(TS.templates.channel_browser_row({is_shared:true}));t.$icon=n.find(".channel_browser_type_icon");t.$name=n.find(".channel_browser_channel_name");t.$creator=n.find(".channel_browser_created_by");t.$date=n.find(".channel_browser_created_on");t.$purpose=n.find(".channel_browser_channel_purpose");t.$member_count_container=n.find(".channel_browser_member_count_container");t.$member_count=n.find(".channel_browser_member_count");t.$open=n.find(".channel_browser_open");t.$preview=n.find(".channel_browser_preview");t.$joined=n.find(".channel_browser_joined");t.$shared_channel_icon=n.find(".shared_channel_icon");t.$teams=n.find(".teams");return n},makeDivider:function e(){return $("<div>").addClass("channel_browser_divider")},renderItem:function e(t,n,r){if(TS.shared.isModelObOrgShared(n))r.$shared_channel_icon.removeClass("hidden");else r.$shared_channel_icon.addClass("hidden");if(n.is_channel)r.$icon.removeClass("ts_icon_lock").addClass("ts_icon_channel_pane_hash");else r.$icon.removeClass("ts_icon_channel_pane_hash").addClass("ts_icon_lock");r.$name.text(n.name?n.name:"");var i=TS.members.getMemberById(n.creator);if(i){r.$creator.removeClass("hidden");r.$creator.find(".channel_browser_creator_name").text(TS.members.getPrefCompliantMemberName(i))}else r.$creator.addClass("hidden");r.$date.text(TS.interop.datetime.toCalendarDate(n.created));var a=J(n);r.$member_count.text(a);if(n.purpose&&n.purpose.value){var s=TS.utility.formatTopicOrPurpose(n.purpose.value);s=s.replace(/<a .*?>(.*?)<\/a>/g,"$1");r.$purpose.removeClass("hidden").html(s)}else r.$purpose.text("").addClass("hidden");var o=n.is_member||n.is_group;if(o){r.$open.removeClass("hidden");r.$preview.addClass("hidden");r.$joined.removeClass("hidden")}else{r.$open.addClass("hidden");r.$preview.removeClass("hidden");r.$joined.addClass("hidden")}if(n.is_group){t.removeClass("channel_link").removeAttr("data-channel-id");t.addClass("group_link").attr("data-group-id",n.id)}else{t.removeClass("group_link").removeAttr("data-group-id");t.addClass("channel_link").attr("data-channel-id",n.id)}if(TS.shared.isModelObOrgShared(n)){var l="";var u=0;var d=[];if(n.is_global_shared)TS.model.enterprise_teams.forEach(function(e,t){if(t>9){u+=1;return}d.push(e)});else n.shared_team_ids.forEach(function(e,t){if(t>9){u+=1;return}var n=TS.enterprise.getTeamById(e);d.push(n)});l+=TS.templates.shared_channel_list_team_icon({teams:d,show_additional_teams:u>0,additional_teams:u,org_shared:TS.shared.isModelObOrgShared(n)});r.$teams.html(l)}else r.$teams.empty()},renderDivider:function e(t,n){t.text(n.name)},calcItemHeight:function e(t){return t.outerHeight()}};i.longListView(n);w();TS.utility.rAF(function(){i.monkeyScroll()})};var xe=function e(){f=false;var n=W();var r={reserved_domain:TS.model.team.domain};if(n)r.enterprise_info=TS.model.enterprise;var i=TS.templates.shared_channels_invites_create(r);var a=t.find("#sci_channels_create");a.html(i).find("textarea").autogrow();N("#sci_channels_create");G();$("#fs_modal.convert_to_shared_dialog").toggleClass("fs_modal_internal_scroll",false);t.find("#sci_header_wrapper").addClass("hidden");he();ge();if(n)z();t.find('#sci_channels_create [name="domain"]').focus();Ladda.bind('#sci_channels_create [data-action="sci_channels_create"]');Be()};var Ce=function e(){f=true;t.find("#sci_header_wrapper").removeClass("hidden");var n=H();var r=H(true);var i=!(n.length||r.length);if(i){He();N("#sci_no_shared_channels");G();w();return null}N("#sci_channels_container");$("#fs_modal.convert_to_shared_dialog").toggleClass("fs_modal_internal_scroll",true);if(TS.model.ui_state&&TS.model.ui_state.sort_shared_channel_browser_by)be(TS.model.ui_state.sort_shared_channel_browser_by);else be(m.val());ve();Be(true)};var Me=function e(n){f=false;var r=TS.templates.shared_channels_invites_send(n);t.find("#sci_send").html(r);N("#sci_send");G();Be()};var Ie=function e(t,n,r,i){if(r)i=!TS.ui.validation.validate(t,{quiet:true,fast:true});n.toggleClass("disabled",i)};var Ae=function e(t){if($(t.target).is("a, input, .btn"))return;var n=$(t.currentTarget);var r=n.hasClass("showing_contents");n.toggleClass("showing_contents",!r);n.find(".sci_toggle_icon").toggleClass("ts_icon_caret_right",r).toggleClass("ts_icon_caret_down",!r)};var Ee=function e(t){var n=$(t.target).closest(".sci_invite_container").find(".sci_copy_link_mini_container");n.toggleClass("hidden",!n.hasClass("hidden"));C(t)};var Fe=function e(t){var n=$(t.target).closest(".sci_invite_container").find(".sci_send_email_mini_container");n.toggleClass("hidden",!n.hasClass("hidden")).find("input").focus();x(t)};var Oe=function e(n){var r=$(n.target);var i=t.find("#sci_channels_create");var a=r.val();var s="specific"===a;var o="external"===a;$("#sci_specific_team").toggleClass("hidden",!s);$("#sci_external_team").toggleClass("hidden",!o);i.find('[for="share_with_specific"]').toggleClass("hidden",!s);i.find('[for="share_with_external"]').toggleClass("hidden",!o);if("specific"===a)i.find('[name="team_list"]').focus();if("external"===a)i.find('[name="domain"]').focus();var l=true;Ie(i.find(F()),i.find('[data-action="sci_channels_create"]'),l);$e()};var Be=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(Ce);TS.ui.fs_modal.showBackButton()}};var He=function e(n){var r=t.find("#sci_no_shared_channels");var i=r.find(".sci_no_shared_note");var a=TS.i18n.t("You don’t have any shared channels yet.","shared")();if(n){var s=TS.i18n.t("No matches found for <strong> {escaped_query_string} </strong>","shared")({escaped_query_string:TS.utility.truncateAndEscape(n,50)});i.html(s)}else i.text(a)};var $e=function e(){t.find(".ts_toggle_on_label").text(j());t.find(".ts_toggle_off_label").text(R())};var De=function e(n,r){if(!t)return true;if(!n.is("input"))return true;var i=$("#sci_channels_create");var a=n.is('[name="domain"]')?n:i.find("[name=domain]");var s=n.is("[name=channel_name]")?n:i.find("[name=channel_name]");var o=a.val();var l=s.val();if(!o)return true;o=o.trim();l=l.trim();if(E(o,l)){if(!r.quiet)n.addClass("invalid_invite");var u=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("This invite already exists. Try a different workspace or channel!","shared")():TS.i18n.t("This invite already exists. Try a different team or channel!","shared")();TS.ui.validation.showWarning(n,u,r);return}if(a===n){if(l&&!r.quiet&&s.hasClass("invalid_invite")){s.removeClass("invalid_invite");TS.ui.validation.validate(s)}}else if(o&&!r.quiet&&a.hasClass("invalid_invite")){a.removeClass("invalid_invite");TS.ui.validation.validate(a)}if(!r.quiet)n.removeClass("invalid_invite");return true}})()},4301:function(e,t){(function(){"use strict";TS.registerModule("user_groups",{updated_sig:new signals.Signal,is_in_bulk_upsert_mode:false,onStart:function e(){if(TS.client)TS.client.login_sig.add(TS.user_groups.onLogin);else if(TS.web)TS.web.login_sig.add(TS.user_groups.onLogin);TS.user_groups.sortUserGroupsAndDispatchThrottled=_.debounce(TS.user_groups.sortUserGroupsAndDispatchThrottled,500)},onLogin:function e(){o=true;TS.user_groups.sortUserGroups()},getUserGroupsByHandle:function t(n){if(!n||"@"===n)return;n=_.toLower(n);var r=TS.model.user_groups;if(!r)return;var i=e[n];if(i)return i;for(var a=0;a<r.length;a+=1){i=r[a];if(i.handle==n||"@"+i.handle==n){TS.warn(n+" not in _handle_map?");e["@"+n]=i;e[n]=i;return i}}return null},getUserGroupsById:function e(n){if(TS.model.user&&TS.model.user.is_restricted)return false;var r=TS.model.user_groups;var i=t[n];if(i)return i;if(!r)return;for(var a=0;a<r.length;a+=1){i=r[a];if(i.id==n){TS.warn(n+" not in _id_map?");t[n]=i;return i}}return null},getActiveUserGroups:function e(t){var n=_.filter(TS.model.user_groups,function(e){if(t)return!e.date_delete;return!e.date_delete&&e.team_id});return n},promiseToGetUserGroupMembers:function e(t){return TS.api.call("subteams.users.list",{subteam:t,include_disabled:1}).then(function(e){var n=e.data;var r=TS.user_groups.mergeAndUpsertUserGroupFromUsersListCall(t,n);return r})},getUserGroupMembers:function e(t,n){TS.api.call("subteams.users.list",{subteam:t,include_disabled:1},function(e,r){if(e&&r){var i=TS.user_groups.mergeAndUpsertUserGroupFromUsersListCall(t,r);if(i&&n)n(i)}})},mergeAndUpsertUserGroupFromUsersListCall:function e(t,n){var r=TS.user_groups.getUserGroupsById(t);if(!r)return;r.users=n.users;r.user_count=n.users.length;TS.user_groups.updated_sig.dispatch(r.id);return r},updateMembersOfUserGroup:function e(t,n){TS.api.call("subteams.users.update",t,n)},createUserGroup:function e(t,n){TS.api.call("subteams.create",t,n)},updateUserGroup:function e(t,n){TS.api.call("subteams.update",t,n)},enableUserGroup:function e(t,n){TS.api.call("subteams.enable",{subteam:t},n)},disableUserGroup:function e(t,n){TS.api.call("subteams.disable",{subteam:t},n)},deleteUserGroup:function e(t,n){TS.api.call("subteams.delete",{subteam:t,include_disabled:1},n)},ensureUserGroupMembersInModelObNumIsKnown:function e(t,n){var r=TS.user_groups.getUserGroupsById(t);var i=TS.channels.getChannelById(n)||TS.groups.getGroupById(n);if(!r||!i)return Promise.resolve();if(_.isUndefined(r.users)){if(!s[t]){s[t]=TS.user_groups.promiseToGetUserGroupMembers(t).then(function(e){if(e&&e.users)return TS.membership.ensureChannelMembershipIsKnownForUsers(i.id,e.users)}).finally(function(){delete s[t]});return s[t]}return s[t]}return TS.membership.ensureChannelMembershipIsKnownForUsers(i.id,r.users)},getUserGroupMembersNotInModelObCount:function e(t,n){var r=TS.user_groups.getUserGroupsById(t);var i=_.get(r,"users.length");var a=TS.channels.getChannelById(n)||TS.groups.getGroupById(n);if(!r||!a)return 0;if(_.isUndefined(r.users))return 0;if(!TS.membership.isChannelMembershipKnownForUsers(a.id,r.users))return 0;var s=r.users.filter(function(e){var t=TS.membership.getUserChannelMembershipStatus(e,a);return t.is_known&&t.is_member});return i-s.length},upsertUserGroup:function e(t){if(TS.model.user&&TS.model.user.is_restricted)return false;var n=TS.user_groups.getUserGroupsById(t.id);t._name_lc=t.name.toLowerCase();if(n){if(TS.has_pri[l])TS.log(l,'updating existing User Group "'+t.id+'"');var r=TS.model.your_user_group_regex[t.id];if(r)TS.user_groups.removeSelfUserGroup(n.id);for(var a in t)if(n[a]!=t[a])n[a]=t[a];if(!t.date_delete&&t.users&&-1!==t.users.indexOf(TS.model.user.id)){if(!TS.user_groups.getUserGroupsById(t.id))TS.model.user_groups.push(t);TS.user_groups.upsertSelfUserGroup(n.id);i(t)}}else if(!t.date_delete){if(TS.has_pri[l])TS.log(l,'Adding user group "'+t.id+'"');if(!TS.user_groups.getUserGroupsById(t.id))TS.model.user_groups.push(t);i(t)}if(!TS.user_groups.is_in_bulk_upsert_mode)TS.user_groups.sortUserGroupsAndDispatchThrottled()},sortUserGroupsAndDispatch:function e(){TS.user_groups.sortUserGroups();TS.user_groups.updated_sig.dispatch()},sortUserGroupsAndDispatchThrottled:function e(){return TS.user_groups.sortUserGroupsAndDispatch()},startBatchUpsert:function e(){if(TS.user_groups.is_in_bulk_upsert_mode)return false;TS.user_groups.is_in_bulk_upsert_mode=true;return true},finishBatchUpsert:function e(){if(!TS.user_groups.is_in_bulk_upsert_mode)return false;TS.user_groups.is_in_bulk_upsert_mode=false;TS.user_groups.sortUserGroupsAndDispatch();return true},sortUserGroups:function e(){if(!o)return;TS.model.user_groups.sort(TS.i18n.mappedSorter("_name_lc"))},upsertUserGroupAndSignal:function e(t){TS.user_groups.upsertUserGroup(t);TS.user_groups.updated_sig.dispatch(t.id)},userGroupMembersChanged:function e(t){TS.info("TS.user_groups.userGroupMembersChanged");var n=TS.user_groups.getUserGroupsById(t.subteam_id);if(!n)return;if(n.users){if(t.added_users)n.users=_.union(n.users,t.added_users);if(t.removed_users)n.users=_.difference(n.removed_users,t.removed_users)}n.user_count=parseInt(n.user_count,10)||0;n.user_count+=parseInt(t.added_users_count,10)||0;n.user_count=Math.max(0,n.user_count-(t.removed_users_count||0));n.date_previous_update=_.assign(n,_.pick(t,["date_update","date_previous_update"]))},removeUserGroup:function e(t){var n=TS.user_groups.getUserGroupsById(t.id);if(n){TS.user_groups.removeSelfUserGroup(n.id);a(n);n.date_delete=-1}},removeUserGroupAndSignal:function e(t){TS.user_groups.removeUserGroup(t);TS.user_groups.updated_sig.dispatch(t.id)},upsertSelfUserGroup:function e(t){var n=TS.model.your_user_group_regex[t];if(n)TS.user_groups.removeSelfUserGroup(t);var r=TS.user_groups.getUserGroupsById(t);if(r&&!r.date_delete){var i=new RegExp("<!subteam\\^("+r.id+(r.handle?"|"+r.handle:"")+")\\b");TS.model.your_user_group_regex[r.id]=i;if(r.handle){TS.model.highlight_words.push("@"+r.handle);TS.model.highlight_words_regex=null}}},removeSelfUserGroup:function e(t){TS.model.your_user_group_regex[t]=null;delete TS.model.your_user_group_regex[t];var n=TS.user_groups.getUserGroupsById(t);if(n){if(n.handle)_.pull(TS.model.highlight_words,"@"+n.handle);a(n);TS.model.highlight_words_regex=null;TS.user_groups.updated_sig.dispatch(n.id)}},ensureUserGroupsArePresent:function e(t){var r=[];t.forEach(function(e){if(!TS.user_groups.getUserGroupsById(e))r.push(e)});if(!r.length)return Promise.resolve();return n(r)},test:function e(){return{clearUseGroupMaps:r}}});var e={};var t={};var n=function e(t){var n=[];t.forEach(function(e){n.push({type:"and",clauses:[{type:"is",value:"group"},{type:"id",value:e}]})});var r={count:t.length,include_usergroups:true,query:{type:"or",clauses:n}};r.query=JSON.stringify(r.query);return TS.api.callImmediately("search.enterprise",r).then(function(e){if(e.data.items&&e.data.items.length){TS.user_groups.startBatchUpsert();e.data.items.forEach(function(e){TS.user_groups.upsertUserGroup(e)});TS.user_groups.finishBatchUpsert()}return null})};var r=function n(){e={};t={}};var i=function n(r){if(!r)return;if(r.handle){e[r.handle]=r;e["@"+r.handle]=r}t[r.id]=r};var a=function n(r){if(!r)return;if(r.handle){delete e[r.handle];delete e["@"+r.handle]}delete t[r.id]};var s={};var o;var l=4})()},4302:function(e,t){(function(){"use strict";TS.registerModule("ui.admin_user_groups",{user_groups_fetched:new signals.Signal,onStart:function e(){$("body").on("click",'[data-action="admin_user_groups_modal"]',function(){l()});$("body").on("click",'[data-action="admin_user_groups_modal_new"]',function(){TS.ui.admin_user_groups.add()})},start:function e(){l()},add:function e(){l();s=true;y()},editInfo:function e(t){l();s=true;y(t)},editMembers:function e(t){l();s=true;k(t,false)},disable:function e(t){l();s=true;v(t,"disable_user_group")},enable:function e(t){l();s=true;v(t,"enable_user_group")},remove:function e(t){l();s=true;v(t,"delete_user_group")},test:function e(){var t={_isFullLocalMember:F};Object.defineProperty(t,"_isFullLocalMember",{get:function e(){return F},set:function e(t){F=t}});return t}});var e;var t;var n;var r;var i=true;var a=[];var s=false;var o=[];var l=function e(){var t=TS.templates.user_group_modal({show_info_pane:!TS.model.prefs.hide_user_group_info_pane,show_user_groups_add:TS.permissions.members.canCreateAndDeleteUserGroups()});var n={body_template_html:t,onShow:u,onCancel:d};TS.ui.fs_modal.start(n)};var u=function i(){e=$("#user_groups_container");t=$("#all_user_groups");n=$("#user_groups_form_div");r=$("#user_groups_toggle_div");S();e.find('[data-action="open_form"]').on("click",function(e){e.preventDefault();var t=$(this).closest(".user_group_item").data("user-group-id");var n=O(t);y(n)})};var d=function l(){i=true;e=null;t=null;n=null;r=null;s=false;P=null;j=null;$(window).off("resize",g);TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);B(TS.model.user_groups);H(o,TS.model.user_groups)};var c=function e(t){if(t)t.preventDefault();if(!s)S();else{TS.ui.fs_modal.close();P=null}B(TS.model.user_groups);H(o,TS.model.user_groups)};var m=function e(){if(!s){i=true;S()}else{TS.ui.fs_modal.close();P=null}TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);B(TS.model.user_groups);H(o,TS.model.user_groups)};var f=function e(){if(!s){TS.ui.fs_modal.bindBackButton(S);TS.ui.fs_modal.showBackButton()}};var p=function e(t){if(!a||!t)return false;for(var n=0,r=a.length;n<r;n+=1)if(a[n].auto_type===t)return a[n];return false};var h=function e(t,n){if(!t){var r=$("#user_group_name_input").val()||"";var i=$("#user_group_handle_input").val()||"";n.group_name=r;n.group_handle=i;if(n.error&&("forbidden_handle"===n.error||"forbidden_name"===n.error)){var a=r+i;if(a){var s=p("owner");var o=p("admin");var l=!!a.match(/admins/i);var u=!!a.match(/owners/i);n.suggest_auto_group=true;n.can_create_auto_owners=u&&TS.model.user.is_admin&&!s;n.can_enable_auto_owners=u&&s&&s.date_delete;n.can_create_auto_admins=l&&TS.model.user.is_admin&&!o;n.can_enable_auto_admins=l&&o&&o.date_delete}}$("#user_group_alerts").html(TS.templates.user_group_alerts(n));return true}return false};var g=function e(){var t=$("#user_groups_header");if(!t.length)return;var n=$("#user_groups_list_div");if(!n.length)return;var r=parseInt(t.css("padding-top"),10);var i=t[0].offsetHeight;var a=$(window).height();var s=250;var o=Math.max(s,a-i-r);n.css("height",o)};var S=function e(s){if(i){var l=$("#user_groups_list_div");l.html(Handlebars.helpers.loadingHTML());TS.api.call("subteams.list",{include_disabled:1,include_users:1},function(e,t){if(h(e,t))return;a=t.subteams;for(var n=0,r=a.length;n<r;n+=1)a[n]._name_lc=a[n].name.toLowerCase();a.sort(TS.i18n.mappedSorter("_name_lc"));TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);E();T();if(s){$('#fs_modal [data-user-group-id="'+s+'"]').addClass("highlight_yellow");$("#fs_modal").animate({scrollTop:$(".highlight_yellow").offset().top},500)}o=t.subteams});i=false}t.removeClass("hidden");n.addClass("hidden");r.addClass("hidden");TS.ui.fs_modal.hideBackButton()};var T=function r(){$(window).on("resize",g);g();$("#user_groups_list_div").monkeyScroll();P=$("#user_groups_list_div").data("monkeyScroll");$("#user_group_modal_search").on("keydown keyup change",I);j=$("#user_groups_header .user_groups_search .icon_close");j.off("click").on("click",A);t.off("click");t.on("click",'[data-action="open_form"]',function(e){e.preventDefault();var t=$(e.target);var n=t.closest(".user_group_item").data("user-group-id");var r=O(n);y(r)});t.on("click",'[data-action="edit_members"]',function(e){e.preventDefault();var t=$(e.target);var n=t.closest(".user_group_item").data("user-group-id");var r=O(n);k(r)});t.on("click",'[data-action="hide_info_pane"]',function(t){t.preventDefault();TS.prefs.setPrefByAPI({hide_user_group_info_pane:true},function(t,n){if(h(t,n))return;e.find(".info_panel").addClass("hidden")})});t.on("click",".user_group_toggle_btn",function(e){e.preventDefault();var t=$(e.target).closest("button, a");var n=t.closest(".user_group_item").data("user-group-id");var r=t.data("action");var i=O(n);v(i,r)});t.on("click",".clear_members_filter",A);var a=function e(t,n){if(t){i=true;s=false;S(n.subteam&&n.subteam.id?n.subteam.id:null)}};var o={owners:{create:function e(){TS.api.call("subteams.createAuto",{type:"owner"},a)},enable:function e(){var t=p("owner");if(!t)return;TS.user_groups.enableUserGroup(t.id,a)}},admins:{create:function e(){TS.api.call("subteams.createAuto",{type:"admin"},a)},enable:function e(){var t=p("admin");if(!t)return;TS.user_groups.enableUserGroup(t.id,a)}}};n.off("click").on("click","a.user_group_auto_action",function(e){var t=$(e.target);var n=t.data("auto-type");var r=t.data("auto-action");if(o[n]&&o[n][r]){o[n][r]();e.preventDefault();return false}})};var v=function e(n,i){if(!n){TS.warn("Cannot switch toggle view to undefined User Group");return}r.html(TS.templates.user_group_toggle({action:i,user_group:n}));r.find('[data-action="cancel"]').on("click",c);r.find(".user_group_toggle_btn").on("click",function(){var e=$(this).data("action");TS.user_groups[e](n.id,function(t,r){if(h(t,r))return;if("enableUserGroup"===e)b(n);m()})});r.find('[data-action="switch_delete_user_group"]').on("click",function(t){t.preventDefault();e(n,"delete_user_group")});t.addClass("hidden");r.removeClass("hidden");f()};var b=function e(t){var n=TS.user_groups.getUserGroupsById(t.id);if(!n)TS.user_groups.upsertUserGroup(_.cloneDeep(t))};var y=function e(r){n.html(TS.templates.user_group_settings_form(r));var i=TS.channels.getUnarchivedChannelsForUser().map(function(e){return{id:e.id,name:e.name,is_private:e.is_private,is_shared:e.is_shared,is_org_shared:e.is_org_shared}});var a=TS.groups.getUnarchivedGroups().map(function(e){return{id:e.id,name:e.name,is_group:true,is_shared:e.is_shared,is_org_shared:e.is_org_shared}});var s=i.concat(a);if(r){var o=r.prefs.channels.concat(r.prefs.groups);o.forEach(function(e){for(var t=0;t<s.length;t+=1)if(e==s[t].id){s[t].selected=true;break}})}var l={data:s,template:function e(t){var e;if(t.is_group||t.is_private)e='<ts-icon class="ts_icon_lock ts_icon_inherit"></ts-icon>';else e="#";e+=_.escape(t.name);if(TS.shared.isModelObOrgShared(t))e+=' <ts-icon class="ts_icon_shared_channel ts_icon_inherit"></ts-icon>';else if(TS.shared.isModelObShared(t))e+=TS.templates.shared_channels_icon({tootlip:true,shared_team_ids:t.shared_team_ids});return new Handlebars.SafeString(e)},placeholder_text:"",filter:function e(t,n){var r=new RegExp("^"+TS.utility.regexpEscape(n),"i");var i=new RegExp("^"+TS.utility.regexpEscape(n.replace("#","")),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|#)"+TS.utility.regexpEscape(n),"i");return t.name.match(i)||t.name.match(r)||t.name.match(a)}};$("#user_group_default_channels").lazyFilterSelect(l);w(r);t.addClass("hidden");n.removeClass("hidden");f()};var w=function e(t){var r;var i;var a;if(t){r=TS.user_groups.updateUserGroup;i=false;a=t.id}else{r=TS.user_groups.createUserGroup;i=true}var s=$("#user_group_handle_input");s.on("input",function(){$(this).closest(".handle_input").toggleClass("empty",!this.value.length)});n.find(".user_group_settings_form").on("submit",function(e){e.preventDefault();var t=$('input[name="name"]').val();var n=$('input[name="handle"]').val();var s=$('input[name="description"]').val();var o=$("#user_group_default_channels").lazyFilterSelect("value");o=o.map(function(e){return e.id});var l={name:t,handle:n,description:s,channels:o};if(a)l.subteam=a;r(l,function(e,t){if(h(e,t))return;b(t.subteam);if(i)k(t.subteam,i);else m()})});n.find(".user_group_settings_form").on("reset",c);var o=$("#save_user_group");var l=$("#user_group_name_input");function u(){var e=l.val();if(e&&e.length)o.removeAttr("disabled");else o.attr("disabled",true)}if(o.length&&l.length){l.on("change",u);l.on("keyup",u);u()}};var k=function e(r,i){var a=!!r.is_external||!!r.auto_type;var s=function e(){n.html(TS.templates.user_group_members_form({is_new:i,is_locked:a,user_group:r}))};var o=function e(){var a=$("#member_count");var s=r.user_count||0;var o=function e(){var t=$(i?"#create_group":"#save_group");if(t.length)if(s<1)t.prop("disabled",true);else t.prop("disabled",false)};var l={approx_item_height:TS.boot_data.feature_shared_channels_client?36:50,template:function e(t){var n=TS.templates.user_group_invite_member_small(t);return new Handlebars.SafeString(n)},onItemAdded:function e(){s+=1;a.html(s);o()},onItemRemoved:function e(){s-=1;a.html(s);o()},filter:function e(t,n){var r=t.member;if("@"===n.charAt(0))n=n.substr(1);var i=new RegExp("^"+TS.utility.regexpEscape(n),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(n),"i");return TS.utility.members.checkMemberMatch(r,i)||TS.utility.members.checkMemberMatch(r,a)},disabled:!!r.is_external||!!r.auto_type,data_promise:x(r)};$("#user_group_members_select").lazyFilterSelect(l);M(r);t.addClass("hidden");n.removeClass("hidden");o()};if(i){s();TS.ui.fs_modal.hideBackButton();o()}else{var l=function e(){s();f();o()};if(void 0===r.users)TS.user_groups.getUserGroupMembers(r.id,function(e){if(e&&e.users){r=e;return l()}});else return l()}};var x=function e(t){var n=true;return function(e,r){if("@"===e.charAt(0))e=e.substring(1);var i=false;if(n){n=false;if(_.get(t,"users.length"))i=true}if(i){var a=t.users.map(TS.members.getMemberById);a.sort(TS.members.memberSorterByName);var s=a.map(function(e){return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve(s)}if(r>0)return Promise.resolve([]);var o={query:e,include_org:false,include_slackbot:false,include_self:true,full_profile_filter:false,include_bots:true};var l=C(o);return l}};var C=function e(t){return Promise.resolve().then(function(){return TS.members.promiseToSearchMembers(t).then(function(e){var t=[];if(""===e.query)t=TS.members.getMembersForTeam(TS.model.team.id);else t=e.items;e.items=t.filter(F).map(function(e){return{member:e,lfs_id:String(e.id)}});return e})})};var M=function e(t){n.find(".user_group_members_form").on("submit",function(e){e.preventDefault();var n=$("#user_group_members_select").lazyFilterSelect("value");n=n.map(function(e){return e.member.id});TS.user_groups.updateMembersOfUserGroup({subteam:t.id,users:n},function(e,t){if(h(e,t))return;m()})});n.find(".user_group_members_form").on("reset",function(e){e.preventDefault();i=true;c(e)})};var I=function e(t){var n=$(t.target);var r=n.val();if(r!==D){D=r;j.toggleClass("hidden",""===r);E()}};var A=function e(){var t=$("#user_group_modal_search");D="";t.val("");setTimeout(function(){t.focus()},0);j.addClass("hidden");E()};var E=function e(){var t=$("#user_groups_list_div");var n=D;var r;$("#user_groups_header .user_groups_search").toggleClass("hidden",!a.length);if("string"===typeof n&&n.length){var i=a.filter(function(e){return-1!==e.handle.indexOf(n)||-1!==e._name_lc.indexOf(n)||e.description&&-1!==e.description.toLowerCase().indexOf(n)});if(i.length){t.html(TS.templates.builders.buildUserGroupListHTML(i));if(P)P.updateFunc();return}var s={query:n,tab:{label:TS.i18n.t("User Groups","pages_admin")()}};r='<div class="no_results top_margin">'+TS.templates.team_list_no_results(s)+"</div>"}else r=TS.templates.builders.buildUserGroupListHTML(a);t.html(r);if(P)P.updateFunc()};var F=function e(t){if(!t)return false;if(t._is_local&&!t.deleted&&!t.is_ultra_restricted&&!t.is_restricted&&!(t.is_bot||t.is_slackbot))return true;return false};var O=function e(t){if(t)for(var n=0;n<a.length;n+=1)if(a[n].id==t)return a[n]};var B=function e(t){var n=$("#user_groups_tab .count");n.html(t.length)};var H=function e(t,n){if(0===t.length&&n.length>0)TS.reload()};var D;var P;var j})()},4305:function(e,t){(function(){"use strict";TS.registerModule("utility.search",{test:function e(){return{_fetchMembersFromFlannel:r}},makeClause:function t(n,r,i){if(e(n,r,i))return;var a={type:n.toLowerCase(),value:r};if(i)a.field_id=i;return a},makeConjunction:function e(n,r){if(t(n,r))return;return{type:n.toLowerCase(),clauses:r}},promiseToSearch:function e(t){if(!t)return Promise.reject(new Error("Cannot search without arguments."));if(t.all_of_org&&!TS.boot_data.page_needs_enterprise)return Promise.reject(new Error("cannot search an org when not an enterprise team"));if(!t.solr&&TS.useSocket()){if(!t.hasOwnProperty("raw_query"))return Promise.reject(new Error("Flannel searches require a `raw_query` to be provided"));var a=t.raw_query;var s=t.count||Infinity;var o;if(_.isEmpty(t.raw_query)&&!t.only_admins)o=Promise.resolve([]);else{var l={};if(t.only_admins)l.filter="admins";else if(t.only_local_team)l.filter="team";o=r(t.raw_query,s,t.determine_membership_for_channel,l)}return o.then(function(e){var n=e.objects;if(!t.include_bots){var r=_.remove(n,{is_bot:true});if(r.length&&TS.has_pri[i])TS.log(i,"Flannel: removed these bots from results:",r)}if(t.exclude_slackbot&&t.include_bots){var o=_.remove(n,{is_slackbot:true});if(o.length&&TS.has_pri[i])TS.log(i,"Flannel: removed slackbot from results:",o)}if(TS.boot_data.page_needs_enterprise&&!t.all_of_org){var l=_.remove(n,function(e){var t=_.get(e,"enterprise_user.teams",[]);var n=_.includes(t,TS.model.team.id);return!n});if(l.length&&TS.has_pri[i])TS.log(i,"Flannel: removed these org members from results:",l)}if(!t.include_deleted){var u=_.remove(n,{deleted:true});if(u.length&&TS.has_pri[i])TS.log(i,"Flannel: removed these deleted members from results:",u)}n=_.intersection(TS.members.getMembersForUser(),n);return{ok:true,data:{items:n.slice(0,s),next_cursor_mark:null,num_found:n.length,teams:[TS.model.team]},args:{query:a}}})}if(!t.query)return Promise.reject(new Error("Cannot search without a query."));var u={query:JSON.stringify(t.query)};["sort","sort_direction","count","cursor_mark","include_bots","include_deleted","exclude_slackbot","ignore_guest_accounts"].forEach(function(e){if(t.hasOwnProperty(e))u[e]=t[e]});var d=t.endpoint;if(!d)d=t.all_of_org?"search.enterprise":"search.team";return TS.api.call(d,u).catch(n)}});var e=function e(t,n,r){if(!t){TS.error("cannot make a clause without a type");return}if(!n){TS.error("cannot make a clause without a value");return}if("custom"===t&&!r)TS.error("cannot make a custom type clause without a field id")};var t=function e(t,n){if(!t){TS.error("cannot make a conjunction without an 'and' or 'or' type");return}if(!n||n.length<2)TS.error("cannot make a conjunction without at least two clauses")};var n=function e(t){TS.error(t.data.error+" error occured while searching");TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","utility_search")());throw t};var r=function e(t,n,r,i){i=i||{};var a={query:t,count:n};if(i.filter)a.filter=i.filter;var s=TS.members.fetchAndUpsertMembersWithQuery(a);if(!r)return s;var o=_.assign({channels:[r]},a);var l=TS.members.fetchAndUpsertMembersWithQuery(o);return Promise.join(s,l).then(function(e){var t=e[0];var n=e[1];var i=_.map(t.objects,"id");var a=_.map(n.objects,"id");var s=TS.shared.getModelObById(r);a.forEach(function(e){TS.membership.setUserChannelMembership(e,s,true)});_.difference(i,a).forEach(function(e){TS.membership.setUserChannelMembership(e,s,false)});return t})};var i=1989})()},4308:function(e,t){(function(){"use strict";TS.registerModule("utility.calls",{share_url_prefix:document.location.origin+"/call/",calls_window_changed_sig:new signals.Signal,room_id_sig:new signals.Signal,started_platform_call_sig:new signals.Signal,window_types:{call_window:"call_window",mini_panel:"mini_panel",incoming_call:"incoming_call"},messages_to_call_window_types:{invite_response:"invite_response",invite_cancel:"invite_cancel",start_call:"start_call",caller_id:"caller_id",mini_panel_action:"mini_panel_action",did_close_window:"did_close_window",ping:"ping",ms_msg:"ms_msg",reachability:"reachability",calls_status:"calls_status",regions:"regions",got_server:"got_server",got_server_error:"got_server_error"},messages_to_mini_panel_types:{update_state:"update_state"},messages_from_call_window_types:{update_mini_panel:"update_mini_panel",set_call_window_loaded:"set_call_window_loaded",set_call_window_busy:"set_call_window_busy",show_growl_notification:"show_growl_notification",set_is_publisher_screensharing:"set_is_publisher_screensharing",pong:"pong",close:"close",hide_call_window:"hideCallWindow",get_calls_status:"get_calls_status",force_janus_disconnect:"force_janus_disconnect",get_regions:"get_regions",get_server:"get_server",get_member_data:"get_member_data",play_sound:"play_sound",launch_dev_tools_mini_panel:"launch_dev_tools_mini_panel",launch_dev_tools_cursors:"launch_dev_tools_cursors",send_interactive_mas_migration_slackbot_message_after_call:"send_interactive_mas_migration_slackbot_message_after_call"},messages_from_incoming_call_types:{user_clicked_accept_or_reject:"user_clicked_accept_or_reject"},messages_from_mini_panel_types:{user_clicked_action:"user_clicked_action"},invite_response_types:{accept:"accept",reject:"reject",on_call:"on_call",dnd:"dnd",hangup:"hangup"},invite_cancel_types:{cleanup:"cleanup",timeout:"timeout",inviter_cancel:"inviter_cancel",accepted_timeout:"accepted_timeout",caller_hangup:"caller_hangup"},invite_unsupported_types:{platform:"platform",client_version:"client_version",offline:"offline"},onStart:function e(){r.in_slack_app=!!TS.client;r.in_call_window=!!TS.calls;r.calls_url_prefix=document.location.origin+"/call/";r.send_interactive_mas_migration_slackbot_message_after_call=false;if(r.in_slack_app){if(TS.isSocketManagerEnabled()){TS.interop.SocketManager.connectedSig.add(s);TS.interop.SocketManager.disconnectedSig.add(o);TS.interop.SocketManager.socketMessageReceivedSig.add(a)}else{TS.ms.on_msg_sig.add(a);TS.ms.connected_sig.add(s);TS.ms.disconnected_sig.add(o)}window.addEventListener("online",l);window.addEventListener("offline",l);window.addEventListener("message",Q);if(TS.model.is_our_app){if(window.macgap)TS.ssb.teams_did_load_sig.add(u);TS.client.login_sig.add(d)}if(TS.client.windows){TS.client.windows.win_finished_loading_sig.add(c);TS.client.windows.win_will_close_sig.add(m);TS.client.windows.win_crashed_sig.add(f);TS.client.windows.win_became_key_sig.add(p);TS.client.windows.win_resigned_key_sig.add(h)}if(TS.ui)TS.ui.window_unloaded_sig.add(g);if(TS.model.is_our_app)r.call_window_loaded=false;else r.call_window_loaded=true;r.is_ms_connected=false;r.is_reachability_online=true;TS.experiment.loadUserAssignments().then(function(){if("enabled"===TS.experiment.getGroup("calls_ss"))r.screen_sharing_enabled=TS.model.supports_screen_sharing;if("enabled"===TS.experiment.getGroup("calls_better_regions"))r.calls_better_regions_expt=true;if("enabled"===TS.experiment.getGroup("calls_laser"))r.laser_enabled=true})}},startCallInModelOb:function e(t,n,r){var i;var a=!n&&"Slack"!==TS.model.team.prefs.calling_app_name;if(TS.interop.utility.looksLikeMemberId(t.id)){var s=t.id;t=TS.ims.getImByMemberId(s);if(!t){TS.ims.promiseToStartImByMemberId(s,true,false).then(function(){t=TS.ims.getImByMemberId(s);i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:r};if(a)TS.utility.calls.launchPlatformCalls(i);else TS.utility.calls.launchVideoCall(i)});return}}i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:r};if(a)TS.utility.calls.launchPlatformCalls(i);else TS.utility.calls.launchVideoCall(i)},getCallsUrlPrefix:function e(){return r.calls_url_prefix},isEnabled:function e(){if(!TS.model||!TS.model.team||!TS.model.team.prefs)return false;return TS.model.team.prefs.allow_calls},isCallWindowReady:function e(){return r.is_reachability_online&&r.is_ms_connected},isMultiPartyEnabled:function e(){return TS.utility.calls.isEnabled()&&TS.utility.calls.isPaidTeam()},isPaidTeam:function e(){return""!==TS.model.team.plan},isCurrentContextMultiParty:function e(){if(TS.model.active_channel_id||TS.model.active_group_id||TS.model.active_mpim_id)return true;return false},launchPlatformCalls:function e(t){if(!t)return;if(!t.id)return;var n=null!=TSSSB.env.desktop_app_version;TS.utility.calls.started_platform_call_sig.dispatch({is_loading:true});TS.api.call("calls.request",{channel:t.id,app:TS.model.team.prefs.calling_app_id}).then(function(e){if(!e.data.ok){i(e);return}var t=window.open(encodeURI(e.data.url),TS.model.team.prefs.calling_app_name);try{t.focus()}catch(e){if(!n){var r=bowser.name;var a;if(r)a=TS.i18n.t("Please allow pop-ups in {browser} to make a call. You can <http://my.slack.com/help/requests/new|contact Slack> if you need help.","utility")({browser:r});else a=TS.i18n.t("Please allow pop-ups in your browser to make a call. You can <http://my.slack.com/help/requests/new|contact Slack> if you need help.","utility")();var s={text:a,ephemeral_type:"enable_popups",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(s)}}}).catch(function(e){i(e)}).finally(function(){TS.utility.calls.started_platform_call_sig.dispatch({is_loading:false})})},launchVideoCall:function e(t){if(!TS.model.supports_voice_calls&&!TS.utility.calls.platformHasCallsCode()){S();return}if(!t)return;if(!t.id)return;if(!TS.utility.calls.isCallWindowReady())return;if(r.incoming_caller_info){var i=TS.ims.getImByMemberId(r.incoming_caller_info.user_id);if(i&&i.id===t.id)F().then(function(e){if(e){TS.utility.calls.closeIncomingCallWindow();TS.utility.calls.sendInvitationResponseToCaller({user_id:r.incoming_caller_info.user_id,room_id:r.incoming_caller_info.room_id,response:TS.utility.calls.invite_response_types.accept,did_choose_video:false})}})}j().then(function(e){if(e){N();return}TS.utility.calls_log.logEvent({event:n.log_events.start_call,value:t});R(r.calls_url_prefix+t.id,t.id,{start_with_video:t.is_video_call})})},sendInvitationResponseToCaller:function e(t){if(!t||!t.user_id||!t.room_id||!t.response||!TS.utility.calls.invite_response_types[t.response]){TS.utility.calls_log.logError("sendInvitationResponseToCaller: invalid args: ",t);return}TS.utility.calls.room_id_sig.dispatch({room_id:t.room_id});if(t.response){TS.api.callImmediately("screenhero.rooms.inviteResponse",{caller:t.user_id,room:t.room_id,response:t.response},function(e,t){if(!e)TS.utility.calls_log.logError("inviteResponse API failed with: ",t)});if(t.response===TS.utility.calls.invite_response_types.accept){r.accepted_caller_id=t.user_id;if(!t.currently_calling_caller)L(t.room_id,t.did_choose_video)}}Promise.join(j(),F(),function(e,r){TS.utility.calls_log.logEvent({event:n.log_events.invite_response_send,value:{response_type:t.response,user_id:t.user_id,room_id:t.room_id,is_call_window_busy:e,is_in_incoming_call:r}});return null})},closeIncomingCallWindow:function e(t){TS.utility.calls_log.logEvent({event:n.log_events.close_incoming_call});if(TS.model.is_our_app){if(window.macgap)TSSSB.call("closeIncomingCallWindow");else if(window.winssb)if(r.incoming_call_token){TSSSB.call("closeWindow",r.incoming_call_token);delete r.incoming_call_token}}else F().then(function(e){if(e)TS.incoming_call.timeout()});delete r.incoming_caller_info;if(!t)E()},maybeHandleCallLink:function e(t){if(!r.in_slack_app)return false;if(!t||!t.length)return false;if(!t.is("a"))return false;var i=t.attr("href");if(!i)return false;i=TS.utility.normalizeDevHost(i);i=i.replace("https://","").replace("http://","");var a=TS.utility.normalizeDevHost(r.calls_url_prefix);a=a.replace("https://","").replace("http://","");if(0===i.indexOf(a))i=i.replace(a,"call/");while(0===i.indexOf("/"))i=i.substr(1);if(0!==i.indexOf("call/"))return false;var s=i.split("/");if(s.length<2)return false;var o=s[1];if(!o)return false;if(!TS.utility.calls.isCallWindowReady())return true;F().then(function(e){if(e){TS.utility.calls_log.logEvent({event:n.log_events.call_object_click_in_incoming_call});return}TS.utility.calls.room_id_sig.dispatch({room_id:o});L(o)});return true},getParentWindow:function e(){if(window.macgap)if(r.in_call_window){if(document.ssb_main&&document.ssb_main.TS&&document.ssb_main.TS.utility&&document.ssb_main.TS.utility.calls)return document.ssb_main.TS.utility.calls.getParentWindow()}else return window;else if(window.winssb&&!(window.parentInfo||window.parentBrowserWindowId))TS.utility.calls_log.logWarn("WinSSB: Trying to get parent window before browser window ID is initialized");else if(window.opener)return window.opener},promiseToGetRegions:function t(){if(e)return e;if(r.calls_better_regions_expt){e=new Promise(function(e){var t={east:"slack-calls-0fc78df4963fa1cd7.slack-core.com",west:"slack-calls-04e6ff274e7196b49.slack-core.com",eu:"slack-calls-004c3e8ad31b95218.slack-core.com",ap:"slack-calls-00f1852837340bafc.slack-core.com"};TS.api.callImmediately("screenhero.getServers",{protocol_version:"2.0",media_server:"janus"},function(n,r){if(n)t=r.servers;var i=Object.keys(t);var a=false;_.each(i,function(n){$.ajax({type:"OPTIONS",url:"https://"+t[n]+"/janus",async:true,cache:false,timeout:2e3}).always(function(){TS.utility.calls_log.logEvent({event:"RegionsNew",value:n});if(!a){e(n);a=true}})})})});return e}var n;e=new Promise(function(e){$.ajax({type:"GET",url:"https://region.slack-core.com/region.json",async:true,cache:false,timeout:2e3,success:function t(r){TS.utility.calls_log.logEvent({event:"Regions",value:r.region_text});n=r.region_text;if("dev"===TS.boot_data.version_ts)n="dev";e(n)},error:function t(r,i,a){TS.utility.calls_log.logEventError({event:"GetRegionsErr",value:{status:i,error:a}});n="west|east|ap|eu";if("dev"===TS.boot_data.version_ts)n="dev";e(n)}})});return e},promiseToGetServer:function e(n,r){if(t[r])return t[r];var i;var a={regions:n,protocol:"1.0"};if("R"===r.charAt(0)){i="screenhero.rooms.join";a.room=r}else{i="screenhero.rooms.create";a.channel=r;var s=TS.storage.fetchCallsState();if(s.call_server_override){a.call_server=s.call_server_override;s.call_server_override=null;TS.storage.storeCallsState(s)}}t[r]=TS.api.callImmediately(i,a);return t[r]},clearServerPromise:function e(n){delete t[n]},getCallActive:function e(){return j()},isScreenSharing:function e(){return r.is_publisher_screensharing},isSupportedMessage:function e(t){var n=["user_change","pref_change","team_join","channel_created","channel_deleted","channel_archive","channel_unarchive","channel_rename","channel_joined","channel_left","group_deleted","group_archive","group_unarchive","group_rename","group_joined","group_left","im_open","mpim_joined","mpim_open","mpim_close"];return-1!==n.indexOf(t)},getPlatformErrorMessage:function e(){if(TS.model.is_our_app){if(TS.model.lin_ssb_version)return TS.i18n.t("Unfortunately, the calls feature is not available on Linux.","utility")();else if(window.winssb)return TS.i18n.t("To use the calls feature, please upgrade to the latest version of Slack for Windows.","utility")();return TS.i18n.t("To use the calls feature, please upgrade to the latest version of the Mac app for Slack.","utility")()}else if(bowser.mobile&&bowser.ios)return TS.i18n.t("Please update your Slack iOS app to the newest version.","utility")();else if(bowser.mobile)return TS.i18n.t("Unfortunately, the calls feature is not available on mobile browsers.","utility")();return TS.i18n.t("Unfortunately, the calls feature is not available in this browser. Please switch to Chrome.","utility")()},getPlatformErrorTitle:function e(){if(TS.model.is_our_app){if(TS.model.lin_ssb_version)return TS.i18n.t("Calls feature is not available on Linux","utility")();else if(window.winssb)return TS.i18n.t("Please update your Slack for Windows","utility")();return TS.i18n.t("Please update your Slack for Mac","utility")()}else if(bowser.mobile)return TS.i18n.t("Calls feature is not available on mobile browsers","utility")();return TS.i18n.t("Calls feature is not available in this browser","utility")()},platformHasCallsCode:function e(){if(TS.model.is_our_app){if("1.1"==TS.model.mac_ssb_version&&TS.model.mac_ssb_version_minor<8||parseFloat(TS.model.mac_ssb_version)<2)return false;if("1.2"==TS.model.win_ssb_version&&TS.model.win_ssb_version_minor<5||parseFloat(TS.model.win_ssb_version)<1.2)return false}return true},verifyOriginUrl:function e(t){return TS.utility.url.getHostName(t)==window.location.hostname&&_.startsWith(t,"https:")},getUrlForRoom:function e(t){return TS.utility.calls.getUrlForRoomId(t.id)},getUrlForRoomId:function e(t){return TS.utility.calls.share_url_prefix+t},dbg:{getState:function e(){return{config:n,state:r}},isCallWindowBusy:function e(){j().then(function(e){TS.info("_isCallWindowBusy: "+e)})},isIncomingCallWindowBusy:function e(){F().then(function(e){TS.info("_isInIncomingCall: "+e)})}}});var e;var t={};var n={call_window_dims:{width:1070,height:600,min_width:600,min_height:500},mini_panel_dims:{width:280,height:64,min_width:280,min_height:44,x_offset:50,y_offset:50},incoming_call_window_dims:{width:240,height:373},log_events:{previous_crash:"PreviousCrash",incoming_call:"IncomingCall",invite_response_from_callee:"InviteResponseFromCallee",ms_connected:"MSConnected",ms_disconnected:"MSDisconnected",reachability_changed:"ReachabilityChanged",window_closed:"WindowClosed",window_crashed:"WindowCrashed",call_window_load_timeout:"CallWindowLoadTimeout",call_window_load_start:"CallWindowLoadStart",incoming_call_timeout:"IncomingCallTimeout",send_msg_no_call_window:"SendMsgNoCallWindow",send_msg_no_mini_panel:"SendMsgNoMiniPanel",call_window_loaded:"CallWindowLoaded",call_window_busy:"CallWindowBusy",invalid_msg_from_child_window:"InvalidMsgFromChildWindow",call_window_pong:"CallWindowPong",unknown_msg_from_call_window:"UnknownMsgFromCallWindow",incoming_call_click:"IncomingCallClick",unknown_msg_from_incoming_call_window:"UnknownMsgFromIncomingCallWindow",mini_panel_click:"MiniPanelClick",unknown_msg_from_mini_panel:"UnknownMsgFromMiniPanel",call_object_click_in_incoming_call:"CallObjectClickInIncomingCall",invite_response_send:"InviteResponseSend",close_incoming_call:"CloseIncomingCall",no_mini_panel_in_update:"NoMiniPanelInUpdate",start_call:"StartCall",join_call:"JoinCall"},CALL_WINDOW_LOAD_TIMEOUT_MSECS:3e4,INCOMING_RING_TIMEOUT_MSECS:29e3};var r={};var i=function e(t){var n={text:t.data.response||TS.i18n.t("Darn, that didn’t work. Try your call again or <http://my.slack.com/help.requests/new|contact us> if it’s still not working.","utility")(),ephemeral_type:t.data.error||"uncaught_third_party_call_error",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(n)};var a=function e(t){if(!r.in_slack_app)return;switch(t.type){case"screenhero_invite":TS.utility.calls_log.logEvent({event:n.log_events.incoming_call,value:t});Promise.join(j(),F(),function(e,n){I(e,n,t);return null});break;case"screenhero_invite_cancel":TS.utility.calls.closeIncomingCallWindow();j().then(function(e){if(e)O({message_type:TS.utility.calls.messages_to_call_window_types.invite_cancel,cancel_type:t.cancel_type,user_id:t.responder,room_id:t.room});else r.cached_invite_cancel={cancel_type:t.cancel_type,user_id:t.responder,room_id:t.room}});break;case"screenhero_invite_response":TS.utility.calls_log.logEvent({event:n.log_events.invite_response_from_callee,value:t});O({message_type:TS.utility.calls.messages_to_call_window_types.invite_response,response_type:t.response,user_id:t.responder,room_id:t.room});TS.api.callImmediately("screenhero.rooms.inviteCancel",{responder:t.responder,room:t.room,cancel_type:TS.utility.calls.invite_cancel_types.cleanup},function(){});break;case"sh_room_join":TS.utility.calls_log.logInfo("sh_room_join msg: ",t);break;default:if(TS.utility.calls.isSupportedMessage(t.type))if(!TS.model.is_our_app)O({message_type:TS.utility.calls.messages_to_call_window_types.ms_msg,msg:t})}};var s=function e(){TS.utility.calls_log.logEvent({event:n.log_events.ms_connected});r.is_ms_connected=true;G()};var o=function e(){TS.utility.calls_log.logEvent({event:n.log_events.ms_disconnected});r.is_ms_connected=false;G()};var l=function e(){r.is_reachability_online=window.navigator.onLine;G();H()};var u=function e(){r.teams_loaded=true};var d=function e(){r.did_login=true};var c=function e(t){switch(t){case r.incoming_call_token:TSSSB.call("centerWindow",t);TSSSB.call("showWindow",t);A();break;case r.mini_panel_token:if(window.winssb&&winssb.window&&winssb.window.browserWindows&&winssb.window.browserWindows[t]&&winssb.window.browserWindows[t].setMinimumSize){winssb.window.browserWindows[t].setMinimumSize(n.mini_panel_dims.min_width,n.mini_panel_dims.min_height);winssb.window.browserWindows[t].setSize(n.mini_panel_dims.width,n.mini_panel_dims.height)}}};var m=function e(t){TS.utility.calls_log.logEvent({event:n.log_events.window_closed,value:{token:t,cw_token:r.call_window_token,mp_token:r.mini_panel_token,ic_token:r.incoming_call_token}});switch(t){case r.call_window_token:r.last_call_window_token=r.call_window_token;z();if(r.call_window_token)delete r.call_window_token;k();x();break;case r.mini_panel_token:if(r.mini_panel_token)delete r.mini_panel_token}};var f=function e(t){TS.utility.calls_log.logEvent({event:n.log_events.window_crashed,value:{token:t,cw_token:r.call_window_token,mp_token:r.mini_panel_token,ic_token:r.incoming_call_token}});if(t!==r.last_call_window_token&&t!==r.call_window_token)return;M();z();delete r.call_window_token;TS.utility.calls_log.logEvent({event:n.log_events.previous_crash});k();x()};var p=function e(t){if(t!==r.call_window_token)return;if(r.is_publisher_screensharing)return;TSSSB.call("hideWindow",r.mini_panel_token)};var h=function e(t){if(t!==r.call_window_token)return;j().then(function(e){if(e)TSSSB.call("showWindowInactive",r.mini_panel_token)})};var g=function e(){TS.utility.calls_log.logInfo("client window unloaded!");C()};var S=function e(){TS.generic_dialog.start({title:TS.utility.calls.getPlatformErrorTitle(),body:TS.utility.calls.getPlatformErrorMessage(),show_cancel_button:true,go_button_text:TS.i18n.t("Update Slack App","utility")(),onGo:function e(){var t="_"+Math.random();TS.utility.openInNewTab("https://slack.com/downloads",t)}})};var T=function e(){return _.get(window,"winssb.app.areTransparentWindowsSupported",true)};var v=function e(t){var i;if(!TS.utility.calls.isEnabled())return;if(!TS.utility.calls.platformHasCallsCode())return;TS.metrics.mark("start_loading_call_window");if(TS.model.is_our_app&&r.call_window_token){O({message_type:TS.utility.calls.messages_to_call_window_types.start_call,args:{url:t}});y();w();TSSSB.call("focusWindow",r.call_window_token);return}i={url:t||r.calls_url_prefix,title:"",background:true,width:n.call_window_dims.width,height:n.call_window_dims.height,minWidth:n.call_window_dims.min_width,minHeight:n.call_window_dims.min_height,hideMenuBar:true,windowType:"calls",show:true,no_spinner:true,hides_on_close:false};if(window.winssb){var a=TSSSB.call("getAppDisplay");i.x=a.bounds.x+(a.bounds.width-n.call_window_dims.width)/2;i.y=a.bounds.y+(a.bounds.height-n.call_window_dims.height)/2}r.call_window_token=TS.client.windows.openWindow(i);TS.utility.calls_log.logInfo("_startCallWindow: returned token: ",r.call_window_token);y();w()};var b=function e(){if(!r.call_window_token)return;M();var t=r.call_window_token;delete r.call_window_token;TSSSB.call("closeWindow",t)};var y=function e(){if(!window.winssb||r.mini_panel_token)return;var t=TSSSB.call("getDisplayForWindow",r.call_window_token);var i={x:t.bounds.x+(t.bounds.width-n.mini_panel_dims.x_offset-n.mini_panel_dims.width),y:t.bounds.y+n.mini_panel_dims.y_offset,width:n.mini_panel_dims.width,height:n.mini_panel_dims.height,minWidth:n.mini_panel_dims.min_width,minHeight:n.mini_panel_dims.min_height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_mini_panel",show:false,useContentSize:true,skip_css:true,skipTaskbar:true,fullscreenable:false};if(TS.model.is_mac&&T())i.transparent=true;i.content_html=TS.templates.calls_minipanel({no_border:!TS.model.is_mac,js_urls:TS.boot_data.electron_window_injection_urls?TS.boot_data.electron_window_injection_urls.calls_mini_panel.js:[],css_urls:TS.boot_data.electron_window_injection_urls?TS.boot_data.electron_window_injection_urls.calls_mini_panel.css:[]});r.mini_panel_token=TS.client.windows.openWindow(i);TSSSB.call("showWindowInactive",r.mini_panel_token);TSSSB.call("hideWindow",r.mini_panel_token)};var w=function e(){if(!r.screen_sharing_enabled)return;if(TS.boot_data.electron_window_injection_urls)var t=TS.boot_data.electron_window_injection_urls.calls_cursors.js;var n=TS.templates.calls_cursors({js_urls:t,css_urls:TS.boot_data.electron_window_injection_urls?TS.boot_data.electron_window_injection_urls.calls_cursors.css:[]});var i={width:0,height:0,windowType:"calls_cursors",transparent:true,alwaysOnTop:true,hideMenuBar:true,resizable:false,frame:false,useContentSize:true,skip_css:true,content_html:n,fullscreenable:false,enableLargerThanScreen:true,hasShadow:false,focusable:false,show:false,skipTaskbar:true};r.cursors_window_token=TS.client.windows.openWindow(i)};var k=function e(){if(!r.mini_panel_token)return;var t=r.mini_panel_token;delete r.mini_panel_token;TSSSB.call("closeWindow",t)};var x=function e(){if(!r.screen_sharing_enabled)return;if(!r.cursors_window_token)return;var t=r.cursors_window_token;delete r.cursors_window_token;TSSSB.call("closeWindow",t)};var C=function e(){if(r.mini_panel_token){TSSSB.call("closeWindow",r.mini_panel_token);delete r.mini_panel_token}if(r.call_window_token){O({message_type:TS.utility.calls.messages_to_call_window_types.did_close_window});M();TSSSB.call("closeWindow",r.call_window_token);z();delete r.call_window_token}if(r.window_handle){r.window_handle.close();delete r.window_handle}};var M=function e(){D(false);P(false);if(r.send_interactive_mas_migration_slackbot_message_after_call)if("enabled"===TS.experiment.getGroup("calls_interactive_ss")){var t=TS.i18n.t("To use interactive screen sharing, you’ll need to <http://slack.com/downloads|download the Slack app> directly from our website.","calls")();var n={text:t,type:"interactive_mas_migration"};TS.client.ui.addEphemeralBotMsg(n)}};var I=function e(t,i,a){if(!TS.utility.calls.isEnabled())return;var s=TS.shared.isRelevantTeam();if(!s)return;var o=false;var l=TS.ims.getImByMemberId(a.caller);if(l&&l.id===r.call_channel)o=true;if(t||i||o){TS.utility.calls.sendInvitationResponseToCaller({user_id:a.caller,room_id:a.room,response:o?TS.utility.calls.invite_response_types.accept:TS.utility.calls.invite_response_types.on_call,currently_calling_caller:o});return}if(TS.dnd.isMemberInDnd(TS.model.user)){TS.utility.calls.sendInvitationResponseToCaller({user_id:a.caller,room_id:a.room,response:TS.utility.calls.invite_response_types.dnd});return}var u=TS.members.getMemberById(a.caller);var d=Promise.resolve(u);if(!u)d=TS.api.call("users.info",{user:a.caller}).then(function(e){TS.members.upsertMember(e.data.user);u=TS.members.getMemberById(a.caller)});d.then(function(){var e=TS.members.getPrefCompliantMemberName(u);if(TS.model.is_our_app){if(window.winssb){var t={width:n.incoming_call_window_dims.width,height:n.incoming_call_window_dims.height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_incoming_call",show:false,skip_css:true,fullscreenable:false};if(TS.model.is_mac&&T())t.transparent=true;var i=TS.templates.calls_incoming_call({caller:u,name:e,is_video_call:TS.model.supports_video_calls&&a.cameras_on>0,team:TS.model.team.name});t.content_html=TS.templates.calls_incoming_call_window({incoming_call_div:i,room_id:a.room,user_id:a.caller,no_border:!TS.model.is_mac,css_urls:TS.boot_data.electron_window_injection_urls?TS.boot_data.electron_window_injection_urls.calls_incoming_call.css:[]});r.incoming_call_token=TS.client.windows.openWindow(t)}else if(window.macgap){TSSSB.call("incomingCall",{room_id:a.room,name:e,user_id:a.caller,avatar_img_src:u.profile.image_192});A()}}else TS.incoming_call.start({caller:u,name:e,is_video_call:TS.model.supports_video_calls&&a.cameras_on>0,onAccept:function e(t){TS.utility.calls.sendInvitationResponseToCaller({user_id:a.caller,room_id:a.room,response:TS.utility.calls.invite_response_types.accept,did_choose_video:t})},onReject:function e(){TS.utility.calls.sendInvitationResponseToCaller({user_id:a.caller,room_id:a.room,response:TS.utility.calls.invite_response_types.reject})},onTimeout:function e(){},onShow:function e(){A()},onEnd:function e(){E()}});r.incoming_caller_info={user_id:a.caller,room_id:a.room}})};var A=function e(){TS.sounds.play("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{should_loop:true,ignore_mute:true});r.incoming_ring_timer=setTimeout(function(){TS.utility.calls_log.logEvent({event:n.log_events.incoming_call_timeout});TS.utility.calls.closeIncomingCallWindow()},n.INCOMING_RING_TIMEOUT_MSECS);r.in_incoming_call=true;K()};var E=function e(){TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true});if(r.incoming_ring_timer){clearTimeout(r.incoming_ring_timer);delete r.incoming_ring_timer}delete r.in_incoming_call;delete r.incoming_caller_info;V()};var F=function e(){if(!TS.model.is_our_app||!TSSSB.call("supportsIncomingCallWindowStatus"))return Promise.resolve(!!r.in_incoming_call);return TSSSB.call("isIncomingCallWindowBusy")};var O=function e(t){if(TS.model.is_our_app){var i=r.call_window_token;if(!i){TS.utility.calls_log.logEventWarn({event:n.log_events.send_msg_no_call_window,value:t});return}if(window.macgap){var a=TS.client.windows.getWinByToken(i);if(a&&a.window)a.window.postMessage(t,"*")}else if(window.winssb&&window.winssb.window)window.winssb.window.postMessage(t,i)}else if(r.window_handle)r.window_handle.postMessage(t,"*")};var B=function e(t){if(!r.mini_panel_token){TS.utility.calls_log.logEventWarn({event:n.log_events.send_msg_no_mini_panel,value:t});return}if(window.winssb&&window.winssb.window)window.winssb.window.postMessage(t,r.mini_panel_token)};var H=function e(){if(!r.call_window_loaded)return;O({message_type:TS.utility.calls.messages_to_call_window_types.reachability,online:r.is_reachability_online})};var D=function e(t){TS.utility.calls_log.logEvent({event:n.log_events.call_window_loaded,value:{is_loaded:t}});r.call_window_loaded=t;G();if(t){TSSSB.call("focusWindow",r.call_window_token);TS.metrics.measureAndClear("calls_desktop_window_loaded","start_loading_call_window")}H()};var P=function e(t){TS.utility.calls_log.logEvent({event:n.log_events.call_window_busy,value:{is_busy:t}});r.is_call_window_busy=t;if(t){q();if(r.accepted_caller_id)O({message_type:TS.utility.calls.messages_to_call_window_types.caller_id,args:{caller_id:r.accepted_caller_id}});if(r.cached_invite_cancel)O({message_type:TS.utility.calls.messages_to_call_window_types.invite_cancel,cancel_type:r.cached_invite_cancel.cancel_type,user_id:r.cached_invite_cancel.user_id,room_id:r.cached_invite_cancel.room_id})}else{z();r.call_channel=void 0;r.is_publisher_screensharing=false;r.is_publisher_screenhero=false}if(r.accepted_caller_id)delete r.accepted_caller_id;if(r.cached_invite_cancel)delete r.cached_invite_cancel};var j=function e(){if(!TS.model.is_our_app||!TSSSB.call("supportsCallWindowStatus"))return Promise.resolve(!!r.is_call_window_busy);return TSSSB.call("isCallWindowBusy")};var R=function e(t,n,i){i=i||{};t+="?_fast_members=1&_end_call_sound=1"+(i.start_with_video?"&_start_with_video=1":"");if(TS.pri)t+="&pri="+TS.pri;if(TS.qs_args._calls_halt_at_loading_screen)t+="&_calls_halt_at_loading_screen=1";if(TS.qs_args.locale)t+="&locale="+TS.qs_args.locale;if(TS.qs_args.js_path)t+="&js_path="+encodeURIComponent(TS.qs_args.js_path);TS.utility.calls.promiseToGetRegions().then(function(e){TS.utility.calls.promiseToGetServer(e,n).catch(_.noop)});if(TS.model.is_our_app)v(t);else r.window_handle=window.open(t,n);r.call_channel=n};var L=function e(t,i){if(!TS.model.supports_voice_calls&&!TS.utility.calls.platformHasCallsCode()){S();return}if(!TS.utility.calls.isCallWindowReady())return;j().then(function(e){if(e){N();return}TS.utility.calls_log.logEvent({event:n.log_events.join_call,value:{room_id:t,start_with_video:i}});R(r.calls_url_prefix+t,t,{start_with_video:i})})};var U=function e(t){var n;if(t)n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("You’re already in a call on another workspace ({team_name})","utility")({team_name:t}):TS.i18n.t("You’re already in a call on another team ({team_name})","utility")({team_name:t});else n=TS.boot_data.feature_teams_to_workspaces?TS.i18n.t("You’re already in a call on another workspace","utility")():TS.i18n.t("You’re already in a call on another team","utility")();TS.generic_dialog.start({title:n,body:'<p class="no_bottom_margin">'+TS.i18n.t("You can only be in one call at a time. Please end that call and try again.","utility")()+"</p>",go_button_text:TS.i18n.t("OK","utility")(),show_cancel_button:false})};var N=function e(){TS.utility.calls_log.logInfo("_handleAlreadyInCall");if(!TS.model.is_our_app){r.window_handle.focus();return}if(!TSSSB.call("supportsCallWindowStatus")){TSSSB.call("focusWindow",r.call_window_token);return}TSSSB.call("getCallWindowTeamId",{cb:function e(t){if(t===TS.model.team.id)TSSSB.call("focusWindow",r.call_window_token);else TSSSB.call("getCallWindowTeamName",{cb:function e(t){U(t)}})}})};var G=function e(){if(TS.utility.calls.platformHasCallsCode())TS.client.msg_pane.setCallButtonState(TS.utility.calls.isCallWindowReady());else TS.client.msg_pane.setCallButtonState(true)};var W=function e(t){if(!r.mini_panel_token){TS.utility.calls_log.logEventWarn({event:n.log_events.no_mini_panel_in_update});return}B({message_type:TS.utility.calls.messages_to_mini_panel_types.update_state,mini_panel_state:t})};var q=function e(){if(!TS.model.is_our_app)return;TSSSB.call("setCallWindowBusy",{is_busy:true});TSSSB.call("setCallWindowToken",{token:r.call_window_token});TSSSB.call("setCallWindowTeamId",{team_id:TS.model.team.id});TSSSB.call("setCallWindowTeamName",{team_name:TS.model.team.name})};var z=function e(){if(!TS.model.is_our_app)return;if(!TSSSB.call("supportsCallWindowStatus"))return;var t=String(r.call_window_token);TSSSB.call("getCallWindowToken",{cb:function e(n){if(n!==t)return;TSSSB.call("setCallWindowBusy",{is_busy:false});TSSSB.call("clearCallWindowToken");TSSSB.call("clearCallWindowTeamId");TSSSB.call("clearCallWindowTeamName")}})};var K=function e(){if(!TS.model.is_our_app)return;if(!TSSSB.call("supportsIncomingCallWindowStatus"))return;TSSSB.call("setIncomingCallWindowBusy",{is_busy:true});if(r.incoming_call_token)TSSSB.call("setIncomingCallWindowToken",{token:r.incoming_call_token});TSSSB.call("setIncomingCallWindowTeamId",{team_id:TS.model.team.id});TSSSB.call("setIncomingCallWindowTeamName",{team_name:TS.model.team.name})};var V=function e(){var t=function e(){TSSSB.call("setIncomingCallWindowBusy",{is_busy:false});TSSSB.call("clearIncomingCallWindowToken");TSSSB.call("clearIncomingCallWindowTeamId");TSSSB.call("clearIncomingCallWindowTeamName")};if(!TS.model.is_our_app)return;if(!r.incoming_call_token){t();return}var n=String(r.incoming_call_token);TSSSB.call("getIncomingCallWindowToken",{cb:function e(r){if(r!==n)return;t()}})};var Y=function e(t,n,r,i){$.ajax({timeout:2e3,type:"POST",url:t+"/"+n,async:true,cache:false,contentType:"application/json",headers:{Authorization:"Basic "+btoa(":"+r)},data:JSON.stringify({janus:"destroy",transaction:i}),dataType:"json"})};var J=function e(t){_(window.desktop.window.state.windows).filter({subType:t}).map("id").each(_.partial(window.desktop.window.safeInvokeOnWindow,_,function(e){return e.toggleDevTools()}))};var Q=function e(t){if(!t||!t.data||!t.data.message_type){TS.utility.calls_log.logEvent({event:n.log_events.invalid_msg_from_child_window,value:t});return}if(!TS.model.is_our_app&&!TS.utility.calls.verifyOriginUrl(t.origin))return;if(t.data.origin_window_type===TS.utility.calls.window_types.call_window)switch(t.data.message_type){case TS.utility.calls.messages_from_call_window_types.update_mini_panel:W(t.data.mini_panel_state);if(t.data.mini_panel_state.hidden)TSSSB.call("hideWindow",r.mini_panel_token);break;case TS.utility.calls.messages_from_call_window_types.set_call_window_loaded:D(t.data.is_loaded);H();break;case TS.utility.calls.messages_from_call_window_types.set_call_window_busy:P(t.data.is_busy);break;case TS.utility.calls.messages_from_call_window_types.show_growl_notification:if("nothing"!==TS.notifs.getGlobalNotificationSetting())TS.ui.growls.show(t.data.title,t.data.txt,null,{subtitle:t.data.subtitle,sound_name:"none",channelId:t.data.channel,is_call_notification:true});break;case TS.utility.calls.messages_from_call_window_types.set_is_publisher_screensharing:r.is_publisher_screensharing=t.data.is_enabled;r.is_publisher_screenhero=t.data.is_screenhero;if(r.is_publisher_screensharing)TSSSB.call("showWindowInactive",r.mini_panel_token);break;case TS.utility.calls.messages_from_call_window_types.close:b();k();x();break;case TS.utility.calls.messages_from_call_window_types.hide_call_window:TSSSB.call("hideWindow",r.call_window_token);break;case TS.utility.calls.messages_from_call_window_types.get_calls_status:j().then(function(e){TSSSB.call("getCallWindowTeamName",{cb:function t(n){O({message_type:TS.utility.calls.messages_to_call_window_types.calls_status,is_busy:e,team_name:n})}})});break;case TS.utility.calls.messages_from_call_window_types.force_janus_disconnect:Y(t.data.server,t.data.session_id,t.data.token,t.data.transaction_id);break;case TS.utility.calls.messages_from_call_window_types.get_regions:TS.utility.calls.promiseToGetRegions().then(function(e){O({message_type:TS.utility.calls.messages_to_call_window_types.regions,regions:e})});break;case TS.utility.calls.messages_from_call_window_types.get_server:var i=t.data.id;var a=t.data.regions;TS.utility.calls.promiseToGetServer(a,i).then(function(e){O({message_type:TS.utility.calls.messages_to_call_window_types.got_server,data:e.data});TS.utility.calls.clearServerPromise(i)}).catch(function(e){TS.utility.calls.clearServerPromise(i);O({message_type:TS.utility.calls.messages_to_call_window_types.got_server_error,error:e.data.error})});break;case TS.utility.calls.messages_from_call_window_types.get_member_data:TS.members.ensureMembersArePresent([t.data.user_id]).then(function(){O({reply_to:t.data.message_id,message_type:t.data.message_type,message:{user_id:t.data.user_id,member:TS.members.getMemberById(t.data.user_id)}})});break;case TS.utility.calls.messages_from_call_window_types.play_sound:TS.sounds.play("call/"+t.data.sound+"_"+TS.boot_data.call_sounds_version+".mp3");break;case TS.utility.calls.messages_from_call_window_types.launch_dev_tools_mini_panel:if(TS.model.is_our_app)J("calls_mini_panel");break;case TS.utility.calls.messages_from_call_window_types.launch_dev_tools_cursors:if(TS.model.is_our_app)J("calls_cursors");break;case TS.utility.calls.messages_from_call_window_types.send_interactive_mas_migration_slackbot_message_after_call:r.send_interactive_mas_migration_slackbot_message_after_call=true;break;default:TS.utility.calls_log.logEvent({event:n.log_events.unknown_msg_from_call_window,value:t})}else if(t.data.origin_window_type===TS.utility.calls.window_types.incoming_call)switch(t.data.message_type){case TS.utility.calls.messages_from_incoming_call_types.user_clicked_accept_or_reject:TS.utility.calls_log.logEvent({event:n.log_events.incoming_call_click,value:t.data});TS.utility.calls.sendInvitationResponseToCaller({user_id:t.data.user_id,room_id:t.data.room_id,response:t.data.did_accept?TS.utility.calls.invite_response_types.accept:TS.utility.calls.invite_response_types.reject,did_choose_video:t.data.did_choose_video});var s=true;TS.utility.calls.closeIncomingCallWindow(s);break;default:TS.utility.calls_log.logEvent({event:n.log_events.unknown_msg_from_incoming_call_window,value:t})}else if(t.data.origin_window_type===TS.utility.calls.window_types.mini_panel)switch(t.data.message_type){case TS.utility.calls.messages_from_mini_panel_types.user_clicked_action:TS.utility.calls_log.logEvent({event:n.log_events.mini_panel_click,value:t.data});if("mute"===t.data.action||"leave"===t.data.action||"screenhero"===t.data.action||"stop_screenshare"===t.data.action)O({message_type:TS.utility.calls.messages_to_call_window_types.mini_panel_action,action:t.data.action});else if("activate"===t.data.action)TSSSB.call("showWindow",r.call_window_token);break;default:TS.utility.calls_log.logEvent({event:n.log_events.unknown_msg_from_mini_panel,value:t})}}})()},4309:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("utility.contenteditable",{onStart:function e(){TS.utility.contenteditable.refreshTextPreferences()},create:function t(n,r){if(!r)r={};n=o(n);if(!n)return;if(l(n))return;if(d(n))return;var i={modules:{tabcomplete:{searchOptions:{complete_member_specials:true},appendMenu:function e(t){$("body").prepend(t)},render:TS.tabcomplete.render,trailingPunctuationChars:e},textsubstitutions:{getTextPreferences:TS.utility.contenteditable.getTextPreferences,buildSmartQuotesDelta:TS.format.texty.buildSmartQuotesDelta},clipboard:{hasTeamClipboardData:function e(t){return t&&t.clipboardData&&t.clipboardData.getData("slack/"+TS.model.team.id)},onPaste:function e(t){return TS.utility.contenteditable.paste(n,t)}}},onEnter:function e(){return true},onEscape:function e(){return true},onTab:function e(){return TS.boot_data.feature_keyboard_navigation},singleLineInput:false,onTextChange:_.noop,attributes:{role:"textbox",tabindex:0,"aria-multiline":true,"aria-haspopup":true},log:_.partial(TS.log,116),logError:TS.error};if(TS.boot_data.feature_texty_mentions&&!r.avoidSlugging)if(TS.boot_data.feature_name_tagging_client){var a={complete_member_specials:i.modules.tabcomplete.searchOptions.complete_member_specials,no_model_ob:_.get(r,"modules.tabcomplete.no_model_ob"),model_ob:_.get(r,"modules.tabcomplete.searchOptions.model_ob")};if(_.get(r,"modules.tabcomplete.searchOptions")&&r.modules.tabcomplete.searchOptions.hasOwnProperty("complete_member_specials"))a.complete_member_specials=r.modules.tabcomplete.searchOptions.complete_member_specials;i.modules.slackmention={processPotentialMentions:_.debounce(function(){h(n,a)},100)}}else i.modules.slackmention={};if(TS.boot_data.feature_name_tagging_client)i.useNameTagging=true;_.defaultsDeep(r,i);if(r.modules&&r.modules.tabcomplete){if(!r.modules.tabcomplete.completers)r.modules.tabcomplete.completers=[TS.tabcomplete.channels,TS.tabcomplete.commands,TS.tabcomplete.emoji,TS.tabcomplete.members];if(!TS.boot_data.feature_keyboard_navigation&&_.includes(r.modules.tabcomplete.completers,TS.tabcomplete.commands)){var s=r.onTab||_.noop;r.onTab=function(){if(TS.utility.contenteditable.isEmpty(n)&&f(n))return;return s()}}}var u=r.onEnter;r.onEnter=function(e){if(!r.singleLineInput&&m(e,n))return true;if(_.isFunction(u))return u(e);return false};var p=new TS.interop.texty.TextyClass(n,r);c(n,p)},unload:function e(t){t=o(t);if(!t)return;if(!u(t))return;var n=d(t);if(n)n.unload()},isActiveElement:function e(t){t=o(t);if(!t)return false;if(l(t))return document.activeElement===t;else if(u(t)){var n=d(t);if(n.hasFocus())return true;return document.activeElement&&-1!=document.activeElement.className.indexOf("ql-clipboard")&&document.activeElement.parentNode===t}return false},focus:function e(t){t=o(t);if(!t)return;if(l(t))t.focus();else if(u(t)){var n=d(t);n.focus()}},hasFocus:function e(t){t=o(t);if(!t)return;if(l(t))return $(t).is(":focus");else if(u(t)){var n=d(t);return n.hasFocus()}},blur:function e(t){t=o(t);if(!t)return;if(l(t))t.blur();else if(u(t)){var n=d(t);n.blur()}},isContenteditable:function e(t){t=o(t);if(t&&TS.ui&&TS.ui.paste&&TS.ui.paste.catcher_div&&TS.ui.paste.catcher_div===t)return false;if(t.isContentEditable)return true;if(u(t))return true;return false},disable:function e(t){t=o(t);if(!t)return;if(l(t))t.disabled=true;else if(u(t)){var n=d(t);n.disable()}},isDisabled:function e(t){t=o(t);if(!t)return;if(l(t))return true===t.disabled;else if(u(t)){var n=d(t);return!n.isEnabled()}return false},enable:function e(t){t=o(t);if(!t)return;if(l(t))t.disabled=false;else if(u(t)){var n=d(t);n.enable()}},isEnabled:function e(t){t=o(t);if(!t)return false;if(l(t))return true!==t.disabled;else if(u(t)){var n=d(t);return n.isEnabled()}return false},value:function e(t,n){t=o(t);if(!t)return"";if(l(t)){if(_.isString(n))t.value=n;return t.value}else if(u(t)){var r=d(t);if(_.isString(n))if(TS.boot_data.feature_name_tagging_client){r.setContents(TS.format.texty.convertContentsStringToContents(n));v()}else r.setText(n);else if(_.isObject(n)){r.setContents(n);v()}if(TS.boot_data.feature_name_tagging_client)return TS.format.texty.convertContentsToString(r.getContents());return r.getText()}return""},displayValue:function e(t){t=o(t);if(!t)return"";if(l(t))return t.value;else if(u(t)){var n=d(t);return n.getText()}return""},getLength:function e(t){return TS.utility.contenteditable.displayValue(t).length},getTextForRange:function e(t,n,r){t=o(t);if(!t)return"";if(l(t)){var i=TS.utility.contenteditable.value(t);return i.substr(n,r)}else if(u(t)){var a=d(t);return a.getTextForRange(n,r)}return""},insertTextAtCursor:function e(t,n,r){t=o(t);if(!t)return;var i;if(l(t)){if(!_.isString(n))return t.value;i=TS.utility.contenteditable.cursorPosition(t);var a=TS.utility.contenteditable.value(t);var s=a.substr(0,i.start)+n+a.substr(i.start);t.value=s;if(r){TS.utility.contenteditable.focus(t);TS.utility.contenteditable.cursorPosition(t,i.start+n.length,0)}}else if(u(t)){var c=d(t);if(_.isString(n))c.insertTextAtCursor(n,r)}},insertContentsAtCursor:function e(t,n,r){t=o(t);if(!t)return;if(l(t))TS.utility.contenteditable.insertTextAtCursor(t,TS.format.texty.convertContentsToString(n),r);else if(u(t)){var i=d(t);i.insertContentsAtCursor(n,r)}},updateContents:function e(t,n){t=o(t);if(!t)return;if(l(t))TS.warn("updateContents called on form element");else if(u(t)){var r=d(t);r.updateContents(n)}},paste:function e(t,n){t=o(t);if(!t)return false;if(l(t))return false;if(u(t)){var r;var i;if(n&&n.clipboardData&&n.clipboardData.getData("slack/plain")){n.preventDefault();r=p(t,n.clipboardData.getData("slack/plain"));i=TS.format.texty.convertContentsStringToContents(r);i=TS.format.texty.removeInvalidMentions(i);TS.utility.contenteditable.insertContentsAtCursor(t,i,true);return true}r=TS.ui.paste.getPlainTextFromClipboard(n);if(!_.isEmpty(r)){n.preventDefault();r=p(t,r);TS.utility.contenteditable.insertTextAtCursor(t,r,true);return true}}return false},getFormats:function e(t,n){t=o(t);if(!t)return{};if(u(t)){var r=d(t);return r.getFormats(n)}return{}},isEmpty:function e(t,n){var r=TS.utility.contenteditable.value(t);if(r&&n)r=r.trim();return 0===r.length},clear:function e(t,n){t=o(t);if(!t)return;if(l(t))t.value="";else if(u(t)){if(TS.boot_data.feature_name_tagging_client)v();var r=d(t);r.clear({is_silent:!!n})}},placeholder:function e(t,n){t=o(t);if(!t)return"";var r;if(l(t)){if(_.isString(n))if(""===n)t.removeAttribute("placeholder");else t.setAttribute("placeholder",n);r=t.getAttribute("placeholder")}else if(u(t)){var i=d(t);i.setPlaceholder(n);r=i.getPlaceholder()}return r||""},cursorPosition:function e(t,n,r){var i;var a={start:0,end:0,length:0};t=o(t);if(!t)return a;if(_.isNumber(n)){if(!r)r=0;a.start=n;a.end=n+r;a.length=r;if(l(t))TS.selection.selectCharacters(t,a.start,a.end);else if(u(t)){i=d(t);i.setSelection(a.start,a.length)}}else{if(!TS.utility.contenteditable.isActiveElement(t)){var s=$(t).data("utility-contenteditable-cursor-position");if(_.isObject(s))return s}if(l(t)){t.focus();a.start=t.selectionStart;a.end=t.selectionEnd;a.length=Math.abs(t.selectionEnd-t.selectionStart)}else if(u(t)){i=d(t);var c=i.getSelection();if(c){a.start=c.index;a.length=c.length;a.end=a.start+a.length}}}return a},setCursorAtEnd:function e(t){var n=TS.utility.contenteditable.getLength(t);TS.utility.contenteditable.cursorPosition(t,n)},isTextSelected:function e(t){t=o(t);if(!t)return;if(l(t))return!!(window.getSelection&&window.getSelection().toString());else if(u(t)){var n=d(t);return n.getSelection().length>0}},deserialize:function e(t,r){if(!r)return;t=o(t);if(!t)return;if(l(t))t.value=r;else if(u(t)){if("object"===("undefined"===typeof r?"undefined":n(r))&&r.hasOwnProperty("contents")){TS.utility.contenteditable.value(t,r);return}if("string"!==typeof r)return;try{var i=JSON.parse(r);if(null!==i&&"object"===("undefined"===typeof i?"undefined":n(i))){TS.utility.contenteditable.value(t,i);return}}catch(e){}TS.utility.contenteditable.value(t,r)}},isCursorInPreBlock:function e(t){t=o(t);if(!t)return false;if(u(t)){var n=d(t);return n.isCursorInPreBlock()}return false},deleteSelection:function e(t){t=o(t);if(!t)return false;if(u(t)){var n=d(t);return n.deleteSelection()}window.getSelection().deleteFromDocument()},deleteText:function e(t,n,r){t=o(t);if(!t)return;if(u(t)){var i=d(t);i.deleteText(n,r)}},getTextPreferences:function e(){return r},refreshTextPreferences:function e(){if(!TS.model.is_our_app&&!TS.boot_data.feature_texty_browser_substitutions||TS.model.is_our_app&&!TS.model.is_mac){r=false;return}r={substitutions:{},useSmartDashes:true,useSmartQuotes:true};if(TS.model.is_our_app){var t=TSSSB.call("readSystemTextPreferences");if(t){r.substitutions=_.mapValues(_.keyBy(t.substitutions,"replace"),"with");r.useSmartDashes=t.useSmartDashes;r.useSmartQuotes=t.useSmartQuotes}}if(!r.substitutions["--"]&&r.useSmartQuotes)r.substitutions["--"]="—"},clearHistory:function e(t){t=o(t);if(!t)return false;var n=d(t);if(!n)return;n.clearHistory()},supportsTexty:function e(){return TS.boot_data.feature_texty&&!TS.model.is_old_ie},test:function e(){var e={_normalizeInput:o,_isFormElement:l};return e}});var e=[".",",",";",":","?","!","]",")","*","_","~",">"];var t=e.map(function(e){return"\\"+e}).join("");var r=false;var i=new RegExp("(?:^|\\s|\\{|\\[|\\(|<|>|\\*|_|\\/|\"|“|‘|'|:)(@[^\\s"+t+"]+)","g");var a=[];var s=[];var o=function e(t){if(!t)return false;if(t instanceof jQuery&&t[0])t=t[0];if(t.nodeType!==Node.ELEMENT_NODE)return false;if(!TS.utility.contenteditable.supportsTexty())return t;if("textarea"===t.tagName.toLowerCase())return t;if("input"===t.tagName.toLowerCase())return t;if($(t).hasClass("ql-editor"))return t.parentNode;if(t.hasAttribute("contenteditable"))return t;if(TS.utility.contenteditable.supportsTexty()&&"DIV"===t.tagName)return t;return false};var l=function e(t){if(!t)return false;if(!TS.utility.contenteditable.supportsTexty())return true;if("textarea"===t.tagName.toLowerCase())return true;if("input"===t.tagName.toLowerCase())return true;return false};var u=function e(t){if(!t)return false;if(!TS.utility.contenteditable.supportsTexty())return false;var n=d(t);if(n)return true;return false};var d=function e(t){return $(t).data("__ts_quill")};var c=function e(t,n){$(t).data("__ts_quill",n)};var m=function e(t,n){if(t.metaKey)return false;if(n&&TS.utility.contenteditable.isCursorInPreBlock(n)&&TS.model.prefs.enter_is_special_in_tbt)return!t.shiftKey;if(t.shiftKey&&!(t.ctrlKey||t.altKey))return true;if(!t.shiftKey&&(t.ctrlKey||t.altKey))return true;return false};var f=function e(t){var n=TS.chat_history.getCommands();if(!n.length)return false;var r=n[0];TS.utility.contenteditable.value(t,r);TS.utility.contenteditable.cursorPosition(t,r.length,0);return true};var p=function e(t,n){if($(t).hasClass("texty_single_line_input"))n=n.replace(/\n/g," ");return n.replace(/^[\u200b\uFEFF]+|[\u200b\uFEFF]+$/gm,"")};var h=function e(t,n){if($("#chat_input_tab_ui").length)return;var r=TS.utility.contenteditable.value(t);var a=TS.utility.contenteditable.cursorPosition(t);if(!r.length)return;var s=TS.format.texty.convertContentsStringToContents(r);var o=[];var l=[];var u=0;var d;if(n.complete_member_specials)d=TS.tabcomplete.members.getBroadcastKeywords(n.complete_member_specials);s.contents.forEach(function(e){if(!e.attributes)e.insert.replace(i,function(t,n,r){r+=t.length-n.length;if(!(a.start>r+u&&a.start<=r+u+n.length)){var i=n.replace(/^@/,"");if(d&&-1!==_.map(d,"name").indexOf(i)){var s=_.find(d,{name:i});o.push(S(e.insert,n,r+u,[s]))}else l.push(n)}});u+=e.insert.length});T(t,o);g(t,_.uniq(l),n)};var g=function e(t,n,r){_.pullAll(n,a);_.pullAll(n,s);if(!n.length)return;var o;if(!r.no_model_ob)o=r.model_ob||TS.shared.getActiveModelOb();n.forEach(function(e){s.push(e);var n={query:e.replace(/^@/,""),max_api_results:20,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false,limit_by_model_relevancy:o};TS.members.promiseToSearchMembers(n).then(function(n){var r={usergroups:TS.user_groups.getActiveUserGroups(),members:n&&n.items?n.items:[]};var o={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};var l=TS.sorter.search(e,r,o);if(!l.length){a.push(e);return}var u=0;var d=[];var c=TS.utility.contenteditable.value(t);var m=TS.utility.contenteditable.cursorPosition(t);var f=TS.format.texty.convertContentsStringToContents(c);f.contents.forEach(function(t){if(!t.attributes)t.insert.replace(i,function(n,r,i){if(r!==e)return;i+=n.length-r.length;if(!(m.start>i+u&&m.start<=i+u+r.length))d.push(S(t.insert,r,i+u,l))});u+=t.insert.length});T(t,d);_.pull(s,e)})})};var S=function e(t,n,r,i){var a;var s;var o=1===i.length&&i[0];var l={id:"UNVERIFIED",label:n,index:r,length:n.length};var u=function e(t){return a===TS.tabcomplete.members.getDisplayTextForResult(t,true)};var d=function e(t){return s==="@"+TS.members.getMemberSecondaryName(t)};if(o){a=TS.tabcomplete.members.getDisplayTextForResult(o,true);l={id:o.id,label:a,index:r,length:n.length}}i.sort(function(e,t){var n=TS.tabcomplete.members.getDisplayTextForResult(e,true).length;var r=TS.tabcomplete.members.getDisplayTextForResult(t,true).length;return r-n});for(var c=0;c<i.length;c+=1){o=i[c];a=TS.tabcomplete.members.getDisplayTextForResult(o,true);s=o.is_broadcast_keyword||o.is_usergroup?"":TS.members.getMemberSecondaryName(o);var _=a.length>l.length&&a.toLowerCase()===t.substr(r,a.length).toLowerCase();var m=false;if(!_&&s){s="@"+s;m=s.length>l.length&&s.toLowerCase()===t.substr(r,s.length).toLowerCase()}if(_||m){var f=[];var p=_?a:s;if(_)f=i.filter(u);else f=i.filter(d);if(1===f.length)l={id:o.id,label:p,index:r,length:p.length};else{l.label=p;l.length=p.length}break}}return l};var T=function e(t,n){if(!n.length)return;var r={contents:[]};var i=0;n.forEach(function(e){var t=e.index-i;if(t>0)r.contents.push({retain:t});r.contents.push({delete:e.length});var n={};if("UNVERIFIED"===e.id)n={id:e.id,label:e.label,unverified:true};else n={id:e.id,label:e.label,unverified:false};n.mention=TS.format.texty.shouldHighlightMention(n.id,n.label);r.contents.push({insert:e.label,attributes:{slackmention:n}});i=e.index+e.length});TS.utility.contenteditable.updateContents(t,r)};var v=function e(){a=[];s=[]}})()},4310:function(e,t){(function(){"use strict";TS.registerModule("utility.attachments",{hasContent:function t(n,r){if(!n)return false;if(!_.isArray(r))r=[].concat(r);var i=_.difference(e,r);return _.some(i,function(e){return!_.isEmpty(n[e])})},getMediaSource:function e(t){if(!t)return;var n=TS.utility.attachments.getMediaType(t);switch(n){case"video":return t.thumb_url;case"audio":return t.audio_html||t.audio_url;case"other":return t.other_html;case"image":return t.image_url}return t.from_url},getMediaType:function e(t){if(!t)return;if(t.video_html)return"video";if(t.audio_html||t.audio_url)return"audio";if(t.other_html)return"other";if(t.image_url)return"image"},getDecoratedAttachment:function e(t,n){var r=_.cloneDeep(t);r._source=a(r);if(s(r))r=o(r,n);else if("twitter"===r.service_name)r=u(r);else if("salesforce"===r.service_name)r=d(r);if(r.is_app_unfurl&&r.bot_id){var i=TS.bots.getBotById(r.bot_id);if(i){r._attribution=i.name;r._attribution_link="/services/"+r.bot_id}}if(r._source.icon)r._source.icon=c(r._source.icon);if(r.footer_icon)r.footer_icon=c(r.footer_icon);return r},getMediaCaretLocation:function e(n){var r=_.find(t,function(e){return _.some(n[e])});return r||"end"},isAutomatedSlackUnfurl:function e(t){return!!t&&s(t)&&-1!==TS.utility.msgs.automated_subtypes.indexOf(t.msg_subtype)},formatMessageAttachmentPart:function e(t,n,r,i,a,s){if(n){if(r&&TS.utility.msgs.isAutomatedMsg(n))r=false;if(r&&!_.isEmpty(n.attachments)){var o=n.attachments.some(TS.utility.attachments.isAutomatedSlackUnfurl);if(o)r=false}}if(true===s)t=_.escape(t);var l=TS.format.formatWithOptions(t,n,{no_highlights:true!==r,no_specials:true!==i,enable_slack_action_links:true===a});l=TS.utility.msgs.handleSearchHighlights(l);return l},findAttachment:function e(t){if(!t)return;var n=TS.utility.msgs.findMsg(t.message_ts,t.channel_id);if(!n)return;return _.find(n.attachments,{id:t.attachment_id})},unfurlPlaceholders:function e(t){t.find(".unfurl-placeholder:not(.unfurled)").each(function(e,t){var n=$(t);n.addClass("unfurled");var r=_.uniqueId("pending_unfurl_");n.attr("id",r);try{var a=n.attr("href");TS.api.call("chat.unfurlLink",{url:a}).then(function(e){if(e&&e.data&&e.data.attachments&&e.data.attachments[a]){var t=e.data.attachments[a];var n=$("#"+r);if(!n.length)return;if(false===TS.model.prefs.a11y_animations&&"gif"===t.file_type)return;var s=TS.inline_attachments.renderStandaloneAttachment(t);if(TS.client&&TS.client.ui){var o=TS.client.ui.areMsgsScrolledToBottom();n.replaceWith(s);if(void 0!==o){if(TS.pri)TS.log(888,"unfurlPlaceholders: Insta-scrolling back to bottom after unfurl of attachment #"+r);TS.client.ui.instaScrollMsgsToBottom(false)}i()}else{var l=n.closest(".unfurl-container");n.replaceWith(s);l.wrap('<div class="unfurl"></div>');l.removeClass("unfurl-render-pending")}}else throw new Error("No unfurl data")}).catch(function(){$("#"+r).addClass("hidden")})}catch(e){n.addClass("hidden")}});i()},isSharedChannelRequestMessage:function e(t){if(!t||!t.bot_id||!t.attachments)return false;var i=_.get(t,"attachments[1].callback_id");return!!i&&i.includes(n)&&t.bot_id===r},shouldTransformAttachmentForSharedChannelRequest:function e(t,n){return TS.utility.attachments.isSharedChannelRequestMessage(t)&&!!n.callback_id},generateSharedChannelRequestAttachmentActions:function e(t){if(!TS.boot_data.feature_connecting_shared_channels)return;var n={id:"1",name:"approve",style:"primary",text:TS.i18n.t("Review & Approve","shared_channels")(),type:"button",value:"approve"};var r={id:"2",name:"decline",style:"danger",text:TS.i18n.t("Decline","shared_channels")(),type:"button",value:"decline"};return _.assign({},t,{actions:[n,r]})},getSharedChannelRequestActionContext:function e(t,n){var r=TS.utility.attachments.generateSharedChannelRequestAttachmentActions(t.attachment);var i={action:_.find(r.actions,{id:n.action_id}),attachment:r,channel_id:n.channel_id,message:t};return i},getSharedChannelInviteIdFromContext:function e(t){var r=_.get(t,"message.attachments[1].callback_id");if(!_.isString(r)||!r.includes(n))return"";return r.replace(n,"")},test:function e(){return{_isSlackMessageUnfurl:s}}});var e=["title","text","pretext","video_html","audio_html","audio_url","other_html","from_url","fields","actions","image_url","thumb_url","author_name","service_name","footer","footer_icon","ts"];var t=["ts","footer","fields","text","title","_source"];var n="sharedchannelsinvite_";var r="B01";var i=_.throttle(function(){if(TS.client&&TS.client.ui)TS.client.ui.checkInlineImgsAndIframes("file_preview")},150);var a=function e(t){var n={};n.icon=t.service_icon||t.author_icon;n.name=t.service_name||t.author_name;n.link=t.service_url||t.author_link;n.author_name=t.author_name==n.name?t.author_subname:t.author_name;n.author_link=t.author_link;return n};var s=function e(t){if(t.is_msg_unfurl)return true;if(t.from_url&&/slack\.com\/archives\/.+\/p.+/.test(t.from_url)){t.is_msg_unfurl=true;return true}};var o=function e(t,n){if(t.author_link){var r=TS.utility.getMemberIdFromURL(t.author_link);var i=TS.utility.getBotIDFromURL(t.author_link);if(r)t._slack_author_id=r;if(i)t._slack_bot_id=i}if(n&&"pinned_item"===n.subtype)t.from_url=TS.utility.msgs.constructAbsoluteMsgPermalink(TS.shared.getActiveModelOb(),t.ts);t._is_automated_unfurl=TS.utility.attachments.isAutomatedSlackUnfurl(t);t.color=null;_.set(t,"mrkdwn_in_hash.text",true);var a=t.author_name;var s=t.author_subname;if(TS.members.shouldDisplayRealNames()||TS.boot_data.feature_name_tagging_client)t._source.name=a||s;else t._source.name=s||a;t._source.author_name=null;t._source.author_link=null;t._unfurl_type_message=true;if(!t.footer){var o=l(t.from_url,n);if(o)t.footer=o}return t};var l=function e(t,n){t=t||"";var r="";var i=TS.utility.getChannelNameFromUrl(t);var a=TS.shared.getModelObById(i);if(a)i=a.name;if(a&&(a.is_im||a.is_mpim))r=TS.i18n.t("Direct message","attachments")();else if(i)if(n&&n.thread_ts)if(TS.utility.msgs.isMsgReply(n))r=TS.i18n.t("From a thread in #{channel_name}","attachments")({channel_name:i});else r=TS.i18n.t("Thread in #{channel_name}","attachments")({channel_name:i});else r=TS.i18n.t("Posted in #{channel_name}","attachments")({channel_name:i});return r};var u=function e(t){t._source.name=t.author_name;t._source.link="https://twitter.com/"+t.author_subname;t._source.author_name=t.author_subname;t._source.author_link=t._source.link;t._unfurl_type_message=true;if(!t.footer)t.footer=TS.i18n.t("Twitter","attachments")();if(!t.footer_icon)t.footer_icon=cdn_url+"/6e067/img/services/twitter_pixel_snapped_32.png";return t};var d=function e(t){t._source.name=t.author_name;t._source.author_name=t.author_subname;t._unfurl_type_message=true;t._always_expand=true;return t};var c=function e(t){if(!t)return;if(0===t.indexOf("/img/"))return t;var n={width:16,height:16};if("ico"===t.split(".").pop())n.convert_ico=true;return TS.utility.getImgProxyURLWithOptions(t,n)}})()},4313:function(e,t){(function(){"use strict";TS.registerModule("ui.inline_msg_input",{onStart:_.noop,make:function e(a,s){var o=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var l=!!(TS.client&&!s.no_emo);var u=!!(TS.client&&TS.model.prefs.webapp_spellcheck);var d=TS.templates.inline_message_input({input_id:_.uniqueId("inline_message_input_"),include_emo:l,is_texty:TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty(),should_spellcheck:u});var c=$(d);c.appendTo(a);var m=c.find(".message_input");if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())TSSSB.call("inputFieldCreated",m.get(0));if(s.placeholder)TS.utility.contenteditable.placeholder(m,s.placeholder);if(s.aria_label)m.attr("aria-label",s.aria_label);t(m,s);n(c,m,s);r(c,m);if(s.scrollIntoView)i(c,m,o);return c}});var e=0;var t=function t(n,r){if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty())return;var i=true;if(false===r.complete_member_specials)i=false;var a=!!r.complete_cmds;var s=!!r.in_thread;n.TS_tabComplete({complete_cmds:a,complete_channels:true,complete_emoji:true,complete_member_specials:i,complete_user_groups:true,no_tab_out:true,onComplete:function e(t,r){TS.utility.populateInput(n,t,r)},sort_by_membership:true,include_self:!!TS.boot_data.feature_name_tagging_client,model_ob:r.model_ob,in_thread:s});var o={id:"inline_msg_input_tab_ui_"+e,scroll_with_element:!!TS.client,model_ob:r.model_ob};e+=1;var l=n.closest("#col_flex").length>0;if(l){o.min_width=300;o.narrow=!!TS.client}n.tab_complete_ui(o)};var n=function e(t,n,r){var i=r.onSubmit||_.noop;var a=r.onCancel||_.noop;if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()){TS.utility.contenteditable.create(n,{modules:{msginput:{onUpArrow:function e(){if(!TS.model.prefs.arrow_history)return l(n,false,r)},onUpArrowCmd:function e(){l(n,true,r)}},tabcomplete:{searchOptions:{complete_member_specials:r.complete_member_specials,model_ob:r.model_ob,in_thread:!!r.in_thread},completers:r.completers,positionMenu:function e(t){var i=n.offset();var a=$(window).width()-i.left-2;t.style.width=Math.min(n.outerWidth(),a)+"px";t.style.minWidth=0;TS.tabcomplete.positionUIRelativeToInput(t,n,r.autocomplete_below_input)}}},placeholder:r.placeholder,onEnter:function e(){if(!TS.client.ui.cal_key_checker.prevent_enter)o(n,t,i);if(r.onEnter)r.onEnter();return false},onEscape:function e(){if(r.onEscape)r.onEscape()},onTab:function e(){if(r.onTab)r.onTab();return TS.boot_data.feature_keyboard_navigation},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(n);if(r.onTextChange)r.onTextChange(n)}});TS.utility.contenteditable.enable(n)}t.bind("destroyed",function(){a(t);if(!TS.boot_data.feature_texty_takes_over||!TS.utility.contenteditable.supportsTexty())TSSSB.call("inputFieldRemoved",n.get(0))});t.bind("submit",function(e){e.preventDefault();o(n,t,i)});if(TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty())return;n.bind("textchange",function(){TS.msg_edit.checkLengthAndUpdateMessage(n);if(r.onTextChange)r.onTextChange(n)}).bind("keyup",function(){var e;if(window.getSelection){e=window.getSelection();if(e&&e.toString&&!e.toString())t.scrollintoview({direction:"vertical",px_offset:-50})}}).bind("keydown",function(e){if(e.which==TS.utility.keymap.enter&&(e.ctrlKey||e.altKey)){if(!TS.model.is_mac||TS.model.is_FF||TS.model.is_electron||TS.model.is_chrome_desktop){var a=TS.utility.contenteditable.cursorPosition(n).start;var s=TS.utility.contenteditable.value(n);var l=s.substr(0,a)+"\n"+s.substr(a);TS.utility.contenteditable.value(n,l);n.trigger("autosize").trigger("autosize-resize");TS.utility.contenteditable.cursorPosition(n,a+1)}}else if(e.which==TS.utility.keymap.enter){if(!(TS.model.prefs.enter_is_special_in_tbt&&TS.utility.isCursorWithinTBTs(n)&&!e.shiftKey))if(TS.model.prefs.enter_is_special_in_tbt&&TS.utility.isCursorWithinTBTs(n)&&e.shiftKey){e.preventDefault();o(n,t,i)}else if(n.tab_complete_ui("isShowing"))e.preventDefault();else if(!e.shiftKey&&!e.altKey){e.preventDefault();o(n,t,i)}}else if(TS.client&&TS.client.ui.shouldEventTriggerMaybeEditLast(e,n))u(n,r)}).autosize({boxOffset:18})};var r=function e(t,n){var r=t.find(".emo_menu");r.removeClass("hidden");r.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:n})})};var i=function e(t,n,r){if(TS.client&&r)TS.client.ui.instaScrollMsgsToBottom(false);t.scrollintoview({duration:500,px_offset:100,complete:function e(){TS.utility.contenteditable.focus(n);TS.utility.setCursorPosition(n,1e8)}})};var a=function e(t,n){var r=t.closest("ts-message");if(n&&r.length){var i=r.data("ts");var a=TS.utility.msgs.getMsg(i,n.msgs);if(a&&TS.utility.msgs.canEditMsg(a,n))return a}return null};var s=function e(t,n){var r=TS.msg_edit.isMessageTooLong(t);if(r)return false;if(!$.trim(n))return false;return true};var o=function e(t,n,r){var i=TS.utility.contenteditable.value(t);if(s(t,i))r(n,i)};var l=function e(t,n,r){var i=jQuery.Event("keydown",{altKey:false,shiftKey:false,which:TS.utility.keymap.up});if(n)if(TS.model.is_mac)i.metaKey=true;else i.ctrlKey=true;if(!TS.client.ui.shouldEventTriggerMaybeEditLast(i,t))return true;u(t,r)};var u=function e(t,n){var r=n.getMsgDivForEditing||a;var i=n.model_ob;var s=r(t,i);if(s&&s.length){var o=s.data("ts");var l=s.data("model-ob-id");i=TS.shared.getModelObById(l);var u=s.closest("#convo_container").length>0;var d=u?"convo":null;TS.msg_edit.startEdit(o,i,d)}}})()},4316:function(e,t){(function(){"use strict";TS.registerModule("attachment_actions",{action_triggered_sig:new signals.Signal,action_completed_sig:new signals.Signal,onStart:function e(){TS.attachment_actions.action_triggered_sig.add(t);TS.attachment_actions.action_completed_sig.add(n)},getActionContext:function e(t){var n=a(t);var r=TS.utility.msgs.findMsg(n.message_ts,n.channel_id);if(!r)return;if(TS.boot_data.feature_connecting_shared_channels&&TS.utility.attachments.isSharedChannelRequestMessage(r))return TS.utility.attachments.getSharedChannelRequestActionContext(r,n);var i=_.find(r.attachments,{id:n.attachment_id});if(!i)return;var s=_.find(i.actions,{id:n.action_id});if(!s)return;return{action:s,attachment:i,channel_id:n.channel_id,message:r}},handleActionEventAndGetContext:function e(t){var n=t.data("url");if(n){var r=n.match(/<(.*?)\|/);var i=r?r[1]:n;if(!i)return;if(0===i.indexOf(TS.utility.msgs.new_api_url_prefix))TS.utility.msgs.doNewApiUrl(i);else if(TS.boot_data.feature_link_buttons)TS.utility.openInNewTab(n,"_blank");return}var a=TS.attachment_actions.getActionContext(t);if(TS.client.activeChannelIsHidden()||a.channel_id!=TS.shared.getActiveModelOb().id)TS.client.ui.tryToJump(a.channel_id,a.message.ts);return a},confirmAction:function e(t,n,r){var i="danger"===t.style?"btn_danger":"btn_primary";var a=_.defaults(t.confirm,{dismiss_text:TS.i18n.t("Cancel","attachment_actions")(),ok_text:TS.i18n.t("OK","attachment_actions")(),text:"",title:""});if(a.text)a.text=TS.emoji.graphicReplace(a.text);else if(!a.title)a.text=TS.i18n.t("Are you sure?","attachment_actions")();if(a.title)a.title=TS.emoji.graphicReplace(a.title);TS.generic_dialog.start({title:a.title,body:a.text,show_go_button:true,show_cancel_button:true,go_button_text:a.ok_text,go_button_class:i,cancel_button_text:a.dismiss_text,onGo:n,onCancel:r})},render:function e(t,n,r){if(!t||!n)return;var a=i(t,n);if(!a.length)return;if(!r||a.find(".attachment_actions_interactions").hasClass("attachment_pending")){var s=TS.templates.attachment_actions({attachment:t});a.html(s);TS.attachment_actions.select.decorateNewElements(a)}},test:function t(){var n={};Object.defineProperty(n,"_getActionContextDataFromDOM",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(n,"_getPendingAttachment",{get:function t(){return e},set:function t(n){e=n}});return n}});function e(e,t){if(!e||!t||!t.length)return;var n=_.map(t,"id");var r=_.cloneDeep(e);r.actions.forEach(function(e){e._disabled=true;e._loading=_.includes(n,e.id)});r._pending=true;return r}function t(t){if(!t||!t.message||!t.attachment||!t.action||!t.channel_id){TS.warn("_onActionTriggered: missing message, attachment, action, or channel_id");return}var n=e(t.attachment,[t.action]);if(n)TS.attachment_actions.render(n,t.message.ts);var r=_.clone(t.action);delete r.options;var i={actions:[r],attachment_id:t.attachment.id,callback_id:t.attachment.callback_id,channel_id:t.channel_id,is_ephemeral:t.message.is_ephemeral,message_ts:t.message.ts};var a=_.get(t.message,"bot_profile.team_id",false);if(a)i.team_id=a;var s={payload:JSON.stringify(i),client_token:TS.interop.client_action_token.generateAndEnqueue()};if(t.message.bot_id)s.service_id=t.message.bot_id;if(t.message.user)s.bot_user_id=t.message.user;TS.api.call("chat.attachmentAction",s).then(function(e){TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,is_expecting_ms_update:!!(_.get(e,"data.replaced")||_.get(e,"data.deleted"))})}).catch(function(e){TS.error(e);TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,err:e})})}function n(e){if(!e)return;if(e.err){var t=TS.i18n.t("Oh no, something went wrong. Please try that again.","attachment_actions")();var n={text:_.get(e,"err.data.response")||t,ephemeral_type:_.get(e,"err.data.error")||"attachment_action_error",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(n)}if(e.attachment&&e.message_ts&&e.channel_id&&!e.is_expecting_ms_update)r(e)}function r(e){TS.utility.rAF(function(){var t=TS.utility.attachments.findAttachment({attachment_id:e.attachment.id,message_ts:e.message_ts,channel_id:e.channel_id});if(t)TS.attachment_actions.render(t,e.message_ts,true)})}function i(e,t){var n=TS.templates.makeMsgDomId(t);var r="#"+n+", #"+n+"_conversation";return $(r).find("[data-attachment-id="+e.id+"] .attachment_actions")}function a(e){var t=e.parents("[data-attachment-id]");var n=t.parents("ts-message");var r={action_id:String(e.data("action-id")||""),attachment_id:String(t.data("attachment-id")||""),channel_id:String(n.data("model-ob-id")||""),message_ts:String(n.data("ts")||"")};Object.keys(r).forEach(function(e){if(!r[e])throw new Error('Attachment is missing "'+e+'"')});return r}})()},4317:function(e,t){(function(){"use strict";TS.registerModule("attachment_actions.select",{onStart:_.noop,decorateNewElements:function e(t){t=t||TS.client.ui.$msgs_div;var n=t.find(".attachment_actions_interactions select:not(.hidden)");n.each(function(){var e=$(this);var t=TS.client?TS.attachment_actions.getActionContext(e):{};var n={adjustAvailableSpaceAbove:d,adjustAvailableSpaceBelow:u,allow_list_position_above:true,classes:"select_attachment",data_promise:m(t),disabled:e.attr("disabled"),errorTemplate:a,filter:o,input_debounce_wait_time:g(t),min_query_length:_.get(t,"action.min_query_length",0),no_default_selection:true,onItemAdded:s,onListShown:l(t),placeholder_text:T(t),filter_placeholder_text:v(t),should_graphic_replace_emoji:true,style:TS.ui.lazy_filter_select.STYLES.filter_in_list,template:S(t)};e.lazyFilterSelect(n).addClass("hidden");_.defer(y,t,e)})},getActionModel:function e(t,r){var i=n[t.data_source]||n.default;return _.merge({},t,{_disabled:t._disabled||!!r,data_source:i,options:C(t.options),option_groups:x(t.option_groups),text:t.text||b(i)})}});var e={channels:TS.i18n.t("Choose a channel…","attachment_actions")(),conversations:TS.i18n.t("Choose a conversation…","attachment_actions")(),default:TS.i18n.t("Choose an option…","attachment_actions")(),external:TS.i18n.t("Choose an option…","attachment_actions")(),users:TS.i18n.t("Choose a person…","attachment_actions")()};var t={channels:TS.i18n.t("Search channels","attachment_actions")(),conversations:TS.i18n.t("Search conversations","attachment_actions")(),default:TS.i18n.t("Filter options","attachment_actions")(),external:TS.i18n.t("Search options","attachment_actions")(),users:TS.i18n.t("Search people","attachment_actions")()};var n={channels:"channels",conversations:"conversations",default:"default",external:"external",users:"users"};var r=250;function i(e,t){var n=_.find(t.attachment.actions,{id:e});if(n)n.selected_options=[]}function a(e){if(!e)return TS.i18n.t("No results.","lazy_filter_select")();return TS.i18n.t("Couldn’t load results.","lazy_filter_select")()}function s(e){if(!TS.client)return;var t=this.$select;var n=TS.attachment_actions.handleActionEventAndGetContext(t);var r=_.get(e,"model_ob.id",e.value);var a=function t(){n.action.selected_options=[{text:e.text,value:r}];var a=i.bind(null,n.action.id);TS.attachment_actions.action_completed_sig.addOnce(a);_.defer(TS.attachment_actions.action_triggered_sig.dispatch,n)};var s=function e(){t.lazyFilterSelect("clearValue")};if(n.action.confirm)TS.attachment_actions.confirmAction(n.action,a,s);else a()}function o(e,t){return _.isEmpty(t)||TS.fuzzy.score(e.text.toLowerCase(),t.toLowerCase())<Infinity}function l(e){var t=_.get(e,"action.data_source");var n=E(e);return function e(){A(t,n)}}function u(e){var t=$("#footer").height()||0;return e-t}function d(e){var t=$("#client_header").height()||0;return e-t}function c(e){var t=_.get(e,"action.data_source");return n[t]||n.default}function m(e){switch(c(e)){case n.channels:return f({channels:{include_archived:false}},{default_query:"#"});case n.conversations:return p();case n.external:return h(e);case n.users:return f({members:{include_self:true}},{default_query:"@"})}}function f(e,t){e=_.defaults(e,{limit:100,sort:{frecency:true}});t=_.defaults(t,{default_query:""});return function(n){n=n||t.default_query;return new Promise(function(t,r){TS.searcher.search(n,e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},r)})}}function p(){return function(e){return new Promise(function(t,n){TS.ui.file_share.promiseToGetFileShareSelectOptions(e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},n)})}}function h(e){return function(t){return new Promise(function(n,r){var i=_.get(e.message,"bot_profile.team_id",false);var a={name:e.action.name,value:t,attachment_id:e.attachment.id,callback_id:e.attachment.callback_id,channel_id:e.channel_id,is_ephemeral:true,message_ts:e.message.ts};if(i)a.team_id=i;TS.api.call("chat.attachmentSuggestion",{service_id:E(e),payload:JSON.stringify(a)}).then(function(e){n({all_items_fetched:true,items:M(e),replace_all_items:true})}).catch(function(e){r(e)})})}}function g(e){if(c(e)!==n.default)return r}function S(e){var t=c(e);if("users"===t)return k;else if(_.includes([n.channels,n.conversations],t))return w}function T(e){return _.get(e,"action.text")||b(e)}function v(e){return _.get(t,c(e),t.default)}function b(t){return _.get(e,c(t),e.default)}function y(e,t){if(!$.contains(document,t[0]))return;var r=_.get(e,"action.selected_options[0]");if(r){var i=_.includes([n.channels,n.conversations,n.users],c(e));if(i){var a=TS.shared.getModelObById(r.value);if(a)r={model_ob:a};else return}else r=I(r);t.lazyFilterSelect("forceSelectItem",r)}}function w(e){var t=TS.templates.attachment_actions_select_channel_or_conversation_option(e.model_ob);return new Handlebars.SafeString(t)}function k(e){var t=TS.templates.attachment_actions_select_user_option(e.model_ob);return new Handlebars.SafeString(t)}function x(e){if(!e)return;return e.map(function(e){return _.merge({},e,{options:C(e.options),text:e.text&&new Handlebars.SafeString(e.text)})})}function C(e){if(!e)return;return e.map(function(e){return _.merge({},e,{description:e.description&&new Handlebars.SafeString(e.description),text:e.text&&new Handlebars.SafeString(e.text)})})}function M(e){var t=_.get(e,"data.option_groups");if(_.isArray(t))return t.map(function(e){var t=_.get(e,"options",[]).map(function(e){return I(e,{is_group_item:true})});return{lfs_group:true,label:e.text,children:t}});return _.get(e,"data.options",[]).map(I)}function I(e,t){e=_.merge({},e,{is_group_item:_.get(t,"is_group_item")});var n=TS.templates.attachment_actions_select_option(e);var r=$("<div>").html(n);return r.children()[0]}function A(e,t){TS.clog.track("MSG_MENU_OPEN",{data_source:e,service_id:t})}function E(e){if(_.get(e,"attachment.is_app_unfurl"))return e.attachment.bot_id;return _.get(e,"message.bot_id")}})()},4321:function(e,t){(function(){"use strict";TS.registerModule("utility.enterprise",{getSelf:function e(){return _.get(TS.enterprise.model.get(),"org.user")},splitQueryIntoTerms:function e(t,n,r){var i=n;var a;t=t.trim();if(t.length>=2){i=_.isArray(n)?_.slice(n):[];a=t.split(/\s+/);_.each(a,function(e){i.push({type:r||"fuzzy_with_email",value:e})})}return i},doFormatSearchQuery:function e(t,n){n=n||"";var r=[];switch(t){case"members":r.push({type:"is",value:"user"});break;case"groups":r.push({type:"is",value:"group"});break;case"teams":r.push({type:"is",value:"team"})}return{query:TS.utility.enterprise.splitQueryIntoTerms(n,r)}},getSSOProviderLabel:function e(t,n){if(!t)return n;var r=_.get(t,"type","");var i=_.get(t,"name","");var a=""===r;var s="saml"===r;if(a||s)return n;return i||n},getProviderLabel:function e(t,n){var r=n||"IDP";if(!t)return r;n=_.get(t,"saml_provider")||r;if("saml"===n.toLowerCase())n=r;return TS.utility.enterprise.getSSOProviderLabel(_.get(t,"sso_provider"),n)},getGroupsTitle:function e(t){var n=TS.utility.enterprise.getProviderLabel(t);if("IDP"===n)return TS.i18n.t("IDP Groups","enterprise_dashboard")();return TS.i18n.t("{provider_label} Groups","enterprise_dashboard")({provider_label:n})},wrapWithStrongTags:_.wrap(_.escape,function(e,t){return"<strong>"+e(t)+"</strong>"}),buildTeamUrl:function e(t){return"https://"+t+"."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},buildOrgUrl:function e(t){return"https://"+t+".enterprise."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},getSanitizedIdpLabel:function e(t){return{simple:"IDP"===t||!t?"":t,your:"IDP"===t||!t?TS.i18n.t("your IdP","enterprise_utility")():t,possessive:"IDP"===t||!t?TS.i18n.t("your IdP’s","enterprise_utility")():TS.i18n.fullPossessiveString(t)}},formatChannelsData:function e(t){var n=[];if(t.private_channels){t.private_channels=_.isArray(t.private_channels)?t.private_channels:[t.private_channels];n=_.map(t.private_channels,function(e){var t=TS.members.getMemberById(e.creator)||{};return{creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,id:e.id,member_count:e.member_count,name:e.name,purpose:e.purpose.value,topic:e.topic.value,private:true,is_shared:e.is_shared}})}if(t.channels)n=n.concat(_.map(t.channels,function(e){var t=TS.members.getMemberById(e.creator)||{};return{creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,id:e.id,member_count:_.get(e,"members.length",0),name:e.name,purpose:_.get(e,"purpose.value",""),topic:_.get(e,"topic.value",""),private:false,is_general:e.is_general,is_shared:e.is_shared}}));return n},pollUntilCondition:function e(t){return new Promise(function(e,n){var r={api_method:null,api_params:{},condition_method:null,interval:5e3,interval_backoff:1e3,attempts_max:10,call_immediately:true};t=_.merge(r,t||{});var i={attempts:0,last_api_response:null,interval:parseInt(t.interval,10)||1e3,interval_backoff:parseInt(t.interval_backoff,10)||0};function a(){if(i.attempts>=t.attempts_max)return n(new Error("Giving up on "+t.api_method+", reached max attempts of "+t.attempts_max));i.attempts+=1;i.interval+=i.interval_backoff;TS.api.call(t.api_method,t.api_params).then(function(n){i.last_api_response=n;if(t.condition_method(n))return e(n);return s()}).catch(function(e){i.last_api_response=e;return s()})}function s(){window.setTimeout(a,i.interval)}if(!t.api_method)return n(new Error("missing required api_method in params"));if(!t.condition_method)return n(new Error("missing required condition_method in params"));if(t.call_immediately)a();else s()})},getUserRoleLabel:function e(t,n){var r;var i;if(n)r={primary_owner:TS.i18n.t("Primary Org Owner","enterprise_dashboard")(),owner:TS.i18n.t("Org Owner","enterprise_dashboard")(),admin:TS.i18n.t("Org Admin","enterprise_dashboard")(),single_channel_guest:TS.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.i18n.t("Member","enterprise_dashboard")()};else r={primary_owner:TS.i18n.t("Primary Owner","enterprise_dashboard")(),owner:TS.i18n.t("Owner","enterprise_dashboard")(),admin:TS.i18n.t("Admin","enterprise_dashboard")(),single_channel_guest:TS.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.i18n.t("Member","enterprise_dashboard")()};if(t.is_ultra_restricted)i=r.single_channel_guest;else if(t.is_restricted)i=r.multi_channel_guest;else if(t.is_primary_owner)i=r.primary_owner;else if(t.is_owner)i=r.owner;else if(t.is_admin)i=r.admin;else i=r.member;return i},buildAnalyticsApiOptionsFor:function e(t){var n=function e(t){return _.reduce(t,function(e,t,n){var r=TS.enterprise.model.get(["analytics",t]);if(r)e[n]=r;return e},{})};switch(t){case"teams":return n({query:"teams_search_term",sort_prefix:"teams_sort_prefix",sort_dir:"teams_sort_dir",cursor_mark:"teams_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"team_overview":return n({date_range:"current_date_range",start_date:"start_date",end_date:"end_date",team_id:"team_overview_id"});case"members":return n({query:"members_search_term",sort_prefix:"members_sort_prefix",sort_dir:"members_sort_dir",cursor_mark:"members_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"channels":return n({query:"channels_search_term",sort_prefix:"channels_sort_prefix",sort_dir:"channels_sort_dir",cursor_mark:"channels_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});default:return n({date_range:"current_date_range",start_date:"start_date",end_date:"end_date"})}},maybeGetUpdatedAtTime:function e(t){return t?TS.interop.datetime.toTimeAgo(t):null},getObjectsForIds:function e(t,n){if(_.isEmpty(t)||_.isEmpty(n))return[];return _.intersectionWith(t,n,function(e,t){return e.id===t})},getQueryForIds:function e(t){if(_.isEmpty(t))return;if(1===t.length)return{query:{type:"id",value:_.head(t)}};return{query:{type:"or",clauses:_.map(t,function(e){return{type:"id",value:e}})}}},recordAnalyticsPricingEvents:function e(t,n,r){r=r||{};var i={};switch(n){case"overview_impression":i.action="impression";i.step="team_stats_overview";break;case"coachmark_impression":i.action="impression";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";break;case"coachmark_resolve":i.action="click";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";i.ui_element="learn_more_btn";break;case"coachmark_reject":i.action="dismiss";i.step="team_stats_overview_"+_.get(r,"callout_module")+"_coachmark";i.ui_element="skip_this";break;case"msg_files_pricing_btn_click":i.action="click";i.step="team_stats_overview";i.ui_element="msg_files_chart_link_btn";break;case"single_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element=_.get(r,"callout_module")+"_upgrade_link";break;case"multi_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element="multi_lim_upgrade_link";break;case"data_table_upsell_banner_impression":i.action="impression";i.step="team_stats_"+_.get(r,"report_name");break;case"data_table_upsell_banner_click":i.action="click";i.step="team_stats_"+_.get(r,"report_name");i.ui_element="see_pricing_plans_btn"}TS.clog.track(t,{contexts:{ui_context:i}})},recordAnalyticsImpression:function e(t,n,r,i,a){var s="ENTERPRISE_ANALYTICS";var o={};var l={};o.action="impression";o.ui_element=n;l.entity_key=r;l.tracking_code=i;l.anchor_page=t;if(a)l.target_team_id=a;else l.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id");TS.clog.track(s,_.assign({},l,{contexts:{ui_context:o}}))},recordAnalyticsTooltipHover:function e(t){var n="ENTERPRISE_ANALYTICS";var r={};var i={};r.action="hover";r.ui_element="NOTING_BADGE";i.entity_key=t;i.anchor_page="organization_overview";i.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id");TS.clog.track(n,_.assign({},i,{contexts:{ui_context:r}}))},recordAnalyticsSearchEvent:function e(t,n,r){var i="ENTERPRISE_ANALYTICS";var a={};var s={};a.action="impression";a.action_status=r?2:1;a.ui_element="SEARCH_BAR";s.entity_key=n;s.anchor_page=t;s.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id");TS.clog.track(i,_.assign({},s,{contexts:{ui_context:a}}))},convertDateRangeToThriftID:function e(t){switch(t){case"30d":return"FILTER_LAST_30DAYS";case"all":return"FILTER_ALL_TIME"}},convertTimeseriesTabToClogKey:function e(t){switch(t){case"active-users_weekly_active_users":return"wau_ts";case"active-users_daily_active_users":return"dau_ts";case"messages-and-files_messages_sent":return"messages_sent_ts";case"messages-and-files_files_uploaded":return"files_uploaded_ts";case"transparency_where_messages_sent":return"transparency_sent_ts";case"transparency_where_messages_read":return"transparency_read_ts"}}})})()},4325:function(e,t){(function(){"use strict";TS.registerModule("replies",{thread_marked_sig:new signals.Signal,thread_subscription_changed_sig:new signals.Signal,sanity_check_failed_sig:new signals.Signal,reply_changed_sig:new signals.Signal,reply_deleted_sig:new signals.Signal,DEFAULT_HISTORY_API_LIMIT:100,onStart:function e(){TS.channels.message_received_sig.add(u);TS.groups.message_received_sig.add(u);TS.ims.message_received_sig.add(u);TS.mpims.message_received_sig.add(u);TS.channels.message_removed_sig.add(l);TS.groups.message_removed_sig.add(l);TS.ims.message_removed_sig.add(l);TS.mpims.message_removed_sig.add(l);TS.channels.message_changed_sig.add(o);TS.groups.message_changed_sig.add(o);TS.ims.message_changed_sig.add(o);TS.mpims.message_changed_sig.add(o);if(TS.isSocketManagerEnabled())TS.interop.SocketManager.connectedSig.add(s);else TS.ms.connected_sig.add(s)},canReplyToMsg:function e(t,n,r){if(!TS.client)return false;if(!n)return false;if(TS.utility.msgs.isAutomatedMsg(n))return false;if(TS.utility.msgs.isFileMsg(n))return false;if(TS.utility.msgs.isTempMsg(n)||n.is_ephemeral)return false;if(TS.utility.msgs.isMsgReply(n))return false;if(TS.ims.isImWithDeletedMember(t))return false;if(!r)if(t.is_channel&&!t.is_member)return false;return true},getMessage:function e(t,n){var r=TS.utility.msgs.getMsg(n,t.msgs)||TS.utility.msgs.getMsg(n,t._archive_msgs);if(r)return r;if(TS.ui.replies)return TS.ui.replies.getActiveMessage(t,n);return null},getThread:function t(n,r,i){if(!i){var a=d(n,r);if(a){if(c(n,r))m(n,r,a);return Promise.resolve(a)}}var s={channel:n,thread_ts:r};var o={D:"im.replies",C:"channels.replies",G:"groups.replies"};var l=n[0];var u=o[l];if(!u){TS.error("Unable to get thread for message in unsupported model object type with ID"+n);return Promise.reject(new Error("missing api endpoint"))}var g=f(n,r);if(e[g])return e[g];if(TS.has_pri[S])if(i)TS.log(S,"Calling "+u+" for "+r+" because always_make_api_call");else TS.log(S,"Calling "+u+" for "+r+" because local history is incomplete");e[g]=TS.api.call(u,s).then(function(e){var t=e.data.messages.map(function(e){return TS.utility.msgs.processImsgFromHistory(e,n)});p(n,t);var i=TS.shared.getModelObById(n);if(i&&i.msgs&&i.msgs.length){var a=_.filter(i.msgs,function(e){return e.thread_ts===r&&TS.utility.msgs.isTempMsg(e)});if(a.length)t=_.sortBy(t.concat(a),"ts")}h(i,t);return t}).finally(function(){delete e[g]});return e[g]},getThreadLazy:function n(r,a,s,o){if(!o){var l=d(r,a);if(l){if(c(r,a))m(r,a,l,s);var u=_.find(l,{ts:a});return Promise.resolve({root_msg:u,messages:l,has_more_beginning:false,has_more_end:false})}}var p=TS.shared.getModelObById(r);var h=i(p);if(TS.has_pri[S])if(o)TS.log(S,"Calling "+h+" for "+a+" because always_make_api_call");else TS.log(S,"Calling "+h+" for "+a+" because local history is incomplete");var g=f(r,a);if(s){if(t[g])return t[g];t[g]=TS.replies.getThreadBefore(r,a).then(function(e){e.has_more_beginning=e.has_more;e.has_more_end=false;return e}).finally(function(){delete t[g]});return t[g]}if(e[g])return e[g];e[g]=TS.replies.getThreadAfter(r,a).then(function(e){e.has_more_beginning=false;e.has_more_end=e.has_more;return e}).finally(function(){delete e[g]});return e[g]},getThreadBefore:function e(t,n,r,s){var o={channel:t,thread_ts:n,count:TS.replies.DEFAULT_HISTORY_API_LIMIT};if(r){o.latest=r;if(s)o.inclusive=s}var l=TS.shared.getModelObById(t);var u=i(l);return TS.api.call(u,o).then(function(e){var t=a(l,n,e);if(!t.has_more)t.messages.unshift(t.root_msg);return t})},getThreadAfter:function e(t,n,r,s){var o={channel:t,thread_ts:n,count:TS.replies.DEFAULT_HISTORY_API_LIMIT};var l=false;if(r){o.oldest=r;if(s)o.inclusive=s}else{l=true;o.oldest=n;o.inclusive=true}var u=TS.shared.getModelObById(t);var d=i(u);return TS.api.call(d,o).then(function(e){var t=a(u,n,e);if(l)t.messages.unshift(t.root_msg);return t})},getThreadAround:function e(t,n,r){var i=d(t,n);if(i){var a=false;if(c(t,n))m(t,n,i,a);var s=_.find(i,{ts:n});return Promise.resolve({root_msg:s,messages:i,has_more_beginning:false,has_more_end:false})}var o=TS.replies.getThreadBefore(t,n,r);var l=TS.replies.getThreadAfter(t,n,r,true);return Promise.join(o,l,function(e,t){var n=e.has_more;var r=t.has_more;var i=e.messages.concat(t.messages);if(!n)i.unshift(e.root_msg);return{has_more_beginning:n,has_more_end:r,messages:i,root_msg:e.root_msg}})},getSubscriptionState:function e(t,n){var i=f(t,n);var a=r[i];return a},promiseToGetSubscriptionState:function i(a,s){var o=f(a,s);var l=r[o];if(l)return Promise.resolve(l);var u=e[o]||t[o];if(u)return u.then(function(){return TS.replies.getSubscriptionState(a,s)});if(n[o])return n[o];n[o]=TS.api.call("subscriptions.thread.get",{channel:a,thread_ts:s}).then(function(e){var t=e.data.subscriptions;var n=_.includes(t,s);var i={model_ob_id:a,thread_ts:s,subscribed:n};r[o]=i;return i}).finally(function(){delete n[o]});return n[o]},markThread:function e(t,n,i){var a=f(t,n);var s=r[a];if(s&&s.last_read===i)return Promise.resolve();if(s){if(!s._pending)s._pending={};s._pending[i]=true}return TS.api.call("subscriptions.thread.mark",{channel:t,thread_ts:n,ts:i}).finally(function(){if(s&&s._pending)delete s._pending[i]})},markAllThreads:function e(t){var n={};if(t)n.max_ts=t;return TS.api.call("subscriptions.thread.clearAll",n)},threadMarked:function e(t,n,i,a){var s=f(t,n);var o=r[s];if(o){o.last_read=i;o.unread_count=a}TS.replies.thread_marked_sig.dispatch(t,n,o)},threadSubscribed:function e(t,n,r){var i=g(t,n,true,r);TS.replies.thread_subscription_changed_sig.dispatch(t,n,i)},threadUnsubscribed:function e(t,n,r){var i=g(t,n,false,r);TS.replies.thread_subscription_changed_sig.dispatch(t,n,i)},setSubscriptionState:function e(t,n,i,a){var s=TS.shared.getModelObById(t);if(!s)return;var o=f(t,n);var l=r[o];if(l)l.subscribed=i;var u={channel:t,thread_ts:n};if(a)u.last_read=a;if(i)return TS.api.call("subscriptions.thread.add",u);var d=TS.replies.getMessage(s,n);if(d&&!d.thread_ts){u.preemptive_remove=true;TS.replies.thread_subscription_changed_sig.dispatch(t,n,l)}return TS.api.call("subscriptions.thread.remove",u)},maybeSlurpSubscriptionState:function e(t,n){return p(t,n)},updateThreadBroadcastRoots:function e(t,n){var r=t.msgs;if(!r||!r.length)return;_.forEach(r,function(e){if(e.ts===n.ts)return;if(e.thread_ts!==n.ts)return;if("thread_broadcast"!==e.subtype||!e.root)return;e.root=n;if(t.is_channel)TS.channels.message_changed_sig.dispatch(t,e);else if(t.is_im)TS.ims.message_changed_sig.dispatch(t,e);else if(t.is_group&&t.is_mpim)TS.mpims.message_changed_sig.dispatch(t,e);else if(t.is_group&&!t.is_mpim)TS.groups.message_changed_sig.dispatch(t,e)})}});var e={};var t={};var n={};var r={};var i=function e(t){if(t.is_channel)return"channels.replies";else if(t.is_im)return"im.replies";return"groups.replies"};var a=function e(t,n,r){var i=r.data.messages.map(function(e){return TS.utility.msgs.processImsgFromHistory(e,t.id)});var a=!!r.data.has_more;p(t.id,i);if(t&&t.msgs&&t.msgs.length){var s=_.filter(t.msgs,function(e){return e.thread_ts===n&&TS.utility.msgs.isTempMsg(e)});if(s.length)i=_.sortBy(i.concat(s),"ts")}h(t,i);var o=_.find(i,{ts:n});if(o)i=_.without(i,o);return{messages:i,has_more:a,root_msg:o}};var s=function e(t){if(t)return;if(r)_(r).values().forEach(function(e){delete e.sanity_check_status})};var o=function e(t,n){var r=TS.replies.getSubscriptionState(t.id,n.ts);var i=false===_.get(r,"sanity_check_status");if(i){if(TS.has_pri[S])TS.log(S,"Clearing previous sanity check failure for "+n.ts);delete r.sanity_check_status}TS.replies.reply_changed_sig.dispatch(t,n)};var l=function e(t,n){TS.replies.reply_deleted_sig.dispatch(t,n)};var u=function e(t,n){o(t,n)};var d=function e(t,n){var r=TS.shared.getModelObById(t);if(!r)return;if(r.is_channel&&!r.is_member)return;var i=TS.replies.getSubscriptionState(t,n);var a=false===_.get(i,"sanity_check_status");if(a){if(TS.has_pri[S])TS.log(S,"Sanity check for "+n+" failed earlier, not using local messages");return}var s;var o;if(!o){s=r.msgs;o=TS.utility.msgs.getMsg(n,s)}if(!o){s=r._archive_msgs;o=TS.utility.msgs.getMsg(n,s)}if(!o)return;var l=s.filter(function(e){return e.ts==n||e.thread_ts==n});var u=l.filter(function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)});var d=o.reply_count||0;if(u.length<d+1)return;return _.sortBy(l,"ts")};var c=function e(t,n){if(!TS.model.ms_connected||TS.api.isPaused())return false;var r=TS.replies.getSubscriptionState(t,n);var i=_.get(r,"sanity_check_status",false);if(i){if(TS.has_pri[S])TS.log(S,"Skipping sanity check for "+n+" because it passed previously");return false}return true};var m=function e(t,n,r,i){r=r.filter(function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)});var a=true;TS.replies.getThreadLazy(t,n,i,a).then(function(e){var i=e.messages;if(e.has_more_beginning)r=_.takeRight(r,i.length);else if(e.has_more_end)r=_.take(r,i.length);var a=_.map(r,"ts");var s=_.map(i,"ts");var o=_.map(r,"text");var l=_.map(r,"text");var u=TS.replies.getSubscriptionState(t,n);if(_.isEqual(a,s)&&_.isEqual(o,l)){if(TS.has_pri[S])TS.log(S,"Replies sanity check passed for "+n);if(u)u.sanity_check_status=true;return}var d=_.intersection(a,s);var c=_.difference(s,d);var m=_.difference(a,d);if(0==m.length&&c.length>0){var f=_(i).filter(function(e){return"tombstone"===e.subtype}).map("ts").value();var p=_.isEqual(c.sort(),f.sort());if(p){if(TS.has_pri[S])TS.log(S,"Replies sanity check passed (except tombstones) for "+n);TS.metrics.count("replies_sanity_check_passed_except_tombstones");return}}if(m.length>0&&0==c.length){var h=_.max(s);var g=_.every(m,function(e){return e>h});if(g){if(TS.has_pri[S])TS.log(S,"Replies sanity check passed (except newer local msgs) for "+n);TS.metrics.count("replies_sanity_check_passed_except_newer_local_msgs");return}}var T={version_ts:TS.boot_data.version_ts,channel_id:t,thread_ts:n,messages_from_api:s,messages_from_model_ob:a};TS.warn("Replies sanity check failed. Here's the debug info: "+JSON.stringify(T));TS.metrics.count("replies_sanity_check_failed");if(u)u.sanity_check_status=false;var v=TS.shared.getModelObById(t);if(!v)return;var b=TS.replies.getMessage(v,n);if(!b)return;TS.replies.sanity_check_failed_sig.dispatch(v,b,i,e.has_more_beginning,e.has_more_end);return null});return null};var f=function e(t,n){return t+"_"+n};var p=function e(t,n){n.forEach(function(e){if(!e.hasOwnProperty("_subscribed"))return;var n=f(t,e.ts);if(r[n]&&r[n].last_read){if(e._last_read&&e._last_read>r[n].last_read)r[n].last_read=e._last_read}else r[n]={model_ob_id:t,thread_ts:e.ts,subscribed:e._subscribed,last_read:e._last_read,unread_count:e._unread_count}})};var h=function e(t,n){if(!t||!t.msgs||!t.msgs.length||!n||!n.length)return;var r=_.find(n,TS.utility.msgs.msgHasReplies);if(!r||r.ts!==r.thread_ts)return;if(!TS.utility.msgs.getMsg(r.ts,t.msgs))return;var i=_.differenceBy(n,t.msgs,"ts");if(!i.length)return;var a=t.msgs.concat(i);TS.utility.msgs.setMsgs(t,a)};var g=function e(t,n,i,a){var s=f(t,n);var o=r[s];if(o)o.subscribed=i;else{o={subscribed:i,model_ob_id:t,thread_ts:n};r[s]=o}if(a.last_read)o.last_read=a.last_read;if(a.unread_count)o.unread_count=a.unread_count;return o};var S=2004})()},4326:function(e,t){(function(){"use strict";TS.registerModule("ui.thread",{expanded_threads:{},buildThreadHTML:function e(n,r){try{var i=n.model_ob;var a=n.root_msg;var u=n.replies;var d=[];if(n.max_visible_ts){var c=_.takeWhile(u,function(e){return e.ts<=n.max_visible_ts});d=_.drop(u,c.length);u=c}var m="thread_"+i.id+"_"+n.ts.replace(".","_");var f;if(i.is_im)f=TS.members.getMemberById(i.user);var p=TS.replies.getSubscriptionState(i.id,a.thread_ts);var h=p&&p.subscribed;var g=s(n);var S;var T;if(g>=TS.replies.DEFAULT_HISTORY_API_LIMIT){S=o(n);T=l(n)}var v=TS.templates.thread({id:m,ts:n.ts,model_ob:i,thread:n,root_msg:a,conversation_permalink:TS.utility.msgs.constructConversationPermalink(i,a.ts),channel_msg_permalink:TS.utility.msgs.constructMsgPermalink(i,a.ts),replies:u,new_replies:d,new_replies_count:t(d.length),im_user:f,is_subscribed:h,options:r||{},view_previous_count:g,visible_reply_count:S,total_reply_count:T});return v}catch(e){TS.error("Threads view: error rendering thread");TS.console.logError(e,"threads_view_error");return""}},updateThreadWithMessage:function e(t,s,o,l){var u=t.find('ts-message[data-ts="'+o.ts+'"]');var d;var c={};var _=t.attr("data-context");if("inline"===_)c.inline=true;d=TS.templates.builders.buildThreadMsgHTML(o,s.model_ob,s,c);var m=$(d);if(u.length){if(u.hasClass("hidden"))m.addClass("hidden");u.replaceWith(m)}else if(l){var f=t.find(".thread_replies_container");var p=t.find(".new_replies_container ts-message");f.append(p).append(m);n(t,false)}else{t.find(".new_replies_container").append(m);r(s,t)}if(!TS.utility.msgs.isMsgReply(o)){a(s,t,o);i(s,t,o)}else if(o.is_ephemeral)i(s,t,o);TS.attachment_actions.select.decorateNewElements(t);g(s,t)},removeMessageFromThread:function e(t,n,a){var s=$("#"+TS.templates.makeMsgDomIdInThreadsView(a.ts));if(!s.length)return;if(a.is_pending)s.remove();else s.addClass("delete_mode").slideUp(200,function(){s.remove()});r(n,t);g(n,t);if(a.is_ephemeral)i(n,t)},revealNewReplies:function e(t,r){return new Promise(function(e){var s=t.find(".new_reply_indicator");var o=t.find(".thread_replies_container");var l=t.find(".new_replies_container");s.animate({height:0},150,function(){n(t,false);s.css("height","");var r=o.height();o.height(r);o.css("overflow","hidden");var i=l.find("ts-message");i.appendTo(o);o.css("height","auto");var a=o.height();o.height(r).animate({height:a},300,function(){l.css("height","");o.css("height","");o.css("overflow","");e()})});a(r,t,r.root_msg);i(r,t)})},revealPreviousReplies:function e(t,n,r){var o={};var l=t.attr("data-context");if("inline"===l)o.inline=true;return new Promise(function(e,l){r.then(function(){var r=s(n);var l=t.find(".view_all_replies_container");var u=function s(){if(r){TS.ui.thread.hideThreadLoadingSpinner(t);a(n,t,n.root_msg)}else l.remove();i(n,t);var u=t.find(".thread_replies_container");var d=u.find("ts-message:first");var c=$("<div></div>");if(d.length)d.before(c);else u.append(c);var m=_.takeWhile(n.replies,function(e){return e.ts<n.min_visible_ts});_.forEach(m,function(e){c.append(TS.templates.builders.buildThreadMsgHTML(e,n.model_ob,n,o))});TS.attachment_actions.select.decorateNewElements(t);var f=c.height();c.height(0).animate({height:f},300,function(){var t=c.find("ts-message");if(d.length)t.insertBefore(d);else t.appendTo(u);c.remove();e()})};if(l.length&&!r)l.animate({height:0},150,u);else u()},function(){p(t);l()})})},renderReplyInput:function e(t,n){var r=n.model_ob;var i=n.root_msg.ts;var a=t.find(".reply_input_container");a.empty();var s=TS.permissions.members.canPostInModelOb(TS.model.user,r);if(TS.boot_data.feature_default_shared_channels&&!s)s=TS.permissions.members.canThread(r);if(!s||r.is_archived){c(r,a);return}if(!TS.replies.canReplyToMsg(r,n.root_msg)){if(r.is_channel&&!r.is_member)m(r,a);else t.addClass("no_reply_container");return}TS.ui.inline_msg_input.make(a,{placeholder:TS.i18n.t("Reply...","threads")(),complete_member_specials:TS.boot_data.feature_name_tagging_client?["BKhere"]:false,complete_cmds:true,in_thread:true,model_ob:r,onSubmit:function e(s,o){if(!TS.model.ms_connected)return;if(r.is_archived){TS.generic_dialog.alert(TS.i18n.t("This channel has been archived; you cannot send messages to it.","threads")());return}var l=_.last(n.replies);if(n.max_visible_ts)l=_.findLast(n.replies,function(e){return e.ts<=n.max_visible_ts});var d=TS.client.ui.maybeHandleReactionCmd(l,o,function(){u(a,r,i)});if(d)return;if(TS.utility.msgs.shouldSendSlashCommand(o)){u(a,r,i);TS.client.ui.sendSlashCommand(r,o,n.root_msg)}else{TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",r.id,i);var c=a.find(".reply_broadcast_toggle").prop("checked");u(a,r,i);var m=TS.ui.thread.getContextForEl(t);var f=c?"THREADS_REPLY_BROADCAST_CLICKED":"THREADS_REPLY";var p=_.get(n,".root_msg.reply_count",0)+1;TS.ui.thread.trackEvent(r.id,n.root_msg.ts,m,f,{num_msg_in_thread:p});if(c)TS.log(2004,"Submitting broadcast from threads view for "+r.id+"-"+n.root_msg.ts);TS.client.ui.sendMessage(r,o,n.root_msg,c)}return null},getMsgDivForEditing:function e(){var r=t.closest("ts-thread");var i=n.replies;var a=_.reject(i,function(e){return"tombstone"===e.subtype});if("tombstone"!==n.root_msg.subtype)a.unshift(n.root_msg);_.reverse(a);var s=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,a);if(!s)return null;return r.find('ts-message[data-ts="'+s.ts+'"]')},onTextChange:function e(t){var n=TS.utility.contenteditable.value(t);var s=!n.trim();var o=s?"":n;TS.storage.storeReplyInput(r.id,i,o);f(a)}});var o=a.find(".message_input");o.on("focusin",function(){a.addClass("has_focus")}).on("focusout",function(){var e=TS.utility.contenteditable.isEmpty(o,true);var t=document.activeElement===this;if(e&&!t)a.removeClass("has_focus")});d(r,i,a);var l=TS.storage.fetchReplyInput(r.id,i);if(l){TS.utility.populateInput(o,l);a.addClass("has_focus")}},joinChannelFromThread:function e(t,n){var r=n.closest("ts-thread");if(!r.length)return;var i=r.data("model-ob-id");var a=TS.shared.getModelObById(i);if(!a)return;TS.channels.joinById(a.id,null,{in_background:true});r.find(".join_channel_from_thread").addClass("disabled")},submitReply:function e(t,n){if(!n||0===n.length)return;var r=n.closest(".reply_input_container").find("form");if(0===r.length)return;r.submit()},findAndPopulateInput:function e(t,n,r){if(!n||!r)return;var i='ts-thread[data-model-ob-id="'+n+'"][data-thread-ts="'+r+'"]';var a=$(i).find(".message_input");TS.utility.populateInput(a,t);TS.storage.storeReplyInput(n,r,t)},showThreadLoadingSpinner:function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_loading_container");n.html(TS.templates.infinite_spinner({size:"small"}))},hideThreadLoadingSpinner:function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_loading_container");n.empty()},startInlineThread:function t(n,r){e(n.id,r.ts,true);TS.view.rebuildMsg(r)},expandInlineThread:function t(n){var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");var a=TS.shared.getModelObById(r);if(!a)return;var s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;var o={model_ob:a,root_msg:s,replies:[],ts:s.ts};TS.ui.utility.preventElementFromScrolling(n.find(".message_content"),function(){n.addClass("expanded")});TS.ui.thread.renderReplyInput(n,o);var l=TS.replies.getThread(r,i).then(function(e){var t=Infinity;if(o.replies&&o.replies.length)t=_.first(o.replies).ts;o.min_visible_ts=t;var n=_.filter(e,function(e){return e.ts!==s.ts});o.replies=n});TS.ui.thread.revealPreviousReplies(n,o,l);e(r,i,true);return null},collapseInlineThread:function t(n){var r=n.attr("data-model-ob-id");var i=n.attr("data-thread-ts");var a=TS.shared.getModelObById(r);if(!a)return;var s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;if(!TS.utility.msgs.msgHasReplies(s)){e(r,i,false);TS.view.rebuildMsg(s);return}var o=n.find(".thread_replies_container");o.animate({height:0},300,function(){o.css("height","");o.find("ts-message").remove();TS.ui.utility.preventElementFromScrolling(n.find(".message_content"),function(){n.removeClass("expanded")})});n.find(".reply_input_container").html(TS.templates.thread_inline_input_placeholder({model_ob:a,root_msg:s,conversation_permalink:TS.utility.msgs.constructConversationPermalink(a,s.ts),num_total_threads:s.reply_count}));e(r,i,false)},isThreadExpanded:function e(t,n){return!!TS.ui.thread.expanded_threads[t+n]},isMessageBeingConvertedToThread:function e(t,n){return!TS.utility.msgs.msgHasReplies(n)&&!TS.utility.msgs.isMsgReply(n)&&TS.ui.thread.isThreadExpanded(t,n.ts)},makeInlineThread:function e(t,n){var r=TS.shared.getModelObById(t);if(!r)return null;var i=TS.utility.msgs.getMsg(n,r.msgs);if(!i)return null;var a={model_ob:r,root_msg:i,replies:[],ts:i.ts};if(TS.ui.thread.isThreadExpanded(t,n)){var s=_.filter(r.msgs,function(e){return e.ts!==n&&e.thread_ts===n});a.replies=s}return a},trackEvent:function e(t,n,r,i,a){if(!t||!n||!r){TS.error("error collecting clog data for threads");return}var s=h(t,n,r,a);if("threads_view"===r)TS.client.ui.threads.incrementTrackingSeqId();TS.clog.track(i,s)},getTrackingPayloadForEl:function e(t,n){var r={};var i=TS.ui.thread.getContextForEl(t);if("threads_view"!==i&&"convo"!==i)return r;var a=t.closest("ts-thread, ts-conversation");if(!a.length)return r;var s=a.attr("data-model-ob-id");var o=a.attr("data-thread-ts");if(!s||!o)return r;return h(s,o,i,n)},getContextForEl:function e(t){if(t.closest("#threads_msgs").length>0)return"threads_view";else if(t.closest("#convo_tab").length>0)return"convo";else if(t.closest("#msgs_scroller_div").length>0)return"message_pane";else if(t.closest("#unread_msgs_scroller_div").length>0)return"unreads_view";return"other"}});var e=function e(t,n,r){TS.ui.thread.expanded_threads[t+n]=r};var t=function e(t){return TS.i18n.t("{reply_count,plural,=1{{reply_count} new reply}other{{reply_count} new replies}}","threads")({reply_count:t})};var n=function e(t,n){var r=t.find(".thread_messages");var i="show_new_reply_indicator";if(n)r.addClass(i);else r.removeClass(i)};var r=function e(r,i){if(!r||!i||!i.length)return;var a=_.reduce(r.replies,function(e,t){if(t.ts>r.max_visible_ts)e+=1;return e},0);var s=i.find(".new_reply_indicator");var o=s.find(".reveal_new_replies");if(a<=0){n(i,false);o.empty();return}var l=t(a);o.text(l);n(i,true)};var i=function e(t,n){if(!t||!n||!n.length)return;var r=n.find(".visible_reply_count");if(s(t)>=TS.replies.DEFAULT_HISTORY_API_LIMIT){var i=o(t);var a=l(t);var u=TS.i18n.t("{visible_reply_count} of {total_reply_count}","threads")({visible_reply_count:i,total_reply_count:a});r.text(u)}else r.text("")};var a=function e(t,n,r){if(!n||!n.length||!r||!r.replies)return;var i=n.find(".view_all_replies_container");if(!i.length)return;var a=i.find(".view_all_replies");var o=s(t);if(!o){i.addClass("hidden");return}var l=TS.i18n.t("View {reply_count,plural,=1{{reply_count} previous reply}other{{reply_count} previous replies}}","threads")({reply_count:o});a.text(l)};var s=function e(t){var n=t.root_msg.reply_count;var r=t.replies;if(r&&r.length){var i=_.filter(r,function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)}).length;n=t.root_msg.reply_count-i;n=Math.min(TS.replies.DEFAULT_HISTORY_API_LIMIT,n)}return n};var o=function e(t){var n;if(t.max_visible_ts)n=_.reduce(t.replies,function(e,n){if(n.ts<=t.max_visible_ts)e+=1;return e},0);else n=_.get(t,".replies",[]).length;return n};var l=function e(t){var n=_.filter(t.replies,function(e){return e.is_ephemeral||TS.utility.msgs.isTempMsg(e)}).length;var r=_.get(t,"root_msg.replies.length",0)+n;return r};var u=function e(t,n,r){var i=t.find(".message_input");TS.utility.populateInput(i,"",0);TS.utility.contenteditable.clearHistory($("#reply_container .message_input"));TS.storage.storeReplyInput(n.id,r,"");t.find(".reply_broadcast_toggle").attr("checked",false)};var d=function e(t,n,r){if(!t||!n||!r||0===r.length)return;var i=TS.permissions.members.canPostInChannel(t);r.append(TS.templates.reply_broadcast_buttons({model_ob:t,label_id:n,view:"threads",can_post_back_to_channel:i}));var a=r.find(".reply_broadcast_label_container, .reply_send");var s=r.find(".message_input");a.mousedown(function(e){e.preventDefault();TS.utility.contenteditable.focus(s)}).click(function(){TS.utility.contenteditable.focus(s)})};var c=function e(t,n){n.html(TS.templates.reply_limited({channel_name:TS.shared.getDisplayNameForModelOb(t),is_archived:t.is_archived}))};var m=function e(t,n){n.html(TS.templates.join_channel_from_thread({model_ob_name:t.name,is_threads_view:true}))};var f=function e(t){var n=t.find(".message_input");var r=!!TS.msg_edit.isMessageTooLong(n);t.find(".reply_container_info").toggleClass("hidden",r)};var p=function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var n=t.find(".view_all_replies_container");var r=n.find(".view_all_loading_container");var i=n.find(".view_all_error_msg");var a=n.find(".view_all_replies");r.empty();i.removeClass("hidden");var s=TS.i18n.t("Try Again","threads")();a.removeClass("active").text(s)};var h=function e(t,n,r,i){if(!t||!n||!r){TS.error("error collecting clog data for threads");return}var a={parent_message_id:n,channel_id:t,is_threads_view:"threads_view"===r?1:0,is_flexpane:"convo"===r?1:0};if("threads_view"===r)_.merge(a,TS.client.ui.threads.getTrackingData());if(i)a=_.merge(a,i);return a};var g=function e(t,n){var r=TS.templates.builders.buildThreadParticipantListHTML(t.root_msg);n.find(".thread_participants").html(r)}})()},4327:function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";TS.registerModule("utility.money",{formatMoney:function e(n,a,o){var l={all_digits:false};o=_.defaults(o,l);var u=o.all_digits;if(!a){TS.error("cannot format money: no currency_code specified");return""}n=n?parseInt(n,10):0;var d;if(t){if("JPY"===a)d=n;else d=n/100;var c=n%100!==0;var m=!u&&!c;var f=s(r,a,m);var p;if(i[f])p=i[f];else if(m){p=new Intl.NumberFormat(r,{style:"currency",currency:a,maximumFractionDigits:0,minimumFractionDigits:0});i[f]=p}else{p=new Intl.NumberFormat(r,{style:"currency",currency:a});i[f]=p}return p.format(d)}return TS.utility.money.formatMoneyWithoutIntl(n,a,o)},formatMoneyWithoutIntl:function t(n,i,a){var s=/^[-]*[0-9]+\.?[0-9]*$/;var o=/\B(?=(\d{3})+(?!\d))/g;var l={all_digits:false};a=_.defaults(a,l);var u=a.all_digits;if(!i){TS.error("cannot format money: no currency_code specified");return""}n=n?parseInt(n,10):0;var d=TS.i18n.locales_number_formatting.default;var c=TS.i18n.locales_number_formatting[r]?TS.i18n.locales_number_formatting[r].decimal_symbol:d.decimal_symbol;var m=TS.i18n.locales_number_formatting[i]?TS.i18n.locales_number_formatting[r].thousands_separator:d.thousands_separator;var f=e[i]?e[i].currency_symbol:i;if(!s.test(n)){TS.warn("Incorrect input passed as parameter: amount should only contain numbers");return n}var p="";var h="";var g;var S="";var T=n<0;if(T){p="-";n=Math.abs(n)}if("JPY"===i)h=n.toString();else{g=n%100!==0;h=n/100;if(!u)h=g?h.toFixed(2).replace(".",c):h.toFixed(0);else h=h.toFixed(2).replace(".",c)}h=h.replace(o,m);switch(r){case"en-US":S=p+f+h;break;case"es-ES":case"fr-FR":case"de-DE":S=p+h+" "+f;break;case"ja-JP":S=p+f+h;break;default:S=p+f+h}return S},test:function n(){var o={isInString:a,currencies:e,locales_number_formatting:TS.i18n.locales_number_formatting,locale:r,number_format_cache:i,getNumFormatKey:s,has_Intl:t};Object.defineProperty(o,"isInString",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(o,"currencies",{get:function t(){return e},set:function t(n){e=n}});Object.defineProperty(o,"locales_number_formatting",{get:function e(){return TS.i18n.locales_number_formatting},set:function e(t){TS.i18n.locales_number_formatting=t}});Object.defineProperty(o,"locale",{get:function e(){return"_locale"},set:function e(t){r=t}});Object.defineProperty(o,"number_format_cache",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(o,"getNumFormatKey",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(o,"has_Intl",{get:function e(){return t},set:function e(n){t=n}});return o}});var e={default:{currency_symbol:"$"},USD:{currency_symbol:"$"},GBP:{currency_symbol:"£"},EUR:{currency_symbol:"€"},JPY:{currency_symbol:"¥"}};var t=window.Intl&&"object"===n(window.Intl);var r=TS.i18n.locale()||"en-US";var i={};var a=function e(t,n){if(_.isEmpty(t)||_.isEmpty(n))return false;return t.indexOf(n)>=0};var s=function e(t,n,r){var i=r?"cents":"nocents";return t+"_"+n+"_"+i}})()},4328:function(e,t){(function(){"use strict";TS.registerModule("ui.react_emoji_menu",{is_showing:false,onStart:function e(){TS.prefs.emoji_mode_changed_sig.add(C);TS.prefs.preferred_skin_tone_changed_sig.add(M)},start:function e(t){m(t)}});var e=15;var t=0;var n=-6;var r="top-left";var i="reactroot_emoji_picker";var a;var s;var o="#msg_input";var l;var u;var d;var c;var m=function e(t){l=t.rxn_key;if(l){g();u=function e(n){var r=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t.rxn_key),n);TS.rxns.changeRxnsFromUserAction(t.rxn_key,n,r);if(t.callback)t.callback()}}else u=t.callback;o=!l&&(t.input_to_fill||o);if(TS.client&&TS.utility.contenteditable.isDisabled(o))return;var n=t.position;var r=TS.client&&o===TS.client.ui.$msg_input;var i=_.get(TS,"model.ui_state.flex_visible");if(r&&i)n="top-right";s=$(t.e&&t.e.target);h({open:true,is_rxn:!!l});TS.tips.hideAll();if(TS.boot_data.feature_react_emoji_picker_frecency)TS.emoji.replaceFrecentlyUsed();d=t.target_bounds||s.dimensions_rect();var a=window.pageYOffset;d.top+=a;d.bottom+=a;TS.ui.react_emoji_menu.is_showing=true;var c={};var m={position:n,offset_x:t.offset_x,offset_y:t.offset_y};p(c,m)};var f=function e(){h({open:false,is_rxn:!!l});s=null;o="#msg_input";l=null;u=null;c=null;TS.tips.unhideAll();TS.ui.react_emoji_menu.is_showing=false;p()};var p=function e(t,n){var r=b(t);var i=y(n);TS.metrics.mark("react_emoji_menu_render_mark");if(!a)a=I();TS.interop.mountEmojiPicker(a,r,i)};var h=function e(t){if(t.is_rxn){s.closest(".menu_rxn").toggleClass("active",t.open);s.closest(".rxn_panel").toggleClass("active",t.open);s.closest("ts-message").toggleClass("active",t.open);s.toggleClass("active",t.open)}else{s.closest(".emo_menu").toggleClass("active",t.open);s.closest(".handy_rxns_row").toggleClass("active",t.open);s.closest(".current_status_emoji_picker").toggleClass("active",t.open)}};var g=function e(t){var n=TS.rxns.getHandyRxnsDisplayDataByRxnKey(t);c=_.map(n.items,function(e){return e.name})};var S=function e(){if("google"===TS.model.prefs.emoji_mode)return[];return[":hand:",":hand::skin-tone-2:",":hand::skin-tone-3:",":hand::skin-tone-4:",":hand::skin-tone-5:",":hand::skin-tone-6:"]};var T=function e(t,n){var r=$(o);var i=n.display_name||n.name;var a=!(t&&t.shiftKey);if(TS.utility.contenteditable.supportsTexty()&&TS.utility.contenteditable.isContenteditable(r))setTimeout(TS.utility.contenteditable.insertTextAtCursor,0,r,i,a);else{var s=TS.utility.getCursorPosition(r).start;var l=s+i.length;var u=TS.utility.contenteditable.value(r);var d=u.substr(0,s)+i+u.substr(s);TS.utility.populateInput(r,d);if(a)setTimeout(TS.utility.setCursorPosition,0,o,l)}};var v=function e(t,n){var r=_.find(TS.model.emoji_map,{name_with_colons:TS.emoji.stripLocalizedSkinTone(t.name)});if(n)n=n.replace(/^:/,"");if(r)TS.ui.frecency.record(r,n)};var b=function e(t){t=t||{};var n={onSkinToneChanged:x,groups:TS.model.emoji_groups,skinToneChoiceNames:S(),activeSkinToneId:t.skin_tone_id||TS.model.prefs.preferred_skin_tone,numBackgroundColors:TS.model.emoji_menu_colors,onSelected:w,onClosed:k,canAddEmoji:!TS.model.user.is_restricted&&(!TS.model.team.prefs.emoji_only_admins||TS.model.user.is_admin),emojiMap:TS.model.emoji_map,skinToneModifier:TS.emoji.getChosenSkinToneModifier(!!TS.boot_data.feature_localization)};if(l)n.handyRxnNames=c;return n};var y=function i(a){a=a||{};return{targetBounds:d,allowanceX:e,allowanceY:e,position:a.position||r,offsetX:!_.isUndefined(a.offset_x)?a.offset_x:t,offsetY:!_.isUndefined(a.offset_y)?a.offset_y:n,isOpen:TS.ui.react_emoji_menu.is_showing,onClose:k}};var w=function e(t,n,r){v(n,r);if(u){setTimeout(u,0,n.name);return}if(!o)return TS.error("Could not find an _input_to_fill.");T(t,n)};var k=function e(){f()};var x=function e(t){TS.prefs.onPrefChanged({name:"preferred_skin_tone",value:t});TS.prefs.setPrefByAPI({name:"preferred_skin_tone",value:t});if(l)g(l);if(TS.boot_data.feature_react_emoji_picker_frecency)TS.emoji.replaceFrecentlyUsed();if(TS.ui.react_emoji_menu.is_showing){var n={skin_tone_id:t};p(n)}};var C=function e(){if(TS.ui.react_emoji_menu.is_showing)_.defer(p)};var M=function e(){if(l)g(l);C()};var I=function e(){if(!document.getElementById(i)){var t=document.createElement("div");t.setAttribute("id",i);document.body.appendChild(t)}return document.getElementById(i)}})()},4329:function(e,t){(function(){"use strict";TS.registerModule("ui.a11y",{focus_stack:[],unread_message_strings:{},$aria_live_div:null,zoom_level_changed_sig:new signals.Signal,zoomPercentToLevel:function t(n){return e[n]},zoomLevelToPercent:function e(n){return t[n]},onStart:function e(){a();f();h();TS.channels.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.ims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.groups.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.mpims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.prefs.a11y_animations_changed_sig.add(TS.ui.a11y.replaceAnimatedImages);$(document).on("focus","input[placeholder],textarea[placeholder]",function(e){i($(e.target))});$(document).on("blur","input[placeholder],textarea[placeholder]",function(e){i($(e.target))})},focusOnNextMessage:function e(){var t=$(document.activeElement);var r;var i=t.is(n);if(i&&t.next().length)r=t.next();else r=o();TS.ui.a11y.focusAndAddTabindex(r)},focusOnPreviousMessage:function e(){var t=$(document.activeElement);var r;var i=l();var a=t.is(n);if(a&&t.prev().length)r=t.prev();else if(a&&TS.model.archive_view_is_showing)r=o();else if(t.is("#end_display_meta"))r=o();else if(i.children(n).length&&i.children(n).last())r=i.children(n).last();else r=o();TS.ui.a11y.focusAndAddTabindex(r)},focusOnOldestUnreadMessage:function e(){if(TS.client.ui.$msgs_unread_divider&&TS.client.ui.$msgs_unread_divider.next().length)TS.ui.a11y.focusAndAddTabindex(TS.client.ui.$msgs_unread_divider.next());else TS.ui.a11y.ariaLiveAnnounce(TS.i18n.t("No unread messages.","a11y")(),true)},focusOnMessageInput:function e(){TS.ui.a11y.focusAndAddTabindex(o())},focusAndAddTabindex:function e(t){if(!t)return;if(t.attr("tabindex"))t.data("previous-tabindex",t.attr("tabindex"));t.attr("tabindex","0");t.focus()},cleanUpTabindex:function e(t){if(!t)return;if(t.data("previous-tabindex"))t.attr("tabindex",t.data("previous-tabindex"));else t.removeAttr("tabindex")},saveCurrentFocus:function e(){TS.ui.a11y.focus_stack.push(document.activeElement);return document.activeElement},saveCurrentFocusAndFocusOnElement:function e(t){var n=TS.ui.a11y.saveCurrentFocus();TS.ui.a11y.focusAndAddTabindex(t);return n},restorePreviousFocus:function e(){var t=TS.ui.a11y.focus_stack.pop();if(t&&"function"===typeof t.focus){t.focus();return t}},restorePreviousFocusAndCleanUpElement:function e(t){var n=TS.ui.a11y.restorePreviousFocus();TS.ui.a11y.cleanUpTabindex(t);return n},ariaLiveAnnounce:function e(t,n){TS.ui.a11y.$aria_live_div.empty();TS.ui.a11y.$aria_live_div.attr("aria-live",n?"assertive":"polite");TS.ui.a11y.$aria_live_div.text(t)},assembleActiveModelName:function e(){var t=TS.shared.getActiveModelOb();var n="";if(TS.model.unread_view_is_showing)n=TS.i18n.t("All unreads","a11y")();else if(TS.model.threads_view_is_showing)n=TS.i18n.t("Threads","a11y")();else if(t.is_channel)n=TS.i18n.t("Channel #{model_name}","a11y")({model_name:t.name});else if(t.is_im)if(TS.boot_data.feature_name_tagging_client)n=TS.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.members.getPrefCompliantMemberNameById(t.user)});else n=TS.i18n.t("Direct message with {model_name}","a11y")({model_name:t.name});else if(t.is_mpim)n=TS.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.mpims.getDisplayName(t)});else if(t.is_group)n=TS.i18n.t("Private Channel {model_name}","a11y")({model_name:t.name});return n},saveUnreadCountMessage:function e(t,n){if(!t||!t.name||!n)return;TS.ui.a11y.unread_message_strings[t.name]=n},annouceCurrentChannelOrImOrGroup:function e(){var t=TS.ui.a11y.assembleActiveModelName();var n=t;var r=TS.shared.getActiveModelOb();if(!r)return;if(TS.model.archive_view_is_showing){TS.ui.a11y.focusAndAddTabindex(o());return}if(TS.ui.a11y.unread_message_strings[r.name]){n+=", "+TS.ui.a11y.unread_message_strings[r.name];delete TS.ui.a11y.unread_message_strings[r.name]}TS.ui.a11y.ariaLiveAnnounce(n,true);if(!TS.boot_data.feature_texty)TS.client.ui.$msg_input.attr("aria-label",TS.i18n.t("Message input for {model_name}","a11y")({model_name:t}))},resetMessageInput:function e(){TS.client.msg_input.$input.trigger("autosize-resizeIncludeStyle");TS.client.msg_input.resized();TS.view.onResize()},replaceAnimatedImages:function e(){TS.ui.a11y.replaceAnimatedFiles();TS.ui.a11y.replaceEmoji()},replaceAnimatedFiles:function e(){var t=TS.model.prefs.a11y_animations;var n;var i;if(r){c();return}var a=TS.utility.msgs.getDisplayedMsgs(TS.shared.getActiveModelOb().msgs);var s;if(false===t){for(s=0;s<a.length;s+=1)if(a[s].file){n=a[s].file;if("gif"===n.filetype){if(n.deanimate_gif)i=n.deanimate_gif;else if(n.thumb_160)i=n.thumb_160;if(i)u(n.id,i)}else if("space"===n.filetype)c(a[s].ts)}else if(a[s].attachments)d(a[s].ts,a[s].attachments[0])}else for(s=0;s<a.length;s+=1)if(a[s].file){n=a[s].file;if("gif"===n.filetype){if(n.thumb_360_gif)i=n.thumb_360_gif;else if(n.thumb_360)i=n.thumb_360;if(i)u(n.id,i)}else if("space"===n.filetype)c(a[s].ts)}else if(a[s].attachments)d(a[s].ts,a[s].attachments[0])},replaceEmoji:function e(){var t=emoji;var n=$(".emoji:not(.stop_animations)");var r;for(var i=0;i<n.length;i+=1){var a=t.replace_colons(n[i].innerText);if(!a){var s=":"+n[i].parentNode.getAttribute("data-emoji")+":";a=t.replace_colons(s)}if(a)if(a.match(/.+background-image:url\((.+)\).*/))r=a.match(/.+background-image:url\((.+)\).*/)[1];n[i].style.backgroundImage='url("'+r+'")'}TS.emoji.makeMenuLists()},getContrastColor:function e(t){var n=false;t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(t){var r=parseInt(t[1],16);var i=parseInt(t[2],16);var a=parseInt(t[3],16);var s=(299*r+587*i+114*a)/1e3;n=s>=128?"#000000":"#FFFFFF"}return n},test:function e(){return{createAriaLiveElement:a,destroyAriaLiveElement:s,getMessageInputElement:o,getMessageDivElement:l}}});var e={70:"-3",80:"-2",90:"-1",normal:"0",110:"1",125:"2",150:"3"};var t=Object.keys(e).reduce(function(t,n){t[e[n]]=n;return t},{});var n=".message, .day_divider, .unread_divider";var r=TS.web&&TS.web.space;var i=function e(t){var n=t.attr("placeholder");var r=t.attr("aria-label")||"";var i=!!r.length;var a=!!t.val().trim().length;if(a&&!i&&n.length){t.attr("aria-label",n);return}if(!a&&i&&r==n)t.removeAttr("aria-label")};var a=function e(){TS.ui.a11y.$aria_live_div=$('<div id="aria_live_announcer" role="status"></div>');$("body").append(TS.ui.a11y.$aria_live_div);return TS.ui.a11y.$aria_live_div};var s=function e(){TS.ui.a11y.$aria_live_div.remove();delete TS.ui.a11y.$aria_live_div};var o=function e(){return TS.model.archive_view_is_showing&&TS.client.archives.not_member?$("#footer_archives"):TS.client.ui.$msg_input};var l=function e(){return TS.model.archive_view_is_showing?TS.client.archives.$archives_msgs_div:TS.client.ui.$msgs_div};var u=function e(t,n){var r=$('.image_gif[data-file-id="'+t+'"]');r.attr("data-src",n);r.find(".image_bg").attr("data-real-background-image",n);r.find(".image_bg").css("backgroundImage","url("+n+")");r.find("img").data("real-src",n);r.find("img").attr("src",n)};var d=function e(t,n){if(!n)return;if(n.is_animated||n.image_url&&n.image_url.match(/\.gifv?$/)){var r=$('.message[data-ts="'+t+'"]');var i=r.find(".msg_inline_img img");var a=false===TS.model.prefs.a11y_animations?TS.utility.getImgProxyURL(n.image_url,n.image_width,n.image_height):n.image_url;_(i,a)}};var c=function e(t){var n=r?$("ts-space .msg_inline_img img"):$('.message[data-ts="'+t+'"] .post_container .msg_inline_img img');$.each(n,function(){var e=$(this);var t=TS.utility.getImgProxyURL(e.attr("src"));_(e,t)})};var _=function e(t,n){t.attr({"data-real-src":n,src:n});var r=t.closest(".msg_inline_img");r.attr("data-real-background-image",n);r.css("backgroundImage","url("+n+")")};var m;var f=function e(){if(!TSSSB.supports_zoom_api)return;m=TSSSB.call("getZoom");$(window).on("resize",p)};var p=function e(){var t=TSSSB.call("getZoom");if(m!=t){m=t;TS.ui.a11y.zoom_level_changed_sig.dispatch({zoom_level:t})}};var h=function e(){if(!TSSSB.supports_zoom_api)return;$("body").append('<div class="zoom_level_indicator hidden"></div>');TS.ui.a11y.zoom_level_changed_sig.add(T)};var g=function e(n){var r=t[n]||"100";var i="normal"===r?"100":r;var a=TS.i18n.t("zoom: <strong>{zoom_percentage}%</strong>","a11y")({zoom_percentage:i});$(".zoom_level_indicator").html(a)};var S;var T=function e(t){if(TS._incremental_boot||$("body").hasClass("loading"))return;var n=$(".prefs_modal.active");if(n.length&&n.find(".a11y_pref_zoom").length)return;if(S){clearTimeout(S);S=null}g(t.zoom_level);var r=$(".zoom_level_indicator");r.insertAfter(document.body.lastElementChild);r.removeClass("hidden").show(0);var i=r.outerWidth()/2;var a="calc(50vw - "+i+"px)";r.css("left",a);S=setTimeout(function(){r.fadeOut(100)},1e3)}})()},4330:function(e,t){(function(){"use strict";TS.registerModule("searcher",{search:function t(n,r){if(r.limit)r.limit_option={limit:r.limit};else r.limit_option={limit:e};var i=f(n,r);if(r.tiered){var s=a(n,r);s.promise=i;return Promise.resolve(s)}return i},test:function e(){return{count:g}}});var e=24;var t={prefer_exact_match:true,frecency:true,prefer_channels_user_belongs_to:true,search_previous_channel_names:true};var n={include_archived:true,only_if_member:false};var r={include_archived:true};var i={include_self:false,include_slackbot:true,include_bots:true,only_local_team:false,only_admins:false};var a=function e(n,r){var i={};if(r.members)i.members=s(r.members);if(r.channels)i.channels=o(r.channels);if(r.groups)i.groups=l(r.groups);if(r.mpims)i.mpims=u(r.mpims);if(r.teams)i.teams=d(r.teams);if(r.usergroups)i.usergroups=c(r.usergroups);if(r.views)i.views=m(r.views);if(r.filter)i=r.filter(i);if(r.sort){var a=h(r.sort,r.limit_option,t);return TS.sorter.search(n,i,a)}return i};var s=function e(t){t=h(t,i);return TS.members.getMembersWithOptions(t)};var o=function e(t){t=h(t,n);var r;r=TS.redux.channels.dangerouslyGetChannelsForUser();if(!t.include_archived)r=_.reject(r,"is_archived");if(t.only_if_member)r=_.filter(r,"is_member");if(t.can_post)r=_.filter(r,_.curry(TS.permissions.members.canPostInModelOb)(TS.model.user));return r};var l=function e(t){t=h(t,r);var n=TS.redux.channels.dangerouslyGetGroups();if(!t.include_archived)n=_.reject(n,"is_archived");return n};var u=function e(){var t;t=TS.channels.getAllVisibleMpimsForUser(TS.redux.channels.dangerouslyGetMpims());return t};var d=function e(){return _.values(TS.boot_data.other_accounts)};var c=function e(){return TS.user_groups.getActiveUserGroups().slice()};var m=function e(){var t=[];if(TS.client.unread.isEnabled())t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_unreads"}));t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"}));if(TS.apps.isAppSpaceEnabled())t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vapp_space"}));return t};var f=function e(t,n){var r=[];if(n.members)r.push(p(t,n));return Promise.all(r).then(function(){return a(t,n)})};var p=function e(t,n){n=h(n.members,n.limit_option,i);n.max_api_results=n.limit;if("@"===t.charAt(0))t=t.slice(1);n.query=t;return TS.members.promiseToSearchMembers(n)};var h=function e(t,n){if(true===t)t={};return _.defaultsDeep.apply(null,arguments)};var g=function e(t){return _.size(_.flatten(_.values(t)))}})()},4331:function(e,t){(function(){"use strict";TS.registerModule("sli_expert_search",{is_expanded:false,last_query:"",last_api_response:{},sli_expert_search_group:null,sli_expert_search_debug_group:null,onStart:function e(){if(TS.client)TS.experiment.loadUserAssignments().then(function(){TS.sli_expert_search.sli_expert_search_group=TS.experiment.getGroup("sli_expert_search");TS.sli_expert_search.sli_expert_search_debug_group=TS.experiment.getGroup("sli_expert_search_debug")})},isEnabled:function e(){return"show_experts"===TS.sli_expert_search.sli_expert_search_group},render:function r(i,a,s,o){TS.sli_expert_search.last_api_response={experts:s,channels:o};if(TS.sli_expert_search.last_query!==i){TS.sli_expert_search.is_expanded=false;TS.sli_expert_search.last_query=i}var l="";var u=_(s).map(function(e){return _.map(e.users,function(e){return TS.members.getMemberById(e.id)})}).flatten().uniqBy("id").value();var d=u.length;var c=u.length>4;u=_.take(u,4);var m=_.map(s,function(r,a){if("order"===a)return;var s=_.map(r.users,function(e){return TS.members.getMemberById(e.id)});var o=_.map(r.channels,function(e){return TS.channels.getChannelById(e.id)});return{users:s,faces:_.take(s,2),description:e(s,o),channels:o,partial_terms:!t(i,r.terms),terms:n(i,r.terms)}});m=_.compact(m);var f=[];if(!_.isEmpty(o)){var p=_.map(o,function(e,t){if("order"===t)return;var n=TS.channels.getChannelById(e.id);return TS.templates.builders.makeChannelLink(n)});p=_.compact(p);f.push({channels:new Handlebars.SafeString(TS.i18n.listify(p,{no_escape:true}).join(""))})}l+=TS.templates.sli_expert_search_results({query:a,users:u,user_count:d,show_plus_sign_on_last_face:c,terms:i,results:m,channel_matches:f,expanded:TS.sli_expert_search.is_expanded,debug:"sli_expert_search_debug"===TS.sli_expert_search.sli_expert_search_debug_group});return l},toggleExpand:function e(){TS.sli_expert_search.is_expanded=!TS.sli_expert_search.is_expanded;$("[data-js=sli_expert_search]").toggleClass("sli_expert_search--collapsed",!TS.sli_expert_search.is_expanded);TS.clog.track(TS.sli_expert_search.is_expanded?"SEARCH_OPEN":"SEARCH_CLOSE",{request_id:TS.search.last_request_id,open_method:TS.sli_expert_search.is_expanded?"experts_expand":"experts_collapse"})},handleExpertsClick:function e(t,n,r){var i;var a;var s;a=$(t.target).parents("[data-expert-search-group-index]").data("expert-search-group-index");if("experts"===n)if("user"===r){i=$(t.target).parents(".sli_expert_search__description").find(".member").index(t.target);s=_.get(TS.sli_expert_search.last_api_response,["experts",a,"users",i,"iid"])}else{i=$(t.target).parents(".sli_expert_search__description").find(".channel_link").index(t.target);s=_.get(TS.sli_expert_search.last_api_response,["experts",a,"channels",i,"iid"])}else if("channels"===n&&"channel"===r){i=$(t.target).parents(".sli_expert_search__result").find(".channel_link").index(t.target);s=_.get(TS.sli_expert_search.last_api_response,["channels",i,"iid"])}var o={request_id:TS.search.last_request_id,click_iid:s,click_target_type:"experts_"+r,click_module_name:n,click_module_position:TS.sli_expert_search.last_api_response[n].order,click_sort:"timestamp",click_position:a};o["click_"+r+"_id"]=$(t.target).data(("user"===r?"member":"channel")+"-id");if(s)TS.clog.track("SEARCH_CLICK",o)}});var e=function e(t,n){var r=_.map(t,TS.templates.builders.makeMemberPreviewLink);var i=TS.i18n.listify(r,{no_escape:true}).join("");var a=_.map(n,function(e){return TS.templates.builders.makeChannelLink(e)});var s=TS.i18n.listify(a,{strong:true,no_escape:true}).join("");return TS.i18n.t("{user_link_text} in {channel_link_text}","search")({user_link_text:i,channel_link_text:s})};var t=function e(t,n){return _(t).split(" ").map(function(e){return n[e]}).every(Boolean)};var n=function e(t,n){return _.map(t.split(" "),function(e){return{word:e,present:n[e]}})}})()},4332:function(e,t){(function(){"use strict";TS.registerModule("sli_search_facets",{sli_search_facet_debug_group:null,onStart:function e(){if(TS.client)TS.experiment.loadUserAssignments().then(function(){TS.sli_search_facets.sli_search_facet_debug_group=TS.experiment.getGroup("sli_debug_facet_suggestions")})},isEnabled:function e(){var t=TS.sli_search_facets.sli_search_facet_debug_group;if(t)return t.startsWith("sli_facet_suggestions");return false},render:function e(t,n){var r=null;if(t)r=_(t).chain().filter(function(e,t){return"order"!==t}).map(function(e){return _.get(TS.channels.getChannelById(e.id),"name")||_.get(TS.groups.getGroupById(e.id),"name")||"???"}).value();var i=null;if(n)i=_(n).chain().filter(function(e,t){return"order"!==t}).map(function(e){return _.get(TS.members.getMemberById(e.id),"name")||_.get(TS.bots.getBotById(e.id),"name")||"???"}).value();var a="";a+=TS.templates.sli_search_facets_results({channel_names:r,user_names:i});return a}})})()},4930:function(e,t,n){n(4187);n(4189);n(4190);n(4191);n(4196);n(4197);n(4198);n(4199);n(4200);n(4201);n(4202);n(4203);n(4204);n(4205);n(4206);n(4207);n(4208);n(4209);n(4210);n(4211);n(4212);n(4213);n(4214);n(4215);n(4216);n(4217);n(4220);n(4221);n(4223);n(4224);n(4225);n(4226);n(4228);n(4229);n(4231);n(4232);n(4233);n(4234);n(4235);n(4236);n(4237);n(4238);n(4239);n(4240);n(4242);n(4243);n(4244);n(4245);n(4246);n(4247);n(4248);n(4249);n(4250);n(3690);n(4254);n(4256);n(4257);n(4258);n(4261);n(4262);n(4263);n(4265);n(4266);n(4269);n(4270);n(4271);n(4272);n(4273);n(4274);n(4275);n(4278);n(4280);n(4281);n(4282);n(4284);n(4285);n(4286);n(4288);n(4289);n(4291);n(4293);n(4294);n(4297);n(4299);n(4301);n(4302);n(3667);n(4305);n(4308);n(4309);n(4310);n(4313);n(4316);n(4317);n(4321);n(4325);n(4326);n(4327);n(4328);n(4329);n(4330);n(4331);n(4332);n(3669);n(3678);n(3677);n(3674);n(3675);n(3676);e.exports=n(3883)}},[4930]);